/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var e={62948:(e,t,n)=>{var r=n(22140),i=n(59980),a=n(81730),s=n(7405),o=n(84026),u=n(70865),l=n(18721);l.alea=r,l.xor128=i,l.xorwow=a,l.xorshift7=s,l.xor4096=o,l.tychei=u,e.exports=l},22140:function(e,t,n){var r;!function(e,i,a){function s(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function o(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function u(e,t){var n=new s(e),r=t&&t.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.alea=u}(0,e=n.nmd(e),n.amdD)},70865:function(e,t,n){var r;!function(e,i,a){function s(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function o(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function u(e,t){var n=new s(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.tychei=u}(0,e=n.nmd(e),n.amdD)},59980:function(e,t,n){var r;!function(e,i,a){function s(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function u(e,t){var n=new s(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.xor128=u}(0,e=n.nmd(e),n.amdD)},84026:function(e,t,n){var r;!function(e,i,a){function s(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,a=t.i;return t.w=r=r+1640531527|0,n=i[a+34&127],e=i[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=i[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,i,a,s,o=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),i=0,a=-32;a<u;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(s=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(s=s+1640531527|0,i=0==(n=o[127&a]^=r+s)?i+1:0);for(i>=128&&(o[127&(t&&t.length||0)]=-1),i=127,a=512;a>0;--a)r=o[i+34&127],n=o[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,o[i]=r^n;e.w=s,e.X=o,e.i=i}(t,e)}function o(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function u(e,t){null==e&&(e=+new Date);var n=new s(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&(r.X&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.xor4096=u}(0,e=n.nmd(e),n.amdD)},7405:function(e,t,n){var r;!function(e,i,a){function s(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],n=(e^=e>>>7)^e<<24,n^=(e=r[i+1&7])^e>>>10,n^=(e=r[i+3&7])^e>>>3,n^=(e=r[i+4&7])^e<<7,e=r[i+7&7],n^=(e^=e<<13)^e<<9,r[i]=n,t.i=i+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function o(e,t){return t.x=e.x.slice(),t.i=e.i,t}function u(e,t){null==e&&(e=+new Date);var n=new s(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&(r.x&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.xorshift7=u}(0,e=n.nmd(e),n.amdD)},81730:function(e,t,n){var r;!function(e,i,a){function s(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function u(e,t){var n=new s(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.xorwow=u}(0,e=n.nmd(e),n.amdD)},18721:(e,t,n)=>{var r;!function(i,a){var s,o=this,u=256,l=a.pow(u,6),c=a.pow(2,52),d=2*c,h=255;function f(e,t,n){var r=[],h=y(m((t=1==t?{entropy:!0}:t||{}).entropy?[e,v(i)]:null==e?function(){try{var e;return s&&(e=s.randomBytes)?e=e(u):(e=new Uint8Array(u),(o.crypto||o.msCrypto).getRandomValues(e)),v(e)}catch(e){var t=o.navigator,n=t&&t.plugins;return[+new Date,o,n,o.screen,v(i)]}}():e,3),r),f=new p(r),b=function(){for(var e=f.g(6),t=l,n=0;e<c;)e=(e+n)*u,t*=u,n=f.g(1);for(;e>=d;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|f.g(4)},b.quick=function(){return f.g(4)/4294967296},b.double=b,y(v(f.S),i),(t.pass||n||function(e,t,n,r){return r&&(r.S&&g(r,f),e.state=function(){return g(f,{})}),n?(a.random=e,t):e})(b,h,"global"in t?t.global:this==a,t.state)}function p(e){var t,n=e.length,r=this,i=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);i<u;)s[i]=i++;for(i=0;i<u;i++)s[i]=s[a=h&a+e[i%n]+(t=s[i])],s[a]=t;(r.g=function(e){for(var t,n=0,i=r.i,a=r.j,s=r.S;e--;)t=s[i=h&i+1],n=n*u+s[h&(s[i]=s[a=h&a+t])+(s[a]=t)];return r.i=i,r.j=a,n})(u)}function g(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){var n,r=[],i=typeof e;if(t&&"object"==i)for(n in e)try{r.push(m(e[n],t-1))}catch(e){}return r.length?r:"string"==i?e:e+"\0"}function y(e,t){for(var n,r=e+"",i=0;i<r.length;)t[h&i]=h&(n^=19*t[h&i])+r.charCodeAt(i++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(a.seedrandom=f,y(a.random(),i),e.exports){e.exports=f;try{s=n(50914)}catch(e){}}else void 0===(r=function(){return f}.call(t,n,t,e))||(e.exports=r)}([],Math)},68713:(e,t,n)=>{"use strict";n.d(t,{JL:()=>r,Zu:()=>i});class r{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class i{refCount(e){return a("refCount")}incRef(e){return a("incRef")}timerAvailable(){return!0}time(e){return a("time")}read(e){return a("read")}readSync(e){return a("readSync")}readToGPU(e,t){return a("readToGPU")}numDataIds(){return a("numDataIds")}disposeData(e,t){return a("disposeData")}write(e,t,n){return a("write")}move(e,t,n,r,i){return a("move")}memory(){return a("memory")}floatPrecision(){return a("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return a("dispose")}}function a(e){throw new Error(`'${e}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}},97097:(e,t,n)=>{"use strict";n.d(t,{BV:()=>x,wv:()=>b});var r=n(68713),i=n(22885),a=n(55938),s=n(29121),o=n(26151),u=n(64706),l=n(79122),c=n(20569);class d{constructor(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new f)}profileKernel(e,t,n){let r;const a=()=>{r=n()};let s;const o=l.now();if(this.backendTimer.timerAvailable())s=this.backendTimer.time(a);else{a();for(const e of r)e.dataSync();s=Promise.resolve({kernelMs:l.now()-o})}if((0,i.OB)().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let t=0;t<r.length;t++){const n=r[t];n.data().then((t=>{h(t,n.dtype,e)}))}return{kernelName:e,outputs:r,inputs:t,timeMs:s.then((e=>e.kernelMs)),extraInfo:s.then((e=>null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""))}}logKernelProfile(e){const{kernelName:t,outputs:n,timeMs:r,inputs:i,extraInfo:a}=e;n.forEach((e=>{Promise.all([e.data(),r,a]).then((n=>{this.logger.logKernelProfile(t,e,n[0],n[1],i,n[2])}))}))}}function h(e,t,n){if("float32"!==t)return!1;for(let t=0;t<e.length;t++){const r=e[t];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class f{logKernelProfile(e,t,n,r,i,a){const s="number"==typeof r?c.oj(`${r}ms`,9):r.error,o=c.oj(e,25),u=t.rank,l=t.size,d=c.oj(t.shape.toString(),14);let h="";for(const e in i){const n=i[e];if(null!=n){const r=n.shape||t.shape,i=r.length;h+=`${e}: ${i}D ${i>0?r:""} `}}console.log(`%c${o}\t%c${s}\t%c${u}D ${d}\t%c${l}\t%c${h}\t%c${a}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}var p=n(4077),g=n(80747);function m(e){return null!=e.kernelName}class y{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((e=>e.name))))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class v{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new y}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;{const{asyncInit:t}=this.initializeBackend(e);if(t)return null}}return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,n=1){return e in this.registryFactory?(u.Z(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}async setBackend(e){if(null==this.registryFactory[e])throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,null==this.registry[e]){this.backendInstance=null;const{success:t,asyncInit:n}=this.initializeBackend(e);if(!(n?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new d(this.backendInstance),!0}setupRegisteredKernels(){(0,o.tr)(this.backendName).forEach((e=>{null!=e.setupFunc&&e.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(e){(0,o.tr)(e).forEach((t=>{null!=t.disposeFunc&&t.disposeFunc(this.registry[e])}))}initializeBackend(e){const t=this.registryFactory[e];if(null==t)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const n=t.factory();if(!n||n instanceof r.Zu||"function"!=typeof n.then)return this.registry[e]=n,{success:!0,asyncInit:!1};{const t=++this.pendingBackendInitId,r=n.then((n=>!(t<this.pendingBackendInitId||(this.registry[e]=n,this.pendingBackendInit=null,0)))).catch((n=>(t<this.pendingBackendInitId||(this.pendingBackendInit=null,u.Z(`Initialization of backend ${e} failed`),u.Z(n.stack||n.message)),!1)));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(t){return u.Z(`Initialization of backend ${e} failed`),u.Z(t.stack||t.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority))}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t],{success:r,asyncInit:i}=this.initializeBackend(n);if(i||r)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const n=this.state.tensorInfo.get(t),r=n.backend,i=this.readSync(t),a=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,a),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let n,r=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}return this.scopedRun((()=>this.startScope(r)),(()=>this.endScope(n)),(()=>(n=t(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(e,t,n){e();try{const e=n();return t(),e}catch(e){throw t(),e}}nextTensorId(){return v.nextTensorId++}nextVariableId(){return v.nextVariableId++}clone(e){const t=x.runKernel(s.iJ,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(e=>({x:()=>{const t={x:e};return x.runKernel(s.RF,t,{dtype:"float32"})}})),[],{}),t}runKernel(e,t,n){if(null==this.backendName&&this.backend,null==(0,o.pI)(e,this.backendName))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,n){const r=this.backend.numDataIds();let i=0;n.forEach((e=>{i+="complex64"===e.dtype?3:1}));const a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=r-t-i-a;if(s>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${s} data ids) after running '${e}'`)}runKernelFunc(e){let t,n=[];const r=this.isTapeOn(),i=this.state.numBytes,a=this.state.numTensors;let s,u;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const l=m(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(m(e)){const{kernelName:t,inputs:i,attrs:a}=e;null==this.backendName&&this.backend;const l=(0,o.pI)(t,this.backendName);c.hu(null!=l,(()=>`Cannot find registered kernel '${t}' for backend '${this.backendName}'`)),s=()=>{const e=this.backend.numDataIds();u=l.kernelFunc({inputs:i,attrs:a,backend:this.backend});const s=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(t,e,s);const o=s.map((e=>{if(null!=e.rank)return e;const{dataId:t,shape:n,dtype:r}=e;return this.makeTensorFromDataId(t,n,r)}));if(r){const e=this.getTensorsForGradient(t,i,o);n=this.saveTensorsForBackwardMode(e)}return o}}else{const{forwardFunc:t}=e,i=e=>{r&&(n=e.map((e=>this.keep(this.clone(e)))))};s=()=>{const e=this.backend.numDataIds();u=this.tidy((()=>t(this.backend,i)));const n=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,e,n),n}}const{inputs:d,attrs:h}=e,f=m(e)?null:e.backwardsFunc;let p;return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(p=this.profiler.profileKernel(l,d,(()=>s())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),t=p.outputs):t=s()})),r&&this.addTapeNode(l,d,t,f,n,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-a,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map((e=>null!=d[e]?d[e].shape:null)),outputShapes:t.map((e=>e.shape)),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(u)?t:t[0]}saveTensorsForBackwardMode(e){const t=e.map((e=>this.keep(this.clone(e))));return t}getTensorsForGradient(e,t,n){const r=(0,o.uk)(e);if(null!=r){const e=r.inputsToSave||[],i=r.outputsToSave||[];let a;r.saveAllInputs?(c.hu(Array.isArray(t),(()=>"saveAllInputs is true, expected inputs to be an array.")),a=Object.keys(t).map((e=>t[e]))):a=e.map((e=>t[e]));const s=n.filter(((e,t)=>i[t]));return a.concat(s)}return[]}makeTensor(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let i=e;"string"===n&&c.HD(e[0])&&(i=e.map((e=>l.encodeString(e))));const a=r.write(i,t,n),s=new p.es(t,n,a,this.nextTensorId());if(this.trackTensor(s,r),"string"===n){const e=this.state.tensorInfo.get(a),t=(0,c.Ub)(i);this.state.numBytes+=t-e.bytes,e.bytes=t}return s}makeTensorFromDataId(e,t,n,r){n=n||"float32";const i=new p.es(t,n,e,this.nextTensorId());return this.trackTensor(i,r),i}makeVariable(e,t=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));const i=new p._w(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*c.bT(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof p._w||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){const t=e.size*c.bT(e.dtype);this.state.numBytes-=t}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((e=>e.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const e of this.state.activeProfile.kernels)e.kernelTimeMs=await e.kernelTimeMs,e.extraInfo=await e.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(e,t,n,r,i,a){const s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},u=(0,o.uk)(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=e=>(e=e.map(((e,t)=>{if(null==e){const e=n[t],r=c.wT(e.size,e.dtype);return this.makeTensor(r,e.shape,e.dtype)}return e})),r(e.length>1?e:e[0],i,a))),this.state.activeTape.push(s)}keep(e){return e.kept=!0,e}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=(0,g.getTensorsInContainer)(e),n=new Set(t.map((e=>e.id)));for(let e=0;e<this.state.activeScope.track.length;e++){const t=this.state.activeScope.track[e];t.kept||n.has(t.id)||t.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach((e=>{e.kept||e.scopeId!==r.id||this.track(e)}))}gradients(e,t,n,r=!1){if(c.hu(t.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const i=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",e)));c.hu(i instanceof p.es,(()=>"The result y returned by f() must be a tensor."));const a=function(e,t,n){const r={},i={};for(let e=0;e<t.length;e++)r[t[e].id]=!0;for(let n=0;n<e.length;n++){const a=e[n],s=a.inputs;for(const e in s){const n=s[e];let o=!1;for(let e=0;e<t.length;e++)if(r[n.id]){a.outputs.forEach((e=>r[e.id]=!0)),o=!0,i[a.id]=!0;break}if(o)break}}const a={};a[n.id]=!0;const s={};for(let t=e.length-1;t>=0;t--){const n=e[t],r=n.inputs;for(let e=0;e<n.outputs.length;e++)if(a[n.outputs[e].id]){for(const e in r)a[r[e].id]=!0,s[n.id]=!0;break}}const o=[];for(let t=0;t<e.length;t++){const n=e[t];if(i[n.id]&&s[n.id]){const e={};for(const t in n.inputs){const i=n.inputs[t];r[i.id]&&(e[t]=i)}const t=Object.assign({},n);t.inputs=e,t.outputs=n.outputs,o.push(t)}}return o}(this.state.activeTape,t,i);if(!r&&0===a.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const e={};e[i.id]=null==n?function(e){const t=(0,c.p8)((0,c.NA)(e),"float32");return x.makeTensor(t,e,"float32")}(i.shape):n,function(e,t,n,r){for(let i=t.length-1;i>=0;i--){const a=t[i],s=[];if(a.outputs.forEach((t=>{const n=e[t.id];null!=n?s.push(n):s.push(null)})),null==a.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${a.kernelName}.`);const o=a.gradient(s);for(const t in a.inputs){if(!(t in o))throw new Error(`Cannot backprop through input ${t}. Available gradients found: ${Object.keys(o)}.`);const i=n((()=>o[t]()));if("float32"!==i.dtype)throw new Error(`Error in gradient for op ${a.kernelName}. The gradient of input ${t} must have 'float32' dtype, but has '${i.dtype}'`);const s=a.inputs[t];if(!c.cO(i.shape,s.shape))throw new Error(`Error in gradient for op ${a.kernelName}. The gradient of input '${t}' has shape '${i.shape}', which does not match the shape of the input '${s.shape}'`);if(null==e[s.id])e[s.id]=i;else{const t=e[s.id];e[s.id]=r(t,i),t.dispose()}}}}(e,a,(e=>this.tidy(e)),w);const r=t.map((t=>e[t.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((e=>{for(const t of e.saved)t.dispose()})),this.state.activeTape=null),{value:i,grads:r}}))}customGrad(e){return c.hu(c.mf(e),(()=>"The f passed in customGrad(f) must be a function.")),(...t)=>{let n;c.hu(t.every((e=>e instanceof p.es)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const r={};return t.forEach(((e,t)=>{r[t]=e})),this.runKernelFunc({forwardFunc:(r,i)=>(n=e(...t,i),c.hu(n.value instanceof p.es,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),c.hu(c.mf(n.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),n.value),backwardsFunc:(e,r)=>{const i=n.gradFunc(e,r),a=Array.isArray(i)?i:[i];c.hu(a.length===t.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),c.hu(a.every((e=>e instanceof p.es)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const s={};return a.forEach(((e,t)=>{s[t]=()=>e})),s},inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=(0,l.now)(),n=await this.backend.time(e);return n.wallMs=(0,l.now)()-t,n}track(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new y;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function b(){const e=(0,a.D)();if(null==e._tfengine){const t=new i.qA(e);e._tfengine=new v(t)}return(0,i.iG)(e._tfengine.ENV),(0,p.Vi)((()=>e._tfengine)),e._tfengine}v.nextTensorId=0,v.nextVariableId=0;const x=b();function w(e,t){const n={a:e,b:t};return x.runKernel(s.mm,n)}},22885:(e,t,n)=>{"use strict";n.d(t,{OB:()=>s,Vi:()=>o,iG:()=>u,qA:()=>i});var r=n(20569);class i{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=a,this.populateURLFlags()}setPlatform(e,t){null!=this.platform&&(s().getBool("IS_TEST")||s().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){const t=this.urlFlags[e];s().getBool("IS_TEST")||s().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${t}.`),this.set(e,t)}}async getAsync(e){return e in this.flags||(this.flags[e]=await this.evaluateFlag(e)),this.flags[e]}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if((0,r.tI)(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(null==this.flagRegistry[e])throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(null==this.flagRegistry[e])throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const e=this.getQueryParams(this.global.location.search);"tfjsflags"in e&&e.tfjsflags.split(",").forEach((e=>{const[t,n]=e.split(":");this.urlFlags[t]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error(`Could not parse value flag value ${t} for flag ${e}.`)}(t,n)}))}}function a(e){const t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,((e,...n)=>(function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,n[0],n[1]),n.join("=")))),t}function s(){return o}let o=null;function u(e){o=e}},55938:(e,t,n)=>{"use strict";let r;function i(){if(null==r){let e;if("undefined"!=typeof window)e=window;else if(void 0!==n.g)e=n.g;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}r=e}return r}function a(e,t){const n=function(){const e=i();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);{const r=t();return n.set(e,r),n.get(e)}}n.d(t,{D:()=>i,R:()=>a})},30633:(e,t,n)=>{"use strict";n.d(t,{UQ:()=>o,cb:()=>h,fN:()=>c,h7:()=>l,pn:()=>d,ti:()=>u});var r=n(97097),i=n(4077),a=n(43740),s=n(20569);function o(e){return s.hu(s.mf(e),(()=>"The f passed in grad(f) must be a function")),(t,n)=>{const i=(0,a._1)(t,"x","tf.grad","string_or_numeric"),o=null!=n?(0,a._1)(n,"dy","tf.grad"):null;return r.BV.tidy((()=>{const{value:t,grads:n}=r.BV.gradients((()=>e(i)),[i],o);return null!=o&&s.k5(t.shape,o.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),f(n),n[0]}))}}function u(e){return s.hu(s.mf(e),(()=>"The f passed in grads(f) must be a function")),(t,n)=>{s.hu(Array.isArray(t),(()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"));const i=(0,a.sI)(t,"args","tf.grads","string_or_numeric"),o=null!=n?(0,a._1)(n,"dy","tf.grads"):null;return r.BV.tidy((()=>{const{value:t,grads:n}=r.BV.gradients((()=>e(...i)),i,o);return null!=o&&s.k5(t.shape,o.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),f(n),n}))}}function l(e){return s.hu(s.mf(e),(()=>"The f passed in valueAndGrad(f) must be a function")),(t,n)=>{s.hu(t instanceof i.es,(()=>"The x passed in valueAndGrad(f)(x) must be a tensor")),s.hu(null==n||n instanceof i.es,(()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"));const{grads:a,value:o}=r.BV.gradients((()=>e(t)),[t],n);return f(a),{grad:a[0],value:o}}}function c(e){return s.hu(s.mf(e),(()=>"The f passed in valueAndGrads(f) must be a function")),(t,n)=>{s.hu(Array.isArray(t)&&t.every((e=>e instanceof i.es)),(()=>"The args passed in valueAndGrads(f)(args) must be array of tensors")),s.hu(null==n||n instanceof i.es,(()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"));const a=r.BV.gradients((()=>e(...t)),t,n);return null!=n&&s.k5(a.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),f(a.grads),a}}function d(e,t){s.hu(s.mf(e),(()=>"The f passed in variableGrads(f) must be a function")),s.hu(null==t||Array.isArray(t)&&t.every((e=>e instanceof i._w)),(()=>"The varList passed in variableGrads(f, varList) must be an array of variables"));const n=null!=t;if(!n){t=[];for(const e in r.BV.registeredVariables)t.push(r.BV.registeredVariables[e])}const a=n?t.filter((e=>!e.trainable)):null,o=t.length;t=t.filter((e=>e.trainable)),s.hu(t.length>0,(()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${o} variables is trainable.`));const{value:u,grads:l}=r.BV.gradients(e,t,null,!0);s.hu(l.some((e=>null!=e)),(()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize().")),s.hu(0===u.rank,(()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${u.rank} tensor`));const c={};return t.forEach(((e,t)=>{null!=l[t]&&(c[e.name]=l[t])})),null!=a&&a.forEach((e=>c[e.name]=null)),{value:u,grads:c}}function h(e){return r.BV.customGrad(e)}function f(e){if(e.filter((e=>null==e)).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}},93792:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Abs:()=>Ye.SY,Acos:()=>Ye.VG,Acosh:()=>Ye.Sp,AdadeltaOptimizer:()=>nn,AdagradOptimizer:()=>an,AdamOptimizer:()=>un,AdamaxOptimizer:()=>dn,Add:()=>Ye.mm,AddN:()=>Ye.Xz,All:()=>Ye.oT,Any:()=>Ye.IK,ArgMax:()=>Ye.sJ,ArgMin:()=>Ye.aJ,Asin:()=>Ye.M2,Asinh:()=>Ye.qw,Atan:()=>Ye.jM,Atan2:()=>Ye.QC,Atanh:()=>Ye.Oy,AvgPool:()=>Ye.Jh,AvgPool3D:()=>Ye._k,AvgPool3DGrad:()=>Ye.IM,AvgPoolGrad:()=>Ye.RO,BatchMatMul:()=>Ye.XL,BatchToSpaceND:()=>Ye.zw,Bincount:()=>Ye.zv,BroadcastArgs:()=>Ye.eE,BroadcastTo:()=>Ye.Ly,Cast:()=>Ye.RF,Ceil:()=>Ye.gJ,ClipByValue:()=>Ye.xn,Complex:()=>Ye.Zz,ComplexAbs:()=>Ye.yj,Concat:()=>Ye.Eh,Conv2D:()=>Ye.mh,Conv2DBackpropFilter:()=>Ye.wU,Conv2DBackpropInput:()=>Ye.wm,Conv3D:()=>Ye.x1,Conv3DBackpropFilterV2:()=>Ye.o2,Conv3DBackpropInputV2:()=>Ye.ik,Cos:()=>Ye.mc,Cosh:()=>Ye.TR,CropAndResize:()=>Ye.Vc,Cumprod:()=>Ye.By,Cumsum:()=>Ye.iH,DataStorage:()=>Ho.JL,DenseBincount:()=>Ye.QR,DepthToSpace:()=>Ye.T0,DepthwiseConv2dNative:()=>Ye.ci,DepthwiseConv2dNativeBackpropFilter:()=>Ye.sL,DepthwiseConv2dNativeBackpropInput:()=>Ye.y7,Diag:()=>Ye.$w,Dilation2D:()=>Ye.p4,Dilation2DBackpropFilter:()=>Ye.Vn,Dilation2DBackpropInput:()=>Ye.ek,ENV:()=>x.Vi,Einsum:()=>Ye.$g,Elu:()=>Ye.SX,EluGrad:()=>Ye.HE,Environment:()=>x.qA,Equal:()=>Ye.hd,Erf:()=>Ye.Om,Exp:()=>Ye.NE,ExpandDims:()=>Ye.YF,Expm1:()=>Ye.Y0,FFT:()=>Ye.vw,Fill:()=>Ye.de,FlipLeftRight:()=>Ye.Uy,Floor:()=>Ye.OR,FloorDiv:()=>Ye.je,FromPixels:()=>Ye.eB,FusedBatchNorm:()=>Ye.sH,FusedConv2D:()=>Ye._V,FusedDepthwiseConv2D:()=>Ye.lu,GatherNd:()=>Ye.q1,GatherV2:()=>Ye.qi,Greater:()=>Ye.iZ,GreaterEqual:()=>Ye.Ac,IFFT:()=>Ye.Qg,Identity:()=>Ye.iJ,Imag:()=>Ye.J_,IsFinite:()=>Ye.av,IsInf:()=>Ye.iW,IsNan:()=>Ye.r7,KernelBackend:()=>Ho.Zu,LRN:()=>Ye.eZ,LRNGrad:()=>Ye.Hh,LeakyRelu:()=>Ye.J$,Less:()=>Ye.vt,LessEqual:()=>Ye.CA,LinSpace:()=>Ye.e7,Log:()=>Ye.Zb,Log1p:()=>Ye.kU,LogSoftmax:()=>Ye.qC,LogicalAnd:()=>Ye.PY,LogicalNot:()=>Ye.Vf,LogicalOr:()=>Ye.MZ,Max:()=>Ye.Yo,MaxPool:()=>Ye.mT,MaxPool3D:()=>Ye.OA,MaxPool3DGrad:()=>Ye.OU,MaxPoolGrad:()=>Ye.OV,MaxPoolWithArgmax:()=>Ye.vF,Maximum:()=>Ye.BM,Mean:()=>Ye.q2,Min:()=>Ye.c1,Minimum:()=>Ye.q8,MirrorPad:()=>Ye.jQ,Mod:()=>Ye.Vb,MomentumOptimizer:()=>fn,Multinomial:()=>Ye.NZ,Multiply:()=>Ye.wY,Neg:()=>Ye.ku,NonMaxSuppressionV3:()=>Ye.uv,NonMaxSuppressionV4:()=>Ye.cy,NonMaxSuppressionV5:()=>Ye.W0,NotEqual:()=>Ye.yQ,OP_SCOPE_SUFFIX:()=>qe.z,OneHot:()=>Ye.we,OnesLike:()=>Ye.qW,Optimizer:()=>tn,OptimizerConstructors:()=>gn,Pack:()=>Ye.Qi,PadV2:()=>Ye.ly,Pool:()=>Ye.Kg,Pow:()=>Ye.pe,Prelu:()=>Ye.o0,Prod:()=>Ye.Dl,RMSPropOptimizer:()=>pn,Range:()=>Ye.e6,Rank:()=>mn.yw,Real:()=>Ye.xJ,RealDiv:()=>Ye.oH,Reciprocal:()=>Ye.$H,Reduction:()=>ks,Relu:()=>Ye.qk,Relu6:()=>Ye.Sb,Reshape:()=>Ye.HZ,ResizeBilinear:()=>Ye._Y,ResizeBilinearGrad:()=>Ye.zb,ResizeNearestNeighbor:()=>Ye.dp,ResizeNearestNeighborGrad:()=>Ye.Hm,Reverse:()=>Ye.mK,RotateWithOffset:()=>Ye.b9,Round:()=>Ye.e0,Rsqrt:()=>Ye.bV,SGDOptimizer:()=>hn,ScatterNd:()=>Ye.xQ,Select:()=>Ye.Ph,Selu:()=>Ye.oF,Sigmoid:()=>Ye.a5,Sign:()=>Ye.i5,Sin:()=>Ye.RQ,Sinh:()=>Ye.w3,Slice:()=>Ye.p2,Softmax:()=>Ye.Gc,Softplus:()=>Ye.MR,SpaceToBatchND:()=>Ye.TQ,SparseFillEmptyRows:()=>Ye.O3,SparseReshape:()=>Ye.nh,SparseSegmentMean:()=>Ye.YW,SparseSegmentSum:()=>Ye.Zj,SparseToDense:()=>Ye.D2,SplitV:()=>Ye.L8,Sqrt:()=>Ye.FK,Square:()=>Ye.bK,SquaredDifference:()=>Ye._t,Step:()=>Ye.h8,StridedSlice:()=>Ye.m2,StringNGrams:()=>Ye._J,StringSplit:()=>Ye.s1,StringToHashBucketFast:()=>Ye.Xk,Sub:()=>Ye.Tr,Sum:()=>Ye.GB,Tan:()=>Ye.sE,Tanh:()=>Ye.MI,Tensor:()=>we.es,TensorBuffer:()=>we.YD,Tile:()=>Ye.n9,TopK:()=>Ye.cW,Transform:()=>Ye.wx,Transpose:()=>Ye.G3,Unique:()=>Ye.kp,Unpack:()=>Ye.To,UnsortedSegmentSum:()=>Ye.Qv,Variable:()=>we._w,ZerosLike:()=>Ye.Ru,_FusedMatMul:()=>Ye.us,abs:()=>ln.W,acos:()=>yn.K,acosh:()=>vn._,add:()=>Ht.I,addN:()=>bn,all:()=>xn.$,any:()=>wn.Y,argMax:()=>kn.N,argMin:()=>_n.v,asin:()=>Sn.Z,asinh:()=>Cn.V,atan:()=>An.z,atan2:()=>En.f,atanh:()=>Fn.C,avgPool:()=>In.w,avgPool3d:()=>$n,backend:()=>Gt,backend_util:()=>f,basicLSTMCell:()=>Bn,batchNorm:()=>Ln.t,batchNorm2d:()=>Pn,batchNorm3d:()=>jn,batchNorm4d:()=>Un,batchToSpaceND:()=>zn.E,bincount:()=>Wn,booleanMaskAsync:()=>Aa,broadcastArgs:()=>Vn,broadcastTo:()=>Gn.U,broadcast_util:()=>Ke,browser:()=>s,buffer:()=>ke,cast:()=>_e.p,ceil:()=>qn.m,clipByValue:()=>Hn.i,clone:()=>Se.d,complex:()=>k.P,concat:()=>Tn.z,concat1d:()=>Xn,concat2d:()=>Kn,concat3d:()=>Yn,concat4d:()=>Qn,conv1d:()=>Jn.P,conv2d:()=>Zn.T,conv2dTranspose:()=>er.b,conv3d:()=>tr,conv3dTranspose:()=>rr,copyRegisteredKernels:()=>Qe.T3,cos:()=>ir.m,cosh:()=>ar.f,cosineWindow:()=>Oa,cumprod:()=>sr.$,cumsum:()=>or.z,customGrad:()=>Zt.cb,denseBincount:()=>ur,deprecationWarn:()=>It,depthToSpace:()=>lr.n,depthwiseConv2d:()=>cr.B,device_util:()=>r,diag:()=>dr,dilation2d:()=>hr.W,disableDeprecationWarnings:()=>Ft,dispose:()=>Mt,disposeVariables:()=>Dt,div:()=>Xt.h,divNoNan:()=>fr.N,dot:()=>pr.A,dropout:()=>$a,einsum:()=>gr,elu:()=>mr.p,enableDebugMode:()=>Et,enableProdMode:()=>At,enclosingPowerOfTwo:()=>Ta,engine:()=>Nt,env:()=>x.OB,equal:()=>yr.D,erf:()=>vr.q,exp:()=>br.Q,expandDims:()=>xr.d,expm1:()=>wr.t,eye:()=>_r,fft:()=>Zi.k,fill:()=>rn,findBackend:()=>Ut,findBackendFactory:()=>Wt,floor:()=>Sr.G,floorDiv:()=>Cr.q,fused:()=>d,gather:()=>Ar.I,gatherND:()=>Na,gather_util:()=>o,getBackend:()=>Pt,getGradient:()=>Qe.uk,getKernel:()=>Qe.pI,getKernelsForBackend:()=>Qe.tr,grad:()=>Zt.UQ,grads:()=>Zt.ti,greater:()=>Er.p,greaterEqual:()=>Fr.b,ifft:()=>ea.S,imag:()=>Ir.a,image:()=>js,inTopKAsync:()=>Ma,io:()=>i,irfft:()=>ta.w,isFinite:()=>Dr.x,isInf:()=>Nr.U,isNaN:()=>$r.i,keep:()=>Rt,kernel_impls:()=>p,leakyRelu:()=>Tr.h,less:()=>Or.d,lessEqual:()=>Mr.z,linalg:()=>Us,linspace:()=>Rr,localResponseNormalization:()=>Br.G,log:()=>zr.c,log1p:()=>Lr.K,logSigmoid:()=>Pr.e,logSoftmax:()=>jr.C,logSumExp:()=>Ur.l,logicalAnd:()=>Wr.H,logicalNot:()=>Vr.h,logicalOr:()=>Gr.K,logicalXor:()=>qr.e,losses:()=>Ws,matMul:()=>Ve.O,math:()=>a,max:()=>Hr.F,maxPool:()=>Xr._,maxPool3d:()=>Kr,maxPoolWithArgmax:()=>Yr,maximum:()=>cn.g,mean:()=>Qr.J,memory:()=>$t,meshgrid:()=>Zr,min:()=>ei.V,minimum:()=>ti.L,mirrorPad:()=>ni.V,mod:()=>ri.w,moments:()=>ai,movingAverage:()=>Fa,mul:()=>Kt.d,multiRNNCell:()=>si,multinomial:()=>oi,neg:()=>ui.W,nextFrame:()=>Xs,norm:()=>Ea.K,notEqual:()=>li.Q,oneHot:()=>Ge.l,ones:()=>Jr.i,onesLike:()=>ci.J,op:()=>qe.op,outerProduct:()=>di,pad:()=>hi.v,pad1d:()=>fi,pad2d:()=>pi,pad3d:()=>gi,pad4d:()=>mi,pool:()=>yi.d,pow:()=>sn.s,prelu:()=>vi.A,print:()=>Ce,prod:()=>bi.W,profile:()=>Tt,rand:()=>xi,randomGamma:()=>Ci,randomNormal:()=>Ai,randomUniform:()=>Ei,range:()=>Fi,ready:()=>Lt,real:()=>Ii.k,reciprocal:()=>Di.M,registerBackend:()=>Vt,registerGradient:()=>Qe.Li,registerKernel:()=>Qe.wC,relu:()=>Ni.U,relu6:()=>$i.b,removeBackend:()=>jt,reshape:()=>Nn.X,reverse:()=>Ti.G,reverse1d:()=>Oi,reverse2d:()=>Mi,reverse3d:()=>Ri,reverse4d:()=>Bi,rfft:()=>na.Q,round:()=>zi.N,rsqrt:()=>Li.b,scalar:()=>en.i,scatterND:()=>Ia,scatter_util:()=>u,selu:()=>Pi.U,separableConv2d:()=>ji.U,serialization:()=>l,setBackend:()=>zt,setPlatform:()=>qt,setdiff1dAsync:()=>Ui,sigmoid:()=>On.X,sign:()=>Wi.X,signal:()=>Ps,sin:()=>Vi.O,sinh:()=>Gi.R,slice:()=>Mn.t,slice1d:()=>qi,slice2d:()=>Hi,slice3d:()=>Xi,slice4d:()=>Ki,slice_util:()=>ut,softmax:()=>Yi.X,softplus:()=>Qi.W,spaceToBatchND:()=>Ji.f,sparse:()=>Vs,sparseToDense:()=>Da,spectral:()=>Ls,split:()=>ra.V,sqrt:()=>Yt._,square:()=>Qt.h,squaredDifference:()=>ia.$,squeeze:()=>aa.L,stack:()=>sa.k,step:()=>oa.N,stridedSlice:()=>ua.N,string:()=>Gs,sub:()=>on.l,sum:()=>la.S,sumOutType:()=>mn.z4,tan:()=>ca.O,tanh:()=>Rn.A,tensor:()=>C,tensor1d:()=>da,tensor2d:()=>ha,tensor3d:()=>Je,tensor4d:()=>fa,tensor5d:()=>pa,tensor6d:()=>ga,tensor_util:()=>ht,test_util:()=>c,tidy:()=>Ot,tile:()=>kr.G,time:()=>Bt,topk:()=>ma.h,train:()=>qs,transpose:()=>He.p,truncatedNormal:()=>ya,unique:()=>va.T,unregisterGradient:()=>Qe.bt,unregisterKernel:()=>Qe.nE,unsortedSegmentSum:()=>ba.p,unstack:()=>xa.H,upcastType:()=>mn.x8,util:()=>ft,valueAndGrad:()=>Zt.h7,valueAndGrads:()=>Zt.fN,variable:()=>wa,variableGrads:()=>Zt.pn,version_core:()=>Ct,where:()=>ka.a,whereAsync:()=>Sa,zeros:()=>Ca.l,zerosLike:()=>Jt.P});var r={};n.r(r),n.d(r,{isBrowser:()=>b,isMobile:()=>v,mockIsMobile:()=>y});var i={};n.r(i),n.d(i,{browserFiles:()=>De,browserHTTPRequest:()=>Le,concatenateArrayBuffers:()=>T,copyModel:()=>ye,decodeWeights:()=>I,encodeWeights:()=>F,fromMemory:()=>Ue,getLoadHandlers:()=>W,getModelArtifactsForJSON:()=>R,getModelArtifactsInfoForJSON:()=>B,getSaveHandlers:()=>U,http:()=>ze,isHTTPScheme:()=>Re,listModels:()=>ge,loadWeights:()=>Te,moveModel:()=>ve,registerLoadRouter:()=>j,registerSaveRouter:()=>P,removeModel:()=>me,weightsLoaderFactory:()=>Oe,withSaveHandler:()=>We});var a={};n.r(a),n.d(a,{confusionMatrix:()=>Xe});var s={};n.r(s),n.d(s,{fromPixels:()=>rt,fromPixelsAsync:()=>tt,toPixels:()=>nt});var o={};n.r(o),n.d(o,{prepareAndValidate:()=>it});var u={};n.r(u),n.d(u,{calculateShapes:()=>ot,validateInput:()=>st,validateUpdateShape:()=>at});var l={};n.r(l),n.d(l,{Serializable:()=>lt,SerializationMap:()=>ct,registerClass:()=>dt});var c={};n.r(c),n.d(c,{TEST_EPSILON_FLOAT16:()=>pt,encodeStrings:()=>St,expectArrayBuffersEqual:()=>_t,expectArraysClose:()=>gt,expectArraysEqual:()=>bt,expectNumbersClose:()=>xt,expectPromiseToFail:()=>vt,expectValuesInRange:()=>kt,testEpsilon:()=>mt});var d={};n.r(d),n.d(d,{conv2d:()=>Ua,depthwiseConv2d:()=>Ga,matMul:()=>qa});var h={};n.r(h),n.d(h,{collectGatherOpShapeInfo:()=>Vo,computeOutShape:()=>Wo,segOpComputeOptimalWindowSize:()=>Uo});var f={};n.r(f),n.d(f,{ERF_A1:()=>oo,ERF_A2:()=>uo,ERF_A3:()=>lo,ERF_A4:()=>co,ERF_A5:()=>ho,ERF_P:()=>so,PARALLELIZE_THRESHOLD:()=>Qs,SELU_SCALE:()=>ao.$,SELU_SCALEALPHA:()=>ao.y,applyActivation:()=>Pa,assertAndGetBroadcastShape:()=>Ke.assertAndGetBroadcastShape,assertAxesAreInnerMostDims:()=>ii.lB,assertParamsConsistent:()=>Ks,assignToTypedArray:()=>bo,axesAreInnerMostDims:()=>ii.YB,calculateShapes:()=>ot,checkEinsumDimSizes:()=>Co,checkPadOnDimRoundingMode:()=>Dn.m,combineLocations:()=>ii.Vh,complexWithEvenIndex:()=>mo,complexWithOddIndex:()=>yo,computeConv2DInfo:()=>Dn.Ix,computeConv3DInfo:()=>Dn.jw,computeDefaultPad:()=>Dn.aO,computeDilation2DInfo:()=>Dn.Rf,computeOptimalWindowSize:()=>Js,computeOutAndReduceShapes:()=>ii.kz,computeOutShape:()=>Ys,computePool2DInfo:()=>Dn.Xw,computePool3DInfo:()=>Dn.pl,convertConv2DDataFormat:()=>Dn.sl,decodeEinsumEquation:()=>_o,eitherStridesOrDilationsAreOne:()=>Dn.jT,expandShapeToKeepDim:()=>ii.rv,exponent:()=>wo,exponents:()=>xo,fromStringArrayToUint8:()=>qo,fromUint8ToStringArray:()=>Go,getAxesPermutation:()=>ii.Q3,getBroadcastDims:()=>Ke.getBroadcastDims,getComplexWithIndex:()=>vo,getEinsumComputePath:()=>Ao,getEinsumPermutation:()=>So,getFusedBiasGradient:()=>La,getFusedDyActivation:()=>za,getImageCenter:()=>Zs,getInnerMostAxes:()=>ii.sY,getPermuted:()=>to,getReductionAxes:()=>Ke.getReductionAxes,getReshaped:()=>eo,getReshapedPermuted:()=>no,getSliceBeginCoords:()=>ro,getSliceSize:()=>io,getSparseFillEmptyRowsIndicesDenseShapeMismatch:()=>Do,getSparseFillEmptyRowsNegativeIndexErrorMessage:()=>No,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:()=>$o,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:()=>Mo,getSparseReshapeInputOutputMismatchErrorMessage:()=>Bo,getSparseReshapeInputOutputMultipleErrorMessage:()=>Ro,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:()=>To,getSparseReshapeNegativeOutputDimErrorMessage:()=>Oo,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:()=>jo,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:()=>zo,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:()=>Lo,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:()=>Po,getUndoAxesPermutation:()=>ii.LJ,isIdentityPermutation:()=>Eo,log:()=>fo.c,mergeRealAndImagArrays:()=>po,prepareAndValidate:()=>it,prepareSplitSize:()=>Io,segment_util:()=>h,shouldFuse:()=>ja,slice_util:()=>ut,splitRealAndImagArrays:()=>go,tupleValuesAreOne:()=>Dn.I0,upcastType:()=>mn.x8,validateInput:()=>st,validateUpdateShape:()=>at,warn:()=>fo.Z});var p={};n.r(p),n.d(p,{nonMaxSuppressionV3Impl:()=>as,nonMaxSuppressionV4Impl:()=>ss,nonMaxSuppressionV5Impl:()=>os,whereImpl:()=>_a});var g=n(97097);let m;function y(e){m=e}function v(e){if(void 0!==m)return m;if(e||"undefined"!=typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;const t=e.userAgent||e.vendor||("undefined"!=typeof window?window.opera:"");if(!t){const t=e;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function b(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var x=n(22885);const w=(0,x.OB)();w.registerFlag("DEBUG",(()=>!1),(e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),w.registerFlag("IS_BROWSER",(()=>b())),w.registerFlag("IS_NODE",(()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node)),w.registerFlag("IS_CHROME",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),w.registerFlag("PROD",(()=>!1)),w.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>w.getBool("DEBUG"))),w.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),w.registerFlag("IS_TEST",(()=>!1)),w.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>!0)),w.registerFlag("WRAP_TO_IMAGEBITMAP",(()=>!1)),w.registerFlag("ENGINE_COMPILE_ONLY",(()=>!1));var k=n(61661),_=n(43740),S=n(57852);function C(e,t,n){const r=(0,_.C)(e,n);return(0,S.H)(e,t,r,n)}var A=n(20569);const E={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};async function F(e,t){const n=[],r=[],i=Array.isArray(e)?e.map((e=>e.name)):Object.keys(e);for(let a=0;a<i.length;++a){const s=i[a],o=Array.isArray(e)?e[a].tensor:e[s];if("float32"!==o.dtype&&"int32"!==o.dtype&&"bool"!==o.dtype&&"string"!==o.dtype&&"complex64"!==o.dtype)throw new Error(`Unsupported dtype in weight '${s}': ${o.dtype}`);const u={name:s,shape:o.shape,dtype:o.dtype};if("string"===o.dtype){const e=new Promise((async e=>{const t=await o.bytes(),n=t.reduce(((e,t)=>e+t.length),0)+4*t.length,r=new Uint8Array(n);let i=0;for(let e=0;e<t.length;e++){const n=t[e],a=new Uint8Array(new Uint32Array([n.length]).buffer);r.set(a,i),i+=4,r.set(n,i),i+=n.length}e(r)}));r.push(e)}else r.push(o.data());null!=t&&(u.group=t),n.push(u)}return{data:D(await Promise.all(r)),specs:n}}function I(e,t){const n={};let r,i=0;for(const a of t){const t=a.name,s=a.dtype,o=a.shape,u=(0,A.NA)(o);let l;if("quantization"in a){const n=a.quantization;if("uint8"===n.dtype||"uint16"===n.dtype){if(!("min"in n)||!("scale"in n))throw new Error(`Weight ${a.name} with quantization ${n.dtype} doesn't have corresponding metadata min and scale.`)}else{if("float16"!==n.dtype)throw new Error(`Weight ${a.name} has unknown quantization dtype ${n.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if("float32"!==s)throw new Error(`Weight ${a.name} is quantized with ${n.dtype} which only supports weights of type float32 not ${s}.`)}const o=E[n.dtype],c=e.slice(i,i+u*o),d="uint8"===n.dtype?new Uint8Array(c):new Uint16Array(c);if("float32"===s)if("uint8"===n.dtype||"uint16"===n.dtype){l=new Float32Array(d.length);for(let e=0;e<d.length;e++){const t=d[e];l[e]=t*n.scale+n.min}}else{if("float16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type float32.`);void 0===r&&(r=z()),l=r(d)}else{if("int32"!==s)throw new Error(`Unsupported dtype in weight '${t}': ${s}`);if("uint8"!==n.dtype&&"uint16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type int32.`);l=new Int32Array(d.length);for(let e=0;e<d.length;e++){const t=d[e];l[e]=Math.round(t*n.scale+n.min)}}i+=u*o}else if("string"===s){const t=(0,A.NA)(a.shape);l=[];for(let n=0;n<t;n++){const t=new Uint32Array(e.slice(i,i+4))[0];i+=4;const n=new Uint8Array(e.slice(i,i+t));l.push(n),i+=t}}else{const r=E[s],a=e.slice(i,i+u*r);if("float32"===s)l=new Float32Array(a);else if("int32"===s)l=new Int32Array(a);else if("bool"===s)l=new Uint8Array(a);else{if("complex64"!==s)throw new Error(`Unsupported dtype in weight '${t}': ${s}`);{l=new Float32Array(a);const e=new Float32Array(l.length/2),r=new Float32Array(l.length/2);for(let t=0;t<e.length;t++)e[t]=l[2*t],r[t]=l[2*t+1];const i=C(e,o,"float32"),s=C(r,o,"float32");n[t]=(0,k.P)(i,s),i.dispose(),s.dispose()}}i+=u*r}"complex64"!==s&&(n[t]=C(l,o,s))}return n}function D(e){if(null===e)throw new Error(`Invalid input value: ${JSON.stringify(e)}`);let t=0;const n=[];e.forEach((e=>{if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${e.constructor.name}`)}));const r=new Uint8Array(t);let i=0;return n.forEach((e=>{r.set(new Uint8Array(e.buffer),i),i+=e.byteLength})),r.buffer}const N="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function $(e){return N?Buffer.byteLength(e):new Blob([e]).size}function T(e){if(1===e.length)return e[0];let t=0;e.forEach((e=>{t+=e.byteLength}));const n=new Uint8Array(t);let r=0;return e.forEach((e=>{n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function O(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);const t=e.split("/");return t[t.length-1]}function M(e,t){const n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}async function R(e,t){const n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),null!=e.weightsManifest){const[r,i]=await t(e.weightsManifest);n.weightSpecs=r,n.weightData=i}return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),n}function B(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:$(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:$(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function z(){const e=function(){const e=e=>{let t=e<<13,n=0;for(;0==(8388608&t);)n-=8388608,t<<=1;return t&=-8388609,n+=947912704,t|n},t=new Uint32Array(2048);t[0]=0;for(let n=1;n<1024;n++)t[n]=e(n);for(let e=1024;e<2048;e++)t[e]=939524096+(e-1024<<13);return t}(),t=function(){const e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(let t=1;t<31;t++)e[t]=t<<23;for(let t=33;t<63;t++)e[t]=2147483648+(t-32<<23);return e}(),n=function(){const e=new Uint32Array(64);for(let t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return r=>{const i=new ArrayBuffer(4*r.length),a=new Uint32Array(i);for(let i=0;i<r.length;i++){const s=r[i],o=e[n[s>>10]+(1023&s)]+t[s>>10];a[i]=o}return new Float32Array(i)}}class L{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==L.instance&&(L.instance=new L),L.instance}static registerSaveRouter(e){L.getInstance().saveRouters.push(e)}static registerLoadRouter(e){L.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return L.getHandlers(e,"save")}static getLoadHandlers(e,t){return L.getHandlers(e,"load",t)}static getHandlers(e,t,n){const r=[];return("load"===t?L.getInstance().loadRouters:L.getInstance().saveRouters).forEach((t=>{const i=t(e,n);null!==i&&r.push(i)})),r}}const P=e=>L.registerSaveRouter(e),j=e=>L.registerLoadRouter(e),U=e=>L.getSaveHandlers(e),W=(e,t)=>L.getLoadHandlers(e,t),V="tensorflowjs",G="models_store",q="model_info_store";function H(){if(!(0,x.OB)().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const e="undefined"==typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function X(e){const t=e.result;t.createObjectStore(G,{keyPath:"modelPath"}),t.createObjectStore(q,{keyPath:"modelPath"})}class K{constructor(e){if(this.indexedDB=H(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise(((e,n)=>{const r=this.indexedDB.open(V,1);r.onupgradeneeded=()=>X(r),r.onsuccess=()=>{const i=r.result;if(null==t){const t=i.transaction(G,"readonly"),r=t.objectStore(G).get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return i.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));e(r.result.modelArtifacts)},r.onerror=e=>(i.close(),n(r.error)),t.oncomplete=()=>i.close()}else{const r=B(t),a=i.transaction(q,"readwrite");let s=a.objectStore(q);const o=s.put({modelPath:this.modelPath,modelArtifactsInfo:r});let u;o.onsuccess=()=>{u=i.transaction(G,"readwrite");const o=u.objectStore(G).put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:r});o.onsuccess=()=>e({modelArtifactsInfo:r}),o.onerror=e=>{s=a.objectStore(q);const t=s.delete(this.modelPath);t.onsuccess=()=>(i.close(),n(o.error)),t.onerror=e=>(i.close(),n(o.error))}},o.onerror=e=>(i.close(),n(o.error)),a.oncomplete=()=>{null==u?i.close():u.oncomplete=()=>i.close()}}},r.onerror=e=>n(r.error)}))}}K.URL_SCHEME="indexeddb://";const Y=e=>{return(0,x.OB)().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(K.URL_SCHEME)?(t=e.slice(K.URL_SCHEME.length),new K(t)):null;var t};L.registerSaveRouter(Y),L.registerLoadRouter(Y);class Q{constructor(){this.indexedDB=H()}async listModels(){return new Promise(((e,t)=>{const n=this.indexedDB.open(V,1);n.onupgradeneeded=()=>X(n),n.onsuccess=()=>{const r=n.result,i=r.transaction(q,"readonly"),a=i.objectStore(q).getAll();a.onsuccess=()=>{const t={};for(const e of a.result)t[e.modelPath]=e.modelArtifactsInfo;e(t)},a.onerror=e=>(r.close(),t(a.error)),i.oncomplete=()=>r.close()},n.onerror=e=>t(n.error)}))}async removeModel(e){var t;return e=(t=e).startsWith(K.URL_SCHEME)?t.slice(K.URL_SCHEME.length):t,new Promise(((t,n)=>{const r=this.indexedDB.open(V,1);r.onupgradeneeded=()=>X(r),r.onsuccess=()=>{const i=r.result,a=i.transaction(q,"readwrite"),s=a.objectStore(q),o=s.get(e);let u;o.onsuccess=()=>{if(null==o.result)return i.close(),n(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const r=s.delete(e),a=()=>{u=i.transaction(G,"readwrite");const r=u.objectStore(G).delete(e);r.onsuccess=()=>t(o.result.modelArtifactsInfo),r.onerror=e=>n(o.error)};r.onsuccess=a,r.onerror=e=>(a(),i.close(),n(o.error))}},o.onerror=e=>(i.close(),n(o.error)),a.oncomplete=()=>{null==u?i.close():u.oncomplete=()=>i.close()}},r.onerror=e=>n(r.error)}))}}const J="/",Z="tensorflowjs_models",ee="info",te="model_topology",ne="weight_specs",re="weight_data",ie="model_metadata";function ae(e){return{info:[Z,e,ee].join(J),topology:[Z,e,te].join(J),weightSpecs:[Z,e,ne].join(J),weightData:[Z,e,re].join(J),modelMetadata:[Z,e,ie].join(J)}}function se(e){for(const t of Object.values(e))window.localStorage.removeItem(t)}function oe(e){const t=e.split(J);if(t.length<3)throw new Error(`Invalid key format: ${e}`);return t.slice(1,t.length-1).join(J)}class ue{constructor(e){if(!(0,x.OB)().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=ae(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=B(e);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){if(N)return Buffer.from(e).toString("base64");const t=new Uint8Array(e);let n="";for(let e=0,r=t.length;e<r;e++)n+=String.fromCharCode(t[e]);return btoa(n)}(e.weightData));const i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:null!=e.signature?e.signature:void 0,userDefinedMetadata:null!=e.userDefinedMetadata?e.userDefinedMetadata:void 0,modelInitializer:null!=e.modelInitializer?e.modelInitializer:void 0,trainingConfig:null!=e.trainingConfig?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:r}}catch(e){throw se(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(null==e)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(null!=i){const e=JSON.parse(i);t.format=e.format,t.generatedBy=e.generatedBy,t.convertedBy=e.convertedBy,null!=e.signature&&(t.signature=e.signature),null!=e.userDefinedMetadata&&(t.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(t.modelInitializer=e.modelInitializer),null!=e.trainingConfig&&(t.trainingConfig=e.trainingConfig)}const a=this.LS.getItem(this.keys.weightData);if(null==a)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=function(e){if(N){const t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n.set([t.charCodeAt(e)],e);return n.buffer}(a),t}}ue.URL_SCHEME="localstorage://";const le=e=>{return(0,x.OB)().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(ue.URL_SCHEME)?(t=e.slice(ue.URL_SCHEME.length),new ue(t)):null;var t};L.registerSaveRouter(le),L.registerLoadRouter(le);class ce{constructor(){(0,A.hu)((0,x.OB)().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),(0,A.hu)("undefined"==typeof window||void 0!==window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const e={},t=Z+J,n=J+ee;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);i.startsWith(t)&&i.endsWith(n)&&(e[oe(i)]=JSON.parse(this.LS.getItem(i)))}return e}async removeModel(e){var t;const n=ae(e=(t=e).startsWith(ue.URL_SCHEME)?t.slice(ue.URL_SCHEME.length):t);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${e}'`);const r=JSON.parse(this.LS.getItem(n.info));return se(n),r}}const de="://";class he{constructor(){this.managers={}}static getInstance(){return null==he.instance&&(he.instance=new he),he.instance}static registerManager(e,t){(0,A.hu)(null!=e,(()=>"scheme must not be undefined or null.")),e.endsWith(de)&&(e=e.slice(0,e.indexOf(de))),(0,A.hu)(e.length>0,(()=>"scheme must not be an empty string."));const n=he.getInstance();(0,A.hu)(null==n.managers[e],(()=>`A model store manager is already registered for scheme '${e}'.`)),n.managers[e]=t}static getManager(e){const t=this.getInstance().managers[e];if(null==t)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(this.getInstance().managers)}}function fe(e){if(-1===e.indexOf(de))throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${he.getSchemes().join(",")}`);return{scheme:e.split(de)[0],path:e.split(de)[1]}}async function pe(e,t,n=!1){(0,A.hu)(e!==t,(()=>`Old path and new path are the same: '${e}'`));const r=L.getLoadHandlers(e);(0,A.hu)(r.length>0,(()=>`Copying failed because no load handler is found for source URL ${e}.`)),(0,A.hu)(r.length<2,(()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${e}.`));const i=r[0],a=L.getSaveHandlers(t);(0,A.hu)(a.length>0,(()=>`Copying failed because no save handler is found for destination URL ${t}.`)),(0,A.hu)(a.length<2,(()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${t}.`));const s=a[0],o=fe(e).scheme,u=fe(e).path,l=o===fe(e).scheme,c=await i.load();n&&l&&await he.getManager(o).removeModel(u);const d=await s.save(c);return n&&!l&&await he.getManager(o).removeModel(u),d.modelArtifactsInfo}async function ge(){const e=he.getSchemes(),t={};for(const n of e){const e=await he.getManager(n).listModels();for(const r in e)t[n+de+r]=e[r]}return t}async function me(e){const t=fe(e);return he.getManager(t.scheme).removeModel(t.path)}async function ye(e,t){return pe(e,t,!1)}async function ve(e,t){return pe(e,t,!0)}class be{fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}}if((0,x.OB)().get("IS_BROWSER")){(0,x.OB)().setPlatform("browser",new be);try{he.registerManager(ue.URL_SCHEME,new ce)}catch(e){}try{he.registerManager(K.URL_SCHEME,new Q)}catch(e){}}let xe;(0,x.OB)().get("IS_NODE")&&!(0,x.OB)().get("IS_BROWSER")&&(0,x.OB)().setPlatform("node",new class{constructor(){this.util=n(48628),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return null!=(0,x.OB)().global.fetch?(0,x.OB)().global.fetch(e,t):(null==xe&&(xe=n(75410)),xe(e,t))}now(){const e=process.hrtime();return 1e3*e[0]+e[1]/1e6}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}});var we=n(4077);function ke(e,t="float32",n){return t=t||"float32",A.Mu(e),new we.YD(e,t,n)}var _e=n(62271),Se=n(8723);function Ce(e,t=!1){console.log(e.toString(t))}(0,g.wv)();const Ae={buffer:ke,cast:_e.p,clone:Se.d,print:Ce};function Ee(e){return new Promise((e=>setTimeout(e))).then(e)}(0,we.Vp)(Ae);class Fe{constructor(e){if(!(0,x.OB)().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(Fe.URL_SCHEME)&&(e=e.slice(Fe.URL_SCHEME.length)),null!=e&&0!==e.length||(e="model"),this.modelJsonFileName=e+".json",this.weightDataFileName=e+".weights.bin"}async save(e){if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const n=M(e,[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}]),r=window.URL.createObjectURL(new Blob([JSON.stringify(n)],{type:"application/json"})),i=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor;if(i.download=this.modelJsonFileName,i.href=r,await Ee((()=>i.dispatchEvent(new MouseEvent("click")))),null!=e.weightData){const e=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;e.download=this.weightDataFileName,e.href=t,await Ee((()=>e.dispatchEvent(new MouseEvent("click"))))}return{modelArtifactsInfo:B(e)}}}}Fe.URL_SCHEME="downloads://";class Ie{constructor(e){if(null==e||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise(((e,t)=>{const n=new FileReader;n.onload=n=>{const r=JSON.parse(n.target.result),i=r.modelTopology;if(null==i)return void t(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));if(null==r.weightsManifest)return void t(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));if(0===this.weightsFiles.length)return void e({modelTopology:i});const a=R(r,(e=>this.loadWeights(e)));e(a)},n.onerror=e=>t(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),n.readAsText(this.jsonFile)}))}loadWeights(e){const t=[],n=[];for(const r of e)t.push(...r.weights),n.push(...r.paths);const r=this.checkManifestAndWeightFiles(e),i=n.map((e=>this.loadWeightsFile(e,r[e])));return Promise.all(i).then((e=>[t,T(e)]))}loadWeightsFile(e,t){return new Promise(((n,r)=>{const i=new FileReader;i.onload=e=>{const t=e.target.result;n(t)},i.onerror=t=>r(`Failed to weights data from file of path '${e}'.`),i.readAsArrayBuffer(t)}))}checkManifestAndWeightFiles(e){const t=[],n=this.weightsFiles.map((e=>O(e.name))),r={};for(const i of e)i.paths.forEach((e=>{const i=O(e);if(-1!==t.indexOf(i))throw new Error(`Duplicate file basename found in weights manifest: '${i}'`);if(t.push(i),-1===n.indexOf(i))throw new Error(`Weight file with basename '${i}' is not provided.`);r[e]=this.weightsFiles[n.indexOf(i)]}));if(t.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${t.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}}function De(e){return new Ie(e)}function Ne(e,t,n,r){!function(e){(0,A.hu)(null!=e&&Array.isArray(e)&&e.length>0,(()=>"promises must be a none empty array"))}(e),function(e,t){(0,A.hu)(e>=0&&e<=1,(()=>`Progress fraction must be in range [0, 1], but got startFraction ${e}`)),(0,A.hu)(t>=0&&t<=1,(()=>`Progress fraction must be in range [0, 1], but got endFraction ${t}`)),(0,A.hu)(t>=e,(()=>`startFraction must be no more than endFraction, but got startFraction ${e} and endFraction ${t}`))}(n=null==n?0:n,r=null==r?1:r);let i=0;return Promise.all(e.map((a=>(a.then((a=>{const s=n+ ++i/e.length*(r-n);return t(s),a})),a))))}async function $e(e,t){null==t&&(t={});const n=null==t.fetchFunc?(0,x.OB)().platform.fetch:t.fetchFunc,r=e.map((e=>n(e,t.requestInit,{isBinary:!0}))),i=(null==t.onProgress?await Promise.all(r):await Ne(r,t.onProgress,0,.5)).map((e=>e.arrayBuffer()));return null==t.onProgress?await Promise.all(i):await Ne(i,t.onProgress,.5,1)}async function Te(e,t="",n,r){return Oe((e=>$e(e,{requestInit:r})))(e,t,n)}function Oe(e){return async(t,n="",r)=>{const i=t.map((()=>!1)),a={},s=null!=r?r.map((()=>!1)):[],o=[];if(t.forEach(((e,t)=>{let n=0;e.weights.forEach((e=>{const u="quantization"in e?e.quantization.dtype:e.dtype,l=E[u]*A.NA(e.shape),c=()=>{i[t]=!0,null==a[t]&&(a[t]=[]),a[t].push({manifestEntry:e,groupOffset:n,sizeBytes:l})};null!=r?r.forEach(((t,n)=>{t===e.name&&(c(),s[n]=!0)})):c(),o.push(e.name),n+=l}))})),!s.every((e=>e))){const e=r.filter(((e,t)=>!s[t]));throw new Error(`Could not find weights in manifest with names: ${e.join(", ")}. \nManifest JSON has weights with names: ${o.join(", ")}.`)}const u=i.reduce(((e,t,n)=>(t&&e.push(n),e)),[]),l=[];u.forEach((e=>{t[e].paths.forEach((e=>{const t=n+(n.endsWith("/")?"":"/")+e;l.push(t)}))}));const c=await e(l),d={};let h=0;return u.forEach((e=>{const n=t[e].paths.length;let r=0;for(let e=0;e<n;e++)r+=c[h+e].byteLength;const i=new ArrayBuffer(r),s=new Uint8Array(i);let o=0;for(let e=0;e<n;e++){const t=new Uint8Array(c[h+e]);s.set(t,o),o+=t.byteLength}a[e].forEach((e=>{const t=I(i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(const e in t)d[e]=t[e]})),h+=n})),d}}L.registerSaveRouter((e=>(0,x.OB)().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Fe.URL_SCHEME)?function(e="model"){return new Fe(e)}(e.slice(Fe.URL_SCHEME.length)):null));class Me{constructor(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,null!=t.fetchFunc?((0,A.hu)("function"==typeof t.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=t.fetchFunc):this.fetch=(0,x.OB)().platform.fetch,(0,A.hu)(null!=e&&e.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(e)&&(0,A.hu)(2===e.length,(()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`)),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const n=M(e,[{paths:["./model.weights.bin"],weights:e.weightSpecs}]);t.body.append("model.json",new Blob([JSON.stringify(n)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin");const r=await this.fetch(this.path,t);if(r.ok)return{modelArtifactsInfo:B(e),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async load(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch(e){let t=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?t+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":t+=" Please make sure the server is serving valid JSON for this request.",new Error(t)}const n=t.modelTopology,r=t.weightsManifest;if(null==n&&null==r)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return R(t,(e=>this.loadWeights(e)))}async loadWeights(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(e){const t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),i=this.weightPathPrefix||n,a=[];for(const t of e)a.push(...t.weights);const s=[],o=[];for(const t of e)for(const e of t.paths)null!=this.weightUrlConverter?o.push(this.weightUrlConverter(e)):s.push(i+e+r);return this.weightUrlConverter&&s.push(...await Promise.all(o)),[a,T(await $e(s,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress}))]}}function Re(e){return null!=e.match(Me.URL_SCHEME_REGEX)}Me.URL_SCHEME_REGEX=/^https?:\/\//;const Be=(e,t)=>{if("undefined"==typeof fetch&&(null==t||null==t.fetchFunc))return null;{let n=!0;if(n=Array.isArray(e)?e.every((e=>Re(e))):Re(e),n)return ze(e,t)}return null};function ze(e,t){return new Me(e,t)}function Le(e,t){return ze(e,t)}L.registerSaveRouter(Be),L.registerLoadRouter(Be);class Pe{constructor(e){this.modelArtifacts=e}async load(){return this.modelArtifacts}}class je{constructor(e){this.saveHandler=e}async save(e){return this.saveHandler(e)}}function Ue(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new Pe(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Pe({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Pe({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}function We(e){return new je(e)}var Ve=n(28687),Ge=n(76708),qe=n(2668),He=n(89065);const Xe=(0,qe.op)({confusionMatrix_:function(e,t,n){const r=(0,_._1)(e,"labels","confusionMatrix"),i=(0,_._1)(t,"predictions","confusionMatrix");A.hu(null==n||n>0&&Number.isInteger(n),(()=>`If provided, numClasses must be a positive integer, but got ${n}`)),A.hu(1===r.rank,(()=>`Expected the rank of labels to be 1, but got ${r.rank}`)),A.hu(1===i.rank,(()=>`Expected the rank of predictions to be 1, but got ${i.rank}`)),A.hu(r.shape[0]===i.shape[0],(()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${i.shape[0]}. Labels and predictions should have the same number of elements.`)),A.hu(n>0&&Number.isInteger(n),(()=>`numClasses is required to be a positive integer, but got ${n}`));const a=(0,Ge.l)((0,_e.p)(r,"int32"),n),s=(0,Ge.l)((0,_e.p)(i,"int32"),n),o=(0,He.p)(a),u=(0,Ve.O)(o,s);return(0,_e.p)(u,"int32")}});var Ke=n(72200),Ye=n(29121),Qe=n(26151);function Je(e,t,n){if((0,A.Cq)(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");const r=(0,_.C)(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return(0,S.H)(e,t,r,n)}let Ze;function et(e,t=3){if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,i=!1,a=!1,s=!1,o=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)a=!0;else if(null!=e.getContext)s=!0;else{if(!("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap))throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${e.constructor.name}`);o=!0}if(i){const t=2;if(i&&e.readyState<t)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=(0,Qe.pI)(Ye.eB,g.BV.backendName)){const n={pixels:e},r={numChannels:t};return g.BV.runKernel(Ye.eB,n,r)}const[u,l]=i?[e.videoWidth,e.videoHeight]:[e.width,e.height];let c,d;if(s)c=e.getContext("2d").getImageData(0,0,u,l).data;else if(r||n)c=e.data;else if(a||i||o){if(null==Ze)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");Ze=new OffscreenCanvas(1,1).getContext("2d")}else Ze=document.createElement("canvas").getContext("2d");Ze.canvas.width=u,Ze.canvas.height=l,Ze.drawImage(e,0,0,u,l),c=Ze.getImageData(0,0,u,l).data}if(4===t)d=new Int32Array(c);else{const e=u*l;d=new Int32Array(e*t);for(let n=0;n<e;n++)for(let e=0;e<t;++e)d[n*t+e]=c[4*n+e]}return Je(d,[l,u,t],"int32")}async function tt(e,t=3){let n=null;if((0,x.OB)().getBool("WRAP_TO_IMAGEBITMAP")&&function(e){return"undefined"!=typeof window&&"undefined"!=typeof ImageBitmap&&window.hasOwnProperty("createImageBitmap")&&!(e instanceof ImageBitmap)&&function(e){return null!=e&&0!==e.width&&0!==e.height}(e)&&!function(e){return null!=e&&e.data instanceof Uint8Array}(e)}(e)){let t;try{t=await createImageBitmap(e,{premultiplyAlpha:"none"})}catch(e){t=null}n=null!=t&&t.width===e.width&&t.height===e.height?t:e}else n=e;return et(n,t)}async function nt(e,t){let n=(0,_._1)(e,"img","toPixels");if(!(e instanceof we.es)){const e=n;n=(0,_e.p)(e,"int32"),e.dispose()}if(2!==n.rank&&3!==n.rank)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const[r,i]=n.shape.slice(0,2),a=2===n.rank?1:n.shape[2];if(a>4||2===a)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${a}`);if("float32"!==n.dtype&&"int32"!==n.dtype)throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`);const s=await n.data(),o="float32"===n.dtype?255:1,u=new Uint8ClampedArray(i*r*4);for(let e=0;e<r*i;++e){const t=[0,0,0,255];for(let r=0;r<a;r++){const i=s[e*a+r];if("float32"===n.dtype){if(i<0||i>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${i}.`)}else if("int32"===n.dtype&&(i<0||i>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${i}.`);1===a?(t[0]=i*o,t[1]=i*o,t[2]=i*o):t[r]=i*o}const r=4*e;u[r+0]=Math.round(t[0]),u[r+1]=Math.round(t[1]),u[r+2]=Math.round(t[2]),u[r+3]=Math.round(t[3])}if(null!=t){t.width=i,t.height=r;const e=t.getContext("2d"),n=new ImageData(u,i,r);e.putImageData(n,0,0)}return n!==e&&n.dispose(),u}const rt=(0,qe.op)({fromPixels_:et});function it(e,t){const n=e.shape.length,r=t.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if("int32"!==t.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[r-1]} vs. ${n}`);if(0===(0,A.NA)(e.shape))throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${e.shape}.`);const i=t.shape,a=i[i.length-1];let s=1;for(let e=0;e<i.length-1;++e)s*=i[e];const o=e.shape,u=i.slice();u.pop();let l=1;for(let e=a;e<n;++e)l*=o[e],u.push(o[e]);const c=[...(0,A.e3)(e.shape).map((e=>e/l)),1].slice(0,a);return[u,s,l,c]}function at(e,t,n){const r=t.rank>1?t.shape[t.rank-1]:1,i=t.rank>1?t.rank-1:1,a=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${t.shape}, shape: ${e}, sliceDim: ${r}, and batchDim: ${i}.`;if(n.rank<i)throw new Error(a+` update.rank < ${i}. `);if(e.length<r+(n.rank-i))throw new Error(a+` Output shape length < ${r+(n.rank-i)}`);if(n.rank!==i+e.length-r)throw new Error(a+" update.rank != "+(i+e.length-r));for(let e=0;e<i;++e)if(n.shape[e]!==t.shape[e])throw new Error(a+` updates.shape[${e}] (${n.shape[e]}) != indices.shape[${e}] (${t.shape[e]}).`);for(let t=0;t<n.rank-i;++t)if(n.shape[t+i]!==e[t+r])throw new Error(a+` updates.shape[${t+i}] (${n.shape[t+i]}) != shape[${t+i}] (${e[t+i]})`)}function st(e,t,n){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${e.rank}.`);if("int32"!==t.dtype)throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===t.size)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(0===e.size)throw new Error(`Updates specified for empty output. updates shape: ${e.shape}`)}at(n,t,e)}function ot(e,t,n){const r=t.shape.length,i=r>1?t.shape[r-1]:1,a=n.length;let s=1;for(let e=i;e<a;++e)s*=n[e];const o=i<1?1:i;return{sliceRank:i,numUpdates:(0,A.NA)(t.shape)/o,sliceSize:s,strides:[...(0,A.e3)(n.slice(0,i)),1],outputSize:(0,A.NA)(n)}}var ut=n(37650);class lt{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class ct{constructor(){this.classNameMap={}}static getMap(){return null==ct.instance&&(ct.instance=new ct),ct.instance}static register(e){ct.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function dt(e){(0,A.hu)(null!=e.className,(()=>"Class being registered does not have the static className property defined.")),(0,A.hu)("string"==typeof e.className,(()=>"className is required to be a string, but got type "+typeof e.className)),(0,A.hu)(e.className.length>0,(()=>"Class being registered has an empty-string as its className, which is disallowed.")),ct.register(e)}var ht=n(80747),ft=n(79122);const pt=.1;function gt(e,t,n){return null==n&&(n=mt()),yt(e,t,((e,t)=>wt(e,t,n)))}function mt(){return 32===g.BV.backend.floatPrecision()?.001:pt}function yt(e,t,n){let r=!0;if(((0,A.fU)(e)||(0,A.fU)(t))&&(r=!1),(0,A.fU)(e)&&(0,A.fU)(t)&&(r=!0),r){const n=e.constructor.name,r=t.constructor.name;if(n!==r)throw new Error(`Arrays are of different type. Actual: ${n}. Expected: ${r}`)}if(Array.isArray(e)&&Array.isArray(t)){const n=(0,_.C)(e),r=(0,_.C)(t);if(!(0,A.cO)(n,r))throw new Error(`Arrays have different shapes. Actual: [${n}]. Expected: [${r}]`)}const i=(0,A.fU)(e)?e:(0,A.xH)(e),a=(0,A.fU)(t)?t:(0,A.xH)(t);if(i.length!==a.length)throw new Error(`Arrays have different lengths actual: ${i.length} vs expected: ${a.length}.\nActual:   ${i}.\nExpected: ${a}.`);for(let e=0;e<a.length;++e){const t=i[e],r=a[e];if(!n(t,r))throw new Error(`Arrays differ: actual[${e}] = ${t}, expected[${e}] = ${r}.\nActual:   ${i}.\nExpected: ${a}.`)}}function vt(e,t){e().then((()=>t.fail()),(()=>t()))}function bt(e,t){const n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return(0,A.HD)(e)||(0,A.HD)(e[0])||(0,A.HD)(t)||(0,A.HD)(t[0])?yt(e,n,((e,t)=>e==t)):yt(e,t,((e,t)=>wt(e,t,0)))}function xt(e,t,n){if(null==n&&(n=mt()),!wt(e,t,n))throw new Error(`Numbers differ: actual === ${e}, expected === ${t}`)}function wt(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}function kt(e,t,n){for(let r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error(`Value out of range:${e[r]} low: ${t}, high: ${n}`)}function _t(e,t){const n=new Float32Array(e),r=new Float32Array(t);if(n.length!==r.length)throw new Error(`Expected ArrayBuffer to be of length ${r.length}, but it was ${n.length}`);for(let e=0;e<r.length;e++)if(n[e]!==r[e])throw new Error(`Expected ArrayBuffer value at ${e} to be ${r[e]} but got ${n[e]} instead`)}function St(e){for(let t=0;t<e.length;t++){const n=e[t];Array.isArray(n)?St(n):e[t]=(0,ft.encodeString)(n)}return e}const Ct="3.15.0";function At(){(0,x.OB)().set("PROD",!0)}function Et(){(0,x.OB)().set("DEBUG",!0)}function Ft(){(0,x.OB)().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function It(e){(0,x.OB)().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Dt(){g.BV.disposeVariables()}function Nt(){return g.BV}function $t(){return g.BV.memory()}function Tt(e){return g.BV.profile(e)}function Ot(e,t){return g.BV.tidy(e,t)}function Mt(e){(0,ht.getTensorsInContainer)(e).forEach((e=>e.dispose()))}function Rt(e){return g.BV.keep(e)}function Bt(e){return g.BV.time(e)}function zt(e){return g.BV.setBackend(e)}function Lt(){return g.BV.ready()}function Pt(){return g.BV.backendName}function jt(e){g.BV.removeBackend(e)}function Ut(e){return g.BV.findBackend(e)}function Wt(e){return g.BV.findBackendFactory(e)}function Vt(e,t,n=1){return g.BV.registerBackend(e,t,n)}function Gt(){return g.BV.backend}function qt(e,t){(0,x.OB)().setPlatform(e,t)}(0,we.FZ)(It);var Ht=n(56407),Xt=n(41274),Kt=n(24841),Yt=n(13261),Qt=n(50248),Jt=n(29999),Zt=n(30633),en=n(99494);class tn extends lt{minimize(e,t=!1,n){const{value:r,grads:i}=this.computeGradients(e,n);if(null!=n){const e=n.map((e=>({name:e.name,tensor:i[e.name]})));this.applyGradients(e)}else this.applyGradients(i);return Mt(i),t?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return(0,Zt.pn)(e,t)}dispose(){null!=this.iterations_&&Mt(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:(0,en.i)(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(tn,Symbol.hasInstance,{value:e=>null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients});class nn extends tn{constructor(e,t,n=null){super(),this.learningRate=e,this.rho=t,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=g.BV.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const r=g.BV.registeredVariables[t];null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:`${t}/accum_grad`,variable:Ot((()=>(0,Jt.P)(r).variable(!1)))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:`${t}/accum_var`,variable:Ot((()=>(0,Jt.P)(r).variable(!1)))});const i=Array.isArray(e)?e[n].tensor:e[t];if(null==i)return;const a=this.accumulatedGrads[n].variable,s=this.accumulatedUpdates[n].variable;Ot((()=>{const e=(0,Ht.I)((0,Kt.d)(a,this.rho),(0,Kt.d)((0,Qt.h)(i),1-this.rho)),t=(0,Kt.d)((0,Xt.h)((0,Yt._)((0,Ht.I)(s,this.epsilon)),(0,Yt._)((0,Ht.I)(a,this.epsilon))),i),n=(0,Ht.I)((0,Kt.d)(s,this.rho),(0,Kt.d)((0,Qt.h)(t),1-this.rho));a.assign(e),s.assign(n);const o=(0,Ht.I)((0,Kt.d)(t,-this.learningRate),r);r.assign(o)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(Mt(this.accumulatedGrads.map((e=>e.variable))),Mt(this.accumulatedUpdates.map((e=>e.variable))))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){const t=(e=await this.extractIterations(e)).length/2;this.accumulatedGrads=e.slice(0,t).map((e=>({originalName:e.name,variable:e.tensor.variable(!1)}))),this.accumulatedUpdates=e.slice(t,2*t).map((e=>({originalName:e.name,variable:e.tensor.variable(!1)})))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}function rn(e,t,n){const r={shape:e,value:t,dtype:n};return g.BV.runKernel(Ye.de,{},r)}nn.className="Adadelta",dt(nn);class an extends tn{constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const r=g.BV.registeredVariables[t];if(null==this.accumulatedGrads[n]){const e=!1;this.accumulatedGrads[n]={originalName:`${t}/accumulator`,variable:Ot((()=>rn(r.shape,this.initialAccumulatorValue).variable(e)))}}const i=Array.isArray(e)?e[n].tensor:e[t];if(null==i)return;const a=this.accumulatedGrads[n].variable;Ot((()=>{const e=(0,Ht.I)(a,(0,Qt.h)(i));a.assign(e);const t=(0,Ht.I)((0,Kt.d)((0,Xt.h)(i,(0,Yt._)((0,Ht.I)(e,g.BV.backend.epsilon()))),-this.learningRate),r);r.assign(t)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&Mt(this.accumulatedGrads.map((e=>e.variable)))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e),this.accumulatedGrads=e.map((e=>({originalName:e.name,variable:e.tensor.variable(!1)})))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}an.className="Adagrad",dt(an);var sn=n(33453),on=n(70827);class un extends tn{constructor(e,t,n,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],Ot((()=>{this.accBeta1=(0,en.i)(t).variable(),this.accBeta2=(0,en.i)(n).variable()})),null==r&&(this.epsilon=g.BV.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map((e=>e.name)):Object.keys(e);Ot((()=>{const n=(0,on.l)(1,this.accBeta1),r=(0,on.l)(1,this.accBeta2);t.forEach(((t,i)=>{const a=g.BV.registeredVariables[t];null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:`${t}/m`,variable:Ot((()=>(0,Jt.P)(a).variable(!1)))}),null==this.accumulatedSecondMoment[i]&&(this.accumulatedSecondMoment[i]={originalName:`${t}/v`,variable:Ot((()=>(0,Jt.P)(a).variable(!1)))});const s=Array.isArray(e)?e[i].tensor:e[t];if(null==s)return;const o=this.accumulatedFirstMoment[i].variable,u=this.accumulatedSecondMoment[i].variable,l=(0,Ht.I)((0,Kt.d)(o,this.beta1),(0,Kt.d)(s,1-this.beta1)),c=(0,Ht.I)((0,Kt.d)(u,this.beta2),(0,Kt.d)((0,Qt.h)(s),1-this.beta2)),d=(0,Xt.h)(l,n),h=(0,Xt.h)(c,r);o.assign(l),u.assign(c);const f=(0,Ht.I)((0,Kt.d)((0,Xt.h)(d,(0,Ht.I)((0,Yt._)(h),this.epsilon)),-this.learningRate),a);a.assign(f)})),this.accBeta1.assign((0,Kt.d)(this.accBeta1,this.beta1)),this.accBeta2.assign((0,Kt.d)(this.accBeta2,this.beta2))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Mt(this.accumulatedFirstMoment.map((e=>e.variable))),null!=this.accumulatedSecondMoment&&Mt(this.accumulatedSecondMoment.map((e=>e.variable)))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e),Ot((()=>{this.accBeta1.assign((0,sn.s)(this.beta1,this.iterations_+1)),this.accBeta2.assign((0,sn.s)(this.beta2,this.iterations_+1))}));const t=e.length/2;this.accumulatedFirstMoment=e.slice(0,t).map((e=>({originalName:e.name,variable:e.tensor.variable(!1)}))),this.accumulatedSecondMoment=e.slice(t,2*t).map((e=>({originalName:e.name,variable:e.tensor.variable(!1)})))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}un.className="Adam",dt(un);var ln=n(96235),cn=n(80632);class dn extends tn{constructor(e,t,n,r=null,i=0){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],Ot((()=>{this.iteration=(0,en.i)(0).variable(),this.accBeta1=(0,en.i)(t).variable()})),null==r&&(this.epsilon=g.BV.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map((e=>e.name)):Object.keys(e);Ot((()=>{const n=(0,on.l)(1,this.accBeta1),r=(0,Xt.h)(-this.learningRate,(0,Ht.I)((0,Kt.d)(this.iteration,this.decay),1));t.forEach(((t,i)=>{const a=g.BV.registeredVariables[t];null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:`${t}/m`,variable:(0,Jt.P)(a).variable(!1)}),null==this.accumulatedWeightedInfNorm[i]&&(this.accumulatedWeightedInfNorm[i]={originalName:`${t}/v`,variable:(0,Jt.P)(a).variable(!1)});const s=Array.isArray(e)?e[i].tensor:e[t];if(null==s)return;const o=this.accumulatedFirstMoment[i].variable,u=this.accumulatedWeightedInfNorm[i].variable,l=(0,Ht.I)((0,Kt.d)(o,this.beta1),(0,Kt.d)(s,1-this.beta1)),c=(0,Kt.d)(u,this.beta2),d=(0,ln.W)(s),h=(0,cn.g)(c,d);o.assign(l),u.assign(h);const f=(0,Ht.I)((0,Kt.d)((0,Xt.h)(r,n),(0,Xt.h)(l,(0,Ht.I)(h,this.epsilon))),a);a.assign(f)})),this.iteration.assign((0,Ht.I)(this.iteration,1)),this.accBeta1.assign((0,Kt.d)(this.accBeta1,this.beta1))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Mt(this.accumulatedFirstMoment.map((e=>e.variable))),null!=this.accumulatedWeightedInfNorm&&Mt(this.accumulatedWeightedInfNorm.map((e=>e.variable)))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}dn.className="Adamax",dt(dn);class hn extends tn{constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const r=Array.isArray(e)?e[n].tensor:e[t];if(null==r)return;const i=g.BV.registeredVariables[t];Ot((()=>{const e=(0,Ht.I)((0,Kt.d)(this.c,r),i);i.assign(e)}))})),this.incrementIterations()}setLearningRate(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=Rt((0,en.i)(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(0!==(e=await this.extractIterations(e)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}hn.className="SGD",dt(hn);class fn extends hn{constructor(e,t,n=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=n,this.accumulations=[],this.m=(0,en.i)(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const r=g.BV.registeredVariables[t];if(null==this.accumulations[n]){const e=!1;this.accumulations[n]={originalName:`${t}/momentum`,variable:Ot((()=>(0,Jt.P)(r).variable(e)))}}const i=this.accumulations[n].variable,a=Array.isArray(e)?e[n].tensor:e[t];null!=a&&Ot((()=>{let e;const t=(0,Ht.I)((0,Kt.d)(this.m,i),a);e=this.useNesterov?(0,Ht.I)((0,Kt.d)(this.c,(0,Ht.I)(a,(0,Kt.d)(t,this.m))),r):(0,Ht.I)((0,Kt.d)(this.c,t),r),i.assign(t),r.assign(e)}))})),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&Mt(this.accumulations.map((e=>e.variable)))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e),this.accumulations=e.map((e=>({originalName:e.name,variable:e.tensor.variable(!1)})))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}fn.className="Momentum",dt(fn);class pn extends tn{constructor(e,t=.9,n=0,r=null,i=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,null==r&&(this.epsilon=g.BV.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const r=g.BV.registeredVariables[t],i=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:`${t}/rms`,variable:Ot((()=>(0,Jt.P)(r).variable(i)))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:`${t}/momentum`,variable:Ot((()=>(0,Jt.P)(r).variable(i)))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:`${t}/mg`,variable:Ot((()=>(0,Jt.P)(r).variable(i)))});const a=Array.isArray(e)?e[n].tensor:e[t];if(null==a)return;const s=this.accumulatedMeanSquares[n].variable,o=this.accumulatedMoments[n].variable;Ot((()=>{const e=(0,Ht.I)((0,Kt.d)(s,this.decay),(0,Kt.d)((0,Qt.h)(a),1-this.decay));if(this.centered){const t=this.accumulatedMeanGrads[n].variable,i=(0,Ht.I)((0,Kt.d)(t,this.decay),(0,Kt.d)(a,1-this.decay)),u=(0,Xt.h)((0,Kt.d)(a,this.learningRate),(0,Yt._)((0,on.l)(e,(0,Ht.I)((0,Qt.h)(i),this.epsilon)))),l=(0,Ht.I)((0,Kt.d)(o,this.momentum),u);s.assign(e),t.assign(i),o.assign(l);const c=(0,on.l)(r,l);r.assign(c)}else{const e=(0,Ht.I)((0,Kt.d)(s,this.decay),(0,Kt.d)((0,Qt.h)(a),1-this.decay)),t=(0,Ht.I)((0,Kt.d)(o,this.momentum),(0,Xt.h)((0,Kt.d)(a,this.learningRate),(0,Yt._)((0,Ht.I)(e,this.epsilon))));s.assign(e),o.assign(t);const n=(0,on.l)(r,t);r.assign(n)}}))})),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&Mt(this.accumulatedMeanSquares.map((e=>e.variable))),null!=this.accumulatedMeanGrads&&this.centered&&Mt(this.accumulatedMeanGrads.map((e=>e.variable))),null!=this.accumulatedMoments&&Mt(this.accumulatedMoments.map((e=>e.variable)))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,n=!1;this.accumulatedMeanSquares=e.slice(0,t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))),this.accumulatedMoments=e.slice(t,2*t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}pn.className="RMSProp",dt(pn);class gn{static sgd(e){return new hn(e)}static momentum(e,t,n=!1){return new fn(e,t,n)}static rmsprop(e,t=.9,n=0,r=null,i=!1){return new pn(e,t,n,r,i)}static adam(e=.001,t=.9,n=.999,r=null){return new un(e,t,n,r)}static adadelta(e=.001,t=.95,n=null){return new nn(e,t,n)}static adamax(e=.002,t=.9,n=.999,r=null,i=0){return new dn(e,t,n,r,i)}static adagrad(e,t=.1){return new an(e,t)}}var mn=n(71221),yn=n(17839),vn=n(91470);const bn=(0,qe.op)({addN_:function(e){A.hu(Array.isArray(e),(()=>"The argument passed to tf.addN() must be a list of tensors")),A.hu(e.length>=1,(()=>`Must pass at least one tensor to tf.addN(), but got ${e.length}`));const t=e.map(((e,t)=>(0,_._1)(e,`tensors${t}`,"addN"))),n=t[0];t.forEach((e=>{if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((e=>{if(!A.cO(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));const r=t;return g.BV.runKernel(Ye.Xz,r)}});var xn=n(90781),wn=n(92998),kn=n(40047),_n=n(27394),Sn=n(72421),Cn=n(21891),An=n(77037),En=n(29812),Fn=n(80369),In=n(15176),Dn=n(2582),Nn=n(4968);const $n=(0,qe.op)({avgPool3d_:function(e,t,n,r,i,a="NDHWC"){const s=(0,_._1)(e,"x","avgPool3d","float32");let o=s,u=!1;4===s.rank&&(u=!0,o=(0,Nn.X)(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),A.hu(5===o.rank,(()=>`Error in avgPool3d: x must be rank 5 but got rank ${o.rank}.`)),A.hu("NDHWC"===a,(()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${a}`)),(0,Dn.m)("avgPool3d",r,i);const l={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:i,dataFormat:a};let d=g.BV.runKernel(Ye._k,l,c);return d=(0,_e.p)(d,o.dtype),u?(0,Nn.X)(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});var Tn=n(46884),On=n(30625),Mn=n(22676),Rn=n(21869);const Bn=(0,qe.op)({basicLSTMCell_:function(e,t,n,r,i,a){const s=(0,_._1)(e,"forgetBias","basicLSTMCell"),o=(0,_._1)(t,"lstmKernel","basicLSTMCell"),u=(0,_._1)(n,"lstmBias","basicLSTMCell"),l=(0,_._1)(r,"data","basicLSTMCell"),c=(0,_._1)(i,"c","basicLSTMCell"),d=(0,_._1)(a,"h","basicLSTMCell"),h=(0,Tn.z)([l,d],1),f=(0,Ve.O)(h,o),p=(0,Ht.I)(f,u),g=p.shape[0],m=p.shape[1]/4,y=[g,m],v=(0,Mn.t)(p,[0,0],y),b=(0,Mn.t)(p,[0,m],y),x=(0,Mn.t)(p,[0,2*m],y),w=(0,Mn.t)(p,[0,3*m],y),k=(0,Ht.I)((0,Kt.d)((0,On.X)(v),(0,Rn.A)(b)),(0,Kt.d)(c,(0,On.X)((0,Ht.I)(s,x))));return[k,(0,Kt.d)((0,Rn.A)(k),(0,On.X)(w))]}});var zn=n(28441),Ln=n(27505);const Pn=(0,qe.op)({batchNorm2d_:function(e,t,n,r,i,a){const s=(0,_._1)(e,"x","batchNorm"),o=(0,_._1)(t,"mean","batchNorm"),u=(0,_._1)(n,"variance","batchNorm");let l,c;return null!=i&&(l=(0,_._1)(i,"scale","batchNorm")),null!=r&&(c=(0,_._1)(r,"offset","batchNorm")),A.hu(2===s.rank,(()=>`Error in batchNorm2D: x must be rank 2 but got rank ${s.rank}.`)),A.hu(2===o.rank||1===o.rank,(()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${o.rank}.`)),A.hu(2===u.rank||1===u.rank,(()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`)),null!=l&&A.hu(2===l.rank||1===l.rank,(()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${l.rank}.`)),null!=c&&A.hu(2===c.rank||1===c.rank,(()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`)),(0,Ln.t)(s,o,u,c,l,a)}}),jn=(0,qe.op)({batchNorm3d_:function(e,t,n,r,i,a){const s=(0,_._1)(e,"x","batchNorm"),o=(0,_._1)(t,"mean","batchNorm"),u=(0,_._1)(n,"variance","batchNorm");let l,c;return null!=i&&(l=(0,_._1)(i,"scale","batchNorm")),null!=r&&(c=(0,_._1)(r,"offset","batchNorm")),A.hu(3===s.rank,(()=>`Error in batchNorm3D: x must be rank 3 but got rank ${s.rank}.`)),A.hu(3===o.rank||1===o.rank,(()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${o.rank}.`)),A.hu(3===u.rank||1===u.rank,(()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`)),null!=l&&A.hu(3===l.rank||1===l.rank,(()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${l.rank}.`)),null!=c&&A.hu(3===c.rank||1===c.rank,(()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`)),(0,Ln.t)(s,o,u,c,l,a)}}),Un=(0,qe.op)({batchNorm4d_:function(e,t,n,r,i,a){const s=(0,_._1)(e,"x","batchNorm"),o=(0,_._1)(t,"mean","batchNorm"),u=(0,_._1)(n,"variance","batchNorm");let l,c;return null!=i&&(l=(0,_._1)(i,"scale","batchNorm")),null!=r&&(c=(0,_._1)(r,"offset","batchNorm")),A.hu(4===s.rank,(()=>`Error in batchNorm4D: x must be rank 4 but got rank ${s.rank}.`)),A.hu(4===o.rank||1===o.rank,(()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${o.rank}.`)),A.hu(4===u.rank||1===u.rank,(()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`)),null!=l&&A.hu(4===l.rank||1===l.rank,(()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${l.rank}.`)),null!=c&&A.hu(4===c.rank||1===c.rank,(()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`)),(0,Ln.t)(s,o,u,c,l,a)}}),Wn=(0,qe.op)({bincount_:function(e,t,n){const r=(0,_._1)(e,"x","bincount"),i=(0,_._1)(t,"weights","bincount");A.hu("int32"===r.dtype,(()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`)),A.hu(n>=0,(()=>`size must be non-negative, but got ${n}.`)),A.hu(i.size===r.size||0===i.size,(()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${i.shape}.`));const a={x:r,weights:i},s={size:n};return g.BV.runKernel(Ye.zv,a,s)}}),Vn=(0,qe.op)({broadcastArgs_:function(e,t){const n=(0,_._1)(e,"s0","broadcastArgs","int32"),r=(0,_._1)(t,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(1!==r.rank)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const i={s0:n,s1:r};return g.BV.runKernel(Ye.eE,i)}});var Gn=n(68247),qn=n(6825),Hn=n(42279);const Xn=(0,qe.op)({concat1d_:function(e){return(0,Tn.z)(e,0)}}),Kn=(0,qe.op)({concat2d_:function(e,t){return(0,Tn.z)(e,t)}}),Yn=(0,qe.op)({concat3d_:function(e,t){return(0,Tn.z)(e,t)}}),Qn=(0,qe.op)({concat4d_:function(e,t){return(0,Tn.z)(e,t)}});var Jn=n(11355),Zn=n(64794),er=n(71405);const tr=(0,qe.op)({conv3d_:function(e,t,n,r,i="NDHWC",a=[1,1,1]){const s=(0,_._1)(e,"x","conv3d"),o=(0,_._1)(t,"filter","conv3d");let u=s,l=!1;4===s.rank&&(l=!0,u=(0,Nn.X)(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),A.hu(5===u.rank,(()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`)),A.hu(5===o.rank,(()=>`Error in conv3d: filter must be rank 5, but got rank ${o.rank}.`)),A.hu(u.shape[4]===o.shape[3],(()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${o.shape[3]}.`)),A.hu((0,Dn.jT)(n,a),(()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`)),A.hu("NDHWC"===i,(()=>`Error in conv3d: got dataFormat of ${i} but only NDHWC is currently supported.`));const c={x:u,filter:o},d={strides:n,pad:r,dataFormat:i,dilations:a},h=g.BV.runKernel(Ye.x1,c,d);return l?(0,Nn.X)(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});var nr=n(97594);const rr=(0,qe.op)({conv3dTranspose_:function(e,t,n,r,i){const a=(0,_._1)(e,"x","conv3dTranspose"),s=(0,_._1)(t,"filter","conv3dTranspose");return(0,nr._)(n,a,s,r,i)}});var ir=n(70173),ar=n(2699),sr=n(9640),or=n(37405);const ur=(0,qe.op)({denseBincount_:function(e,t,n,r=!1){const i=(0,_._1)(e,"x","denseBincount"),a=(0,_._1)(t,"weights","denseBincount");A.hu("int32"===i.dtype,(()=>`Error in denseBincount: input dtype must be int32, but got ${i.dtype}`)),A.hu(i.rank<=2,(()=>`Error in denseBincount: input must be at most rank 2, but got rank ${i.rank}.`)),A.hu(n>=0,(()=>`size must be non-negative, but got ${n}.`)),A.hu(a.size===i.size||0===a.size,(()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${i.shape}, weights shape: ${a.shape}.`));const s={x:i,weights:a},o={size:n,binaryOutput:r};return g.BV.runKernel(Ye.QR,s,o)}});var lr=n(89112),cr=n(64718);const dr=(0,qe.op)({diag_:function(e){const t={x:(0,_._1)(e,"x","diag")};return g.BV.runKernel(Ye.$w,t)}});var hr=n(70557),fr=n(49322),pr=n(30548);const gr=(0,qe.op)({einsum_:function(e,...t){const n=t.map(((e,t)=>(0,_._1)(e,`tensors${t}`,"einsum"))),r={equation:e};return g.BV.runKernel(Ye.$g,n,r)}});var mr=n(83233),yr=n(26477),vr=n(34650),br=n(44842),xr=n(81300),wr=n(53426),kr=n(47501);const _r=(0,qe.op)({eye_:function(e,t,n,r="float32"){null==t&&(t=e);const i=ke([e,t],r),a=e<=t?e:t;for(let e=0;e<a;++e)i.set(1,e,e);const s=(0,Nn.X)(i.toTensor(),[e,t]);if(null==n)return s;if(1===n.length)return(0,kr.G)((0,xr.d)(s,0),[n[0],1,1]);if(2===n.length)return(0,kr.G)((0,xr.d)((0,xr.d)(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return(0,kr.G)((0,xr.d)((0,xr.d)((0,xr.d)(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}});var Sr=n(26943),Cr=n(9165),Ar=n(24926),Er=n(20636),Fr=n(17630),Ir=n(64386),Dr=n(13963),Nr=n(4365),$r=n(96230),Tr=n(99133),Or=n(86573),Mr=n(50624);function Rr(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:e,stop:t,num:n};return g.BV.runKernel(Ye.e7,{},r)}var Br=n(79648),zr=n(82597),Lr=n(17474),Pr=n(13888),jr=n(31510),Ur=n(11391),Wr=n(2856),Vr=n(38651),Gr=n(15750),qr=n(10596),Hr=n(83307),Xr=n(21174);const Kr=(0,qe.op)({maxPool3d_:function(e,t=[1,1,1],n,r,i,a="NDHWC"){const s=(0,_._1)(e,"x","maxPool3d");let o=s,u=!1;4===s.rank&&(u=!0,o=(0,Nn.X)(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),A.hu(5===o.rank,(()=>`Error in maxPool3d: x must be rank 5 but got rank ${o.rank}.`)),A.hu("NDHWC"===a,(()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${a}`)),(0,Dn.m)("maxPool3d",r,i);const l={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:i,dataFormat:a},d=g.BV.runKernel(Ye.OA,l,c);return u?(0,Nn.X)(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}}),Yr=(0,qe.op)({maxPoolWithArgmax_:function(e,t,n,r,i=!1){const a={x:(0,_._1)(e,"x","maxPoolWithArgmax")},s={filterSize:t,strides:n,pad:r,includeBatchInIndex:i},o=g.BV.runKernel(Ye.vF,a,s);return{result:o[0],indexes:o[1]}}});var Qr=n(75130),Jr=n(44917);function Zr(e,t,{indexing:n="xy"}={}){if("xy"!==n&&"ij"!==n)throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(void 0===e)return[];let r=(0,_._1)(e,"x","meshgrid",e instanceof we.es?e.dtype:"float32");if(void 0===t)return[r];let i=(0,_._1)(t,"y","meshgrid",t instanceof we.es?t.dtype:"float32");const a=(0,A.NA)(r.shape),s=(0,A.NA)(i.shape);return"xy"===n?(r=(0,Nn.X)(r,[1,-1]),i=(0,Nn.X)(i,[-1,1]),[(0,Ve.O)((0,Jr.i)([s,1],r.dtype),r),(0,Ve.O)(i,(0,Jr.i)([1,a],i.dtype))]):(r=(0,Nn.X)(r,[-1,1]),i=(0,Nn.X)(i,[1,-1]),[(0,Ve.O)(r,(0,Jr.i)([1,s],r.dtype)),(0,Ve.O)((0,Jr.i)([a,1],i.dtype),i)])}var ei=n(25735),ti=n(24513),ni=n(71483),ri=n(85228),ii=n(83591);const ai=(0,qe.op)({moments_:function(e,t=null,n=!1){e=(0,_._1)(e,"x","moments");const r=(0,A.EC)(t,e.shape),i=(0,Qr.J)(e,r,n);let a=i.shape;n||(a=(0,ii.rv)(i.shape,r));const s=(0,Qt.h)((0,on.l)((0,_e.p)(e,"float32"),(0,Nn.X)(i,a)));return{mean:i,variance:(0,Qr.J)(s,r,n)}}}),si=(0,qe.op)({multiRNNCell_:function(e,t,n,r){const i=(0,_._1)(t,"data","multiRNNCell"),a=(0,_.sI)(n,"c","multiRNNCell"),s=(0,_.sI)(r,"h","multiRNNCell");let o=i;const u=[];for(let t=0;t<e.length;t++){const n=e[t](o,a[t],s[t]);u.push(n[0]),u.push(n[1]),o=n[1]}const l=[],c=[];for(let e=0;e<u.length;e+=2)l.push(u[e]),c.push(u[e+1]);return[l,c]}}),oi=(0,qe.op)({multinomial_:function(e,t,n,r=!1){const i=(0,_._1)(e,"logits","multinomial"),a=i.size,s=i.rank;if(a<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${a}.`);if(s>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${s}`);n=n||Math.random();const o={logits:1===s?(0,Nn.X)(i,[1,-1]):i},u={numSamples:t,seed:n,normalized:r},l=g.BV.runKernel(Ye.NZ,o,u);return 1===s?(0,Nn.X)(l,[l.size]):l}});var ui=n(17370),li=n(16500),ci=n(7846);const di=(0,qe.op)({outerProduct_:function(e,t){const n=(0,_._1)(e,"v1","outerProduct"),r=(0,_._1)(t,"v2","outerProduct");A.hu(1===n.rank&&1===r.rank,(()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`));const i=(0,Nn.X)(n,[-1,1]),a=(0,Nn.X)(r,[1,-1]);return(0,Ve.O)(i,a)}});var hi=n(39682);const fi=(0,qe.op)({pad1d_:function(e,t,n=0){return(0,A.hu)(2===t.length,(()=>"Invalid number of paddings. Must be length of 2.")),(0,hi.v)(e,[t],n)}}),pi=(0,qe.op)({pad2d_:function(e,t,n=0){return(0,A.hu)(2===t.length&&2===t[0].length&&2===t[1].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),(0,hi.v)(e,t,n)}}),gi=(0,qe.op)({pad3d_:function(e,t,n=0){return(0,A.hu)(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),(0,hi.v)(e,t,n)}}),mi=(0,qe.op)({pad4d_:function(e,t,n=0){return(0,A.hu)(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),(0,hi.v)(e,t,n)}});var yi=n(85860),vi=n(98151),bi=n(49451);const xi=(0,qe.op)({rand_:function(e,t,n){const r=(0,A.NA)(e);let i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error(`Unknown data type ${n}`);i=new Uint8Array(r)}for(let e=0;e<r;e++)i[e]=t();return g.BV.makeTensor(i,e,n)}});var wi=n(63129);class ki{constructor(e,t,n,r,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const a=i||Math.random();this.random=wi.alea(a.toString())}nextValue(){if(!isNaN(this.nextVal)){const e=this.nextVal;return this.nextVal=NaN,e}let e,t,n=!1;for(;!n;){let r,i,a;do{r=2*this.random()-1,i=2*this.random()-1,a=r*r+i*i}while(a>=1||0===a);const s=Math.sqrt(-2*Math.log(a)/a);e=this.mean+this.stdDev*r*s,t=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(e)||(n=!0)}return this.truncated&&!this.isValidTruncated(t)||(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class _i{constructor(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;const i=r||Math.random();this.randu=wi.alea(i.toString()),this.randn=new ki(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,t,n,r,i,a;for(;;){do{r=this.randn.nextValue(),a=1+this.c*r}while(a<=0);if(a*=a*a,e=r*r,t=1-.331*e*e,n=.5*e+this.d*(1-a+Math.log(a)),i=this.randu(),i<t||Math.log(i)<n)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)}convertValue(e){return"float32"===this.dtype?e:Math.round(e)}}class Si{constructor(e=0,t=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=wi.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}const Ci=(0,qe.op)({randomGamma_:function(e,t,n=1,r="float32",i){if(null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error(`Unsupported data type ${r}`);const a=new _i(t,n,r,i),s=ke(e,r);for(let e=0;e<s.values.length;e++)s.values[e]=a.nextValue();return s.toTensor()}}),Ai=(0,qe.op)({randomNormal_:function(e,t=0,n=1,r,i){if(null!=r&&"bool"===r)throw new Error(`Unsupported data type ${r}`);const a=new ki(t,n,r,!1,i),s=ke(e,r);for(let e=0;e<s.values.length;e++)s.values[e]=a.nextValue();return s.toTensor()}}),Ei=(0,qe.op)({randomUniform_:function(e,t=0,n=1,r="float32",i){const a=ke(e,r),s=new Si(t,n,null,i);for(let e=0;e<a.values.length;e++)a.values[e]=s.nextValue();return a.toTensor()}});function Fi(e,t,n=1,r="float32"){if(0===n)throw new Error("Cannot have a step of zero");const i={start:e,stop:t,step:n,dtype:r};return g.BV.runKernel(Ye.e6,{},i)}var Ii=n(60766),Di=n(19036),Ni=n(7409),$i=n(83582),Ti=n(57486);const Oi=(0,qe.op)({reverse1d_:function(e){const t=(0,_._1)(e,"x","reverse");return A.hu(1===t.rank,(()=>`Error in reverse1D: x must be rank 1 but got rank ${t.rank}.`)),(0,Ti.G)(t,0)}}),Mi=(0,qe.op)({reverse2d_:function(e,t){const n=(0,_._1)(e,"x","reverse");return A.hu(2===n.rank,(()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`)),(0,Ti.G)(n,t)}}),Ri=(0,qe.op)({reverse3d_:function(e,t){const n=(0,_._1)(e,"x","reverse");return A.hu(3===n.rank,(()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`)),(0,Ti.G)(n,t)}}),Bi=(0,qe.op)({reverse4d_:function(e,t){const n=(0,_._1)(e,"x","reverse");return A.hu(4===n.rank,(()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`)),(0,Ti.G)(n,t)}});var zi=n(97809),Li=n(32634),Pi=n(55503),ji=n(68678);const Ui=async function(e,t){const n=(0,_._1)(e,"x","setdiff1d"),r=(0,_._1)(t,"y","setdiff1d");A.hu(n.dtype===r.dtype,(()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`)),A.hu(1===n.rank,(()=>`x should be 1D tensor, but got x (${n.shape}).`)),A.hu(1===r.rank,(()=>`y should be 1D tensor, but got y (${r.shape}).`));const i=await n.data(),a=await r.data(),s=new Set(a);let o=0;for(let e=0;e<i.length;e++)s.has(i[e])||o++;const u=new we.YD([o],n.dtype),l=new we.YD([o],"int32");for(let e=0,t=0;e<i.length;e++)s.has(i[e])||(u.values[t]=i[e],l.values[t]=e,t++);return[u.toTensor(),l.toTensor()]};var Wi=n(34434),Vi=n(99331),Gi=n(83254);const qi=(0,qe.op)({slice1d_:function(e,t,n){const r=(0,_._1)(e,"x","slice1d");return A.hu(1===r.rank,(()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`)),(0,Mn.t)(r,[t],[n])}}),Hi=(0,qe.op)({slice2d_:function(e,t,n){const r=(0,_._1)(e,"x","slice2d");return A.hu(2===r.rank,(()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`)),(0,Mn.t)(r,t,n)}}),Xi=(0,qe.op)({slice3d_:function(e,t,n){const r=(0,_._1)(e,"x","slice3d");return A.hu(3===r.rank,(()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`)),(0,Mn.t)(r,t,n)}}),Ki=(0,qe.op)({slice4d_:function(e,t,n){const r=(0,_._1)(e,"x","slice4d");return A.hu(4===r.rank,(()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`)),(0,Mn.t)(r,t,n)}});var Yi=n(80682),Qi=n(3694),Ji=n(27918),Zi=n(7020),ea=n(88447),ta=n(84415),na=n(13710),ra=n(28644),ia=n(15265),aa=n(79590),sa=n(82991),oa=n(71901),ua=n(55158),la=n(15475),ca=n(61173);function da(e,t){(0,A.Cq)(e);const n=(0,_.C)(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return(0,S.H)(e,null,n,t)}function ha(e,t,n){if((0,A.Cq)(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");const r=(0,_.C)(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return(0,S.H)(e,t,r,n)}function fa(e,t,n){if((0,A.Cq)(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");const r=(0,_.C)(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return(0,S.H)(e,t,r,n)}function pa(e,t,n){if((0,A.Cq)(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");const r=(0,_.C)(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return(0,S.H)(e,t,r,n)}function ga(e,t,n){if((0,A.Cq)(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");const r=(0,_.C)(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return t=t||r,(0,S.H)(e,t,r,n)}var ma=n(43243);const ya=(0,qe.op)({truncatedNormal_:function(e,t=0,n=1,r,i){if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const a=new ki(t,n,r,!0,i),s=ke(e,r);for(let e=0;e<s.values.length;e++)s.values[e]=a.nextValue();return s.toTensor()}});var va=n(49608),ba=n(98749),xa=n(24136);function wa(e,t=!0,n,r){return g.BV.makeVariable(e,t,n,r)}var ka=n(95912);function _a(e,t){const n=[];for(let e=0;e<t.length;e++)t[e]&&n.push(e);const r=ke(e,"int32"),i=ke([n.length,e.length],"int32");for(let t=0;t<n.length;t++){const a=r.indexToLoc(n[t]),s=t*e.length;i.values.set(a,s)}return i.toTensor()}const Sa=async function(e){const t=(0,_._1)(e,"condition","whereAsync","bool"),n=await t.data(),r=_a(t.shape,n);return e!==t&&t.dispose(),r};var Ca=n(59640);const Aa=async function(e,t,n){const r=(0,_._1)(e,"tensor","boolMask"),i=(0,_._1)(t,"mask","boolMask","bool"),a=null==n?0:n,s=i.rank,o=r.shape;A.hu(s>0,(()=>"mask cannot be scalar")),A.k5(o.slice(a,a+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,");let u=1;for(let e=a;e<a+s;e++)u*=o[e];const l=o.slice(0,a).concat([u],o.slice(a+s)),c=(0,Nn.X)(r,l),d=(0,Nn.X)(i,[-1]),h=await Sa(d),f=(0,aa.L)(h,[1]),p=(0,Ar.I)(c,f,a);return e!==r&&r.dispose(),t!==i&&i.dispose(),f.dispose(),c.dispose(),d.dispose(),h.dispose(),p};var Ea=n(3561);const Fa=(0,qe.op)({movingAverage_:function(e,t,n,r,i=!0){const a=(0,_._1)(e,"v","movingAverage"),s=(0,_._1)(t,"x","movingAverage"),o=(0,_._1)(n,"decay","movingAverage");(0,ht.assertTypesMatch)(a,s),A.hu(A.cO(a.shape,s.shape),(()=>"Shape mismatch in v and x"));const u=(0,en.i)(1),l=(0,on.l)(u,o);let c=(0,Kt.d)((0,on.l)(s,a),l);if(i){A.hu(null!=r,(()=>"When using zeroDebias: true, step is required."));const e=(0,_._1)(r,"step","movingAverage");c=(0,Xt.h)(c,(0,on.l)(u,(0,sn.s)(o,e)))}return(0,Ht.I)(a,c)}}),Ia=(0,qe.op)({scatterND_:function(e,t,n){const r=(0,_._1)(e,"indices","scatterND","int32"),i=(0,_._1)(t,"updates","scatterND");st(i,r,n);const a={indices:r,updates:i},s={shape:n};return g.BV.runKernel(Ye.xQ,a,s)}}),Da=(0,qe.op)({sparseToDense_:function(e,t,n,r=0){const i=(0,_._1)(e,"sparseIndices","sparseToDense","int32"),a=(0,_._1)(t,"sparseValues","sparseToDense"),s=(0,_._1)(r,"defaultValue","sparseToDense",a.dtype);!function(e,t,n,r){if("int32"!==e.dtype)throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${e.shape}.`);const i=e.rank>0?e.shape[0]:1,a=e.rank>1?e.shape[1]:1;if(n.length!==a)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${a}.`);const s=t.size;if(0!==t.rank&&(1!==t.rank||s!==i))throw new Error(`sparseValues has incorrect shape ${t.shape}, should be [] or [${i}]`);if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,a,n,s);const o={sparseIndices:i,sparseValues:a,defaultValue:s},u={outputShape:n};return g.BV.runKernel(Ye.D2,o,u)}}),Na=(0,qe.op)({gatherND_:function(e,t){const n=(0,_._1)(t,"indices","gatherND","int32"),r={params:(0,_._1)(e,"x","gatherND","string_or_numeric"),indices:n};return g.BV.runKernel(Ye.q1,r)}}),$a=(0,qe.op)({dropout_:function(e,t,n,r){const i=(0,_._1)(e,"x","dropout");if(A.hu("float32"===i.dtype,(()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${i.dtype} tensor instead.`)),A.hu(t>=0&&t<1,(()=>`rate must be a float in the range [0, 1), but got ${t}.`)),0===t)return e instanceof we.es?i.clone():i;const a=function(e,t){if(null==t)return e.shape.slice();if(A.cO(e.shape,t))return t;if(e.shape.length===t.length){const n=[];for(let r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(i,n),s=1-t,o=(0,Xt.h)((0,Sr.G)((0,Ht.I)(Ei(a,0,1,"float32",r),s)),s);return(0,Kt.d)(i,o)}});function Ta(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function Oa(e,t,n){const r=1-e%2,i=new Float32Array(e);for(let a=0;a<e;++a){const s=2*Math.PI*a/(e+r-1);i[a]=t-n*Math.cos(s)}return da(i,"float32")}const Ma=async function(e,t,n=1){const r=(0,_._1)(e,"predictions","inTopK"),i=(0,_._1)(t,"targets","inTopK");(0,A.hu)(r.rank>1,(()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`)),(0,A.hu)(r.rank-1===i.rank,(()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${i.rank}`)),(0,A.k5)(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const a=r.shape[r.shape.length-1];(0,A.hu)(n>0&&n<=a,(()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${a}), but got ${n}`));const s=await r.data(),o=await i.data(),[u,l]=[s.length/a,a],c=(0,A.WP)("bool",u);for(let e=0;e<u;e++){const t=e*l,r=s.subarray(t,t+l),i=[];for(let e=0;e<r.length;e++)i.push({value:r[e],index:e});i.sort(((e,t)=>t.value-e.value)),c[e]=0;for(let t=0;t<n;t++)if(i[t].index===o[e]){c[e]=1;break}}return e!==r&&r.dispose(),t!==i&&i.dispose(),C(c,i.shape,"bool")};var Ra=n(36013),Ba=n(39832);function za(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return(0,Kt.d)(e,(0,oa.N)(t));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function La(e,t){let n=t;const r=Ke.getReductionAxes(e.shape,t.shape);return r.length>0&&(n=(0,la.S)(n,r)),(0,Nn.X)(n,e.shape)}function Pa(e,t,n,r){if("linear"===t)return e;if("relu"===t)return(0,Ni.U)(e);if("elu"===t)return(0,mr.p)(e);if("relu6"===t)return(0,$i.b)(e);if("prelu"===t)return(0,vi.A)(e,n);if("leakyrelu"===t)return(0,Tr.h)(e,r);if("sigmoid"===t)return(0,On.X)(e);throw new Error(`Unknown fused activation ${t}.`)}const ja=(e,t)=>!(e>0)||"linear"===t,Ua=(0,qe.op)({fusedConv2d_:function({x:e,filter:t,strides:n,pad:r,dataFormat:i="NHWC",dilations:a=[1,1],dimRoundingMode:s,bias:o,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(u=u||"linear",!1===ja(g.BV.state.gradientDepth,u)){let d=(0,Zn.T)(e,t,n,r,i,a,s);return null!=o&&(d=(0,Ht.I)(d,o)),Pa(d,u,l,c)}const d=(0,_._1)(e,"x","conv2d","float32"),h=(0,_._1)(t,"filter","conv2d","float32");let f=d,p=!1;3===d.rank&&(p=!0,f=(0,Nn.X)(d,[1,d.shape[0],d.shape[1],d.shape[2]])),A.hu(4===f.rank,(()=>`Error in fused conv2d: input must be rank 4, but got rank ${f.rank}.`)),A.hu(4===h.rank,(()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`)),Dn.m("fused conv2d",r,s),A.hu(f.shape[3]===h.shape[2],(()=>`Error in conv2d: depth of input (${f.shape[3]}) must match input depth for filter ${h.shape[2]}.`)),A.hu(Dn.jT(n,a),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`)),A.hu("NHWC"===i,(()=>`Error in conv2d: got dataFormat of ${i} but only NHWC is currently supported.`));const m=Dn.Ix(f.shape,h.shape,n,a,r,s);let y,v;null!=o&&(y=(0,_._1)(o,"bias","fused conv2d"),[y]=(0,ht.makeTypesMatch)(y,d),Ke.assertAndGetBroadcastShape(m.outShape,y.shape)),null!=l&&(v=(0,_._1)(l,"prelu weights","fused conv2d"));const b=(e,t)=>{const[i,s,o,l]=t,c=za(e,o,u);A.hu(Dn.I0(a),(()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${a}'`));const d=[(0,Ba._)(s.shape,c,i,n,r),(0,Ra.p)(s,c,i.shape,n,r)];if(null!=l){const e=La(l,c);d.push(e)}return d},x={x:f,filter:h,bias:y,preluActivationWeights:v},w={strides:n,pad:r,dataFormat:i,dilations:a,dimRoundingMode:s,activation:u,leakyreluAlpha:c};if(null==o){const e=(0,Zt.cb)(((e,t,n)=>{let r=g.BV.runKernel(Ye._V,x,w);return n([t,e,r]),p&&(r=(0,Nn.X)(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:b}}));return e(f,h)}{const e=(0,Zt.cb)(((e,t,n,r)=>{let i=g.BV.runKernel(Ye._V,x,w);return r([t,e,i,n]),p&&(i=(0,Nn.X)(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:b}}));return e(f,h,y)}}});var Wa=n(88098),Va=n(54375);const Ga=(0,qe.op)({fusedDepthwiseConv2d_:function({x:e,filter:t,strides:n,pad:r,dataFormat:i="NHWC",dilations:a=[1,1],dimRoundingMode:s,bias:o,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(!1===ja(g.BV.state.gradientDepth,u)){let d=(0,cr.B)(e,t,n,r,i,a,s);return null!=o&&(d=(0,Ht.I)(d,o)),Pa(d,u,l,c)}const d=(0,_._1)(e,"x","depthwiseConv2d","float32"),h=(0,_._1)(t,"filter","depthwiseConv2d","float32");let f=d,p=!1;3===d.rank&&(p=!0,f=(0,Nn.X)(d,[1,d.shape[0],d.shape[1],d.shape[2]])),A.hu(4===f.rank,(()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${f.rank}.`)),A.hu(4===h.rank,(()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${h.rank}.`)),A.hu(f.shape[3]===h.shape[2],(()=>`Error in fused depthwiseConv2d: number of input channels (${f.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`)),null==a&&(a=[1,1]),A.hu(Dn.jT(n,a),(()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${a}'`)),Dn.m("fused depthwiseConv2d",r,s);const m=Dn.Ix(f.shape,h.shape,n,a,r,s,!0);let y,v;null!=o&&(y=(0,_._1)(o,"bias","fused conv2d"),[y]=(0,ht.makeTypesMatch)(y,d),Ke.assertAndGetBroadcastShape(m.outShape,y.shape)),null!=l&&(v=(0,_._1)(l,"prelu weights","fused depthwiseConv2d"));const b=(e,t)=>{A.hu(Dn.I0(a),(()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`));const[i,o,l,c]=t,d=za(e,l,u),h=(0,Va.v)(o.shape,d,i,n,r,a,s),f=(0,Wa.z)(o,d,i.shape,n,r,a,s);return null!=c?[h,f,La(y,d)]:[h,f]},x={x:f,filter:h,bias:y,preluActivationWeights:v},w={strides:n,pad:r,dataFormat:i,dilations:a,dimRoundingMode:s,activation:u,leakyreluAlpha:c};if(null==o){const e=(0,Zt.cb)(((e,t,n)=>{let r=g.BV.runKernel(Ye.lu,x,w);return n([t,e,r]),p&&(r=(0,Nn.X)(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:b}}));return e(f,h)}{const e=(0,Zt.cb)(((e,t,n,r)=>{let i=g.BV.runKernel(Ye.lu,x,w);return r([t,e,i,n]),p&&(i=(0,Nn.X)(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:b}}));return e(f,h,y)}}}),qa=(0,qe.op)({fusedMatMul_:function({a:e,b:t,transposeA:n=!1,transposeB:r=!1,bias:i,activation:a="linear",preluActivationWeights:s,leakyreluAlpha:o}){if(!1===ja(g.BV.state.gradientDepth,a)){let u=(0,Ve.O)(e,t,n,r);return null!=i&&(u=(0,Ht.I)(u,i)),Pa(u,a,s,o)}let u=(0,_._1)(e,"a","fused matMul"),l=(0,_._1)(t,"b","fused matMul");[u,l]=(0,ht.makeTypesMatch)(u,l);const c=n?u.shape[u.rank-2]:u.shape[u.rank-1],d=r?l.shape[l.rank-1]:l.shape[l.rank-2],h=n?u.shape[u.rank-1]:u.shape[u.rank-2],f=r?l.shape[l.rank-2]:l.shape[l.rank-1],p=u.shape.slice(0,-2),m=l.shape.slice(0,-2),y=A.NA(p),v=A.NA(m);A.hu(c===d,(()=>`Error in fused matMul: inner shapes (${c}) and (${d}) of Tensors with shapes ${u.shape} and ${l.shape} and transposeA=${n} and transposeB=${r} must match.`));const b=Ke.assertAndGetBroadcastShape(u.shape.slice(0,-2),l.shape.slice(0,-2)).concat([h,f]),x=n?(0,Nn.X)(u,[y,c,h]):(0,Nn.X)(u,[y,h,c]),w=r?(0,Nn.X)(l,[v,f,d]):(0,Nn.X)(l,[v,d,f]);let k,S;null!=i&&(k=(0,_._1)(i,"bias","fused matMul"),[k]=(0,ht.makeTypesMatch)(k,u),Ke.assertAndGetBroadcastShape(b,k.shape)),null!=s&&(S=(0,_._1)(s,"prelu weights","fused matMul"));const C=(e,t)=>{const[s,o,u,l]=t,c=za((0,Nn.X)(e,u.shape),u,a);let d,h;return n||r?!n&&r?(d=(0,Ve.O)(c,o,!1,!1),h=(0,Ve.O)(c,s,!0,!1)):n&&!r?(d=(0,Ve.O)(o,c,!1,!0),h=(0,Ve.O)(s,c,!1,!1)):(d=(0,Ve.O)(o,c,!0,!0),h=(0,Ve.O)(c,s,!0,!0)):(d=(0,Ve.O)(c,o,!1,!0),h=(0,Ve.O)(s,c,!0,!1)),null!=i?[d,h,La(l,c)]:[d,h]},E={a:x,b:w,bias:k,preluActivationWeights:S},F={transposeA:n,transposeB:r,activation:a,leakyreluAlpha:o};if(null==i){const e=(0,Zt.cb)(((e,t,n)=>{const r=g.BV.runKernel(Ye.us,E,F);return n([e,t,r]),{value:(0,Nn.X)(r,b),gradFunc:C}}));return e(x,w)}{const e=(0,Zt.cb)(((e,t,n,r)=>{const i=g.BV.runKernel(Ye.us,E,F);return r([e,t,i,n]),{value:(0,Nn.X)(i,b),gradFunc:C}}));return e(x,w,k)}}}),Ha=(0,qe.op)({hammingWindow_:function(e){return Oa(e,.54,.46)}}),Xa=(0,qe.op)({hannWindow_:function(e){return Oa(e,.5,.5)}}),Ka=(0,qe.op)({frame_:function(e,t,n,r=!1,i=0){let a=0;const s=[];for(;a+t<=e.size;)s.push((0,Mn.t)(e,a,t)),a+=n;if(r)for(;a<e.size;){const r=a+t-e.size,o=(0,Tn.z)([(0,Mn.t)(e,a,t-r),rn([r],i)]);s.push(o),a+=n}return 0===s.length?ha([],[0,t]):(0,Nn.X)((0,Tn.z)(s),[s.length,t])}}),Ya=(0,qe.op)({stft_:function(e,t,n,r,i=Xa){null==r&&(r=Ta(t));const a=Ka(e,t,n),s=(0,Kt.d)(a,i(t));return(0,na.Q)(s,r)}}),Qa=(0,qe.op)({cropAndResize_:function(e,t,n,r,i="bilinear",a=0){const s=(0,_._1)(e,"image","cropAndResize"),o=(0,_._1)(t,"boxes","cropAndResize","float32"),u=(0,_._1)(n,"boxInd","cropAndResize","int32"),l=o.shape[0];A.hu(4===s.rank,(()=>`Error in cropAndResize: image must be rank 4,but got rank ${s.rank}.`)),A.hu(2===o.rank&&4===o.shape[1],(()=>`Error in cropAndResize: boxes must be have size [${l},4] but had shape ${o.shape}.`)),A.hu(1===u.rank&&u.shape[0]===l,(()=>`Error in cropAndResize: boxInd must be have size [${l}] but had shape ${o.shape}.`)),A.hu(2===r.length,(()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`)),A.hu(r[0]>=1&&r[1]>=1,(()=>`cropSize must be atleast [1,1], but was ${r}`)),A.hu("bilinear"===i||"nearest"===i,(()=>`method must be bilinear or nearest, but was ${i}`));const c={image:s,boxes:o,boxInd:u},d={method:i,extrapolationValue:a,cropSize:r};return g.BV.runKernel(Ye.Vc,c,d)}}),Ja=(0,qe.op)({flipLeftRight_:function(e){const t=(0,_._1)(e,"image","flipLeftRight","float32");A.hu(4===t.rank,(()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`));const n={image:t};return g.BV.runKernel(Ye.Uy,n,{})}}),Za=(0,qe.op)({grayscaleToRGB_:function(e){const t=(0,_._1)(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];A.hu(t.rank>=2,(()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`)),A.hu(1===r,(()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`));const i=new Array(t.rank);return i.fill(1,0,n),i[n]=3,(0,kr.G)(t,i)}}),es=(0,qe.op)({rotateWithOffset_:function(e,t,n=0,r=.5){const i=(0,_._1)(e,"image","rotateWithOffset","float32");A.hu(4===i.rank,(()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${i.rank}.`));const a={image:i},s={radians:t,fillValue:n,center:r};return g.BV.runKernel(Ye.b9,a,s)}});function ts(e,t,n,r,i,a){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==a&&(a=0);const s=e.shape[0];return n=Math.min(n,s),A.hu(0<=r&&r<=1,(()=>`iouThreshold must be in [0, 1], but was '${r}'`)),A.hu(2===e.rank,(()=>`boxes must be a 2D tensor, but was of rank '${e.rank}'`)),A.hu(4===e.shape[1],(()=>`boxes must have 4 columns, but 2nd dimension was ${e.shape[1]}`)),A.hu(1===t.rank,(()=>"scores must be a 1D tensor")),A.hu(t.shape[0]===s,(()=>`scores has incompatible shape with boxes. Expected ${s}, but was ${t.shape[0]}`)),A.hu(0<=a&&a<=1,(()=>`softNmsSigma must be in [0, 1], but was '${a}'`)),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:a}}const ns=(0,qe.op)({nonMaxSuppression_:function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY){const a=(0,_._1)(e,"boxes","nonMaxSuppression","float32"),s=(0,_._1)(t,"scores","nonMaxSuppression","float32"),o=ts(a,s,n,r,i),u={maxOutputSize:n=o.maxOutputSize,iouThreshold:r=o.iouThreshold,scoreThreshold:i=o.scoreThreshold};return g.BV.runKernel(Ye.uv,{boxes:a,scores:s},u)}});function rs(e,t,n){const r=function(e,t,n){return function(e,t,n){let r=0,i=e.length,a=0,s=!1;for(;r<i;){a=r+(i-r>>>1);const o=n(t,e[a]);o>0?r=a+1:(i=a,s=!o)}return s?r:-r-1}(e,t,n||is)}(e,t,n),i=r<0?-(r+1):r;e.splice(i,0,t)}function is(e,t){return e>t?1:e<t?-1:0}function as(e,t,n,r,i){return us(e,t,n,r,i,0)}function ss(e,t,n,r,i,a){return us(e,t,n,r,i,0,!1,a,!0)}function os(e,t,n,r,i,a){return us(e,t,n,r,i,a,!0)}function us(e,t,n,r,i,a,s=!1,o=!1,u=!1){const l=[];for(let e=0;e<t.length;e++)t[e]>i&&l.push({score:t[e],boxIndex:e,suppressBeginIndex:0});l.sort(ds);const c=a>0?-.5/a:0,d=[],h=[];for(;d.length<n&&l.length>0;){const t=l.pop(),{score:n,boxIndex:a,suppressBeginIndex:s}=t;if(n<i)break;let o=!1;for(let n=d.length-1;n>=s;--n){const s=ls(e,a,d[n]);if(s>=r){o=!0;break}if(t.score=t.score*cs(r,c,s),t.score<=i)break}t.suppressBeginIndex=d.length,o||(t.score===n?(d.push(a),h.push(t.score)):t.score>i&&rs(l,t,ds))}const f=d.length,p=n-f;o&&p>0&&(d.push(...new Array(p).fill(0)),h.push(...new Array(p).fill(0)));const g={selectedIndices:d};return s&&(g.selectedScores=h),u&&(g.validOutputs=f),g}function ls(e,t,n){const r=e.subarray(4*t,4*t+4),i=e.subarray(4*n,4*n+4),a=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),o=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),d=Math.max(i[0],i[2]),h=Math.max(i[1],i[3]),f=(o-a)*(u-s),p=(d-l)*(h-c);if(f<=0||p<=0)return 0;const g=Math.max(a,l),m=Math.max(s,c),y=Math.min(o,d),v=Math.min(u,h),b=Math.max(y-g,0)*Math.max(v-m,0);return b/(f+p-b)}function cs(e,t,n){const r=Math.exp(t*n*n);return n<=e?r:0}function ds(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}const hs=(0,qe.op)({nonMaxSuppressionWithScore_:function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,a=0){const s=(0,_._1)(e,"boxes","nonMaxSuppression"),o=(0,_._1)(t,"scores","nonMaxSuppression"),u=ts(s,o,n,r,i,a),l={boxes:s,scores:o},c={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:i=u.scoreThreshold,softNmsSigma:a=u.softNmsSigma},d=g.BV.runKernel(Ye.W0,l,c);return{selectedIndices:d[0],selectedScores:d[1]}}}),fs=(0,qe.op)({nonMaxSuppressionPadded_:function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,a=!1){const s=(0,_._1)(e,"boxes","nonMaxSuppression"),o=(0,_._1)(t,"scores","nonMaxSuppression"),u=ts(s,o,n,r,i,null),l={boxes:s,scores:o},c={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:a},d=g.BV.runKernel(Ye.cy,l,c);return{selectedIndices:d[0],validOutputs:d[1]}}});var ps=n(13305),gs=n(95098);const ms=(0,qe.op)({threshold_:function(e,t="binary",n=!1,r=.5){const i=(0,_._1)(e,"image","threshold"),a=i.shape[0]*i.shape[1];let s,o,u,l,c=(0,Kt.d)(da([r]),255);if(A.hu(3===i.rank,(()=>`Error in threshold: image must be rank 3,but got rank ${i.rank}.`)),A.hu(3===i.shape[2]||1===i.shape[2],(()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${i.shape[2]}.`)),A.hu("int32"===i.dtype||"float32"===i.dtype,(()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${i.dtype}.`)),A.hu("otsu"===t||"binary"===t,(()=>`Method must be binary or otsu, but was ${t}`)),3===i.shape[2]){[s,o,u]=(0,ra.V)(i,[1,1,1],-1);const e=(0,Kt.d)(s,.2989),t=(0,Kt.d)(o,.587),n=(0,Kt.d)(u,.114);l=(0,Ht.I)((0,Ht.I)(e,t),n)}else l=e;"otsu"===t&&(c=function(e,t){let n,r,i,a,s,o,u=da([-1]),l=da([0]),c=da([0]);for(let d=0;d<e.size-1;d++){n=(0,Mn.t)(e,0,d+1),r=(0,Mn.t)(e,d+1),s=(0,Xt.h)((0,la.S)(n),t),o=(0,Xt.h)((0,la.S)(r),t);const h=(0,la.S)((0,Kt.d)(n,Fi(0,n.size)));i=(0,Xt.h)(h,(0,la.S)(n));const f=rn(r.shape,n.size),p=(0,Ht.I)(Fi(0,r.size),f),g=(0,Kt.d)(r,p);a=(0,Xt.h)((0,la.S)(g),(0,la.S)(r));const m=(0,on.l)(i,a),y=(0,on.l)(i,a),v=(0,Kt.d)(s,o);c=(0,Kt.d)((0,Kt.d)(v,m),y);const b=(0,Er.p)(c,l);l=(0,ka.a)(b,c,l),u=(0,ka.a)(b,da([d]),u)}return u}(Wn((0,_e.p)((0,zi.N)(l),"int32"),C([]),256),a));const d=n?(0,Mr.z)(l,c):(0,Er.p)(l,c);return(0,_e.p)((0,Kt.d)(d,255),"int32")}}),ys=(0,qe.op)({transform_:function(e,t,n="nearest",r="constant",i=0,a){const s=(0,_._1)(e,"image","transform","float32"),o=(0,_._1)(t,"transforms","transform","float32");A.hu(4===s.rank,(()=>`Error in transform: image must be rank 4,but got rank ${s.rank}.`)),A.hu(2===o.rank&&(o.shape[0]===s.shape[0]||1===o.shape[0])&&8===o.shape[1],(()=>"Error in transform: Input transform should be batch x 8 or 1 x 8")),A.hu(null==a||2===a.length,(()=>`Error in transform: outputShape must be [height, width] or null, but got ${a}.`));const u={image:s,transforms:o},l={interpolation:n,fillMode:r,fillValue:i,outputShape:a};return g.BV.runKernel(Ye.wx,u,l)}}),vs=(0,qe.op)({bandPart_:function(e,t,n){(0,A.hu)(t%1==0,(()=>`bandPart(): numLower must be an integer, got ${t}.`)),(0,A.hu)(n%1==0,(()=>`bandPart(): numUpper must be an integer, got ${n}.`));const r=(0,_._1)(e,"a","bandPart");(0,A.hu)(r.rank>=2,(()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`));const i=r.shape,[a,s]=r.shape.slice(-2);if(!(t<=a))throw new Error(`bandPart(): numLower (${t}) must not be greater than the number of rows (${a}).`);if(!(n<=s))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${s}).`);t<0&&(t=a),n<0&&(n=s);const o=(0,Nn.X)(Fi(0,a,1,"int32"),[-1,1]),u=Fi(0,s,1,"int32"),l=(0,on.l)(o,u),c=(0,Wr.H)((0,Mr.z)(l,(0,en.i)(+t,"int32")),(0,Fr.b)(l,(0,en.i)(-n,"int32"))),d=(0,Ca.l)([a,s],r.dtype);return(0,Nn.X)((0,sa.k)((0,xa.H)((0,Nn.X)(r,[-1,a,s])).map((e=>(0,ka.a)(c,e,d)))),i)}}),bs=(0,qe.op)({gramSchmidt_:function(e){let t;if(Array.isArray(e)){t=!1,(0,A.hu)(null!=e&&e.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=e[0].shape[0];for(let t=1;t<e.length;++t)(0,A.hu)(e[t].shape[0]===n,(()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${e[t].shape[0]} vs. ${n})`))}else t=!0,e=(0,ra.V)(e,e.shape[0],0).map((e=>(0,aa.L)(e,[0])));(0,A.hu)(e.length<=e[0].shape[0],(()=>`Gram-Schmidt: Number of vectors (${e.length}) exceeds number of dimensions (${e[0].shape[0]}).`));const n=[],r=e;for(let t=0;t<e.length;++t)n.push(g.BV.tidy((()=>{let e=r[t];if(t>0)for(let r=0;r<t;++r){const t=(0,Kt.d)((0,la.S)((0,Kt.d)(n[r],e)),n[r]);e=(0,on.l)(e,t)}return(0,Xt.h)(e,(0,Ea.K)(e,"euclidean"))})));return t?(0,sa.k)(n,0):n}});function xs(e,t=!1){return g.BV.tidy((()=>{(0,A.hu)(2===e.shape.length,(()=>`qr2d() requires a 2D Tensor, but got a ${e.shape.length}D Tensor.`));const n=e.shape[0],r=e.shape[1];let i=_r(n),a=(0,Se.d)(e);const s=ha([[1]],[1,1]);let o=(0,Se.d)(s);const u=n>=r?r:n;for(let e=0;e<u;++e){const t=a,u=o,l=i;[o,a,i]=g.BV.tidy((()=>{const t=(0,Mn.t)(a,[e,e],[n-e,1]),u=(0,Ea.K)(t),l=(0,Mn.t)(a,[e,e],[1,1]),c=(0,ka.a)((0,Er.p)(l,0),ha([[-1]]),ha([[1]])),d=(0,on.l)(l,(0,Kt.d)(c,u)),h=(0,Xt.h)(t,d);o=1===h.shape[0]?(0,Se.d)(s):(0,Tn.z)([s,(0,Mn.t)(h,[1,0],[h.shape[0]-1,h.shape[1]])],0);const f=(0,ui.W)((0,Xt.h)((0,Ve.O)(c,d),u)),p=(0,Mn.t)(a,[e,0],[n-e,r]),g=(0,Kt.d)(f,o),m=(0,He.p)(o);if(0===e)a=(0,on.l)(p,(0,Ve.O)(g,(0,Ve.O)(m,p)));else{const t=(0,on.l)(p,(0,Ve.O)(g,(0,Ve.O)(m,p)));a=(0,Tn.z)([(0,Mn.t)(a,[0,0],[e,r]),t],0)}const y=(0,He.p)(g),v=(0,Mn.t)(i,[0,e],[n,i.shape[1]-e]);if(0===e)i=(0,on.l)(v,(0,Ve.O)((0,Ve.O)(v,o),y));else{const t=(0,on.l)(v,(0,Ve.O)((0,Ve.O)(v,o),y));i=(0,Tn.z)([(0,Mn.t)(i,[0,0],[n,e]),t],1)}return[o,a,i]})),Mt([t,u,l])}return!t&&n>r&&(i=(0,Mn.t)(i,[0,0],[n,r]),a=(0,Mn.t)(a,[0,0],[r,r])),[i,a]}))}const ws=(0,qe.op)({qr_:function(e,t=!1){if((0,A.hu)(e.rank>=2,(()=>`qr() requires input tensor to have a rank >= 2, but got rank ${e.rank}`)),2===e.rank)return xs(e,t);{const n=e.shape.slice(0,e.shape.length-2).reduce(((e,t)=>e*t)),r=(0,xa.H)((0,Nn.X)(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),i=[],a=[];return r.forEach((e=>{const[n,r]=xs(e,t);i.push(n),a.push(r)})),[(0,Nn.X)((0,sa.k)(i,0),e.shape),(0,Nn.X)((0,sa.k)(a,0),e.shape)]}}});var ks;!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(ks||(ks={}));const _s=(0,qe.op)({computeWeightedLoss_:function(e,t,n=ks.SUM_BY_NONZERO_WEIGHTS){const r=(0,_._1)(e,"losses","computeWeightedLoss");let i=null;null!=t&&(i=(0,_._1)(t,"weights","computeWeightedLoss"));const a=null==i?r:(0,Kt.d)(r,i);if(n===ks.NONE)return a;if(n===ks.SUM)return(0,la.S)(a);if(n===ks.MEAN){if(null==i)return(0,Qr.J)(a);{const e=r.size/i.size,t=(0,Xt.h)((0,la.S)(a),(0,la.S)(i));return e>1?(0,Xt.h)(t,(0,en.i)(e)):t}}if(n===ks.SUM_BY_NONZERO_WEIGHTS){if(null==i)return(0,Xt.h)((0,la.S)(a),(0,en.i)(r.size));{const e=(0,Kt.d)(i,(0,Jr.i)(r.shape)),t=(0,_e.p)((0,la.S)((0,li.Q)(e,(0,en.i)(0))),"float32");return(0,Xt.h)((0,la.S)(a),t)}}throw Error(`Unknown reduction: ${n}`)}}),Ss=(0,qe.op)({absoluteDifference_:function(e,t,n,r=ks.SUM_BY_NONZERO_WEIGHTS){const i=(0,_._1)(e,"labels","absoluteDifference"),a=(0,_._1)(t,"predictions","absoluteDifference");let s=null;null!=n&&(s=(0,_._1)(n,"weights","absoluteDifference")),(0,A.k5)(i.shape,a.shape,"Error in absoluteDifference: ");const o=(0,ln.W)((0,on.l)(i,a));return _s(o,s,r)}}),Cs=(0,qe.op)({cosineDistance_:function(e,t,n,r,i=ks.SUM_BY_NONZERO_WEIGHTS){const a=(0,_._1)(e,"labels","cosineDistance"),s=(0,_._1)(t,"predictions","cosineDistance");let o=null;null!=r&&(o=(0,_._1)(r,"weights","cosineDistance")),(0,A.k5)(a.shape,s.shape,"Error in cosineDistance: ");const u=(0,en.i)(1),l=(0,on.l)(u,(0,la.S)((0,Kt.d)(a,s),n,!0));return _s(l,o,i)}}),As=(0,qe.op)({hingeLoss_:function(e,t,n,r=ks.SUM_BY_NONZERO_WEIGHTS){let i=(0,_._1)(e,"labels","hingeLoss");const a=(0,_._1)(t,"predictions","hingeLoss");let s=null;null!=n&&(s=(0,_._1)(n,"weights","hingeLoss")),(0,A.k5)(i.shape,a.shape,"Error in hingeLoss: ");const o=(0,en.i)(1);i=(0,on.l)((0,Kt.d)((0,en.i)(2),i),o);const u=(0,Ni.U)((0,on.l)(o,(0,Kt.d)(i,a)));return _s(u,s,r)}}),Es=(0,qe.op)({huberLoss_:function(e,t,n,r=1,i=ks.SUM_BY_NONZERO_WEIGHTS){const a=(0,_._1)(e,"labels","huberLoss"),s=(0,_._1)(t,"predictions","huberLoss");let o=null;null!=n&&(o=(0,_._1)(n,"weights","huberLoss")),(0,A.k5)(a.shape,s.shape,"Error in huberLoss: ");const u=(0,en.i)(r),l=(0,ln.W)((0,on.l)(s,a)),c=(0,ti.L)(l,u),d=(0,on.l)(l,c),h=(0,Ht.I)((0,Kt.d)((0,en.i)(.5),(0,Qt.h)(c)),(0,Kt.d)(u,d));return _s(h,o,i)}}),Fs=(0,qe.op)({logLoss_:function(e,t,n,r=1e-7,i=ks.SUM_BY_NONZERO_WEIGHTS){const a=(0,_._1)(e,"labels","logLoss"),s=(0,_._1)(t,"predictions","logLoss");let o=null;null!=n&&(o=(0,_._1)(n,"weights","logLoss")),(0,A.k5)(a.shape,s.shape,"Error in logLoss: ");const u=(0,en.i)(1),l=(0,en.i)(r),c=(0,ui.W)((0,Kt.d)(a,(0,zr.c)((0,Ht.I)(s,l)))),d=(0,Kt.d)((0,on.l)(u,a),(0,zr.c)((0,Ht.I)((0,on.l)(u,s),l))),h=(0,on.l)(c,d);return _s(h,o,i)}}),Is=(0,qe.op)({meanSquaredError_:function(e,t,n,r=ks.SUM_BY_NONZERO_WEIGHTS){const i=(0,_._1)(e,"labels","meanSquaredError"),a=(0,_._1)(t,"predictions","meanSquaredError");let s=null;null!=n&&(s=(0,_._1)(n,"weights","meanSquaredError")),(0,A.k5)(i.shape,a.shape,"Error in meanSquaredError: ");const o=(0,ia.$)(i,a);return _s(o,s,r)}}),Ds=(0,qe.op)({sigmoidCrossEntropy_:function(e,t,n,r=0,i=ks.SUM_BY_NONZERO_WEIGHTS){let a=(0,_._1)(e,"multiClassLabels","sigmoidCrossEntropy");const s=(0,_._1)(t,"logits","sigmoidCrossEntropy");let o=null;if(null!=n&&(o=(0,_._1)(n,"weights","sigmoidCrossEntropy")),(0,A.k5)(a.shape,s.shape,"Error in sigmoidCrossEntropy: "),r>0){const e=(0,en.i)(r),t=(0,en.i)(1),n=(0,en.i)(.5);a=(0,Ht.I)((0,Kt.d)(a,(0,on.l)(t,e)),(0,Kt.d)(n,e))}const u=function(e,t){const n=(0,_._1)(e,"labels","sigmoidCrossEntropyWithLogits"),r=(0,_._1)(t,"logits","sigmoidCrossEntropyWithLogits");(0,A.k5)(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const i=(0,Ni.U)(r),a=(0,Kt.d)(r,n),s=(0,Lr.K)((0,br.Q)((0,ui.W)((0,ln.W)(r))));return(0,Ht.I)((0,on.l)(i,a),s)}(a,s);return _s(u,o,i)}}),Ns=(0,qe.op)({softmaxCrossEntropy_:function(e,t,n,r=0,i=ks.SUM_BY_NONZERO_WEIGHTS){let a=(0,_._1)(e,"onehotLabels","softmaxCrossEntropy");const s=(0,_._1)(t,"logits","softmaxCrossEntropy");let o=null;if(null!=n&&(o=(0,_._1)(n,"weights","softmaxCrossEntropy")),(0,A.k5)(a.shape,s.shape,"Error in softmaxCrossEntropy: "),r>0){const e=(0,en.i)(r),t=(0,en.i)(1),n=(0,en.i)(a.shape[1]);a=(0,Ht.I)((0,Kt.d)(a,(0,on.l)(t,e)),(0,Xt.h)(e,n))}const u=function(e,t,n=-1){if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${t.rank} and dim was ${n}`);const r=(0,Zt.cb)(((e,t,r)=>{const i=(0,Ur.l)(t,[n],!0),a=(0,on.l)((0,_e.p)(t,"float32"),i);r([e,a]);const s=(0,ui.W)((0,Kt.d)(a,e));return{value:(0,la.S)(s,[n]),gradFunc:(e,t)=>{const[r,i]=t,a=(0,ii.rv)(e.shape,[n]);return[(0,Kt.d)((0,Nn.X)(e,a),(0,on.l)((0,_e.p)(r,"float32"),(0,br.Q)(i))),(0,Kt.d)((0,Nn.X)(e,a),(0,on.l)((0,br.Q)(i),(0,_e.p)(r,"float32")))]}}}));return r(e,t)}(a,s);return _s(u,o,i)}}),$s=(0,qe.op)({sparseFillEmptyRows_:function(e,t,n,r){const i=(0,_._1)(e,"indices","sparseFillEmptyRows","int32"),a=(0,_._1)(t,"values","sparseFillEmptyRows"),s=(0,_._1)(n,"denseShape","sparseFillEmptyRows","int32"),o=(0,_._1)(r,"defaultValue","sparseFillEmptyRows",a.dtype);if(2!==i.rank)throw new Error(`Indices should be Tensor2D but received shape\n        ${i.shape}`);if(1!==a.rank)throw new Error(`Values should be Tensor1D but received shape ${a.shape}`);if(1!==s.rank)throw new Error(`Dense shape should be Tensor1D but received shape ${s.shape}`);if(0!==o.rank)throw new Error(`Default value should be a scalar but received shape ${o.shape}`);const u={indices:i,values:a,denseShape:s,defaultValue:o},l=g.BV.runKernel(Ye.O3,u);return{outputIndices:l[0],outputValues:l[1],emptyRowIndicator:l[2],reverseIndexMap:l[3]}}}),Ts=(0,qe.op)({sparseReshape_:function(e,t,n){const r=(0,_._1)(e,"inputIndices","sparseReshape","int32"),i=(0,_._1)(t,"inputShape","sparseReshape","int32"),a=(0,_._1)(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error(`Input indices should be Tensor2D but received shape\n        ${r.shape}`);if(1!==i.rank)throw new Error(`Input shape should be Tensor1D but received shape ${i.shape}`);if(1!==a.rank)throw new Error(`New shape should be Tensor1D but received shape ${a.shape}`);const s={inputIndices:r,inputShape:i,newShape:a},o=g.BV.runKernel(Ye.nh,s);return{outputIndices:o[0],outputShape:o[1]}}}),Os=(0,qe.op)({sparseSegmentMean_:function(e,t,n){const r=(0,_._1)(e,"data","sparseSegmentMean"),i=(0,_._1)(t,"indices","sparseSegmentMean","int32"),a=(0,_._1)(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.rank)throw new Error(`Indices should be Tensor1D but received shape\n          ${i.shape}`);if(1!==a.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n          ${a.shape}`);const s={data:r,indices:i,segmentIds:a};return g.BV.runKernel(Ye.YW,s)}}),Ms=(0,qe.op)({sparseSegmentSum_:function(e,t,n){const r=(0,_._1)(e,"data","sparseSegmentSum"),i=(0,_._1)(t,"indices","sparseSegmentSum","int32"),a=(0,_._1)(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.rank)throw new Error(`Indices should be Tensor1D but received shape\n         ${i.shape}`);if(1!==a.rank)throw new Error(`Segment ids should be Tensor1D but received shape\n         ${a.shape}`);const s={data:r,indices:i,segmentIds:a};return g.BV.runKernel(Ye.Zj,s)}}),Rs=(0,qe.op)({stringNGrams_:function(e,t,n,r,i,a,s,o){const u=(0,_._1)(e,"data","stringNGrams","string");if("string"!==u.dtype)throw new Error("Data must be of datatype string");if(1!==u.shape.length)throw new Error(`Data must be a vector, saw: ${u.shape}`);const l=(0,_._1)(t,"dataSplits","stringNGrams");if("int32"!==l.dtype)throw new Error("Data splits must be of datatype int32");const c={separator:n,nGramWidths:r,leftPad:i,rightPad:a,padWidth:s,preserveShortSequences:o},d={data:u,dataSplits:l},h=g.BV.runKernel(Ye._J,d,c);return{nGrams:h[0],nGramsSplits:h[1]}}}),Bs=(0,qe.op)({stringSplit_:function(e,t,n=!0){const r=(0,_._1)(e,"input","stringSplit","string"),i=(0,_._1)(t,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(0!==i.rank)throw new Error(`Delimiter should be a scalar but received shape ${i.shape}`);const a={skipEmpty:n},s={input:r,delimiter:i},o=g.BV.runKernel(Ye.s1,s,a);return{indices:o[0],values:o[1],shape:o[2]}}}),zs=(0,qe.op)({stringToHashBucketFast_:function(e,t){const n=(0,_._1)(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");const i={input:n};return g.BV.runKernel(Ye.Xk,i,r)}}),Ls={fft:Zi.k,ifft:ea.S,rfft:na.Q,irfft:ta.w},Ps={hammingWindow:Ha,hannWindow:Xa,frame:Ka,stft:Ya},js={flipLeftRight:Ja,grayscaleToRGB:Za,resizeNearestNeighbor:gs.j,resizeBilinear:ps.I,rotateWithOffset:es,cropAndResize:Qa,nonMaxSuppression:ns,nonMaxSuppressionAsync:async function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY){const a=(0,_._1)(e,"boxes","nonMaxSuppressionAsync"),s=(0,_._1)(t,"scores","nonMaxSuppressionAsync"),o=ts(a,s,n,r,i);n=o.maxOutputSize,r=o.iouThreshold,i=o.scoreThreshold;const u=await Promise.all([a.data(),s.data()]),l=u[0],c=u[1],{selectedIndices:d}=as(l,c,n,r,i);return a!==e&&a.dispose(),s!==t&&s.dispose(),da(d,"int32")},nonMaxSuppressionWithScore:hs,nonMaxSuppressionWithScoreAsync:async function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,a=0){const s=(0,_._1)(e,"boxes","nonMaxSuppressionAsync"),o=(0,_._1)(t,"scores","nonMaxSuppressionAsync"),u=ts(s,o,n,r,i,a);n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,a=u.softNmsSigma;const l=await Promise.all([s.data(),o.data()]),c=l[0],d=l[1],{selectedIndices:h,selectedScores:f}=os(c,d,n,r,i,a);return s!==e&&s.dispose(),o!==t&&o.dispose(),{selectedIndices:da(h,"int32"),selectedScores:da(f)}},nonMaxSuppressionPadded:fs,nonMaxSuppressionPaddedAsync:async function(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,a=!1){const s=(0,_._1)(e,"boxes","nonMaxSuppressionAsync"),o=(0,_._1)(t,"scores","nonMaxSuppressionAsync"),u=ts(s,o,n,r,i,null),l=u.maxOutputSize,c=u.iouThreshold,d=u.scoreThreshold,[h,f]=await Promise.all([s.data(),o.data()]),{selectedIndices:p,validOutputs:g}=ss(h,f,l,c,d,a);return s!==e&&s.dispose(),o!==t&&o.dispose(),{selectedIndices:da(p,"int32"),validOutputs:(0,en.i)(g,"int32")}},threshold:ms,transform:ys},Us={bandPart:vs,gramSchmidt:bs,qr:ws},Ws={absoluteDifference:Ss,computeWeightedLoss:_s,cosineDistance:Cs,hingeLoss:As,huberLoss:Es,logLoss:Fs,meanSquaredError:Is,sigmoidCrossEntropy:Ds,softmaxCrossEntropy:Ns},Vs={sparseFillEmptyRows:$s,sparseReshape:Ts,sparseSegmentMean:Os,sparseSegmentSum:Ms},Gs={stringNGrams:Rs,stringSplit:Bs,stringToHashBucketFast:zs},qs={sgd:gn.sgd,momentum:gn.momentum,adadelta:gn.adadelta,adagrad:gn.adagrad,rmsprop:gn.rmsprop,adamax:gn.adamax,adam:gn.adam},Hs="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:e=>e();function Xs(){return new Promise((e=>Hs((()=>e()))))}function Ks(e,t){const n=e[0].length;e.forEach(((e,t)=>{A.hu(e.length===n,(()=>`Error in concat${n}D: rank of tensors[${t}] must be the same as the rank of the rest (${n})`))})),A.hu(t>=0&&t<n,(()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`));const r=e[0];e.forEach(((e,i)=>{for(let a=0;a<n;a++)A.hu(a===t||e[a]===r[a],(()=>`Error in concat${n}D: Shape of tensors[${i}] (${e}) does not match the shape of the rest (${r}) along the non-concatenated axis ${i}.`))}))}function Ys(e,t){const n=e[0].slice();for(let r=1;r<e.length;r++)n[t]+=e[r][t];return n}const Qs=30;function Js(e){return e<=Qs?e:(0,A.jP)(e,Math.floor(Math.sqrt(e)))}function Zs(e,t,n){return[n*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]}function eo(e,t,n,r=!0){let i=[];if(r)i=i.concat(t.slice(0)),i.push(e[0]/n),i=i.concat(e.slice(1));else{i=i.concat(e[0]);const n=t.length;for(let r=0;r<n;++r)i=i.concat([e[r+1]/t[r],t[r]]);i=i.concat(e.slice(n+1))}return i}function to(e,t,n=!0){const r=[];if(n){r.push(t);for(let n=t+1;n<e;++n)n<=2*t?(r.push(n),r.push(n-(t+1))):r.push(n)}else{const n=[],i=[];for(let r=1;r<e;++r)r>=2*t+1||r%2==1?i.push(r):n.push(r);r.push(...n),r.push(0),r.push(...i)}return r}function no(e,t,n,r=!0){const i=[];r?i.push(e[0]/n):i.push(e[0]*n);for(let n=1;n<e.length;++n)n<=t.length?r?i.push(t[n-1]*e[n]):i.push(e[n]/t[n-1]):i.push(e[n]);return i}function ro(e,t){const n=[0];for(let r=0;r<t;++r)n.push(e[r][0]);return n}function io(e,t,n){const r=e.slice(0,1);for(let i=0;i<n;++i)r.push(e[i+1]-t[i][0]-t[i][1]);return r}var ao=n(43179);const so=.3275911,oo=.254829592,uo=-.284496736,lo=1.421413741,co=-1.453152027,ho=1.061405429;var fo=n(64706);function po(e,t){if(e.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${e.length}, imag: ${t.length}.`);const n=new Float32Array(2*e.length);for(let r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function go(e){const t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function mo(e){const t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let t=0;t<e.length;t+=4)n[Math.floor(t/4)]=e[t],r[Math.floor(t/4)]=e[t+1];return{real:n,imag:r}}function yo(e){const t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let t=2;t<e.length;t+=4)n[Math.floor(t/4)]=e[t],r[Math.floor(t/4)]=e[t+1];return{real:n,imag:r}}function vo(e,t){return{real:e[2*t],imag:e[2*t+1]}}function bo(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function xo(e,t){const n=new Float32Array(e/2),r=new Float32Array(e/2);for(let i=0;i<Math.ceil(e/2);i++){const a=(t?2:-2)*Math.PI*(i/e);n[i]=Math.cos(a),r[i]=Math.sin(a)}return{real:n,imag:r}}function wo(e,t,n){const r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}const ko=/->/g;function _o(e,t){const n=((e=e.replace(/\s/g,"")).length-e.replace(ko,"").length)/"->".length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("->").');const[r,i]=e.split("->");(0,A.hu)(-1===r.indexOf("..."),(()=>'The ellipsis notation ("...") is not supported yet.'));const a=r.split(","),s=a.length;if(t!==s)throw new Error(`Expected ${s} input tensors, received ${t}`);if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const o=[];for(let e=0;e<i.length;++e){const t=i[e];if(!a.some((e=>-1!==e.indexOf(t))))throw new Error(`Output subscripts contain the label ${t} not present in the input subscripts.`);-1===o.indexOf(t)&&o.push(t)}for(let e=0;e<r.length;++e){const t=r[e];-1===o.indexOf(t)&&","!==t&&o.push(t)}const u=new Array(a.length);for(let e=0;e<s;++e){if(new Set(a[e].split("")).size!==a[e].length)throw new Error(`Found duplicate axes in input component ${a[e]}. Support for duplicate axes in input is not implemented yet.`);u[e]=[];for(let t=0;t<a[e].length;++t)u[e].push(o.indexOf(a[e][t]))}const l=o.length,c=[];for(let e=i.length;e<l;++e)c.push(e);return{allDims:o,summedDims:c,idDims:u}}function So(e,t){let n=new Array(e);n.fill(-1);for(let e=0;e<t.length;++e)n[t[e]]=e;const r=[];for(let t=0;t<e;++t)-1===n[t]&&r.push(t);return n=n.filter((e=>-1!==e)),{permutationIndices:n,expandDims:r}}function Co(e,t,n){const r=new Array(e);for(let e=0;e<n.length;++e){const i=n[e].shape;for(let n=0;n<t[e].length;++n)void 0===r[t[e][n]]?r[t[e][n]]=i[n]:(0,A.hu)(r[t[e][n]]===i[n],(()=>`Expected dimension ${r[t[e][n]]} at axis ${n} of input shaped ${JSON.stringify(i)}, but got dimension ${i[n]}`))}}function Ao(e,t){const n=e,r=[];let i=0;0===e.length&&n.push(-1),i=e.length+1;for(let e=0;e<i;++e)r.push([]);const a=[];for(let e=0;e<n.length;++e){const i=Fo(t,n[e]);for(const t of i)-1===a.indexOf(t)&&(r[e].push(t),a.push(t))}return{path:n,steps:r}}function Eo(e){return e.every(((e,t)=>e===t))}function Fo(e,t){const n=[];for(let r=0;r<e.length;++r)0!==e[r].length&&-1===e[r].indexOf(t)&&-1!==t||n.push(r);return n}function Io(e,t,n=0){let r=[];if("number"==typeof t)(0,A.hu)(e.shape[n]%t==0,(()=>"Number of splits must evenly divide the axis.")),r=new Array(t).fill(e.shape[n]/t);else{const i=t.reduce(((e,t)=>(-1===t&&(e+=1),e)),0);(0,A.hu)(i<=1,(()=>"There should be only one negative value in split array."));const a=t.indexOf(-1);if(-1!==a){const r=t.reduce(((e,t)=>t>0?e+t:e));t[a]=e.shape[n]-r}(0,A.hu)(e.shape[n]===t.reduce(((e,t)=>e+t)),(()=>"The sum of sizes must match the size of the axis dimension.")),r=t}return r}function Do(e){return`Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ${e}`}function No(e,t){return`indices(${e}, 0) is invalid: ${t} < 0`}function $o(e,t,n){return`indices(${e}, 0) is invalid: ${t} >= ${n}`}function To(e,t){return`only one output dimension may be -1, not both ${e} and ${t}`}function Oo(e,t){return`size ${e} must be non-negative, not ${t}`}function Mo(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Ro(e,t){return`Input to reshape is a SparseTensor with ${(0,A.NA)(e)}\n  dense values, but the requested shape requires a multiple of ${(0,A.NA)(t)}. inputShape=${e} outputShape= ${t}`}function Bo(e,t){return`Input to reshape is a tensor with ${(0,A.NA)(e)} dense values, but the requested shape has ${(0,A.NA)(t)}. inputShape=${e} outputShape=${t}`}function zo(){return"segment ids must be >= 0"}function Lo(){return"segment ids are not increasing"}function Po(e,t){return`Segment id ${e} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function jo(e,t,n){return`Bad: indices[${e}] == ${t} out of range [0, ${n})`}function Uo(e,t){let n,r=!1;for(e<=Qs?(n=e,r=!0):n=(0,A.jP)(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=(0,A.jP)(e,n+1);return n}function Wo(e,t,n){const r=[],i=e.length;for(let a=0;a<i;a++)a!==t?r.push(e[a]):r.push(n);return r}function Vo(e,t,n,r){const i=t.shape.length,a=e.shape.length;if(0!==r&&(r<-i||r>i))throw new Error(`Expect batchDims in the range of [-${i}, ${i}], but got ${r}`);if(r<0&&(r+=i),r>a)throw new Error(`batchDims (${r}) must be less than rank(x) (\n    ${a}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let n=0;n<r;++n)if(e.shape[n]!==t.shape[n])throw new Error(`x.shape[${n}]: ${e.shape[n]} should be equal to indices.shape[${n}]: ${t.shape[n]}.`);const s=e.shape[n],o=[];let u=1,l=1,c=1;for(let t=0;t<r;++t)o.push(e.shape[t]),u*=e.shape[t];for(let t=r;t<n;t++)o.push(e.shape[t]),l*=e.shape[t];for(let e=r;e<i;e++)o.push(t.shape[e]);for(let t=n+1;t<a;t++)o.push(e.shape[t]),c*=e.shape[t];return{batchSize:u,sliceSize:c,outerSize:l,dimSize:s,outputShape:o}}function Go(e){try{return e.map((e=>(0,ft.decodeString)(e)))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function qo(e){return e.map((e=>(0,ft.encodeString)(e)))}var Ho=n(68713)},29121:(e,t,n)=>{"use strict";n.d(t,{$H:()=>ct,$g:()=>Z,$w:()=>X,Ac:()=>me,BM:()=>Re,By:()=>P,CA:()=>Ce,D2:()=>Lt,Dl:()=>ot,Eh:()=>N,FK:()=>Dt,G3:()=>Jt,GB:()=>Nt,Gc:()=>Ot,HE:()=>te,HZ:()=>ht,Hh:()=>Oe,Hm:()=>pt,IK:()=>l,IM:()=>x,J$:()=>_e,J_:()=>be,Jh:()=>y,Kg:()=>it,L8:()=>Tt,Ly:()=>S,M2:()=>h,MI:()=>Xt,MR:()=>It,MZ:()=>Ne,NE:()=>ie,NZ:()=>He,O3:()=>Mt,OA:()=>Le,OR:()=>ce,OU:()=>Pe,OV:()=>ze,Om:()=>ne,Oy:()=>g,PY:()=>Ie,Ph:()=>kt,QC:()=>m,QR:()=>W,Qg:()=>ve,Qi:()=>nt,Qv:()=>tn,RF:()=>A,RO:()=>v,RQ:()=>Ct,Ru:()=>nn,SX:()=>ee,SY:()=>r,Sb:()=>yt,Sp:()=>a,T0:()=>V,TQ:()=>$t,TR:()=>L,To:()=>en,Tr:()=>qt,Uy:()=>le,VG:()=>i,Vb:()=>qe,Vc:()=>U,Vf:()=>De,Vn:()=>Q,W0:()=>Ze,XL:()=>w,Xk:()=>Gt,Xz:()=>o,Y0:()=>se,YF:()=>ae,YW:()=>Bt,Yo:()=>Me,Zb:()=>Ee,Zj:()=>zt,Zz:()=>I,_J:()=>Wt,_V:()=>un,_Y:()=>gt,_k:()=>b,_t:()=>Pt,a5:()=>Ft,aJ:()=>d,av:()=>xe,b9:()=>sn,bK:()=>jt,bV:()=>xt,c1:()=>We,cW:()=>Yt,ci:()=>G,cy:()=>Je,de:()=>ue,dp:()=>ft,e0:()=>bt,e6:()=>ut,e7:()=>Ae,eB:()=>an,eE:()=>C,eZ:()=>Te,ek:()=>Y,gJ:()=>E,h8:()=>rn,hd:()=>re,i5:()=>Et,iH:()=>j,iJ:()=>ye,iW:()=>we,iZ:()=>ge,ik:()=>B,jM:()=>p,jQ:()=>Ge,je:()=>de,kU:()=>Fe,kp:()=>Zt,ku:()=>Ke,lu:()=>ln,ly:()=>rt,m2:()=>Ut,mK:()=>vt,mT:()=>Be,mc:()=>z,mh:()=>$,mm:()=>s,n9:()=>Kt,nh:()=>Rt,o0:()=>st,o2:()=>R,oF:()=>_t,oH:()=>J,oT:()=>u,p2:()=>St,p4:()=>K,pe:()=>at,q1:()=>pe,q2:()=>Ue,q8:()=>Ve,qC:()=>$e,qW:()=>et,qi:()=>fe,qk:()=>dt,qw:()=>f,r7:()=>ke,s1:()=>Vt,sE:()=>Ht,sH:()=>he,sJ:()=>c,sL:()=>q,us:()=>on,uv:()=>Qe,vF:()=>je,vt:()=>Se,vw:()=>oe,w3:()=>At,wU:()=>T,wY:()=>Xe,we:()=>tt,wm:()=>O,wx:()=>Qt,x1:()=>M,xJ:()=>lt,xQ:()=>wt,xn:()=>F,y7:()=>H,yQ:()=>Ye,yj:()=>D,zb:()=>mt,zv:()=>_,zw:()=>k});const r="Abs",i="Acos",a="Acosh",s="Add",o="AddN",u="All",l="Any",c="ArgMax",d="ArgMin",h="Asin",f="Asinh",p="Atan",g="Atanh",m="Atan2",y="AvgPool",v="AvgPoolGrad",b="AvgPool3D",x="AvgPool3DGrad",w="BatchMatMul",k="BatchToSpaceND",_="Bincount",S="BroadcastTo",C="BroadcastArgs",A="Cast",E="Ceil",F="ClipByValue",I="Complex",D="ComplexAbs",N="Concat",$="Conv2D",T="Conv2DBackpropFilter",O="Conv2DBackpropInput",M="Conv3D",R="Conv3DBackpropFilterV2",B="Conv3DBackpropInputV2",z="Cos",L="Cosh",P="Cumprod",j="Cumsum",U="CropAndResize",W="DenseBincount",V="DepthToSpace",G="DepthwiseConv2dNative",q="DepthwiseConv2dNativeBackpropFilter",H="DepthwiseConv2dNativeBackpropInput",X="Diag",K="Dilation2D",Y="Dilation2DBackpropInput",Q="Dilation2DBackpropFilter",J="RealDiv",Z="Einsum",ee="Elu",te="EluGrad",ne="Erf",re="Equal",ie="Exp",ae="ExpandDims",se="Expm1",oe="FFT",ue="Fill",le="FlipLeftRight",ce="Floor",de="FloorDiv",he="FusedBatchNorm",fe="GatherV2",pe="GatherNd",ge="Greater",me="GreaterEqual",ye="Identity",ve="IFFT",be="Imag",xe="IsFinite",we="IsInf",ke="IsNan",_e="LeakyRelu",Se="Less",Ce="LessEqual",Ae="LinSpace",Ee="Log",Fe="Log1p",Ie="LogicalAnd",De="LogicalNot",Ne="LogicalOr",$e="LogSoftmax",Te="LRN",Oe="LRNGrad",Me="Max",Re="Maximum",Be="MaxPool",ze="MaxPoolGrad",Le="MaxPool3D",Pe="MaxPool3DGrad",je="MaxPoolWithArgmax",Ue="Mean",We="Min",Ve="Minimum",Ge="MirrorPad",qe="Mod",He="Multinomial",Xe="Multiply",Ke="Neg",Ye="NotEqual",Qe="NonMaxSuppressionV3",Je="NonMaxSuppressionV4",Ze="NonMaxSuppressionV5",et="OnesLike",tt="OneHot",nt="Pack",rt="PadV2",it="Pool",at="Pow",st="Prelu",ot="Prod",ut="Range",lt="Real",ct="Reciprocal",dt="Relu",ht="Reshape",ft="ResizeNearestNeighbor",pt="ResizeNearestNeighborGrad",gt="ResizeBilinear",mt="ResizeBilinearGrad",yt="Relu6",vt="Reverse",bt="Round",xt="Rsqrt",wt="ScatterNd",kt="Select",_t="Selu",St="Slice",Ct="Sin",At="Sinh",Et="Sign",Ft="Sigmoid",It="Softplus",Dt="Sqrt",Nt="Sum",$t="SpaceToBatchND",Tt="SplitV",Ot="Softmax",Mt="SparseFillEmptyRows",Rt="SparseReshape",Bt="SparseSegmentMean",zt="SparseSegmentSum",Lt="SparseToDense",Pt="SquaredDifference",jt="Square",Ut="StridedSlice",Wt="StringNGrams",Vt="StringSplit",Gt="StringToHashBucketFast",qt="Sub",Ht="Tan",Xt="Tanh",Kt="Tile",Yt="TopK",Qt="Transform",Jt="Transpose",Zt="Unique",en="Unpack",tn="UnsortedSegmentSum",nn="ZerosLike",rn="Step",an="FromPixels",sn="RotateWithOffset",on="_FusedMatMul",un="FusedConv2D",ln="FusedDepthwiseConv2D"},26151:(e,t,n)=>{"use strict";n.d(t,{Li:()=>h,T3:()=>g,bt:()=>p,nE:()=>f,pI:()=>u,tr:()=>c,uk:()=>l,wC:()=>d});var r=n(22885),i=n(55938),a=n(64706);const s=(0,i.R)("kernelRegistry",(()=>new Map)),o=(0,i.R)("gradRegistry",(()=>new Map));function u(e,t){const n=m(e,t);return s.get(n)}function l(e){return o.get(e)}function c(e){const t=s.entries(),n=[];for(;;){const{done:r,value:i}=t.next();if(r)break;const[a,s]=i,[o]=a.split("_");o===e&&n.push(s)}return n}function d(e){const{kernelName:t,backendName:n}=e,r=m(t,n);s.has(r)&&a.Z(`The kernel '${t}' for backend '${n}' is already registered`),s.set(r,e)}function h(e){const{kernelName:t}=e;o.has(t)&&(0,r.OB)().getBool("DEBUG")&&a.Z(`Overriding the gradient for '${t}'`),o.set(t,e)}function f(e,t){const n=m(e,t);if(!s.has(n))throw new Error(`The kernel '${e}' for backend '${t}' is not registered`);s.delete(n)}function p(e){if(!o.has(e))throw new Error(`The gradient '${e}' for backend is not registered`);o.delete(e)}function g(e,t){c(e).forEach((e=>{d(Object.assign({},e,{backendName:t}))}))}function m(e,t){return`${t}_${e}`}},64706:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i,c:()=>a});var r=n(22885);function i(...e){(0,r.OB)().getBool("IS_TEST")||(0,r.OB)().getBool("PROD")||console.warn(...e)}function a(...e){(0,r.OB)().getBool("IS_TEST")||(0,r.OB)().getBool("PROD")||console.log(...e)}},96235:(e,t,n)=>{"use strict";n.d(t,{W:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({abs_:function(e){const t=(0,a._1)(e,"x","abs");if("complex64"===t.dtype){const e={x:t};return r.BV.runKernel(i.yj,e)}{const e={x:t};return r.BV.runKernel(i.SY,e)}}})},17839:(e,t,n)=>{"use strict";n.d(t,{K:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({acos_:function(e){const t={x:(0,a._1)(e,"x","acos")};return r.BV.runKernel(i.VG,t)}})},91470:(e,t,n)=>{"use strict";n.d(t,{_:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({acosh_:function(e){const t={x:(0,a._1)(e,"x","acosh")};return r.BV.runKernel(i.Sp,t)}})},56407:(e,t,n)=>{"use strict";n.d(t,{I:()=>o});var r=n(97097),i=n(29121),a=n(80747),s=n(43740);const o=(0,n(2668).op)({add_:function(e,t){let n=(0,s._1)(e,"a","add"),o=(0,s._1)(t,"b","add");[n,o]=(0,a.makeTypesMatch)(n,o);const u={a:n,b:o};return r.BV.runKernel(i.mm,u)}})},90781:(e,t,n)=>{"use strict";n.d(t,{$:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({all_:function(e,t=null,n=!1){const s={x:(0,a._1)(e,"x","all","bool")},o={axis:t,keepDims:n};return r.BV.runKernel(i.oT,s,o)}})},92998:(e,t,n)=>{"use strict";n.d(t,{Y:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({any_:function(e,t=null,n=!1){const s={x:(0,a._1)(e,"x","any","bool")},o={axis:t,keepDims:n};return r.BV.runKernel(i.IK,s,o)}})},40047:(e,t,n)=>{"use strict";n.d(t,{N:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({argMax_:function(e,t=0){const n={x:(0,a._1)(e,"x","argMax")},s={axis:t};return r.BV.runKernel(i.sJ,n,s)}})},27394:(e,t,n)=>{"use strict";n.d(t,{v:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({argMin_:function(e,t=0){const n={x:(0,a._1)(e,"x","argMin")},s={axis:t};return r.BV.runKernel(i.aJ,n,s)}})},72421:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({asin_:function(e){const t={x:(0,a._1)(e,"x","asin")};return r.BV.runKernel(i.M2,t)}})},21891:(e,t,n)=>{"use strict";n.d(t,{V:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({asinh_:function(e){const t={x:(0,a._1)(e,"x","asinh")};return r.BV.runKernel(i.qw,t)}})},77037:(e,t,n)=>{"use strict";n.d(t,{z:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({atan_:function(e){const t={x:(0,a._1)(e,"x","atan")};return r.BV.runKernel(i.jM,t)}})},29812:(e,t,n)=>{"use strict";n.d(t,{f:()=>o});var r=n(97097),i=n(29121),a=n(80747),s=n(43740);const o=(0,n(2668).op)({atan2_:function(e,t){let n=(0,s._1)(e,"a","atan2"),o=(0,s._1)(t,"b","atan2");[n,o]=(0,a.makeTypesMatch)(n,o);const u={a:n,b:o};return r.BV.runKernel(i.QC,u)}})},80369:(e,t,n)=>{"use strict";n.d(t,{C:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({atanh_:function(e){const t={x:(0,a._1)(e,"x","atanh")};return r.BV.runKernel(i.Oy,t)}})},15176:(e,t,n)=>{"use strict";n.d(t,{w:()=>d});var r=n(97097),i=n(29121),a=n(43740),s=n(20569),o=n(62271),u=n(2582),l=n(2668),c=n(4968);const d=(0,l.op)({avgPool_:function(e,t,n,l,d){const h=(0,a._1)(e,"x","avgPool","float32");s.hu(u.jT(n,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`));let f=h,p=!1;3===h.rank&&(p=!0,f=(0,c.X)(h,[1,h.shape[0],h.shape[1],h.shape[2]])),s.hu(4===f.rank,(()=>`Error in avgPool: x must be rank 4 but got rank ${f.rank}.`)),u.m("avgPool",l,d);const g={x:f},m={filterSize:t,strides:n,pad:l,dimRoundingMode:d};let y=r.BV.runKernel(i.Jh,g,m);return y=(0,o.p)(y,h.dtype),p?(0,c.X)(y,[y.shape[1],y.shape[2],y.shape[3]]):y}})},83591:(e,t,n)=>{"use strict";n.d(t,{LJ:()=>c,Q3:()=>l,Vh:()=>a,YB:()=>i,kz:()=>s,lB:()=>u,rv:()=>o,sY:()=>d});var r=n(20569);function i(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function a(e,t,n){const r=e.length+t.length,i=[];let a=0,s=0;for(let o=0;o<r;o++)-1===n.indexOf(o)?i.push(e[a++]):i.push(t[s++]);return i}function s(e,t){const n=[],r=e.length;for(let i=0;i<r;i++)-1===t.indexOf(i)&&n.push(e[i]);return[n,t.map((t=>e[t]))]}function o(e,t){return a(e,t.map((e=>1)),t)}function u(e,t,n){r.hu(i(t,n),(()=>`${e} supports only inner-most axes for now. Got axes ${t} and rank-${n} input.`))}function l(e,t){if(i(e,t))return null;const n=[];for(let r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((e=>n.push(e))),n}function c(e){return e.map(((e,t)=>[t,e])).sort(((e,t)=>e[1]-t[1])).map((e=>e[0]))}function d(e,t){const n=[];for(let r=t-e;r<t;++r)n.push(r);return n}},28441:(e,t,n)=>{"use strict";n.d(t,{E:()=>o});var r=n(97097),i=n(29121),a=n(43740),s=n(20569);const o=(0,n(2668).op)({batchToSpaceND_:function(e,t,n){const o=(0,a._1)(e,"x","batchToSpaceND"),u=t.reduce(((e,t)=>e*t));s.hu(o.rank>=1+t.length,(()=>`input rank is ${o.rank} but should be > than blockShape.length ${t.length}`)),s.hu(n.length===t.length,(()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${t.length}`)),s.hu(o.shape[0]%u==0,(()=>`input tensor batch is ${o.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${u}`));const l={x:o},c={blockShape:t,crops:n};return r.BV.runKernel(i.zw,l,c)}})},27505:(e,t,n)=>{"use strict";n.d(t,{t:()=>u});var r=n(97097),i=n(29121),a=n(43740),s=n(20569),o=n(4968);const u=(0,n(2668).op)({batchNorm_:function(e,t,n,u,l,c){null==c&&(c=.001);const d=(0,a._1)(e,"x","batchNorm"),h=(0,a._1)(t,"mean","batchNorm"),f=(0,a._1)(n,"variance","batchNorm");let p,g;null!=l&&(p=(0,a._1)(l,"scale","batchNorm")),null!=u&&(g=(0,a._1)(u,"offset","batchNorm")),s.hu(h.rank===f.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),s.hu(null==g||h.rank===g.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),s.hu(null==p||h.rank===p.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const m=function(e){let t;return t=0===e.rank||1===e.rank?(0,o.X)(e,[1,1,1,e.size]):2===e.rank?(0,o.X)(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?(0,o.X)(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e,t}(d),y={x:m,scale:p,offset:g,mean:h,variance:f},v={varianceEpsilon:c},b=r.BV.runKernel(i.sH,y,v);return(0,o.X)(b,d.shape)}})},68247:(e,t,n)=>{"use strict";n.d(t,{U:()=>l});var r=n(97097),i=n(29121),a=n(43740),s=n(8723),o=n(2668),u=n(4968);const l=(0,o.op)({broadcastTo_:function(e,t){let n=(0,a._1)(e,"broadcastTo","x");const o=n.shape;if(t.some((e=>!(e>0)||e%1!=0)))throw new Error(`broadcastTo(): Invalid broadcast shape [${t}].`);if(t.length<n.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${n.rank}.`);if(t.length>n.rank){const e=n.shape.slice();for(;e.length<t.length;)e.unshift(1);n=(0,u.X)(n,e)}const l=n.shape,c=Array.from(t);for(let e=t.length-1;e>=0;e--)if(l[e]===t[e])c[e]=1;else if(1!==n.shape[e])throw new Error(`broadcastTo(): [${o}] cannot be broadcast to [${t}].`);if(0===c.map(((e,t)=>e>1?t:-1)).filter((e=>e>=0)).length)return(0,s.d)(n);const d={x:n},h={reps:c};return r.BV.runKernel(i.n9,d,h)}})},72200:(e,t,n)=>{"use strict";function r(e,t){const n=e.length,r=[];for(let i=0;i<n;i++){const a=n-1-i,s=e[a]||1;(t[t.length-1-i]||1)>1&&1===s&&r.unshift(a)}return r}function i(e,t){const n=[];for(let r=0;r<t.length;r++){const i=e[e.length-r-1],a=t.length-r-1,s=t[a];(null==i||1===i&&s>1)&&n.unshift(a)}return n}function a(e,t){const n=[],r=Math.max(e.length,t.length);for(let i=0;i<r;i++){let r=e[e.length-i-1];null==r&&(r=1);let a=t[t.length-i-1];if(null==a&&(a=1),1===r)n.unshift(a);else if(1===a)n.unshift(r);else{if(r!==a)throw Error(`Operands could not be broadcast together with shapes ${e} and ${t}.`);n.unshift(r)}}return n}n.r(t),n.d(t,{assertAndGetBroadcastShape:()=>a,getBroadcastDims:()=>r,getReductionAxes:()=>i})},62271:(e,t,n)=>{"use strict";n.d(t,{p:()=>o});var r=n(97097),i=n(29121),a=n(43740),s=n(20569);const o=(0,n(2668).op)({cast_:function(e,t){const n=(0,a._1)(e,"x","cast");if(!s.LP(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const o={x:n},u={dtype:t};return r.BV.runKernel(i.RF,o,u)}})},6825:(e,t,n)=>{"use strict";n.d(t,{m:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({ceil_:function(e){const t={x:(0,a._1)(e,"x","ceil","float32")};return r.BV.runKernel(i.gJ,t)}})},42279:(e,t,n)=>{"use strict";n.d(t,{i:()=>o});var r=n(97097),i=n(29121),a=n(43740),s=n(20569);const o=(0,n(2668).op)({clipByValue_:function(e,t,n){const o=(0,a._1)(e,"x","clipByValue");s.hu(t<=n,(()=>`Error in clip: min (${t}) must be less than or equal to max (${n}).`));const u={x:o},l={clipValueMin:t,clipValueMax:n};return r.BV.runKernel(i.xn,u,l)}})},8723:(e,t,n)=>{"use strict";n.d(t,{d:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({clone_:function(e){const t={x:(0,a._1)(e,"x","clone","string_or_numeric")};return r.BV.runKernel(i.iJ,t)}})},61661:(e,t,n)=>{"use strict";n.d(t,{P:()=>o});var r=n(97097),i=n(29121),a=n(43740),s=n(20569);const o=(0,n(2668).op)({complex_:function(e,t){const n=(0,a._1)(e,"real","complex"),o=(0,a._1)(t,"imag","complex");s.k5(n.shape,o.shape,`real and imag shapes, ${n.shape} and ${o.shape}, must match in call to tf.complex().`);const u={real:n,imag:o};return r.BV.runKernel(i.Zz,u)}})},46884:(e,t,n)=>{"use strict";n.d(t,{z:()=>u});var r=n(97097),i=n(29121),a=n(43740),s=n(20569),o=n(8723);const u=(0,n(2668).op)({concat_:function(e,t=0){(0,s.hu)(e.length>=1,(()=>"Pass at least one tensor to concat"));const n=(0,a.sI)(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((e=>{if("complex64"!==e.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${e.dtype}. `)})),1===n.length)return(0,o.d)(n[0]);const u=n,l={axis:t};return r.BV.runKernel(i.Eh,u,l)}})},11355:(e,t,n)=>{"use strict";n.d(t,{P:()=>l});var r=n(43740),i=n(20569),a=n(64794),s=n(2582),o=n(2668),u=n(4968);const l=(0,o.op)({conv1d_:function(e,t,n,o,l="NWC",c=1,d){const h=(0,r._1)(e,"x","conv1d"),f=(0,r._1)(t,"filter","conv1d");let p=h,g=!1;2===h.rank&&(g=!0,p=(0,u.X)(h,[1,h.shape[0],h.shape[1]])),i.hu(3===p.rank,(()=>`Error in conv1d: input must be rank 3, but got rank ${p.rank}.`)),i.hu(3===f.rank,(()=>`Error in conv1d: filter must be rank 3, but got rank ${f.rank}.`)),s.m("conv1d",o,d),i.hu(p.shape[2]===f.shape[1],(()=>`Error in conv1d: depth of input (${p.shape[2]}) must match input depth for filter ${f.shape[1]}.`)),i.hu(s.jT(n,c),(()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${c}'`)),i.hu("NWC"===l,(()=>`Error in conv1d: got dataFormat of ${l} but only NWC is currently supported.`));const m=(0,u.X)(f,[1,f.shape[0],f.shape[1],f.shape[2]]),y=(0,u.X)(p,[p.shape[0],1,p.shape[1],p.shape[2]]),v=[1,n],b=[1,c],x=(0,a.T)(y,m,v,o,"NHWC",b,d);return g?(0,u.X)(x,[x.shape[2],x.shape[3]]):(0,u.X)(x,[x.shape[0],x.shape[2],x.shape[3]])}})},64794:(e,t,n)=>{"use strict";n.d(t,{T:()=>c});var r=n(97097),i=n(29121),a=n(43740),s=n(20569),o=n(2582),u=n(2668),l=n(4968);const c=(0,u.op)({conv2d_:function(e,t,n,u,c="NHWC",d=[1,1],h){const f=(0,a._1)(e,"x","conv2d","float32"),p=(0,a._1)(t,"filter","conv2d","float32");let g=f,m=!1;3===f.rank&&(m=!0,g=(0,l.X)(f,[1,f.shape[0],f.shape[1],f.shape[2]])),s.hu(4===g.rank,(()=>`Error in conv2d: input must be rank 4, but got rank ${g.rank}.`)),s.hu(4===p.rank,(()=>`Error in conv2d: filter must be rank 4, but got rank ${p.rank}.`)),o.m("conv2d",u,h);const y="NHWC"===c?g.shape[3]:g.shape[1];s.hu(y===p.shape[2],(()=>`Error in conv2d: depth of input (${y}) must match input depth for filter ${p.shape[2]}.`)),s.hu(o.jT(n,d),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${d}'`));const v={x:g,filter:p},b={strides:n,pad:u,dataFormat:c,dilations:d,dimRoundingMode:h},x=r.BV.runKernel(i.mh,v,b);return m?(0,l.X)(x,[x.shape[1],x.shape[2],x.shape[3]]):x}})},36013:(e,t,n)=>{"use strict";n.d(t,{p:()=>l});var r=n(97097),i=n(29121),a=n(20569),s=n(2582),o=n(2668),u=n(4968);const l=(0,o.op)({conv2DBackpropFilter_:function(e,t,n,o,l,c="NHWC",d){let h=e;3===e.rank&&(h=(0,u.X)(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let f=t;3===f.rank&&(f=(0,u.X)(t,[1,t.shape[0],t.shape[1],t.shape[2]])),a.hu(4===h.rank,(()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${h.shape}.`)),a.hu(4===f.rank,(()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${f.shape}.`)),a.hu(4===n.length,(()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`));const p="NHWC"===c?h.shape[3]:h.shape[1],g="NHWC"===c?f.shape[3]:f.shape[1];a.hu(p===n[2],(()=>`Error in conv2dDerFilter: depth of input ${p}) must match input depth in filter (${n[2]}.`)),a.hu(g===n[3],(()=>`Error in conv2dDerFilter: depth of dy (${g}) must match output depth for filter (${n[3]}).`)),s.m("conv2dDerFilter",l,d);const m={x:h,dy:f},y={strides:o,pad:l,dataFormat:c,dimRoundingMode:d,filterShape:n};return r.BV.runKernel(i.wU,m,y)}})},39832:(e,t,n)=>{"use strict";n.d(t,{_:()=>l});var r=n(97097),i=n(29121),a=n(20569),s=n(2582),o=n(2668),u=n(4968);const l=(0,o.op)({conv2DBackpropInput_:function(e,t,n,o,l,c="NHWC",d){a.hu(e.length===t.rank,(()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`));let h=e,f=t,p=!1;3===t.rank&&(p=!0,f=(0,u.X)(t,[1,t.shape[0],t.shape[1],t.shape[2]]),h=[1,e[0],e[1],e[2]]),a.hu(4===h.length,(()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${h.length}.`)),a.hu(4===f.rank,(()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${f.rank}`)),a.hu(4===n.rank,(()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`));const g="NHWC"===c?h[3]:h[1],m="NHWC"===c?f.shape[3]:f.shape[1];a.hu(g===n.shape[2],(()=>`Error in conv2dDerInput: depth of input (${g}) must match input depth for filter ${n.shape[2]}.`)),a.hu(m===n.shape[3],(()=>`Error in conv2dDerInput: depth of output (${m}) must match output depth for filter ${n.shape[3]}.`)),s.m("conv2dDerInput",l,d);const y={dy:f,filter:n},v={strides:o,pad:l,dataFormat:c,dimRoundingMode:d,inputShape:h},b=r.BV.runKernel(i.wm,y,v);return p?(0,u.X)(b,[b.shape[1],b.shape[2],b.shape[3]]):b}})},71405:(e,t,n)=>{"use strict";n.d(t,{b:()=>a});var r=n(43740),i=n(39832);const a=(0,n(2668).op)({conv2dTranspose_:function(e,t,n,a,s,o){const u=(0,r._1)(e,"x","conv2dTranspose"),l=(0,r._1)(t,"filter","conv2dTranspose");return(0,i._)(n,u,l,a,s,"NHWC",o)}})},97594:(e,t,n)=>{"use strict";n.d(t,{_:()=>u});var r=n(97097),i=n(29121),a=n(20569),s=n(2668),o=n(4968);const u=(0,s.op)({conv3DBackpropInput_:function(e,t,n,s,u){a.hu(e.length===t.rank,(()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`));let l=e,c=t,d=!1;4===t.rank&&(d=!0,c=(0,o.X)(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),l=[1,e[0],e[1],e[2],e[3]]);const h=l[4],f=c.shape[4];a.hu(5===l.length,(()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${l.length}.`)),a.hu(5===c.rank,(()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${c.rank}`)),a.hu(5===n.rank,(()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`)),a.hu(h===n.shape[3],(()=>`Error in conv3dDerInput: depth of input (${h}) must match input depth for filter ${n.shape[3]}.`)),a.hu(f===n.shape[4],(()=>`Error in conv3dDerInput: depth of output (${f}) must match output depth for filter ${n.shape[4]}.`));const p={dy:c,filter:n},g={pad:u,strides:s,inputShape:l},m=r.BV.runKernel(i.ik,p,g);return d?(0,o.X)(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}})},2582:(e,t,n)=>{"use strict";n.d(t,{I0:()=>p,Ix:()=>o,Rf:()=>i,Xw:()=>a,aO:()=>l,jT:()=>g,jw:()=>u,m:()=>y,pl:()=>s,sl:()=>m});var r=n(20569);function i(e,t,n,r,i="NHWC",a){return o(e,[...t,e[3]],n,a,r,null,null,m(i))}function a(e,t,n,r,i,a,s="channelsLast"){const[u,l]=c(t);let d;if("channelsLast"===s)d=[u,l,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error(`Unknown dataFormat ${s}`);d=[u,l,e[1],e[1]]}return o(e,d,n,r,i,a,!1,s)}function s(e,t,n,r,i,a,s="NDHWC"){const[o,l,c]=d(t);let h,f;if("NDHWC"===s)f="channelsLast",h=[o,l,c,e[4],e[4]];else{if("NCDHW"!==s)throw new Error(`Unknown dataFormat ${s}`);f="channelsFirst",h=[o,l,c,e[1],e[1]]}return u(e,h,n,r,i,!1,f,a)}function o(e,t,n,r,i,a,s=!1,o="channelsLast"){let[u,d,p,g]=[-1,-1,-1,-1];if("channelsLast"===o)[u,d,p,g]=e;else{if("channelsFirst"!==o)throw new Error(`Unknown dataFormat ${o}`);[u,g,d,p]=e}const[m,y,,v]=t,[b,x]=c(n),[w,k]=c(r),_=h(m,w),S=h(y,k),{padInfo:C,outHeight:A,outWidth:E}=function(e,t,n,r,i,a,s,o,u){let c,d,h;if("number"==typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};const i=function(e,t,n,r,i){null==r&&(r=l(e,t,n));const a=e[1];return[f((e[0]-t+2*r)/n+1,i),f((a-t+2*r)/n+1,i)]}([t,n],a,r,e,o);d=i[0],h=i[1]}else if("same"===e){d=Math.ceil(t/r),h=Math.ceil(n/i);const e=Math.max(0,(d-1)*r+a-t),o=Math.max(0,(h-1)*i+s-n),u=Math.floor(e/2),l=e-u,f=Math.floor(o/2);c={top:u,bottom:l,left:f,right:o-f,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},d=Math.ceil((t-a+1)/r),h=Math.ceil((n-s+1)/i);else{if("object"!=typeof e)throw Error(`Unknown padding parameter: ${e}`);{const l="channelsLast"===u?e[1][0]:e[2][0],p="channelsLast"===u?e[1][1]:e[2][1],g="channelsLast"===u?e[2][0]:e[3][0],m="channelsLast"===u?e[2][1]:e[3][1];c={top:l,bottom:p,left:g,right:m,type:0===l&&0===p&&0===g&&0===m?"VALID":"EXPLICIT"},d=f((t-a+l+p)/r+1,o),h=f((n-s+g+m)/i+1,o)}}return{padInfo:c,outHeight:d,outWidth:h}}(i,d,p,b,x,_,S,a,o),F=s?v*g:v;let I;return"channelsFirst"===o?I=[u,F,A,E]:"channelsLast"===o&&(I=[u,A,E,F]),{batchSize:u,dataFormat:o,inHeight:d,inWidth:p,inChannels:g,outHeight:A,outWidth:E,outChannels:F,padInfo:C,strideHeight:b,strideWidth:x,filterHeight:m,filterWidth:y,effectiveFilterHeight:_,effectiveFilterWidth:S,dilationHeight:w,dilationWidth:k,inShape:e,outShape:I,filterShape:t}}function u(e,t,n,r,i,a=!1,s="channelsLast",o){let[u,c,p,g,m]=[-1,-1,-1,-1,-1];if("channelsLast"===s)[u,c,p,g,m]=e;else{if("channelsFirst"!==s)throw new Error(`Unknown dataFormat ${s}`);[u,m,c,p,g]=e}const[y,v,b,,x]=t,[w,k,_]=d(n),[S,C,A]=d(r),E=h(y,S),F=h(v,C),I=h(b,A),{padInfo:D,outDepth:N,outHeight:$,outWidth:T}=function(e,t,n,r,i,a,s,o,u,c,d){let h,p,g,m;if("number"==typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};const a=function(e,t,n,r,i,a){null==i&&(i=l(e,t,r));const s=e[1],o=e[2];return[f((e[0]-t+2*i)/r+1,a),f((s-t+2*i)/r+1,a),f((o-t+2*i)/r+1,a),1]}([t,n,r,1],o,0,i,e,d);p=a[0],g=a[1],m=a[2]}else if("same"===e){p=Math.ceil(t/i),g=Math.ceil(n/a),m=Math.ceil(r/s);const e=(p-1)*i+o-t,l=(g-1)*a+u-n,d=(m-1)*s+c-r,f=Math.floor(e/2),y=e-f,v=Math.floor(l/2),b=l-v,x=Math.floor(d/2);h={top:v,bottom:b,left:x,right:d-x,front:f,back:y,type:"SAME"}}else{if("valid"!==e)throw Error(`Unknown padding parameter: ${e}`);h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},p=Math.ceil((t-o+1)/i),g=Math.ceil((n-u+1)/a),m=Math.ceil((r-c+1)/s)}return{padInfo:h,outDepth:p,outHeight:g,outWidth:m}}(i,c,p,g,w,k,_,E,F,I,o),O=a?x*m:x;let M;return"channelsFirst"===s?M=[u,O,N,$,T]:"channelsLast"===s&&(M=[u,N,$,T,O]),{batchSize:u,dataFormat:s,inDepth:c,inHeight:p,inWidth:g,inChannels:m,outDepth:N,outHeight:$,outWidth:T,outChannels:O,padInfo:D,strideDepth:w,strideHeight:k,strideWidth:_,filterDepth:y,filterHeight:v,filterWidth:b,effectiveFilterDepth:E,effectiveFilterHeight:F,effectiveFilterWidth:I,dilationDepth:S,dilationHeight:C,dilationWidth:A,inShape:e,outShape:M,filterShape:t}}function l(e,t,n,r=1){const i=h(t,r);return Math.floor((e[0]*(n-1)-n+i)/2)}function c(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function d(e){return"number"==typeof e?[e,e,e]:e}function h(e,t){return t<=1?e:e+(e-1)*(t-1)}function f(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error(`Unknown roundingMode ${t}`)}}function p(e){const[t,n,r]=c(e);return 1===t&&1===n&&1===r}function g(e,t){return p(e)||p(t)}function m(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error(`Unknown dataFormat ${e}`)}function y(e,t,n){if(null!=n){if("string"==typeof t)throw Error(`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);if("number"==typeof t)r.hu(r.GN(t),(()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`));else{if("object"!=typeof t)throw Error(`Error in ${e}: Unknown padding parameter: ${t}`);t.forEach((t=>{t.forEach((t=>{r.hu(r.GN(t),(()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`))}))}))}}}},70173:(e,t,n)=>{"use strict";n.d(t,{m:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({cos_:function(e){const t={x:(0,a._1)(e,"x","cos","float32")};return r.BV.runKernel(i.mc,t)}})},2699:(e,t,n)=>{"use strict";n.d(t,{f:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({cosh_:function(e){const t={x:(0,a._1)(e,"x","cosh","float32")};return r.BV.runKernel(i.TR,t)}})},9640:(e,t,n)=>{"use strict";n.d(t,{$:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({cumprod_:function(e,t=0,n=!1,s=!1){const o={x:(0,a._1)(e,"x","cumprod")},u={axis:t,exclusive:n,reverse:s};return r.BV.runKernel(i.By,o,u)}})},37405:(e,t,n)=>{"use strict";n.d(t,{z:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({cumsum_:function(e,t=0,n=!1,s=!1){const o={x:(0,a._1)(e,"x","cumsum")},u={axis:t,exclusive:n,reverse:s};return r.BV.runKernel(i.iH,o,u)}})},89112:(e,t,n)=>{"use strict";n.d(t,{n:()=>o});var r=n(97097),i=n(29121),a=n(43740),s=n(20569);const o=(0,n(2668).op)({depthToSpace_:function(e,t,n="NHWC"){const o=(0,a._1)(e,"x","depthToSpace","float32"),u="NHWC"===n?o.shape[1]:o.shape[2],l="NHWC"===n?o.shape[2]:o.shape[3],c="NHWC"===n?o.shape[3]:o.shape[1];s.hu(t>1,(()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`)),s.hu(u*t>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${u} and ${t}  for depthToSpace with input shape\n    ${o.shape}`)),s.hu(l*t>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${l} and ${t} for depthToSpace with input shape\n        ${o.shape}`)),s.hu(c%(t*t)==0,(()=>`Dimension size must be evenly divisible by ${t*t} but is ${c} for depthToSpace with input shape ${o.shape}`));const d={x:o},h={blockSize:t,dataFormat:n};return r.BV.runKernel(i.T0,d,h)}})},64718:(e,t,n)=>{"use strict";n.d(t,{B:()=>c});var r=n(97097),i=n(29121),a=n(43740),s=n(20569),o=n(2582),u=n(2668),l=n(4968);const c=(0,u.op)({depthwiseConv2d_:function(e,t,n,u,c="NHWC",d=[1,1],h){const f=(0,a._1)(e,"x","depthwiseConv2d","float32"),p=(0,a._1)(t,"filter","depthwiseConv2d","float32");let g=f,m=!1;3===f.rank&&(m=!0,g=(0,l.X)(f,[1,f.shape[0],f.shape[1],f.shape[2]])),s.hu(4===g.rank,(()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${g.rank}.`)),s.hu(4===p.rank,(()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${p.rank}.`)),s.hu(g.shape[3]===p.shape[2],(()=>`Error in depthwiseConv2d: number of input channels (${g.shape[3]}) must match the inChannels dimension in filter ${p.shape[2]}.`)),o.m("depthwiseConv2d",u,h);const y={x:g,filter:p},v={strides:n,pad:u,dataFormat:c,dilations:d,dimRoundingMode:h},b=r.BV.runKernel(i.ci,y,v);return m?(0,l.X)(b,[b.shape[1],b.shape[2],b.shape[3]]):b}})},88098:(e,t,n)=>{"use strict";n.d(t,{z:()=>o});var r=n(97097),i=n(29121),a=n(2668),s=n(4968);const o=(0,a.op)({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,a,o,u=[1,1],l){let c=e;3===e.rank&&(c=(0,s.X)(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let d=t;3===d.rank&&(d=(0,s.X)(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const h={x:c,dy:d},f={strides:a,pad:o,dimRoundingMode:l,dilations:u,filterShape:n};return r.BV.runKernel(i.sL,h,f)}})},54375:(e,t,n)=>{"use strict";n.d(t,{v:()=>o});var r=n(97097),i=n(29121),a=n(2668),s=n(4968);const o=(0,a.op)({depthwiseConv2dNativeBackpropInput_:function(e,t,n,a,o,u=[1,1],l){let c=t,d=!1;3===t.rank&&(d=!0,c=(0,s.X)(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const h={dy:c,filter:n},f={strides:a,pad:o,dimRoundingMode:l,dilations:u,inputShape:e},p=r.BV.runKernel(i.y7,h,f);return d?(0,s.X)(p,[p.shape[1],p.shape[2],p.shape[3]]):p}})},70557:(e,t,n)=>{"use strict";n.d(t,{W:()=>l});var r=n(97097),i=n(29121),a=n(43740),s=n(20569),o=n(2668),u=n(4968);const l=(0,o.op)({dilation2d_:function(e,t,n,o,l=[1,1],c="NHWC"){const d=(0,a._1)(e,"x","dilation2d"),h=(0,a._1)(t,"filter","dilation2d");s.hu(3===d.rank||4===d.rank,(()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${d.rank}.`)),s.hu(3===h.rank,(()=>`Error in dilation2d: filter must be rank 3, but got rank ${h.rank}.`)),s.hu("NHWC"===c,(()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${c}`));let f=d,p=!1;3===d.rank&&(f=(0,u.X)(d,[1,d.shape[0],d.shape[1],d.shape[2]]),p=!0);const g={x:f,filter:h},m={strides:n,pad:o,dilations:l},y=r.BV.runKernel(i.p4,g,m);return p?(0,u.X)(y,[y.shape[1],y.shape[2],y.shape[3]]):y}})},41274:(e,t,n)=>{"use strict";n.d(t,{h:()=>u});var r=n(97097),i=n(29121),a=n(80747),s=n(43740),o=n(9165);const u=(0,n(2668).op)({div_:function(e,t){let n=(0,s._1)(e,"a","div"),u=(0,s._1)(t,"b","div");if([n,u]=(0,a.makeTypesMatch)(n,u),"int32"===n.dtype&&"int32"===u.dtype)return(0,o.q)(n,u);const l={a:n,b:u};return r.BV.runKernel(i.oH,l,{})}})},49322:(e,t,n)=>{"use strict";n.d(t,{N:()=>c});var r=n(80747),i=n(43740),a=n(41274),s=n(26477),o=n(2668),u=n(95912),l=n(29999);const c=(0,o.op)({divNoNan_:function(e,t){let n=(0,i._1)(e,"a","div"),o=(0,i._1)(t,"b","div");[n,o]=(0,r.makeTypesMatch)(n,o);const c=(0,a.h)(n,o),d=(0,l.P)(c),h=(0,s.D)(o,d);return(0,u.a)(h,d,c)}})},30548:(e,t,n)=>{"use strict";n.d(t,{A:()=>u});var r=n(43740),i=n(20569),a=n(28687),s=n(2668),o=n(4968);const u=(0,s.op)({dot_:function(e,t){const n=(0,r._1)(e,"t1","dot"),s=(0,r._1)(t,"t2","dot");i.hu(!(1!==n.rank&&2!==n.rank||1!==s.rank&&2!==s.rank),(()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${s.rank}.`));const u=1===n.rank?n.size:n.shape[1],l=1===s.rank?s.size:s.shape[0];if(i.hu(u===l,(()=>`Error in dot: inner dimensions of inputs must match, but got ${u} and ${l}.`)),1===n.rank&&1===s.rank){const e=(0,o.X)(n,[1,-1]),t=(0,o.X)(s,[-1,1]),r=(0,a.O)(e,t);return(0,o.X)(r,[])}if(1===n.rank&&2===s.rank){const e=(0,o.X)(n,[1,-1]),t=(0,o.X)(s,[s.shape[0],s.shape[1]]),r=(0,a.O)(e,t);return(0,o.X)(r,[r.size])}if(2===n.rank&&1===s.rank){const e=(0,o.X)(s,[-1,1]),t=(0,a.O)(n,e);return(0,o.X)(t,[t.size])}{const e=(0,o.X)(s,[s.shape[0],s.shape[1]]);return(0,a.O)(n,e)}}})},83233:(e,t,n)=>{"use strict";n.d(t,{p:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({elu_:function(e){const t={x:(0,a._1)(e,"x","elu","float32")};return r.BV.runKernel(i.SX,t)}})},26477:(e,t,n)=>{"use strict";n.d(t,{D:()=>u});var r=n(97097),i=n(29121),a=n(80747),s=n(43740),o=n(72200);const u=(0,n(2668).op)({equal_:function(e,t){let n=(0,s._1)(e,"a","equal","string_or_numeric"),u=(0,s._1)(t,"b","equal","string_or_numeric");[n,u]=(0,a.makeTypesMatch)(n,u),(0,o.assertAndGetBroadcastShape)(n.shape,u.shape);const l={a:n,b:u};return r.BV.runKernel(i.hd,l)}})},34650:(e,t,n)=>{"use strict";n.d(t,{q:()=>u});var r=n(97097),i=n(29121),a=n(43740),s=n(20569),o=n(62271);const u=(0,n(2668).op)({erf_:function(e){let t=(0,a._1)(e,"x","erf");s.hu("int32"===t.dtype||"float32"===t.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===t.dtype&&(t=(0,o.p)(t,"float32"));const n={x:t};return r.BV.runKernel(i.Om,n)}})},44842:(e,t,n)=>{"use strict";n.d(t,{Q:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({exp_:function(e){const t={x:(0,a._1)(e,"x","exp")};return r.BV.runKernel(i.NE,t)}})},81300:(e,t,n)=>{"use strict";n.d(t,{d:()=>o});var r=n(97097),i=n(29121),a=n(43740),s=n(20569);const o=(0,n(2668).op)({expandDims_:function(e,t=0){const n=(0,a._1)(e,"x","expandDims","string_or_numeric");s.hu(t<=n.rank,(()=>"Axis must be <= rank of the tensor"));const o={input:n},u={dim:t};return r.BV.runKernel(i.YF,o,u)}})},53426:(e,t,n)=>{"use strict";n.d(t,{t:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({expm1_:function(e){const t={x:(0,a._1)(e,"x","expm1")};return r.BV.runKernel(i.Y0,t)}})},26943:(e,t,n)=>{"use strict";n.d(t,{G:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({floor_:function(e){const t={x:(0,a._1)(e,"x","floor","float32")};return r.BV.runKernel(i.OR,t)}})},9165:(e,t,n)=>{"use strict";n.d(t,{q:()=>o});var r=n(97097),i=n(29121),a=n(80747),s=n(43740);const o=(0,n(2668).op)({floorDiv_:function(e,t){let n=(0,s._1)(e,"a","floorDiv"),o=(0,s._1)(t,"b","floorDiv");[n,o]=(0,a.makeTypesMatch)(n,o);const u={a:n,b:o};return r.BV.runKernel(i.je,u)}})},24926:(e,t,n)=>{"use strict";n.d(t,{I:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({gather_:function(e,t,n=0,s=0){const o={x:(0,a._1)(e,"x","gather"),indices:(0,a._1)(t,"indices","gather","int32")},u={axis:n,batchDims:s};return r.BV.runKernel(i.qi,o,u)}})},20636:(e,t,n)=>{"use strict";n.d(t,{p:()=>u});var r=n(97097),i=n(29121),a=n(80747),s=n(43740),o=n(72200);const u=(0,n(2668).op)({greater_:function(e,t){let n=(0,s._1)(e,"a","greater","string_or_numeric"),u=(0,s._1)(t,"b","greater","string_or_numeric");[n,u]=(0,a.makeTypesMatch)(n,u),(0,o.assertAndGetBroadcastShape)(n.shape,u.shape);const l={a:n,b:u};return r.BV.runKernel(i.iZ,l)}})},17630:(e,t,n)=>{"use strict";n.d(t,{b:()=>u});var r=n(97097),i=n(29121),a=n(80747),s=n(43740),o=n(72200);const u=(0,n(2668).op)({greaterEqual_:function(e,t){let n=(0,s._1)(e,"a","greaterEqual","string_or_numeric"),u=(0,s._1)(t,"b","greaterEqual","string_or_numeric");[n,u]=(0,a.makeTypesMatch)(n,u),(0,o.assertAndGetBroadcastShape)(n.shape,u.shape);const l={a:n,b:u};return r.BV.runKernel(i.Ac,l)}})},64386:(e,t,n)=>{"use strict";n.d(t,{a:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({imag_:function(e){const t={input:(0,a._1)(e,"input","imag")};return r.BV.runKernel(i.J_,t)}})},13305:(e,t,n)=>{"use strict";n.d(t,{I:()=>l});var r=n(97097),i=n(29121),a=n(43740),s=n(20569),o=n(2668),u=n(4968);const l=(0,o.op)({resizeBilinear_:function(e,t,n=!1,o=!1){const l=(0,a._1)(e,"images","resizeBilinear");s.hu(3===l.rank||4===l.rank,(()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${l.rank}.`)),s.hu(2===t.length,(()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`)),s.hu(!1===o||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let c=l,d=!1;3===l.rank&&(d=!0,c=(0,u.X)(l,[1,l.shape[0],l.shape[1],l.shape[2]]));const[]=t,h={images:c},f={alignCorners:n,halfPixelCenters:o,size:t},p=r.BV.runKernel(i._Y,h,f);return d?(0,u.X)(p,[p.shape[1],p.shape[2],p.shape[3]]):p}})},95098:(e,t,n)=>{"use strict";n.d(t,{j:()=>l});var r=n(97097),i=n(29121),a=n(43740),s=n(20569),o=n(2668),u=n(4968);const l=(0,o.op)({resizeNearestNeighbor_:function(e,t,n=!1,o=!1){const l=(0,a._1)(e,"images","resizeNearestNeighbor");s.hu(3===l.rank||4===l.rank,(()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${l.rank}.`)),s.hu(2===t.length,(()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`)),s.hu("float32"===l.dtype||"int32"===l.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),s.hu(!1===o||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let c=l,d=!1;3===l.rank&&(d=!0,c=(0,u.X)(l,[1,l.shape[0],l.shape[1],l.shape[2]]));const[]=t,h={images:c},f={alignCorners:n,halfPixelCenters:o,size:t},p=r.BV.runKernel(i.dp,h,f);return d?(0,u.X)(p,[p.shape[1],p.shape[2],p.shape[3]]):p}})},13963:(e,t,n)=>{"use strict";n.d(t,{x:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({isFinite_:function(e){const t={x:(0,a._1)(e,"x","isFinite")};return r.BV.runKernel(i.av,t)}})},4365:(e,t,n)=>{"use strict";n.d(t,{U:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({isInf_:function(e){const t={x:(0,a._1)(e,"x","isInf")};return r.BV.runKernel(i.iW,t)}})},96230:(e,t,n)=>{"use strict";n.d(t,{i:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({isNaN_:function(e){const t={x:(0,a._1)(e,"x","isNaN")};return r.BV.runKernel(i.r7,t)}})},99133:(e,t,n)=>{"use strict";n.d(t,{h:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({leakyRelu_:function(e,t=.2){const n={x:(0,a._1)(e,"x","leakyRelu")},s={alpha:t};return r.BV.runKernel(i.J$,n,s)}})},86573:(e,t,n)=>{"use strict";n.d(t,{d:()=>u});var r=n(97097),i=n(29121),a=n(80747),s=n(43740),o=n(72200);const u=(0,n(2668).op)({less_:function(e,t){let n=(0,s._1)(e,"a","less","string_or_numeric"),u=(0,s._1)(t,"b","less","string_or_numeric");[n,u]=(0,a.makeTypesMatch)(n,u),(0,o.assertAndGetBroadcastShape)(n.shape,u.shape);const l={a:n,b:u};return r.BV.runKernel(i.vt,l)}})},50624:(e,t,n)=>{"use strict";n.d(t,{z:()=>u});var r=n(97097),i=n(29121),a=n(80747),s=n(43740),o=n(72200);const u=(0,n(2668).op)({lessEqual_:function(e,t){let n=(0,s._1)(e,"a","lessEqual","string_or_numeric"),u=(0,s._1)(t,"b","lessEqual","string_or_numeric");[n,u]=(0,a.makeTypesMatch)(n,u),(0,o.assertAndGetBroadcastShape)(n.shape,u.shape);const l={a:n,b:u};return r.BV.runKernel(i.CA,l)}})},79648:(e,t,n)=>{"use strict";n.d(t,{G:()=>l});var r=n(97097),i=n(29121),a=n(43740),s=n(20569),o=n(2668),u=n(4968);const l=(0,o.op)({localResponseNormalization_:function(e,t=5,n=1,o=1,l=.5){const c=(0,a._1)(e,"x","localResponseNormalization");s.hu(4===c.rank||3===c.rank,(()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${c.rank}.`)),s.hu(s.GN(t),(()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`));let d=c,h=!1;3===c.rank&&(h=!0,d=(0,u.X)(c,[1,c.shape[0],c.shape[1],c.shape[2]]));const f={x:d},p={depthRadius:t,bias:n,alpha:o,beta:l},g=r.BV.runKernel(i.eZ,f,p);return h?(0,u.X)(g,[g.shape[1],g.shape[2],g.shape[3]]):g}})},82597:(e,t,n)=>{"use strict";n.d(t,{c:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({log_:function(e){const t={x:(0,a._1)(e,"x","log","float32")};return r.BV.runKernel(i.Zb,t)}})},17474:(e,t,n)=>{"use strict";n.d(t,{K:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({log1p_:function(e){const t={x:(0,a._1)(e,"x","log1p")};return r.BV.runKernel(i.kU,t)}})},13888:(e,t,n)=>{"use strict";n.d(t,{e:()=>c});var r=n(30633),i=n(43740),a=n(24841),s=n(17370),o=n(2668),u=n(30625),l=n(3694);const c=(0,o.op)({logSigmoid_:function(e){const t=(0,i._1)(e,"x","logSigmoid"),n=(0,r.cb)((e=>({value:(0,s.W)((0,l.W)((0,s.W)(e))),gradFunc:t=>(0,a.d)(t,(0,u.X)((0,s.W)(e)))})));return n(t)}})},31510:(e,t,n)=>{"use strict";n.d(t,{C:()=>f});var r=n(30633),i=n(43740),a=n(62271),s=n(44842),o=n(82597),u=n(83307),l=n(24841),c=n(2668),d=n(70827),h=n(15475);const f=(0,c.op)({logSoftmax_:function(e,t=-1){const n=(0,i._1)(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${t}`);const c=(0,r.cb)(((e,n)=>{const r=(0,u.F)(e,t,!0),i=(0,d.l)(e,r),c=(0,d.l)((0,a.p)(i,"float32"),(0,o.c)((0,h.S)((0,s.Q)(i),t,!0)));return n([c]),{value:c,gradFunc:(e,n)=>{const[r]=n,i=(0,s.Q)(r);return(0,d.l)(e,(0,l.d)((0,h.S)(e,t,!0),i))}}}));return c(n)}})},11391:(e,t,n)=>{"use strict";n.d(t,{l:()=>p});var r=n(43740),i=n(20569),a=n(56407),s=n(83591),o=n(44842),u=n(82597),l=n(83307),c=n(2668),d=n(4968),h=n(70827),f=n(15475);const p=(0,c.op)({logSumExp_:function(e,t=null,n=!1){const c=(0,r._1)(e,"x","logSumExp"),p=(0,i.EC)(t,c.shape),g=(0,l.F)(c,p,!0),m=(0,h.l)(c,g),y=(0,o.Q)(m),v=(0,f.S)(y,p),b=(0,u.c)(v),x=(0,a.I)((0,d.X)(g,b.shape),b);if(n){const e=(0,s.rv)(x.shape,p);return(0,d.X)(x,e)}return x}})},2856:(e,t,n)=>{"use strict";n.d(t,{H:()=>o});var r=n(97097),i=n(29121),a=n(43740),s=n(72200);const o=(0,n(2668).op)({logicalAnd_:function(e,t){const n=(0,a._1)(e,"a","logicalAnd","bool"),o=(0,a._1)(t,"b","logicalAnd","bool");(0,s.assertAndGetBroadcastShape)(n.shape,o.shape);const u={a:n,b:o};return r.BV.runKernel(i.PY,u)}})},38651:(e,t,n)=>{"use strict";n.d(t,{h:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({logicalNot_:function(e){const t={x:(0,a._1)(e,"x","logicalNot","bool")};return r.BV.runKernel(i.Vf,t)}})},15750:(e,t,n)=>{"use strict";n.d(t,{K:()=>o});var r=n(97097),i=n(29121),a=n(43740),s=n(72200);const o=(0,n(2668).op)({logicalOr_:function(e,t){const n=(0,a._1)(e,"a","logicalOr","bool"),o=(0,a._1)(t,"b","logicalOr","bool");(0,s.assertAndGetBroadcastShape)(n.shape,o.shape);const u={a:n,b:o};return r.BV.runKernel(i.MZ,u)}})},10596:(e,t,n)=>{"use strict";n.d(t,{e:()=>u});var r=n(43740),i=n(72200),a=n(2856),s=n(38651),o=n(15750);const u=(0,n(2668).op)({logicalXor_:function(e,t){const n=(0,r._1)(e,"a","logicalXor","bool"),u=(0,r._1)(t,"b","logicalXor","bool");return(0,i.assertAndGetBroadcastShape)(n.shape,u.shape),(0,a.H)((0,o.K)(e,t),(0,s.h)((0,a.H)(e,t)))}})},28687:(e,t,n)=>{"use strict";n.d(t,{O:()=>o});var r=n(97097),i=n(29121),a=n(80747),s=n(43740);const o=(0,n(2668).op)({matMul_:function(e,t,n=!1,o=!1){let u=(0,s._1)(e,"a","matMul"),l=(0,s._1)(t,"b","matMul");[u,l]=(0,a.makeTypesMatch)(u,l);const c={a:u,b:l},d={transposeA:n,transposeB:o};return r.BV.runKernel(i.XL,c,d)}})},83307:(e,t,n)=>{"use strict";n.d(t,{F:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({max_:function(e,t=null,n=!1){const s={x:(0,a._1)(e,"x","max")},o={reductionIndices:t,keepDims:n};return r.BV.runKernel(i.Yo,s,o)}})},21174:(e,t,n)=>{"use strict";n.d(t,{_:()=>c});var r=n(97097),i=n(29121),a=n(43740),s=n(20569),o=n(2582),u=n(2668),l=n(4968);const c=(0,u.op)({maxPool_:function(e,t,n,u,c){const d=(0,a._1)(e,"x","maxPool");let h=d,f=!1;3===d.rank&&(f=!0,h=(0,l.X)(d,[1,d.shape[0],d.shape[1],d.shape[2]])),s.hu(4===h.rank,(()=>`Error in maxPool: input must be rank 4 but got rank ${h.rank}.`)),s.hu(o.jT(n,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`)),o.m("maxPool",u,c);const p={x:h},g={filterSize:t,strides:n,pad:u,dimRoundingMode:c},m=r.BV.runKernel(i.mT,p,g);return f?(0,l.X)(m,[m.shape[1],m.shape[2],m.shape[3]]):m}})},80632:(e,t,n)=>{"use strict";n.d(t,{g:()=>l});var r=n(97097),i=n(29121),a=n(80747),s=n(43740),o=n(72200),u=n(62271);const l=(0,n(2668).op)({maximum_:function(e,t){let n=(0,s._1)(e,"a","maximum"),l=(0,s._1)(t,"b","maximum");[n,l]=(0,a.makeTypesMatch)(n,l),"bool"===n.dtype&&(n=(0,u.p)(n,"int32"),l=(0,u.p)(l,"int32")),(0,o.assertAndGetBroadcastShape)(n.shape,l.shape);const c={a:n,b:l};return r.BV.runKernel(i.BM,c)}})},75130:(e,t,n)=>{"use strict";n.d(t,{J:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({mean_:function(e,t=null,n=!1){const s={x:(0,a._1)(e,"x","mean")},o={axis:t,keepDims:n};return r.BV.runKernel(i.q2,s,o)}})},25735:(e,t,n)=>{"use strict";n.d(t,{V:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({min_:function(e,t=null,n=!1){const s={x:(0,a._1)(e,"x","min")},o={axis:t,keepDims:n};return r.BV.runKernel(i.c1,s,o)}})},24513:(e,t,n)=>{"use strict";n.d(t,{L:()=>l});var r=n(97097),i=n(29121),a=n(80747),s=n(43740),o=n(72200),u=n(62271);const l=(0,n(2668).op)({minimum_:function(e,t){let n=(0,s._1)(e,"a","minimum"),l=(0,s._1)(t,"b","minimum");[n,l]=(0,a.makeTypesMatch)(n,l),"bool"===n.dtype&&(n=(0,u.p)(n,"int32"),l=(0,u.p)(l,"int32")),(0,o.assertAndGetBroadcastShape)(n.shape,l.shape);const c={a:n,b:l};return r.BV.runKernel(i.q8,c)}})},71483:(e,t,n)=>{"use strict";n.d(t,{V:()=>o});var r=n(97097),i=n(29121),a=n(43740),s=n(20569);const o=(0,n(2668).op)({mirrorPad_:function(e,t,n){s.hu("reflect"===n||"symmetric"===n,(()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`));const o=(0,a._1)(e,"x","mirrorPad");if(0===o.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");s.hu(t.length===o.rank,(()=>`Padding doesn't match input. Must be ${o.rank}. Got ${t.length}.`));const u="reflect"===n?1:0;for(let e=0;e<o.rank;e++)s.hu(2===t[e].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),s.hu(t[e][0]>=0&&t[e][0]<=o.shape[e]-u&&t[e][1]>=0&&t[e][1]<=o.shape[e]-u,(()=>`Padding in dimension ${e} cannot be greater than or equal to ${o.shape[e]-u} or less than 0 for input of shape ${o.shape}`));const l={paddings:t,mode:n},c={x:o};return r.BV.runKernel(i.jQ,c,l)}})},85228:(e,t,n)=>{"use strict";n.d(t,{w:()=>o});var r=n(97097),i=n(29121),a=n(80747),s=n(43740);const o=(0,n(2668).op)({mod_:function(e,t){let n=(0,s._1)(e,"a","mod"),o=(0,s._1)(t,"b","mod");[n,o]=(0,a.makeTypesMatch)(n,o);const u={a:n,b:o};return r.BV.runKernel(i.Vb,u)}})},24841:(e,t,n)=>{"use strict";n.d(t,{d:()=>o});var r=n(97097),i=n(29121),a=n(80747),s=n(43740);const o=(0,n(2668).op)({mul_:function(e,t){let n=(0,s._1)(e,"a","mul"),o=(0,s._1)(t,"b","mul");[n,o]=(0,a.makeTypesMatch)(n,o);const u={a:n,b:o};return r.BV.runKernel(i.wY,u)}})},17370:(e,t,n)=>{"use strict";n.d(t,{W:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({neg_:function(e){const t={x:(0,a._1)(e,"x","neg")};return r.BV.runKernel(i.ku,t)}})},3561:(e,t,n)=>{"use strict";n.d(t,{K:()=>y});var r=n(43740),i=n(20569),a=n(96235),s=n(83591),o=n(83307),u=n(25735),l=n(2668),c=n(33453),d=n(4968),h=n(99494),f=n(13261),p=n(50248),g=n(15475);function m(e,t,n=null){if(0===e.rank)return(0,a.W)(e);if(1!==e.rank&&null===n)return m((0,d.X)(e,[-1]),t,n);if(1===e.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===t)return(0,g.S)((0,a.W)(e),n);if(t===1/0)return(0,o.F)((0,a.W)(e),n);if(t===-1/0)return(0,u.V)((0,a.W)(e),n);if("euclidean"===t||2===t)return(0,f._)((0,g.S)((0,c.s)((0,a.W)(e),(0,h.i)(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(n)&&2===n.length){if(1===t)return(0,o.F)((0,g.S)((0,a.W)(e),n[0]),n[1]-1);if(t===1/0)return(0,o.F)((0,g.S)((0,a.W)(e),n[1]),n[0]);if(t===-1/0)return(0,u.V)((0,g.S)((0,a.W)(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return(0,f._)((0,g.S)((0,p.h)(e),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const y=(0,l.op)({norm_:function(e,t="euclidean",n=null,a=!1){const o=m(e=(0,r._1)(e,"x","norm"),t,n);let u=o.shape;if(a){const t=(0,i.EC)(n,e.shape);u=s.rv(o.shape,t)}return(0,d.X)(o,u)}})},16500:(e,t,n)=>{"use strict";n.d(t,{Q:()=>u});var r=n(97097),i=n(29121),a=n(80747),s=n(43740),o=n(72200);const u=(0,n(2668).op)({notEqual_:function(e,t){let n=(0,s._1)(e,"a","notEqual","string_or_numeric"),u=(0,s._1)(t,"b","notEqual","string_or_numeric");[n,u]=(0,a.makeTypesMatch)(n,u),(0,o.assertAndGetBroadcastShape)(n.shape,u.shape);const l={a:n,b:u};return r.BV.runKernel(i.yQ,l)}})},76708:(e,t,n)=>{"use strict";n.d(t,{l:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({oneHot_:function(e,t,n=1,s=0){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);const o={indices:(0,a._1)(e,"indices","oneHot","int32")},u={depth:t,onValue:n,offValue:s};return r.BV.runKernel(i.we,o,u)}})},44917:(e,t,n)=>{"use strict";n.d(t,{i:()=>o});var r=n(97097),i=n(20569),a=n(61661),s=n(59640);function o(e,t="float32"){if("complex64"===t){const t=o(e,"float32"),n=(0,s.l)(e,"float32");return(0,a.P)(t,n)}const n=(0,i.p8)((0,i.NA)(e),t);return r.BV.makeTensor(n,e,t)}},7846:(e,t,n)=>{"use strict";n.d(t,{J:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({onesLike_:function(e){const t={x:(0,a._1)(e,"x","onesLike")};return r.BV.runKernel(i.qW,t)}})},2668:(e,t,n)=>{"use strict";n.d(t,{op:()=>s,z:()=>a});var r=n(97097),i=n(20569);const a="__op";function s(e){const t=Object.keys(e);if(1!==t.length)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let n=t[0];const s=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=a;const o=(...e)=>{r.BV.startScope(n);try{const t=s(...e);return(0,i.tI)(t)&&console.error("Cannot return a Promise inside of tidy."),r.BV.endScope(t),t}catch(e){throw r.BV.endScope(null),e}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}},39682:(e,t,n)=>{"use strict";n.d(t,{v:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({pad_:function(e,t,n=0){const s=(0,a._1)(e,"x","pad");if(0===s.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const o={paddings:t,constantValue:n},u={x:s};return r.BV.runKernel(i.ly,u,o)}})},85860:(e,t,n)=>{"use strict";n.d(t,{d:()=>h});var r=n(43740),i=n(20569),a=n(15176),s=n(28441),o=n(2582),u=n(21174),l=n(2668),c=n(4968),d=n(27918);const h=(0,l.op)({pool_:function(e,t,n,l,h,f,p){null==h&&(h=[1,1]),null==f&&(f=1),0===l&&(l="valid");const g=(0,r._1)(e,"x","maxPool");let m=g,y=!1;3===g.rank&&(y=!0,m=(0,c.X)(g,[1,g.shape[0],g.shape[1],g.shape[2]])),i.hu(o.jT(f,h),(()=>`Error in pool: Either strides or dilations must be 1. Got strides ${f} and dilations '${h}'`));const v=o.Xw(m.shape,t,f,h,l),b=[v.dilationHeight,v.dilationWidth];let x;x="same"===l?function(e,t){const n=e.map(((e,n)=>e+(e-1)*(t[n]-1))).map((e=>e-1)),r=n.map((e=>Math.floor(e/2))),i=n.map(((e,t)=>e-r[t]));return n.map(((e,t)=>[r[t],i[t]]))}([v.filterHeight,v.filterWidth],b):[[0,0],[0,0]];const w=1===b[0]&&1===b[1],[k,_]=function(e,t,n){const r=n.map((e=>e[0])),i=n.map((e=>e[1])),a=e.concat(r,i),s=t.map(((e,t)=>(e-a[t]%e)%e)),o=i.map(((e,t)=>e+s[t]));return[t.map(((e,t)=>[r[t],o[t]])),t.map(((e,t)=>[0,s[t]]))]}([v.inHeight,v.inWidth],b,x),S=w?l:"valid",C=w?m:(0,d.f)(m,b,k),A=("avg"===n?()=>(0,a.w)(C,t,f,S,p):()=>(0,u._)(C,t,f,S,p))(),E=w?A:(0,s.E)(A,b,_);return y?(0,c.X)(E,[E.shape[1],E.shape[2],E.shape[3]]):E}})},33453:(e,t,n)=>{"use strict";n.d(t,{s:()=>o});var r=n(97097),i=n(29121),a=n(80747),s=n(43740);const o=(0,n(2668).op)({pow_:function(e,t){let n=(0,s._1)(e,"base","pow"),o=(0,s._1)(t,"exp","pow");[n,o]=(0,a.makeTypesMatch)(n,o);const u={a:n,b:o};return r.BV.runKernel(i.pe,u)}})},98151:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({prelu_:function(e,t){const n={x:(0,a._1)(e,"x","prelu"),alpha:(0,a._1)(t,"alpha","prelu")};return r.BV.runKernel(i.o0,n)}})},49451:(e,t,n)=>{"use strict";n.d(t,{W:()=>o});var r=n(97097),i=n(29121),a=n(43740),s=n(62271);const o=(0,n(2668).op)({prod_:function(e,t=null,n=!1){let o=(0,a._1)(e,"x","prod");"bool"===o.dtype&&(o=(0,s.p)(o,"int32"));const u={x:o},l={axis:t,keepDims:n};return r.BV.runKernel(i.Dl,u,l)}})},60766:(e,t,n)=>{"use strict";n.d(t,{k:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({real_:function(e){const t={input:(0,a._1)(e,"input","real")};return r.BV.runKernel(i.xJ,t)}})},19036:(e,t,n)=>{"use strict";n.d(t,{M:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({reciprocal_:function(e){const t={x:(0,a._1)(e,"x","reciprocal")};return r.BV.runKernel(i.$H,t)}})},7409:(e,t,n)=>{"use strict";n.d(t,{U:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({relu_:function(e){const t={x:(0,a._1)(e,"x","relu")};return r.BV.runKernel(i.qk,t)}})},83582:(e,t,n)=>{"use strict";n.d(t,{b:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({relu6_:function(e){const t={x:(0,a._1)(e,"x","relu6")};return r.BV.runKernel(i.Sb,t)}})},4968:(e,t,n)=>{"use strict";n.d(t,{X:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({reshape_:function(e,t){const n={x:(0,a._1)(e,"x","reshape","string_or_numeric")},s={shape:t};return r.BV.runKernel(i.HZ,n,s)}})},57486:(e,t,n)=>{"use strict";n.d(t,{G:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({reverse_:function(e,t){const n={x:(0,a._1)(e,"x","reverse")},s={dims:t};return r.BV.runKernel(i.mK,n,s)}})},97809:(e,t,n)=>{"use strict";n.d(t,{N:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({round_:function(e){const t={x:(0,a._1)(e,"x","round")};return r.BV.runKernel(i.e0,t)}})},32634:(e,t,n)=>{"use strict";n.d(t,{b:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({rsqrt_:function(e){const t={x:(0,a._1)(e,"x","rsqrt","float32")};return r.BV.runKernel(i.bV,t)}})},99494:(e,t,n)=>{"use strict";n.d(t,{i:()=>a});var r=n(20569),i=n(57852);function a(e,t){if(((0,r.fU)(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&(0,r.fU)(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return(0,i.H)(e,[],[],t)}},55503:(e,t,n)=>{"use strict";n.d(t,{U:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({selu_:function(e){const t={x:(0,a._1)(e,"x","selu")};return r.BV.runKernel(i.oF,t)}})},43179:(e,t,n)=>{"use strict";n.d(t,{$:()=>i,y:()=>r});const r=1.7580993408473768,i=1.0507009873554805},68678:(e,t,n)=>{"use strict";n.d(t,{U:()=>l});var r=n(43740),i=n(20569),a=n(64794),s=n(64718),o=n(2668),u=n(4968);const l=(0,o.op)({separableConv2d_:function(e,t,n,o,l,c=[1,1],d="NHWC"){const h=(0,r._1)(e,"x","separableConv2d"),f=(0,r._1)(t,"depthwiseFilter","separableConv2d"),p=(0,r._1)(n,"pointwiseFilter","separableConv2d");let g=h,m=!1;if(3===h.rank&&(m=!0,g=(0,u.X)(h,[1,h.shape[0],h.shape[1],h.shape[2]])),"NCHW"===d)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");i.hu(4===g.rank,(()=>`Error in separableConv2d: input must be rank 4, but got rank ${g.rank}.`)),i.hu(4===f.rank,(()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${f.rank}.`)),i.hu(4===p.rank,(()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${f.rank}.`)),i.hu(1===p.shape[0],(()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${p.shape[0]}.`)),i.hu(1===p.shape[1],(()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${p.shape[1]}.`));const y=f.shape[2],v=f.shape[3];i.hu(p.shape[2]===y*v,(()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${y*v}, but got ${p.shape[2]}.`));const b=(0,s.B)(g,f,o,l,d,c),x=(0,a.T)(b,p,1,"valid",d);return m?(0,u.X)(x,[x.shape[1],x.shape[2],x.shape[3]]):x}})},30625:(e,t,n)=>{"use strict";n.d(t,{X:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({sigmoid_:function(e){const t={x:(0,a._1)(e,"x","sigmoid","float32")};return r.BV.runKernel(i.a5,t)}})},34434:(e,t,n)=>{"use strict";n.d(t,{X:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({sign_:function(e){const t={x:(0,a._1)(e,"x","sign")};return r.BV.runKernel(i.i5,t)}})},99331:(e,t,n)=>{"use strict";n.d(t,{O:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({sin_:function(e){const t={x:(0,a._1)(e,"x","sin","float32")};return r.BV.runKernel(i.RQ,t)}})},83254:(e,t,n)=>{"use strict";n.d(t,{R:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({sinh_:function(e){const t={x:(0,a._1)(e,"x","sinh")};return r.BV.runKernel(i.w3,t)}})},22676:(e,t,n)=>{"use strict";n.d(t,{t:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({slice_:function(e,t,n){const s=(0,a._1)(e,"x","slice","string_or_numeric");if(0===s.rank)throw new Error("Slicing scalar is not possible");const o={x:s},u={begin:t,size:n};return r.BV.runKernel(i.p2,o,u)}})},37650:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assertParamsValid:()=>i,computeFlatOffset:()=>y,computeOutShape:()=>s,getNormalizedAxes:()=>c,isSliceContinous:()=>m,maskToAxes:()=>a,parseSliceParams:()=>v,sliceInfo:()=>b,startForAxis:()=>p,startIndicesWithElidedDims:()=>d,stopForAxis:()=>g,stopIndicesWithElidedDims:()=>h,stridesForAxis:()=>f,stridesWithElidedDims:()=>o});var r=n(20569);function i(e,t,n){const i=e.shape.length;r.hu(i===t.length,(()=>`Error in slice${i}D: Length of begin ${t} must match the rank of the array (${i}).`)),r.hu(i===n.length,(()=>`Error in slice${i}D: Length of size ${n} must match the rank of the array (${i}).`));for(let a=0;a<i;++a)r.hu(t[a]+n[a]<=e.shape[a],(()=>`Error in slice${i}D: begin[${a}] + size[${a}] (${t[a]+n[a]}) would overflow input.shape[${a}] (${e.shape[a]})`))}function a(e){const t=[];let n=0;for(;e>0;)1&e&&t.push(n),e/=2,n++;return t}function s(e,t,n){const r=[];for(let i=0;i<e.length;i++)r[i]=Math.ceil((t[i]-e[i])/n[i]);return r}function o(e,t,n,r){const i=[...e];for(let e=i.length;e<r.length;e++)i.push(1);for(let e=0;e<n;e++)0===e?i[t]=1:(i.splice(t,0,1),i.pop());return i}function u(e,t,n){return n<=e?n:n-(t-1)}function l(e,t){const n=[];for(let r=0;r<e;r++)n.push(t+r);return n}function c(e,t,n,r,i,a,s,u,l){const c=e.length;let m=new Array(c),y=new Array(c),v=new Array(c);if(t.length&&n>0){const l=t[0],c=n+1;m=d(s,l,c,r,e),y=h(u,l,c,i,e),v=o(a,l,c,e)}else for(let t=0;t<c;t++)m[t]=p(s,r,a,e,t,l),y[t]=g(u,i,a,e,t,l),v[t]=f(a,t,l);return{begin:m,end:y,strides:v}}function d(e,t,n,r,i){const a=[...i],s=l(n,t);for(let i=0;i<a.length;i++)if(s.indexOf(i)>-1)a[i]=0;else{const s=u(t,n,i);let o=r[s];e&1<<s&&(o=0),a[i]=o}return a}function h(e,t,n,i,a){const s=[...a],o=l(n,t);for(let r=0;r<s.length;r++)if(o.indexOf(r)>-1)s[r]=Number.MAX_SAFE_INTEGER;else{const a=u(t,n,r);let o=i[a];e&1<<a&&(o=Number.MAX_SAFE_INTEGER),s[r]=o}for(let e=0;e<s.length;e++){const t=a[e];s[e]<0&&(s[e]+=t),s[e]=r.uZ(0,s[e],a[e])}return s}function f(e,t,n){let r=e[t];return(n&1<<t||null==r)&&(r=1),r}function p(e,t,n,i,a,s){let o=t[a];const u=n[a]||1;(e&1<<a||s&1<<a||null==o)&&(o=u>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const l=i[a];return o<0&&(o+=l),o=r.uZ(0,o,l-1),o}function g(e,t,n,i,a,s){let o=t[a];const u=n[a]||1;(e&1<<a||s&1<<a||null==o)&&(o=u>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const l=i[a];return o<0&&(o+=l),o=u>0?r.uZ(0,o,l):r.uZ(-1,o,l-1),o}function m(e,t,n){let r=n.length;for(let e=0;e<n.length;e++)if(n[e]>1){r=e;break}for(let i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function y(e,t){let n=e.length>0?e[e.length-1]:1;for(let r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function v(e,t,n){let i;const a=e.shape.length;let s;return i="number"==typeof t?[t,...new Array(a-1).fill(0)]:t.length<a?t.concat(new Array(a-t.length).fill(0)):t.slice(),i.forEach((e=>{r.hu(-1!==e,(()=>"slice() does not support negative begin indexing."))})),s=null==n?new Array(a).fill(-1):"number"==typeof n?[n,...new Array(a-1).fill(-1)]:n.length<a?n.concat(new Array(a-n.length).fill(-1)):n,s=s.map(((t,n)=>t>=0?t:(r.hu(-1===t,(()=>`Negative size values should be exactly -1 but got ${t} for the slice() size at index ${n}.`)),e.shape[n]-i[n]))),[i,s]}function b(e,t,n,r,i,a,s,o,u){let l;if(null==r?(l=new Array(t.length),l.fill(1)):l=r,null!=s&&0!=(s&s-1))throw new Error("Multiple ellipses in slice is not allowed.");let c=!1;const d={dims:l.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:l.slice(),beginMask:i,endMask:a,ellipsisMask:s,newAxisMask:o,shrinkAxisMask:u};for(let e=0;e<d.dims;e++)c&&0!=(1<<e&o)&&d.numAddAxisAfterEllipsis++,1<<e&s&&(c=!0);c||(d.ellipsisMask|=1<<d.dims,d.dims++);const h={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask){const i=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);for(;n<i;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(-2),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${t.dims} dims, ${t.begin.length}.`);null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(-1),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}(d,h);let f=!0,p=!0,g=!0;const m=[],y=[];for(let t=0;t<e.length;++t){if(0===h.strides[t])throw Error(`strides[${t}] must be non-zero`);const n=!!(h.shrinkAxisMask&1<<t),r=e[t];if(-1===r){m.push(n?1:-1);continue}const i=[h.beginMask&1<<t,h.endMask&1<<t],a=[h.strides[t]>0?0:-1,h.strides[t]>0?r:r-1];if(n&&h.strides[t]<=0)throw Error("only stride 1 allowed on non-range indexing.");g=g&&1===h.strides[t];const s=!!(h.beginMask&1<<t&&h.endMask&1<<t);if(h.beginValid&&h.endValid){if(n){const e=h.begin[t]<0?r+h.begin[t]:h.begin[t];if(h.begin[t]=e,h.end[t]=h.begin[t]+1,e<0||e>=r)throw Error(`slice index ${h.begin[t]} of dimension ${t} out of bounds.`)}else h.begin[t]=x(h.begin[t],0,h.strides[t],r,i,a),h.end[t]=x(h.end[t],1,h.strides[t],r,i,a);const e=1===h.strides[t]&&0===h.begin[t]&&h.end[t]===r;f=f&&e,p=p&&(0===t&&1===h.strides[t]||e)}else f=f&&1===h.strides[t]&&s,p=p&&(0===t&&1===h.strides[t]||s);let o,u=!1;if(h.beginValid&&h.endValid?(o=h.end[t]-h.begin[t],u=!0):n?(o=1,u=!0):s&&r>=0&&(o=h.strides[t]<0?-r:r,u=!0),u){let e;e=0===o||o<0!=h.strides[t]<0?0:Math.trunc(o/h.strides[t])+(o%h.strides[t]!=0?1:0),m.push(e)}else m.push(-1)}for(let e=0;e<h.finalShapeGatherIndices.length;++e){const t=h.finalShapeGatherIndices[e];t>=0?y.push(m[t]):-2===t&&y.push(1)}return{finalShapeSparse:y.filter(((e,t)=>-2!==h.finalShapeGatherIndices[t])),finalShape:y,isIdentity:f,sliceDim0:p,isSimpleSlice:g,begin:h.begin,end:h.end,strides:h.strides}}function x(e,t,n,r,i,a){if(i[t])return n>0?a[t]:a[t+1&1];{const t=e<0?r+e:e;return t<a[0]?a[0]:t>a[1]?a[1]:t}}},80682:(e,t,n)=>{"use strict";n.d(t,{X:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({softmax_:function(e,t=-1){const n=(0,a._1)(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${t}`);const s={logits:n},o={dim:t};return r.BV.runKernel(i.Gc,s,o)}})},3694:(e,t,n)=>{"use strict";n.d(t,{W:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({softplus_:function(e){const t={x:(0,a._1)(e,"x","softplus")};return r.BV.runKernel(i.MR,t)}})},27918:(e,t,n)=>{"use strict";n.d(t,{f:()=>o});var r=n(97097),i=n(29121),a=n(43740),s=n(20569);const o=(0,n(2668).op)({spaceToBatchND_:function(e,t,n){const o=(0,a._1)(e,"x","spaceToBatchND");s.hu(o.rank>=1+t.length,(()=>`input rank ${o.rank} should be > than [blockShape] ${t.length}`)),s.hu(n.length===t.length,(()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${t.length}`)),s.hu(o.shape.reduce(((e,r,i)=>i>0&&i<=t.length?e&&(r+n[i-1][0]+n[i-1][1])%t[i-1]==0:e),!0),(()=>`input spatial dimensions ${o.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${t.toString()}`));const u={x:o},l={blockShape:t,paddings:n};return r.BV.runKernel(i.TQ,u,l)}})},7020:(e,t,n)=>{"use strict";n.d(t,{k:()=>s});var r=n(97097),i=n(29121),a=n(20569);const s=(0,n(2668).op)({fft_:function(e){(0,a.hu)("complex64"===e.dtype,(()=>`The dtype for tf.spectral.fft() must be complex64 but got ${e.dtype}.`));const t={input:e};return r.BV.runKernel(i.vw,t)}})},88447:(e,t,n)=>{"use strict";n.d(t,{S:()=>s});var r=n(97097),i=n(29121),a=n(20569);const s=(0,n(2668).op)({ifft_:function(e){(0,a.hu)("complex64"===e.dtype,(()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${e.dtype}.`));const t={input:e};return r.BV.runKernel(i.Qg,t)}})},84415:(e,t,n)=>{"use strict";n.d(t,{w:()=>p});var r=n(61661),i=n(46884),a=n(64386),s=n(24841),o=n(2668),u=n(60766),l=n(4968),c=n(57486),d=n(99494),h=n(22676),f=n(88447);const p=(0,o.op)({irfft_:function(e){const t=e.shape[e.shape.length-1],n=e.size/t;let o;if(t<=2){const r=(0,l.X)(e,[n,t]);o=(0,f.S)(r)}else{const p=[n,2*(t-1)],g=(0,l.X)((0,u.k)(e),[n,t]),m=(0,l.X)((0,a.a)(e),[n,t]),y=(0,c.G)((0,h.t)(g,[0,1],[n,t-2]),1),v=(0,s.d)((0,c.G)((0,h.t)(m,[0,1],[n,t-2]),1),(0,d.i)(-1)),b=(0,i.z)([g,y],1),x=(0,i.z)([m,v],1),w=(0,l.X)((0,r.P)(b,x),[p[0],p[1]]);o=(0,f.S)(w)}if(o=(0,u.k)(o),3===e.rank&&0!==e.shape[0]){const t=o,n=e.shape[0];o=(0,l.X)(o,[n,o.shape[0]/n,o.shape[1]]),t.dispose()}return o}})},13710:(e,t,n)=>{"use strict";n.d(t,{Q:()=>g});var r=n(20569),i=n(61661),a=n(46884),s=n(64386),o=n(2668),u=n(60766),l=n(4968),c=n(22676),d=n(28644),h=n(59640),f=n(29999),p=n(7020);const g=(0,o.op)({rfft_:function(e,t){(0,r.hu)("float32"===e.dtype,(()=>`The dtype for rfft() must be real value but got ${e.dtype}`));let n=e.shape[e.shape.length-1];const o=e.size/n;let g;if(null!=t&&t<n){const r=e.shape.map((e=>0)),i=e.shape.map((e=>e));i[e.shape.length-1]=t,g=(0,c.t)(e,r,i),n=t}else if(null!=t&&t>n){const r=e.shape.map((e=>e));r[e.shape.length-1]=t-n,g=(0,a.z)([e,(0,h.l)(r)],e.shape.length-1),n=t}else g=e;const m=(0,f.P)(g),y=(0,l.X)((0,i.P)(g,m),[o,n]),v=(0,p.k)(y),b=Math.floor(n/2)+1,x=(0,u.k)(v),w=(0,s.a)(v),k=(0,d.V)(x,[b,n-b],x.shape.length-1),_=(0,d.V)(w,[b,n-b],w.shape.length-1),S=g.shape.slice();return S[g.shape.length-1]=b,(0,l.X)((0,i.P)(k[0],_[0]),S)}})},28644:(e,t,n)=>{"use strict";n.d(t,{V:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({split_:function(e,t,n=0){const s={x:(0,a._1)(e,"x","split")},o={numOrSizeSplits:t,axis:n};return r.BV.runKernel(i.L8,s,o)}})},13261:(e,t,n)=>{"use strict";n.d(t,{_:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({sqrt_:function(e){const t={x:(0,a._1)(e,"x","sqrt","float32")};return r.BV.runKernel(i.FK,t)}})},50248:(e,t,n)=>{"use strict";n.d(t,{h:()=>a});var r=n(97097),i=n(43740);const a=(0,n(2668).op)({square_:function(e){const t=(0,i._1)(e,"x","square");return r.BV.runKernel("Square",{x:t},{})}})},15265:(e,t,n)=>{"use strict";n.d(t,{$:()=>u});var r=n(97097),i=n(29121),a=n(80747),s=n(43740),o=n(72200);const u=(0,n(2668).op)({squaredDifference_:function(e,t){let n=(0,s._1)(e,"a","squaredDifference"),u=(0,s._1)(t,"b","squaredDifference");[n,u]=(0,a.makeTypesMatch)(n,u),(0,o.assertAndGetBroadcastShape)(n.shape,u.shape);const l={a:n,b:u};return r.BV.runKernel(i._t,l,{})}})},79590:(e,t,n)=>{"use strict";n.d(t,{L:()=>o});var r=n(43740),i=n(20569),a=n(2668),s=n(4968);const o=(0,a.op)({squeeze_:function(e,t){const n=(0,r._1)(e,"x","squeeze");return(0,s.X)(n,(0,i.bp)(n.shape,t).newShape)}})},82991:(e,t,n)=>{"use strict";n.d(t,{k:()=>o});var r=n(97097),i=n(29121),a=n(43740),s=n(20569);const o=(0,n(2668).op)({stack_:function(e,t=0){const n=(0,a.sI)(e,"tensors","stack","string_or_numeric");s.hu(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&s.hu(t<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const o=n,u={axis:t};return r.BV.runKernel(i.Qi,o,u)}})},71901:(e,t,n)=>{"use strict";n.d(t,{N:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({step_:function(e,t=0){const n={x:(0,a._1)(e,"x","step")},s={alpha:t};return r.BV.runKernel(i.h8,n,s)}})},55158:(e,t,n)=>{"use strict";n.d(t,{N:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({stridedSlice_:function(e,t,n,s,o=0,u=0,l=0,c=0,d=0){const h={x:(0,a._1)(e,"x","stridedSlice","string_or_numeric")},f={begin:t,end:n,strides:s,beginMask:o,endMask:u,ellipsisMask:l,newAxisMask:c,shrinkAxisMask:d};return r.BV.runKernel(i.m2,h,f)}})},70827:(e,t,n)=>{"use strict";n.d(t,{l:()=>o});var r=n(97097),i=n(29121),a=n(80747),s=n(43740);const o=(0,n(2668).op)({sub_:function(e,t){let n=(0,s._1)(e,"a","sub"),o=(0,s._1)(t,"b","sub");[n,o]=(0,a.makeTypesMatch)(n,o);const u={a:n,b:o};return r.BV.runKernel(i.Tr,u)}})},15475:(e,t,n)=>{"use strict";n.d(t,{S:()=>o});var r=n(97097),i=n(29121),a=n(43740),s=n(62271);const o=(0,n(2668).op)({sum_:function(e,t=null,n=!1){let o=(0,a._1)(e,"x","sum");"bool"===o.dtype&&(o=(0,s.p)(o,"int32"));const u={x:o},l={axis:t,keepDims:n};return r.BV.runKernel(i.GB,u,l)}})},61173:(e,t,n)=>{"use strict";n.d(t,{O:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({tan_:function(e){const t={x:(0,a._1)(e,"x","tan","float32")};return r.BV.runKernel(i.sE,t)}})},21869:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({tanh_:function(e){const t={x:(0,a._1)(e,"x","tanh","float32")};return r.BV.runKernel(i.MI,t)}})},57852:(e,t,n)=>{"use strict";n.d(t,{H:()=>s});var r=n(97097),i=n(20569),a=n(79122);function s(e,t,n,s){if(null==s&&(s=(0,i.D2)(e)),"complex64"===s)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!(0,i.fU)(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){(0,i.Mu)(t);const e=(0,i.NA)(t),r=(0,i.NA)(n);(0,i.hu)(e===r,(()=>`Based on the provided shape, [${t}], the tensor should have ${e} values but has ${r}`));for(let e=0;e<n.length;++e){const r=n[e],a=e!==n.length-1||r!==(0,i.NA)(t.slice(e));(0,i.hu)(n[e]===t[e]||!a,(()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${t}). `))}}return(0,i.fU)(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==s?(0,a.toTypedArray)(e,s):(0,i.xH)(e,[],!0),r.BV.makeTensor(e,t,s)}},47501:(e,t,n)=>{"use strict";n.d(t,{G:()=>o});var r=n(97097),i=n(29121),a=n(43740),s=n(20569);const o=(0,n(2668).op)({tile_:function(e,t){const n=(0,a._1)(e,"x","tile","string_or_numeric");s.hu(n.rank===t.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${t}.`));const o={x:n},u={reps:t};return r.BV.runKernel(i.n9,o,u)}})},43243:(e,t,n)=>{"use strict";n.d(t,{h:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({topk_:function(e,t=1,n=!0){const s=(0,a._1)(e,"x","topk");if(0===s.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const o=s.shape[s.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>o)throw new Error(`'k' passed to topk() must be <= the last dimension (${o}) but got ${t}`);const u={x:s},l={k:t,sorted:n},[c,d]=r.BV.runKernel(i.cW,u,l);return{values:c,indices:d}}})},89065:(e,t,n)=>{"use strict";n.d(t,{p:()=>o});var r=n(97097),i=n(29121),a=n(43740),s=n(20569);const o=(0,n(2668).op)({transpose_:function(e,t){const n=(0,a._1)(e,"x","transpose");if(null==t&&(t=n.shape.map(((e,t)=>t)).reverse()),s.hu(n.rank===t.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of perm ${t}.`)),t.forEach((e=>{s.hu(e>=0&&e<n.rank,(()=>"All entries in 'perm' must be between 0 and "+(n.rank-1)+` but got ${t}`))})),n.rank<=1)return n.clone();const o={x:n},u={perm:t};return r.BV.runKernel(i.G3,o,u)}})},49608:(e,t,n)=>{"use strict";n.d(t,{T:()=>o});var r=n(97097),i=n(29121),a=n(43740),s=n(20569);const o=(0,n(2668).op)({unique_:function(e,t=0){const n=(0,a._1)(e,"x","unique","string_or_numeric");(0,s.hu)(n.rank>0,(()=>"The input tensor must be at least 1D"));const o={x:n},u={axis:t},[l,c]=r.BV.runKernel(i.kp,o,u);return{values:l,indices:c}}})},98749:(e,t,n)=>{"use strict";n.d(t,{p:()=>o});var r=n(97097),i=n(29121),a=n(43740),s=n(20569);const o=(0,n(2668).op)({unsortedSegmentSum_:function(e,t,n){const o=(0,a._1)(e,"x","unsortedSegmentSum"),u=(0,a._1)(t,"segmentIds","unsortedSegmentSum","int32");(0,s.hu)((0,s.GN)(n),(()=>"numSegments must be of dtype int"));const l={x:o,segmentIds:u},c={numSegments:n};return r.BV.runKernel(i.Qv,l,c)}})},24136:(e,t,n)=>{"use strict";n.d(t,{H:()=>o});var r=n(97097),i=n(29121),a=n(43740),s=n(20569);const o=(0,n(2668).op)({unstack_:function(e,t=0){const n=(0,a._1)(e,"x","unstack","string_or_numeric");s.hu(t>=-n.shape.length&&t<n.shape.length,(()=>`Axis = ${t} is not in [-${n.shape.length}, ${n.shape.length})`));const o={value:n},u={axis:t};return r.BV.runKernel(i.To,o,u)}})},95912:(e,t,n)=>{"use strict";n.d(t,{a:()=>u});var r=n(97097),i=n(29121),a=n(43740),s=n(68247),o=n(72200);const u=(0,n(2668).op)({where_:function(e,t,n){const u=(0,a._1)(t,"a","where"),l=(0,a._1)(n,"b","where"),c=(0,a._1)(e,"condition","where","bool"),d=(0,o.assertAndGetBroadcastShape)((0,o.assertAndGetBroadcastShape)(c.shape,u.shape),l.shape),h={condition:(0,s.U)(c,d),t:(0,s.U)(u,d),e:(0,s.U)(l,d)};return r.BV.runKernel(i.Ph,h)}})},59640:(e,t,n)=>{"use strict";n.d(t,{l:()=>s});var r=n(97097),i=n(20569),a=n(61661);function s(e,t="float32"){if("complex64"===t){const t=s(e,"float32"),n=s(e,"float32");return(0,a.P)(t,n)}const n=(0,i.wT)((0,i.NA)(e),t);return r.BV.makeTensor(n,e,t)}},29999:(e,t,n)=>{"use strict";n.d(t,{P:()=>s});var r=n(97097),i=n(29121),a=n(43740);const s=(0,n(2668).op)({zerosLike_:function(e){const t={x:(0,a._1)(e,"x","zerosLike")};return r.BV.runKernel(i.Ru,t)}})},6789:(e,t,n)=>{"use strict";n.r(t);var r=n(96235),i=n(4077);(0,i.t3)().prototype.abs=function(){return this.throwIfDisposed(),(0,r.W)(this)};var a=n(17839);(0,i.t3)().prototype.acos=function(){return this.throwIfDisposed(),(0,a.K)(this)};var s=n(91470);(0,i.t3)().prototype.acosh=function(){return this.throwIfDisposed(),(0,s._)(this)};var o=n(56407);(0,i.t3)().prototype.add=function(e){return this.throwIfDisposed(),(0,o.I)(this,e)};var u=n(90781);(0,i.t3)().prototype.all=function(e,t){return this.throwIfDisposed(),(0,u.$)(this,e,t)};var l=n(92998);(0,i.t3)().prototype.any=function(e,t){return this.throwIfDisposed(),(0,l.Y)(this,e,t)};var c=n(40047);(0,i.t3)().prototype.argMax=function(e){return this.throwIfDisposed(),(0,c.N)(this,e)};var d=n(27394);(0,i.t3)().prototype.argMin=function(e){return this.throwIfDisposed(),(0,d.v)(this,e)};var h=n(4968),f=n(20569);(0,i.t3)().prototype.asScalar=function(){return this.throwIfDisposed(),(0,f.hu)(1===this.size,(()=>"The array must have only 1 element.")),(0,h.X)(this,[])};var p=n(62271);(0,i.t3)().prototype.asType=function(e){return this.throwIfDisposed(),(0,p.p)(this,e)},(0,i.t3)().prototype.as1D=function(){return this.throwIfDisposed(),(0,h.X)(this,[this.size])},(0,i.t3)().prototype.as2D=function(e,t){return this.throwIfDisposed(),(0,h.X)(this,[e,t])},(0,i.t3)().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),(0,h.X)(this,[e,t,n])},(0,i.t3)().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),(0,h.X)(this,[e,t,n,r])},(0,i.t3)().prototype.as5D=function(e,t,n,r,i){return this.throwIfDisposed(),(0,h.X)(this,[e,t,n,r,i])};var g=n(72421);(0,i.t3)().prototype.asin=function(){return this.throwIfDisposed(),(0,g.Z)(this)};var m=n(21891);(0,i.t3)().prototype.asinh=function(){return this.throwIfDisposed(),(0,m.V)(this)};var y=n(77037);(0,i.t3)().prototype.atan=function(){return this.throwIfDisposed(),(0,y.z)(this)};var v=n(29812);(0,i.t3)().prototype.atan2=function(e){return this.throwIfDisposed(),(0,v.f)(this,e)};var b=n(80369);(0,i.t3)().prototype.atanh=function(){return this.throwIfDisposed(),(0,b.C)(this)};var x=n(15176);(0,i.t3)().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),(0,x.w)(this,e,t,n,r)};var w=n(28441);(0,i.t3)().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),(0,w.E)(this,e,t)};var k=n(27505);(0,i.t3)().prototype.batchNorm=function(e,t,n,r,i){return this.throwIfDisposed(),(0,k.t)(this,e,t,n,r,i)};var _=n(68247);(0,i.t3)().prototype.broadcastTo=function(e){return this.throwIfDisposed(),(0,_.U)(this,e)},(0,i.t3)().prototype.cast=function(e){return this.throwIfDisposed(),(0,p.p)(this,e)};var S=n(6825);(0,i.t3)().prototype.ceil=function(){return this.throwIfDisposed(),(0,S.m)(this)};var C=n(42279);(0,i.t3)().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),(0,C.i)(this,e,t)};var A=n(46884);(0,i.t3)().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof i.es&&(e=[e]),(0,A.z)([this,...e],t)};var E=n(11355);(0,i.t3)().prototype.conv1d=function(e,t,n,r,i,a){return this.throwIfDisposed(),(0,E.P)(this,e,t,n,r,i,a)};var F=n(71405);(0,i.t3)().prototype.conv2dTranspose=function(e,t,n,r,i){return this.throwIfDisposed(),(0,F.b)(this,e,t,n,r,i)};var I=n(64794);(0,i.t3)().prototype.conv2d=function(e,t,n,r,i,a){return this.throwIfDisposed(),(0,I.T)(this,e,t,n,r,i,a)};var D=n(70173);(0,i.t3)().prototype.cos=function(){return this.throwIfDisposed(),(0,D.m)(this)};var N=n(2699);(0,i.t3)().prototype.cosh=function(){return this.throwIfDisposed(),(0,N.f)(this)};var $=n(9640);(0,i.t3)().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),(0,$.$)(this,e,t,n)};var T=n(37405);(0,i.t3)().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),(0,T.z)(this,e,t,n)};var O=n(89112);(0,i.t3)().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),(0,O.n)(this,e,t)};var M=n(64718);(0,i.t3)().prototype.depthwiseConv2d=function(e,t,n,r,i,a){return this.throwIfDisposed(),(0,M.B)(this,e,t,n,r,i,a)};var R=n(70557);(0,i.t3)().prototype.dilation2d=function(e,t,n,r,i){return this.throwIfDisposed(),(0,R.W)(this,e,t,n,r,i)};var B=n(49322);(0,i.t3)().prototype.divNoNan=function(e){return this.throwIfDisposed(),(0,B.N)(this,e)};var z=n(41274);(0,i.t3)().prototype.div=function(e){return this.throwIfDisposed(),(0,z.h)(this,e)};var L=n(30548);(0,i.t3)().prototype.dot=function(e){return this.throwIfDisposed(),(0,L.A)(this,e)};var P=n(83233);(0,i.t3)().prototype.elu=function(){return this.throwIfDisposed(),(0,P.p)(this)};var j=n(26477);(0,i.t3)().prototype.equal=function(e){return this.throwIfDisposed(),(0,j.D)(this,e)};var U=n(34650);(0,i.t3)().prototype.erf=function(){return this.throwIfDisposed(),(0,U.q)(this)};var W=n(44842);(0,i.t3)().prototype.exp=function(){return this.throwIfDisposed(),(0,W.Q)(this)};var V=n(81300);(0,i.t3)().prototype.expandDims=function(e){return this.throwIfDisposed(),(0,V.d)(this,e)};var G=n(53426);(0,i.t3)().prototype.expm1=function(){return this.throwIfDisposed(),(0,G.t)(this)};var q=n(7020);(0,i.t3)().prototype.fft=function(){return this.throwIfDisposed(),(0,q.k)(this)},(0,i.t3)().prototype.flatten=function(){return this.throwIfDisposed(),(0,h.X)(this,[this.size])};var H=n(26943);(0,i.t3)().prototype.floor=function(){return this.throwIfDisposed(),(0,H.G)(this)};var X=n(9165);(0,i.t3)().prototype.floorDiv=function(e){return this.throwIfDisposed(),(0,X.q)(this,e)};var K=n(24926);(0,i.t3)().prototype.gather=function(e,t){return this.throwIfDisposed(),(0,K.I)(this,e,t)};var Y=n(17630);(0,i.t3)().prototype.greaterEqual=function(e){return this.throwIfDisposed(),(0,Y.b)(this,e)};var Q=n(20636);(0,i.t3)().prototype.greater=function(e){return this.throwIfDisposed(),(0,Q.p)(this,e)};var J=n(88447);(0,i.t3)().prototype.ifft=function(){return this.throwIfDisposed(),(0,J.S)(this)};var Z=n(84415);(0,i.t3)().prototype.irfft=function(){return this.throwIfDisposed(),(0,Z.w)(this)};var ee=n(13963);(0,i.t3)().prototype.isFinite=function(){return this.throwIfDisposed(),(0,ee.x)(this)};var te=n(4365);(0,i.t3)().prototype.isInf=function(){return this.throwIfDisposed(),(0,te.U)(this)};var ne=n(96230);(0,i.t3)().prototype.isNaN=function(){return this.throwIfDisposed(),(0,ne.i)(this)};var re=n(99133);(0,i.t3)().prototype.leakyRelu=function(e){return this.throwIfDisposed(),(0,re.h)(this,e)};var ie=n(50624);(0,i.t3)().prototype.lessEqual=function(e){return this.throwIfDisposed(),(0,ie.z)(this,e)};var ae=n(86573);(0,i.t3)().prototype.less=function(e){return this.throwIfDisposed(),(0,ae.d)(this,e)};var se=n(79648);(0,i.t3)().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),(0,se.G)(this,e,t,n,r)};var oe=n(13888);(0,i.t3)().prototype.logSigmoid=function(){return this.throwIfDisposed(),(0,oe.e)(this)};var ue=n(31510);(0,i.t3)().prototype.logSoftmax=function(e){return this.throwIfDisposed(),(0,ue.C)(this,e)};var le=n(11391);(0,i.t3)().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),(0,le.l)(this,e,t)};var ce=n(82597);(0,i.t3)().prototype.log=function(){return this.throwIfDisposed(),(0,ce.c)(this)};var de=n(17474);(0,i.t3)().prototype.log1p=function(){return this.throwIfDisposed(),(0,de.K)(this)};var he=n(2856);(0,i.t3)().prototype.logicalAnd=function(e){return this.throwIfDisposed(),(0,he.H)(this,e)};var fe=n(38651);(0,i.t3)().prototype.logicalNot=function(){return this.throwIfDisposed(),(0,fe.h)(this)};var pe=n(15750);(0,i.t3)().prototype.logicalOr=function(e){return this.throwIfDisposed(),(0,pe.K)(this,e)};var ge=n(10596);(0,i.t3)().prototype.logicalXor=function(e){return this.throwIfDisposed(),(0,ge.e)(this,e)};var me=n(28687);(0,i.t3)().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),(0,me.O)(this,e,t,n)};var ye=n(21174);(0,i.t3)().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),(0,ye._)(this,e,t,n,r)};var ve=n(83307);(0,i.t3)().prototype.max=function(e,t){return this.throwIfDisposed(),(0,ve.F)(this,e,t)};var be=n(80632);(0,i.t3)().prototype.maximum=function(e){return this.throwIfDisposed(),(0,be.g)(this,e)};var xe=n(75130);(0,i.t3)().prototype.mean=function(e,t){return this.throwIfDisposed(),(0,xe.J)(this,e,t)};var we=n(25735);(0,i.t3)().prototype.min=function(e,t){return this.throwIfDisposed(),(0,we.V)(this,e,t)};var ke=n(24513);(0,i.t3)().prototype.minimum=function(e){return this.throwIfDisposed(),(0,ke.L)(this,e)};var _e=n(71483);(0,i.t3)().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),(0,_e.V)(this,e,t)};var Se=n(85228);(0,i.t3)().prototype.mod=function(e){return this.throwIfDisposed(),(0,Se.w)(this,e)};var Ce=n(24841);(0,i.t3)().prototype.mul=function(e){return this.throwIfDisposed(),(0,Ce.d)(this,e)};var Ae=n(17370);(0,i.t3)().prototype.neg=function(){return this.throwIfDisposed(),(0,Ae.W)(this)};var Ee=n(3561);(0,i.t3)().prototype.norm=function(e,t,n){return this.throwIfDisposed(),(0,Ee.K)(this,e,t,n)};var Fe=n(16500);(0,i.t3)().prototype.notEqual=function(e){return this.throwIfDisposed(),(0,Fe.Q)(this,e)};var Ie=n(76708);(0,i.t3)().prototype.oneHot=function(e,t=1,n=0){return this.throwIfDisposed(),(0,Ie.l)(this,e,t,n)};var De=n(7846);(0,i.t3)().prototype.onesLike=function(){return this.throwIfDisposed(),(0,De.J)(this)};var Ne=n(39682);(0,i.t3)().prototype.pad=function(e,t){return this.throwIfDisposed(),(0,Ne.v)(this,e,t)};var $e=n(85860);(0,i.t3)().prototype.pool=function(e,t,n,r,i,a){return this.throwIfDisposed(),(0,$e.d)(this,e,t,n,r,i,a)};var Te=n(33453);(0,i.t3)().prototype.pow=function(e){return this.throwIfDisposed(),(0,Te.s)(this,e)};var Oe=n(98151);(0,i.t3)().prototype.prelu=function(e){return this.throwIfDisposed(),(0,Oe.A)(this,e)};var Me=n(49451);(0,i.t3)().prototype.prod=function(e,t){return this.throwIfDisposed(),(0,Me.W)(this,e,t)};var Re=n(19036);(0,i.t3)().prototype.reciprocal=function(){return this.throwIfDisposed(),(0,Re.M)(this)};var Be=n(7409);(0,i.t3)().prototype.relu=function(){return this.throwIfDisposed(),(0,Be.U)(this)};var ze=n(83582);(0,i.t3)().prototype.relu6=function(){return this.throwIfDisposed(),(0,ze.b)(this)},(0,i.t3)().prototype.reshapeAs=function(e){return this.throwIfDisposed(),(0,h.X)(this,e.shape)},(0,i.t3)().prototype.reshape=function(e){return this.throwIfDisposed(),(0,h.X)(this,e)};var Le=n(13305);(0,i.t3)().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),(0,Le.I)(this,e,t,n)};var Pe=n(95098);(0,i.t3)().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),(0,Pe.j)(this,e,t,n)};var je=n(57486);(0,i.t3)().prototype.reverse=function(e){return this.throwIfDisposed(),(0,je.G)(this,e)};var Ue=n(13710);(0,i.t3)().prototype.rfft=function(){return this.throwIfDisposed(),(0,Ue.Q)(this)};var We=n(97809);(0,i.t3)().prototype.round=function(){return this.throwIfDisposed(),(0,We.N)(this)};var Ve=n(32634);(0,i.t3)().prototype.rsqrt=function(){return this.throwIfDisposed(),(0,Ve.b)(this)};var Ge=n(55503);(0,i.t3)().prototype.selu=function(){return this.throwIfDisposed(),(0,Ge.U)(this)};var qe=n(68678);(0,i.t3)().prototype.separableConv2d=function(e,t,n,r,i,a){return this.throwIfDisposed(),(0,qe.U)(this,e,t,n,r,i,a)};var He=n(30625);(0,i.t3)().prototype.sigmoid=function(){return this.throwIfDisposed(),(0,He.X)(this)};var Xe=n(34434);(0,i.t3)().prototype.sign=function(){return this.throwIfDisposed(),(0,Xe.X)(this)};var Ke=n(99331);(0,i.t3)().prototype.sin=function(){return this.throwIfDisposed(),(0,Ke.O)(this)};var Ye=n(83254);(0,i.t3)().prototype.sinh=function(){return this.throwIfDisposed(),(0,Ye.R)(this)};var Qe=n(22676);(0,i.t3)().prototype.slice=function(e,t){return this.throwIfDisposed(),(0,Qe.t)(this,e,t)};var Je=n(80682);(0,i.t3)().prototype.softmax=function(e){return this.throwIfDisposed(),(0,Je.X)(this,e)};var Ze=n(3694);(0,i.t3)().prototype.softplus=function(){return this.throwIfDisposed(),(0,Ze.W)(this)};var et=n(27918);(0,i.t3)().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),(0,et.f)(this,e,t)};var tt=n(28644);(0,i.t3)().prototype.split=function(e,t){return this.throwIfDisposed(),(0,tt.V)(this,e,t)};var nt=n(13261);(0,i.t3)().prototype.sqrt=function(){return this.throwIfDisposed(),(0,nt._)(this)};var rt=n(50248);(0,i.t3)().prototype.square=function(){return this.throwIfDisposed(),(0,rt.h)(this)};var it=n(15265);(0,i.t3)().prototype.squaredDifference=function(e){return this.throwIfDisposed(),(0,it.$)(this,e)};var at=n(79590);(0,i.t3)().prototype.squeeze=function(e){return this.throwIfDisposed(),(0,at.L)(this,e)};var st=n(82991);(0,i.t3)().prototype.stack=function(e,t){this.throwIfDisposed();const n=e instanceof i.es?[this,e]:[this,...e];return(0,st.k)(n,t)};var ot=n(71901);(0,i.t3)().prototype.step=function(e){return this.throwIfDisposed(),(0,ot.N)(this,e)};var ut=n(55158);(0,i.t3)().prototype.stridedSlice=function(e,t,n,r,i,a,s,o){return this.throwIfDisposed(),(0,ut.N)(this,e,t,n,r,i,a,s,o)};var lt=n(70827);(0,i.t3)().prototype.sub=function(e){return this.throwIfDisposed(),(0,lt.l)(this,e)};var ct=n(15475);(0,i.t3)().prototype.sum=function(e,t){return this.throwIfDisposed(),(0,ct.S)(this,e,t)};var dt=n(61173);(0,i.t3)().prototype.tan=function(){return this.throwIfDisposed(),(0,dt.O)(this)};var ht=n(21869);(0,i.t3)().prototype.tanh=function(){return this.throwIfDisposed(),(0,ht.A)(this)};var ft=n(47501);(0,i.t3)().prototype.tile=function(e){return this.throwIfDisposed(),(0,ft.G)(this,e)},(0,i.t3)().prototype.toBool=function(){return this.throwIfDisposed(),(0,p.p)(this,"bool")},(0,i.t3)().prototype.toFloat=function(){return this.throwIfDisposed(),(0,p.p)(this,"float32")},(0,i.t3)().prototype.toInt=function(){return this.throwIfDisposed(),(0,p.p)(this,"int32")};var pt=n(43243);(0,i.t3)().prototype.topk=function(e,t){return this.throwIfDisposed(),(0,pt.h)(this,e,t)};var gt=n(89065);(0,i.t3)().prototype.transpose=function(e){return this.throwIfDisposed(),(0,gt.p)(this,e)};var mt=n(49608);(0,i.t3)().prototype.unique=function(e){return this.throwIfDisposed(),(0,mt.T)(this,e)};var yt=n(98749);(0,i.t3)().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),(0,yt.p)(this,e,t)};var vt=n(24136);(0,i.t3)().prototype.unstack=function(e){return this.throwIfDisposed(),(0,vt.H)(this,e)};var bt=n(95912);(0,i.t3)().prototype.where=function(e,t){return this.throwIfDisposed(),(0,bt.a)(e,this,t)};var xt=n(29999);(0,i.t3)().prototype.zerosLike=function(){return this.throwIfDisposed(),(0,xt.P)(this)}},4077:(e,t,n)=>{"use strict";n.d(t,{es:()=>v,YD:()=>d,_w:()=>x,t3:()=>b,FZ:()=>y,Vp:()=>m,Vi:()=>g});var r=n(55938),i=n(20569);function a(e,t,n,r){const a=(0,i.e3)(t),o=function(e,t,n,r){const a=(0,i.NA)(t),o=r[r.length-1],u=new Array(o).fill(0),c=t.length,d="complex64"===n?l(e):e;if(c>1)for(let e=0;e<a/o;e++){const t=e*o;for(let e=0;e<o;e++)u[e]=Math.max(u[e],s(d[t+e],0,n).length)}return u}(e,t,n,a),c=t.length,d=u(e,t,n,a,o),h=["Tensor"];return r&&(h.push(`  dtype: ${n}`),h.push(`  rank: ${c}`),h.push(`  shape: [${t}]`),h.push("  values:")),h.push(d.map((e=>"    "+e)).join("\n")),h.join("\n")}function s(e,t,n){let r;return r=Array.isArray(e)?`${parseFloat(e[0].toFixed(7))} + ${parseFloat(e[1].toFixed(7))}j`:(0,i.HD)(e)?`'${e}'`:"bool"===n?o(e):parseFloat(e.toFixed(7)).toString(),(0,i.oj)(r,t)}function o(e){return 0===e?"false":"true"}function u(e,t,n,r,i,a=!0){const c="complex64"===n?2:1,d=t[0],h=t.length;if(0===h)return"complex64"===n?[s(l(e)[0],0,n)]:"bool"===n?[o(e[0])]:[e[0].toString()];if(1===h){if(d>20){const t=3*c;let r=Array.from(e.slice(0,t)),a=Array.from(e.slice((d-3)*c,d*c));return"complex64"===n&&(r=l(r),a=l(a)),["["+r.map(((e,t)=>s(e,i[t],n))).join(", ")+", ..., "+a.map(((e,t)=>s(e,i[d-3+t],n))).join(", ")+"]"]}return["["+("complex64"===n?l(e):Array.from(e)).map(((e,t)=>s(e,i[t],n))).join(", ")+"]"]}const f=t.slice(1),p=r.slice(1),g=r[0]*c,m=[];if(d>20){for(let t=0;t<3;t++){const r=t*g,a=r+g;m.push(...u(e.slice(r,a),f,n,p,i,!1))}m.push("...");for(let t=d-3;t<d;t++){const r=t*g,a=r+g;m.push(...u(e.slice(r,a),f,n,p,i,t===d-1))}}else for(let t=0;t<d;t++){const r=t*g,a=r+g;m.push(...u(e.slice(r,a),f,n,p,i,t===d-1))}const y=2===h?",":"";m[0]="["+m[0]+y;for(let e=1;e<m.length-1;e++)m[e]=" "+m[e]+y;let v=",\n";for(let e=2;e<h;e++)v+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(a?"":v),m}function l(e){const t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var c=n(79122);class d{constructor(e,t,n){if(this.dtype=t,this.shape=e.slice(),this.size=i.NA(e),null!=n){const e=n.length;i.hu(e===this.size,(()=>`Length of values '${e}' does not match the size inferred by the shape '${this.size}'.`))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||i.rQ(t,this.size),this.strides=(0,i.e3)(e)}set(e,...t){0===t.length&&(t=[0]),i.hu(t.length===this.rank,(()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`));const n=this.locToIndex(t);this.values[n]=e}get(...e){0===e.length&&(e=[0]);let t=0;for(const n of e){if(n<0||n>=this.shape[t]){const t=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(t)}t++}let n=e[e.length-1];for(let t=0;t<e.length-1;++t)n+=this.strides[t]*e[t];return this.values[n]}locToIndex(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];let t=e[e.length-1];for(let n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}indexToLoc(e){if(0===this.rank)return[];if(1===this.rank)return[e];const t=new Array(this.shape.length);for(let n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return h().makeTensor(this.values,this.shape,this.dtype)}}let h=null,f=null,p=null;function g(e){h=e}function m(e){f=e}function y(e){p=e}class v{constructor(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=i.NA(e),this.strides=(0,i.e3)(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return f.buffer(this.shape,this.dtype,e)}bufferSync(){return f.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return(0,i.GX)(this.shape,e,"complex64"===this.dtype)}arraySync(){return(0,i.GX)(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const e=h().read(this.dataId);if("string"===this.dtype){const t=await e;try{return t.map((e=>c.decodeString(e)))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),h().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=h().readSync(this.dataId);if("string"===this.dtype)try{return e.map((e=>c.decodeString(e)))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await h().read(this.dataId);return"string"===this.dtype?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(h().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return f.print(this,e)}clone(){return this.throwIfDisposed(),f.clone(this)}toString(e=!1){return a(this.dataSync(),this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),f.cast(this,e)}variable(e=!0,t,n){return this.throwIfDisposed(),h().makeVariable(this,e,t,n)}}function b(){return(0,r.R)("Tensor",(()=>v))}Object.defineProperty(v,Symbol.hasInstance,{value:e=>!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}),b();class x extends v{constructor(e,t,n,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!i.cO(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);h().disposeTensor(this),this.dataId=e.dataId,h().incRef(this,null)}dispose(){h().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(x,Symbol.hasInstance,{value:e=>e instanceof v&&null!=e.assign&&e.assign instanceof Function})},80747:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assertTypesMatch:()=>o,getTensorsInContainer:()=>l,isTensorInList:()=>u,makeTypesMatch:()=>s});var r=n(4077),i=n(71221),a=n(20569);function s(e,t){if(e.dtype===t.dtype)return[e,t];const n=(0,i.x8)(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function o(e,t){(0,a.hu)(e.dtype===t.dtype,(()=>`The dtypes of the first(${e.dtype}) and second(${t.dtype}) input must match`))}function u(e,t){return t.some((t=>t.id===e.id))}function l(e){const t=[];return c(e,t,new Set),t}function c(e,t,n){if(null==e)return;if(e instanceof r.es)return void t.push(e);if(i=e,!Array.isArray(i)&&"object"!=typeof i)return;var i;const a=e;for(const e in a){const r=a[e];n.has(r)||(n.add(r),c(r,t,n))}}},43740:(e,t,n)=>{"use strict";n.d(t,{C:()=>u,_1:()=>d,sI:()=>h});var r=n(97097),i=n(22885),a=n(4077),s=n(20569),o=n(79122);function u(e,t){let n=e;if((0,s.fU)(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];const r=[];for(;Array.isArray(n)||(0,s.fU)(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&(0,i.OB)().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&l(e,r,[]),r}function l(e,t,n){if(n=n||[],!Array.isArray(e)&&!(0,s.fU)(e))return void(0,s.hu)(0===t.length,(()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`));(0,s.hu)(t.length>0,(()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${e.length} elements`)),(0,s.hu)(e.length===t[0],(()=>`Element arr[${n.join("][")}] should have ${t[0]} elements, but has ${e.length} elements`));const r=t.slice(1);for(let t=0;t<e.length;++t)l(e[t],r,n.concat(t))}function c(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error(`Argument '${n}' passed to '${r}' must be ${e} tensor, but got ${t} tensor`)}}function d(e,t,n,i="numeric"){if(e instanceof a.es)return c(i,e.dtype,t,n),e;let l=(0,s.D2)(e);if("string"!==l&&["bool","int32","float32"].indexOf(i)>=0&&(l=i),c(i,l,t,n),null==e||!(0,s.fU)(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){const r=null==e?"null":e.constructor.name;throw new Error(`Argument '${t}' passed to '${n}' must be a Tensor or TensorLike, but got '${r}'`)}const d=u(e,l);(0,s.fU)(e)||Array.isArray(e)||(e=[e]);const h="string"!==l?(0,o.toTypedArray)(e,l):(0,s.xH)(e,[],!0);return r.BV.makeTensor(h,d,l)}function h(e,t,n,r="numeric"){if(!Array.isArray(e))throw new Error(`Argument ${t} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return e.map(((e,i)=>d(e,`${t}[${i}]`,n,r)))}},71221:(e,t,n)=>{"use strict";var r,i,a,s,o;n.d(t,{x8:()=>l,yw:()=>r,z4:()=>c}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(r||(r={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(i||(i={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(a||(a={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(s||(s={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(o||(o={}));const u={float32:s,int32:i,bool:a,complex64:o};function l(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error(`Can not upcast ${e} with ${t}`)}return u[e][t]}function c(e){return l(e,"int32")}},79122:(e,t,n)=>{"use strict";n.r(t),n.d(t,{arraysEqual:()=>i.cO,assert:()=>i.hu,assertNonNegativeIntegerDimensions:()=>i.Mu,assertNonNull:()=>i.Cq,assertShapesMatch:()=>i.k5,bytesFromStringArray:()=>i.Ub,bytesPerElement:()=>i.bT,checkConversionForErrors:()=>i.D5,clamp:()=>i.uZ,computeStrides:()=>i.e3,createScalarValue:()=>b,createShuffledIndices:()=>i.U$,decodeString:()=>S,distSquared:()=>i.E7,encodeString:()=>_,fetch:()=>k,fingerPrint64:()=>v,flatten:()=>i.xH,getArrayFromDType:()=>i.rQ,getTypedArrayFromDType:()=>i.WP,hasEncodingLoss:()=>i.QB,hexToLong:()=>o,indexToLoc:()=>i.NE,inferDtype:()=>i.D2,inferFromImplicitShape:()=>i.JZ,isBoolean:()=>i.jn,isFunction:()=>i.mf,isInt:()=>i.GN,isNumber:()=>i.hj,isPromise:()=>i.tI,isScalarShape:()=>i.N9,isString:()=>i.HD,isTypedArray:()=>i.fU,isValidDtype:()=>i.LP,locToIndex:()=>i.qy,makeOnesTypedArray:()=>i.p8,makeZerosNestedTypedArray:()=>i.l6,makeZerosTypedArray:()=>i.wT,nearestDivisor:()=>i.jP,nearestLargerEven:()=>i.nY,now:()=>w,parseAxisParam:()=>i.EC,randUniform:()=>i.bj,repeatedTry:()=>i.WD,rightPad:()=>i.oj,shuffle:()=>i.TV,shuffleCombo:()=>i.d7,sizeFromShape:()=>i.NA,sizeToSquarishShape:()=>i.YP,squeezeShape:()=>i.bp,sum:()=>i.Sm,swap:()=>i.LF,tanh:()=>i.AE,toNestedArray:()=>i.GX,toTypedArray:()=>x});var r=n(22885),i=n(20569),a=n(43720);const s=n.n(a)()||a;function o(e){return s.fromString(e,!0,16)}const u=o("c3a5c85c97cb3127"),l=o("b492b66fbe98f273"),c=o("9ae16a3b2f90404f");function d(e){return e.xor(e.shru(47))}function h(e,t,n){const r=e.slice(t,t+n);return s.fromBytes(Array.from(r),!0,!0)}function f(e,t){return h(e,t,8)}function p(e,t){return h(e,t,4)}function g(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function m(e,t,n=o("9ddfea08eb382d69")){let r=e.xor(t).mul(n);r=r.xor(r.shru(47));let i=t.xor(r).mul(n);return i=i.xor(i.shru(47)),i=i.mul(n),i}function y(e,t,n,r){return function(e,t,n,r,i,a){i=i.add(e),a=g(a.add(i).add(r),21);const s=i;return i=(i=i.add(t)).add(n),a=a.add(g(i,44)),[i.add(r),a.add(s)]}(f(e,t),f(e,t+8),f(e,t+16),f(e,t+24),n,r)}function v(e,t=e.length){const n=s.fromNumber(81,!0);if(t<=32)return t<=16?function(e,t=e.length){if(t>=8){const n=c.add(2*t),r=f(e,0).add(c),i=f(e,t-8);return m(g(i,37).mul(n).add(r),g(r,25).add(i).mul(n),n)}if(t>=4){const n=c.add(2*t);return m(p(e,0).shl(3).add(t),p(e,t-4),n)}if(t>0){const n=e[0]+(e[t>>1]<<8),r=t+(e[t-1]<<2);return d(c.mul(n).xor(u.mul(r))).mul(c)}return c}(e,t):function(e,t=e.length){const n=c.add(2*t),r=f(e,0).mul(l),i=f(e,8),a=f(e,t-8).mul(n),s=f(e,t-16).mul(c);return m(g(r.add(i),43).add(g(a,30)).add(s),r.add(g(i.add(c),18)).add(a),n)}(e,t);if(t<=64)return function(e,t=e.length){const n=c.add(2*t),r=f(e,0).mul(c),i=f(e,8),a=f(e,t-8).mul(n),s=f(e,t-16).mul(c),o=g(r.add(i),43).add(g(a,30)).add(s),u=m(o,r.add(g(i.add(c),18)).add(a),n),l=f(e,16).mul(n),d=f(e,24),h=o.add(f(e,t-32)).mul(n),p=u.add(f(e,t-24)).mul(n);return m(g(l.add(d),43).add(g(h,30)).add(p),l.add(g(d.add(r),18)).add(h),n)}(e,t);let r=n,i=n.mul(l).add(113),a=d(i.mul(c).add(113)).mul(c),o=[s.UZERO,s.UZERO],h=[s.UZERO,s.UZERO];r=r.mul(c).add(f(e,0));let v=0;const b=64*(t-1>>6),x=b+(t-1&63)-63;do{r=g(r.add(i).add(o[0]).add(f(e,v+8)),37).mul(l),i=g(i.add(o[1]).add(f(e,v+48)),42).mul(l),r=r.xor(h[1]),i=i.add(o[0]).add(f(e,v+40)),a=g(a.add(h[0]),33).mul(l),o=y(e,v,o[1].mul(l),r.add(h[0])),h=y(e,v+32,a.add(h[1]),i.add(f(e,v+16))),[a,r]=[r,a],v+=64}while(v!==b);const w=l.add(a.and(255).shl(1));return v=x,h[0]=h[0].add(t-1&63),o[0]=o[0].add(h[0]),h[0]=h[0].add(o[0]),r=g(r.add(i).add(o[0]).add(f(e,v+8)),37).mul(w),i=g(i.add(o[1]).add(f(e,v+48)),42).mul(w),r=r.xor(h[1].mul(9)),i=i.add(o[0].mul(9).add(f(e,v+40))),a=g(a.add(h[0]),33).mul(w),o=y(e,v,o[1].mul(w),r.add(h[0])),h=y(e,v+32,a.add(h[1]),i.add(f(e,v+16))),[a,r]=[r,a],m(m(o[0],h[0],w).add(d(i).mul(u)).add(a),m(o[1],h[1],w).add(r),w)}function b(e,t){return"string"===t?_(e):x([e],t)}function x(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=i.xH(e)),(0,r.OB)().getBool("DEBUG")&&i.D5(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){const t=new Uint8Array(e.length);for(let n=0;n<t.length;++n)0!==Math.round(e[n])&&(t[n]=1);return t}throw new Error(`Unknown data type ${t}`)}function w(){return(0,r.OB)().platform.now()}function k(e,t){return(0,r.OB)().platform.fetch(e,t)}function _(e,t="utf-8"){return t=t||"utf-8",(0,r.OB)().platform.encode(e,t)}function S(e,t="utf-8"){return t=t||"utf-8",(0,r.OB)().platform.decode(e,t)}},20569:(e,t,n)=>{"use strict";function r(e){let t=e.length,n=0;for(;t>0;)n=Math.random()*t|0,t--,o(e,t,n)}function i(e,t){if(e.length!==t.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${e.length}Second array length was ${t.length}`);let n=e.length,r=0;for(;n>0;)r=Math.random()*n|0,n--,o(e,n,r),o(t,n,r)}function a(e,t,n){return Math.max(e,Math.min(t,n))}function s(e){return e%2==0?e:e+1}function o(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function u(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}function l(e,t){const n=Math.random();return t*n+(1-n)*e}function c(e,t){let n=0;for(let r=0;r<e.length;r++){const i=Number(e[r])-Number(t[r]);n+=i*i}return n}function d(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function h(e,t,n=""){d(y(e,t),(()=>n+` Shapes ${e} and ${t} must match`))}function f(e){d(null!=e,(()=>"The input to the tensor constructor must be a non-null value."))}function p(e,t=[],n=!1){if(null==t&&(t=[]),Array.isArray(e)||$(e)&&!n)for(let r=0;r<e.length;++r)p(e[r],t,n);else t.push(e);return t}function g(e){if(0===e.length)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function m(e){return 0===e.length}function y(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function v(e){return e%1==0}function b(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;{const t=Math.exp(2*e);return(t-1)/(t+1)}}function x(e){const t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function w(e){const t=new Uint32Array(e);for(let n=0;n<e;++n)t[n]=n;return r(t),t}function k(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function _(e,t=(e=>0),n){return new Promise(((r,i)=>{let a=0;const s=()=>{if(e())return void r();a++;const o=t(a);null!=n&&a>=n?i():setTimeout(s,o)};s()}))}function S(e,t){let n=1,r=-1;for(let t=0;t<e.length;++t)if(e[t]>=0)n*=e[t];else if(-1===e[t]){if(-1!==r)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${t}`);r=t}else if(e[t]<0)throw Error(`Shapes can not be < 0. Found ${e[t]} at dim ${t}`);if(-1===r){if(t>0&&t!==n)throw Error(`Size(${t}) must match the product of shape ${e}`);return e}if(0===n)throw Error(`Cannot infer the missing size in [${e}] when there are 0 elements`);if(t%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${n}`);const i=e.slice();return i[r]=t/n,i}function C(e,t){const n=t.length;return d((e=null==e?t.map(((e,t)=>t)):[].concat(e)).every((e=>e>=-n&&e<n)),(()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${e}`)),d(e.every((e=>v(e))),(()=>`All values in axis param must be integers but got axis ${e}`)),e.map((e=>e<0?n+e:e))}function A(e,t){const n=[],r=[],i=null!=t&&Array.isArray(t)&&0===t.length,a=null==t||i?null:C(t,e).sort();let s=0;for(let t=0;t<e.length;++t){if(null!=a){if(a[s]===t&&1!==e[t])throw new Error(`Can't squeeze axis ${t} since its dim '${e[t]}' is not 1`);(null==a[s]||a[s]>t)&&1===e[t]&&(n.push(e[t]),r.push(t)),a[s]<=t&&s++}1!==e[t]&&(n.push(e[t]),r.push(t))}return{newShape:n,keptDims:r}}function E(e,t){let n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error(`Unknown data type ${e}`);n=new Uint8Array(t)}return n}function F(e,t){let n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error(`Unknown data type ${e}`);n=new Array(t)}return n}function I(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${t} being uploaded contains ${r}.`)}}function D(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function N(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function $(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}function T(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error(`Unknown dtype ${e}`)}function O(e){if(null==e)return 0;let t=0;return e.forEach((e=>t+=e.length)),t}function M(e){return"string"==typeof e||e instanceof String}function R(e){return"boolean"==typeof e}function B(e){return"number"==typeof e}function z(e){return Array.isArray(e)?z(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":B(e)?"float32":M(e)?"string":R(e)?"bool":"float32"}function L(e){return!!(e&&e.constructor&&e.call&&e.apply)}function P(e,t){for(let n=t;n<e;++n)if(e%n==0)return n;return e}function j(e){const t=e.length;if(t<2)return[];const n=new Array(t-1);n[t-2]=e[t-1];for(let r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function U(e,t,n,r=!1){const i=new Array;if(1===t.length){const a=t[0]*(r?2:1);for(let t=0;t<a;t++)i[t]=n[e+t]}else{const a=t[0],s=t.slice(1),o=s.reduce(((e,t)=>e*t))*(r?2:1);for(let t=0;t<a;t++)i[t]=U(e+t*o,s,n,r)}return i}function W(e,t,n=!1){if(0===e.length)return t[0];const r=e.reduce(((e,t)=>e*t))*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error(`[${e}] does not match the input size ${t.length}${n?" for a complex tensor":""}.`);return U(0,e,t,n)}function V(e,t){const n=G(e,t);for(let e=0;e<n.length;e++)n[e]=1;return n}function G(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error(`Unknown data type ${t}`)}function q(e,t){const n=e.reduce(((e,t)=>e*t),1);if(null==t||"float32"===t)return W(e,new Float32Array(n));if("int32"===t)return W(e,new Int32Array(n));if("bool"===t)return W(e,new Uint8Array(n));throw new Error(`Unknown data type ${t}`)}function H(e){e.forEach((t=>{d(Number.isInteger(t)&&t>=0,(()=>`Tensor must have a shape comprised of positive integers but got shape [${e}].`))}))}function X(e,t,n){if(0===t)return 0;if(1===t)return e[0];let r=e[e.length-1];for(let t=0;t<e.length-1;++t)r+=n[t]*e[t];return r}function K(e,t,n){if(0===t)return[];if(1===t)return[e];const r=new Array(t);for(let t=0;t<r.length-1;++t)r[t]=Math.floor(e/n[t]),e-=r[t]*n[t];return r[r.length-1]=e,r}function Y(e){return e&&e.then&&"function"==typeof e.then}n.d(t,{AE:()=>b,Cq:()=>f,D2:()=>z,D5:()=>I,E7:()=>c,EC:()=>C,GN:()=>v,GX:()=>W,HD:()=>M,JZ:()=>S,LF:()=>o,LP:()=>D,Mu:()=>H,N9:()=>m,NA:()=>g,NE:()=>K,QB:()=>N,Sm:()=>u,TV:()=>r,U$:()=>w,Ub:()=>O,WD:()=>_,WP:()=>E,YP:()=>x,bT:()=>T,bj:()=>l,bp:()=>A,cO:()=>y,d7:()=>i,e3:()=>j,fU:()=>$,hj:()=>B,hu:()=>d,jP:()=>P,jn:()=>R,k5:()=>h,l6:()=>q,mf:()=>L,nY:()=>s,oj:()=>k,p8:()=>V,qy:()=>X,rQ:()=>F,tI:()=>Y,uZ:()=>a,wT:()=>G,xH:()=>p})},63129:(e,t,n)=>{var r=n(80626),i=n(90477),a=n(22868),s=n(48197),o=n(11954),u=n(12408),l=n(1662);l.alea=r,l.xor128=i,l.xorwow=a,l.xorshift7=s,l.xor4096=o,l.tychei=u,e.exports=l},80626:function(e,t,n){var r;!function(e,i,a){function s(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function o(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function u(e,t){var n=new s(e),r=t&&t.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.alea=u}(0,e=n.nmd(e),n.amdD)},12408:function(e,t,n){var r;!function(e,i,a){function s(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function o(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function u(e,t){var n=new s(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.tychei=u}(0,e=n.nmd(e),n.amdD)},90477:function(e,t,n){var r;!function(e,i,a){function s(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function u(e,t){var n=new s(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.xor128=u}(0,e=n.nmd(e),n.amdD)},11954:function(e,t,n){var r;!function(e,i,a){function s(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,a=t.i;return t.w=r=r+1640531527|0,n=i[a+34&127],e=i[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=i[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,i,a,s,o=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),i=0,a=-32;a<u;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(s=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(s=s+1640531527|0,i=0==(n=o[127&a]^=r+s)?i+1:0);for(i>=128&&(o[127&(t&&t.length||0)]=-1),i=127,a=512;a>0;--a)r=o[i+34&127],n=o[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,o[i]=r^n;e.w=s,e.X=o,e.i=i}(t,e)}function o(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function u(e,t){null==e&&(e=+new Date);var n=new s(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&(r.X&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.xor4096=u}(0,e=n.nmd(e),n.amdD)},48197:function(e,t,n){var r;!function(e,i,a){function s(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],n=(e^=e>>>7)^e<<24,n^=(e=r[i+1&7])^e>>>10,n^=(e=r[i+3&7])^e>>>3,n^=(e=r[i+4&7])^e<<7,e=r[i+7&7],n^=(e^=e<<13)^e<<9,r[i]=n,t.i=i+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function o(e,t){return t.x=e.x.slice(),t.i=e.i,t}function u(e,t){null==e&&(e=+new Date);var n=new s(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&(r.x&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.xorshift7=u}(0,e=n.nmd(e),n.amdD)},22868:function(e,t,n){var r;!function(e,i,a){function s(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function u(e,t){var n=new s(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.xorwow=u}(0,e=n.nmd(e),n.amdD)},1662:(e,t,n)=>{var r;!function(i,a){var s,o=this,u=256,l=a.pow(u,6),c=a.pow(2,52),d=2*c,h=255;function f(e,t,n){var r=[],h=y(m((t=1==t?{entropy:!0}:t||{}).entropy?[e,v(i)]:null==e?function(){try{var e;return s&&(e=s.randomBytes)?e=e(u):(e=new Uint8Array(u),(o.crypto||o.msCrypto).getRandomValues(e)),v(e)}catch(e){var t=o.navigator,n=t&&t.plugins;return[+new Date,o,n,o.screen,v(i)]}}():e,3),r),f=new p(r),b=function(){for(var e=f.g(6),t=l,n=0;e<c;)e=(e+n)*u,t*=u,n=f.g(1);for(;e>=d;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|f.g(4)},b.quick=function(){return f.g(4)/4294967296},b.double=b,y(v(f.S),i),(t.pass||n||function(e,t,n,r){return r&&(r.S&&g(r,f),e.state=function(){return g(f,{})}),n?(a.random=e,t):e})(b,h,"global"in t?t.global:this==a,t.state)}function p(e){var t,n=e.length,r=this,i=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);i<u;)s[i]=i++;for(i=0;i<u;i++)s[i]=s[a=h&a+e[i%n]+(t=s[i])],s[a]=t;(r.g=function(e){for(var t,n=0,i=r.i,a=r.j,s=r.S;e--;)t=s[i=h&i+1],n=n*u+s[h&(s[i]=s[a=h&a+t])+(s[a]=t)];return r.i=i,r.j=a,n})(u)}function g(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){var n,r=[],i=typeof e;if(t&&"object"==i)for(n in e)try{r.push(m(e[n],t-1))}catch(e){}return r.length?r:"string"==i?e:e+"\0"}function y(e,t){for(var n,r=e+"",i=0;i<r.length;)t[h&i]=h&(n^=19*t[h&i])+r.charCodeAt(i++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(a.seedrandom=f,y(a.random(),i),e.exports){e.exports=f;try{s=n(55778)}catch(e){}}else void 0===(r=function(){return f}.call(t,n,t,e))||(e.exports=r)}([],Math)},92342:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(99674),i=n(26113);class a extends r.Component{componentDidMount(){const{name:e,tab:t}=this.props;this.props.registerSurface(e,t,this)}componentDidUpdate(){return!1}render(){const{name:e,visible:t,styles:n}=this.props,s=Object.assign({},a.defaultStyles,n),{width:o,height:u}=s;let{maxHeight:l,maxWidth:c}=s;l=u===a.defaultStyles.height?l:u,c=o===a.defaultStyles.width?c:o;const d=i.css({display:t?"block":"none",backgroundColor:"white",marginTop:"10px",marginBottom:"10px",boxShadow:"0 0 6px -3px #777",padding:"10px !important",height:u,width:o,maxHeight:l,maxWidth:c,overflow:"auto"}),h=i.css({backgroundColor:"white",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",marginBottom:"20px",fontWeight:"600",textAlign:"center"}),f=i.css({boxSizing:"border-box"});return r.h("div",{className:`${d} tf-surface`,ref:e=>this.container=e,"data-visible":t},r.h("div",{className:`${h} tf-label`,ref:e=>this.label=e},e),r.h("div",{className:`${f} tf-draw-area`,ref:e=>this.drawArea=e}))}}a.defaultStyles={maxWidth:"550px",maxHeight:"580px",height:"auto",width:"auto"},t.SurfaceComponent=a},42587:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(99674),i=n(26113);class a extends r.Component{render(){const{tabNames:e,activeTab:t,handleClick:n}=this.props,a=e.length>0?e.map((e=>r.h(s,{key:e,id:e,handleClick:n,isActive:e===t},e))):null,o=i.css({overflowX:"scroll",overflowY:"hidden",whiteSpace:"nowrap",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"#eee",paddingBottom:"1rem",marginTop:"1rem"});return r.h("div",{className:`${o} visor-tabs`},a)}}t.Tabs=a;class s extends r.Component{render(){const{children:e,isActive:t,handleClick:n,id:a}=this.props,s=i.css({borderBottomColor:t?"#357EDD":"#AAAAAA",borderBottomWidth:"1px",borderBottomStyle:"solid",cursor:"pointer",":hover":{color:"#357EDD"},display:"inline-block",marginRight:"1rem",padding:".5rem",fontSize:"1rem",fontWeight:"bold"});return r.h("a",{className:`${s} tf-tab`,"data-isactive":t,onClick:()=>n(a)},e)}}},88087:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(99674),i=n(26113),a=n(92342),s=n(42587);class o extends r.Component{static render(e,t,n){return r.render(r.h(o,Object.assign({},n)),e,t)}constructor(e){super(e),this.surfaces=new Map;const t=null==e.startOpen||e.startOpen;this.state={isOpen:t,isFullscreen:!1,activeTab:null,tabs:new Set},this.keyHandler=this.keyHandler.bind(this)}close(){this.setState({isOpen:!1})}open(){this.setState({isOpen:!0})}toggle(){this.setState({isOpen:!this.state.isOpen})}toggleFullScreen(){this.setState({isFullscreen:!this.state.isFullscreen})}isOpen(){return this.state.isOpen}isFullscreen(){return this.state.isFullscreen}getSurface(e,t){const n=this.surfaceId(e,t);let r;if(!this.surfaces.has(n))throw Error(`Surface not found with id: ${n}`);return r=this.surfaces.get(n),{container:r.container,label:r.label,drawArea:r.drawArea}}bindKeys(){document.addEventListener("keydown",this.keyHandler,!1)}unbindKeys(){document.removeEventListener("keydown",this.keyHandler)}surfaceId(e,t){return e+t}setTabs(e){const t=e.map((e=>e.tab)),n=this.state.tabs;let r;for(const e of t)n.has(e)||(n.add(e),r=e);null!=r&&this.setState({tabs:n,activeTab:r})}getTabs(){return this.state.tabs}registerSurface(e,t,n){const r=this.surfaceId(e,t);this.surfaces.set(r,n)}keyHandler(e){192===e.keyCode&&(e.shiftKey?this.toggleFullScreen():this.toggle())}setActiveTab(e){this.setState({activeTab:e})}componentDidMount(){this.bindKeys()}componentWillMount(){this.setTabs(this.props.surfaceList)}componentWillReceiveProps(e){this.setTabs(e.surfaceList)}render(){const{isOpen:e,isFullscreen:t,activeTab:n}=this.state,{surfaceList:o}=this.props,l=Array.from(this.getTabs().values()),c=t?"90vw":"550px",d=i.css({width:c,height:"100%",backgroundColor:"#fafafa",boxSizing:"border-box",padding:"10px",position:"fixed",top:"0px",transition:"right 0.5s cubic-bezier(0.645, 0.045, 0.355, 1), width 0.5s cubic-bezier(0.645, 0.045, 0.355, 1)",boxShadow:"0 2px 5px rgba(0, 0, 0, 0.12), 0 2px 5px rgba(0, 0, 0, 0.24)",overflow:"auto",fontFamily:"sans-serif",fontSize:"14px",zIndex:1e3}),h=i.css({right:"0"}),f=i.css({right:`calc(-${c} - 10px)`}),p=e?h:f,g=i.css({});return r.h("div",{className:`${d} ${p} visor`,"data-isopen":e,"data-isfullscreen":t},r.h(u,{fullScreenHandler:this.toggleFullScreen.bind(this),closeHandler:this.close.bind(this),isFullScreen:t}),r.h(s.Tabs,{tabNames:l,activeTab:n,handleClick:this.setActiveTab.bind(this)}),r.h("div",{className:`${g} visor-surfaces`},o.map((e=>r.h(a.SurfaceComponent,{key:e.name+e.tab,name:e.name,tab:e.tab,styles:e.styles,registerSurface:this.registerSurface.bind(this),visible:n===e.tab})))))}}function u(e){const{isFullScreen:t,fullScreenHandler:n,closeHandler:a}=e,s=i.css({display:"flex",backgroundColor:"white",border:"1px solid white",padding:"6px",paddingTop:"10px",marginBottom:"10px",borderRadius:"6px",marginTop:"-16px"}),o=i.css({fontSize:".875rem",borderRadius:".25rem",paddingLeft:"1rem",paddingRight:"1rem",paddingTop:".5rem",paddingBottom:".5rem",textDecoration:"none",transition:"color .15s ease-in",color:"#111"}),u=i.css({marginLeft:"auto"});return r.h("div",{className:`${s} visor-controls`},r.h("button",{className:`${o}`,onClick:n},t?"Minimize":"Maximize"),r.h("button",{className:`${o} ${u}`,onClick:a},"Hide"))}t.VisorComponent=o},78810:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(93792),n(6789);const r=n(14337),i=n(27412),a=n(88208),s=n(61825),o=n(50485),u=n(53683),l=n(60707),c=n(69962),d=n(61267),h=n(88685),f=n(43674),p=n(27450),g=n(8422);t.version_vis=g.version;const m={barchart:r.barchart,table:l.table,histogram:s.histogram,linechart:o.linechart,scatterplot:u.scatterplot,confusionMatrix:i.confusionMatrix,heatmap:a.heatmap};t.render=m;const y={accuracy:p.accuracy,perClassAccuracy:p.perClassAccuracy,confusionMatrix:p.confusionMatrix};t.metrics=y;const v={history:c.history,fitCallbacks:c.fitCallbacks,perClassAccuracy:h.perClassAccuracy,valuesDistribution:f.valuesDistribution,layer:d.layer,modelSummary:d.modelSummary};t.show=v;var b=n(24326);t.visor=b.visor,function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(87511))},14337:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(s,o)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(50505)),s=n(53152),o=n(10334);t.barchart=function(e,t,n={}){return r(this,void 0,void 0,(function*(){const r=o.getDrawArea(e),i=t,c=Object.assign({},u,n);if(l.has(r)){const e=l.get(r);if(o.shallowEquals(c,e.lastOptions)){yield o.nextFrame();const t=e.view,n=t.changeset().remove((()=>!0)).insert(i);return void(yield t.change("values",n).runAsync())}}const{xLabel:d,yLabel:h,xType:f,yType:p}=c;let g=null;null!=d&&(g={title:d});let m,y=null;null!=h&&(y={title:h}),m=null!=c.color?Array.isArray(c.color)?{field:"index",type:"nominal",scale:{range:c.color}}:{value:c.color}:{value:"#4C78A0"};const v={width:c.width||s.getDefaultWidth(r),height:c.height||s.getDefaultHeight(r),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:c.fontSize,titleFontSize:c.fontSize},text:{fontSize:c.fontSize},legend:{labelFontSize:c.fontSize,titleFontSize:c.fontSize}},data:{values:i,name:"values"},mark:{type:"bar",tooltip:!0},encoding:{x:{field:"index",type:f,axis:g},y:{field:"value",type:p,axis:y},color:m}};yield o.nextFrame();const b=yield a.default(r,v,{actions:!1,mode:"vega-lite",defaultStyle:!1});l.set(r,{view:b.view,lastOptions:c})}))};const u={xLabel:"",yLabel:"",xType:"ordinal",yType:"quantitative",fontSize:11},l=new Map},27412:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(s,o)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(50505)),s=n(53152),o=n(10334);t.confusionMatrix=function(e,t,n={}){return r(this,void 0,void 0,(function*(){const r=Object.assign({},u,n),i=o.getDrawArea(e),l=[],c=t.values,d=t.tickLabels||[],h=0===d.length;let f=!0;for(let e=0;e<c.length;e++){const t=h?`Class ${e}`:d[e];h&&d.push(t);for(let n=0;n<c[e].length;n++){const i=h?`Class ${n}`:d[n],a=c[e][n];e!==n||r.shadeDiagonal?(l.push({label:t,prediction:i,count:a,scaleCount:a}),0!==a&&(f=!1)):l.push({label:t,prediction:i,count:a,noFill:!0})}}if(!r.shadeDiagonal&&f)for(const e of l)!0===e.noFill&&(e.noFill=!1,e.scaleCount=e.count);const p={width:r.width||s.getDefaultWidth(i),height:r.height||s.getDefaultHeight(i),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:r.fontSize,titleFontSize:r.fontSize},text:{fontSize:r.fontSize},legend:{labelFontSize:r.fontSize,titleFontSize:r.fontSize}},data:{values:l},encoding:{x:{field:"prediction",type:"ordinal",title:r.xLabel||"prediction",scale:{domain:d}},y:{field:"label",type:"ordinal",title:r.yLabel||"label",scale:{domain:d}}},layer:[{transform:[{filter:"datum.noFill != true"}],mark:{type:"rect"},encoding:{color:{field:"scaleCount",type:"quantitative",scale:{range:r.colorMap}},tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}]};!1===r.shadeDiagonal&&p.layer.push({transform:[{filter:"datum.noFill == true"}],mark:{type:"rect",fill:"white"},encoding:{tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}),r.showTextOverlay&&p.layer.push({mark:{type:"text",baseline:"middle"},encoding:{text:{field:"count",type:"nominal"}}});const g="string"==typeof r.colorMap?{scheme:r.colorMap}:r.colorMap;p.layer[0].encoding.color.scale.range=g,yield a.default(i,p,{actions:!1,mode:"vega-lite",defaultStyle:!1})}))};const u={xLabel:null,yLabel:null,xType:"nominal",yType:"nominal",shadeDiagonal:!0,fontSize:12,showTextOverlay:!0,height:400,colorMap:["#f7fbff","#4292c6"]}},88208:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(s,o)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(n(93792)),o=a(n(50505)),u=n(53152),l=n(93538),c=n(10334);function d(e,t,n){const r=e instanceof s.Tensor?e.shape:[e.length,e[0].length];0===n?l.assert(r[0]===t.length,`Length of xTickLabels (${t.length}) must match number of rows (${r[0]})`):1===n&&l.assert(r[1]===t.length,`Length of yTickLabels (${t.length}) must match number of columns (${r[1]})`)}t.heatmap=function(e,t,n={}){return r(this,void 0,void 0,(function*(){const i=Object.assign({},h,n),a=c.getDrawArea(e);let f=t.values;i.rowMajor&&(f=yield function(e){return r(this,void 0,void 0,(function*(){let t,n;e instanceof s.Tensor?(t=e.shape,n=e.transpose()):(t=[e.length,e[0].length],n=s.tidy((()=>s.tensor2d(e).transpose()))),l.assert(2===n.rank,"Input to renderHeatmap must be a 2d array or Tensor2d");const r=yield n.array();n.dispose();const i=[r.length,r[0].length];return l.assert(t[0]===i[1]&&t[1]===i[0],`Unexpected transposed shape. Original ${t} : Transposed ${i}`),r}))}(t.values));const{xTickLabels:p,yTickLabels:g}=t;null!=p&&d(f,p,0),null!=g&&d(f,g,1);const m=[];if(f instanceof s.Tensor){l.assert(2===f.rank,"Input to renderHeatmap must be a 2d array or Tensor2d");const e=yield f.data(),[t,n]=f.shape;for(let r=0;r<t;r++){const t=p?`${p[r]}@tfidx@${r}`:r;for(let i=0;i<n;i++){const a=g?`${g[i]}@tfidx@${i}`:i,s=e[r*n+i];m.push({x:t,y:a,value:s})}}}else{const e=f;for(let t=0;t<e.length;t++){const n=p?`${p[t]}@tfidx@${t}`:t;for(let r=0;r<e[t].length;r++){const i=g?`${g[r]}@tfidx@${r}`:r,a=e[t][r];m.push({x:n,y:i,value:a})}}}const y={actions:!1,mode:"vega-lite",defaultStyle:!1},v={width:i.width||u.getDefaultWidth(a),height:i.height||u.getDefaultHeight(a),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:i.fontSize,titleFontSize:i.fontSize},text:{fontSize:i.fontSize},legend:{labelFontSize:i.fontSize,titleFontSize:i.fontSize},scale:{bandPaddingInner:0,bandPaddingOuter:0}},data:{values:m},mark:{type:"rect",tooltip:!0},encoding:{x:{field:"x",type:i.xType,title:i.xLabel,sort:!1},y:{field:"y",type:i.yType,title:i.yLabel,sort:!1},fill:{field:"value",type:"quantitative"}}},b=new RegExp("@tfidx@\\d+$");let x;switch(p&&(v.encoding.x.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),g&&(v.encoding.y.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),(p||g)&&(y.tooltip={sanitize:e=>String(e).replace(b,"")}),i.colorMap){case"blues":x=["#f7fbff","#4292c6"];break;case"greyscale":x=["#000000","#ffffff"];break;default:x="viridis"}if("viridis"!==x&&(v.encoding.fill.scale={range:x}),i.domain){const e=v.encoding.fill;null!=e.scale?e.scale=Object.assign({},e.scale,{domain:i.domain}):e.scale={domain:i.domain}}yield o.default(a,v,y)}))};const h={xLabel:null,yLabel:null,xType:"ordinal",yType:"ordinal",colorMap:"viridis",fontSize:12,domain:null,rowMajor:!1}},61825:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(s,o)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(16722),s=i(n(50505)),o=n(53152),u=n(27450),l=n(60707),c={maxBins:12,fontSize:11};t.histogram=function(e,t,n={}){return r(this,void 0,void 0,(function*(){const r=function(e){if(null==e.length)throw new Error("input data must be an array");if(0===e.length)return[];if("object"==typeof e[0]){if(null==e[0].value)throw new Error("input data must have a value field");return e}{const t=Array(e.length);for(let n=0;n<e.length;n++)t[n]={value:e[n]};return t}}(t),i=Object.assign({},c,n),d=o.subSurface(e,"histogram");if(!1!==n.stats){const t=o.subSurface(e,"stats",{prepend:!0});let s;s=n.stats?n.stats:u.arrayStats(r.map((e=>e.value))),function(e,t,n){const r=a.format(",.4~f"),i=a.format(".4~p"),s=[],o=[];if(null!=e.numVals&&(s.push("Num Vals"),o.push(r(e.numVals))),null!=e.min&&(s.push("Min"),o.push(r(e.min))),null!=e.max&&(s.push("Max"),o.push(r(e.max))),null!=e.numZeros){s.push("# Zeros");let t="";e.numVals&&(t=e.numZeros>0?`(${i(e.numZeros/e.numVals)})`:""),o.push(`${r(e.numZeros)} ${t}`)}if(null!=e.numNans){s.push("# NaNs");let t="";e.numVals&&(t=e.numNans>0?`(${i(e.numNans/e.numVals)})`:""),o.push(`${r(e.numNans)} ${t}`)}if(null!=e.numInfs){s.push("# Infinity");let t="";e.numVals&&(t=e.numInfs>0?`(${i(e.numInfs/e.numVals)})`:""),o.push(`${r(e.numInfs)} ${t}`)}l.table(t,{headers:s,values:[o]},n)}(s,t,{fontSize:i.fontSize})}if(0===r.length)return;const h=[];for(let e=0;e<r.length;e++){const t=r[e].value;null!=t&&isFinite(t)&&h.push(r[e])}const f={width:i.width||o.getDefaultWidth(d),height:i.height||o.getDefaultHeight(d),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},data:{values:h},mark:{type:"bar",tooltip:!0},config:{axis:{labelFontSize:i.fontSize,titleFontSize:i.fontSize},text:{fontSize:i.fontSize},legend:{labelFontSize:i.fontSize,titleFontSize:i.fontSize}},encoding:{x:{bin:{maxbins:i.maxBins},field:"value",type:"quantitative"},y:{aggregate:"count",type:"quantitative"},color:{value:i.color||"#001B44"}}};return s.default(d,f,{actions:!1,mode:"vega-lite",defaultStyle:!1})}))}},50485:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(s,o)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(50505)),s=n(53152),o=n(93538),u=n(10334);t.linechart=function(e,t,n={}){return r(this,void 0,void 0,(function*(){const r=Array.isArray(t.values[0])?t.values:[t.values],i=r[0].length,c=t.series?t.series:r.map(((e,t)=>`Series ${t+1}`));o.assert(c.length===r.length,"Must have an equal number of series labels as there are data series"),null!=n.seriesColors&&o.assert(n.seriesColors.length===r.length,"Must have an equal number of series colors as there are data series");const d=[];for(let e=0;e<i;e++){const t={x:e};c.forEach(((n,i)=>{const a=r[i][e].y;t[n]=a,t[`${n}-name`]=n})),d.push(t)}const h=Object.assign({},l,n),f={x:{field:"x",type:h.xType,title:h.xLabel},tooltip:[{field:"x",type:"quantitative"},...c.map((e=>({field:e,type:"quantitative"})))]},p=c.map((e=>({data:void 0,mark:{type:"line",clip:!0},encoding:{y:{field:e,type:h.yType,title:h.yLabel,scale:h.zoomToFit?{zero:!1}:null!=h.yAxisDomain?{domain:h.yAxisDomain}:void 0},color:{field:`${e}-name`,type:"nominal",legend:{values:c,title:null},scale:{range:h.seriesColors}}}}))),g=u.getDrawArea(e),m={width:h.width||s.getDefaultWidth(g),height:h.height||s.getDefaultHeight(g),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:h.fontSize,titleFontSize:h.fontSize},text:{fontSize:h.fontSize},legend:{labelFontSize:h.fontSize,titleFontSize:h.fontSize}},data:{values:d},encoding:f,layer:[...p,{mark:"rule",selection:{hover:{type:"single",on:"mouseover",nearest:!0,clear:"mouseout"}},encoding:{color:{value:"grey",condition:{selection:{not:"hover"},value:"transparent"}}}}]};return yield a.default(g,m,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()}))};const l={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},10334:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(s,o)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(87511),a=n(24326);t.getDrawArea=function(e){if(e instanceof HTMLElement)return e;if(i.isSurface(e))return e.drawArea;if(i.isSurfaceInfo(e))return a.visor().surface({name:e.name,tab:e.tab,styles:e.styles}).drawArea;throw new Error("Not a drawable")},t.shallowEquals=function(e,t){const n=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(t);if(n.length!==r.length)return!1;for(let r=0;r<n.length;r++){const i=n[r];if(e[i]!==t[i])return!1}return!0},t.nextFrame=function(){return r(this,void 0,void 0,(function*(){yield new Promise((e=>requestAnimationFrame(e)))}))}},53683:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(s,o)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n(50505)),s=n(53152),o=n(93538),u=n(10334);t.scatterplot=function(e,t,n={}){return r(this,void 0,void 0,(function*(){let r=t.values;const i=null==t.series?[]:t.series;r=Array.isArray(r[0])?r:[r];const c=[];r.forEach(((e,t)=>{const n=null!=i[t]?i[t]:`Series ${t+1}`,r=e.map((e=>Object.assign({},e,{series:n})));c.push(...r)})),null!=n.seriesColors&&o.assert(n.seriesColors.length===r.length,"Must have an equal number of series colors as there are data series");const d=u.getDrawArea(e),h=Object.assign({},l,n),f={width:h.width||s.getDefaultWidth(d),height:h.height||s.getDefaultHeight(d),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:h.fontSize,titleFontSize:h.fontSize},text:{fontSize:h.fontSize},legend:{labelFontSize:h.fontSize,titleFontSize:h.fontSize}},data:{values:c},mark:{type:"point",clip:!0,tooltip:{content:"data"}},encoding:{x:{field:"x",type:h.xType,title:h.xLabel,scale:h.zoomToFit?{zero:!1}:null!=h.xAxisDomain?{domain:h.xAxisDomain}:void 0},y:{field:"y",type:h.yType,title:h.yLabel,scale:h.zoomToFit?{zero:!1}:null!=h.yAxisDomain?{domain:h.yAxisDomain}:void 0},color:{field:"series",type:"nominal",scale:{range:h.seriesColors}},shape:{field:"series",type:"nominal"}}};return yield a.default(d,f,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()}))};const l={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},60707:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(16722),i=n(54677),a=n(26113),s=n(10334);t.table=function(e,t,n={}){if(t&&null==t.headers)throw new Error('Data to render must have a "headers" property');if(t&&null==t.values)throw new Error('Data to render must have a "values" property');const u=s.getDrawArea(e),l=Object.assign({},o,n);let c=i.select(u).select("table.tf-table");const d=a.css({fontSize:l.fontSize||".875rem",width:"100%",maxWidth:"64rem",marginRight:"auto",marginLeft:"auto"});if(0===c.size()&&(c=i.select(u).append("table"),c.attr("class",` ${d} tf-table`),c.append("thead").append("tr"),c.append("tbody")),1!==c.size())throw new Error("Error inserting table");const h=a.css({fontWeight:"600",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )",textAlign:"left",paddingBottom:"1rem",paddingRight:"1rem",backgroundColor:"#fff"}),f=c.select("thead").select("tr").selectAll("th").data(t.headers),p=f.enter().append("th").attr("class",`${h}`);f.merge(p).html((e=>e)),f.exit().remove();const g=r.format(",.4~f"),m=c.select("tbody").selectAll("tr").data(t.values),y=m.enter().append("tr"),v=a.css({padding:"0.25rem",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )"}),b=m.merge(y).selectAll("td").data((e=>e)),x=b.enter().append("td").attr("class",`${v}`);b.merge(x).html((e=>"number"==typeof e?g(e):e)),b.exit().remove(),m.exit().remove()};const o={fontSize:14}},69962:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(s,o)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(50485),a=n(10334),s=n(53152);function o(e,t,n,o={}){return r(this,void 0,void 0,(function*(){const r=a.getDrawArea(e),c={};for(const e of n)if(/val_/.test(e)){const r=e.replace("val_","");u(c,r);const i=l(t,e,n.indexOf(e));c[r].series.push(e),c[r].values.push(i)}else{const r=l(t,e,n.indexOf(e));u(c,e),c[e].series.push(e),c[e].values.push(r)}const d=Object.keys(c),h=Object.assign({},{xLabel:"Iteration",yLabel:"Value"},o),f=[];for(const e of d){const t=s.subSurface(r,e),n=c[e].series,a=c[e].values;n.every((e=>Boolean(e.match("acc"))))&&(h.zoomToFitAccuracy?h.zoomToFit=!0:(h.yAxisDomain=[0,1],delete h.zoomToFit));const o=i.linechart(t,{values:a,series:n},h);f.push(o)}yield Promise.all(f)}))}function u(e,t){null==e[t]&&(e[t]={series:[],values:[]})}function l(e,t,n){if(Array.isArray(e)){const r=Array.isArray(e[0])?e[n]:e,i=[];for(let e=0;e<r.length;e++){const n=r[e];i.push({x:e,y:n[t]})}return i}return e.history[t].map(((e,t)=>({x:t,y:e})))}function c(e,t,n){return null==e[t]&&(e[t]={}),null==e[t][n]&&(e[t][n]=[]),e[t][n]}t.history=o,t.fitCallbacks=function(e,t,n={}){const i={},u=n.callbacks||["onEpochEnd","onBatchEnd"],l=a.getDrawArea(e),d=Object.assign({},n);delete d.callbacks;const h={};return u.forEach((e=>{h[e]=function(e){return(n,u)=>r(this,void 0,void 0,(function*(){/batch/i.test(e)?d.xLabel="Batch":/epoch/i.test(e)&&(d.xLabel="Epoch");const n=[],r=[];for(const a of t)if(null!=u[a]){r.push(a);const t=c(i,e,a);t.push({[a]:u[a]}),n.push(t)}o(s.subSurface(l,e,{title:e}),n,r,d),yield a.nextFrame()}))}(e)})),h}},61267:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(s,o)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(61825),a=n(10334),s=n(60707),o=n(53152),u=n(27450);function l(e){let t;return t=Array.isArray(e.outputShape[0])?`[${e.outputShape.map((e=>c(e))).join(", ")}]`:c(e.outputShape),{name:e.name,trainable:e.trainable,parameters:e.countParams(),outputShape:t}}function c(e){const t=e.slice();return 0===t.length?"Scalar":(null===t[0]&&(t[0]="batch"),`[${t.join(",")}]`)}t.modelSummary=function(e,t){return r(this,void 0,void 0,(function*(){const n=a.getDrawArea(e),r=function(e){return{layers:e.layers.map(l)}}(t),i=r.layers.map((e=>[e.name,e.outputShape,e.parameters,e.trainable]));s.table(n,{headers:["Layer Name","Output Shape","# Of Params","Trainable"],values:i})}))},t.layer=function(e,t){return r(this,void 0,void 0,(function*(){const n=a.getDrawArea(e),l=yield function(e){return r(this,void 0,void 0,(function*(){const t=e.getWeights(),n=e.weights,r=t.map(u.tensorStats),i=yield Promise.all(r),a=t.map((e=>e.shape));return t.map(((e,t)=>({name:n[t].name,stats:i[t],shape:c(a[t]),weight:e})))}))}(t),d=o.subSurface(n,"layer-weights-info"),h=l.map((e=>[e.name,e.shape,e.stats.min,e.stats.max,e.weight.size,e.stats.numZeros,e.stats.numNans,e.stats.numInfs]));s.table(d,{headers:["Weight Name","Shape","Min","Max","# Params","# Zeros","# NaNs","# Infinity"],values:h});const f=o.subSurface(n,"select-layer"),p=o.subSurface(n,"param-distribution");!function(e,t,n){const r=`<div><button>Show Values Distribution for:</button>${`\n    <select>\n      ${e.map((e=>`<option value=${e}>${e}</option>`))}\n    </select>\n  `}</div>`;t.innerHTML=r;const i=t.querySelector("button"),a=t.querySelector("select");i.addEventListener("click",(()=>{n(a.selectedOptions[0].label)}))}(l.map((e=>e.name)),f,(e=>r(this,void 0,void 0,(function*(){const t=l.filter((t=>t.name===e))[0],n=yield t.weight.data();i.histogram(p,n,{height:150,width:460,stats:!1})}))))}))}},88685:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(s,o)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(10334),a=n(60707);t.perClassAccuracy=function(e,t,n){return r(this,void 0,void 0,(function*(){const r=i.getDrawArea(e),s=[];for(let e=0;e<t.length;e++){const r=n?n[e]:e.toString(),i=t[e];s.push([r,i.accuracy,i.count])}return a.table(r,{headers:["Class","Accuracy","# Samples"],values:s})}))}},43674:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(s,o)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(61825),a=n(10334),s=n(27450);t.valuesDistribution=function(e,t){return r(this,void 0,void 0,(function*(){const n=a.getDrawArea(e),r=yield s.tensorStats(t),o=yield t.data();i.histogram(n,o,{height:150,stats:r})}))}},87511:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSurfaceInfo=function(e){return null!=e.name},t.isSurface=function(e){return e.drawArea instanceof HTMLElement}},53152:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(26113),i=n(10334),a={prepend:!1};t.subSurface=function(e,t,n={}){const s=i.getDrawArea(e),o=r.css({"& canvas":{display:"block"},marginTop:".5rem",marginBottom:".5rem"}),u=r.css({backgroundColor:"white",display:"inline-block",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",padding:"0 10px 0 10px",marginBottom:"20px",fontWeight:"600",textAlign:"left"}),l=Object.assign({},a,n);let c=s.querySelector(`div[data-name=${t}]`);if(!c){if(c=document.createElement("div"),c.setAttribute("class",`${o}`),c.dataset.name=t,l.title){const e=document.createElement("div");e.setAttribute("class",`subsurface-title ${u}`),e.innerText=l.title,c.appendChild(e)}l.prepend?s.insertBefore(c,s.firstChild):s.appendChild(c)}return c},t.getDefaultWidth=function(e){let t=0,n=e;for(;n&&0===n.clientWidth;)n=n.parentElement,t=50;return n.clientWidth-t},t.getDefaultHeight=function(e){return 0===e.clientHeight?200:e.clientHeight}},27450:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(s,o)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(93792),a=n(93538);t.arrayStats=function(e){if(!Array.isArray(e))throw new Error("input must be an array");if(0===e.length)return{numVals:0,numNans:0,numZeros:0,max:void 0,min:void 0};const t=e.length;let n=-1/0,r=1/0,i=0,a=0,s=0;for(let o=0;o<t;o++){const t=e[o];t>n&&(n=t),t<r&&(r=t),0===t&&(i+=1),isNaN(t)?a+=1:isFinite(t)||(s+=1)}const o={numVals:t,numZeros:i,numNans:a,max:n,min:r,numInfs:s};return o.max===-1/0&&(o.max=NaN),o.min===1/0&&(o.min=NaN),o},t.tensorStats=function(e){return r(this,void 0,void 0,(function*(){const[t,n,r]=i.tidy((()=>{const t=i.scalar(0,e.dtype);return[e.min(),e.max(),e.equal(t).sum()]}));return Promise.all([e.data(),t.data(),n.data(),r.data()]).then((([e,t,n,r])=>{const i=e.length;let a=0,s=0;for(let t=0;t<i;t++){const n=e[t];isNaN(n)?a+=1:isFinite(n)||(s+=1)}let o=t[0],u=n[0];return a===i&&(o=NaN,u=NaN),{numVals:i,numZeros:r[0],numNans:a,min:o,max:u,numInfs:s}}))}))},t.confusionMatrix=function(e,t,n,s){return r(this,void 0,void 0,(function*(){a.assert(1===e.rank,"labels must be a 1D tensor"),a.assert(1===t.rank,"predictions must be a 1D tensor"),a.assert(e.size===t.size,"labels and predictions must be the same length"),null!=s&&a.assert(s.size===t.size,"labels and predictions must be the same length");const r=e.cast("int32"),o=t.cast("int32");null==n&&(n=i.tidy((()=>i.maximum(r.max(),o.max()).cast("int32").dataSync()[0]+1)));let u=Promise.resolve(null);return null!=s&&(u=s.data()),Promise.all([r.data(),o.data(),u]).then((([e,t,r])=>{const i=Array(n).fill(0);for(let e=0;e<n;e++)i[e]=Array(n).fill(0);for(let n=0;n<e.length;n++){const a=e[n],s=t[n];i[a][s]+=null!=r?r[n]:1}return i}))}))},t.accuracy=function(e,t){return r(this,void 0,void 0,(function*(){a.assertShapesMatch(e.shape,t.shape,"Error computing accuracy.");const n=e.equal(t),r=n.mean(),s=(yield r.data())[0];return i.dispose([n,r]),s}))},t.perClassAccuracy=function(e,t,n){return r(this,void 0,void 0,(function*(){return a.assert(1===e.rank,"labels must be a 1D tensor"),a.assert(1===t.rank,"predictions must be a 1D tensor"),a.assert(e.size===t.size,"labels and predictions must be the same length"),null==n&&(n=i.tidy((()=>i.maximum(e.max(),t.max()).dataSync()[0]+1))),Promise.all([e.data(),t.data()]).then((([e,t])=>{const r=Array(n).fill(0),i=Array(n).fill(0);for(let n=0;n<e.length;n++){const a=e[n],s=t[n];r[a]+=1,a===s&&(i[a]+=1)}const a=[];for(let e=0;e<r.length;e++)a.push({count:r[e],accuracy:0===r[e]?0:i[e]/r[e]});return a}))}))}},93538:(e,t)=>{"use strict";function n(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function r(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.assert=n,t.assertShapesMatch=function(e,t,i=""){n(r(e,t),i+` Shapes ${e} and ${t} must match`)},t.arraysEqual=r,t.DECIMAL_PLACES_TO_CHECK=4},8422:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="1.5.1"},24326:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(88087);let i;const a="tfjs-visor-container";t.visor=function(){if("undefined"==typeof document)throw new Error("No document defined. This library needs a browser/dom to work");if(document.getElementById(a)&&null!=i)return i;let e,t=document.getElementById(a);function n(t,n){let i=null;return e=r.VisorComponent.render(t,e,{ref:e=>i=e,surfaceList:Array.from(n.values())}),i}null==t&&(t=document.createElement("div"),t.id=a,document.body.appendChild(t));const o=new Map,u=n(t,o);return i=new s(u,t,o,n),i};class s{constructor(e,t,n,r){this.visorComponent=e,this.el=t,this.surfaceList=n,this.renderVisor=r}surface(e){const{name:t}=e,n=null==e.tab?"Visor":e.tab;if(null==t||!("string"==typeof t||t instanceof String))throw new Error("You must pass a config object with a 'name' property to create or retrieve a surface");const r=Object.assign({},e,{tab:n}),i=`${t}-${n}`;return this.surfaceList.has(i)||this.surfaceList.set(i,r),this.renderVisor(this.el,this.surfaceList),this.visorComponent.getSurface(t,n)}isFullscreen(){return this.visorComponent.isFullscreen()}isOpen(){return this.visorComponent.isOpen()}close(){return this.visorComponent.close()}open(){return this.visorComponent.open()}toggle(){return this.visorComponent.toggle()}toggleFullScreen(){return this.visorComponent.toggleFullScreen()}bindKeys(){return this.visorComponent.bindKeys()}unbindKeys(){return this.visorComponent.unbindKeys()}setActiveTab(e){if(!this.visorComponent.state.tabs.has(e))throw new Error(`Tab '${e}' does not exist`);this.visorComponent.setState({activeTab:e})}}t.Visor=s},67182:(e,t,n)=>{n(54530),e.exports=n(48080).RegExp.escape},50666:e=>{e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},98479:(e,t,n)=>{var r=n(42380);e.exports=function(e,t){if("number"!=typeof e&&"Number"!=r(e))throw TypeError(t);return+e}},17296:(e,t,n)=>{var r=n(64410)("unscopables"),i=Array.prototype;null==i[r]&&n(74461)(i,r,{}),e.exports=function(e){i[r][e]=!0}},10990:(e,t,n)=>{"use strict";var r=n(25454)(!0);e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},30269:e=>{e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},85075:(e,t,n)=>{var r=n(49708);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},43697:(e,t,n)=>{"use strict";var r=n(16040),i=n(39519),a=n(15263);e.exports=[].copyWithin||function(e,t){var n=r(this),s=a(n.length),o=i(e,s),u=i(t,s),l=arguments.length>2?arguments[2]:void 0,c=Math.min((void 0===l?s:i(l,s))-u,s-o),d=1;for(u<o&&o<u+c&&(d=-1,u+=c-1,o+=c-1);c-- >0;)u in n?n[o]=n[u]:delete n[o],o+=d,u+=d;return n}},35572:(e,t,n)=>{"use strict";var r=n(16040),i=n(39519),a=n(15263);e.exports=function(e){for(var t=r(this),n=a(t.length),s=arguments.length,o=i(s>1?arguments[1]:void 0,n),u=s>2?arguments[2]:void 0,l=void 0===u?n:i(u,n);l>o;)t[o++]=e;return t}},59315:(e,t,n)=>{var r=n(74036);e.exports=function(e,t){var n=[];return r(e,!1,n.push,n,t),n}},64513:(e,t,n)=>{var r=n(76282),i=n(15263),a=n(39519);e.exports=function(e){return function(t,n,s){var o,u=r(t),l=i(u.length),c=a(s,l);if(e&&n!=n){for(;l>c;)if((o=u[c++])!=o)return!0}else for(;l>c;c++)if((e||c in u)&&u[c]===n)return e||c||0;return!e&&-1}}},13635:(e,t,n)=>{var r=n(21550),i=n(75945),a=n(16040),s=n(15263),o=n(42143);e.exports=function(e,t){var n=1==e,u=2==e,l=3==e,c=4==e,d=6==e,h=5==e||d,f=t||o;return function(t,o,p){for(var g,m,y=a(t),v=i(y),b=r(o,p,3),x=s(v.length),w=0,k=n?f(t,x):u?f(t,0):void 0;x>w;w++)if((h||w in v)&&(m=b(g=v[w],w,y),e))if(n)k[w]=m;else if(m)switch(e){case 3:return!0;case 5:return g;case 6:return w;case 2:k.push(g)}else if(c)return!1;return d?-1:l||c?c:k}}},56574:(e,t,n)=>{var r=n(50666),i=n(16040),a=n(75945),s=n(15263);e.exports=function(e,t,n,o,u){r(t);var l=i(e),c=a(l),d=s(l.length),h=u?d-1:0,f=u?-1:1;if(n<2)for(;;){if(h in c){o=c[h],h+=f;break}if(h+=f,u?h<0:d<=h)throw TypeError("Reduce of empty array with no initial value")}for(;u?h>=0:d>h;h+=f)h in c&&(o=t(o,c[h],h,l));return o}},80920:(e,t,n)=>{var r=n(49708),i=n(63623),a=n(64410)("species");e.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),r(t)&&null===(t=t[a])&&(t=void 0)),void 0===t?Array:t}},42143:(e,t,n)=>{var r=n(80920);e.exports=function(e,t){return new(r(e))(t)}},47240:(e,t,n)=>{"use strict";var r=n(50666),i=n(49708),a=n(31671),s=[].slice,o={},u=function(e,t,n){if(!(t in o)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";o[t]=Function("F,a","return new F("+r.join(",")+")")}return o[t](e,n)};e.exports=Function.bind||function(e){var t=r(this),n=s.call(arguments,1),o=function(){var r=n.concat(s.call(arguments));return this instanceof o?u(t,r.length,r):a(t,r,e)};return i(t.prototype)&&(o.prototype=t.prototype),o}},96347:(e,t,n)=>{var r=n(42380),i=n(64410)("toStringTag"),a="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?n:a?r(t):"Object"==(s=r(t))&&"function"==typeof t.callee?"Arguments":s}},42380:e=>{var t={}.toString;e.exports=function(e){return t.call(e).slice(8,-1)}},37647:(e,t,n)=>{"use strict";var r=n(24213).f,i=n(6088),a=n(33227),s=n(21550),o=n(30269),u=n(74036),l=n(15706),c=n(34257),d=n(72373),h=n(83144),f=n(18648).fastKey,p=n(51554),g=h?"_s":"size",m=function(e,t){var n,r=f(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,l){var c=e((function(e,r){o(e,c,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[g]=0,null!=r&&u(r,n,e[l],e)}));return a(c.prototype,{clear:function(){for(var e=p(this,t),n=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];e._f=e._l=void 0,e[g]=0},delete:function(e){var n=p(this,t),r=m(n,e);if(r){var i=r.n,a=r.p;delete n._i[r.i],r.r=!0,a&&(a.n=i),i&&(i.p=a),n._f==r&&(n._f=i),n._l==r&&(n._l=a),n[g]--}return!!r},forEach:function(e){p(this,t);for(var n,r=s(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!m(p(this,t),e)}}),h&&r(c.prototype,"size",{get:function(){return p(this,t)[g]}}),c},def:function(e,t,n){var r,i,a=m(e,t);return a?a.v=n:(e._l=a={i:i=f(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=a),r&&(r.n=a),e[g]++,"F"!==i&&(e._i[i]=a)),e},getEntry:m,setStrong:function(e,t,n){l(e,t,(function(e,n){this._t=p(e,t),this._k=n,this._l=void 0}),(function(){for(var e=this,t=e._k,n=e._l;n&&n.r;)n=n.p;return e._t&&(e._l=n=n?n.n:e._t._f)?c(0,"keys"==t?n.k:"values"==t?n.v:[n.k,n.v]):(e._t=void 0,c(1))}),n?"entries":"values",!n,!0),d(t)}}},72935:(e,t,n)=>{var r=n(96347),i=n(59315);e.exports=function(e){return function(){if(r(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},78348:(e,t,n)=>{"use strict";var r=n(33227),i=n(18648).getWeak,a=n(85075),s=n(49708),o=n(30269),u=n(74036),l=n(13635),c=n(83050),d=n(51554),h=l(5),f=l(6),p=0,g=function(e){return e._l||(e._l=new m)},m=function(){this.a=[]},y=function(e,t){return h(e.a,(function(e){return e[0]===t}))};m.prototype={get:function(e){var t=y(this,e);if(t)return t[1]},has:function(e){return!!y(this,e)},set:function(e,t){var n=y(this,e);n?n[1]=t:this.a.push([e,t])},delete:function(e){var t=f(this.a,(function(t){return t[0]===e}));return~t&&this.a.splice(t,1),!!~t}},e.exports={getConstructor:function(e,t,n,a){var l=e((function(e,r){o(e,l,t,"_i"),e._t=t,e._i=p++,e._l=void 0,null!=r&&u(r,n,e[a],e)}));return r(l.prototype,{delete:function(e){if(!s(e))return!1;var n=i(e);return!0===n?g(d(this,t)).delete(e):n&&c(n,this._i)&&delete n[this._i]},has:function(e){if(!s(e))return!1;var n=i(e);return!0===n?g(d(this,t)).has(e):n&&c(n,this._i)}}),l},def:function(e,t,n){var r=i(a(t),!0);return!0===r?g(e).set(t,n):r[e._i]=n,e},ufstore:g}},8107:(e,t,n)=>{"use strict";var r=n(24405),i=n(61693),a=n(69593),s=n(33227),o=n(18648),u=n(74036),l=n(30269),c=n(49708),d=n(10496),h=n(3229),f=n(25572),p=n(77856);e.exports=function(e,t,n,g,m,y){var v=r[e],b=v,x=m?"set":"add",w=b&&b.prototype,k={},_=function(e){var t=w[e];a(w,e,"delete"==e||"has"==e?function(e){return!(y&&!c(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return y&&!c(e)?void 0:t.call(this,0===e?0:e)}:"add"==e?function(e){return t.call(this,0===e?0:e),this}:function(e,n){return t.call(this,0===e?0:e,n),this})};if("function"==typeof b&&(y||w.forEach&&!d((function(){(new b).entries().next()})))){var S=new b,C=S[x](y?{}:-0,1)!=S,A=d((function(){S.has(1)})),E=h((function(e){new b(e)})),F=!y&&d((function(){for(var e=new b,t=5;t--;)e[x](t,t);return!e.has(-0)}));E||((b=t((function(t,n){l(t,b,e);var r=p(new v,t,b);return null!=n&&u(n,m,r[x],r),r}))).prototype=w,w.constructor=b),(A||F)&&(_("delete"),_("has"),m&&_("get")),(F||C)&&_(x),y&&w.clear&&delete w.clear}else b=g.getConstructor(t,e,m,x),s(b.prototype,n),o.NEED=!0;return f(b,e),k[e]=b,i(i.G+i.W+i.F*(b!=v),k),y||g.setStrong(b,e,m),b}},48080:e=>{var t=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=t)},72559:(e,t,n)=>{"use strict";var r=n(24213),i=n(33388);e.exports=function(e,t,n){t in e?r.f(e,t,i(0,n)):e[t]=n}},21550:(e,t,n)=>{var r=n(50666);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},59496:(e,t,n)=>{"use strict";var r=n(10496),i=Date.prototype.getTime,a=Date.prototype.toISOString,s=function(e){return e>9?e:"0"+e};e.exports=r((function(){return"0385-07-25T07:06:39.999Z"!=a.call(new Date(-50000000000001))}))||!r((function(){a.call(new Date(NaN))}))?function(){if(!isFinite(i.call(this)))throw RangeError("Invalid time value");var e=this,t=e.getUTCFullYear(),n=e.getUTCMilliseconds(),r=t<0?"-":t>9999?"+":"";return r+("00000"+Math.abs(t)).slice(r?-6:-4)+"-"+s(e.getUTCMonth()+1)+"-"+s(e.getUTCDate())+"T"+s(e.getUTCHours())+":"+s(e.getUTCMinutes())+":"+s(e.getUTCSeconds())+"."+(n>99?n:"0"+s(n))+"Z"}:a},72967:(e,t,n)=>{"use strict";var r=n(85075),i=n(23825),a="number";e.exports=function(e){if("string"!==e&&e!==a&&"default"!==e)throw TypeError("Incorrect hint");return i(r(this),e!=a)}},91083:e=>{e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},83144:(e,t,n)=>{e.exports=!n(10496)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},47339:(e,t,n)=>{var r=n(49708),i=n(24405).document,a=r(i)&&r(i.createElement);e.exports=function(e){return a?i.createElement(e):{}}},95985:e=>{e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},86522:(e,t,n)=>{var r=n(31126),i=n(68910),a=n(2806);e.exports=function(e){var t=r(e),n=i.f;if(n)for(var s,o=n(e),u=a.f,l=0;o.length>l;)u.call(e,s=o[l++])&&t.push(s);return t}},61693:(e,t,n)=>{var r=n(24405),i=n(48080),a=n(74461),s=n(69593),o=n(21550),u=function(e,t,n){var l,c,d,h,f=e&u.F,p=e&u.G,g=e&u.S,m=e&u.P,y=e&u.B,v=p?r:g?r[t]||(r[t]={}):(r[t]||{}).prototype,b=p?i:i[t]||(i[t]={}),x=b.prototype||(b.prototype={});for(l in p&&(n=t),n)d=((c=!f&&v&&void 0!==v[l])?v:n)[l],h=y&&c?o(d,r):m&&"function"==typeof d?o(Function.call,d):d,v&&s(v,l,d,e&u.U),b[l]!=d&&a(b,l,h),m&&x[l]!=d&&(x[l]=d)};r.core=i,u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},90528:(e,t,n)=>{var r=n(64410)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[r]=!1,!"/./"[e](t)}catch(e){}}return!0}},10496:e=>{e.exports=function(e){try{return!!e()}catch(e){return!0}}},87925:(e,t,n)=>{"use strict";n(47515);var r=n(69593),i=n(74461),a=n(10496),s=n(91083),o=n(64410),u=n(72562),l=o("species"),c=!a((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),d=function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2===n.length&&"a"===n[0]&&"b"===n[1]}();e.exports=function(e,t,n){var h=o(e),f=!a((function(){var t={};return t[h]=function(){return 7},7!=""[e](t)})),p=f?!a((function(){var t=!1,n=/a/;return n.exec=function(){return t=!0,null},"split"===e&&(n.constructor={},n.constructor[l]=function(){return n}),n[h](""),!t})):void 0;if(!f||!p||"replace"===e&&!c||"split"===e&&!d){var g=/./[h],m=n(s,h,""[e],(function(e,t,n,r,i){return t.exec===u?f&&!i?{done:!0,value:g.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}})),y=m[0],v=m[1];r(String.prototype,e,y),i(RegExp.prototype,h,2==t?function(e,t){return v.call(e,this,t)}:function(e){return v.call(e,this)})}}},95660:(e,t,n)=>{"use strict";var r=n(85075);e.exports=function(){var e=r(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},84225:(e,t,n)=>{"use strict";var r=n(63623),i=n(49708),a=n(15263),s=n(21550),o=n(64410)("isConcatSpreadable");e.exports=function e(t,n,u,l,c,d,h,f){for(var p,g,m=c,y=0,v=!!h&&s(h,f,3);y<l;){if(y in u){if(p=v?v(u[y],y,n):u[y],g=!1,i(p)&&(g=void 0!==(g=p[o])?!!g:r(p)),g&&d>0)m=e(t,n,p,a(p.length),m,d-1)-1;else{if(m>=9007199254740991)throw TypeError();t[m]=p}m++}y++}return m}},74036:(e,t,n)=>{var r=n(21550),i=n(98226),a=n(92193),s=n(85075),o=n(15263),u=n(77521),l={},c={},d=e.exports=function(e,t,n,d,h){var f,p,g,m,y=h?function(){return e}:u(e),v=r(n,d,t?2:1),b=0;if("function"!=typeof y)throw TypeError(e+" is not iterable!");if(a(y)){for(f=o(e.length);f>b;b++)if((m=t?v(s(p=e[b])[0],p[1]):v(e[b]))===l||m===c)return m}else for(g=y.call(e);!(p=g.next()).done;)if((m=i(g,v,p.value,t))===l||m===c)return m};d.BREAK=l,d.RETURN=c},19769:(e,t,n)=>{e.exports=n(47104)("native-function-to-string",Function.toString)},24405:e=>{var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)},83050:e=>{var t={}.hasOwnProperty;e.exports=function(e,n){return t.call(e,n)}},74461:(e,t,n)=>{var r=n(24213),i=n(33388);e.exports=n(83144)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},17727:(e,t,n)=>{var r=n(24405).document;e.exports=r&&r.documentElement},80748:(e,t,n)=>{e.exports=!n(83144)&&!n(10496)((function(){return 7!=Object.defineProperty(n(47339)("div"),"a",{get:function(){return 7}}).a}))},77856:(e,t,n)=>{var r=n(49708),i=n(41794).set;e.exports=function(e,t,n){var a,s=t.constructor;return s!==n&&"function"==typeof s&&(a=s.prototype)!==n.prototype&&r(a)&&i&&i(e,a),e}},31671:e=>{e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},75945:(e,t,n)=>{var r=n(42380);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},92193:(e,t,n)=>{var r=n(47985),i=n(64410)("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||a[i]===e)}},63623:(e,t,n)=>{var r=n(42380);e.exports=Array.isArray||function(e){return"Array"==r(e)}},48645:(e,t,n)=>{var r=n(49708),i=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&i(e)===e}},49708:e=>{e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},70939:(e,t,n)=>{var r=n(49708),i=n(42380),a=n(64410)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[a])?!!t:"RegExp"==i(e))}},98226:(e,t,n)=>{var r=n(85075);e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var a=e.return;throw void 0!==a&&r(a.call(e)),t}}},39614:(e,t,n)=>{"use strict";var r=n(6088),i=n(33388),a=n(25572),s={};n(74461)(s,n(64410)("iterator"),(function(){return this})),e.exports=function(e,t,n){e.prototype=r(s,{next:i(1,n)}),a(e,t+" Iterator")}},15706:(e,t,n)=>{"use strict";var r=n(14925),i=n(61693),a=n(69593),s=n(74461),o=n(47985),u=n(39614),l=n(25572),c=n(88539),d=n(64410)("iterator"),h=!([].keys&&"next"in[].keys()),f="keys",p="values",g=function(){return this};e.exports=function(e,t,n,m,y,v,b){u(n,t,m);var x,w,k,_=function(e){if(!h&&e in E)return E[e];switch(e){case f:case p:return function(){return new n(this,e)}}return function(){return new n(this,e)}},S=t+" Iterator",C=y==p,A=!1,E=e.prototype,F=E[d]||E["@@iterator"]||y&&E[y],I=F||_(y),D=y?C?_("entries"):I:void 0,N="Array"==t&&E.entries||F;if(N&&(k=c(N.call(new e)))!==Object.prototype&&k.next&&(l(k,S,!0),r||"function"==typeof k[d]||s(k,d,g)),C&&F&&F.name!==p&&(A=!0,I=function(){return F.call(this)}),r&&!b||!h&&!A&&E[d]||s(E,d,I),o[t]=I,o[S]=g,y)if(x={values:C?I:_(p),keys:v?I:_(f),entries:D},b)for(w in x)w in E||a(E,w,x[w]);else i(i.P+i.F*(h||A),t,x);return x}},3229:(e,t,n)=>{var r=n(64410)("iterator"),i=!1;try{var a=[7][r]();a.return=function(){i=!0},Array.from(a,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var a=[7],s=a[r]();s.next=function(){return{done:n=!0}},a[r]=function(){return s},e(a)}catch(e){}return n}},34257:e=>{e.exports=function(e,t){return{value:t,done:!!e}}},47985:e=>{e.exports={}},14925:e=>{e.exports=!1},98651:e=>{var t=Math.expm1;e.exports=!t||t(10)>22025.465794806718||t(10)<22025.465794806718||-2e-17!=t(-2e-17)?function(e){return 0==(e=+e)?e:e>-1e-6&&e<1e-6?e+e*e/2:Math.exp(e)-1}:t},88961:(e,t,n)=>{var r=n(19439),i=Math.pow,a=i(2,-52),s=i(2,-23),o=i(2,127)*(2-s),u=i(2,-126);e.exports=Math.fround||function(e){var t,n,i=Math.abs(e),l=r(e);return i<u?l*(i/u/s+1/a-1/a)*u*s:(n=(t=(1+s/a)*i)-(t-i))>o||n!=n?l*(1/0):l*n}},18738:e=>{e.exports=Math.log1p||function(e){return(e=+e)>-1e-8&&e<1e-8?e-e*e/2:Math.log(1+e)}},64917:e=>{e.exports=Math.scale||function(e,t,n,r,i){return 0===arguments.length||e!=e||t!=t||n!=n||r!=r||i!=i?NaN:e===1/0||e===-1/0?e:(e-t)*(i-r)/(n-t)+r}},19439:e=>{e.exports=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}},18648:(e,t,n)=>{var r=n(7767)("meta"),i=n(49708),a=n(83050),s=n(24213).f,o=0,u=Object.isExtensible||function(){return!0},l=!n(10496)((function(){return u(Object.preventExtensions({}))})),c=function(e){s(e,r,{value:{i:"O"+ ++o,w:{}}})},d=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!a(e,r)){if(!u(e))return"F";if(!t)return"E";c(e)}return e[r].i},getWeak:function(e,t){if(!a(e,r)){if(!u(e))return!0;if(!t)return!1;c(e)}return e[r].w},onFreeze:function(e){return l&&d.NEED&&u(e)&&!a(e,r)&&c(e),e}}},70380:(e,t,n)=>{var r=n(29164),i=n(61693),a=n(47104)("metadata"),s=a.store||(a.store=new(n(86189))),o=function(e,t,n){var i=s.get(e);if(!i){if(!n)return;s.set(e,i=new r)}var a=i.get(t);if(!a){if(!n)return;i.set(t,a=new r)}return a};e.exports={store:s,map:o,has:function(e,t,n){var r=o(t,n,!1);return void 0!==r&&r.has(e)},get:function(e,t,n){var r=o(t,n,!1);return void 0===r?void 0:r.get(e)},set:function(e,t,n,r){o(n,r,!0).set(e,t)},keys:function(e,t){var n=o(e,t,!1),r=[];return n&&n.forEach((function(e,t){r.push(t)})),r},key:function(e){return void 0===e||"symbol"==typeof e?e:String(e)},exp:function(e){i(i.S,"Reflect",e)}}},32583:(e,t,n)=>{var r=n(24405),i=n(21597).set,a=r.MutationObserver||r.WebKitMutationObserver,s=r.process,o=r.Promise,u="process"==n(42380)(s);e.exports=function(){var e,t,n,l=function(){var r,i;for(u&&(r=s.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(u)n=function(){s.nextTick(l)};else if(!a||r.navigator&&r.navigator.standalone)if(o&&o.resolve){var c=o.resolve(void 0);n=function(){c.then(l)}}else n=function(){i.call(r,l)};else{var d=!0,h=document.createTextNode("");new a(l).observe(h,{characterData:!0}),n=function(){h.data=d=!d}}return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},12219:(e,t,n)=>{"use strict";var r=n(50666);function i(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=r(t),this.reject=r(n)}e.exports.f=function(e){return new i(e)}},92075:(e,t,n)=>{"use strict";var r=n(83144),i=n(31126),a=n(68910),s=n(2806),o=n(16040),u=n(75945),l=Object.assign;e.exports=!l||n(10496)((function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=l({},e)[n]||Object.keys(l({},t)).join("")!=r}))?function(e,t){for(var n=o(e),l=arguments.length,c=1,d=a.f,h=s.f;l>c;)for(var f,p=u(arguments[c++]),g=d?i(p).concat(d(p)):i(p),m=g.length,y=0;m>y;)f=g[y++],r&&!h.call(p,f)||(n[f]=p[f]);return n}:l},6088:(e,t,n)=>{var r=n(85075),i=n(62390),a=n(95985),s=n(81145)("IE_PROTO"),o=function(){},u=function(){var e,t=n(47339)("iframe"),r=a.length;for(t.style.display="none",n(17727).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),u=e.F;r--;)delete u.prototype[a[r]];return u()};e.exports=Object.create||function(e,t){var n;return null!==e?(o.prototype=r(e),n=new o,o.prototype=null,n[s]=e):n=u(),void 0===t?n:i(n,t)}},24213:(e,t,n)=>{var r=n(85075),i=n(80748),a=n(23825),s=Object.defineProperty;t.f=n(83144)?Object.defineProperty:function(e,t,n){if(r(e),t=a(t,!0),r(n),i)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},62390:(e,t,n)=>{var r=n(24213),i=n(85075),a=n(31126);e.exports=n(83144)?Object.defineProperties:function(e,t){i(e);for(var n,s=a(t),o=s.length,u=0;o>u;)r.f(e,n=s[u++],t[n]);return e}},42296:(e,t,n)=>{"use strict";e.exports=n(14925)||!n(10496)((function(){var e=Math.random();__defineSetter__.call(null,e,(function(){})),delete n(24405)[e]}))},99015:(e,t,n)=>{var r=n(2806),i=n(33388),a=n(76282),s=n(23825),o=n(83050),u=n(80748),l=Object.getOwnPropertyDescriptor;t.f=n(83144)?l:function(e,t){if(e=a(e),t=s(t,!0),u)try{return l(e,t)}catch(e){}if(o(e,t))return i(!r.f.call(e,t),e[t])}},73233:(e,t,n)=>{var r=n(76282),i=n(77173).f,a={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return s&&"[object Window]"==a.call(e)?function(e){try{return i(e)}catch(e){return s.slice()}}(e):i(r(e))}},77173:(e,t,n)=>{var r=n(23872),i=n(95985).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},68910:(e,t)=>{t.f=Object.getOwnPropertySymbols},88539:(e,t,n)=>{var r=n(83050),i=n(16040),a=n(81145)("IE_PROTO"),s=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},23872:(e,t,n)=>{var r=n(83050),i=n(76282),a=n(64513)(!1),s=n(81145)("IE_PROTO");e.exports=function(e,t){var n,o=i(e),u=0,l=[];for(n in o)n!=s&&r(o,n)&&l.push(n);for(;t.length>u;)r(o,n=t[u++])&&(~a(l,n)||l.push(n));return l}},31126:(e,t,n)=>{var r=n(23872),i=n(95985);e.exports=Object.keys||function(e){return r(e,i)}},2806:(e,t)=>{t.f={}.propertyIsEnumerable},79870:(e,t,n)=>{var r=n(61693),i=n(48080),a=n(10496);e.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],s={};s[e]=t(n),r(r.S+r.F*a((function(){n(1)})),"Object",s)}},72133:(e,t,n)=>{var r=n(83144),i=n(31126),a=n(76282),s=n(2806).f;e.exports=function(e){return function(t){for(var n,o=a(t),u=i(o),l=u.length,c=0,d=[];l>c;)n=u[c++],r&&!s.call(o,n)||d.push(e?[n,o[n]]:o[n]);return d}}},2275:(e,t,n)=>{var r=n(77173),i=n(68910),a=n(85075),s=n(24405).Reflect;e.exports=s&&s.ownKeys||function(e){var t=r.f(a(e)),n=i.f;return n?t.concat(n(e)):t}},95995:(e,t,n)=>{var r=n(24405).parseFloat,i=n(25480).trim;e.exports=1/r(n(71176)+"-0")!=-1/0?function(e){var t=i(String(e),3),n=r(t);return 0===n&&"-"==t.charAt(0)?-0:n}:r},27252:(e,t,n)=>{var r=n(24405).parseInt,i=n(25480).trim,a=n(71176),s=/^[-+]?0[xX]/;e.exports=8!==r(a+"08")||22!==r(a+"0x16")?function(e,t){var n=i(String(e),3);return r(n,t>>>0||(s.test(n)?16:10))}:r},24552:e=>{e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},99894:(e,t,n)=>{var r=n(85075),i=n(49708),a=n(12219);e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=a.f(e);return(0,n.resolve)(t),n.promise}},33388:e=>{e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},33227:(e,t,n)=>{var r=n(69593);e.exports=function(e,t,n){for(var i in t)r(e,i,t[i],n);return e}},69593:(e,t,n)=>{var r=n(24405),i=n(74461),a=n(83050),s=n(7767)("src"),o=n(19769),u="toString",l=(""+o).split(u);n(48080).inspectSource=function(e){return o.call(e)},(e.exports=function(e,t,n,o){var u="function"==typeof n;u&&(a(n,"name")||i(n,"name",t)),e[t]!==n&&(u&&(a(n,s)||i(n,s,e[t]?""+e[t]:l.join(String(t)))),e===r?e[t]=n:o?e[t]?e[t]=n:i(e,t,n):(delete e[t],i(e,t,n)))})(Function.prototype,u,(function(){return"function"==typeof this&&this[s]||o.call(this)}))},26798:(e,t,n)=>{"use strict";var r=n(96347),i=RegExp.prototype.exec;e.exports=function(e,t){var n=e.exec;if("function"==typeof n){var a=n.call(e,t);if("object"!=typeof a)throw new TypeError("RegExp exec method returned something other than an Object or null");return a}if("RegExp"!==r(e))throw new TypeError("RegExp#exec called on incompatible receiver");return i.call(e,t)}},72562:(e,t,n)=>{"use strict";var r,i,a=n(95660),s=RegExp.prototype.exec,o=String.prototype.replace,u=s,l=(r=/a/,i=/b*/g,s.call(r,"a"),s.call(i,"a"),0!==r.lastIndex||0!==i.lastIndex),c=void 0!==/()??/.exec("")[1];(l||c)&&(u=function(e){var t,n,r,i,u=this;return c&&(n=new RegExp("^"+u.source+"$(?!\\s)",a.call(u))),l&&(t=u.lastIndex),r=s.call(u,e),l&&r&&(u.lastIndex=u.global?r.index+r[0].length:t),c&&r&&r.length>1&&o.call(r[0],n,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)})),r}),e.exports=u},22950:e=>{e.exports=function(e,t){var n=t===Object(t)?function(e){return t[e]}:t;return function(t){return String(t).replace(e,n)}}},41366:e=>{e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},50578:(e,t,n)=>{"use strict";var r=n(61693),i=n(50666),a=n(21550),s=n(74036);e.exports=function(e){r(r.S,e,{from:function(e){var t,n,r,o,u=arguments[1];return i(this),(t=void 0!==u)&&i(u),null==e?new this:(n=[],t?(r=0,o=a(u,arguments[2],2),s(e,!1,(function(e){n.push(o(e,r++))}))):s(e,!1,n.push,n),new this(n))}})}},20147:(e,t,n)=>{"use strict";var r=n(61693);e.exports=function(e){r(r.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},41794:(e,t,n)=>{var r=n(49708),i=n(85075),a=function(e,t){if(i(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=n(21550)(Function.call,n(99015).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return a(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:a}},72373:(e,t,n)=>{"use strict";var r=n(24405),i=n(24213),a=n(83144),s=n(64410)("species");e.exports=function(e){var t=r[e];a&&t&&!t[s]&&i.f(t,s,{configurable:!0,get:function(){return this}})}},25572:(e,t,n)=>{var r=n(24213).f,i=n(83050),a=n(64410)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,a)&&r(e,a,{configurable:!0,value:t})}},81145:(e,t,n)=>{var r=n(47104)("keys"),i=n(7767);e.exports=function(e){return r[e]||(r[e]=i(e))}},47104:(e,t,n)=>{var r=n(48080),i=n(24405),a="__core-js_shared__",s=i[a]||(i[a]={});(e.exports=function(e,t){return s[e]||(s[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n(14925)?"pure":"global",copyright:" 2020 Denis Pushkarev (zloirock.ru)"})},33611:(e,t,n)=>{var r=n(85075),i=n(50666),a=n(64410)("species");e.exports=function(e,t){var n,s=r(e).constructor;return void 0===s||null==(n=r(s)[a])?t:i(n)}},69718:(e,t,n)=>{"use strict";var r=n(10496);e.exports=function(e,t){return!!e&&r((function(){t?e.call(null,(function(){}),1):e.call(null)}))}},25454:(e,t,n)=>{var r=n(94058),i=n(91083);e.exports=function(e){return function(t,n){var a,s,o=String(i(t)),u=r(n),l=o.length;return u<0||u>=l?e?"":void 0:(a=o.charCodeAt(u))<55296||a>56319||u+1===l||(s=o.charCodeAt(u+1))<56320||s>57343?e?o.charAt(u):a:e?o.slice(u,u+2):s-56320+(a-55296<<10)+65536}}},31452:(e,t,n)=>{var r=n(70939),i=n(91083);e.exports=function(e,t,n){if(r(t))throw TypeError("String#"+n+" doesn't accept regex!");return String(i(e))}},47742:(e,t,n)=>{var r=n(61693),i=n(10496),a=n(91083),s=/"/g,o=function(e,t,n,r){var i=String(a(e)),o="<"+t;return""!==n&&(o+=" "+n+'="'+String(r).replace(s,"&quot;")+'"'),o+">"+i+"</"+t+">"};e.exports=function(e,t){var n={};n[e]=t(o),r(r.P+r.F*i((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3})),"String",n)}},26687:(e,t,n)=>{var r=n(15263),i=n(23874),a=n(91083);e.exports=function(e,t,n,s){var o=String(a(e)),u=o.length,l=void 0===n?" ":String(n),c=r(t);if(c<=u||""==l)return o;var d=c-u,h=i.call(l,Math.ceil(d/l.length));return h.length>d&&(h=h.slice(0,d)),s?h+o:o+h}},23874:(e,t,n)=>{"use strict";var r=n(94058),i=n(91083);e.exports=function(e){var t=String(i(this)),n="",a=r(e);if(a<0||a==1/0)throw RangeError("Count can't be negative");for(;a>0;(a>>>=1)&&(t+=t))1&a&&(n+=t);return n}},25480:(e,t,n)=>{var r=n(61693),i=n(91083),a=n(10496),s=n(71176),o="["+s+"]",u=RegExp("^"+o+o+"*"),l=RegExp(o+o+"*$"),c=function(e,t,n){var i={},o=a((function(){return!!s[e]()||""!=""[e]()})),u=i[e]=o?t(d):s[e];n&&(i[n]=u),r(r.P+r.F*o,"String",i)},d=c.trim=function(e,t){return e=String(i(e)),1&t&&(e=e.replace(u,"")),2&t&&(e=e.replace(l,"")),e};e.exports=c},71176:e=>{e.exports="\t\n\v\f\r \u2028\u2029\ufeff"},21597:(e,t,n)=>{var r,i,a,s=n(21550),o=n(31671),u=n(17727),l=n(47339),c=n(24405),d=c.process,h=c.setImmediate,f=c.clearImmediate,p=c.MessageChannel,g=c.Dispatch,m=0,y={},v=function(){var e=+this;if(y.hasOwnProperty(e)){var t=y[e];delete y[e],t()}},b=function(e){v.call(e.data)};h&&f||(h=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return y[++m]=function(){o("function"==typeof e?e:Function(e),t)},r(m),m},f=function(e){delete y[e]},"process"==n(42380)(d)?r=function(e){d.nextTick(s(v,e,1))}:g&&g.now?r=function(e){g.now(s(v,e,1))}:p?(a=(i=new p).port2,i.port1.onmessage=b,r=s(a.postMessage,a,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(r=function(e){c.postMessage(e+"","*")},c.addEventListener("message",b,!1)):r="onreadystatechange"in l("script")?function(e){u.appendChild(l("script")).onreadystatechange=function(){u.removeChild(this),v.call(e)}}:function(e){setTimeout(s(v,e,1),0)}),e.exports={set:h,clear:f}},39519:(e,t,n)=>{var r=n(94058),i=Math.max,a=Math.min;e.exports=function(e,t){return(e=r(e))<0?i(e+t,0):a(e,t)}},84423:(e,t,n)=>{var r=n(94058),i=n(15263);e.exports=function(e){if(void 0===e)return 0;var t=r(e),n=i(t);if(t!==n)throw RangeError("Wrong length!");return n}},94058:e=>{var t=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:t)(e)}},76282:(e,t,n)=>{var r=n(75945),i=n(91083);e.exports=function(e){return r(i(e))}},15263:(e,t,n)=>{var r=n(94058),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},16040:(e,t,n)=>{var r=n(91083);e.exports=function(e){return Object(r(e))}},23825:(e,t,n)=>{var r=n(49708);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},33412:(e,t,n)=>{"use strict";if(n(83144)){var r=n(14925),i=n(24405),a=n(10496),s=n(61693),o=n(76331),u=n(7050),l=n(21550),c=n(30269),d=n(33388),h=n(74461),f=n(33227),p=n(94058),g=n(15263),m=n(84423),y=n(39519),v=n(23825),b=n(83050),x=n(96347),w=n(49708),k=n(16040),_=n(92193),S=n(6088),C=n(88539),A=n(77173).f,E=n(77521),F=n(7767),I=n(64410),D=n(13635),N=n(64513),$=n(33611),T=n(66172),O=n(47985),M=n(3229),R=n(72373),B=n(35572),z=n(43697),L=n(24213),P=n(99015),j=L.f,U=P.f,W=i.RangeError,V=i.TypeError,G=i.Uint8Array,q="ArrayBuffer",H="SharedArrayBuffer",X="BYTES_PER_ELEMENT",K=Array.prototype,Y=u.ArrayBuffer,Q=u.DataView,J=D(0),Z=D(2),ee=D(3),te=D(4),ne=D(5),re=D(6),ie=N(!0),ae=N(!1),se=T.values,oe=T.keys,ue=T.entries,le=K.lastIndexOf,ce=K.reduce,de=K.reduceRight,he=K.join,fe=K.sort,pe=K.slice,ge=K.toString,me=K.toLocaleString,ye=I("iterator"),ve=I("toStringTag"),be=F("typed_constructor"),xe=F("def_constructor"),we=o.CONSTR,ke=o.TYPED,_e=o.VIEW,Se="Wrong length!",Ce=D(1,(function(e,t){return De($(e,e[xe]),t)})),Ae=a((function(){return 1===new G(new Uint16Array([1]).buffer)[0]})),Ee=!!G&&!!G.prototype.set&&a((function(){new G(1).set({})})),Fe=function(e,t){var n=p(e);if(n<0||n%t)throw W("Wrong offset!");return n},Ie=function(e){if(w(e)&&ke in e)return e;throw V(e+" is not a typed array!")},De=function(e,t){if(!w(e)||!(be in e))throw V("It is not a typed array constructor!");return new e(t)},Ne=function(e,t){return $e($(e,e[xe]),t)},$e=function(e,t){for(var n=0,r=t.length,i=De(e,r);r>n;)i[n]=t[n++];return i},Te=function(e,t,n){j(e,t,{get:function(){return this._d[n]}})},Oe=function(e){var t,n,r,i,a,s,o=k(e),u=arguments.length,c=u>1?arguments[1]:void 0,d=void 0!==c,h=E(o);if(null!=h&&!_(h)){for(s=h.call(o),r=[],t=0;!(a=s.next()).done;t++)r.push(a.value);o=r}for(d&&u>2&&(c=l(c,arguments[2],2)),t=0,n=g(o.length),i=De(this,n);n>t;t++)i[t]=d?c(o[t],t):o[t];return i},Me=function(){for(var e=0,t=arguments.length,n=De(this,t);t>e;)n[e]=arguments[e++];return n},Re=!!G&&a((function(){me.call(new G(1))})),Be=function(){return me.apply(Re?pe.call(Ie(this)):Ie(this),arguments)},ze={copyWithin:function(e,t){return z.call(Ie(this),e,t,arguments.length>2?arguments[2]:void 0)},every:function(e){return te(Ie(this),e,arguments.length>1?arguments[1]:void 0)},fill:function(e){return B.apply(Ie(this),arguments)},filter:function(e){return Ne(this,Z(Ie(this),e,arguments.length>1?arguments[1]:void 0))},find:function(e){return ne(Ie(this),e,arguments.length>1?arguments[1]:void 0)},findIndex:function(e){return re(Ie(this),e,arguments.length>1?arguments[1]:void 0)},forEach:function(e){J(Ie(this),e,arguments.length>1?arguments[1]:void 0)},indexOf:function(e){return ae(Ie(this),e,arguments.length>1?arguments[1]:void 0)},includes:function(e){return ie(Ie(this),e,arguments.length>1?arguments[1]:void 0)},join:function(e){return he.apply(Ie(this),arguments)},lastIndexOf:function(e){return le.apply(Ie(this),arguments)},map:function(e){return Ce(Ie(this),e,arguments.length>1?arguments[1]:void 0)},reduce:function(e){return ce.apply(Ie(this),arguments)},reduceRight:function(e){return de.apply(Ie(this),arguments)},reverse:function(){for(var e,t=this,n=Ie(t).length,r=Math.floor(n/2),i=0;i<r;)e=t[i],t[i++]=t[--n],t[n]=e;return t},some:function(e){return ee(Ie(this),e,arguments.length>1?arguments[1]:void 0)},sort:function(e){return fe.call(Ie(this),e)},subarray:function(e,t){var n=Ie(this),r=n.length,i=y(e,r);return new($(n,n[xe]))(n.buffer,n.byteOffset+i*n.BYTES_PER_ELEMENT,g((void 0===t?r:y(t,r))-i))}},Le=function(e,t){return Ne(this,pe.call(Ie(this),e,t))},Pe=function(e){Ie(this);var t=Fe(arguments[1],1),n=this.length,r=k(e),i=g(r.length),a=0;if(i+t>n)throw W(Se);for(;a<i;)this[t+a]=r[a++]},je={entries:function(){return ue.call(Ie(this))},keys:function(){return oe.call(Ie(this))},values:function(){return se.call(Ie(this))}},Ue=function(e,t){return w(e)&&e[ke]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},We=function(e,t){return Ue(e,t=v(t,!0))?d(2,e[t]):U(e,t)},Ve=function(e,t,n){return!(Ue(e,t=v(t,!0))&&w(n)&&b(n,"value"))||b(n,"get")||b(n,"set")||n.configurable||b(n,"writable")&&!n.writable||b(n,"enumerable")&&!n.enumerable?j(e,t,n):(e[t]=n.value,e)};we||(P.f=We,L.f=Ve),s(s.S+s.F*!we,"Object",{getOwnPropertyDescriptor:We,defineProperty:Ve}),a((function(){ge.call({})}))&&(ge=me=function(){return he.call(this)});var Ge=f({},ze);f(Ge,je),h(Ge,ye,je.values),f(Ge,{slice:Le,set:Pe,constructor:function(){},toString:ge,toLocaleString:Be}),Te(Ge,"buffer","b"),Te(Ge,"byteOffset","o"),Te(Ge,"byteLength","l"),Te(Ge,"length","e"),j(Ge,ve,{get:function(){return this[ke]}}),e.exports=function(e,t,n,u){var l=e+((u=!!u)?"Clamped":"")+"Array",d="get"+e,f="set"+e,p=i[l],y=p||{},v=p&&C(p),b=!p||!o.ABV,k={},_=p&&p.prototype,E=function(e,n){j(e,n,{get:function(){return function(e,n){var r=e._d;return r.v[d](n*t+r.o,Ae)}(this,n)},set:function(e){return function(e,n,r){var i=e._d;u&&(r=(r=Math.round(r))<0?0:r>255?255:255&r),i.v[f](n*t+i.o,r,Ae)}(this,n,e)},enumerable:!0})};b?(p=n((function(e,n,r,i){c(e,p,l,"_d");var a,s,o,u,d=0,f=0;if(w(n)){if(!(n instanceof Y||(u=x(n))==q||u==H))return ke in n?$e(p,n):Oe.call(p,n);a=n,f=Fe(r,t);var y=n.byteLength;if(void 0===i){if(y%t)throw W(Se);if((s=y-f)<0)throw W(Se)}else if((s=g(i)*t)+f>y)throw W(Se);o=s/t}else o=m(n),a=new Y(s=o*t);for(h(e,"_d",{b:a,o:f,l:s,e:o,v:new Q(a)});d<o;)E(e,d++)})),_=p.prototype=S(Ge),h(_,"constructor",p)):a((function(){p(1)}))&&a((function(){new p(-1)}))&&M((function(e){new p,new p(null),new p(1.5),new p(e)}),!0)||(p=n((function(e,n,r,i){var a;return c(e,p,l),w(n)?n instanceof Y||(a=x(n))==q||a==H?void 0!==i?new y(n,Fe(r,t),i):void 0!==r?new y(n,Fe(r,t)):new y(n):ke in n?$e(p,n):Oe.call(p,n):new y(m(n))})),J(v!==Function.prototype?A(y).concat(A(v)):A(y),(function(e){e in p||h(p,e,y[e])})),p.prototype=_,r||(_.constructor=p));var F=_[ye],I=!!F&&("values"==F.name||null==F.name),D=je.values;h(p,be,!0),h(_,ke,l),h(_,_e,!0),h(_,xe,p),(u?new p(1)[ve]==l:ve in _)||j(_,ve,{get:function(){return l}}),k[l]=p,s(s.G+s.W+s.F*(p!=y),k),s(s.S,l,{BYTES_PER_ELEMENT:t}),s(s.S+s.F*a((function(){y.of.call(p,1)})),l,{from:Oe,of:Me}),X in _||h(_,X,t),s(s.P,l,ze),R(l),s(s.P+s.F*Ee,l,{set:Pe}),s(s.P+s.F*!I,l,je),r||_.toString==ge||(_.toString=ge),s(s.P+s.F*a((function(){new p(1).slice()})),l,{slice:Le}),s(s.P+s.F*(a((function(){return[1,2].toLocaleString()!=new p([1,2]).toLocaleString()}))||!a((function(){_.toLocaleString.call([1,2])}))),l,{toLocaleString:Be}),O[l]=I?F:D,r||I||h(_,ye,D)}}else e.exports=function(){}},7050:(e,t,n)=>{"use strict";var r=n(24405),i=n(83144),a=n(14925),s=n(76331),o=n(74461),u=n(33227),l=n(10496),c=n(30269),d=n(94058),h=n(15263),f=n(84423),p=n(77173).f,g=n(24213).f,m=n(35572),y=n(25572),v="ArrayBuffer",b="DataView",x="Wrong index!",w=r.ArrayBuffer,k=r.DataView,_=r.Math,S=r.RangeError,C=r.Infinity,A=w,E=_.abs,F=_.pow,I=_.floor,D=_.log,N=_.LN2,$="buffer",T="byteLength",O="byteOffset",M=i?"_b":$,R=i?"_l":T,B=i?"_o":O;function z(e,t,n){var r,i,a,s=new Array(n),o=8*n-t-1,u=(1<<o)-1,l=u>>1,c=23===t?F(2,-24)-F(2,-77):0,d=0,h=e<0||0===e&&1/e<0?1:0;for((e=E(e))!=e||e===C?(i=e!=e?1:0,r=u):(r=I(D(e)/N),e*(a=F(2,-r))<1&&(r--,a*=2),(e+=r+l>=1?c/a:c*F(2,1-l))*a>=2&&(r++,a/=2),r+l>=u?(i=0,r=u):r+l>=1?(i=(e*a-1)*F(2,t),r+=l):(i=e*F(2,l-1)*F(2,t),r=0));t>=8;s[d++]=255&i,i/=256,t-=8);for(r=r<<t|i,o+=t;o>0;s[d++]=255&r,r/=256,o-=8);return s[--d]|=128*h,s}function L(e,t,n){var r,i=8*n-t-1,a=(1<<i)-1,s=a>>1,o=i-7,u=n-1,l=e[u--],c=127&l;for(l>>=7;o>0;c=256*c+e[u],u--,o-=8);for(r=c&(1<<-o)-1,c>>=-o,o+=t;o>0;r=256*r+e[u],u--,o-=8);if(0===c)c=1-s;else{if(c===a)return r?NaN:l?-C:C;r+=F(2,t),c-=s}return(l?-1:1)*r*F(2,c-t)}function P(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function j(e){return[255&e]}function U(e){return[255&e,e>>8&255]}function W(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function V(e){return z(e,52,8)}function G(e){return z(e,23,4)}function q(e,t,n){g(e.prototype,t,{get:function(){return this[n]}})}function H(e,t,n,r){var i=f(+n);if(i+t>e[R])throw S(x);var a=e[M]._b,s=i+e[B],o=a.slice(s,s+t);return r?o:o.reverse()}function X(e,t,n,r,i,a){var s=f(+n);if(s+t>e[R])throw S(x);for(var o=e[M]._b,u=s+e[B],l=r(+i),c=0;c<t;c++)o[u+c]=l[a?c:t-c-1]}if(s.ABV){if(!l((function(){w(1)}))||!l((function(){new w(-1)}))||l((function(){return new w,new w(1.5),new w(NaN),w.name!=v}))){for(var K,Y=(w=function(e){return c(this,w),new A(f(e))}).prototype=A.prototype,Q=p(A),J=0;Q.length>J;)(K=Q[J++])in w||o(w,K,A[K]);a||(Y.constructor=w)}var Z=new k(new w(2)),ee=k.prototype.setInt8;Z.setInt8(0,2147483648),Z.setInt8(1,2147483649),!Z.getInt8(0)&&Z.getInt8(1)||u(k.prototype,{setInt8:function(e,t){ee.call(this,e,t<<24>>24)},setUint8:function(e,t){ee.call(this,e,t<<24>>24)}},!0)}else w=function(e){c(this,w,v);var t=f(e);this._b=m.call(new Array(t),0),this[R]=t},k=function(e,t,n){c(this,k,b),c(e,w,b);var r=e[R],i=d(t);if(i<0||i>r)throw S("Wrong offset!");if(i+(n=void 0===n?r-i:h(n))>r)throw S("Wrong length!");this[M]=e,this[B]=i,this[R]=n},i&&(q(w,T,"_l"),q(k,$,"_b"),q(k,T,"_l"),q(k,O,"_o")),u(k.prototype,{getInt8:function(e){return H(this,1,e)[0]<<24>>24},getUint8:function(e){return H(this,1,e)[0]},getInt16:function(e){var t=H(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=H(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return P(H(this,4,e,arguments[1]))},getUint32:function(e){return P(H(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return L(H(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return L(H(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){X(this,1,e,j,t)},setUint8:function(e,t){X(this,1,e,j,t)},setInt16:function(e,t){X(this,2,e,U,t,arguments[2])},setUint16:function(e,t){X(this,2,e,U,t,arguments[2])},setInt32:function(e,t){X(this,4,e,W,t,arguments[2])},setUint32:function(e,t){X(this,4,e,W,t,arguments[2])},setFloat32:function(e,t){X(this,4,e,G,t,arguments[2])},setFloat64:function(e,t){X(this,8,e,V,t,arguments[2])}});y(w,v),y(k,b),o(k.prototype,s.VIEW,!0),t.ArrayBuffer=w,t.DataView=k},76331:(e,t,n)=>{for(var r,i=n(24405),a=n(74461),s=n(7767),o=s("typed_array"),u=s("view"),l=!(!i.ArrayBuffer||!i.DataView),c=l,d=0,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");d<9;)(r=i[h[d++]])?(a(r.prototype,o,!0),a(r.prototype,u,!0)):c=!1;e.exports={ABV:l,CONSTR:c,TYPED:o,VIEW:u}},7767:e=>{var t=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++t+n).toString(36))}},97860:(e,t,n)=>{var r=n(24405).navigator;e.exports=r&&r.userAgent||""},51554:(e,t,n)=>{var r=n(49708);e.exports=function(e,t){if(!r(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},94519:(e,t,n)=>{var r=n(24405),i=n(48080),a=n(14925),s=n(63438),o=n(24213).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=a?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||o(t,e,{value:s.f(e)})}},63438:(e,t,n)=>{t.f=n(64410)},64410:(e,t,n)=>{var r=n(47104)("wks"),i=n(7767),a=n(24405).Symbol,s="function"==typeof a;(e.exports=function(e){return r[e]||(r[e]=s&&a[e]||(s?a:i)("Symbol."+e))}).store=r},77521:(e,t,n)=>{var r=n(96347),i=n(64410)("iterator"),a=n(47985);e.exports=n(48080).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||a[r(e)]}},54530:(e,t,n)=>{var r=n(61693),i=n(22950)(/[\\^$*+?.()|[\]{}]/g,"\\$&");r(r.S,"RegExp",{escape:function(e){return i(e)}})},79440:(e,t,n)=>{var r=n(61693);r(r.P,"Array",{copyWithin:n(43697)}),n(17296)("copyWithin")},26075:(e,t,n)=>{"use strict";var r=n(61693),i=n(13635)(4);r(r.P+r.F*!n(69718)([].every,!0),"Array",{every:function(e){return i(this,e,arguments[1])}})},15588:(e,t,n)=>{var r=n(61693);r(r.P,"Array",{fill:n(35572)}),n(17296)("fill")},18931:(e,t,n)=>{"use strict";var r=n(61693),i=n(13635)(2);r(r.P+r.F*!n(69718)([].filter,!0),"Array",{filter:function(e){return i(this,e,arguments[1])}})},45294:(e,t,n)=>{"use strict";var r=n(61693),i=n(13635)(6),a="findIndex",s=!0;a in[]&&Array(1)[a]((function(){s=!1})),r(r.P+r.F*s,"Array",{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(17296)(a)},66233:(e,t,n)=>{"use strict";var r=n(61693),i=n(13635)(5),a="find",s=!0;a in[]&&Array(1).find((function(){s=!1})),r(r.P+r.F*s,"Array",{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(17296)(a)},19946:(e,t,n)=>{"use strict";var r=n(61693),i=n(13635)(0),a=n(69718)([].forEach,!0);r(r.P+r.F*!a,"Array",{forEach:function(e){return i(this,e,arguments[1])}})},79731:(e,t,n)=>{"use strict";var r=n(21550),i=n(61693),a=n(16040),s=n(98226),o=n(92193),u=n(15263),l=n(72559),c=n(77521);i(i.S+i.F*!n(3229)((function(e){Array.from(e)})),"Array",{from:function(e){var t,n,i,d,h=a(e),f="function"==typeof this?this:Array,p=arguments.length,g=p>1?arguments[1]:void 0,m=void 0!==g,y=0,v=c(h);if(m&&(g=r(g,p>2?arguments[2]:void 0,2)),null==v||f==Array&&o(v))for(n=new f(t=u(h.length));t>y;y++)l(n,y,m?g(h[y],y):h[y]);else for(d=v.call(h),n=new f;!(i=d.next()).done;y++)l(n,y,m?s(d,g,[i.value,y],!0):i.value);return n.length=y,n}})},29209:(e,t,n)=>{"use strict";var r=n(61693),i=n(64513)(!1),a=[].indexOf,s=!!a&&1/[1].indexOf(1,-0)<0;r(r.P+r.F*(s||!n(69718)(a)),"Array",{indexOf:function(e){return s?a.apply(this,arguments)||0:i(this,e,arguments[1])}})},82550:(e,t,n)=>{var r=n(61693);r(r.S,"Array",{isArray:n(63623)})},66172:(e,t,n)=>{"use strict";var r=n(17296),i=n(34257),a=n(47985),s=n(76282);e.exports=n(15706)(Array,"Array",(function(e,t){this._t=s(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])}),"values"),a.Arguments=a.Array,r("keys"),r("values"),r("entries")},65956:(e,t,n)=>{"use strict";var r=n(61693),i=n(76282),a=[].join;r(r.P+r.F*(n(75945)!=Object||!n(69718)(a)),"Array",{join:function(e){return a.call(i(this),void 0===e?",":e)}})},72733:(e,t,n)=>{"use strict";var r=n(61693),i=n(76282),a=n(94058),s=n(15263),o=[].lastIndexOf,u=!!o&&1/[1].lastIndexOf(1,-0)<0;r(r.P+r.F*(u||!n(69718)(o)),"Array",{lastIndexOf:function(e){if(u)return o.apply(this,arguments)||0;var t=i(this),n=s(t.length),r=n-1;for(arguments.length>1&&(r=Math.min(r,a(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}})},92369:(e,t,n)=>{"use strict";var r=n(61693),i=n(13635)(1);r(r.P+r.F*!n(69718)([].map,!0),"Array",{map:function(e){return i(this,e,arguments[1])}})},40745:(e,t,n)=>{"use strict";var r=n(61693),i=n(72559);r(r.S+r.F*n(10496)((function(){function e(){}return!(Array.of.call(e)instanceof e)})),"Array",{of:function(){for(var e=0,t=arguments.length,n=new("function"==typeof this?this:Array)(t);t>e;)i(n,e,arguments[e++]);return n.length=t,n}})},53565:(e,t,n)=>{"use strict";var r=n(61693),i=n(56574);r(r.P+r.F*!n(69718)([].reduceRight,!0),"Array",{reduceRight:function(e){return i(this,e,arguments.length,arguments[1],!0)}})},9662:(e,t,n)=>{"use strict";var r=n(61693),i=n(56574);r(r.P+r.F*!n(69718)([].reduce,!0),"Array",{reduce:function(e){return i(this,e,arguments.length,arguments[1],!1)}})},56149:(e,t,n)=>{"use strict";var r=n(61693),i=n(17727),a=n(42380),s=n(39519),o=n(15263),u=[].slice;r(r.P+r.F*n(10496)((function(){i&&u.call(i)})),"Array",{slice:function(e,t){var n=o(this.length),r=a(this);if(t=void 0===t?n:t,"Array"==r)return u.call(this,e,t);for(var i=s(e,n),l=s(t,n),c=o(l-i),d=new Array(c),h=0;h<c;h++)d[h]="String"==r?this.charAt(i+h):this[i+h];return d}})},24135:(e,t,n)=>{"use strict";var r=n(61693),i=n(13635)(3);r(r.P+r.F*!n(69718)([].some,!0),"Array",{some:function(e){return i(this,e,arguments[1])}})},32106:(e,t,n)=>{"use strict";var r=n(61693),i=n(50666),a=n(16040),s=n(10496),o=[].sort,u=[1,2,3];r(r.P+r.F*(s((function(){u.sort(void 0)}))||!s((function(){u.sort(null)}))||!n(69718)(o)),"Array",{sort:function(e){return void 0===e?o.call(a(this)):o.call(a(this),i(e))}})},95324:(e,t,n)=>{n(72373)("Array")},22330:(e,t,n)=>{var r=n(61693);r(r.S,"Date",{now:function(){return(new Date).getTime()}})},22943:(e,t,n)=>{var r=n(61693),i=n(59496);r(r.P+r.F*(Date.prototype.toISOString!==i),"Date",{toISOString:i})},56665:(e,t,n)=>{"use strict";var r=n(61693),i=n(16040),a=n(23825);r(r.P+r.F*n(10496)((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})})),"Date",{toJSON:function(e){var t=i(this),n=a(t);return"number"!=typeof n||isFinite(n)?t.toISOString():null}})},61002:(e,t,n)=>{var r=n(64410)("toPrimitive"),i=Date.prototype;r in i||n(74461)(i,r,n(72967))},8616:(e,t,n)=>{var r=Date.prototype,i="Invalid Date",a=r.toString,s=r.getTime;new Date(NaN)+""!=i&&n(69593)(r,"toString",(function(){var e=s.call(this);return e==e?a.call(this):i}))},67442:(e,t,n)=>{var r=n(61693);r(r.P,"Function",{bind:n(47240)})},27998:(e,t,n)=>{"use strict";var r=n(49708),i=n(88539),a=n(64410)("hasInstance"),s=Function.prototype;a in s||n(24213).f(s,a,{value:function(e){if("function"!=typeof this||!r(e))return!1;if(!r(this.prototype))return e instanceof this;for(;e=i(e);)if(this.prototype===e)return!0;return!1}})},6278:(e,t,n)=>{var r=n(24213).f,i=Function.prototype,a=/^\s*function ([^ (]*)/,s="name";s in i||n(83144)&&r(i,s,{configurable:!0,get:function(){try{return(""+this).match(a)[1]}catch(e){return""}}})},29164:(e,t,n)=>{"use strict";var r=n(37647),i=n(51554),a="Map";e.exports=n(8107)(a,(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=r.getEntry(i(this,a),e);return t&&t.v},set:function(e,t){return r.def(i(this,a),0===e?0:e,t)}},r,!0)},96367:(e,t,n)=>{var r=n(61693),i=n(18738),a=Math.sqrt,s=Math.acosh;r(r.S+r.F*!(s&&710==Math.floor(s(Number.MAX_VALUE))&&s(1/0)==1/0),"Math",{acosh:function(e){return(e=+e)<1?NaN:e>94906265.62425156?Math.log(e)+Math.LN2:i(e-1+a(e-1)*a(e+1))}})},87345:(e,t,n)=>{var r=n(61693),i=Math.asinh;r(r.S+r.F*!(i&&1/i(0)>0),"Math",{asinh:function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}})},79471:(e,t,n)=>{var r=n(61693),i=Math.atanh;r(r.S+r.F*!(i&&1/i(-0)<0),"Math",{atanh:function(e){return 0==(e=+e)?e:Math.log((1+e)/(1-e))/2}})},55890:(e,t,n)=>{var r=n(61693),i=n(19439);r(r.S,"Math",{cbrt:function(e){return i(e=+e)*Math.pow(Math.abs(e),1/3)}})},88299:(e,t,n)=>{var r=n(61693);r(r.S,"Math",{clz32:function(e){return(e>>>=0)?31-Math.floor(Math.log(e+.5)*Math.LOG2E):32}})},89286:(e,t,n)=>{var r=n(61693),i=Math.exp;r(r.S,"Math",{cosh:function(e){return(i(e=+e)+i(-e))/2}})},8240:(e,t,n)=>{var r=n(61693),i=n(98651);r(r.S+r.F*(i!=Math.expm1),"Math",{expm1:i})},41050:(e,t,n)=>{var r=n(61693);r(r.S,"Math",{fround:n(88961)})},88246:(e,t,n)=>{var r=n(61693),i=Math.abs;r(r.S,"Math",{hypot:function(e,t){for(var n,r,a=0,s=0,o=arguments.length,u=0;s<o;)u<(n=i(arguments[s++]))?(a=a*(r=u/n)*r+1,u=n):a+=n>0?(r=n/u)*r:n;return u===1/0?1/0:u*Math.sqrt(a)}})},19349:(e,t,n)=>{var r=n(61693),i=Math.imul;r(r.S+r.F*n(10496)((function(){return-5!=i(4294967295,5)||2!=i.length})),"Math",{imul:function(e,t){var n=65535,r=+e,i=+t,a=n&r,s=n&i;return 0|a*s+((n&r>>>16)*s+a*(n&i>>>16)<<16>>>0)}})},95159:(e,t,n)=>{var r=n(61693);r(r.S,"Math",{log10:function(e){return Math.log(e)*Math.LOG10E}})},83158:(e,t,n)=>{var r=n(61693);r(r.S,"Math",{log1p:n(18738)})},17521:(e,t,n)=>{var r=n(61693);r(r.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}})},92565:(e,t,n)=>{var r=n(61693);r(r.S,"Math",{sign:n(19439)})},48337:(e,t,n)=>{var r=n(61693),i=n(98651),a=Math.exp;r(r.S+r.F*n(10496)((function(){return-2e-17!=!Math.sinh(-2e-17)})),"Math",{sinh:function(e){return Math.abs(e=+e)<1?(i(e)-i(-e))/2:(a(e-1)-a(-e-1))*(Math.E/2)}})},18582:(e,t,n)=>{var r=n(61693),i=n(98651),a=Math.exp;r(r.S,"Math",{tanh:function(e){var t=i(e=+e),n=i(-e);return t==1/0?1:n==1/0?-1:(t-n)/(a(e)+a(-e))}})},62310:(e,t,n)=>{var r=n(61693);r(r.S,"Math",{trunc:function(e){return(e>0?Math.floor:Math.ceil)(e)}})},15434:(e,t,n)=>{"use strict";var r=n(24405),i=n(83050),a=n(42380),s=n(77856),o=n(23825),u=n(10496),l=n(77173).f,c=n(99015).f,d=n(24213).f,h=n(25480).trim,f="Number",p=r.Number,g=p,m=p.prototype,y=a(n(6088)(m))==f,v="trim"in String.prototype,b=function(e){var t=o(e,!1);if("string"==typeof t&&t.length>2){var n,r,i,a=(t=v?t.trim():h(t,3)).charCodeAt(0);if(43===a||45===a){if(88===(n=t.charCodeAt(2))||120===n)return NaN}else if(48===a){switch(t.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+t}for(var s,u=t.slice(2),l=0,c=u.length;l<c;l++)if((s=u.charCodeAt(l))<48||s>i)return NaN;return parseInt(u,r)}}return+t};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof p&&(y?u((function(){m.valueOf.call(n)})):a(n)!=f)?s(new g(b(t)),n,p):b(t)};for(var x,w=n(83144)?l(g):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),k=0;w.length>k;k++)i(g,x=w[k])&&!i(p,x)&&d(p,x,c(g,x));p.prototype=m,m.constructor=p,n(69593)(r,f,p)}},84412:(e,t,n)=>{var r=n(61693);r(r.S,"Number",{EPSILON:Math.pow(2,-52)})},17993:(e,t,n)=>{var r=n(61693),i=n(24405).isFinite;r(r.S,"Number",{isFinite:function(e){return"number"==typeof e&&i(e)}})},41755:(e,t,n)=>{var r=n(61693);r(r.S,"Number",{isInteger:n(48645)})},85390:(e,t,n)=>{var r=n(61693);r(r.S,"Number",{isNaN:function(e){return e!=e}})},40352:(e,t,n)=>{var r=n(61693),i=n(48645),a=Math.abs;r(r.S,"Number",{isSafeInteger:function(e){return i(e)&&a(e)<=9007199254740991}})},40526:(e,t,n)=>{var r=n(61693);r(r.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},60708:(e,t,n)=>{var r=n(61693);r(r.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},22360:(e,t,n)=>{var r=n(61693),i=n(95995);r(r.S+r.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},25114:(e,t,n)=>{var r=n(61693),i=n(27252);r(r.S+r.F*(Number.parseInt!=i),"Number",{parseInt:i})},77967:(e,t,n)=>{"use strict";var r=n(61693),i=n(94058),a=n(98479),s=n(23874),o=1..toFixed,u=Math.floor,l=[0,0,0,0,0,0],c="Number.toFixed: incorrect invocation!",d="0",h=function(e,t){for(var n=-1,r=t;++n<6;)r+=e*l[n],l[n]=r%1e7,r=u(r/1e7)},f=function(e){for(var t=6,n=0;--t>=0;)n+=l[t],l[t]=u(n/e),n=n%e*1e7},p=function(){for(var e=6,t="";--e>=0;)if(""!==t||0===e||0!==l[e]){var n=String(l[e]);t=""===t?n:t+s.call(d,7-n.length)+n}return t},g=function(e,t,n){return 0===t?n:t%2==1?g(e,t-1,n*e):g(e*e,t/2,n)};r(r.P+r.F*(!!o&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!n(10496)((function(){o.call({})}))),"Number",{toFixed:function(e){var t,n,r,o,u=a(this,c),l=i(e),m="",y=d;if(l<0||l>20)throw RangeError(c);if(u!=u)return"NaN";if(u<=-1e21||u>=1e21)return String(u);if(u<0&&(m="-",u=-u),u>1e-21)if(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(u*g(2,69,1))-69,n=t<0?u*g(2,-t,1):u/g(2,t,1),n*=4503599627370496,(t=52-t)>0){for(h(0,n),r=l;r>=7;)h(1e7,0),r-=7;for(h(g(10,r,1),0),r=t-1;r>=23;)f(1<<23),r-=23;f(1<<r),h(1,1),f(2),y=p()}else h(0,n),h(1<<-t,0),y=p()+s.call(d,l);return l>0?m+((o=y.length)<=l?"0."+s.call(d,l-o)+y:y.slice(0,o-l)+"."+y.slice(o-l)):m+y}})},3552:(e,t,n)=>{"use strict";var r=n(61693),i=n(10496),a=n(98479),s=1..toPrecision;r(r.P+r.F*(i((function(){return"1"!==s.call(1,void 0)}))||!i((function(){s.call({})}))),"Number",{toPrecision:function(e){var t=a(this,"Number#toPrecision: incorrect invocation!");return void 0===e?s.call(t):s.call(t,e)}})},32680:(e,t,n)=>{var r=n(61693);r(r.S+r.F,"Object",{assign:n(92075)})},67031:(e,t,n)=>{var r=n(61693);r(r.S,"Object",{create:n(6088)})},13073:(e,t,n)=>{var r=n(61693);r(r.S+r.F*!n(83144),"Object",{defineProperties:n(62390)})},48892:(e,t,n)=>{var r=n(61693);r(r.S+r.F*!n(83144),"Object",{defineProperty:n(24213).f})},84925:(e,t,n)=>{var r=n(49708),i=n(18648).onFreeze;n(79870)("freeze",(function(e){return function(t){return e&&r(t)?e(i(t)):t}}))},80476:(e,t,n)=>{var r=n(76282),i=n(99015).f;n(79870)("getOwnPropertyDescriptor",(function(){return function(e,t){return i(r(e),t)}}))},18899:(e,t,n)=>{n(79870)("getOwnPropertyNames",(function(){return n(73233).f}))},27771:(e,t,n)=>{var r=n(16040),i=n(88539);n(79870)("getPrototypeOf",(function(){return function(e){return i(r(e))}}))},52395:(e,t,n)=>{var r=n(49708);n(79870)("isExtensible",(function(e){return function(t){return!!r(t)&&(!e||e(t))}}))},71263:(e,t,n)=>{var r=n(49708);n(79870)("isFrozen",(function(e){return function(t){return!r(t)||!!e&&e(t)}}))},72875:(e,t,n)=>{var r=n(49708);n(79870)("isSealed",(function(e){return function(t){return!r(t)||!!e&&e(t)}}))},84177:(e,t,n)=>{var r=n(61693);r(r.S,"Object",{is:n(41366)})},950:(e,t,n)=>{var r=n(16040),i=n(31126);n(79870)("keys",(function(){return function(e){return i(r(e))}}))},84058:(e,t,n)=>{var r=n(49708),i=n(18648).onFreeze;n(79870)("preventExtensions",(function(e){return function(t){return e&&r(t)?e(i(t)):t}}))},80585:(e,t,n)=>{var r=n(49708),i=n(18648).onFreeze;n(79870)("seal",(function(e){return function(t){return e&&r(t)?e(i(t)):t}}))},26548:(e,t,n)=>{var r=n(61693);r(r.S,"Object",{setPrototypeOf:n(41794).set})},6268:(e,t,n)=>{"use strict";var r=n(96347),i={};i[n(64410)("toStringTag")]="z",i+""!="[object z]"&&n(69593)(Object.prototype,"toString",(function(){return"[object "+r(this)+"]"}),!0)},84212:(e,t,n)=>{var r=n(61693),i=n(95995);r(r.G+r.F*(parseFloat!=i),{parseFloat:i})},15291:(e,t,n)=>{var r=n(61693),i=n(27252);r(r.G+r.F*(parseInt!=i),{parseInt:i})},92229:(e,t,n)=>{"use strict";var r,i,a,s,o=n(14925),u=n(24405),l=n(21550),c=n(96347),d=n(61693),h=n(49708),f=n(50666),p=n(30269),g=n(74036),m=n(33611),y=n(21597).set,v=n(32583)(),b=n(12219),x=n(24552),w=n(97860),k=n(99894),_="Promise",S=u.TypeError,C=u.process,A=C&&C.versions,E=A&&A.v8||"",F=u.Promise,I="process"==c(C),D=function(){},N=i=b.f,$=!!function(){try{var e=F.resolve(1),t=(e.constructor={})[n(64410)("species")]=function(e){e(D,D)};return(I||"function"==typeof PromiseRejectionEvent)&&e.then(D)instanceof t&&0!==E.indexOf("6.6")&&-1===w.indexOf("Chrome/66")}catch(e){}}(),T=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},O=function(e,t){if(!e._n){e._n=!0;var n=e._c;v((function(){for(var r=e._v,i=1==e._s,a=0,s=function(t){var n,a,s,o=i?t.ok:t.fail,u=t.resolve,l=t.reject,c=t.domain;try{o?(i||(2==e._h&&B(e),e._h=1),!0===o?n=r:(c&&c.enter(),n=o(r),c&&(c.exit(),s=!0)),n===t.promise?l(S("Promise-chain cycle")):(a=T(n))?a.call(n,u,l):u(n)):l(r)}catch(e){c&&!s&&c.exit(),l(e)}};n.length>a;)s(n[a++]);e._c=[],e._n=!1,t&&!e._h&&M(e)}))}},M=function(e){y.call(u,(function(){var t,n,r,i=e._v,a=R(e);if(a&&(t=x((function(){I?C.emit("unhandledRejection",i,e):(n=u.onunhandledrejection)?n({promise:e,reason:i}):(r=u.console)&&r.error&&r.error("Unhandled promise rejection",i)})),e._h=I||R(e)?2:1),e._a=void 0,a&&t.e)throw t.v}))},R=function(e){return 1!==e._h&&0===(e._a||e._c).length},B=function(e){y.call(u,(function(){var t;I?C.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})}))},z=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),O(t,!0))},L=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw S("Promise can't be resolved itself");(t=T(e))?v((function(){var r={_w:n,_d:!1};try{t.call(e,l(L,r,1),l(z,r,1))}catch(e){z.call(r,e)}})):(n._v=e,n._s=1,O(n,!1))}catch(e){z.call({_w:n,_d:!1},e)}}};$||(F=function(e){p(this,F,_,"_h"),f(e),r.call(this);try{e(l(L,this,1),l(z,this,1))}catch(e){z.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(33227)(F.prototype,{then:function(e,t){var n=N(m(this,F));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=I?C.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&O(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),a=function(){var e=new r;this.promise=e,this.resolve=l(L,e,1),this.reject=l(z,e,1)},b.f=N=function(e){return e===F||e===s?new a(e):i(e)}),d(d.G+d.W+d.F*!$,{Promise:F}),n(25572)(F,_),n(72373)(_),s=n(48080).Promise,d(d.S+d.F*!$,_,{reject:function(e){var t=N(this);return(0,t.reject)(e),t.promise}}),d(d.S+d.F*(o||!$),_,{resolve:function(e){return k(o&&this===s?F:this,e)}}),d(d.S+d.F*!($&&n(3229)((function(e){F.all(e).catch(D)}))),_,{all:function(e){var t=this,n=N(t),r=n.resolve,i=n.reject,a=x((function(){var n=[],a=0,s=1;g(e,!1,(function(e){var o=a++,u=!1;n.push(void 0),s++,t.resolve(e).then((function(e){u||(u=!0,n[o]=e,--s||r(n))}),i)})),--s||r(n)}));return a.e&&i(a.v),n.promise},race:function(e){var t=this,n=N(t),r=n.reject,i=x((function(){g(e,!1,(function(e){t.resolve(e).then(n.resolve,r)}))}));return i.e&&r(i.v),n.promise}})},39757:(e,t,n)=>{var r=n(61693),i=n(50666),a=n(85075),s=(n(24405).Reflect||{}).apply,o=Function.apply;r(r.S+r.F*!n(10496)((function(){s((function(){}))})),"Reflect",{apply:function(e,t,n){var r=i(e),u=a(n);return s?s(r,t,u):o.call(r,t,u)}})},28545:(e,t,n)=>{var r=n(61693),i=n(6088),a=n(50666),s=n(85075),o=n(49708),u=n(10496),l=n(47240),c=(n(24405).Reflect||{}).construct,d=u((function(){function e(){}return!(c((function(){}),[],e)instanceof e)})),h=!u((function(){c((function(){}))}));r(r.S+r.F*(d||h),"Reflect",{construct:function(e,t){a(e),s(t);var n=arguments.length<3?e:a(arguments[2]);if(h&&!d)return c(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(l.apply(e,r))}var u=n.prototype,f=i(o(u)?u:Object.prototype),p=Function.apply.call(e,f,t);return o(p)?p:f}})},13451:(e,t,n)=>{var r=n(24213),i=n(61693),a=n(85075),s=n(23825);i(i.S+i.F*n(10496)((function(){Reflect.defineProperty(r.f({},1,{value:1}),1,{value:2})})),"Reflect",{defineProperty:function(e,t,n){a(e),t=s(t,!0),a(n);try{return r.f(e,t,n),!0}catch(e){return!1}}})},93735:(e,t,n)=>{var r=n(61693),i=n(99015).f,a=n(85075);r(r.S,"Reflect",{deleteProperty:function(e,t){var n=i(a(e),t);return!(n&&!n.configurable)&&delete e[t]}})},16012:(e,t,n)=>{"use strict";var r=n(61693),i=n(85075),a=function(e){this._t=i(e),this._i=0;var t,n=this._k=[];for(t in e)n.push(t)};n(39614)(a,"Object",(function(){var e,t=this,n=t._k;do{if(t._i>=n.length)return{value:void 0,done:!0}}while(!((e=n[t._i++])in t._t));return{value:e,done:!1}})),r(r.S,"Reflect",{enumerate:function(e){return new a(e)}})},13806:(e,t,n)=>{var r=n(99015),i=n(61693),a=n(85075);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(e,t){return r.f(a(e),t)}})},29063:(e,t,n)=>{var r=n(61693),i=n(88539),a=n(85075);r(r.S,"Reflect",{getPrototypeOf:function(e){return i(a(e))}})},39849:(e,t,n)=>{var r=n(99015),i=n(88539),a=n(83050),s=n(61693),o=n(49708),u=n(85075);s(s.S,"Reflect",{get:function e(t,n){var s,l,c=arguments.length<3?t:arguments[2];return u(t)===c?t[n]:(s=r.f(t,n))?a(s,"value")?s.value:void 0!==s.get?s.get.call(c):void 0:o(l=i(t))?e(l,n,c):void 0}})},71111:(e,t,n)=>{var r=n(61693);r(r.S,"Reflect",{has:function(e,t){return t in e}})},42413:(e,t,n)=>{var r=n(61693),i=n(85075),a=Object.isExtensible;r(r.S,"Reflect",{isExtensible:function(e){return i(e),!a||a(e)}})},17098:(e,t,n)=>{var r=n(61693);r(r.S,"Reflect",{ownKeys:n(2275)})},2294:(e,t,n)=>{var r=n(61693),i=n(85075),a=Object.preventExtensions;r(r.S,"Reflect",{preventExtensions:function(e){i(e);try{return a&&a(e),!0}catch(e){return!1}}})},36938:(e,t,n)=>{var r=n(61693),i=n(41794);i&&r(r.S,"Reflect",{setPrototypeOf:function(e,t){i.check(e,t);try{return i.set(e,t),!0}catch(e){return!1}}})},29920:(e,t,n)=>{var r=n(24213),i=n(99015),a=n(88539),s=n(83050),o=n(61693),u=n(33388),l=n(85075),c=n(49708);o(o.S,"Reflect",{set:function e(t,n,o){var d,h,f=arguments.length<4?t:arguments[3],p=i.f(l(t),n);if(!p){if(c(h=a(t)))return e(h,n,o,f);p=u(0)}if(s(p,"value")){if(!1===p.writable||!c(f))return!1;if(d=i.f(f,n)){if(d.get||d.set||!1===d.writable)return!1;d.value=o,r.f(f,n,d)}else r.f(f,n,u(0,o));return!0}return void 0!==p.set&&(p.set.call(f,o),!0)}})},41544:(e,t,n)=>{var r=n(24405),i=n(77856),a=n(24213).f,s=n(77173).f,o=n(70939),u=n(95660),l=r.RegExp,c=l,d=l.prototype,h=/a/g,f=/a/g,p=new l(h)!==h;if(n(83144)&&(!p||n(10496)((function(){return f[n(64410)("match")]=!1,l(h)!=h||l(f)==f||"/a/i"!=l(h,"i")})))){l=function(e,t){var n=this instanceof l,r=o(e),a=void 0===t;return!n&&r&&e.constructor===l&&a?e:i(p?new c(r&&!a?e.source:e,t):c((r=e instanceof l)?e.source:e,r&&a?u.call(e):t),n?this:d,l)};for(var g=function(e){e in l||a(l,e,{configurable:!0,get:function(){return c[e]},set:function(t){c[e]=t}})},m=s(c),y=0;m.length>y;)g(m[y++]);d.constructor=l,l.prototype=d,n(69593)(r,"RegExp",l)}n(72373)("RegExp")},47515:(e,t,n)=>{"use strict";var r=n(72562);n(61693)({target:"RegExp",proto:!0,forced:r!==/./.exec},{exec:r})},15155:(e,t,n)=>{n(83144)&&"g"!=/./g.flags&&n(24213).f(RegExp.prototype,"flags",{configurable:!0,get:n(95660)})},94675:(e,t,n)=>{"use strict";var r=n(85075),i=n(15263),a=n(10990),s=n(26798);n(87925)("match",1,(function(e,t,n,o){return[function(n){var r=e(this),i=null==n?void 0:n[t];return void 0!==i?i.call(n,r):new RegExp(n)[t](String(r))},function(e){var t=o(n,e,this);if(t.done)return t.value;var u=r(e),l=String(this);if(!u.global)return s(u,l);var c=u.unicode;u.lastIndex=0;for(var d,h=[],f=0;null!==(d=s(u,l));){var p=String(d[0]);h[f]=p,""===p&&(u.lastIndex=a(l,i(u.lastIndex),c)),f++}return 0===f?null:h}]}))},21983:(e,t,n)=>{"use strict";var r=n(85075),i=n(16040),a=n(15263),s=n(94058),o=n(10990),u=n(26798),l=Math.max,c=Math.min,d=Math.floor,h=/\$([$&`']|\d\d?|<[^>]*>)/g,f=/\$([$&`']|\d\d?)/g;n(87925)("replace",2,(function(e,t,n,p){return[function(r,i){var a=e(this),s=null==r?void 0:r[t];return void 0!==s?s.call(r,a,i):n.call(String(a),r,i)},function(e,t){var i=p(n,e,this,t);if(i.done)return i.value;var d=r(e),h=String(this),f="function"==typeof t;f||(t=String(t));var m=d.global;if(m){var y=d.unicode;d.lastIndex=0}for(var v=[];;){var b=u(d,h);if(null===b)break;if(v.push(b),!m)break;""===String(b[0])&&(d.lastIndex=o(h,a(d.lastIndex),y))}for(var x,w="",k=0,_=0;_<v.length;_++){b=v[_];for(var S=String(b[0]),C=l(c(s(b.index),h.length),0),A=[],E=1;E<b.length;E++)A.push(void 0===(x=b[E])?x:String(x));var F=b.groups;if(f){var I=[S].concat(A,C,h);void 0!==F&&I.push(F);var D=String(t.apply(void 0,I))}else D=g(S,h,C,A,F,t);C>=k&&(w+=h.slice(k,C)+D,k=C+S.length)}return w+h.slice(k)}];function g(e,t,r,a,s,o){var u=r+e.length,l=a.length,c=f;return void 0!==s&&(s=i(s),c=h),n.call(o,c,(function(n,i){var o;switch(i.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,r);case"'":return t.slice(u);case"<":o=s[i.slice(1,-1)];break;default:var c=+i;if(0===c)return n;if(c>l){var h=d(c/10);return 0===h?n:h<=l?void 0===a[h-1]?i.charAt(1):a[h-1]+i.charAt(1):n}o=a[c-1]}return void 0===o?"":o}))}}))},96285:(e,t,n)=>{"use strict";var r=n(85075),i=n(41366),a=n(26798);n(87925)("search",1,(function(e,t,n,s){return[function(n){var r=e(this),i=null==n?void 0:n[t];return void 0!==i?i.call(n,r):new RegExp(n)[t](String(r))},function(e){var t=s(n,e,this);if(t.done)return t.value;var o=r(e),u=String(this),l=o.lastIndex;i(l,0)||(o.lastIndex=0);var c=a(o,u);return i(o.lastIndex,l)||(o.lastIndex=l),null===c?-1:c.index}]}))},92467:(e,t,n)=>{"use strict";var r=n(70939),i=n(85075),a=n(33611),s=n(10990),o=n(15263),u=n(26798),l=n(72562),c=n(10496),d=Math.min,h=[].push,f=4294967295,p=!c((function(){RegExp(f,"y")}));n(87925)("split",2,(function(e,t,n,c){var g;return g="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,t){var i=String(this);if(void 0===e&&0===t)return[];if(!r(e))return n.call(i,e,t);for(var a,s,o,u=[],c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),d=0,p=void 0===t?f:t>>>0,g=new RegExp(e.source,c+"g");(a=l.call(g,i))&&!((s=g.lastIndex)>d&&(u.push(i.slice(d,a.index)),a.length>1&&a.index<i.length&&h.apply(u,a.slice(1)),o=a[0].length,d=s,u.length>=p));)g.lastIndex===a.index&&g.lastIndex++;return d===i.length?!o&&g.test("")||u.push(""):u.push(i.slice(d)),u.length>p?u.slice(0,p):u}:"0".split(void 0,0).length?function(e,t){return void 0===e&&0===t?[]:n.call(this,e,t)}:n,[function(n,r){var i=e(this),a=null==n?void 0:n[t];return void 0!==a?a.call(n,i,r):g.call(String(i),n,r)},function(e,t){var r=c(g,e,this,t,g!==n);if(r.done)return r.value;var l=i(e),h=String(this),m=a(l,RegExp),y=l.unicode,v=(l.ignoreCase?"i":"")+(l.multiline?"m":"")+(l.unicode?"u":"")+(p?"y":"g"),b=new m(p?l:"^(?:"+l.source+")",v),x=void 0===t?f:t>>>0;if(0===x)return[];if(0===h.length)return null===u(b,h)?[h]:[];for(var w=0,k=0,_=[];k<h.length;){b.lastIndex=p?k:0;var S,C=u(b,p?h:h.slice(k));if(null===C||(S=d(o(b.lastIndex+(p?0:k)),h.length))===w)k=s(h,k,y);else{if(_.push(h.slice(w,k)),_.length===x)return _;for(var A=1;A<=C.length-1;A++)if(_.push(C[A]),_.length===x)return _;k=w=S}}return _.push(h.slice(w)),_}]}))},80223:(e,t,n)=>{"use strict";n(15155);var r=n(85075),i=n(95660),a=n(83144),s="toString",o=/./.toString,u=function(e){n(69593)(RegExp.prototype,s,e,!0)};n(10496)((function(){return"/a/b"!=o.call({source:"a",flags:"b"})}))?u((function(){var e=r(this);return"/".concat(e.source,"/","flags"in e?e.flags:!a&&e instanceof RegExp?i.call(e):void 0)})):o.name!=s&&u((function(){return o.call(this)}))},59594:(e,t,n)=>{"use strict";var r=n(37647),i=n(51554);e.exports=n(8107)("Set",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return r.def(i(this,"Set"),e=0===e?0:e,e)}},r)},13583:(e,t,n)=>{"use strict";n(47742)("anchor",(function(e){return function(t){return e(this,"a","name",t)}}))},24234:(e,t,n)=>{"use strict";n(47742)("big",(function(e){return function(){return e(this,"big","","")}}))},76853:(e,t,n)=>{"use strict";n(47742)("blink",(function(e){return function(){return e(this,"blink","","")}}))},95165:(e,t,n)=>{"use strict";n(47742)("bold",(function(e){return function(){return e(this,"b","","")}}))},90730:(e,t,n)=>{"use strict";var r=n(61693),i=n(25454)(!1);r(r.P,"String",{codePointAt:function(e){return i(this,e)}})},83948:(e,t,n)=>{"use strict";var r=n(61693),i=n(15263),a=n(31452),s="endsWith",o="".endsWith;r(r.P+r.F*n(90528)(s),"String",{endsWith:function(e){var t=a(this,e,s),n=arguments.length>1?arguments[1]:void 0,r=i(t.length),u=void 0===n?r:Math.min(i(n),r),l=String(e);return o?o.call(t,l,u):t.slice(u-l.length,u)===l}})},44050:(e,t,n)=>{"use strict";n(47742)("fixed",(function(e){return function(){return e(this,"tt","","")}}))},7868:(e,t,n)=>{"use strict";n(47742)("fontcolor",(function(e){return function(t){return e(this,"font","color",t)}}))},41191:(e,t,n)=>{"use strict";n(47742)("fontsize",(function(e){return function(t){return e(this,"font","size",t)}}))},33684:(e,t,n)=>{var r=n(61693),i=n(39519),a=String.fromCharCode,s=String.fromCodePoint;r(r.S+r.F*(!!s&&1!=s.length),"String",{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,s=0;r>s;){if(t=+arguments[s++],i(t,1114111)!==t)throw RangeError(t+" is not a valid code point");n.push(t<65536?a(t):a(55296+((t-=65536)>>10),t%1024+56320))}return n.join("")}})},24487:(e,t,n)=>{"use strict";var r=n(61693),i=n(31452),a="includes";r(r.P+r.F*n(90528)(a),"String",{includes:function(e){return!!~i(this,e,a).indexOf(e,arguments.length>1?arguments[1]:void 0)}})},65220:(e,t,n)=>{"use strict";n(47742)("italics",(function(e){return function(){return e(this,"i","","")}}))},11872:(e,t,n)=>{"use strict";var r=n(25454)(!0);n(15706)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})}))},81644:(e,t,n)=>{"use strict";n(47742)("link",(function(e){return function(t){return e(this,"a","href",t)}}))},96373:(e,t,n)=>{var r=n(61693),i=n(76282),a=n(15263);r(r.S,"String",{raw:function(e){for(var t=i(e.raw),n=a(t.length),r=arguments.length,s=[],o=0;n>o;)s.push(String(t[o++])),o<r&&s.push(String(arguments[o]));return s.join("")}})},92778:(e,t,n)=>{var r=n(61693);r(r.P,"String",{repeat:n(23874)})},34609:(e,t,n)=>{"use strict";n(47742)("small",(function(e){return function(){return e(this,"small","","")}}))},51390:(e,t,n)=>{"use strict";var r=n(61693),i=n(15263),a=n(31452),s="startsWith",o="".startsWith;r(r.P+r.F*n(90528)(s),"String",{startsWith:function(e){var t=a(this,e,s),n=i(Math.min(arguments.length>1?arguments[1]:void 0,t.length)),r=String(e);return o?o.call(t,r,n):t.slice(n,n+r.length)===r}})},91627:(e,t,n)=>{"use strict";n(47742)("strike",(function(e){return function(){return e(this,"strike","","")}}))},8942:(e,t,n)=>{"use strict";n(47742)("sub",(function(e){return function(){return e(this,"sub","","")}}))},98325:(e,t,n)=>{"use strict";n(47742)("sup",(function(e){return function(){return e(this,"sup","","")}}))},82067:(e,t,n)=>{"use strict";n(25480)("trim",(function(e){return function(){return e(this,3)}}))},70107:(e,t,n)=>{"use strict";var r=n(24405),i=n(83050),a=n(83144),s=n(61693),o=n(69593),u=n(18648).KEY,l=n(10496),c=n(47104),d=n(25572),h=n(7767),f=n(64410),p=n(63438),g=n(94519),m=n(86522),y=n(63623),v=n(85075),b=n(49708),x=n(16040),w=n(76282),k=n(23825),_=n(33388),S=n(6088),C=n(73233),A=n(99015),E=n(68910),F=n(24213),I=n(31126),D=A.f,N=F.f,$=C.f,T=r.Symbol,O=r.JSON,M=O&&O.stringify,R=f("_hidden"),B=f("toPrimitive"),z={}.propertyIsEnumerable,L=c("symbol-registry"),P=c("symbols"),j=c("op-symbols"),U=Object.prototype,W="function"==typeof T&&!!E.f,V=r.QObject,G=!V||!V.prototype||!V.prototype.findChild,q=a&&l((function(){return 7!=S(N({},"a",{get:function(){return N(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=D(U,t);r&&delete U[t],N(e,t,n),r&&e!==U&&N(U,t,r)}:N,H=function(e){var t=P[e]=S(T.prototype);return t._k=e,t},X=W&&"symbol"==typeof T.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof T},K=function(e,t,n){return e===U&&K(j,t,n),v(e),t=k(t,!0),v(n),i(P,t)?(n.enumerable?(i(e,R)&&e[R][t]&&(e[R][t]=!1),n=S(n,{enumerable:_(0,!1)})):(i(e,R)||N(e,R,_(1,{})),e[R][t]=!0),q(e,t,n)):N(e,t,n)},Y=function(e,t){v(e);for(var n,r=m(t=w(t)),i=0,a=r.length;a>i;)K(e,n=r[i++],t[n]);return e},Q=function(e){var t=z.call(this,e=k(e,!0));return!(this===U&&i(P,e)&&!i(j,e))&&(!(t||!i(this,e)||!i(P,e)||i(this,R)&&this[R][e])||t)},J=function(e,t){if(e=w(e),t=k(t,!0),e!==U||!i(P,t)||i(j,t)){var n=D(e,t);return!n||!i(P,t)||i(e,R)&&e[R][t]||(n.enumerable=!0),n}},Z=function(e){for(var t,n=$(w(e)),r=[],a=0;n.length>a;)i(P,t=n[a++])||t==R||t==u||r.push(t);return r},ee=function(e){for(var t,n=e===U,r=$(n?j:w(e)),a=[],s=0;r.length>s;)!i(P,t=r[s++])||n&&!i(U,t)||a.push(P[t]);return a};W||(o((T=function(){if(this instanceof T)throw TypeError("Symbol is not a constructor!");var e=h(arguments.length>0?arguments[0]:void 0),t=function(n){this===U&&t.call(j,n),i(this,R)&&i(this[R],e)&&(this[R][e]=!1),q(this,e,_(1,n))};return a&&G&&q(U,e,{configurable:!0,set:t}),H(e)}).prototype,"toString",(function(){return this._k})),A.f=J,F.f=K,n(77173).f=C.f=Z,n(2806).f=Q,E.f=ee,a&&!n(14925)&&o(U,"propertyIsEnumerable",Q,!0),p.f=function(e){return H(f(e))}),s(s.G+s.W+s.F*!W,{Symbol:T});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;te.length>ne;)f(te[ne++]);for(var re=I(f.store),ie=0;re.length>ie;)g(re[ie++]);s(s.S+s.F*!W,"Symbol",{for:function(e){return i(L,e+="")?L[e]:L[e]=T(e)},keyFor:function(e){if(!X(e))throw TypeError(e+" is not a symbol!");for(var t in L)if(L[t]===e)return t},useSetter:function(){G=!0},useSimple:function(){G=!1}}),s(s.S+s.F*!W,"Object",{create:function(e,t){return void 0===t?S(e):Y(S(e),t)},defineProperty:K,defineProperties:Y,getOwnPropertyDescriptor:J,getOwnPropertyNames:Z,getOwnPropertySymbols:ee});var ae=l((function(){E.f(1)}));s(s.S+s.F*ae,"Object",{getOwnPropertySymbols:function(e){return E.f(x(e))}}),O&&s(s.S+s.F*(!W||l((function(){var e=T();return"[null]"!=M([e])||"{}"!=M({a:e})||"{}"!=M(Object(e))}))),"JSON",{stringify:function(e){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=t=r[1],(b(t)||void 0!==e)&&!X(e))return y(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!X(t))return t}),r[1]=t,M.apply(O,r)}}),T.prototype[B]||n(74461)(T.prototype,B,T.prototype.valueOf),d(T,"Symbol"),d(Math,"Math",!0),d(r.JSON,"JSON",!0)},27955:(e,t,n)=>{"use strict";var r=n(61693),i=n(76331),a=n(7050),s=n(85075),o=n(39519),u=n(15263),l=n(49708),c=n(24405).ArrayBuffer,d=n(33611),h=a.ArrayBuffer,f=a.DataView,p=i.ABV&&c.isView,g=h.prototype.slice,m=i.VIEW,y="ArrayBuffer";r(r.G+r.W+r.F*(c!==h),{ArrayBuffer:h}),r(r.S+r.F*!i.CONSTR,y,{isView:function(e){return p&&p(e)||l(e)&&m in e}}),r(r.P+r.U+r.F*n(10496)((function(){return!new h(2).slice(1,void 0).byteLength})),y,{slice:function(e,t){if(void 0!==g&&void 0===t)return g.call(s(this),e);for(var n=s(this).byteLength,r=o(e,n),i=o(void 0===t?n:t,n),a=new(d(this,h))(u(i-r)),l=new f(this),c=new f(a),p=0;r<i;)c.setUint8(p++,l.getUint8(r++));return a}}),n(72373)(y)},24879:(e,t,n)=>{var r=n(61693);r(r.G+r.W+r.F*!n(76331).ABV,{DataView:n(7050).DataView})},47117:(e,t,n)=>{n(33412)("Float32",4,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},41370:(e,t,n)=>{n(33412)("Float64",8,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},20157:(e,t,n)=>{n(33412)("Int16",2,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},42634:(e,t,n)=>{n(33412)("Int32",4,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},75275:(e,t,n)=>{n(33412)("Int8",1,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},62099:(e,t,n)=>{n(33412)("Uint16",2,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},53463:(e,t,n)=>{n(33412)("Uint32",4,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},23411:(e,t,n)=>{n(33412)("Uint8",1,(function(e){return function(t,n,r){return e(this,t,n,r)}}))},79163:(e,t,n)=>{n(33412)("Uint8",1,(function(e){return function(t,n,r){return e(this,t,n,r)}}),!0)},86189:(e,t,n)=>{"use strict";var r,i=n(24405),a=n(13635)(0),s=n(69593),o=n(18648),u=n(92075),l=n(78348),c=n(49708),d=n(51554),h=n(51554),f=!i.ActiveXObject&&"ActiveXObject"in i,p="WeakMap",g=o.getWeak,m=Object.isExtensible,y=l.ufstore,v=function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},b={get:function(e){if(c(e)){var t=g(e);return!0===t?y(d(this,p)).get(e):t?t[this._i]:void 0}},set:function(e,t){return l.def(d(this,p),e,t)}},x=e.exports=n(8107)(p,v,b,l,!0,!0);h&&f&&(u((r=l.getConstructor(v,p)).prototype,b),o.NEED=!0,a(["delete","has","get","set"],(function(e){var t=x.prototype,n=t[e];s(t,e,(function(t,i){if(c(t)&&!m(t)){this._f||(this._f=new r);var a=this._f[e](t,i);return"set"==e?this:a}return n.call(this,t,i)}))})))},16937:(e,t,n)=>{"use strict";var r=n(78348),i=n(51554),a="WeakSet";n(8107)(a,(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return r.def(i(this,a),e,!0)}},r,!1,!0)},83570:(e,t,n)=>{"use strict";var r=n(61693),i=n(84225),a=n(16040),s=n(15263),o=n(50666),u=n(42143);r(r.P,"Array",{flatMap:function(e){var t,n,r=a(this);return o(e),t=s(r.length),n=u(r,0),i(n,r,r,t,0,1,e,arguments[1]),n}}),n(17296)("flatMap")},81625:(e,t,n)=>{"use strict";var r=n(61693),i=n(84225),a=n(16040),s=n(15263),o=n(94058),u=n(42143);r(r.P,"Array",{flatten:function(){var e=arguments[0],t=a(this),n=s(t.length),r=u(t,0);return i(r,t,t,n,0,void 0===e?1:o(e)),r}}),n(17296)("flatten")},58347:(e,t,n)=>{"use strict";var r=n(61693),i=n(64513)(!0);r(r.P,"Array",{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(17296)("includes")},38553:(e,t,n)=>{var r=n(61693),i=n(32583)(),a=n(24405).process,s="process"==n(42380)(a);r(r.G,{asap:function(e){var t=s&&a.domain;i(t?t.bind(e):e)}})},90826:(e,t,n)=>{var r=n(61693),i=n(42380);r(r.S,"Error",{isError:function(e){return"Error"===i(e)}})},23499:(e,t,n)=>{var r=n(61693);r(r.G,{global:n(24405)})},45865:(e,t,n)=>{n(50578)("Map")},68920:(e,t,n)=>{n(20147)("Map")},95745:(e,t,n)=>{var r=n(61693);r(r.P+r.R,"Map",{toJSON:n(72935)("Map")})},13588:(e,t,n)=>{var r=n(61693);r(r.S,"Math",{clamp:function(e,t,n){return Math.min(n,Math.max(t,e))}})},4607:(e,t,n)=>{var r=n(61693);r(r.S,"Math",{DEG_PER_RAD:Math.PI/180})},63874:(e,t,n)=>{var r=n(61693),i=180/Math.PI;r(r.S,"Math",{degrees:function(e){return e*i}})},95657:(e,t,n)=>{var r=n(61693),i=n(64917),a=n(88961);r(r.S,"Math",{fscale:function(e,t,n,r,s){return a(i(e,t,n,r,s))}})},89252:(e,t,n)=>{var r=n(61693);r(r.S,"Math",{iaddh:function(e,t,n,r){var i=e>>>0,a=n>>>0;return(t>>>0)+(r>>>0)+((i&a|(i|a)&~(i+a>>>0))>>>31)|0}})},83548:(e,t,n)=>{var r=n(61693);r(r.S,"Math",{imulh:function(e,t){var n=65535,r=+e,i=+t,a=r&n,s=i&n,o=r>>16,u=i>>16,l=(o*s>>>0)+(a*s>>>16);return o*u+(l>>16)+((a*u>>>0)+(l&n)>>16)}})},89295:(e,t,n)=>{var r=n(61693);r(r.S,"Math",{isubh:function(e,t,n,r){var i=e>>>0,a=n>>>0;return(t>>>0)-(r>>>0)-((~i&a|~(i^a)&i-a>>>0)>>>31)|0}})},6577:(e,t,n)=>{var r=n(61693);r(r.S,"Math",{RAD_PER_DEG:180/Math.PI})},95914:(e,t,n)=>{var r=n(61693),i=Math.PI/180;r(r.S,"Math",{radians:function(e){return e*i}})},24100:(e,t,n)=>{var r=n(61693);r(r.S,"Math",{scale:n(64917)})},90598:(e,t,n)=>{var r=n(61693);r(r.S,"Math",{signbit:function(e){return(e=+e)!=e?e:0==e?1/e==1/0:e>0}})},47151:(e,t,n)=>{var r=n(61693);r(r.S,"Math",{umulh:function(e,t){var n=65535,r=+e,i=+t,a=r&n,s=i&n,o=r>>>16,u=i>>>16,l=(o*s>>>0)+(a*s>>>16);return o*u+(l>>>16)+((a*u>>>0)+(l&n)>>>16)}})},14255:(e,t,n)=>{"use strict";var r=n(61693),i=n(16040),a=n(50666),s=n(24213);n(83144)&&r(r.P+n(42296),"Object",{__defineGetter__:function(e,t){s.f(i(this),e,{get:a(t),enumerable:!0,configurable:!0})}})},71346:(e,t,n)=>{"use strict";var r=n(61693),i=n(16040),a=n(50666),s=n(24213);n(83144)&&r(r.P+n(42296),"Object",{__defineSetter__:function(e,t){s.f(i(this),e,{set:a(t),enumerable:!0,configurable:!0})}})},33788:(e,t,n)=>{var r=n(61693),i=n(72133)(!0);r(r.S,"Object",{entries:function(e){return i(e)}})},9872:(e,t,n)=>{var r=n(61693),i=n(2275),a=n(76282),s=n(99015),o=n(72559);r(r.S,"Object",{getOwnPropertyDescriptors:function(e){for(var t,n,r=a(e),u=s.f,l=i(r),c={},d=0;l.length>d;)void 0!==(n=u(r,t=l[d++]))&&o(c,t,n);return c}})},8987:(e,t,n)=>{"use strict";var r=n(61693),i=n(16040),a=n(23825),s=n(88539),o=n(99015).f;n(83144)&&r(r.P+n(42296),"Object",{__lookupGetter__:function(e){var t,n=i(this),r=a(e,!0);do{if(t=o(n,r))return t.get}while(n=s(n))}})},6605:(e,t,n)=>{"use strict";var r=n(61693),i=n(16040),a=n(23825),s=n(88539),o=n(99015).f;n(83144)&&r(r.P+n(42296),"Object",{__lookupSetter__:function(e){var t,n=i(this),r=a(e,!0);do{if(t=o(n,r))return t.set}while(n=s(n))}})},92094:(e,t,n)=>{var r=n(61693),i=n(72133)(!1);r(r.S,"Object",{values:function(e){return i(e)}})},41071:(e,t,n)=>{"use strict";var r=n(61693),i=n(24405),a=n(48080),s=n(32583)(),o=n(64410)("observable"),u=n(50666),l=n(85075),c=n(30269),d=n(33227),h=n(74461),f=n(74036),p=f.RETURN,g=function(e){return null==e?void 0:u(e)},m=function(e){var t=e._c;t&&(e._c=void 0,t())},y=function(e){return void 0===e._o},v=function(e){y(e)||(e._o=void 0,m(e))},b=function(e,t){l(e),this._c=void 0,this._o=e,e=new x(this);try{var n=t(e),r=n;null!=n&&("function"==typeof n.unsubscribe?n=function(){r.unsubscribe()}:u(n),this._c=n)}catch(t){return void e.error(t)}y(this)&&m(this)};b.prototype=d({},{unsubscribe:function(){v(this)}});var x=function(e){this._s=e};x.prototype=d({},{next:function(e){var t=this._s;if(!y(t)){var n=t._o;try{var r=g(n.next);if(r)return r.call(n,e)}catch(e){try{v(t)}finally{throw e}}}},error:function(e){var t=this._s;if(y(t))throw e;var n=t._o;t._o=void 0;try{var r=g(n.error);if(!r)throw e;e=r.call(n,e)}catch(e){try{m(t)}finally{throw e}}return m(t),e},complete:function(e){var t=this._s;if(!y(t)){var n=t._o;t._o=void 0;try{var r=g(n.complete);e=r?r.call(n,e):void 0}catch(e){try{m(t)}finally{throw e}}return m(t),e}}});var w=function(e){c(this,w,"Observable","_f")._f=u(e)};d(w.prototype,{subscribe:function(e){return new b(e,this._f)},forEach:function(e){var t=this;return new(a.Promise||i.Promise)((function(n,r){u(e);var i=t.subscribe({next:function(t){try{return e(t)}catch(e){r(e),i.unsubscribe()}},error:r,complete:n})}))}}),d(w,{from:function(e){var t="function"==typeof this?this:w,n=g(l(e)[o]);if(n){var r=l(n.call(e));return r.constructor===t?r:new t((function(e){return r.subscribe(e)}))}return new t((function(t){var n=!1;return s((function(){if(!n){try{if(f(e,!1,(function(e){if(t.next(e),n)return p}))===p)return}catch(e){if(n)throw e;return void t.error(e)}t.complete()}})),function(){n=!0}}))},of:function(){for(var e=0,t=arguments.length,n=new Array(t);e<t;)n[e]=arguments[e++];return new("function"==typeof this?this:w)((function(e){var t=!1;return s((function(){if(!t){for(var r=0;r<n.length;++r)if(e.next(n[r]),t)return;e.complete()}})),function(){t=!0}}))}}),h(w.prototype,o,(function(){return this})),r(r.G,{Observable:w}),n(72373)("Observable")},57752:(e,t,n)=>{"use strict";var r=n(61693),i=n(48080),a=n(24405),s=n(33611),o=n(99894);r(r.P+r.R,"Promise",{finally:function(e){var t=s(this,i.Promise||a.Promise),n="function"==typeof e;return this.then(n?function(n){return o(t,e()).then((function(){return n}))}:e,n?function(n){return o(t,e()).then((function(){throw n}))}:e)}})},24243:(e,t,n)=>{"use strict";var r=n(61693),i=n(12219),a=n(24552);r(r.S,"Promise",{try:function(e){var t=i.f(this),n=a(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},17551:(e,t,n)=>{var r=n(70380),i=n(85075),a=r.key,s=r.set;r.exp({defineMetadata:function(e,t,n,r){s(e,t,i(n),a(r))}})},76157:(e,t,n)=>{var r=n(70380),i=n(85075),a=r.key,s=r.map,o=r.store;r.exp({deleteMetadata:function(e,t){var n=arguments.length<3?void 0:a(arguments[2]),r=s(i(t),n,!1);if(void 0===r||!r.delete(e))return!1;if(r.size)return!0;var u=o.get(t);return u.delete(n),!!u.size||o.delete(t)}})},73806:(e,t,n)=>{var r=n(59594),i=n(59315),a=n(70380),s=n(85075),o=n(88539),u=a.keys,l=a.key,c=function(e,t){var n=u(e,t),a=o(e);if(null===a)return n;var s=c(a,t);return s.length?n.length?i(new r(n.concat(s))):s:n};a.exp({getMetadataKeys:function(e){return c(s(e),arguments.length<2?void 0:l(arguments[1]))}})},10929:(e,t,n)=>{var r=n(70380),i=n(85075),a=n(88539),s=r.has,o=r.get,u=r.key,l=function(e,t,n){if(s(e,t,n))return o(e,t,n);var r=a(t);return null!==r?l(e,r,n):void 0};r.exp({getMetadata:function(e,t){return l(e,i(t),arguments.length<3?void 0:u(arguments[2]))}})},70314:(e,t,n)=>{var r=n(70380),i=n(85075),a=r.keys,s=r.key;r.exp({getOwnMetadataKeys:function(e){return a(i(e),arguments.length<2?void 0:s(arguments[1]))}})},63440:(e,t,n)=>{var r=n(70380),i=n(85075),a=r.get,s=r.key;r.exp({getOwnMetadata:function(e,t){return a(e,i(t),arguments.length<3?void 0:s(arguments[2]))}})},39352:(e,t,n)=>{var r=n(70380),i=n(85075),a=n(88539),s=r.has,o=r.key,u=function(e,t,n){if(s(e,t,n))return!0;var r=a(t);return null!==r&&u(e,r,n)};r.exp({hasMetadata:function(e,t){return u(e,i(t),arguments.length<3?void 0:o(arguments[2]))}})},18285:(e,t,n)=>{var r=n(70380),i=n(85075),a=r.has,s=r.key;r.exp({hasOwnMetadata:function(e,t){return a(e,i(t),arguments.length<3?void 0:s(arguments[2]))}})},42541:(e,t,n)=>{var r=n(70380),i=n(85075),a=n(50666),s=r.key,o=r.set;r.exp({metadata:function(e,t){return function(n,r){o(e,t,(void 0!==r?i:a)(n),s(r))}}})},58906:(e,t,n)=>{n(50578)("Set")},85127:(e,t,n)=>{n(20147)("Set")},87225:(e,t,n)=>{var r=n(61693);r(r.P+r.R,"Set",{toJSON:n(72935)("Set")})},55747:(e,t,n)=>{"use strict";var r=n(61693),i=n(25454)(!0),a=n(10496)((function(){return""!=="".at(0)}));r(r.P+r.F*a,"String",{at:function(e){return i(this,e)}})},45707:(e,t,n)=>{"use strict";var r=n(61693),i=n(91083),a=n(15263),s=n(70939),o=n(95660),u=RegExp.prototype,l=function(e,t){this._r=e,this._s=t};n(39614)(l,"RegExp String",(function(){var e=this._r.exec(this._s);return{value:e,done:null===e}})),r(r.P,"String",{matchAll:function(e){if(i(this),!s(e))throw TypeError(e+" is not a regexp!");var t=String(this),n="flags"in u?String(e.flags):o.call(e),r=new RegExp(e.source,~n.indexOf("g")?n:"g"+n);return r.lastIndex=a(e.lastIndex),new l(r,t)}})},91409:(e,t,n)=>{"use strict";var r=n(61693),i=n(26687),a=n(97860),s=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(a);r(r.P+r.F*s,"String",{padEnd:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!1)}})},90304:(e,t,n)=>{"use strict";var r=n(61693),i=n(26687),a=n(97860),s=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(a);r(r.P+r.F*s,"String",{padStart:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!0)}})},27066:(e,t,n)=>{"use strict";n(25480)("trimLeft",(function(e){return function(){return e(this,1)}}),"trimStart")},33255:(e,t,n)=>{"use strict";n(25480)("trimRight",(function(e){return function(){return e(this,2)}}),"trimEnd")},94757:(e,t,n)=>{n(94519)("asyncIterator")},97414:(e,t,n)=>{n(94519)("observable")},51178:(e,t,n)=>{var r=n(61693);r(r.S,"System",{global:n(24405)})},66006:(e,t,n)=>{n(50578)("WeakMap")},59676:(e,t,n)=>{n(20147)("WeakMap")},1743:(e,t,n)=>{n(50578)("WeakSet")},69026:(e,t,n)=>{n(20147)("WeakSet")},89635:(e,t,n)=>{for(var r=n(66172),i=n(31126),a=n(69593),s=n(24405),o=n(74461),u=n(47985),l=n(64410),c=l("iterator"),d=l("toStringTag"),h=u.Array,f={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=i(f),g=0;g<p.length;g++){var m,y=p[g],v=f[y],b=s[y],x=b&&b.prototype;if(x&&(x[c]||o(x,c,h),x[d]||o(x,d,y),u[y]=h,v))for(m in r)x[m]||a(x,m,r[m],!0)}},37761:(e,t,n)=>{var r=n(61693),i=n(21597);r(r.G+r.B,{setImmediate:i.set,clearImmediate:i.clear})},39736:(e,t,n)=>{var r=n(24405),i=n(61693),a=n(97860),s=[].slice,o=/MSIE .\./.test(a),u=function(e){return function(t,n){var r=arguments.length>2,i=!!r&&s.call(arguments,2);return e(r?function(){("function"==typeof t?t:Function(t)).apply(this,i)}:t,n)}};i(i.G+i.B+i.F*o,{setTimeout:u(r.setTimeout),setInterval:u(r.setInterval)})},87931:(e,t,n)=>{n(70107),n(67031),n(48892),n(13073),n(80476),n(27771),n(950),n(18899),n(84925),n(80585),n(84058),n(71263),n(72875),n(52395),n(32680),n(84177),n(26548),n(6268),n(67442),n(6278),n(27998),n(15291),n(84212),n(15434),n(77967),n(3552),n(84412),n(17993),n(41755),n(85390),n(40352),n(40526),n(60708),n(22360),n(25114),n(96367),n(87345),n(79471),n(55890),n(88299),n(89286),n(8240),n(41050),n(88246),n(19349),n(95159),n(83158),n(17521),n(92565),n(48337),n(18582),n(62310),n(33684),n(96373),n(82067),n(11872),n(90730),n(83948),n(24487),n(92778),n(51390),n(13583),n(24234),n(76853),n(95165),n(44050),n(7868),n(41191),n(65220),n(81644),n(34609),n(91627),n(8942),n(98325),n(22330),n(56665),n(22943),n(8616),n(61002),n(82550),n(79731),n(40745),n(65956),n(56149),n(32106),n(19946),n(92369),n(18931),n(24135),n(26075),n(9662),n(53565),n(29209),n(72733),n(79440),n(15588),n(66233),n(45294),n(95324),n(66172),n(41544),n(47515),n(80223),n(15155),n(94675),n(21983),n(96285),n(92467),n(92229),n(29164),n(59594),n(86189),n(16937),n(27955),n(24879),n(75275),n(23411),n(79163),n(20157),n(62099),n(42634),n(53463),n(47117),n(41370),n(39757),n(28545),n(13451),n(93735),n(16012),n(39849),n(13806),n(29063),n(71111),n(42413),n(17098),n(2294),n(29920),n(36938),n(58347),n(83570),n(81625),n(55747),n(90304),n(91409),n(27066),n(33255),n(45707),n(94757),n(97414),n(9872),n(92094),n(33788),n(14255),n(71346),n(8987),n(6605),n(95745),n(87225),n(68920),n(85127),n(59676),n(69026),n(45865),n(58906),n(66006),n(1743),n(23499),n(51178),n(90826),n(13588),n(4607),n(63874),n(95657),n(89252),n(89295),n(83548),n(6577),n(95914),n(24100),n(47151),n(90598),n(57752),n(24243),n(17551),n(76157),n(10929),n(73806),n(63440),n(70314),n(39352),n(18285),n(42541),n(38553),n(41071),n(39736),n(37761),n(89635),e.exports=n(48080)},95654:function(e,t,n){!function(t){"use strict";var n,r=Object.prototype,i=r.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag",l=t.regeneratorRuntime;if(l)e.exports=l;else{(l=t.regeneratorRuntime=e.exports).wrap=b;var c="suspendedStart",d="suspendedYield",h="executing",f="completed",p={},g={};g[s]=function(){return this};var m=Object.getPrototypeOf,y=m&&m(m(D([])));y&&y!==r&&i.call(y,s)&&(g=y);var v=_.prototype=w.prototype=Object.create(g);k.prototype=v.constructor=_,_.constructor=k,_[u]=k.displayName="GeneratorFunction",l.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===k||"GeneratorFunction"===(t.displayName||t.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,u in e||(e[u]="GeneratorFunction")),e.prototype=Object.create(v),e},l.awrap=function(e){return{__await:e}},S(C.prototype),C.prototype[o]=function(){return this},l.AsyncIterator=C,l.async=function(e,t,n,r){var i=new C(b(e,t,n,r));return l.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(v),v[u]="Generator",v[s]=function(){return this},v.toString=function(){return"[object Generator]"},l.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},l.values=D,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(F),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,i){return o.type="throw",o.arg=e,t.next=r,i&&(t.method="next",t.arg=n),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a],o=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var u=i.call(s,"catchLoc"),l=i.call(s,"finallyLoc");if(u&&l){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(u){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,p):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),F(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;F(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:D(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),p}}}function b(e,t,n,r){var i=t&&t.prototype instanceof w?t:w,a=Object.create(i.prototype),s=new I(r||[]);return a._invoke=function(e,t,n){var r=c;return function(i,a){if(r===h)throw new Error("Generator is already running");if(r===f){if("throw"===i)throw a;return N()}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var o=A(s,n);if(o){if(o===p)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===c)throw r=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var u=x(e,t,n);if("normal"===u.type){if(r=n.done?f:d,u.arg===p)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=f,n.method="throw",n.arg=u.arg)}}}(e,n,s),a}function x(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function w(){}function k(){}function _(){}function S(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function C(e){function n(t,r,a,s){var o=x(e[t],e,r);if("throw"!==o.type){var u=o.arg,l=u.value;return l&&"object"==typeof l&&i.call(l,"__await")?Promise.resolve(l.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):Promise.resolve(l).then((function(e){u.value=e,a(u)}),s)}s(o.arg)}var r;"object"==typeof t.process&&t.process.domain&&(n=t.process.domain.bind(n)),this._invoke=function(e,t){function i(){return new Promise((function(r,i){n(e,t,r,i)}))}return r=r?r.then(i,i):i()}}function A(e,t){var r=e.iterator[t.method];if(r===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,A(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var i=x(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,p;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,p):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function F(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function D(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=n,t.done=!0,t};return a.next=a}}return{next:N}}function N(){return{value:n,done:!0}}}("object"==typeof n.g?n.g:"object"==typeof window?window:"object"==typeof self?self:this)},16313:e=>{var t=function(){"use strict";function e(e,t){return null!=t&&e instanceof t}var t,n,r;try{t=Map}catch(e){t=function(){}}try{n=Set}catch(e){n=function(){}}try{r=Promise}catch(e){r=function(){}}function i(a,o,u,l,c){"object"==typeof o&&(u=o.depth,l=o.prototype,c=o.includeNonEnumerable,o=o.circular);var d=[],h=[],f="undefined"!=typeof Buffer;return void 0===o&&(o=!0),void 0===u&&(u=1/0),function a(u,p){if(null===u)return null;if(0===p)return u;var g,m;if("object"!=typeof u)return u;if(e(u,t))g=new t;else if(e(u,n))g=new n;else if(e(u,r))g=new r((function(e,t){u.then((function(t){e(a(t,p-1))}),(function(e){t(a(e,p-1))}))}));else if(i.__isArray(u))g=[];else if(i.__isRegExp(u))g=new RegExp(u.source,s(u)),u.lastIndex&&(g.lastIndex=u.lastIndex);else if(i.__isDate(u))g=new Date(u.getTime());else{if(f&&Buffer.isBuffer(u))return g=Buffer.allocUnsafe?Buffer.allocUnsafe(u.length):new Buffer(u.length),u.copy(g),g;e(u,Error)?g=Object.create(u):void 0===l?(m=Object.getPrototypeOf(u),g=Object.create(m)):(g=Object.create(l),m=l)}if(o){var y=d.indexOf(u);if(-1!=y)return h[y];d.push(u),h.push(g)}for(var v in e(u,t)&&u.forEach((function(e,t){var n=a(t,p-1),r=a(e,p-1);g.set(n,r)})),e(u,n)&&u.forEach((function(e){var t=a(e,p-1);g.add(t)})),u){var b;m&&(b=Object.getOwnPropertyDescriptor(m,v)),b&&null==b.set||(g[v]=a(u[v],p-1))}if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(u);for(v=0;v<x.length;v++){var w=x[v];(!(_=Object.getOwnPropertyDescriptor(u,w))||_.enumerable||c)&&(g[w]=a(u[w],p-1),_.enumerable||Object.defineProperty(g,w,{enumerable:!1}))}}if(c){var k=Object.getOwnPropertyNames(u);for(v=0;v<k.length;v++){var _,S=k[v];(_=Object.getOwnPropertyDescriptor(u,S))&&_.enumerable||(g[S]=a(u[S],p-1),Object.defineProperty(g,S,{enumerable:!1}))}}return g}(a,u)}function a(e){return Object.prototype.toString.call(e)}function s(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return i.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},i.__objToStr=a,i.__isDate=function(e){return"object"==typeof e&&"[object Date]"===a(e)},i.__isArray=function(e){return"object"==typeof e&&"[object Array]"===a(e)},i.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===a(e)},i.__getRegExpFlags=s,i}();e.exports&&(e.exports=t)},16238:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,i.default)(e)};var r,i=(r=n(25477))&&r.__esModule?r:{default:r};e.exports=t.default},50638:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return"string"==typeof e&&n.test(e)};var n=/-webkit-|-moz-|-ms-/;e.exports=t.default},16722:(e,t,n)=>{"use strict";function r(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function i(e){return(e=r(Math.abs(e)))?e[1]:NaN}n.r(t),n.d(t,{format:()=>f,formatDefaultLocale:()=>y,formatLocale:()=>m,formatPrefix:()=>p,formatSpecifier:()=>o,precisionFixed:()=>v,precisionPrefix:()=>b,precisionRound:()=>x});var a,s=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function o(e){return new u(e)}function u(e){if(!(t=s.exec(e)))throw new Error("invalid format: "+e);var t;this.fill=t[1]||" ",this.align=t[2]||">",this.sign=t[3]||"-",this.symbol=t[4]||"",this.zero=!!t[5],this.width=t[6]&&+t[6],this.comma=!!t[7],this.precision=t[8]&&+t[8].slice(1),this.trim=!!t[9],this.type=t[10]||""}function l(e,t){var n=r(e,t);if(!n)return e+"";var i=n[0],a=n[1];return a<0?"0."+new Array(-a).join("0")+i:i.length>a+1?i.slice(0,a+1)+"."+i.slice(a+1):i+new Array(a-i.length+2).join("0")}o.prototype=u.prototype,u.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(null==this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(null==this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const c={"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.round(e).toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return l(100*e,t)},r:l,s:function(e,t){var n=r(e,t);if(!n)return e+"";var i=n[0],s=n[1],o=s-(a=3*Math.max(-8,Math.min(8,Math.floor(s/3))))+1,u=i.length;return o===u?i:o>u?i+new Array(o-u+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+r(e,Math.max(0,t+o-1))[0]},X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function d(e){return e}var h,f,p,g=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function m(e){var t,n,r=e.grouping&&e.thousands?(t=e.grouping,n=e.thousands,function(e,r){for(var i=e.length,a=[],s=0,o=t[0],u=0;i>0&&o>0&&(u+o+1>r&&(o=Math.max(1,r-u)),a.push(e.substring(i-=o,i+o)),!((u+=o+1)>r));)o=t[s=(s+1)%t.length];return a.reverse().join(n)}):d,s=e.currency,u=e.decimal,l=e.numerals?function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(e.numerals):d,h=e.percent||"%";function f(e){var t=(e=o(e)).fill,n=e.align,i=e.sign,d=e.symbol,f=e.zero,p=e.width,m=e.comma,y=e.precision,v=e.trim,b=e.type;"n"===b?(m=!0,b="g"):c[b]||(null==y&&(y=12),v=!0,b="g"),(f||"0"===t&&"="===n)&&(f=!0,t="0",n="=");var x="$"===d?s[0]:"#"===d&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",w="$"===d?s[1]:/[%p]/.test(b)?h:"",k=c[b],_=/[defgprs%]/.test(b);function S(e){var s,o,c,d=x,h=w;if("c"===b)h=k(e)+h,e="";else{var S=(e=+e)<0;if(e=k(Math.abs(e),y),v&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(i>0){if(!+e[r])break e;i=0}}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),S&&0==+e&&(S=!1),d=(S?"("===i?i:"-":"-"===i||"("===i?"":i)+d,h=("s"===b?g[8+a/3]:"")+h+(S&&"("===i?")":""),_)for(s=-1,o=e.length;++s<o;)if(48>(c=e.charCodeAt(s))||c>57){h=(46===c?u+e.slice(s+1):e.slice(s))+h,e=e.slice(0,s);break}}m&&!f&&(e=r(e,1/0));var C=d.length+e.length+h.length,A=C<p?new Array(p-C+1).join(t):"";switch(m&&f&&(e=r(A+e,A.length?p-h.length:1/0),A=""),n){case"<":e=d+e+h+A;break;case"=":e=d+A+e+h;break;case"^":e=A.slice(0,C=A.length>>1)+d+e+h+A.slice(C);break;default:e=A+d+e+h}return l(e)}return y=null==y?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y)),S.toString=function(){return e+""},S}return{format:f,formatPrefix:function(e,t){var n=f(((e=o(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(i(t)/3))),a=Math.pow(10,-r),s=g[8+r/3];return function(e){return n(a*e)+s}}}}function y(e){return h=m(e),f=h.format,p=h.formatPrefix,h}function v(e){return Math.max(0,-i(Math.abs(e)))}function b(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(i(t)/3)))-i(Math.abs(e)))}function x(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,i(t)-i(e))+1}y({decimal:".",thousands:",",grouping:[3],currency:["$",""]})},54677:(e,t,n)=>{"use strict";n.r(t),n.d(t,{clientPoint:()=>_e,create:()=>ve,creator:()=>u,customEvent:()=>le,event:()=>re,local:()=>xe,matcher:()=>m,mouse:()=>Se,namespace:()=>a,namespaces:()=>i,select:()=>ye,selectAll:()=>Ce,selection:()=>me,selector:()=>c,selectorAll:()=>h,style:()=>$,touch:()=>Ae,touches:()=>Ee,window:()=>F});var r="http://www.w3.org/1999/xhtml";const i={svg:"http://www.w3.org/2000/svg",xhtml:r,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function a(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),i.hasOwnProperty(t)?{space:i[t],local:e}:e}function s(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===r&&t.documentElement.namespaceURI===r?t.createElement(e):t.createElementNS(n,e)}}function o(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function u(e){var t=a(e);return(t.local?o:s)(t)}function l(){}function c(e){return null==e?l:function(){return this.querySelector(e)}}function d(){return[]}function h(e){return null==e?d:function(){return this.querySelectorAll(e)}}var f=function(e){return function(){return this.matches(e)}};if("undefined"!=typeof document){var p=document.documentElement;if(!p.matches){var g=p.webkitMatchesSelector||p.msMatchesSelector||p.mozMatchesSelector||p.oMatchesSelector;f=function(e){return function(){return g.call(this,e)}}}}const m=f;function y(e){return new Array(e.length)}function v(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function b(e,t,n,r,i,a){for(var s,o=0,u=t.length,l=a.length;o<l;++o)(s=t[o])?(s.__data__=a[o],r[o]=s):n[o]=new v(e,a[o]);for(;o<u;++o)(s=t[o])&&(i[o]=s)}function x(e,t,n,r,i,a,s){var o,u,l,c={},d=t.length,h=a.length,f=new Array(d);for(o=0;o<d;++o)(u=t[o])&&(f[o]=l="$"+s.call(u,u.__data__,o,t),l in c?i[o]=u:c[l]=u);for(o=0;o<h;++o)(u=c[l="$"+s.call(e,a[o],o,a)])?(r[o]=u,u.__data__=a[o],c[l]=null):n[o]=new v(e,a[o]);for(o=0;o<d;++o)(u=t[o])&&c[f[o]]===u&&(i[o]=u)}function w(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function k(e){return function(){this.removeAttribute(e)}}function _(e){return function(){this.removeAttributeNS(e.space,e.local)}}function S(e,t){return function(){this.setAttribute(e,t)}}function C(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function A(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function E(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function F(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function I(e){return function(){this.style.removeProperty(e)}}function D(e,t,n){return function(){this.style.setProperty(e,t,n)}}function N(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function $(e,t){return e.style.getPropertyValue(t)||F(e).getComputedStyle(e,null).getPropertyValue(t)}function T(e){return function(){delete this[e]}}function O(e,t){return function(){this[e]=t}}function M(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function R(e){return e.trim().split(/^|\s+/)}function B(e){return e.classList||new z(e)}function z(e){this._node=e,this._names=R(e.getAttribute("class")||"")}function L(e,t){for(var n=B(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function P(e,t){for(var n=B(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function j(e){return function(){L(this,e)}}function U(e){return function(){P(this,e)}}function W(e,t){return function(){(t.apply(this,arguments)?L:P)(this,e)}}function V(){this.textContent=""}function G(e){return function(){this.textContent=e}}function q(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function H(){this.innerHTML=""}function X(e){return function(){this.innerHTML=e}}function K(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function Y(){this.nextSibling&&this.parentNode.appendChild(this)}function Q(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function J(){return null}function Z(){var e=this.parentNode;e&&e.removeChild(this)}function ee(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function te(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}v.prototype={constructor:v,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}},z.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var ne={},re=null;function ie(e,t,n){return e=ae(e,t,n),function(t){var n=t.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||e.call(this,t)}}function ae(e,t,n){return function(r){var i=re;re=r;try{e.call(this,this.__data__,t,n)}finally{re=i}}}function se(e){return e.trim().split(/^|\s+/).map((function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}}))}function oe(e){return function(){var t=this.__on;if(t){for(var n,r=0,i=-1,a=t.length;r<a;++r)n=t[r],e.type&&n.type!==e.type||n.name!==e.name?t[++i]=n:this.removeEventListener(n.type,n.listener,n.capture);++i?t.length=i:delete this.__on}}}function ue(e,t,n){var r=ne.hasOwnProperty(e.type)?ie:ae;return function(i,a,s){var o,u=this.__on,l=r(t,a,s);if(u)for(var c=0,d=u.length;c<d;++c)if((o=u[c]).type===e.type&&o.name===e.name)return this.removeEventListener(o.type,o.listener,o.capture),this.addEventListener(o.type,o.listener=l,o.capture=n),void(o.value=t);this.addEventListener(e.type,l,n),o={type:e.type,name:e.name,value:t,listener:l,capture:n},u?u.push(o):this.__on=[o]}}function le(e,t,n,r){var i=re;e.sourceEvent=re,re=e;try{return t.apply(n,r)}finally{re=i}}function ce(e,t,n){var r=F(e),i=r.CustomEvent;"function"==typeof i?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function de(e,t){return function(){return ce(this,e,t)}}function he(e,t){return function(){return ce(this,e,t.apply(this,arguments))}}"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(ne={mouseenter:"mouseover",mouseleave:"mouseout"}));var fe=[null];function pe(e,t){this._groups=e,this._parents=t}function ge(){return new pe([[document.documentElement]],fe)}pe.prototype=ge.prototype={constructor:pe,select:function(e){"function"!=typeof e&&(e=c(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,s,o=t[i],u=o.length,l=r[i]=new Array(u),d=0;d<u;++d)(a=o[d])&&(s=e.call(a,a.__data__,d,o))&&("__data__"in a&&(s.__data__=a.__data__),l[d]=s);return new pe(r,this._parents)},selectAll:function(e){"function"!=typeof e&&(e=h(e));for(var t=this._groups,n=t.length,r=[],i=[],a=0;a<n;++a)for(var s,o=t[a],u=o.length,l=0;l<u;++l)(s=o[l])&&(r.push(e.call(s,s.__data__,l,o)),i.push(s));return new pe(r,i)},filter:function(e){"function"!=typeof e&&(e=m(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,s=t[i],o=s.length,u=r[i]=[],l=0;l<o;++l)(a=s[l])&&e.call(a,a.__data__,l,s)&&u.push(a);return new pe(r,this._parents)},data:function(e,t){if(!e)return p=new Array(this.size()),c=-1,this.each((function(e){p[++c]=e})),p;var n,r=t?x:b,i=this._parents,a=this._groups;"function"!=typeof e&&(n=e,e=function(){return n});for(var s=a.length,o=new Array(s),u=new Array(s),l=new Array(s),c=0;c<s;++c){var d=i[c],h=a[c],f=h.length,p=e.call(d,d&&d.__data__,c,i),g=p.length,m=u[c]=new Array(g),y=o[c]=new Array(g);r(d,h,m,y,l[c]=new Array(f),p,t);for(var v,w,k=0,_=0;k<g;++k)if(v=m[k]){for(k>=_&&(_=k+1);!(w=y[_])&&++_<g;);v._next=w||null}}return(o=new pe(o,i))._enter=u,o._exit=l,o},enter:function(){return new pe(this._enter||this._groups.map(y),this._parents)},exit:function(){return new pe(this._exit||this._groups.map(y),this._parents)},merge:function(e){for(var t=this._groups,n=e._groups,r=t.length,i=n.length,a=Math.min(r,i),s=new Array(r),o=0;o<a;++o)for(var u,l=t[o],c=n[o],d=l.length,h=s[o]=new Array(d),f=0;f<d;++f)(u=l[f]||c[f])&&(h[f]=u);for(;o<r;++o)s[o]=t[o];return new pe(s,this._parents)},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r,i=e[t],a=i.length-1,s=i[a];--a>=0;)(r=i[a])&&(s&&s!==r.nextSibling&&s.parentNode.insertBefore(r,s),s=r);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=w);for(var n=this._groups,r=n.length,i=new Array(r),a=0;a<r;++a){for(var s,o=n[a],u=o.length,l=i[a]=new Array(u),c=0;c<u;++c)(s=o[c])&&(l[c]=s);l.sort(t)}return new pe(i,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){var e=new Array(this.size()),t=-1;return this.each((function(){e[++t]=this})),e},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,a=r.length;i<a;++i){var s=r[i];if(s)return s}return null},size:function(){var e=0;return this.each((function(){++e})),e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i,a=t[n],s=0,o=a.length;s<o;++s)(i=a[s])&&e.call(i,i.__data__,s,a);return this},attr:function(e,t){var n=a(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?_:k:"function"==typeof t?n.local?E:A:n.local?C:S)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?I:"function"==typeof t?N:D)(e,t,null==n?"":n)):$(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?T:"function"==typeof t?M:O)(e,t)):this.node()[e]},classed:function(e,t){var n=R(e+"");if(arguments.length<2){for(var r=B(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof t?W:t?j:U)(n,t))},text:function(e){return arguments.length?this.each(null==e?V:("function"==typeof e?q:G)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?H:("function"==typeof e?K:X)(e)):this.node().innerHTML},raise:function(){return this.each(Y)},lower:function(){return this.each(Q)},append:function(e){var t="function"==typeof e?e:u(e);return this.select((function(){return this.appendChild(t.apply(this,arguments))}))},insert:function(e,t){var n="function"==typeof e?e:u(e),r=null==t?J:"function"==typeof t?t:c(t);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(Z)},clone:function(e){return this.select(e?te:ee)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var r,i,a=se(e+""),s=a.length;if(!(arguments.length<2)){for(o=t?ue:oe,null==n&&(n=!1),r=0;r<s;++r)this.each(o(a[r],t,n));return this}var o=this.node().__on;if(o)for(var u,l=0,c=o.length;l<c;++l)for(r=0,u=o[l];r<s;++r)if((i=a[r]).type===u.type&&i.name===u.name)return u.value},dispatch:function(e,t){return this.each(("function"==typeof t?he:de)(e,t))}};const me=ge;function ye(e){return"string"==typeof e?new pe([[document.querySelector(e)]],[document.documentElement]):new pe([[e]],fe)}function ve(e){return ye(u(e).call(document.documentElement))}var be=0;function xe(){return new we}function we(){this._="@"+(++be).toString(36)}function ke(){for(var e,t=re;e=t.sourceEvent;)t=e;return t}function _e(e,t){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,[(r=r.matrixTransform(e.getScreenCTM().inverse())).x,r.y]}var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}function Se(e){var t=ke();return t.changedTouches&&(t=t.changedTouches[0]),_e(e,t)}function Ce(e){return"string"==typeof e?new pe([document.querySelectorAll(e)],[document.documentElement]):new pe([null==e?[]:e],fe)}function Ae(e,t,n){arguments.length<3&&(n=t,t=ke().changedTouches);for(var r,i=0,a=t?t.length:0;i<a;++i)if((r=t[i]).identifier===n)return _e(e,r);return null}function Ee(e,t){null==t&&(t=ke().touches);for(var n=0,r=t?t.length:0,i=new Array(r);n<r;++n)i[n]=_e(e,t[n]);return i}we.prototype=xe.prototype={constructor:we,get:function(e){for(var t=this._;!(t in e);)if(!(e=e.parentNode))return;return e[t]},set:function(e,t){return e[this._]=t},remove:function(e){return this._ in e&&delete e[this._]},toString:function(){return this._}}},64063:e=>{"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var r,i,a;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(i=r;0!=i--;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(a=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(i=r;0!=i--;)if(!Object.prototype.hasOwnProperty.call(n,a[i]))return!1;for(i=r;0!=i--;){var s=a[i];if(!e(t[s],n[s]))return!1}return!0}return t!=t&&n!=n}},35035:e=>{"use strict";e.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n,r="boolean"==typeof t.cycles&&t.cycles,i=t.cmp&&(n=t.cmp,function(e){return function(t,r){var i={key:t,value:e[t]},a={key:r,value:e[r]};return n(i,a)}}),a=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var n,s;if(Array.isArray(t)){for(s="[",n=0;n<t.length;n++)n&&(s+=","),s+=e(t[n])||"null";return s+"]"}if(null===t)return"null";if(-1!==a.indexOf(t)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var o=a.push(t)-1,u=Object.keys(t).sort(i&&i(t));for(s="",n=0;n<u.length;n++){var l=u[n],c=e(t[l]);c&&(s&&(s+=","),s+=JSON.stringify(l)+":"+c)}return a.splice(o,1),"{"+s+"}"}}(e)}},52297:e=>{"use strict";var t=/-(.)/g;e.exports=function(e){return e.replace(t,(function(e,t){return t.toUpperCase()}))}},50250:(e,t,n)=>{"use strict";var r=n(52297),i=/^-ms-/;e.exports=function(e){return r(e.replace(i,"ms-"))}},60139:e=>{"use strict";function t(e){return function(){return e}}var n=function(){};n.thatReturns=t,n.thatReturnsFalse=t(!1),n.thatReturnsTrue=t(!0),n.thatReturnsNull=t(null),n.thatReturnsThis=function(){return this},n.thatReturnsArgument=function(e){return e},e.exports=n},89349:e=>{"use strict";var t=/([A-Z])/g;e.exports=function(e){return e.replace(t,"-$1").toLowerCase()}},67100:(e,t,n)=>{"use strict";var r=n(89349),i=/^ms-/;e.exports=function(e){return r(e).replace(i,"-ms-")}},51767:e=>{"use strict";e.exports=function(e){var t={};return function(n){return t.hasOwnProperty(n)||(t[n]=e.call(this,n)),t[n]}}},63620:(e,t,n)=>{"use strict";var r=n(60139);e.exports=r},16482:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowStart:!0,gridRowEnd:!0,gridColumn:!0,gridColumnStart:!0,gridColumnEnd:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},r=["Webkit","ms","Moz","O"];Object.keys(n).forEach((function(e){r.forEach((function(t){n[function(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)}(t,e)]=n[e]}))}));var i={isUnitlessNumber:n,shorthandPropertyExpansions:{background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}}};t.default=i},28511:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(16482));function i(e){return e&&e.__esModule?e:{default:e}}i(n(63620));var a=r.default.isUnitlessNumber;t.default=function(e,t,n){return null==t||"boolean"==typeof t||""===t?"":isNaN(t)||0===t||a.hasOwnProperty(e)&&a[e]?""+t:("string"==typeof t&&(t=t.trim()),t+"px")}},26563:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.processStyleName=void 0,t.createMarkupForStyles=function(e,t){var n="";for(var i in e){var a=0===i.indexOf("--");if(e.hasOwnProperty(i)&&"label"!==i){var s=e[i];null!=s&&(a?n+=i+":"+s+";":(n+=o(i)+":",n+=(0,r.default)(i,s,t)+";"))}}return n||null},s(n(50250));var r=s(n(28511)),i=s(n(67100)),a=s(n(51767));function s(e){return e&&e.__esModule?e:{default:e}}s(n(63620));var o=t.processStyleName=(0,a.default)(i.default)},95913:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function r(e){return Array.isArray(e)?(i=!1,a=[],(t=e).forEach((function(e){var t=r(e);null!==t&&t===e||(i=!0),null!==t&&a.push(t)})),0==a.length?null:i?a:t):function(e){if(function(e){return null==e||!1===e||"object"===(void 0===e?"undefined":n(e))&&0===Object.keys(e).length}(e))return null;if("object"!==(void 0===e?"undefined":n(e)))return e;for(var t={},i=Object.keys(e),a=!1,s=0;s<i.length;s++){var o=e[i[s]],u=r(o);null!==u&&u===o||(a=!0),null!==u&&(t[i[s]]=u)}return 0===Object.keys(t).length?null:a?t:e}(e);var t,i,a}t.default=r},78108:(e,t)=>{"use strict";function n(e,t){return e.charCodeAt(t++)+(e.charCodeAt(t++)<<8)+(e.charCodeAt(t++)<<16)+(e.charCodeAt(t)<<24)}function r(e,t){return e.charCodeAt(t++)+(e.charCodeAt(t++)<<8)}function i(e,t){return(65535&(e|=0))*(t|=0)+(((e>>>16)*t&65535)<<16)|0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(var a=1540483477,s=t^e.length,o=e.length,u=0;o>=4;){var l=n(e,u);l=i(l,a),l=i(l^=l>>>24,a),s=i(s,a),s^=l,u+=4,o-=4}switch(o){case 3:s^=r(e,u),s=i(s^=e.charCodeAt(u+2)<<16,a);break;case 2:s=i(s^=r(e,u),a);break;case 1:s=i(s^=e.charCodeAt(u),a)}return s=i(s^=s>>>13,a),(s^=s>>>15)>>>0}},26113:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.compose=t.merge=t.$=t.style=t.presets=t.keyframes=t.fontFace=t.insertGlobal=t.insertRule=t.plugins=t.styleSheet=void 0,t.speedy=function(e){return d.speedy(e)},t.simulations=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];p=!!e},t.simulate=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(t=(0,s.default)(t))?p?t.reduce((function(e,t){return e["data-simulate-"+v(t)]="",e}),{}):(g||(console.warn("can't simulate without once calling simulations(true)"),g=!0),m||(console.warn("don't use simulation outside dev"),m=!0),{}):{}},t.cssLabels=function(e){y=!!e},t.isLikeRule=x,t.idFor=w,t.css=U,t.rehydrate=function(e){(0,r.default)(F,e.reduce((function(e,t){return e[t]=!0,e}),{}))},t.flush=function(){F=d.inserted={},I=d.registered={},N={},d.flush(),d.inject()},t.select=V,t.parent=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return U(c({},e+" &",n))},t.media=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return U(c({},"@media "+e,n))},t.pseudo=G,t.active=function(e){return G(":active",e)},t.any=function(e){return G(":any",e)},t.checked=function(e){return G(":checked",e)},t.disabled=function(e){return G(":disabled",e)},t.empty=function(e){return G(":empty",e)},t.enabled=function(e){return G(":enabled",e)},t._default=function(e){return G(":default",e)},t.first=function(e){return G(":first",e)},t.firstChild=function(e){return G(":first-child",e)},t.firstOfType=function(e){return G(":first-of-type",e)},t.fullscreen=function(e){return G(":fullscreen",e)},t.focus=function(e){return G(":focus",e)},t.hover=function(e){return G(":hover",e)},t.indeterminate=function(e){return G(":indeterminate",e)},t.inRange=function(e){return G(":in-range",e)},t.invalid=function(e){return G(":invalid",e)},t.lastChild=function(e){return G(":last-child",e)},t.lastOfType=function(e){return G(":last-of-type",e)},t.left=function(e){return G(":left",e)},t.link=function(e){return G(":link",e)},t.onlyChild=function(e){return G(":only-child",e)},t.onlyOfType=function(e){return G(":only-of-type",e)},t.optional=function(e){return G(":optional",e)},t.outOfRange=function(e){return G(":out-of-range",e)},t.readOnly=function(e){return G(":read-only",e)},t.readWrite=function(e){return G(":read-write",e)},t.required=function(e){return G(":required",e)},t.right=function(e){return G(":right",e)},t.root=function(e){return G(":root",e)},t.scope=function(e){return G(":scope",e)},t.target=function(e){return G(":target",e)},t.valid=function(e){return G(":valid",e)},t.visited=function(e){return G(":visited",e)},t.dir=function(e,t){return G(":dir("+e+")",t)},t.lang=function(e,t){return G(":lang("+e+")",t)},t.not=function(e,t){var n=e.split(",").map((function(e){return e.trim()})).map((function(e){return":not("+e+")"}));return 1===n.length?G(":not("+e+")",t):V(n.join(""),t)},t.nthChild=function(e,t){return G(":nth-child("+e+")",t)},t.nthLastChild=function(e,t){return G(":nth-last-child("+e+")",t)},t.nthLastOfType=function(e,t){return G(":nth-last-of-type("+e+")",t)},t.nthOfType=function(e,t){return G(":nth-of-type("+e+")",t)},t.after=function(e){return G("::after",e)},t.before=function(e){return G("::before",e)},t.firstLetter=function(e){return G("::first-letter",e)},t.firstLine=function(e){return G("::first-line",e)},t.selection=function(e){return G("::selection",e)},t.backdrop=function(e){return G("::backdrop",e)},t.placeholder=function(e){return U({"::placeholder":e})},t.cssFor=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(t=(0,s.default)(t))?t.map((function(e){var t={label:[]};return R(t,{src:e}),E(b(t),A(t)).join("")})).join(""):""},t.attribsFor=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=(t=(0,s.default)(t))?t.map((function(e){w(e);var t=Object.keys(e)[0];return t+'="'+(e[t]||"")+'"'})).join(" "):"";return r};var r=l(n(27418)),i=n(36837),a=n(26563),s=l(n(95913)),o=n(72389),u=l(n(78108));function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=t.styleSheet=new i.StyleSheet;d.inject();var h=t.plugins=d.plugins=new o.PluginSet([o.prefixes,o.contentWrap,o.fallbacks]);h.media=new o.PluginSet,h.fontFace=new o.PluginSet,h.keyframes=new o.PluginSet([o.prefixes,o.fallbacks]);var f="undefined"!=typeof window,p=false,g=!1,m=!1,y=false;function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.toLowerCase().replace(/[^a-z0-9]/g,t)}function b(e){var t=JSON.stringify(e),n=(0,u.default)(t).toString(36);return e.label&&e.label.length,n}function x(e){var t=Object.keys(e).filter((function(e){return"toString"!==e}));return 1===t.length&&!!/data\-css\-([a-zA-Z0-9\-_]+)/.exec(t[0])}function w(e){var t=Object.keys(e).filter((function(e){return"toString"!==e}));if(1!==t.length)throw new Error("not a rule");var n=/data\-css\-([a-zA-Z0-9\-_]+)/.exec(t[0]);if(!n)throw new Error("not a rule");return n[1]}var k=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g;function _(e){if(-1===e.indexOf(","))return[e];for(var t,n=[],r=[],i=0;t=k.exec(e);)switch(t[0]){case"(":i++;break;case")":i--;break;case",":if(i)break;n.push(t.index)}for(t=n.length;t--;)r.unshift(e.slice(n[t]+1)),e=e.slice(0,n[t]);return r.unshift(e),r}function S(e,t){if(!e)return t.replace(/\&/g,"");if(!t)return".css-"+e+",[data-css-"+e+"]";var n=_(t).map((function(t){return t.indexOf("&")>=0?[t.replace(/\&/gm,".css-"+e),t.replace(/\&/gm,"[data-css-"+e+"]")].join(","):".css-"+e+t+",[data-css-"+e+"]"+t})).join(",");return p&&/^\&\:/.exec(t)&&!/\s/.exec(t)&&(n+=",.css-"+e+"[data-simulate-"+v(t)+"],[data-css-"+e+"][data-simulate-"+v(t)+"]"),n}function C(e){var t=e.selector,n=e.style,r=h.transform({selector:t,style:n});return r.selector+"{"+(0,a.createMarkupForStyles)(r.style)+"}"}function A(e){var t=void 0,n=void 0,r=void 0,i=void 0;return Object.keys(e).forEach((function(a){a.indexOf("&")>=0?(n=n||{})[a]=e[a]:0===a.indexOf("@media")?(r=r||{})[a]=A(e[a]):0===a.indexOf("@supports")?(i=i||{})[a]=A(e[a]):"label"===a?e.label.length>0&&((t=t||{}).label=y?e.label.join("."):""):(t=t||{})[a]=e[a]})),{plain:t,selects:n,medias:r,supports:i}}function E(e,t){var n=[],r=t.plain,i=t.selects,a=t.medias,s=t.supports;return r&&n.push(C({style:r,selector:S(e)})),i&&Object.keys(i).forEach((function(t){return n.push(C({style:i[t],selector:S(e,t)}))})),a&&Object.keys(a).forEach((function(t){return n.push(t+"{"+E(e,a[t]).join("")+"}")})),s&&Object.keys(s).forEach((function(t){return n.push(t+"{"+E(e,s[t]).join("")+"}")})),n}var F=d.inserted={},I=d.registered={};function D(e){I[e.id]||(I[e.id]=e)}var N={};function $(e,t){var n=_(e).map((function(e){return e.indexOf("&")>=0?e:"&"+e})),r=_(t).map((function(e){return e.indexOf("&")>=0?e:"&"+e}));return r.reduce((function(e,t){return e.concat(n.map((function(e){return t.replace(/\&/g,e)})))}),[]).join(",")}function T(e,t){return e?"@supports "+e.substring(9)+" and "+t.substring(9):t}function O(e){for(var t=[],n=0;n<e.length;n++)t=Array.isArray(e[n])?t.concat(O(e[n])):t.concat(e[n]);return t}var M={"::placeholder":["::-webkit-input-placeholder","::-moz-placeholder","::-ms-input-placeholder"],":fullscreen":[":-webkit-full-screen",":-moz-full-screen",":-ms-fullscreen"]};function R(e,t){var n=t.selector,r=void 0===n?"":n,i=t.mq,a=void 0===i?"":i,o=t.supp,u=void 0===o?"":o,l=t.src,c=void 0===l?{}:l;Array.isArray(c)||(c=[c]),(c=O(c)).forEach((function(t){if(x(t)){var n=function(e){if(x(e)){var t=I[w(e)];if(null==t)throw new Error("[glamor] an unexpected rule cache miss occurred. This is probably a sign of multiple glamor instances in your app. See https://github.com/threepointone/glamor/issues/79");return t}return e}(t);if("css"!==n.type)throw new Error("cannot merge this rule");t=n.style}(t=(0,s.default)(t))&&t.composes&&R(e,{selector:r,mq:a,supp:u,src:t.composes}),Object.keys(t||{}).forEach((function(n){if(function(e){for(var t=[":",".","[",">"," "],n=!1,r=e.charAt(0),i=0;i<t.length;i++)if(r===t[i]){n=!0;break}return n||e.indexOf("&")>=0}(n))M[n]&&M[n].forEach((function(i){return R(e,{selector:$(r,i),mq:a,supp:u,src:t[n]})})),R(e,{selector:$(r,n),mq:a,supp:u,src:t[n]});else if(function(e){return 0===e.indexOf("@media")}(n))R(e,{selector:r,mq:(s=a,o=n,s?"@media "+s.substring(6)+" and "+o.substring(6):o),supp:u,src:t[n]});else if(function(e){return 0===e.indexOf("@supports")}(n))R(e,{selector:r,mq:a,supp:T(u,n),src:t[n]});else if("composes"===n);else{var i=e;u&&(i[u]=i[u]||{},i=i[u]),a&&(i[a]=i[a]||{},i=i[a]),r&&(i[r]=i[r]||{},i=i[r]),"label"===n?y&&(e.label=e.label.concat(t.label)):i[n]=t[n]}var s,o}))}))}function B(e){var t={label:[]};return R(t,{src:e}),function(e){if(D(e),function(e){if(!F[e.id]){F[e.id]=!0;var t=A(e.style),n=E(e.id,t);F[e.id]=!!f||n,n.forEach((function(e){return d.insert(e)}))}}(e),N[e.id])return N[e.id];var t=c({},"data-css-"+e.id,y&&e.label||"");return Object.defineProperty(t,"toString",{enumerable:!1,value:function(){return"css-"+e.id}}),N[e.id]=t,t}({id:b(t),style:t,label:y?t.label.join("."):"",type:"css"})}var z={};Object.defineProperty(z,"toString",{enumerable:!1,value:function(){return"css-nil"}});var L,P="undefined"!=typeof WeakMap?[z,new WeakMap,new WeakMap,new WeakMap]:[z],j="undefined"!=typeof WeakMap?(L=B,function(e){if(P[e.length]){for(var t=P[e.length],n=0;n<e.length-1;)t.has(e[n])||t.set(e[n],new WeakMap),t=t.get(e[n]),n++;if(t.has(e[e.length-1])){var r=t.get(e[n]);if(I[r.toString().substring(4)])return r}}var i=L(e);if(P[e.length]){for(var a=0,s=P[e.length];a<e.length-1;)s=s.get(e[a]),a++;try{s.set(e[a],i)}catch(e){}}return i}):B;function U(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t[0]&&t[0].length&&t[0].raw)throw new Error("you forgot to include glamor/babel in your babel plugins.");return(t=(0,s.default)(t))?j(t):z}U.insert=function(e){var t={id:b(e),css:e,type:"raw"};D(t),F[t.id]||(d.insert(t.css),F[t.id]=!!f||[t.css])},t.insertRule=U.insert,U.global=function(e,t){if(t=(0,s.default)(t))return U.insert(C({selector:e,style:t}))},t.insertGlobal=U.global,U.keyframes=function(e,t){t||(t=e,e="animation");var n={id:b({name:e,kfs:t=(0,s.default)(t)||{}}),type:"keyframes",name:e,keyframes:t};return D(n),function(e){if(!F[e.id]){var t=Object.keys(e.keyframes).map((function(t){var n=h.keyframes.transform({id:e.id,name:t,style:e.keyframes[t]});return n.name+"{"+(0,a.createMarkupForStyles)(n.style)+"}"})).join(""),n=["-webkit-","-moz-","-o-",""].map((function(n){return"@"+n+"keyframes "+e.name+"_"+e.id+"{"+t+"}"}));n.forEach((function(e){return d.insert(e)})),F[e.id]=!!f||n}}(n),e+"_"+n.id},U.fontFace=function(e){var t={id:b(e=(0,s.default)(e)),type:"font-face",font:e};return D(t),function(e){if(!F[e.id]){var t="@font-face{"+(0,a.createMarkupForStyles)(e.font)+"}";d.insert(t),F[e.id]=!!f||[t]}}(t),e.fontFamily},t.fontFace=U.fontFace,t.keyframes=U.keyframes,t.presets={mobile:"(min-width: 400px)",Mobile:"@media (min-width: 400px)",phablet:"(min-width: 550px)",Phablet:"@media (min-width: 550px)",tablet:"(min-width: 750px)",Tablet:"@media (min-width: 750px)",desktop:"(min-width: 1000px)",Desktop:"@media (min-width: 1000px)",hd:"(min-width: 1200px)",Hd:"@media (min-width: 1200px)"};var W=t.style=U;function V(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e?U(c({},e,n)):W(n)}function G(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return U(c({},e,n))}t.$=V,t.merge=U,t.compose=U},72389:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};t.PluginSet=u,t.fallbacks=function(e){if(Object.keys(e.style).map((function(t){return Array.isArray(e.style[t])})).indexOf(!0)>=0){var t=e.style,n=Object.keys(t).reduce((function(e,n){return e[n]=Array.isArray(t[n])?t[n].join("; "+(0,a.processStyleName)(n)+": "):t[n],e}),{});return(0,i.default)({},e,{style:n})}return e},t.contentWrap=function(e){if(e.style.content){var t=e.style.content;return l.indexOf(t)>=0||/^(attr|calc|counters?|url)\(/.test(t)?e:t.charAt(0)!==t.charAt(t.length-1)||'"'!==t.charAt(0)&&"'"!==t.charAt(0)?r({},e,{style:r({},e.style,{content:'"'+t+'"'})}):e}return e},t.prefixes=function(e){return(0,i.default)({},e,{style:(0,s.default)(r({},e.style))})};var i=o(n(27418)),a=n(26563),s=o(n(24975));function o(e){return e&&e.__esModule?e:{default:e}}function u(e){this.fns=e||[]}(0,i.default)(u.prototype,{add:function(){for(var e=this,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t){e.fns.indexOf(t)>=0||(e.fns=[t].concat(e.fns))}))},remove:function(e){this.fns=this.fns.filter((function(t){return t!==e}))},clear:function(){this.fns=[]},transform:function(e){return this.fns.reduce((function(e,t){return t(e)}),e)}});var l=["normal","none","counter","open-quote","close-quote","no-open-quote","no-close-quote","initial","inherit"]},24975:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t in e){var n=e[t],r=(0,a.default)(y,t,n,e,v);r&&(e[t]=r),(0,i.default)(v,t,e)}return e};var r=m(n(62633)),i=m(n(47901)),a=m(n(61745)),s=m(n(85848)),o=m(n(76230)),u=m(n(37879)),l=m(n(35716)),c=m(n(58544)),d=m(n(77551)),h=m(n(51242)),f=m(n(19686)),p=m(n(81113)),g=m(n(35152));function m(e){return e&&e.__esModule?e:{default:e}}var y=[o.default,s.default,u.default,c.default,d.default,h.default,f.default,p.default,g.default,l.default],v=r.default.prefixMap},36837:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StyleSheet=c;var r,i=(r=n(27418))&&r.__esModule?r:{default:r};function a(e){return e[e.length-1]}function s(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}var o="undefined"!=typeof window,u=function(){if(o){var e=document.createElement("div");return e.innerHTML="\x3c!--[if lt IE 10]><i></i><![endif]--\x3e",1===e.getElementsByTagName("i").length}}();function l(){var e=document.createElement("style");return e.type="text/css",e.setAttribute("data-glamor",""),e.appendChild(document.createTextNode("")),(document.head||document.getElementsByTagName("head")[0]).appendChild(e),e}function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.speedy,n=void 0===t||t,r=e.maxLength,i=void 0===r?o&&u?4e3:65e3:r;this.isSpeedy=n,this.sheet=void 0,this.tags=[],this.maxLength=i,this.ctr=0}(0,i.default)(c.prototype,{getSheet:function(){return s(a(this.tags))},inject:function(){var e=this;if(this.injected)throw new Error("already injected stylesheet!");o?this.tags[0]=l():this.sheet={cssRules:[],insertRule:function(t){e.sheet.cssRules.push({cssText:t})}},this.injected=!0},speedy:function(e){if(0!==this.ctr)throw new Error("cannot change speedy mode after inserting any rule to sheet. Either call speedy("+e+") earlier in your app, or call flush() before speedy("+e+")");this.isSpeedy=!!e},_insert:function(e){try{var t=this.getSheet();t.insertRule(e,-1!==e.indexOf("@import")?0:t.cssRules.length)}catch(e){}},insert:function(e){if(o)if(this.isSpeedy&&this.getSheet().insertRule)this._insert(e);else if(-1!==e.indexOf("@import")){var t=a(this.tags);t.insertBefore(document.createTextNode(e),t.firstChild)}else a(this.tags).appendChild(document.createTextNode(e));else this.sheet.insertRule(e,-1!==e.indexOf("@import")?0:this.sheet.cssRules.length);return this.ctr++,o&&this.ctr%this.maxLength==0&&this.tags.push(l()),this.ctr-1},delete:function(e){return this.replace(e,"")},flush:function(){o?(this.tags.forEach((function(e){return e.parentNode.removeChild(e)})),this.tags=[],this.sheet=null,this.ctr=0):this.sheet.cssRules=[],this.injected=!1},rules:function(){if(!o)return this.sheet.cssRules;var e=[];return this.tags.forEach((function(t){return e.splice.apply(e,[e.length,0].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(Array.from(s(t).cssRules))))})),e}})},25477:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=/[A-Z]/g,i=/^ms-/,a={};function s(e){return"-"+e.toLowerCase()}const o=function(e){if(a.hasOwnProperty(e))return a[e];var t=e.replace(r,s);return a[e]=i.test(t)?"-"+t:t}},76230:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("string"==typeof t&&!(0,i.default)(t)&&t.indexOf("cross-fade(")>-1)return a.map((function(e){return t.replace(/cross-fade\(/g,e+"cross-fade(")}))};var r,i=(r=n(50638))&&r.__esModule?r:{default:r},a=["-webkit-",""];e.exports=t.default},85848:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("cursor"===e&&r.hasOwnProperty(t))return n.map((function(e){return e+t}))};var n=["-webkit-","-moz-",""],r={"zoom-in":!0,"zoom-out":!0,grab:!0,grabbing:!0};e.exports=t.default},37879:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("string"==typeof t&&!(0,i.default)(t)&&t.indexOf("filter(")>-1)return a.map((function(e){return t.replace(/filter\(/g,e+"filter(")}))};var r,i=(r=n(50638))&&r.__esModule?r:{default:r},a=["-webkit-",""];e.exports=t.default},35716:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("display"===e&&n.hasOwnProperty(t))return n[t]};var n={flex:["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex","flex"],"inline-flex":["-webkit-inline-box","-moz-inline-box","-ms-inline-flexbox","-webkit-inline-flex","inline-flex"]};e.exports=t.default},58544:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,i){"flexDirection"===e&&"string"==typeof t&&(t.indexOf("column")>-1?i.WebkitBoxOrient="vertical":i.WebkitBoxOrient="horizontal",t.indexOf("reverse")>-1?i.WebkitBoxDirection="reverse":i.WebkitBoxDirection="normal"),r.hasOwnProperty(e)&&(i[r[e]]=n[t]||t)};var n={"space-around":"justify","space-between":"justify","flex-start":"start","flex-end":"end","wrap-reverse":"multiple",wrap:"multiple"},r={alignItems:"WebkitBoxAlign",justifyContent:"WebkitBoxPack",flexWrap:"WebkitBoxLines"};e.exports=t.default},77551:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("string"==typeof t&&!(0,i.default)(t)&&s.test(t))return a.map((function(e){return e+t}))};var r,i=(r=n(50638))&&r.__esModule?r:{default:r},a=["-webkit-","-moz-",""],s=/linear-gradient|radial-gradient|repeating-linear-gradient|repeating-radial-gradient/;e.exports=t.default},51242:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("string"==typeof t&&!(0,i.default)(t)&&t.indexOf("image-set(")>-1)return a.map((function(e){return t.replace(/image-set\(/g,e+"image-set(")}))};var r,i=(r=n(50638))&&r.__esModule?r:{default:r},a=["-webkit-",""];e.exports=t.default},19686:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if("position"===e&&"sticky"===t)return["-webkit-sticky","sticky"]},e.exports=t.default},81113:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(r.hasOwnProperty(e)&&i.hasOwnProperty(t))return n.map((function(e){return e+t}))};var n=["-webkit-","-moz-",""],r={maxHeight:!0,maxWidth:!0,width:!0,height:!0,columnWidth:!0,minWidth:!0,minHeight:!0},i={"min-content":!0,"max-content":!0,"fill-available":!0,"fit-content":!0,"contain-floats":!0};e.exports=t.default},35152:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,s){if("string"==typeof t&&o.hasOwnProperty(e)){var l=function(e,t){if((0,i.default)(e))return e;for(var n=e.split(/,(?![^()]*(?:\([^()]*\))?\))/g),a=0,s=n.length;a<s;++a){var o=n[a],l=[o];for(var c in t){var d=(0,r.default)(c);if(o.indexOf(d)>-1&&"order"!==d)for(var h=t[c],f=0,p=h.length;f<p;++f)l.unshift(o.replace(d,u[h[f]]+d))}n[a]=l.join(",")}return n.join(",")}(t,s),c=l.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter((function(e){return!/-moz-|-ms-/.test(e)})).join(",");if(e.indexOf("Webkit")>-1)return c;var d=l.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter((function(e){return!/-webkit-|-ms-/.test(e)})).join(",");return e.indexOf("Moz")>-1?d:(n["Webkit"+(0,a.default)(e)]=c,n["Moz"+(0,a.default)(e)]=d,l)}};var r=s(n(16238)),i=s(n(50638)),a=s(n(22160));function s(e){return e&&e.__esModule?e:{default:e}}var o={transition:!0,transitionProperty:!0,WebkitTransition:!0,WebkitTransitionProperty:!0,MozTransition:!0,MozTransitionProperty:!0},u={Webkit:"-webkit-",Moz:"-moz-",ms:"-ms-"};e.exports=t.default},62633:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=["Webkit"],r=["Moz"],i=["ms"],a=["Webkit","Moz"],s=["Webkit","ms"],o=["Webkit","Moz","ms"];t.default={plugins:[],prefixMap:{appearance:a,userSelect:o,textEmphasisPosition:n,textEmphasis:n,textEmphasisStyle:n,textEmphasisColor:n,boxDecorationBreak:n,clipPath:n,maskImage:n,maskMode:n,maskRepeat:n,maskPosition:n,maskClip:n,maskOrigin:n,maskSize:n,maskComposite:n,mask:n,maskBorderSource:n,maskBorderMode:n,maskBorderSlice:n,maskBorderWidth:n,maskBorderOutset:n,maskBorderRepeat:n,maskBorder:n,maskType:n,textDecorationStyle:n,textDecorationSkip:n,textDecorationLine:n,textDecorationColor:n,filter:n,fontFeatureSettings:n,breakAfter:o,breakBefore:o,breakInside:o,columnCount:a,columnFill:a,columnGap:a,columnRule:a,columnRuleColor:a,columnRuleStyle:a,columnRuleWidth:a,columns:a,columnSpan:a,columnWidth:a,writingMode:s,flex:n,flexBasis:n,flexDirection:n,flexGrow:n,flexFlow:n,flexShrink:n,flexWrap:n,alignContent:n,alignItems:n,alignSelf:n,justifyContent:n,order:n,transform:n,transformOrigin:n,transformOriginX:n,transformOriginY:n,backfaceVisibility:n,perspective:n,perspectiveOrigin:n,transformStyle:n,transformOriginZ:n,animation:n,animationDelay:n,animationDirection:n,animationFillMode:n,animationDuration:n,animationIterationCount:n,animationName:n,animationPlayState:n,animationTimingFunction:n,backdropFilter:n,fontKerning:n,scrollSnapType:s,scrollSnapPointsX:s,scrollSnapPointsY:s,scrollSnapDestination:s,scrollSnapCoordinate:s,shapeImageThreshold:n,shapeImageMargin:n,shapeImageOutside:n,hyphens:o,flowInto:s,flowFrom:s,regionFragment:s,textAlignLast:r,tabSize:r,wrapFlow:i,wrapThrough:i,wrapMargin:i,gridTemplateColumns:i,gridTemplateRows:i,gridTemplateAreas:i,gridTemplate:i,gridAutoColumns:i,gridAutoRows:i,gridAutoFlow:i,grid:i,gridRowStart:i,gridColumnStart:i,gridRowEnd:i,gridRow:i,gridColumn:i,gridColumnEnd:i,gridColumnGap:i,gridRowGap:i,gridArea:i,gridGap:i,textSizeAdjust:s,borderImage:n,borderImageOutset:n,borderImageRepeat:n,borderImageSlice:n,borderImageSource:n,borderImageWidth:n,transitionDelay:n,transitionDuration:n,transitionProperty:n,transitionTimingFunction:n}},e.exports=t.default},22160:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},e.exports=t.default},47901:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(e.hasOwnProperty(t))for(var r=e[t],a=0,s=r.length;a<s;++a)n[r[a]+(0,i.default)(t)]=n[t]};var r,i=(r=n(22160))&&r.__esModule?r:{default:r};e.exports=t.default},61745:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r,i){for(var a=0,s=e.length;a<s;++a){var o=e[a](t,n,r,i);if(o)return o}},e.exports=t.default},43720:e=>{e.exports=n;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function r(e){return!0===(e&&e.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var i={},a={};function s(e,t){var n,r,s;return t?(s=0<=(e>>>=0)&&e<256)&&(r=a[e])?r:(n=u(e,(0|e)<0?-1:0,!0),s&&(a[e]=n),n):(s=-128<=(e|=0)&&e<128)&&(r=i[e])?r:(n=u(e,e<0?-1:0,!1),s&&(i[e]=n),n)}function o(e,t){if(isNaN(e))return t?y:m;if(t){if(e<0)return y;if(e>=f)return k}else{if(e<=-p)return _;if(e+1>=p)return w}return e<0?o(-e,t).neg():u(e%h|0,e/h|0,t)}function u(e,t,r){return new n(e,t,r)}n.fromInt=s,n.fromNumber=o,n.fromBits=u;var l=Math.pow;function c(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return m;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return c(e.substring(1),t,n).neg();for(var i=o(l(n,8)),a=m,s=0;s<e.length;s+=8){var u=Math.min(8,e.length-s),d=parseInt(e.substring(s,s+u),n);if(u<8){var h=o(l(n,u));a=a.mul(h).add(o(d))}else a=(a=a.mul(i)).add(o(d))}return a.unsigned=t,a}function d(e,t){return"number"==typeof e?o(e,t):"string"==typeof e?c(e,t):u(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}n.fromString=c,n.fromValue=d;var h=4294967296,f=h*h,p=f/2,g=s(1<<24),m=s(0);n.ZERO=m;var y=s(0,!0);n.UZERO=y;var v=s(1);n.ONE=v;var b=s(1,!0);n.UONE=b;var x=s(-1);n.NEG_ONE=x;var w=u(-1,2147483647,!1);n.MAX_VALUE=w;var k=u(-1,-1,!0);n.MAX_UNSIGNED_VALUE=k;var _=u(0,-2147483648,!1);n.MIN_VALUE=_;var S=n.prototype;S.toInt=function(){return this.unsigned?this.low>>>0:this.low},S.toNumber=function(){return this.unsigned?(this.high>>>0)*h+(this.low>>>0):this.high*h+(this.low>>>0)},S.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(_)){var t=o(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var i=o(l(e,6),this.unsigned),a=this,s="";;){var u=a.div(i),c=(a.sub(u.mul(i)).toInt()>>>0).toString(e);if((a=u).isZero())return c+s;for(;c.length<6;)c="0"+c;s=""+c+s}},S.getHighBits=function(){return this.high},S.getHighBitsUnsigned=function(){return this.high>>>0},S.getLowBits=function(){return this.low},S.getLowBitsUnsigned=function(){return this.low>>>0},S.getNumBitsAbs=function(){if(this.isNegative())return this.eq(_)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},S.isZero=function(){return 0===this.high&&0===this.low},S.eqz=S.isZero,S.isNegative=function(){return!this.unsigned&&this.high<0},S.isPositive=function(){return this.unsigned||this.high>=0},S.isOdd=function(){return 1==(1&this.low)},S.isEven=function(){return 0==(1&this.low)},S.equals=function(e){return r(e)||(e=d(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},S.eq=S.equals,S.notEquals=function(e){return!this.eq(e)},S.neq=S.notEquals,S.ne=S.notEquals,S.lessThan=function(e){return this.comp(e)<0},S.lt=S.lessThan,S.lessThanOrEqual=function(e){return this.comp(e)<=0},S.lte=S.lessThanOrEqual,S.le=S.lessThanOrEqual,S.greaterThan=function(e){return this.comp(e)>0},S.gt=S.greaterThan,S.greaterThanOrEqual=function(e){return this.comp(e)>=0},S.gte=S.greaterThanOrEqual,S.ge=S.greaterThanOrEqual,S.compare=function(e){if(r(e)||(e=d(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},S.comp=S.compare,S.negate=function(){return!this.unsigned&&this.eq(_)?_:this.not().add(v)},S.neg=S.negate,S.add=function(e){r(e)||(e=d(e));var t=this.high>>>16,n=65535&this.high,i=this.low>>>16,a=65535&this.low,s=e.high>>>16,o=65535&e.high,l=e.low>>>16,c=0,h=0,f=0,p=0;return f+=(p+=a+(65535&e.low))>>>16,h+=(f+=i+l)>>>16,c+=(h+=n+o)>>>16,c+=t+s,u((f&=65535)<<16|(p&=65535),(c&=65535)<<16|(h&=65535),this.unsigned)},S.subtract=function(e){return r(e)||(e=d(e)),this.add(e.neg())},S.sub=S.subtract,S.multiply=function(e){if(this.isZero())return m;if(r(e)||(e=d(e)),t)return u(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return m;if(this.eq(_))return e.isOdd()?_:m;if(e.eq(_))return this.isOdd()?_:m;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return o(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,i=65535&this.high,a=this.low>>>16,s=65535&this.low,l=e.high>>>16,c=65535&e.high,h=e.low>>>16,f=65535&e.low,p=0,y=0,v=0,b=0;return v+=(b+=s*f)>>>16,y+=(v+=a*f)>>>16,v&=65535,y+=(v+=s*h)>>>16,p+=(y+=i*f)>>>16,y&=65535,p+=(y+=a*h)>>>16,y&=65535,p+=(y+=s*c)>>>16,p+=n*f+i*h+a*c+s*l,u((v&=65535)<<16|(b&=65535),(p&=65535)<<16|(y&=65535),this.unsigned)},S.mul=S.multiply,S.divide=function(e){if(r(e)||(e=d(e)),e.isZero())throw Error("division by zero");var n,i,a;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?y:m;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return y;if(e.gt(this.shru(1)))return b;a=y}else{if(this.eq(_))return e.eq(v)||e.eq(x)?_:e.eq(_)?v:(n=this.shr(1).div(e).shl(1)).eq(m)?e.isNegative()?v:x:(i=this.sub(e.mul(n)),a=n.add(i.div(e)));if(e.eq(_))return this.unsigned?y:m;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();a=m}for(i=this;i.gte(e);){n=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),c=s<=48?1:l(2,s-48),h=o(n),f=h.mul(e);f.isNegative()||f.gt(i);)f=(h=o(n-=c,this.unsigned)).mul(e);h.isZero()&&(h=v),a=a.add(h),i=i.sub(f)}return a},S.div=S.divide,S.modulo=function(e){return r(e)||(e=d(e)),t?u((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},S.mod=S.modulo,S.rem=S.modulo,S.not=function(){return u(~this.low,~this.high,this.unsigned)},S.and=function(e){return r(e)||(e=d(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},S.or=function(e){return r(e)||(e=d(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},S.xor=function(e){return r(e)||(e=d(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},S.shiftLeft=function(e){return r(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},S.shl=S.shiftLeft,S.shiftRight=function(e){return r(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},S.shr=S.shiftRight,S.shiftRightUnsigned=function(e){if(r(e)&&(e=e.toInt()),0==(e&=63))return this;var t=this.high;return e<32?u(this.low>>>e|t<<32-e,t>>>e,this.unsigned):u(32===e?t:t>>>e-32,0,this.unsigned)},S.shru=S.shiftRightUnsigned,S.shr_u=S.shiftRightUnsigned,S.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},S.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},S.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},S.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},S.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},27418:e=>{"use strict";var t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;function i(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,a){for(var s,o,u=i(e),l=1;l<arguments.length;l++){for(var c in s=Object(arguments[l]))n.call(s,c)&&(u[c]=s[c]);if(t){o=t(s);for(var d=0;d<o.length;d++)r.call(s,o[d])&&(u[o[d]]=s[o[d]])}}return u}},99674:(e,t,n)=>{"use strict";function r(){}n.r(t),n.d(t,{Component:()=>R,cloneElement:()=>c,createElement:()=>o,default:()=>z,h:()=>o,options:()=>i,render:()=>B,rerender:()=>p});var i={},a=[],s=[];function o(e,t){var n,o,u,l,c=s;for(l=arguments.length;l-- >2;)a.push(arguments[l]);for(t&&null!=t.children&&(a.length||a.push(t.children),delete t.children);a.length;)if((o=a.pop())&&void 0!==o.pop)for(l=o.length;l--;)a.push(o[l]);else"boolean"==typeof o&&(o=null),(u="function"!=typeof e)&&(null==o?o="":"number"==typeof o?o=String(o):"string"!=typeof o&&(u=!1)),u&&n?c[c.length-1]+=o:c===s?c=[o]:c.push(o),n=u;var d=new r;return d.nodeName=e,d.children=c,d.attributes=null==t?void 0:t,d.key=null==t?void 0:t.key,void 0!==i.vnode&&i.vnode(d),d}function u(e,t){for(var n in t)e[n]=t[n];return e}var l="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function c(e,t){return o(e.nodeName,u(u({},e.attributes),t),arguments.length>2?[].slice.call(arguments,2):e.children)}var d=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,h=[];function f(e){!e._dirty&&(e._dirty=!0)&&1==h.push(e)&&(i.debounceRendering||l)(p)}function p(){var e,t=h;for(h=[];e=t.pop();)e._dirty&&O(e)}function g(e,t,n){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&m(e,t.nodeName):n||e._componentConstructor===t.nodeName}function m(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function y(e){var t=u({},e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(void 0!==n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);return t}function v(e){var t=e.parentNode;t&&t.removeChild(e)}function b(e,t,n,r,i){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)n&&n(null),r&&r(e);else if("class"!==t||i)if("style"===t){if(r&&"string"!=typeof r&&"string"!=typeof n||(e.style.cssText=r||""),r&&"object"==typeof r){if("string"!=typeof n)for(var a in n)a in r||(e.style[a]="");for(var a in r)e.style[a]="number"==typeof r[a]&&!1===d.test(a)?r[a]+"px":r[a]}}else if("dangerouslySetInnerHTML"===t)r&&(e.innerHTML=r.__html||"");else if("o"==t[0]&&"n"==t[1]){var s=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),r?n||e.addEventListener(t,x,s):e.removeEventListener(t,x,s),(e._listeners||(e._listeners={}))[t]=r}else if("list"!==t&&"type"!==t&&!i&&t in e)!function(e,t,n){try{e[t]=n}catch(e){}}(e,t,null==r?"":r),null!=r&&!1!==r||e.removeAttribute(t);else{var o=i&&t!==(t=t.replace(/^xlink:?/,""));null==r||!1===r?o?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof r&&(o?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),r):e.setAttribute(t,r))}else e.className=r||""}function x(e){return this._listeners[e.type](i.event&&i.event(e)||e)}var w=[],k=0,_=!1,S=!1;function C(){for(var e;e=w.pop();)i.afterMount&&i.afterMount(e),e.componentDidMount&&e.componentDidMount()}function A(e,t,n,r,i,a){k++||(_=null!=i&&void 0!==i.ownerSVGElement,S=null!=e&&!("__preactattr_"in e));var s=E(e,t,n,r,a);return i&&s.parentNode!==i&&i.appendChild(s),--k||(S=!1,a||C()),s}function E(e,t,n,r,i){var a=e,s=_;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||i)?e.nodeValue!=t&&(e.nodeValue=t):(a=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(a,e),F(e,!0))),a.__preactattr_=!0,a;var o,u,l=t.nodeName;if("function"==typeof l)return function(e,t,n,r){for(var i=e&&e._component,a=i,s=e,o=i&&e._componentConstructor===t.nodeName,u=o,l=y(t);i&&!u&&(i=i._parentComponent);)u=i.constructor===t.nodeName;return i&&u&&(!r||i._component)?(T(i,l,3,n,r),e=i.base):(a&&!o&&(M(a),e=s=null),i=N(t.nodeName,l,n),e&&!i.nextBase&&(i.nextBase=e,s=null),T(i,l,1,n,r),e=i.base,s&&e!==s&&(s._component=null,F(s,!1))),e}(e,t,n,r);if(_="svg"===l||"foreignObject"!==l&&_,l=String(l),(!e||!m(e,l))&&(o=l,(u=_?document.createElementNS("http://www.w3.org/2000/svg",o):document.createElement(o)).normalizedNodeName=o,a=u,e)){for(;e.firstChild;)a.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(a,e),F(e,!0)}var c=a.firstChild,d=a.__preactattr_,h=t.children;if(null==d){d=a.__preactattr_={};for(var f=a.attributes,p=f.length;p--;)d[f[p].name]=f[p].value}return!S&&h&&1===h.length&&"string"==typeof h[0]&&null!=c&&void 0!==c.splitText&&null==c.nextSibling?c.nodeValue!=h[0]&&(c.nodeValue=h[0]):(h&&h.length||null!=c)&&function(e,t,n,r,i){var a,s,o,u,l,c=e.childNodes,d=[],h={},f=0,p=0,m=c.length,y=0,b=t?t.length:0;if(0!==m)for(var x=0;x<m;x++){var w=c[x],k=w.__preactattr_;null!=(_=b&&k?w._component?w._component.__key:k.key:null)?(f++,h[_]=w):(k||(void 0!==w.splitText?!i||w.nodeValue.trim():i))&&(d[y++]=w)}if(0!==b)for(x=0;x<b;x++){var _;if(l=null,null!=(_=(u=t[x]).key))f&&void 0!==h[_]&&(l=h[_],h[_]=void 0,f--);else if(!l&&p<y)for(a=p;a<y;a++)if(void 0!==d[a]&&g(s=d[a],u,i)){l=s,d[a]=void 0,a===y-1&&y--,a===p&&p++;break}l=E(l,u,n,r),o=c[x],l&&l!==e&&l!==o&&(null==o?e.appendChild(l):l===o.nextSibling?v(o):e.insertBefore(l,o))}if(f)for(var x in h)void 0!==h[x]&&F(h[x],!1);for(;p<=y;)void 0!==(l=d[y--])&&F(l,!1)}(a,h,n,r,S||null!=d.dangerouslySetInnerHTML),function(e,t,n){var r;for(r in n)t&&null!=t[r]||null==n[r]||b(e,r,n[r],n[r]=void 0,_);for(r in t)"children"===r||"innerHTML"===r||r in n&&t[r]===("value"===r||"checked"===r?e[r]:n[r])||b(e,r,n[r],n[r]=t[r],_)}(a,t.attributes,d),_=s,a}function F(e,t){var n=e._component;n?M(n):(null!=e.__preactattr_&&e.__preactattr_.ref&&e.__preactattr_.ref(null),!1!==t&&null!=e.__preactattr_||v(e),I(e))}function I(e){for(e=e.lastChild;e;){var t=e.previousSibling;F(e,!0),e=t}}var D={};function N(e,t,n){var r,i=D[e.name];if(e.prototype&&e.prototype.render?(r=new e(t,n),R.call(r,t,n)):((r=new R(t,n)).constructor=e,r.render=$),i)for(var a=i.length;a--;)if(i[a].constructor===e){r.nextBase=i[a].nextBase,i.splice(a,1);break}return r}function $(e,t,n){return this.constructor(e,n)}function T(e,t,n,r,a){e._disable||(e._disable=!0,(e.__ref=t.ref)&&delete t.ref,(e.__key=t.key)&&delete t.key,!e.base||a?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,r),r&&r!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=r),e.prevProps||(e.prevProps=e.props),e.props=t,e._disable=!1,0!==n&&(1!==n&&!1===i.syncComponentUpdates&&e.base?f(e):O(e,1,a)),e.__ref&&e.__ref(e))}function O(e,t,n,r){if(!e._disable){var a,s,o,l=e.props,c=e.state,d=e.context,h=e.prevProps||l,f=e.prevState||c,p=e.prevContext||d,g=e.base,m=e.nextBase,v=g||m,b=e._component,x=!1;if(g&&(e.props=h,e.state=f,e.context=p,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(l,c,d)?x=!0:e.componentWillUpdate&&e.componentWillUpdate(l,c,d),e.props=l,e.state=c,e.context=d),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!x){a=e.render(l,c,d),e.getChildContext&&(d=u(u({},d),e.getChildContext()));var _,S,E=a&&a.nodeName;if("function"==typeof E){var I=y(a);(s=b)&&s.constructor===E&&I.key==s.__key?T(s,I,1,d,!1):(_=s,e._component=s=N(E,I,d),s.nextBase=s.nextBase||m,s._parentComponent=e,T(s,I,0,d,!1),O(s,1,n,!0)),S=s.base}else o=v,(_=b)&&(o=e._component=null),(v||1===t)&&(o&&(o._component=null),S=A(o,a,d,n||!g,v&&v.parentNode,!0));if(v&&S!==v&&s!==b){var D=v.parentNode;D&&S!==D&&(D.replaceChild(S,v),_||(v._component=null,F(v,!1)))}if(_&&M(_),e.base=S,S&&!r){for(var $=e,R=e;R=R._parentComponent;)($=R).base=S;S._component=$,S._componentConstructor=$.constructor}}if(!g||n?w.unshift(e):x||(e.componentDidUpdate&&e.componentDidUpdate(h,f,p),i.afterUpdate&&i.afterUpdate(e)),null!=e._renderCallbacks)for(;e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);k||r||C()}}function M(e){i.beforeUnmount&&i.beforeUnmount(e);var t=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n=e._component;n?M(n):t&&(t.__preactattr_&&t.__preactattr_.ref&&t.__preactattr_.ref(null),e.nextBase=t,v(t),function(e){var t=e.constructor.name;(D[t]||(D[t]=[])).push(e)}(e),I(t)),e.__ref&&e.__ref(null)}function R(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{}}function B(e,t,n){return A(n,e,{},!1,t,!1)}u(R.prototype,{setState:function(e,t){var n=this.state;this.prevState||(this.prevState=u({},n)),u(n,"function"==typeof e?e(n,this.props):e),t&&(this._renderCallbacks=this._renderCallbacks||[]).push(t),f(this)},forceUpdate:function(e){e&&(this._renderCallbacks=this._renderCallbacks||[]).push(e),O(this,2)},render:function(){}});const z={h:o,createElement:o,cloneElement:c,Component:R,render:B,rerender:p,options:i}},64448:(e,t,n)=>{"use strict";var r=n(67294),i=n(27418),a=n(63840);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!r)throw Error(s(227));var o=new Set,u={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(u[e]=t,e=0;e<t.length;e++)o.add(t[e])}var d=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f=Object.prototype.hasOwnProperty,p={},g={};function m(e,t,n,r,i,a,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=s}var y={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){y[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];y[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){y[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){y[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){y[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){y[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){y[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){y[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){y[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var v=/[\-:]([a-z])/g;function b(e){return e[1].toUpperCase()}function x(e,t,n,r){var i=y.hasOwnProperty(t)?y[t]:null;(null!==i?0===i.type:!r&&2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1]))||(function(e,t,n,r){if(null==t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!f.call(g,e)||!f.call(p,e)&&(h.test(e)?g[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(v,b);y[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(v,b);y[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(v,b);y[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){y[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),y.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){y[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var w=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,k=60103,_=60106,S=60107,C=60108,A=60114,E=60109,F=60110,I=60112,D=60113,N=60120,$=60115,T=60116,O=60121,M=60128,R=60129,B=60130,z=60131;if("function"==typeof Symbol&&Symbol.for){var L=Symbol.for;k=L("react.element"),_=L("react.portal"),S=L("react.fragment"),C=L("react.strict_mode"),A=L("react.profiler"),E=L("react.provider"),F=L("react.context"),I=L("react.forward_ref"),D=L("react.suspense"),N=L("react.suspense_list"),$=L("react.memo"),T=L("react.lazy"),O=L("react.block"),L("react.scope"),M=L("react.opaque.id"),R=L("react.debug_trace_mode"),B=L("react.offscreen"),z=L("react.legacy_hidden")}var P,j="function"==typeof Symbol&&Symbol.iterator;function U(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=j&&e[j]||e["@@iterator"])?e:null}function W(e){if(void 0===P)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);P=t&&t[1]||""}return"\n"+P+e}var V=!1;function G(e,t){if(!e||V)return"";V=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var r=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){r=e}e.call(t.prototype)}else{try{throw Error()}catch(e){r=e}e()}}catch(e){if(e&&r&&"string"==typeof e.stack){for(var i=e.stack.split("\n"),a=r.stack.split("\n"),s=i.length-1,o=a.length-1;1<=s&&0<=o&&i[s]!==a[o];)o--;for(;1<=s&&0<=o;s--,o--)if(i[s]!==a[o]){if(1!==s||1!==o)do{if(s--,0>--o||i[s]!==a[o])return"\n"+i[s].replace(" at new "," at ")}while(1<=s&&0<=o);break}}}finally{V=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?W(e):""}function q(e){switch(e.tag){case 5:return W(e.type);case 16:return W("Lazy");case 13:return W("Suspense");case 19:return W("SuspenseList");case 0:case 2:case 15:return G(e.type,!1);case 11:return G(e.type.render,!1);case 22:return G(e.type._render,!1);case 1:return G(e.type,!0);default:return""}}function H(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case S:return"Fragment";case _:return"Portal";case A:return"Profiler";case C:return"StrictMode";case D:return"Suspense";case N:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case F:return(e.displayName||"Context")+".Consumer";case E:return(e._context.displayName||"Context")+".Provider";case I:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case $:return H(e.type);case O:return H(e._render);case T:t=e._payload,e=e._init;try{return H(e(t))}catch(e){}}return null}function X(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function K(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Y(e){e._valueTracker||(e._valueTracker=function(e){var t=K(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=K(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function J(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Z(e,t){var n=t.checked;return i({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function ee(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=X(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function te(e,t){null!=(t=t.checked)&&x(e,"checked",t,!1)}function ne(e,t){te(e,t);var n=X(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ie(e,t.type,n):t.hasOwnProperty("defaultValue")&&ie(e,t.type,X(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function re(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ie(e,t,n){"number"===t&&J(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function ae(e,t){return e=i({children:void 0},t),(t=function(e){var t="";return r.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function se(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+X(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function oe(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return i({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ue(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(s(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(s(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:X(n)}}function le(e,t){var n=X(t.value),r=X(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ce(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var de="http://www.w3.org/1999/xhtml";function he(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function fe(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?he(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var pe,ge,me=(ge=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((pe=pe||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=pe.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ge(e,t)}))}:ge);function ye(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var ve={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},be=["Webkit","ms","Moz","O"];function xe(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||ve.hasOwnProperty(e)&&ve[e]?(""+t).trim():t+"px"}function we(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=xe(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(ve).forEach((function(e){be.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),ve[t]=ve[e]}))}));var ke=i({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function _e(e,t){if(t){if(ke[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(s(62))}}function Se(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Ce(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ae=null,Ee=null,Fe=null;function Ie(e){if(e=ti(e)){if("function"!=typeof Ae)throw Error(s(280));var t=e.stateNode;t&&(t=ri(t),Ae(e.stateNode,e.type,t))}}function De(e){Ee?Fe?Fe.push(e):Fe=[e]:Ee=e}function Ne(){if(Ee){var e=Ee,t=Fe;if(Fe=Ee=null,Ie(e),t)for(e=0;e<t.length;e++)Ie(t[e])}}function $e(e,t){return e(t)}function Te(e,t,n,r,i){return e(t,n,r,i)}function Oe(){}var Me=$e,Re=!1,Be=!1;function ze(){null===Ee&&null===Fe||(Oe(),Ne())}function Le(e,t){var n=e.stateNode;if(null===n)return null;var r=ri(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(s(231,t,typeof n));return n}var Pe=!1;if(d)try{var je={};Object.defineProperty(je,"passive",{get:function(){Pe=!0}}),window.addEventListener("test",je,je),window.removeEventListener("test",je,je)}catch(ge){Pe=!1}function Ue(e,t,n,r,i,a,s,o,u){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(e){this.onError(e)}}var We=!1,Ve=null,Ge=!1,qe=null,He={onError:function(e){We=!0,Ve=e}};function Xe(e,t,n,r,i,a,s,o,u){We=!1,Ve=null,Ue.apply(He,arguments)}function Ke(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!=(1026&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ye(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function Qe(e){if(Ke(e)!==e)throw Error(s(188))}function Je(e,t){for(var n=e.alternate;null!==t;){if(t===e||t===n)return!0;t=t.return}return!1}var Ze,et,tt,nt,rt=!1,it=[],at=null,st=null,ot=null,ut=new Map,lt=new Map,ct=[],dt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ht(e,t,n,r,i){return{blockedOn:e,domEventName:t,eventSystemFlags:16|n,nativeEvent:i,targetContainers:[r]}}function ft(e,t){switch(e){case"focusin":case"focusout":at=null;break;case"dragenter":case"dragleave":st=null;break;case"mouseover":case"mouseout":ot=null;break;case"pointerover":case"pointerout":ut.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":lt.delete(t.pointerId)}}function pt(e,t,n,r,i,a){return null===e||e.nativeEvent!==a?(e=ht(t,n,r,i,a),null!==t&&null!==(t=ti(t))&&et(t),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function gt(e){var t=ei(e.target);if(null!==t){var n=Ke(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ye(n)))return e.blockedOn=t,void nt(e.lanePriority,(function(){a.unstable_runWithPriority(e.priority,(function(){tt(n)}))}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function mt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=ti(n))&&et(t),e.blockedOn=n,!1;t.shift()}return!0}function yt(e,t,n){mt(e)&&n.delete(t)}function vt(){for(rt=!1;0<it.length;){var e=it[0];if(null!==e.blockedOn){null!==(e=ti(e.blockedOn))&&Ze(e);break}for(var t=e.targetContainers;0<t.length;){var n=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n){e.blockedOn=n;break}t.shift()}null===e.blockedOn&&it.shift()}null!==at&&mt(at)&&(at=null),null!==st&&mt(st)&&(st=null),null!==ot&&mt(ot)&&(ot=null),ut.forEach(yt),lt.forEach(yt)}function bt(e,t){e.blockedOn===t&&(e.blockedOn=null,rt||(rt=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,vt)))}function xt(e){function t(t){return bt(t,e)}if(0<it.length){bt(it[0],e);for(var n=1;n<it.length;n++){var r=it[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==at&&bt(at,e),null!==st&&bt(st,e),null!==ot&&bt(ot,e),ut.forEach(t),lt.forEach(t),n=0;n<ct.length;n++)(r=ct[n]).blockedOn===e&&(r.blockedOn=null);for(;0<ct.length&&null===(n=ct[0]).blockedOn;)gt(n),null===n.blockedOn&&ct.shift()}function wt(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var kt={animationend:wt("Animation","AnimationEnd"),animationiteration:wt("Animation","AnimationIteration"),animationstart:wt("Animation","AnimationStart"),transitionend:wt("Transition","TransitionEnd")},_t={},St={};function Ct(e){if(_t[e])return _t[e];if(!kt[e])return e;var t,n=kt[e];for(t in n)if(n.hasOwnProperty(t)&&t in St)return _t[e]=n[t];return e}d&&(St=document.createElement("div").style,"AnimationEvent"in window||(delete kt.animationend.animation,delete kt.animationiteration.animation,delete kt.animationstart.animation),"TransitionEvent"in window||delete kt.transitionend.transition);var At=Ct("animationend"),Et=Ct("animationiteration"),Ft=Ct("animationstart"),It=Ct("transitionend"),Dt=new Map,Nt=new Map,$t=["abort","abort",At,"animationEnd",Et,"animationIteration",Ft,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",It,"transitionEnd","waiting","waiting"];function Tt(e,t){for(var n=0;n<e.length;n+=2){var r=e[n],i=e[n+1];i="on"+(i[0].toUpperCase()+i.slice(1)),Nt.set(r,t),Dt.set(r,i),l(i,[r])}}(0,a.unstable_now)();var Ot=8;function Mt(e){if(0!=(1&e))return Ot=15,1;if(0!=(2&e))return Ot=14,2;if(0!=(4&e))return Ot=13,4;var t=24&e;return 0!==t?(Ot=12,t):0!=(32&e)?(Ot=11,32):0!=(t=192&e)?(Ot=10,t):0!=(256&e)?(Ot=9,256):0!=(t=3584&e)?(Ot=8,t):0!=(4096&e)?(Ot=7,4096):0!=(t=4186112&e)?(Ot=6,t):0!=(t=62914560&e)?(Ot=5,t):67108864&e?(Ot=4,67108864):0!=(134217728&e)?(Ot=3,134217728):0!=(t=805306368&e)?(Ot=2,t):0!=(1073741824&e)?(Ot=1,1073741824):(Ot=8,e)}function Rt(e,t){var n=e.pendingLanes;if(0===n)return Ot=0;var r=0,i=0,a=e.expiredLanes,s=e.suspendedLanes,o=e.pingedLanes;if(0!==a)r=a,i=Ot=15;else if(0!=(a=134217727&n)){var u=a&~s;0!==u?(r=Mt(u),i=Ot):0!=(o&=a)&&(r=Mt(o),i=Ot)}else 0!=(a=n&~s)?(r=Mt(a),i=Ot):0!==o&&(r=Mt(o),i=Ot);if(0===r)return 0;if(r=n&((0>(r=31-Ut(r))?0:1<<r)<<1)-1,0!==t&&t!==r&&0==(t&s)){if(Mt(t),i<=Ot)return t;Ot=i}if(0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-Ut(t)),r|=e[n],t&=~i;return r}function Bt(e){return 0!=(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function zt(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return 0===(e=Lt(24&~t))?zt(10,t):e;case 10:return 0===(e=Lt(192&~t))?zt(8,t):e;case 8:return 0===(e=Lt(3584&~t))&&0===(e=Lt(4186112&~t))&&(e=512),e;case 2:return 0===(t=Lt(805306368&~t))&&(t=268435456),t}throw Error(s(358,e))}function Lt(e){return e&-e}function Pt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function jt(e,t,n){e.pendingLanes|=t;var r=t-1;e.suspendedLanes&=r,e.pingedLanes&=r,(e=e.eventTimes)[t=31-Ut(t)]=n}var Ut=Math.clz32?Math.clz32:function(e){return 0===e?32:31-(Wt(e)/Vt|0)|0},Wt=Math.log,Vt=Math.LN2,Gt=a.unstable_UserBlockingPriority,qt=a.unstable_runWithPriority,Ht=!0;function Xt(e,t,n,r){Re||Oe();var i=Yt,a=Re;Re=!0;try{Te(i,e,t,n,r)}finally{(Re=a)||ze()}}function Kt(e,t,n,r){qt(Gt,Yt.bind(null,e,t,n,r))}function Yt(e,t,n,r){var i;if(Ht)if((i=0==(4&t))&&0<it.length&&-1<dt.indexOf(e))e=ht(null,e,t,n,r),it.push(e);else{var a=Qt(e,t,n,r);if(null===a)i&&ft(e,r);else{if(i){if(-1<dt.indexOf(e))return e=ht(a,e,t,n,r),void it.push(e);if(function(e,t,n,r,i){switch(t){case"focusin":return at=pt(at,e,t,n,r,i),!0;case"dragenter":return st=pt(st,e,t,n,r,i),!0;case"mouseover":return ot=pt(ot,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return ut.set(a,pt(ut.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,lt.set(a,pt(lt.get(a)||null,e,t,n,r,i)),!0}return!1}(a,e,t,n,r))return;ft(e,r)}Tr(e,t,r,null,n)}}}function Qt(e,t,n,r){var i=Ce(r);if(null!==(i=ei(i))){var a=Ke(i);if(null===a)i=null;else{var s=a.tag;if(13===s){if(null!==(i=Ye(a)))return i;i=null}else if(3===s){if(a.stateNode.hydrate)return 3===a.tag?a.stateNode.containerInfo:null;i=null}else a!==i&&(i=null)}}return Tr(e,t,r,i,n),null}var Jt=null,Zt=null,en=null;function tn(){if(en)return en;var e,t,n=Zt,r=n.length,i="value"in Jt?Jt.value:Jt.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===i[a-t];t++);return en=i.slice(e,1<t?1-t:void 0)}function nn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function rn(){return!0}function an(){return!1}function sn(e){function t(t,n,r,i,a){for(var s in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(i):i[s]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?rn:an,this.isPropagationStopped=an,this}return i(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=rn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=rn)},persist:function(){},isPersistent:rn}),t}var on,un,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dn=sn(cn),hn=i({},cn,{view:0,detail:0}),fn=sn(hn),pn=i({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:An,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(on=e.screenX-ln.screenX,un=e.screenY-ln.screenY):un=on=0,ln=e),on)},movementY:function(e){return"movementY"in e?e.movementY:un}}),gn=sn(pn),mn=sn(i({},pn,{dataTransfer:0})),yn=sn(i({},hn,{relatedTarget:0})),vn=sn(i({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),bn=i({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),xn=sn(bn),wn=sn(i({},cn,{data:0})),kn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_n={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Cn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function An(){return Cn}var En=i({},hn,{key:function(e){if(e.key){var t=kn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=nn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?_n[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:An,charCode:function(e){return"keypress"===e.type?nn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?nn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Fn=sn(En),In=sn(i({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Dn=sn(i({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:An})),Nn=sn(i({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),$n=i({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Tn=sn($n),On=[9,13,27,32],Mn=d&&"CompositionEvent"in window,Rn=null;d&&"documentMode"in document&&(Rn=document.documentMode);var Bn=d&&"TextEvent"in window&&!Rn,zn=d&&(!Mn||Rn&&8<Rn&&11>=Rn),Ln=String.fromCharCode(32),Pn=!1;function jn(e,t){switch(e){case"keyup":return-1!==On.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Un(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Wn=!1,Vn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Vn[e.type]:"textarea"===t}function qn(e,t,n,r){De(r),0<(t=Mr(t,"onChange")).length&&(n=new dn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Hn=null,Xn=null;function Kn(e){Er(e,0)}function Yn(e){if(Q(ni(e)))return e}function Qn(e,t){if("change"===e)return t}var Jn=!1;if(d){var Zn;if(d){var er="oninput"in document;if(!er){var tr=document.createElement("div");tr.setAttribute("oninput","return;"),er="function"==typeof tr.oninput}Zn=er}else Zn=!1;Jn=Zn&&(!document.documentMode||9<document.documentMode)}function nr(){Hn&&(Hn.detachEvent("onpropertychange",rr),Xn=Hn=null)}function rr(e){if("value"===e.propertyName&&Yn(Xn)){var t=[];if(qn(t,Xn,e,Ce(e)),e=Kn,Re)e(t);else{Re=!0;try{$e(e,t)}finally{Re=!1,ze()}}}}function ir(e,t,n){"focusin"===e?(nr(),Xn=n,(Hn=t).attachEvent("onpropertychange",rr)):"focusout"===e&&nr()}function ar(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(Xn)}function sr(e,t){if("click"===e)return Yn(t)}function or(e,t){if("input"===e||"change"===e)return Yn(t)}var ur="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},lr=Object.prototype.hasOwnProperty;function cr(e,t){if(ur(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!lr.call(t,n[r])||!ur(e[n[r]],t[n[r]]))return!1;return!0}function dr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function hr(e,t){var n,r=dr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=dr(r)}}function fr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?fr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function pr(){for(var e=window,t=J();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=J((e=t.contentWindow).document)}return t}function gr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var mr=d&&"documentMode"in document&&11>=document.documentMode,yr=null,vr=null,br=null,xr=!1;function wr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;xr||null==yr||yr!==J(r)||(r="selectionStart"in(r=yr)&&gr(r)?{start:r.selectionStart,end:r.selectionEnd}:{anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},br&&cr(br,r)||(br=r,0<(r=Mr(vr,"onSelect")).length&&(t=new dn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=yr)))}Tt("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Tt("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Tt($t,2);for(var kr="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),_r=0;_r<kr.length;_r++)Nt.set(kr[_r],0);c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Sr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Cr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Sr));function Ar(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,a,o,u,l){if(Xe.apply(this,arguments),We){if(!We)throw Error(s(198));var c=Ve;We=!1,Ve=null,Ge||(Ge=!0,qe=c)}}(r,t,void 0,e),e.currentTarget=null}function Er(e,t){t=0!=(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var s=r.length-1;0<=s;s--){var o=r[s],u=o.instance,l=o.currentTarget;if(o=o.listener,u!==a&&i.isPropagationStopped())break e;Ar(i,o,l),a=u}else for(s=0;s<r.length;s++){if(u=(o=r[s]).instance,l=o.currentTarget,o=o.listener,u!==a&&i.isPropagationStopped())break e;Ar(i,o,l),a=u}}}if(Ge)throw e=qe,Ge=!1,qe=null,e}function Fr(e,t){var n=ii(t),r=e+"__bubble";n.has(r)||($r(t,e,2,!1),n.add(r))}var Ir="_reactListening"+Math.random().toString(36).slice(2);function Dr(e){e[Ir]||(e[Ir]=!0,o.forEach((function(t){Cr.has(t)||Nr(t,!1,e,null),Nr(t,!0,e,null)})))}function Nr(e,t,n,r){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,a=n;if("selectionchange"===e&&9!==n.nodeType&&(a=n.ownerDocument),null!==r&&!t&&Cr.has(e)){if("scroll"!==e)return;i|=2,a=r}var s=ii(a),o=e+"__"+(t?"capture":"bubble");s.has(o)||(t&&(i|=4),$r(a,e,i,t),s.add(o))}function $r(e,t,n,r){var i=Nt.get(t);switch(void 0===i?2:i){case 0:i=Xt;break;case 1:i=Kt;break;default:i=Yt}n=i.bind(null,t,n,e),i=void 0,!Pe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Tr(e,t,n,r,i){var a=r;if(0==(1&t)&&0==(2&t)&&null!==r)e:for(;;){if(null===r)return;var s=r.tag;if(3===s||4===s){var o=r.stateNode.containerInfo;if(o===i||8===o.nodeType&&o.parentNode===i)break;if(4===s)for(s=r.return;null!==s;){var u=s.tag;if((3===u||4===u)&&((u=s.stateNode.containerInfo)===i||8===u.nodeType&&u.parentNode===i))return;s=s.return}for(;null!==o;){if(null===(s=ei(o)))return;if(5===(u=s.tag)||6===u){r=a=s;continue e}o=o.parentNode}}r=r.return}!function(e,t,n){if(Be)return e();Be=!0;try{Me(e,t,n)}finally{Be=!1,ze()}}((function(){var r=a,i=Ce(n),s=[];e:{var o=Dt.get(e);if(void 0!==o){var u=dn,l=e;switch(e){case"keypress":if(0===nn(n))break e;case"keydown":case"keyup":u=Fn;break;case"focusin":l="focus",u=yn;break;case"focusout":l="blur",u=yn;break;case"beforeblur":case"afterblur":u=yn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=gn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=Dn;break;case At:case Et:case Ft:u=vn;break;case It:u=Nn;break;case"scroll":u=fn;break;case"wheel":u=Tn;break;case"copy":case"cut":case"paste":u=xn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=In}var c=0!=(4&t),d=!c&&"scroll"===e,h=c?null!==o?o+"Capture":null:o;c=[];for(var f,p=r;null!==p;){var g=(f=p).stateNode;if(5===f.tag&&null!==g&&(f=g,null!==h&&null!=(g=Le(p,h))&&c.push(Or(p,g,f))),d)break;p=p.return}0<c.length&&(o=new u(o,l,null,n,i),s.push({event:o,listeners:c}))}}if(0==(7&t)){if(u="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||0!=(16&t)||!(l=n.relatedTarget||n.fromElement)||!ei(l)&&!l[Jr])&&(u||o)&&(o=i.window===i?i:(o=i.ownerDocument)?o.defaultView||o.parentWindow:window,u?(u=r,null!==(l=(l=n.relatedTarget||n.toElement)?ei(l):null)&&(l!==(d=Ke(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(u=null,l=r),u!==l)){if(c=gn,g="onMouseLeave",h="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(c=In,g="onPointerLeave",h="onPointerEnter",p="pointer"),d=null==u?o:ni(u),f=null==l?o:ni(l),(o=new c(g,p+"leave",u,n,i)).target=d,o.relatedTarget=f,g=null,ei(i)===r&&((c=new c(h,p+"enter",l,n,i)).target=f,c.relatedTarget=d,g=c),d=g,u&&l)e:{for(h=l,p=0,f=c=u;f;f=Rr(f))p++;for(f=0,g=h;g;g=Rr(g))f++;for(;0<p-f;)c=Rr(c),p--;for(;0<f-p;)h=Rr(h),f--;for(;p--;){if(c===h||null!==h&&c===h.alternate)break e;c=Rr(c),h=Rr(h)}c=null}else c=null;null!==u&&Br(s,o,u,c,!1),null!==l&&null!==d&&Br(s,d,l,c,!0)}if("select"===(u=(o=r?ni(r):window).nodeName&&o.nodeName.toLowerCase())||"input"===u&&"file"===o.type)var m=Qn;else if(Gn(o))if(Jn)m=or;else{m=ar;var y=ir}else(u=o.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(m=sr);switch(m&&(m=m(e,r))?qn(s,m,n,i):(y&&y(e,o,r),"focusout"===e&&(y=o._wrapperState)&&y.controlled&&"number"===o.type&&ie(o,"number",o.value)),y=r?ni(r):window,e){case"focusin":(Gn(y)||"true"===y.contentEditable)&&(yr=y,vr=r,br=null);break;case"focusout":br=vr=yr=null;break;case"mousedown":xr=!0;break;case"contextmenu":case"mouseup":case"dragend":xr=!1,wr(s,n,i);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":wr(s,n,i)}var v;if(Mn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Wn?jn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(zn&&"ko"!==n.locale&&(Wn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Wn&&(v=tn()):(Zt="value"in(Jt=i)?Jt.value:Jt.textContent,Wn=!0)),0<(y=Mr(r,b)).length&&(b=new wn(b,e,null,n,i),s.push({event:b,listeners:y}),(v||null!==(v=Un(n)))&&(b.data=v))),(v=Bn?function(e,t){switch(e){case"compositionend":return Un(t);case"keypress":return 32!==t.which?null:(Pn=!0,Ln);case"textInput":return(e=t.data)===Ln&&Pn?null:e;default:return null}}(e,n):function(e,t){if(Wn)return"compositionend"===e||!Mn&&jn(e,t)?(e=tn(),en=Zt=Jt=null,Wn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return zn&&"ko"!==t.locale?null:t.data}}(e,n))&&0<(r=Mr(r,"onBeforeInput")).length&&(i=new wn("onBeforeInput","beforeinput",null,n,i),s.push({event:i,listeners:r}),i.data=v)}Er(s,t)}))}function Or(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Mr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,a=i.stateNode;5===i.tag&&null!==a&&(i=a,null!=(a=Le(e,n))&&r.unshift(Or(e,a,i)),null!=(a=Le(e,t))&&r.push(Or(e,a,i))),e=e.return}return r}function Rr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Br(e,t,n,r,i){for(var a=t._reactName,s=[];null!==n&&n!==r;){var o=n,u=o.alternate,l=o.stateNode;if(null!==u&&u===r)break;5===o.tag&&null!==l&&(o=l,i?null!=(u=Le(n,a))&&s.unshift(Or(n,u,o)):i||null!=(u=Le(n,a))&&s.push(Or(n,u,o))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}function zr(){}var Lr=null,Pr=null;function jr(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function Ur(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Wr="function"==typeof setTimeout?setTimeout:void 0,Vr="function"==typeof clearTimeout?clearTimeout:void 0;function Gr(e){(1===e.nodeType||9===e.nodeType&&null!=(e=e.body))&&(e.textContent="")}function qr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function Hr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var Xr=0,Kr=Math.random().toString(36).slice(2),Yr="__reactFiber$"+Kr,Qr="__reactProps$"+Kr,Jr="__reactContainer$"+Kr,Zr="__reactEvents$"+Kr;function ei(e){var t=e[Yr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Jr]||n[Yr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=Hr(e);null!==e;){if(n=e[Yr])return n;e=Hr(e)}return t}n=(e=n).parentNode}return null}function ti(e){return!(e=e[Yr]||e[Jr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function ni(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function ri(e){return e[Qr]||null}function ii(e){var t=e[Zr];return void 0===t&&(t=e[Zr]=new Set),t}var ai=[],si=-1;function oi(e){return{current:e}}function ui(e){0>si||(e.current=ai[si],ai[si]=null,si--)}function li(e,t){si++,ai[si]=e.current,e.current=t}var ci={},di=oi(ci),hi=oi(!1),fi=ci;function pi(e,t){var n=e.type.contextTypes;if(!n)return ci;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,a={};for(i in n)a[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function gi(e){return null!=e.childContextTypes}function mi(){ui(hi),ui(di)}function yi(e,t,n){if(di.current!==ci)throw Error(s(168));li(di,t),li(hi,n)}function vi(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in e))throw Error(s(108,H(t)||"Unknown",a));return i({},n,r)}function bi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ci,fi=di.current,li(di,e),li(hi,hi.current),!0}function xi(e,t,n){var r=e.stateNode;if(!r)throw Error(s(169));n?(e=vi(e,t,fi),r.__reactInternalMemoizedMergedChildContext=e,ui(hi),ui(di),li(di,e)):ui(hi),li(hi,n)}var wi=null,ki=null,_i=a.unstable_runWithPriority,Si=a.unstable_scheduleCallback,Ci=a.unstable_cancelCallback,Ai=a.unstable_shouldYield,Ei=a.unstable_requestPaint,Fi=a.unstable_now,Ii=a.unstable_getCurrentPriorityLevel,Di=a.unstable_ImmediatePriority,Ni=a.unstable_UserBlockingPriority,$i=a.unstable_NormalPriority,Ti=a.unstable_LowPriority,Oi=a.unstable_IdlePriority,Mi={},Ri=void 0!==Ei?Ei:function(){},Bi=null,zi=null,Li=!1,Pi=Fi(),ji=1e4>Pi?Fi:function(){return Fi()-Pi};function Ui(){switch(Ii()){case Di:return 99;case Ni:return 98;case $i:return 97;case Ti:return 96;case Oi:return 95;default:throw Error(s(332))}}function Wi(e){switch(e){case 99:return Di;case 98:return Ni;case 97:return $i;case 96:return Ti;case 95:return Oi;default:throw Error(s(332))}}function Vi(e,t){return e=Wi(e),_i(e,t)}function Gi(e,t,n){return e=Wi(e),Si(e,t,n)}function qi(){if(null!==zi){var e=zi;zi=null,Ci(e)}Hi()}function Hi(){if(!Li&&null!==Bi){Li=!0;var e=0;try{var t=Bi;Vi(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),Bi=null}catch(t){throw null!==Bi&&(Bi=Bi.slice(e+1)),Si(Di,qi),t}finally{Li=!1}}}var Xi=w.ReactCurrentBatchConfig;function Ki(e,t){if(e&&e.defaultProps){for(var n in t=i({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var Yi=oi(null),Qi=null,Ji=null,Zi=null;function ea(){Zi=Ji=Qi=null}function ta(e){var t=Yi.current;ui(Yi),e.type._context._currentValue=t}function na(e,t){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)===t){if(null===n||(n.childLanes&t)===t)break;n.childLanes|=t}else e.childLanes|=t,null!==n&&(n.childLanes|=t);e=e.return}}function ra(e,t){Qi=e,Zi=Ji=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!=(e.lanes&t)&&(Os=!0),e.firstContext=null)}function ia(e,t){if(Zi!==e&&!1!==t&&0!==t)if("number"==typeof t&&1073741823!==t||(Zi=e,t=1073741823),t={context:e,observedBits:t,next:null},null===Ji){if(null===Qi)throw Error(s(308));Ji=t,Qi.dependencies={lanes:0,firstContext:t,responders:null}}else Ji=Ji.next=t;return e._currentValue}var aa=!1;function sa(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function oa(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ua(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function la(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function ca(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?i=a=s:a=a.next=s,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function da(e,t,n,r){var a=e.updateQueue;aa=!1;var s=a.firstBaseUpdate,o=a.lastBaseUpdate,u=a.shared.pending;if(null!==u){a.shared.pending=null;var l=u,c=l.next;l.next=null,null===o?s=c:o.next=c,o=l;var d=e.alternate;if(null!==d){var h=(d=d.updateQueue).lastBaseUpdate;h!==o&&(null===h?d.firstBaseUpdate=c:h.next=c,d.lastBaseUpdate=l)}}if(null!==s){for(h=a.baseState,o=0,d=c=l=null;;){u=s.lane;var f=s.eventTime;if((r&u)===u){null!==d&&(d=d.next={eventTime:f,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=e,g=s;switch(u=t,f=n,g.tag){case 1:if("function"==typeof(p=g.payload)){h=p.call(f,h,u);break e}h=p;break e;case 3:p.flags=-4097&p.flags|64;case 0:if(null==(u="function"==typeof(p=g.payload)?p.call(f,h,u):p))break e;h=i({},h,u);break e;case 2:aa=!0}}null!==s.callback&&(e.flags|=32,null===(u=a.effects)?a.effects=[s]:u.push(s))}else f={eventTime:f,lane:u,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===d?(c=d=f,l=h):d=d.next=f,o|=u;if(null===(s=s.next)){if(null===(u=a.shared.pending))break;s=u.next,u.next=null,a.lastBaseUpdate=u,a.shared.pending=null}}null===d&&(l=h),a.baseState=l,a.firstBaseUpdate=c,a.lastBaseUpdate=d,Bo|=o,e.lanes=o,e.memoizedState=h}}function ha(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!=typeof i)throw Error(s(191,i));i.call(r)}}}var fa=(new r.Component).refs;function pa(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:i({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ga={isMounted:function(e){return!!(e=e._reactInternals)&&Ke(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=uu(),i=lu(e),a=ua(r,i);a.payload=t,null!=n&&(a.callback=n),la(e,a),cu(e,i,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=uu(),i=lu(e),a=ua(r,i);a.tag=1,a.payload=t,null!=n&&(a.callback=n),la(e,a),cu(e,i,r)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=uu(),r=lu(e),i=ua(n,r);i.tag=2,null!=t&&(i.callback=t),la(e,i),cu(e,r,n)}};function ma(e,t,n,r,i,a,s){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,s):!(t.prototype&&t.prototype.isPureReactComponent&&cr(n,r)&&cr(i,a))}function ya(e,t,n){var r=!1,i=ci,a=t.contextType;return"object"==typeof a&&null!==a?a=ia(a):(i=gi(t)?fi:di.current,a=(r=null!=(r=t.contextTypes))?pi(e,i):ci),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ga,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function va(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ga.enqueueReplaceState(t,t.state,null)}function ba(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=fa,sa(e);var a=t.contextType;"object"==typeof a&&null!==a?i.context=ia(a):(a=gi(t)?fi:di.current,i.context=pi(e,a)),da(e,n,i,r),i.state=e.memoizedState,"function"==typeof(a=t.getDerivedStateFromProps)&&(pa(e,t,a,n),i.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(t=i.state,"function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&ga.enqueueReplaceState(i,i.state,null),da(e,n,i,r),i.state=e.memoizedState),"function"==typeof i.componentDidMount&&(e.flags|=4)}var xa=Array.isArray;function wa(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var r=n.stateNode}if(!r)throw Error(s(147,e));var i=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===i?t.ref:(t=function(e){var t=r.refs;t===fa&&(t=r.refs={}),null===e?delete t[i]:t[i]=e},t._stringRef=i,t)}if("string"!=typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function ka(e,t){if("textarea"!==e.type)throw Error(s(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function _a(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.flags=8}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Pu(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags=2,n):r:(t.flags=2,n):n}function o(t){return e&&null===t.alternate&&(t.flags=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Vu(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function l(e,t,n,r){return null!==t&&t.elementType===n.type?((r=i(t,n.props)).ref=wa(e,t,n),r.return=e,r):((r=ju(n.type,n.key,n.props,null,e.mode,r)).ref=wa(e,t,n),r.return=e,r)}function c(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Gu(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,a){return null===t||7!==t.tag?((t=Uu(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function h(e,t,n){if("string"==typeof t||"number"==typeof t)return(t=Vu(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case k:return(n=ju(t.type,t.key,t.props,null,e.mode,n)).ref=wa(e,null,t),n.return=e,n;case _:return(t=Gu(t,e.mode,n)).return=e,t}if(xa(t)||U(t))return(t=Uu(t,e.mode,n,null)).return=e,t;ka(e,t)}return null}function f(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n||"number"==typeof n)return null!==i?null:u(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case k:return n.key===i?n.type===S?d(e,t,n.props.children,r,i):l(e,t,n,r):null;case _:return n.key===i?c(e,t,n,r):null}if(xa(n)||U(n))return null!==i?null:d(e,t,n,r,null);ka(e,n)}return null}function p(e,t,n,r,i){if("string"==typeof r||"number"==typeof r)return u(t,e=e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case k:return e=e.get(null===r.key?n:r.key)||null,r.type===S?d(t,e,r.props.children,i,r.key):l(t,e,r,i);case _:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i)}if(xa(r)||U(r))return d(t,e=e.get(n)||null,r,i,null);ka(t,r)}return null}function g(i,s,o,u){for(var l=null,c=null,d=s,g=s=0,m=null;null!==d&&g<o.length;g++){d.index>g?(m=d,d=null):m=d.sibling;var y=f(i,d,o[g],u);if(null===y){null===d&&(d=m);break}e&&d&&null===y.alternate&&t(i,d),s=a(y,s,g),null===c?l=y:c.sibling=y,c=y,d=m}if(g===o.length)return n(i,d),l;if(null===d){for(;g<o.length;g++)null!==(d=h(i,o[g],u))&&(s=a(d,s,g),null===c?l=d:c.sibling=d,c=d);return l}for(d=r(i,d);g<o.length;g++)null!==(m=p(d,i,g,o[g],u))&&(e&&null!==m.alternate&&d.delete(null===m.key?g:m.key),s=a(m,s,g),null===c?l=m:c.sibling=m,c=m);return e&&d.forEach((function(e){return t(i,e)})),l}function m(i,o,u,l){var c=U(u);if("function"!=typeof c)throw Error(s(150));if(null==(u=c.call(u)))throw Error(s(151));for(var d=c=null,g=o,m=o=0,y=null,v=u.next();null!==g&&!v.done;m++,v=u.next()){g.index>m?(y=g,g=null):y=g.sibling;var b=f(i,g,v.value,l);if(null===b){null===g&&(g=y);break}e&&g&&null===b.alternate&&t(i,g),o=a(b,o,m),null===d?c=b:d.sibling=b,d=b,g=y}if(v.done)return n(i,g),c;if(null===g){for(;!v.done;m++,v=u.next())null!==(v=h(i,v.value,l))&&(o=a(v,o,m),null===d?c=v:d.sibling=v,d=v);return c}for(g=r(i,g);!v.done;m++,v=u.next())null!==(v=p(g,i,m,v.value,l))&&(e&&null!==v.alternate&&g.delete(null===v.key?m:v.key),o=a(v,o,m),null===d?c=v:d.sibling=v,d=v);return e&&g.forEach((function(e){return t(i,e)})),c}return function(e,r,a,u){var l="object"==typeof a&&null!==a&&a.type===S&&null===a.key;l&&(a=a.props.children);var c="object"==typeof a&&null!==a;if(c)switch(a.$$typeof){case k:e:{for(c=a.key,l=r;null!==l;){if(l.key===c){if(7===l.tag){if(a.type===S){n(e,l.sibling),(r=i(l,a.props.children)).return=e,e=r;break e}}else if(l.elementType===a.type){n(e,l.sibling),(r=i(l,a.props)).ref=wa(e,l,a),r.return=e,e=r;break e}n(e,l);break}t(e,l),l=l.sibling}a.type===S?((r=Uu(a.props.children,e.mode,u,a.key)).return=e,e=r):((u=ju(a.type,a.key,a.props,null,e.mode,u)).ref=wa(e,r,a),u.return=e,e=u)}return o(e);case _:e:{for(l=a.key;null!==r;){if(r.key===l){if(4===r.tag&&r.stateNode.containerInfo===a.containerInfo&&r.stateNode.implementation===a.implementation){n(e,r.sibling),(r=i(r,a.children||[])).return=e,e=r;break e}n(e,r);break}t(e,r),r=r.sibling}(r=Gu(a,e.mode,u)).return=e,e=r}return o(e)}if("string"==typeof a||"number"==typeof a)return a=""+a,null!==r&&6===r.tag?(n(e,r.sibling),(r=i(r,a)).return=e,e=r):(n(e,r),(r=Vu(a,e.mode,u)).return=e,e=r),o(e);if(xa(a))return g(e,r,a,u);if(U(a))return m(e,r,a,u);if(c&&ka(e,a),void 0===a&&!l)switch(e.tag){case 1:case 22:case 0:case 11:case 15:throw Error(s(152,H(e.type)||"Component"))}return n(e,r)}}var Sa=_a(!0),Ca=_a(!1),Aa={},Ea=oi(Aa),Fa=oi(Aa),Ia=oi(Aa);function Da(e){if(e===Aa)throw Error(s(174));return e}function Na(e,t){switch(li(Ia,t),li(Fa,e),li(Ea,Aa),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:fe(null,"");break;default:t=fe(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}ui(Ea),li(Ea,t)}function $a(){ui(Ea),ui(Fa),ui(Ia)}function Ta(e){Da(Ia.current);var t=Da(Ea.current),n=fe(t,e.type);t!==n&&(li(Fa,e),li(Ea,n))}function Oa(e){Fa.current===e&&(ui(Ea),ui(Fa))}var Ma=oi(0);function Ra(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(64&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Ba=null,za=null,La=!1;function Pa(e,t){var n=zu(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.flags=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function ja(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);default:return!1}}function Ua(e){if(La){var t=za;if(t){var n=t;if(!ja(e,t)){if(!(t=qr(n.nextSibling))||!ja(e,t))return e.flags=-1025&e.flags|2,La=!1,void(Ba=e);Pa(Ba,n)}Ba=e,za=qr(t.firstChild)}else e.flags=-1025&e.flags|2,La=!1,Ba=e}}function Wa(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Ba=e}function Va(e){if(e!==Ba)return!1;if(!La)return Wa(e),La=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!Ur(t,e.memoizedProps))for(t=za;t;)Pa(e,t),t=qr(t.nextSibling);if(Wa(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){za=qr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}za=null}}else za=Ba?qr(e.stateNode.nextSibling):null;return!0}function Ga(){za=Ba=null,La=!1}var qa=[];function Ha(){for(var e=0;e<qa.length;e++)qa[e]._workInProgressVersionPrimary=null;qa.length=0}var Xa=w.ReactCurrentDispatcher,Ka=w.ReactCurrentBatchConfig,Ya=0,Qa=null,Ja=null,Za=null,es=!1,ts=!1;function ns(){throw Error(s(321))}function rs(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ur(e[n],t[n]))return!1;return!0}function is(e,t,n,r,i,a){if(Ya=a,Qa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Xa.current=null===e||null===e.memoizedState?Ds:Ns,e=n(r,i),ts){a=0;do{if(ts=!1,!(25>a))throw Error(s(301));a+=1,Za=Ja=null,t.updateQueue=null,Xa.current=$s,e=n(r,i)}while(ts)}if(Xa.current=Is,t=null!==Ja&&null!==Ja.next,Ya=0,Za=Ja=Qa=null,es=!1,t)throw Error(s(300));return e}function as(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Za?Qa.memoizedState=Za=e:Za=Za.next=e,Za}function ss(){if(null===Ja){var e=Qa.alternate;e=null!==e?e.memoizedState:null}else e=Ja.next;var t=null===Za?Qa.memoizedState:Za.next;if(null!==t)Za=t,Ja=e;else{if(null===e)throw Error(s(310));e={memoizedState:(Ja=e).memoizedState,baseState:Ja.baseState,baseQueue:Ja.baseQueue,queue:Ja.queue,next:null},null===Za?Qa.memoizedState=Za=e:Za=Za.next=e}return Za}function os(e,t){return"function"==typeof t?t(e):t}function us(e){var t=ss(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=Ja,i=r.baseQueue,a=n.pending;if(null!==a){if(null!==i){var o=i.next;i.next=a.next,a.next=o}r.baseQueue=i=a,n.pending=null}if(null!==i){i=i.next,r=r.baseState;var u=o=a=null,l=i;do{var c=l.lane;if((Ya&c)===c)null!==u&&(u=u.next={lane:0,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null}),r=l.eagerReducer===e?l.eagerState:e(r,l.action);else{var d={lane:c,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null};null===u?(o=u=d,a=r):u=u.next=d,Qa.lanes|=c,Bo|=c}l=l.next}while(null!==l&&l!==i);null===u?a=r:u.next=o,ur(r,t.memoizedState)||(Os=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=u,n.lastRenderedState=r}return[t.memoizedState,n.dispatch]}function ls(e){var t=ss(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,a=t.memoizedState;if(null!==i){n.pending=null;var o=i=i.next;do{a=e(a,o.action),o=o.next}while(o!==i);ur(a,t.memoizedState)||(Os=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function cs(e,t,n){var r=t._getVersion;r=r(t._source);var i=t._workInProgressVersionPrimary;if(null!==i?e=i===r:(e=e.mutableReadLanes,(e=(Ya&e)===e)&&(t._workInProgressVersionPrimary=r,qa.push(t))),e)return n(t._source);throw qa.push(t),Error(s(350))}function ds(e,t,n,r){var i=Io;if(null===i)throw Error(s(349));var a=t._getVersion,o=a(t._source),u=Xa.current,l=u.useState((function(){return cs(i,t,n)})),c=l[1],d=l[0];l=Za;var h=e.memoizedState,f=h.refs,p=f.getSnapshot,g=h.source;h=h.subscribe;var m=Qa;return e.memoizedState={refs:f,source:t,subscribe:r},u.useEffect((function(){f.getSnapshot=n,f.setSnapshot=c;var e=a(t._source);if(!ur(o,e)){e=n(t._source),ur(d,e)||(c(e),e=lu(m),i.mutableReadLanes|=e&i.pendingLanes),e=i.mutableReadLanes,i.entangledLanes|=e;for(var r=i.entanglements,s=e;0<s;){var u=31-Ut(s),l=1<<u;r[u]|=e,s&=~l}}}),[n,t,r]),u.useEffect((function(){return r(t._source,(function(){var e=f.getSnapshot,n=f.setSnapshot;try{n(e(t._source));var r=lu(m);i.mutableReadLanes|=r&i.pendingLanes}catch(e){n((function(){throw e}))}}))}),[t,r]),ur(p,n)&&ur(g,t)&&ur(h,r)||((e={pending:null,dispatch:null,lastRenderedReducer:os,lastRenderedState:d}).dispatch=c=Fs.bind(null,Qa,e),l.queue=e,l.baseQueue=null,d=cs(i,t,n),l.memoizedState=l.baseState=d),d}function hs(e,t,n){return ds(ss(),e,t,n)}function fs(e){var t=as();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:os,lastRenderedState:e}).dispatch=Fs.bind(null,Qa,e),[t.memoizedState,e]}function ps(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=Qa.updateQueue)?(t={lastEffect:null},Qa.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function gs(e){return e={current:e},as().memoizedState=e}function ms(){return ss().memoizedState}function ys(e,t,n,r){var i=as();Qa.flags|=e,i.memoizedState=ps(1|t,n,void 0,void 0===r?null:r)}function vs(e,t,n,r){var i=ss();r=void 0===r?null:r;var a=void 0;if(null!==Ja){var s=Ja.memoizedState;if(a=s.destroy,null!==r&&rs(r,s.deps))return void ps(t,n,a,r)}Qa.flags|=e,i.memoizedState=ps(1|t,n,a,r)}function bs(e,t){return ys(516,4,e,t)}function xs(e,t){return vs(516,4,e,t)}function ws(e,t){return vs(4,2,e,t)}function ks(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function _s(e,t,n){return n=null!=n?n.concat([e]):null,vs(4,2,ks.bind(null,t,e),n)}function Ss(){}function Cs(e,t){var n=ss();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&rs(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function As(e,t){var n=ss();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&rs(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Es(e,t){var n=Ui();Vi(98>n?98:n,(function(){e(!0)})),Vi(97<n?97:n,(function(){var n=Ka.transition;Ka.transition=1;try{e(!1),t()}finally{Ka.transition=n}}))}function Fs(e,t,n){var r=uu(),i=lu(e),a={lane:i,action:n,eagerReducer:null,eagerState:null,next:null},s=t.pending;if(null===s?a.next=a:(a.next=s.next,s.next=a),t.pending=a,s=e.alternate,e===Qa||null!==s&&s===Qa)ts=es=!0;else{if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var o=t.lastRenderedState,u=s(o,n);if(a.eagerReducer=s,a.eagerState=u,ur(u,o))return}catch(e){}cu(e,i,r)}}var Is={readContext:ia,useCallback:ns,useContext:ns,useEffect:ns,useImperativeHandle:ns,useLayoutEffect:ns,useMemo:ns,useReducer:ns,useRef:ns,useState:ns,useDebugValue:ns,useDeferredValue:ns,useTransition:ns,useMutableSource:ns,useOpaqueIdentifier:ns,unstable_isNewReconciler:!1},Ds={readContext:ia,useCallback:function(e,t){return as().memoizedState=[e,void 0===t?null:t],e},useContext:ia,useEffect:bs,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,ys(4,2,ks.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ys(4,2,e,t)},useMemo:function(e,t){var n=as();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=as();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=Fs.bind(null,Qa,e),[r.memoizedState,e]},useRef:gs,useState:fs,useDebugValue:Ss,useDeferredValue:function(e){var t=fs(e),n=t[0],r=t[1];return bs((function(){var t=Ka.transition;Ka.transition=1;try{r(e)}finally{Ka.transition=t}}),[e]),n},useTransition:function(){var e=fs(!1),t=e[0];return gs(e=Es.bind(null,e[1])),[e,t]},useMutableSource:function(e,t,n){var r=as();return r.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:n},ds(r,e,t,n)},useOpaqueIdentifier:function(){if(La){var e=!1,t=function(e){return{$$typeof:M,toString:e,valueOf:e}}((function(){throw e||(e=!0,n("r:"+(Xr++).toString(36))),Error(s(355))})),n=fs(t)[1];return 0==(2&Qa.mode)&&(Qa.flags|=516,ps(5,(function(){n("r:"+(Xr++).toString(36))}),void 0,null)),t}return fs(t="r:"+(Xr++).toString(36)),t},unstable_isNewReconciler:!1},Ns={readContext:ia,useCallback:Cs,useContext:ia,useEffect:xs,useImperativeHandle:_s,useLayoutEffect:ws,useMemo:As,useReducer:us,useRef:ms,useState:function(){return us(os)},useDebugValue:Ss,useDeferredValue:function(e){var t=us(os),n=t[0],r=t[1];return xs((function(){var t=Ka.transition;Ka.transition=1;try{r(e)}finally{Ka.transition=t}}),[e]),n},useTransition:function(){var e=us(os)[0];return[ms().current,e]},useMutableSource:hs,useOpaqueIdentifier:function(){return us(os)[0]},unstable_isNewReconciler:!1},$s={readContext:ia,useCallback:Cs,useContext:ia,useEffect:xs,useImperativeHandle:_s,useLayoutEffect:ws,useMemo:As,useReducer:ls,useRef:ms,useState:function(){return ls(os)},useDebugValue:Ss,useDeferredValue:function(e){var t=ls(os),n=t[0],r=t[1];return xs((function(){var t=Ka.transition;Ka.transition=1;try{r(e)}finally{Ka.transition=t}}),[e]),n},useTransition:function(){var e=ls(os)[0];return[ms().current,e]},useMutableSource:hs,useOpaqueIdentifier:function(){return ls(os)[0]},unstable_isNewReconciler:!1},Ts=w.ReactCurrentOwner,Os=!1;function Ms(e,t,n,r){t.child=null===e?Ca(t,null,n,r):Sa(t,e.child,n,r)}function Rs(e,t,n,r,i){n=n.render;var a=t.ref;return ra(t,i),r=is(e,t,n,r,a,i),null===e||Os?(t.flags|=1,Ms(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~i,eo(e,t,i))}function Bs(e,t,n,r,i,a){if(null===e){var s=n.type;return"function"!=typeof s||Lu(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=ju(n.type,null,r,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,zs(e,t,s,r,i,a))}return s=e.child,0==(i&a)&&(i=s.memoizedProps,(n=null!==(n=n.compare)?n:cr)(i,r)&&e.ref===t.ref)?eo(e,t,a):(t.flags|=1,(e=Pu(s,r)).ref=t.ref,e.return=t,t.child=e)}function zs(e,t,n,r,i,a){if(null!==e&&cr(e.memoizedProps,r)&&e.ref===t.ref){if(Os=!1,0==(a&i))return t.lanes=e.lanes,eo(e,t,a);0!=(16384&e.flags)&&(Os=!0)}return js(e,t,n,r,a)}function Ls(e,t,n){var r=t.pendingProps,i=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode||"unstable-defer-without-hiding"===r.mode)if(0==(4&t.mode))t.memoizedState={baseLanes:0},mu(0,n);else{if(0==(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},mu(0,e),null;t.memoizedState={baseLanes:0},mu(0,null!==a?a.baseLanes:n)}else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,mu(0,r);return Ms(e,t,i,n),t.child}function Ps(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=128)}function js(e,t,n,r,i){var a=gi(n)?fi:di.current;return a=pi(t,a),ra(t,i),n=is(e,t,n,r,a,i),null===e||Os?(t.flags|=1,Ms(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~i,eo(e,t,i))}function Us(e,t,n,r,i){if(gi(n)){var a=!0;bi(t)}else a=!1;if(ra(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),ya(t,n,r),ba(t,n,r,i),r=!0;else if(null===e){var s=t.stateNode,o=t.memoizedProps;s.props=o;var u=s.context,l=n.contextType;l="object"==typeof l&&null!==l?ia(l):pi(t,l=gi(n)?fi:di.current);var c=n.getDerivedStateFromProps,d="function"==typeof c||"function"==typeof s.getSnapshotBeforeUpdate;d||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(o!==r||u!==l)&&va(t,s,r,l),aa=!1;var h=t.memoizedState;s.state=h,da(t,r,s,i),u=t.memoizedState,o!==r||h!==u||hi.current||aa?("function"==typeof c&&(pa(t,n,c,r),u=t.memoizedState),(o=aa||ma(t,n,o,r,h,u,l))?(d||"function"!=typeof s.UNSAFE_componentWillMount&&"function"!=typeof s.componentWillMount||("function"==typeof s.componentWillMount&&s.componentWillMount(),"function"==typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"==typeof s.componentDidMount&&(t.flags|=4)):("function"==typeof s.componentDidMount&&(t.flags|=4),t.memoizedProps=r,t.memoizedState=u),s.props=r,s.state=u,s.context=l,r=o):("function"==typeof s.componentDidMount&&(t.flags|=4),r=!1)}else{s=t.stateNode,oa(e,t),o=t.memoizedProps,l=t.type===t.elementType?o:Ki(t.type,o),s.props=l,d=t.pendingProps,h=s.context,u="object"==typeof(u=n.contextType)&&null!==u?ia(u):pi(t,u=gi(n)?fi:di.current);var f=n.getDerivedStateFromProps;(c="function"==typeof f||"function"==typeof s.getSnapshotBeforeUpdate)||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(o!==d||h!==u)&&va(t,s,r,u),aa=!1,h=t.memoizedState,s.state=h,da(t,r,s,i);var p=t.memoizedState;o!==d||h!==p||hi.current||aa?("function"==typeof f&&(pa(t,n,f,r),p=t.memoizedState),(l=aa||ma(t,n,l,r,h,p,u))?(c||"function"!=typeof s.UNSAFE_componentWillUpdate&&"function"!=typeof s.componentWillUpdate||("function"==typeof s.componentWillUpdate&&s.componentWillUpdate(r,p,u),"function"==typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,p,u)),"function"==typeof s.componentDidUpdate&&(t.flags|=4),"function"==typeof s.getSnapshotBeforeUpdate&&(t.flags|=256)):("function"!=typeof s.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=256),t.memoizedProps=r,t.memoizedState=p),s.props=r,s.state=p,s.context=u,r=l):("function"!=typeof s.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=256),r=!1)}return Ws(e,t,n,r,a,i)}function Ws(e,t,n,r,i,a){Ps(e,t);var s=0!=(64&t.flags);if(!r&&!s)return i&&xi(t,n,!1),eo(e,t,a);r=t.stateNode,Ts.current=t;var o=s&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&s?(t.child=Sa(t,e.child,null,a),t.child=Sa(t,null,o,a)):Ms(e,t,o,a),t.memoizedState=r.state,i&&xi(t,n,!0),t.child}function Vs(e){var t=e.stateNode;t.pendingContext?yi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&yi(0,t.context,!1),Na(e,t.containerInfo)}var Gs,qs,Hs,Xs={dehydrated:null,retryLane:0};function Ks(e,t,n){var r,i=t.pendingProps,a=Ma.current,s=!1;return(r=0!=(64&t.flags))||(r=(null===e||null!==e.memoizedState)&&0!=(2&a)),r?(s=!0,t.flags&=-65):null!==e&&null===e.memoizedState||void 0===i.fallback||!0===i.unstable_avoidThisFallback||(a|=1),li(Ma,1&a),null===e?(void 0!==i.fallback&&Ua(t),e=i.children,a=i.fallback,s?(e=Ys(t,e,a,n),t.child.memoizedState={baseLanes:n},t.memoizedState=Xs,e):"number"==typeof i.unstable_expectedLoadTime?(e=Ys(t,e,a,n),t.child.memoizedState={baseLanes:n},t.memoizedState=Xs,t.lanes=33554432,e):((n=Wu({mode:"visible",children:e},t.mode,n,null)).return=t,t.child=n)):(e.memoizedState,s?(i=function(e,t,n,r,i){var a=t.mode,s=e.child;e=s.sibling;var o={mode:"hidden",children:n};return 0==(2&a)&&t.child!==s?((n=t.child).childLanes=0,n.pendingProps=o,null!==(s=n.lastEffect)?(t.firstEffect=n.firstEffect,t.lastEffect=s,s.nextEffect=null):t.firstEffect=t.lastEffect=null):n=Pu(s,o),null!==e?r=Pu(e,r):(r=Uu(r,a,i,null)).flags|=2,r.return=t,n.return=t,n.sibling=r,t.child=n,r}(e,t,i.children,i.fallback,n),s=t.child,a=e.child.memoizedState,s.memoizedState=null===a?{baseLanes:n}:{baseLanes:a.baseLanes|n},s.childLanes=e.childLanes&~n,t.memoizedState=Xs,i):(n=function(e,t,n,r){var i=e.child;return e=i.sibling,n=Pu(i,{mode:"visible",children:n}),0==(2&t.mode)&&(n.lanes=r),n.return=t,n.sibling=null,null!==e&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=n}(e,t,i.children,n),t.memoizedState=null,n))}function Ys(e,t,n,r){var i=e.mode,a=e.child;return t={mode:"hidden",children:t},0==(2&i)&&null!==a?(a.childLanes=0,a.pendingProps=t):a=Wu(t,i,0,null),n=Uu(n,i,r,null),a.return=e,n.return=e,a.sibling=n,e.child=a,n}function Qs(e,t){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),na(e.return,t)}function Js(e,t,n,r,i,a){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i,lastEffect:a}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i,s.lastEffect=a)}function Zs(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(Ms(e,t,r.children,n),0!=(2&(r=Ma.current)))r=1&r|2,t.flags|=64;else{if(null!==e&&0!=(64&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Qs(e,n);else if(19===e.tag)Qs(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(li(Ma,r),0==(2&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===Ra(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Js(t,!1,i,n,a,t.lastEffect);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===Ra(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Js(t,!0,n,null,a,t.lastEffect);break;case"together":Js(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function eo(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Bo|=t.lanes,0!=(n&t.childLanes)){if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Pu(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Pu(e,e.pendingProps)).return=t;n.sibling=null}return t.child}return null}function to(e,t){if(!La)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function no(e,t,n){var r=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:case 17:return gi(t.type)&&mi(),null;case 3:return $a(),ui(hi),ui(di),Ha(),(r=t.stateNode).pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(Va(t)?t.flags|=4:r.hydrate||(t.flags|=256)),null;case 5:Oa(t);var a=Da(Ia.current);if(n=t.type,null!==e&&null!=t.stateNode)qs(e,t,n,r),e.ref!==t.ref&&(t.flags|=128);else{if(!r){if(null===t.stateNode)throw Error(s(166));return null}if(e=Da(Ea.current),Va(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[Yr]=t,r[Qr]=o,n){case"dialog":Fr("cancel",r),Fr("close",r);break;case"iframe":case"object":case"embed":Fr("load",r);break;case"video":case"audio":for(e=0;e<Sr.length;e++)Fr(Sr[e],r);break;case"source":Fr("error",r);break;case"img":case"image":case"link":Fr("error",r),Fr("load",r);break;case"details":Fr("toggle",r);break;case"input":ee(r,o),Fr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Fr("invalid",r);break;case"textarea":ue(r,o),Fr("invalid",r)}for(var l in _e(n,o),e=null,o)o.hasOwnProperty(l)&&(a=o[l],"children"===l?"string"==typeof a?r.textContent!==a&&(e=["children",a]):"number"==typeof a&&r.textContent!==""+a&&(e=["children",""+a]):u.hasOwnProperty(l)&&null!=a&&"onScroll"===l&&Fr("scroll",r));switch(n){case"input":Y(r),re(r,o,!0);break;case"textarea":Y(r),ce(r);break;case"select":case"option":break;default:"function"==typeof o.onClick&&(r.onclick=zr)}r=e,t.updateQueue=r,null!==r&&(t.flags|=4)}else{switch(l=9===a.nodeType?a:a.ownerDocument,e===de&&(e=he(n)),e===de?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[Yr]=t,e[Qr]=r,Gs(e,t),t.stateNode=e,l=Se(n,r),n){case"dialog":Fr("cancel",e),Fr("close",e),a=r;break;case"iframe":case"object":case"embed":Fr("load",e),a=r;break;case"video":case"audio":for(a=0;a<Sr.length;a++)Fr(Sr[a],e);a=r;break;case"source":Fr("error",e),a=r;break;case"img":case"image":case"link":Fr("error",e),Fr("load",e),a=r;break;case"details":Fr("toggle",e),a=r;break;case"input":ee(e,r),a=Z(e,r),Fr("invalid",e);break;case"option":a=ae(e,r);break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=i({},r,{value:void 0}),Fr("invalid",e);break;case"textarea":ue(e,r),a=oe(e,r),Fr("invalid",e);break;default:a=r}_e(n,a);var c=a;for(o in c)if(c.hasOwnProperty(o)){var d=c[o];"style"===o?we(e,d):"dangerouslySetInnerHTML"===o?null!=(d=d?d.__html:void 0)&&me(e,d):"children"===o?"string"==typeof d?("textarea"!==n||""!==d)&&ye(e,d):"number"==typeof d&&ye(e,""+d):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(u.hasOwnProperty(o)?null!=d&&"onScroll"===o&&Fr("scroll",e):null!=d&&x(e,o,d,l))}switch(n){case"input":Y(e),re(e,r,!1);break;case"textarea":Y(e),ce(e);break;case"option":null!=r.value&&e.setAttribute("value",""+X(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?se(e,!!r.multiple,o,!1):null!=r.defaultValue&&se(e,!!r.multiple,r.defaultValue,!0);break;default:"function"==typeof a.onClick&&(e.onclick=zr)}jr(n,r)&&(t.flags|=4)}null!==t.ref&&(t.flags|=128)}return null;case 6:if(e&&null!=t.stateNode)Hs(0,t,e.memoizedProps,r);else{if("string"!=typeof r&&null===t.stateNode)throw Error(s(166));n=Da(Ia.current),Da(Ea.current),Va(t)?(r=t.stateNode,n=t.memoizedProps,r[Yr]=t,r.nodeValue!==n&&(t.flags|=4)):((r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[Yr]=t,t.stateNode=r)}return null;case 13:return ui(Ma),r=t.memoizedState,0!=(64&t.flags)?(t.lanes=n,t):(r=null!==r,n=!1,null===e?void 0!==t.memoizedProps.fallback&&Va(t):n=null!==e.memoizedState,r&&!n&&0!=(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!=(1&Ma.current)?0===Oo&&(Oo=3):(0!==Oo&&3!==Oo||(Oo=4),null===Io||0==(134217727&Bo)&&0==(134217727&zo)||pu(Io,No))),(r||n)&&(t.flags|=4),null);case 4:return $a(),null===e&&Dr(t.stateNode.containerInfo),null;case 10:return ta(t),null;case 19:if(ui(Ma),null===(r=t.memoizedState))return null;if(o=0!=(64&t.flags),null===(l=r.rendering))if(o)to(r,!1);else{if(0!==Oo||null!==e&&0!=(64&e.flags))for(e=t.child;null!==e;){if(null!==(l=Ra(e))){for(t.flags|=64,to(r,!1),null!==(o=l.updateQueue)&&(t.updateQueue=o,t.flags|=4),null===r.lastEffect&&(t.firstEffect=null),t.lastEffect=r.lastEffect,r=n,n=t.child;null!==n;)e=r,(o=n).flags&=2,o.nextEffect=null,o.firstEffect=null,o.lastEffect=null,null===(l=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return li(Ma,1&Ma.current|2),t.child}e=e.sibling}null!==r.tail&&ji()>Uo&&(t.flags|=64,o=!0,to(r,!1),t.lanes=33554432)}else{if(!o)if(null!==(e=Ra(l))){if(t.flags|=64,o=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),to(r,!0),null===r.tail&&"hidden"===r.tailMode&&!l.alternate&&!La)return null!==(t=t.lastEffect=r.lastEffect)&&(t.nextEffect=null),null}else 2*ji()-r.renderingStartTime>Uo&&1073741824!==n&&(t.flags|=64,o=!0,to(r,!1),t.lanes=33554432);r.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=r.last)?n.sibling=l:t.child=l,r.last=l)}return null!==r.tail?(n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=t.lastEffect,r.renderingStartTime=ji(),n.sibling=null,t=Ma.current,li(Ma,o?1&t|2:1&t),n):null;case 23:case 24:return yu(),null!==e&&null!==e.memoizedState!=(null!==t.memoizedState)&&"unstable-defer-without-hiding"!==r.mode&&(t.flags|=4),null}throw Error(s(156,t.tag))}function ro(e){switch(e.tag){case 1:gi(e.type)&&mi();var t=e.flags;return 4096&t?(e.flags=-4097&t|64,e):null;case 3:if($a(),ui(hi),ui(di),Ha(),0!=(64&(t=e.flags)))throw Error(s(285));return e.flags=-4097&t|64,e;case 5:return Oa(e),null;case 13:return ui(Ma),4096&(t=e.flags)?(e.flags=-4097&t|64,e):null;case 19:return ui(Ma),null;case 4:return $a(),null;case 10:return ta(e),null;case 23:case 24:return yu(),null;default:return null}}function io(e,t){try{var n="",r=t;do{n+=q(r),r=r.return}while(r);var i=n}catch(e){i="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:i}}function ao(e,t){try{console.error(t.value)}catch(e){setTimeout((function(){throw e}))}}Gs=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},qs=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,Da(Ea.current);var s,o=null;switch(n){case"input":a=Z(e,a),r=Z(e,r),o=[];break;case"option":a=ae(e,a),r=ae(e,r),o=[];break;case"select":a=i({},a,{value:void 0}),r=i({},r,{value:void 0}),o=[];break;case"textarea":a=oe(e,a),r=oe(e,r),o=[];break;default:"function"!=typeof a.onClick&&"function"==typeof r.onClick&&(e.onclick=zr)}for(d in _e(n,r),n=null,a)if(!r.hasOwnProperty(d)&&a.hasOwnProperty(d)&&null!=a[d])if("style"===d){var l=a[d];for(s in l)l.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(u.hasOwnProperty(d)?o||(o=[]):(o=o||[]).push(d,null));for(d in r){var c=r[d];if(l=null!=a?a[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(null!=c||null!=l))if("style"===d)if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(n||(n={}),n[s]=c[s])}else n||(o||(o=[]),o.push(d,n)),n=c;else"dangerouslySetInnerHTML"===d?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(o=o||[]).push(d,c)):"children"===d?"string"!=typeof c&&"number"!=typeof c||(o=o||[]).push(d,""+c):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(u.hasOwnProperty(d)?(null!=c&&"onScroll"===d&&Fr("scroll",e),o||l===c||(o=[])):"object"==typeof c&&null!==c&&c.$$typeof===M?c.toString():(o=o||[]).push(d,c))}n&&(o=o||[]).push("style",n);var d=o;(t.updateQueue=d)&&(t.flags|=4)}},Hs=function(e,t,n,r){n!==r&&(t.flags|=4)};var so="function"==typeof WeakMap?WeakMap:Map;function oo(e,t,n){(n=ua(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){qo||(qo=!0,Ho=r),ao(0,t)},n}function uo(e,t,n){(n=ua(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var i=t.value;n.payload=function(){return ao(0,t),r(i)}}var a=e.stateNode;return null!==a&&"function"==typeof a.componentDidCatch&&(n.callback=function(){"function"!=typeof r&&(null===Xo?Xo=new Set([this]):Xo.add(this),ao(0,t));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}var lo="function"==typeof WeakSet?WeakSet:Set;function co(e){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){Ou(e,t)}else t.current=null}function ho(e,t){switch(t.tag){case 0:case 11:case 15:case 22:case 5:case 6:case 4:case 17:return;case 1:if(256&t.flags&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:Ki(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:return void(256&t.flags&&Gr(t.stateNode.containerInfo))}throw Error(s(163))}function fo(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{if(3==(3&e.tag)){var r=e.create;e.destroy=r()}e=e.next}while(e!==t)}if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{var i=e;r=i.next,0!=(4&(i=i.tag))&&0!=(1&i)&&(Nu(n,e),Du(n,e)),e=r}while(e!==t)}return;case 1:return e=n.stateNode,4&n.flags&&(null===t?e.componentDidMount():(r=n.elementType===n.type?t.memoizedProps:Ki(n.type,t.memoizedProps),e.componentDidUpdate(r,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),void(null!==(t=n.updateQueue)&&ha(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:case 1:e=n.child.stateNode}ha(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.flags&&jr(n.type,n.memoizedProps)&&e.focus());case 6:case 4:case 12:case 19:case 17:case 20:case 21:case 23:case 24:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&xt(n)))))}throw Error(s(163))}function po(e,t){for(var n=e;;){if(5===n.tag){var r=n.stateNode;if(t)"function"==typeof(r=r.style).setProperty?r.setProperty("display","none","important"):r.display="none";else{r=n.stateNode;var i=n.memoizedProps.style;i=null!=i&&i.hasOwnProperty("display")?i.display:null,r.style.display=xe("display",i)}}else if(6===n.tag)n.stateNode.nodeValue=t?"":n.memoizedProps;else if((23!==n.tag&&24!==n.tag||null===n.memoizedState||n===e)&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function go(e,t){if(ki&&"function"==typeof ki.onCommitFiberUnmount)try{ki.onCommitFiberUnmount(wi,t)}catch(e){}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var n=e=e.next;do{var r=n,i=r.destroy;if(r=r.tag,void 0!==i)if(0!=(4&r))Nu(t,n);else{r=t;try{i()}catch(e){Ou(r,e)}}n=n.next}while(n!==e)}break;case 1:if(co(t),"function"==typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(e){Ou(t,e)}break;case 5:co(t);break;case 4:wo(e,t)}}function mo(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function yo(e){return 5===e.tag||3===e.tag||4===e.tag}function vo(e){e:{for(var t=e.return;null!==t;){if(yo(t))break e;t=t.return}throw Error(s(160))}var n=t;switch(t=n.stateNode,n.tag){case 5:var r=!1;break;case 3:case 4:t=t.containerInfo,r=!0;break;default:throw Error(s(161))}16&n.flags&&(ye(t,""),n.flags&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||yo(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.flags)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.flags)){n=n.stateNode;break e}}r?bo(e,n,t):xo(e,n,t)}function bo(e,t,n){var r=e.tag,i=5===r||6===r;if(i)e=i?e.stateNode:e.stateNode.instance,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=zr));else if(4!==r&&null!==(e=e.child))for(bo(e,t,n),e=e.sibling;null!==e;)bo(e,t,n),e=e.sibling}function xo(e,t,n){var r=e.tag,i=5===r||6===r;if(i)e=i?e.stateNode:e.stateNode.instance,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(xo(e,t,n),e=e.sibling;null!==e;)xo(e,t,n),e=e.sibling}function wo(e,t){for(var n,r,i=t,a=!1;;){if(!a){a=i.return;e:for(;;){if(null===a)throw Error(s(160));switch(n=a.stateNode,a.tag){case 5:r=!1;break e;case 3:case 4:n=n.containerInfo,r=!0;break e}a=a.return}a=!0}if(5===i.tag||6===i.tag){e:for(var o=e,u=i,l=u;;)if(go(o,l),null!==l.child&&4!==l.tag)l.child.return=l,l=l.child;else{if(l===u)break e;for(;null===l.sibling;){if(null===l.return||l.return===u)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}r?(o=n,u=i.stateNode,8===o.nodeType?o.parentNode.removeChild(u):o.removeChild(u)):n.removeChild(i.stateNode)}else if(4===i.tag){if(null!==i.child){n=i.stateNode.containerInfo,r=!0,i.child.return=i,i=i.child;continue}}else if(go(e,i),null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;4===(i=i.return).tag&&(a=!1)}i.sibling.return=i.return,i=i.sibling}}function ko(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var r=n=n.next;do{3==(3&r.tag)&&(e=r.destroy,r.destroy=void 0,void 0!==e&&e()),r=r.next}while(r!==n)}return;case 1:case 12:case 17:return;case 5:if(null!=(n=t.stateNode)){r=t.memoizedProps;var i=null!==e?e.memoizedProps:r;e=t.type;var a=t.updateQueue;if(t.updateQueue=null,null!==a){for(n[Qr]=r,"input"===e&&"radio"===r.type&&null!=r.name&&te(n,r),Se(e,i),t=Se(e,r),i=0;i<a.length;i+=2){var o=a[i],u=a[i+1];"style"===o?we(n,u):"dangerouslySetInnerHTML"===o?me(n,u):"children"===o?ye(n,u):x(n,o,u,t)}switch(e){case"input":ne(n,r);break;case"textarea":le(n,r);break;case"select":e=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,null!=(a=r.value)?se(n,!!r.multiple,a,!1):e!==!!r.multiple&&(null!=r.defaultValue?se(n,!!r.multiple,r.defaultValue,!0):se(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(s(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((n=t.stateNode).hydrate&&(n.hydrate=!1,xt(n.containerInfo)));case 13:return null!==t.memoizedState&&(jo=ji(),po(t.child,!0)),void _o(t);case 19:return void _o(t);case 23:case 24:return void po(t,null!==t.memoizedState)}throw Error(s(163))}function _o(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new lo),t.forEach((function(t){var r=Ru.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function So(e,t){return null!==e&&(null===(e=e.memoizedState)||null!==e.dehydrated)&&null!==(t=t.memoizedState)&&null===t.dehydrated}var Co=Math.ceil,Ao=w.ReactCurrentDispatcher,Eo=w.ReactCurrentOwner,Fo=0,Io=null,Do=null,No=0,$o=0,To=oi(0),Oo=0,Mo=null,Ro=0,Bo=0,zo=0,Lo=0,Po=null,jo=0,Uo=1/0;function Wo(){Uo=ji()+500}var Vo,Go=null,qo=!1,Ho=null,Xo=null,Ko=!1,Yo=null,Qo=90,Jo=[],Zo=[],eu=null,tu=0,nu=null,ru=-1,iu=0,au=0,su=null,ou=!1;function uu(){return 0!=(48&Fo)?ji():-1!==ru?ru:ru=ji()}function lu(e){if(0==(2&(e=e.mode)))return 1;if(0==(4&e))return 99===Ui()?1:2;if(0===iu&&(iu=Ro),0!==Xi.transition){0!==au&&(au=null!==Po?Po.pendingLanes:0),e=iu;var t=4186112&~au;return 0==(t&=-t)&&0==(t=(e=4186112&~e)&-e)&&(t=8192),t}return e=Ui(),e=zt(0!=(4&Fo)&&98===e?12:e=function(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(e),iu)}function cu(e,t,n){if(50<tu)throw tu=0,nu=null,Error(s(185));if(null===(e=du(e,t)))return null;jt(e,t,n),e===Io&&(zo|=t,4===Oo&&pu(e,No));var r=Ui();1===t?0!=(8&Fo)&&0==(48&Fo)?gu(e):(hu(e,n),0===Fo&&(Wo(),qi())):(0==(4&Fo)||98!==r&&99!==r||(null===eu?eu=new Set([e]):eu.add(e)),hu(e,n)),Po=e}function du(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function hu(e,t){for(var n=e.callbackNode,r=e.suspendedLanes,i=e.pingedLanes,a=e.expirationTimes,o=e.pendingLanes;0<o;){var u=31-Ut(o),l=1<<u,c=a[u];if(-1===c){if(0==(l&r)||0!=(l&i)){c=t,Mt(l);var d=Ot;a[u]=10<=d?c+250:6<=d?c+5e3:-1}}else c<=t&&(e.expiredLanes|=l);o&=~l}if(r=Rt(e,e===Io?No:0),t=Ot,0===r)null!==n&&(n!==Mi&&Ci(n),e.callbackNode=null,e.callbackPriority=0);else{if(null!==n){if(e.callbackPriority===t)return;n!==Mi&&Ci(n)}15===t?(n=gu.bind(null,e),null===Bi?(Bi=[n],zi=Si(Di,Hi)):Bi.push(n),n=Mi):14===t?n=Gi(99,gu.bind(null,e)):(n=function(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(s(358,e))}}(t),n=Gi(n,fu.bind(null,e))),e.callbackPriority=t,e.callbackNode=n}}function fu(e){if(ru=-1,au=iu=0,0!=(48&Fo))throw Error(s(327));var t=e.callbackNode;if(Iu()&&e.callbackNode!==t)return null;var n=Rt(e,e===Io?No:0);if(0===n)return null;var r=n,i=Fo;Fo|=16;var a=xu();for(Io===e&&No===r||(Wo(),vu(e,r));;)try{_u();break}catch(t){bu(e,t)}if(ea(),Ao.current=a,Fo=i,null!==Do?r=0:(Io=null,No=0,r=Oo),0!=(Ro&zo))vu(e,0);else if(0!==r){if(2===r&&(Fo|=64,e.hydrate&&(e.hydrate=!1,Gr(e.containerInfo)),0!==(n=Bt(e))&&(r=wu(e,n))),1===r)throw t=Mo,vu(e,0),pu(e,n),hu(e,ji()),t;switch(e.finishedWork=e.current.alternate,e.finishedLanes=n,r){case 0:case 1:throw Error(s(345));case 2:case 5:Au(e);break;case 3:if(pu(e,n),(62914560&n)===n&&10<(r=jo+500-ji())){if(0!==Rt(e,0))break;if(((i=e.suspendedLanes)&n)!==n){uu(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=Wr(Au.bind(null,e),r);break}Au(e);break;case 4:if(pu(e,n),(4186112&n)===n)break;for(r=e.eventTimes,i=-1;0<n;){var o=31-Ut(n);a=1<<o,(o=r[o])>i&&(i=o),n&=~a}if(n=i,10<(n=(120>(n=ji()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Co(n/1960))-n)){e.timeoutHandle=Wr(Au.bind(null,e),n);break}Au(e);break;default:throw Error(s(329))}}return hu(e,ji()),e.callbackNode===t?fu.bind(null,e):null}function pu(e,t){for(t&=~Lo,t&=~zo,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Ut(t),r=1<<n;e[n]=-1,t&=~r}}function gu(e){if(0!=(48&Fo))throw Error(s(327));if(Iu(),e===Io&&0!=(e.expiredLanes&No)){var t=No,n=wu(e,t);0!=(Ro&zo)&&(n=wu(e,t=Rt(e,t)))}else n=wu(e,t=Rt(e,0));if(0!==e.tag&&2===n&&(Fo|=64,e.hydrate&&(e.hydrate=!1,Gr(e.containerInfo)),0!==(t=Bt(e))&&(n=wu(e,t))),1===n)throw n=Mo,vu(e,0),pu(e,t),hu(e,ji()),n;return e.finishedWork=e.current.alternate,e.finishedLanes=t,Au(e),hu(e,ji()),null}function mu(e,t){li(To,$o),$o|=t,Ro|=t}function yu(){$o=To.current,ui(To)}function vu(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,Vr(n)),null!==Do)for(n=Do.return;null!==n;){var r=n;switch(r.tag){case 1:null!=(r=r.type.childContextTypes)&&mi();break;case 3:$a(),ui(hi),ui(di),Ha();break;case 5:Oa(r);break;case 4:$a();break;case 13:case 19:ui(Ma);break;case 10:ta(r);break;case 23:case 24:yu()}n=n.return}Io=e,Do=Pu(e.current,null),No=$o=Ro=t,Oo=0,Mo=null,Lo=zo=Bo=0}function bu(e,t){for(;;){var n=Do;try{if(ea(),Xa.current=Is,es){for(var r=Qa.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}es=!1}if(Ya=0,Za=Ja=Qa=null,ts=!1,Eo.current=null,null===n||null===n.return){Oo=1,Mo=t,Do=null;break}e:{var a=e,s=n.return,o=n,u=t;if(t=No,o.flags|=2048,o.firstEffect=o.lastEffect=null,null!==u&&"object"==typeof u&&"function"==typeof u.then){var l=u;if(0==(2&o.mode)){var c=o.alternate;c?(o.updateQueue=c.updateQueue,o.memoizedState=c.memoizedState,o.lanes=c.lanes):(o.updateQueue=null,o.memoizedState=null)}var d=0!=(1&Ma.current),h=s;do{var f;if(f=13===h.tag){var p=h.memoizedState;if(null!==p)f=null!==p.dehydrated;else{var g=h.memoizedProps;f=void 0!==g.fallback&&(!0!==g.unstable_avoidThisFallback||!d)}}if(f){var m=h.updateQueue;if(null===m){var y=new Set;y.add(l),h.updateQueue=y}else m.add(l);if(0==(2&h.mode)){if(h.flags|=64,o.flags|=16384,o.flags&=-2981,1===o.tag)if(null===o.alternate)o.tag=17;else{var v=ua(-1,1);v.tag=2,la(o,v)}o.lanes|=1;break e}u=void 0,o=t;var b=a.pingCache;if(null===b?(b=a.pingCache=new so,u=new Set,b.set(l,u)):void 0===(u=b.get(l))&&(u=new Set,b.set(l,u)),!u.has(o)){u.add(o);var x=Mu.bind(null,a,l,o);l.then(x,x)}h.flags|=4096,h.lanes=t;break e}h=h.return}while(null!==h);u=Error((H(o.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==Oo&&(Oo=2),u=io(u,o),h=s;do{switch(h.tag){case 3:a=u,h.flags|=4096,t&=-t,h.lanes|=t,ca(h,oo(0,a,t));break e;case 1:a=u;var w=h.type,k=h.stateNode;if(0==(64&h.flags)&&("function"==typeof w.getDerivedStateFromError||null!==k&&"function"==typeof k.componentDidCatch&&(null===Xo||!Xo.has(k)))){h.flags|=4096,t&=-t,h.lanes|=t,ca(h,uo(h,a,t));break e}}h=h.return}while(null!==h)}Cu(n)}catch(e){t=e,Do===n&&null!==n&&(Do=n=n.return);continue}break}}function xu(){var e=Ao.current;return Ao.current=Is,null===e?Is:e}function wu(e,t){var n=Fo;Fo|=16;var r=xu();for(Io===e&&No===t||vu(e,t);;)try{ku();break}catch(t){bu(e,t)}if(ea(),Fo=n,Ao.current=r,null!==Do)throw Error(s(261));return Io=null,No=0,Oo}function ku(){for(;null!==Do;)Su(Do)}function _u(){for(;null!==Do&&!Ai();)Su(Do)}function Su(e){var t=Vo(e.alternate,e,$o);e.memoizedProps=e.pendingProps,null===t?Cu(e):Do=t,Eo.current=null}function Cu(e){var t=e;do{var n=t.alternate;if(e=t.return,0==(2048&t.flags)){if(null!==(n=no(n,t,$o)))return void(Do=n);if(24!==(n=t).tag&&23!==n.tag||null===n.memoizedState||0!=(1073741824&$o)||0==(4&n.mode)){for(var r=0,i=n.child;null!==i;)r|=i.lanes|i.childLanes,i=i.sibling;n.childLanes=r}null!==e&&0==(2048&e.flags)&&(null===e.firstEffect&&(e.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(null!==e.lastEffect?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(null!==(n=ro(t)))return n.flags&=2047,void(Do=n);null!==e&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(null!==(t=t.sibling))return void(Do=t);Do=t=e}while(null!==t);0===Oo&&(Oo=5)}function Au(e){var t=Ui();return Vi(99,Eu.bind(null,e,t)),null}function Eu(e,t){do{Iu()}while(null!==Yo);if(0!=(48&Fo))throw Error(s(327));var n=e.finishedWork;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(s(177));e.callbackNode=null;var r=n.lanes|n.childLanes,i=r,a=e.pendingLanes&~i;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=i,e.mutableReadLanes&=i,e.entangledLanes&=i,i=e.entanglements;for(var o=e.eventTimes,u=e.expirationTimes;0<a;){var l=31-Ut(a),c=1<<l;i[l]=0,o[l]=-1,u[l]=-1,a&=~c}if(null!==eu&&0==(24&r)&&eu.has(e)&&eu.delete(e),e===Io&&(Do=Io=null,No=0),1<n.flags?null!==n.lastEffect?(n.lastEffect.nextEffect=n,r=n.firstEffect):r=n:r=n.firstEffect,null!==r){if(i=Fo,Fo|=32,Eo.current=null,Lr=Ht,gr(o=pr())){if("selectionStart"in o)u={start:o.selectionStart,end:o.selectionEnd};else e:if(u=(u=o.ownerDocument)&&u.defaultView||window,(c=u.getSelection&&u.getSelection())&&0!==c.rangeCount){u=c.anchorNode,a=c.anchorOffset,l=c.focusNode,c=c.focusOffset;try{u.nodeType,l.nodeType}catch(e){u=null;break e}var d=0,h=-1,f=-1,p=0,g=0,m=o,y=null;t:for(;;){for(var v;m!==u||0!==a&&3!==m.nodeType||(h=d+a),m!==l||0!==c&&3!==m.nodeType||(f=d+c),3===m.nodeType&&(d+=m.nodeValue.length),null!==(v=m.firstChild);)y=m,m=v;for(;;){if(m===o)break t;if(y===u&&++p===a&&(h=d),y===l&&++g===c&&(f=d),null!==(v=m.nextSibling))break;y=(m=y).parentNode}m=v}u=-1===h||-1===f?null:{start:h,end:f}}else u=null;u=u||{start:0,end:0}}else u=null;Pr={focusedElem:o,selectionRange:u},Ht=!1,su=null,ou=!1,Go=r;do{try{Fu()}catch(e){if(null===Go)throw Error(s(330));Ou(Go,e),Go=Go.nextEffect}}while(null!==Go);su=null,Go=r;do{try{for(o=e;null!==Go;){var b=Go.flags;if(16&b&&ye(Go.stateNode,""),128&b){var x=Go.alternate;if(null!==x){var w=x.ref;null!==w&&("function"==typeof w?w(null):w.current=null)}}switch(1038&b){case 2:vo(Go),Go.flags&=-3;break;case 6:vo(Go),Go.flags&=-3,ko(Go.alternate,Go);break;case 1024:Go.flags&=-1025;break;case 1028:Go.flags&=-1025,ko(Go.alternate,Go);break;case 4:ko(Go.alternate,Go);break;case 8:wo(o,u=Go);var k=u.alternate;mo(u),null!==k&&mo(k)}Go=Go.nextEffect}}catch(e){if(null===Go)throw Error(s(330));Ou(Go,e),Go=Go.nextEffect}}while(null!==Go);if(w=Pr,x=pr(),b=w.focusedElem,o=w.selectionRange,x!==b&&b&&b.ownerDocument&&fr(b.ownerDocument.documentElement,b)){null!==o&&gr(b)&&(x=o.start,void 0===(w=o.end)&&(w=x),"selectionStart"in b?(b.selectionStart=x,b.selectionEnd=Math.min(w,b.value.length)):(w=(x=b.ownerDocument||document)&&x.defaultView||window).getSelection&&(w=w.getSelection(),u=b.textContent.length,k=Math.min(o.start,u),o=void 0===o.end?k:Math.min(o.end,u),!w.extend&&k>o&&(u=o,o=k,k=u),u=hr(b,k),a=hr(b,o),u&&a&&(1!==w.rangeCount||w.anchorNode!==u.node||w.anchorOffset!==u.offset||w.focusNode!==a.node||w.focusOffset!==a.offset)&&((x=x.createRange()).setStart(u.node,u.offset),w.removeAllRanges(),k>o?(w.addRange(x),w.extend(a.node,a.offset)):(x.setEnd(a.node,a.offset),w.addRange(x))))),x=[];for(w=b;w=w.parentNode;)1===w.nodeType&&x.push({element:w,left:w.scrollLeft,top:w.scrollTop});for("function"==typeof b.focus&&b.focus(),b=0;b<x.length;b++)(w=x[b]).element.scrollLeft=w.left,w.element.scrollTop=w.top}Ht=!!Lr,Pr=Lr=null,e.current=n,Go=r;do{try{for(b=e;null!==Go;){var _=Go.flags;if(36&_&&fo(b,Go.alternate,Go),128&_){x=void 0;var S=Go.ref;if(null!==S){var C=Go.stateNode;Go.tag,x=C,"function"==typeof S?S(x):S.current=x}}Go=Go.nextEffect}}catch(e){if(null===Go)throw Error(s(330));Ou(Go,e),Go=Go.nextEffect}}while(null!==Go);Go=null,Ri(),Fo=i}else e.current=n;if(Ko)Ko=!1,Yo=e,Qo=t;else for(Go=r;null!==Go;)t=Go.nextEffect,Go.nextEffect=null,8&Go.flags&&((_=Go).sibling=null,_.stateNode=null),Go=t;if(0===(r=e.pendingLanes)&&(Xo=null),1===r?e===nu?tu++:(tu=0,nu=e):tu=0,n=n.stateNode,ki&&"function"==typeof ki.onCommitFiberRoot)try{ki.onCommitFiberRoot(wi,n,void 0,64==(64&n.current.flags))}catch(e){}if(hu(e,ji()),qo)throw qo=!1,e=Ho,Ho=null,e;return 0!=(8&Fo)||qi(),null}function Fu(){for(;null!==Go;){var e=Go.alternate;ou||null===su||(0!=(8&Go.flags)?Je(Go,su)&&(ou=!0):13===Go.tag&&So(e,Go)&&Je(Go,su)&&(ou=!0));var t=Go.flags;0!=(256&t)&&ho(e,Go),0==(512&t)||Ko||(Ko=!0,Gi(97,(function(){return Iu(),null}))),Go=Go.nextEffect}}function Iu(){if(90!==Qo){var e=97<Qo?97:Qo;return Qo=90,Vi(e,$u)}return!1}function Du(e,t){Jo.push(t,e),Ko||(Ko=!0,Gi(97,(function(){return Iu(),null})))}function Nu(e,t){Zo.push(t,e),Ko||(Ko=!0,Gi(97,(function(){return Iu(),null})))}function $u(){if(null===Yo)return!1;var e=Yo;if(Yo=null,0!=(48&Fo))throw Error(s(331));var t=Fo;Fo|=32;var n=Zo;Zo=[];for(var r=0;r<n.length;r+=2){var i=n[r],a=n[r+1],o=i.destroy;if(i.destroy=void 0,"function"==typeof o)try{o()}catch(e){if(null===a)throw Error(s(330));Ou(a,e)}}for(n=Jo,Jo=[],r=0;r<n.length;r+=2){i=n[r],a=n[r+1];try{var u=i.create;i.destroy=u()}catch(e){if(null===a)throw Error(s(330));Ou(a,e)}}for(u=e.current.firstEffect;null!==u;)e=u.nextEffect,u.nextEffect=null,8&u.flags&&(u.sibling=null,u.stateNode=null),u=e;return Fo=t,qi(),!0}function Tu(e,t,n){la(e,t=oo(0,t=io(n,t),1)),t=uu(),null!==(e=du(e,1))&&(jt(e,1,t),hu(e,t))}function Ou(e,t){if(3===e.tag)Tu(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){Tu(n,e,t);break}if(1===n.tag){var r=n.stateNode;if("function"==typeof n.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===Xo||!Xo.has(r))){var i=uo(n,e=io(t,e),1);if(la(n,i),i=uu(),null!==(n=du(n,1)))jt(n,1,i),hu(n,i);else if("function"==typeof r.componentDidCatch&&(null===Xo||!Xo.has(r)))try{r.componentDidCatch(t,e)}catch(e){}break}}n=n.return}}function Mu(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=uu(),e.pingedLanes|=e.suspendedLanes&n,Io===e&&(No&n)===n&&(4===Oo||3===Oo&&(62914560&No)===No&&500>ji()-jo?vu(e,0):Lo|=n),hu(e,t)}function Ru(e,t){var n=e.stateNode;null!==n&&n.delete(t),0==(t=0)&&(0==(2&(t=e.mode))?t=1:0==(4&t)?t=99===Ui()?1:2:(0===iu&&(iu=Ro),0===(t=Lt(62914560&~iu))&&(t=4194304))),n=uu(),null!==(e=du(e,t))&&(jt(e,t,n),hu(e,n))}function Bu(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function zu(e,t,n,r){return new Bu(e,t,n,r)}function Lu(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Pu(e,t){var n=e.alternate;return null===n?((n=zu(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function ju(e,t,n,r,i,a){var o=2;if(r=e,"function"==typeof e)Lu(e)&&(o=1);else if("string"==typeof e)o=5;else e:switch(e){case S:return Uu(n.children,i,a,t);case R:o=8,i|=16;break;case C:o=8,i|=1;break;case A:return(e=zu(12,n,t,8|i)).elementType=A,e.type=A,e.lanes=a,e;case D:return(e=zu(13,n,t,i)).type=D,e.elementType=D,e.lanes=a,e;case N:return(e=zu(19,n,t,i)).elementType=N,e.lanes=a,e;case B:return Wu(n,i,a,t);case z:return(e=zu(24,n,t,i)).elementType=z,e.lanes=a,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case E:o=10;break e;case F:o=9;break e;case I:o=11;break e;case $:o=14;break e;case T:o=16,r=null;break e;case O:o=22;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=zu(o,n,t,i)).elementType=e,t.type=r,t.lanes=a,t}function Uu(e,t,n,r){return(e=zu(7,e,r,t)).lanes=n,e}function Wu(e,t,n,r){return(e=zu(23,e,r,t)).elementType=B,e.lanes=n,e}function Vu(e,t,n){return(e=zu(6,e,null,t)).lanes=n,e}function Gu(e,t,n){return(t=zu(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function qu(e,t,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Pt(0),this.expirationTimes=Pt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Pt(0),this.mutableSourceEagerHydrationData=null}function Hu(e,t,n,r){var i=t.current,a=uu(),o=lu(i);e:if(n){t:{if(Ke(n=n._reactInternals)!==n||1!==n.tag)throw Error(s(170));var u=n;do{switch(u.tag){case 3:u=u.stateNode.context;break t;case 1:if(gi(u.type)){u=u.stateNode.__reactInternalMemoizedMergedChildContext;break t}}u=u.return}while(null!==u);throw Error(s(171))}if(1===n.tag){var l=n.type;if(gi(l)){n=vi(n,l,u);break e}}n=u}else n=ci;return null===t.context?t.context=n:t.pendingContext=n,(t=ua(a,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),la(i,t),cu(i,o,a),o}function Xu(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Ku(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Yu(e,t){Ku(e,t),(e=e.alternate)&&Ku(e,t)}function Qu(e,t,n){var r=null!=n&&null!=n.hydrationOptions&&n.hydrationOptions.mutableSources||null;if(n=new qu(e,t,null!=n&&!0===n.hydrate),t=zu(3,null,null,2===t?7:1===t?3:0),n.current=t,t.stateNode=n,sa(t),e[Jr]=n.current,Dr(8===e.nodeType?e.parentNode:e),r)for(e=0;e<r.length;e++){var i=(t=r[e])._getVersion;i=i(t._source),null==n.mutableSourceEagerHydrationData?n.mutableSourceEagerHydrationData=[t,i]:n.mutableSourceEagerHydrationData.push(t,i)}this._internalRoot=n}function Ju(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zu(e,t,n,r,i){var a=n._reactRootContainer;if(a){var s=a._internalRoot;if("function"==typeof i){var o=i;i=function(){var e=Xu(s);o.call(e)}}Hu(t,s,e,i)}else{if(a=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new Qu(e,0,t?{hydrate:!0}:void 0)}(n,r),s=a._internalRoot,"function"==typeof i){var u=i;i=function(){var e=Xu(s);u.call(e)}}!function(e,t){var n=Fo;Fo&=-2,Fo|=8;try{e(t)}finally{0===(Fo=n)&&(Wo(),qi())}}((function(){Hu(t,s,e,i)}))}return Xu(s)}Vo=function(e,t,n){var r=t.lanes;if(null!==e)if(e.memoizedProps!==t.pendingProps||hi.current)Os=!0;else{if(0==(n&r)){switch(Os=!1,t.tag){case 3:Vs(t),Ga();break;case 5:Ta(t);break;case 1:gi(t.type)&&bi(t);break;case 4:Na(t,t.stateNode.containerInfo);break;case 10:r=t.memoizedProps.value;var i=t.type._context;li(Yi,i._currentValue),i._currentValue=r;break;case 13:if(null!==t.memoizedState)return 0!=(n&t.child.childLanes)?Ks(e,t,n):(li(Ma,1&Ma.current),null!==(t=eo(e,t,n))?t.sibling:null);li(Ma,1&Ma.current);break;case 19:if(r=0!=(n&t.childLanes),0!=(64&e.flags)){if(r)return Zs(e,t,n);t.flags|=64}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),li(Ma,Ma.current),r)break;return null;case 23:case 24:return t.lanes=0,Ls(e,t,n)}return eo(e,t,n)}Os=0!=(16384&e.flags)}else Os=!1;switch(t.lanes=0,t.tag){case 2:if(r=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=pi(t,di.current),ra(t,n),i=is(null,t,r,e,i,n),t.flags|=1,"object"==typeof i&&null!==i&&"function"==typeof i.render&&void 0===i.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,gi(r)){var a=!0;bi(t)}else a=!1;t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,sa(t);var o=r.getDerivedStateFromProps;"function"==typeof o&&pa(t,r,o,e),i.updater=ga,t.stateNode=i,i._reactInternals=t,ba(t,r,e,n),t=Ws(null,t,r,!0,a,n)}else t.tag=0,Ms(null,t,i,n),t=t.child;return t;case 16:i=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=(a=i._init)(i._payload),t.type=i,a=t.tag=function(e){if("function"==typeof e)return Lu(e)?1:0;if(null!=e){if((e=e.$$typeof)===I)return 11;if(e===$)return 14}return 2}(i),e=Ki(i,e),a){case 0:t=js(null,t,i,e,n);break e;case 1:t=Us(null,t,i,e,n);break e;case 11:t=Rs(null,t,i,e,n);break e;case 14:t=Bs(null,t,i,Ki(i.type,e),r,n);break e}throw Error(s(306,i,""))}return t;case 0:return r=t.type,i=t.pendingProps,js(e,t,r,i=t.elementType===r?i:Ki(r,i),n);case 1:return r=t.type,i=t.pendingProps,Us(e,t,r,i=t.elementType===r?i:Ki(r,i),n);case 3:if(Vs(t),r=t.updateQueue,null===e||null===r)throw Error(s(282));if(r=t.pendingProps,i=null!==(i=t.memoizedState)?i.element:null,oa(e,t),da(t,r,null,n),(r=t.memoizedState.element)===i)Ga(),t=eo(e,t,n);else{if((a=(i=t.stateNode).hydrate)&&(za=qr(t.stateNode.containerInfo.firstChild),Ba=t,a=La=!0),a){if(null!=(e=i.mutableSourceEagerHydrationData))for(i=0;i<e.length;i+=2)(a=e[i])._workInProgressVersionPrimary=e[i+1],qa.push(a);for(n=Ca(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|1024,n=n.sibling}else Ms(e,t,r,n),Ga();t=t.child}return t;case 5:return Ta(t),null===e&&Ua(t),r=t.type,i=t.pendingProps,a=null!==e?e.memoizedProps:null,o=i.children,Ur(r,i)?o=null:null!==a&&Ur(r,a)&&(t.flags|=16),Ps(e,t),Ms(e,t,o,n),t.child;case 6:return null===e&&Ua(t),null;case 13:return Ks(e,t,n);case 4:return Na(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Sa(t,null,r,n):Ms(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,Rs(e,t,r,i=t.elementType===r?i:Ki(r,i),n);case 7:return Ms(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ms(e,t,t.pendingProps.children,n),t.child;case 10:e:{r=t.type._context,i=t.pendingProps,o=t.memoizedProps,a=i.value;var u=t.type._context;if(li(Yi,u._currentValue),u._currentValue=a,null!==o)if(u=o.value,0==(a=ur(u,a)?0:0|("function"==typeof r._calculateChangedBits?r._calculateChangedBits(u,a):1073741823))){if(o.children===i.children&&!hi.current){t=eo(e,t,n);break e}}else for(null!==(u=t.child)&&(u.return=t);null!==u;){var l=u.dependencies;if(null!==l){o=u.child;for(var c=l.firstContext;null!==c;){if(c.context===r&&0!=(c.observedBits&a)){1===u.tag&&((c=ua(-1,n&-n)).tag=2,la(u,c)),u.lanes|=n,null!==(c=u.alternate)&&(c.lanes|=n),na(u.return,n),l.lanes|=n;break}c=c.next}}else o=10===u.tag&&u.type===t.type?null:u.child;if(null!==o)o.return=u;else for(o=u;null!==o;){if(o===t){o=null;break}if(null!==(u=o.sibling)){u.return=o.return,o=u;break}o=o.return}u=o}Ms(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=(a=t.pendingProps).children,ra(t,n),r=r(i=ia(i,a.unstable_observedBits)),t.flags|=1,Ms(e,t,r,n),t.child;case 14:return a=Ki(i=t.type,t.pendingProps),Bs(e,t,i,a=Ki(i.type,a),r,n);case 15:return zs(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:Ki(r,i),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,gi(r)?(e=!0,bi(t)):e=!1,ra(t,n),ya(t,r,i),ba(t,r,i,n),Ws(null,t,r,!0,e,n);case 19:return Zs(e,t,n);case 23:case 24:return Ls(e,t,n)}throw Error(s(156,t.tag))},Qu.prototype.render=function(e){Hu(e,this._internalRoot,null,null)},Qu.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;Hu(null,e,null,(function(){t[Jr]=null}))},Ze=function(e){13===e.tag&&(cu(e,4,uu()),Yu(e,4))},et=function(e){13===e.tag&&(cu(e,67108864,uu()),Yu(e,67108864))},tt=function(e){if(13===e.tag){var t=uu(),n=lu(e);cu(e,n,t),Yu(e,n)}},nt=function(e,t){return t()},Ae=function(e,t,n){switch(t){case"input":if(ne(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=ri(r);if(!i)throw Error(s(90));Q(r),ne(r,i)}}}break;case"textarea":le(e,n);break;case"select":null!=(t=n.value)&&se(e,!!n.multiple,t,!1)}},$e=function(e,t){var n=Fo;Fo|=1;try{return e(t)}finally{0===(Fo=n)&&(Wo(),qi())}},Te=function(e,t,n,r,i){var a=Fo;Fo|=4;try{return Vi(98,e.bind(null,t,n,r,i))}finally{0===(Fo=a)&&(Wo(),qi())}},Oe=function(){0==(49&Fo)&&(function(){if(null!==eu){var e=eu;eu=null,e.forEach((function(e){e.expiredLanes|=24&e.pendingLanes,hu(e,ji())}))}qi()}(),Iu())},Me=function(e,t){var n=Fo;Fo|=2;try{return e(t)}finally{0===(Fo=n)&&(Wo(),qi())}};var el={findFiberByHostInstance:ei,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},tl={bundleType:el.bundleType,version:el.version,rendererPackageName:el.rendererPackageName,rendererConfig:el.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:w.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=function(e){if(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ke(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var a=i.alternate;if(null===a){if(null!==(r=i.return)){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return Qe(i),e;if(a===r)return Qe(i),t;a=a.sibling}throw Error(s(188))}if(n.return!==r.return)n=i,r=a;else{for(var o=!1,u=i.child;u;){if(u===n){o=!0,n=i,r=a;break}if(u===r){o=!0,r=i,n=a;break}u=u.sibling}if(!o){for(u=a.child;u;){if(u===n){o=!0,n=a,r=i;break}if(u===r){o=!0,r=a,n=i;break}u=u.sibling}if(!o)throw Error(s(189))}}if(n.alternate!==r)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(e),!e)return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}(e))?null:e.stateNode},findFiberByHostInstance:el.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var nl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!nl.isDisabled&&nl.supportsFiber)try{wi=nl.inject(tl),ki=nl}catch(ge){}}t.render=function(e,t,n){if(!Ju(t))throw Error(s(200));return Zu(null,e,t,!1,n)}},73935:(e,t,n)=>{"use strict";!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(64448)},72408:(e,t,n)=>{"use strict";var r=n(27418),i=60103,a=60106;t.Fragment=60107,t.StrictMode=60108,t.Profiler=60114;var s=60109,o=60110,u=60112;t.Suspense=60113;var l=60115,c=60116;if("function"==typeof Symbol&&Symbol.for){var d=Symbol.for;i=d("react.element"),a=d("react.portal"),t.Fragment=d("react.fragment"),t.StrictMode=d("react.strict_mode"),t.Profiler=d("react.profiler"),s=d("react.provider"),o=d("react.context"),u=d("react.forward_ref"),t.Suspense=d("react.suspense"),l=d("react.memo"),c=d("react.lazy")}var h="function"==typeof Symbol&&Symbol.iterator;function f(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g={};function m(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}function y(){}function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}m.prototype.isReactComponent={},m.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(f(85));this.updater.enqueueSetState(this,e,t,"setState")},m.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=m.prototype;var b=v.prototype=new y;b.constructor=v,r(b,m.prototype),b.isPureReactComponent=!0;var x={current:null},w=Object.prototype.hasOwnProperty,k={key:!0,ref:!0,__self:!0,__source:!0};function _(e,t,n){var r,a={},s=null,o=null;if(null!=t)for(r in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(s=""+t.key),t)w.call(t,r)&&!k.hasOwnProperty(r)&&(a[r]=t[r]);var u=arguments.length-2;if(1===u)a.children=n;else if(1<u){for(var l=Array(u),c=0;c<u;c++)l[c]=arguments[c+2];a.children=l}if(e&&e.defaultProps)for(r in u=e.defaultProps)void 0===a[r]&&(a[r]=u[r]);return{$$typeof:i,type:e,key:s,ref:o,props:a,_owner:x.current}}function S(e){return"object"==typeof e&&null!==e&&e.$$typeof===i}var C=/\/+/g;function A(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function E(e,t,n,r,s){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var u=!1;if(null===e)u=!0;else switch(o){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case i:case a:u=!0}}if(u)return s=s(u=e),e=""===r?"."+A(u,0):r,Array.isArray(s)?(n="",null!=e&&(n=e.replace(C,"$&/")+"/"),E(s,t,n,"",(function(e){return e}))):null!=s&&(S(s)&&(s=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,n+(!s.key||u&&u.key===s.key?"":(""+s.key).replace(C,"$&/")+"/")+e)),t.push(s)),1;if(u=0,r=""===r?".":r+":",Array.isArray(e))for(var l=0;l<e.length;l++){var c=r+A(o=e[l],l);u+=E(o,t,n,c,s)}else if(c=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=h&&e[h]||e["@@iterator"])?e:null}(e),"function"==typeof c)for(e=c.call(e),l=0;!(o=e.next()).done;)u+=E(o=o.value,t,n,c=r+A(o,l++),s);else if("object"===o)throw t=""+e,Error(f(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return u}function F(e,t,n){if(null==e)return e;var r=[],i=0;return E(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function I(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}if(1===e._status)return e._result;throw e._result}var D={current:null};function N(){var e=D.current;if(null===e)throw Error(f(321));return e}var $={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:x,IsSomeRendererActing:{current:!1},assign:r};t.Children={map:F,forEach:function(e,t,n){F(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return F(e,(function(){t++})),t},toArray:function(e){return F(e,(function(e){return e}))||[]},only:function(e){if(!S(e))throw Error(f(143));return e}},t.Component=m,t.PureComponent=v,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$,t.cloneElement=function(e,t,n){if(null==e)throw Error(f(267,e));var a=r({},e.props),s=e.key,o=e.ref,u=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,u=x.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)w.call(t,c)&&!k.hasOwnProperty(c)&&(a[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)a.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];a.children=l}return{$$typeof:i,type:e.type,key:s,ref:o,props:a,_owner:u}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:o,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=_,t.createFactory=function(e){var t=_.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:u,render:e}},t.isValidElement=S,t.lazy=function(e){return{$$typeof:c,_payload:{_status:-1,_result:e},_init:I}},t.memo=function(e,t){return{$$typeof:l,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return N().useCallback(e,t)},t.useContext=function(e,t){return N().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return N().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return N().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return N().useLayoutEffect(e,t)},t.useMemo=function(e,t){return N().useMemo(e,t)},t.useReducer=function(e,t,n){return N().useReducer(e,t,n)},t.useRef=function(e){return N().useRef(e)},t.useState=function(e){return N().useState(e)},t.version="17.0.2"},67294:(e,t,n)=>{"use strict";e.exports=n(72408)},60053:(e,t)=>{"use strict";var n,r,i,a;if("object"==typeof performance&&"function"==typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,u=o.now();t.unstable_now=function(){return o.now()-u}}if("undefined"==typeof window||"function"!=typeof MessageChannel){var l=null,c=null,d=function(){if(null!==l)try{var e=t.unstable_now();l(!0,e),l=null}catch(e){throw setTimeout(d,0),e}};n=function(e){null!==l?setTimeout(n,0,e):(l=e,setTimeout(d,0))},r=function(e,t){c=setTimeout(e,t)},i=function(){clearTimeout(c)},t.unstable_shouldYield=function(){return!1},a=t.unstable_forceFrameRate=function(){}}else{var h=window.setTimeout,f=window.clearTimeout;if("undefined"!=typeof console){var p=window.cancelAnimationFrame;"function"!=typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!=typeof p&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var g=!1,m=null,y=-1,v=5,b=0;t.unstable_shouldYield=function(){return t.unstable_now()>=b},a=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):v=0<e?Math.floor(1e3/e):5};var x=new MessageChannel,w=x.port2;x.port1.onmessage=function(){if(null!==m){var e=t.unstable_now();b=e+v;try{m(!0,e)?w.postMessage(null):(g=!1,m=null)}catch(e){throw w.postMessage(null),e}}else g=!1},n=function(e){m=e,g||(g=!0,w.postMessage(null))},r=function(e,n){y=h((function(){e(t.unstable_now())}),n)},i=function(){f(y),y=-1}}function k(e,t){var n=e.length;e.push(t);e:for(;;){var r=n-1>>>1,i=e[r];if(!(void 0!==i&&0<C(i,t)))break e;e[r]=t,e[n]=i,n=r}}function _(e){return void 0===(e=e[0])?null:e}function S(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length;r<i;){var a=2*(r+1)-1,s=e[a],o=a+1,u=e[o];if(void 0!==s&&0>C(s,n))void 0!==u&&0>C(u,s)?(e[r]=u,e[o]=n,r=o):(e[r]=s,e[a]=n,r=a);else{if(!(void 0!==u&&0>C(u,n)))break e;e[r]=u,e[o]=n,r=o}}}return t}return null}function C(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var A=[],E=[],F=1,I=null,D=3,N=!1,$=!1,T=!1;function O(e){for(var t=_(E);null!==t;){if(null===t.callback)S(E);else{if(!(t.startTime<=e))break;S(E),t.sortIndex=t.expirationTime,k(A,t)}t=_(E)}}function M(e){if(T=!1,O(e),!$)if(null!==_(A))$=!0,n(R);else{var t=_(E);null!==t&&r(M,t.startTime-e)}}function R(e,n){$=!1,T&&(T=!1,i()),N=!0;var a=D;try{for(O(n),I=_(A);null!==I&&(!(I.expirationTime>n)||e&&!t.unstable_shouldYield());){var s=I.callback;if("function"==typeof s){I.callback=null,D=I.priorityLevel;var o=s(I.expirationTime<=n);n=t.unstable_now(),"function"==typeof o?I.callback=o:I===_(A)&&S(A),O(n)}else S(A);I=_(A)}if(null!==I)var u=!0;else{var l=_(E);null!==l&&r(M,l.startTime-n),u=!1}return u}finally{I=null,D=a,N=!1}}var B=a;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){$||N||($=!0,n(R))},t.unstable_getCurrentPriorityLevel=function(){return D},t.unstable_getFirstCallbackNode=function(){return _(A)},t.unstable_next=function(e){switch(D){case 1:case 2:case 3:var t=3;break;default:t=D}var n=D;D=t;try{return e()}finally{D=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=B,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=D;D=e;try{return t()}finally{D=n}},t.unstable_scheduleCallback=function(e,a,s){var o=t.unstable_now();switch(s="object"==typeof s&&null!==s&&"number"==typeof(s=s.delay)&&0<s?o+s:o,e){case 1:var u=-1;break;case 2:u=250;break;case 5:u=1073741823;break;case 4:u=1e4;break;default:u=5e3}return e={id:F++,callback:a,priorityLevel:e,startTime:s,expirationTime:u=s+u,sortIndex:-1},s>o?(e.sortIndex=s,k(E,e),null===_(A)&&e===_(E)&&(T?i():T=!0,r(M,s-o))):(e.sortIndex=u,k(A,e),$||N||($=!0,n(R))),e},t.unstable_wrapCallback=function(e){var t=D;return function(){var n=D;D=t;try{return e.apply(this,arguments)}finally{D=n}}}},63840:(e,t,n)=>{"use strict";e.exports=n(60053)},36377:(e,t,n)=>{var r=n(84832),i=n(68652),a=n(90801),s=n(92030),o=n(3618),u=n(89049),l=n(51971);l.alea=r,l.xor128=i,l.xorwow=a,l.xorshift7=s,l.xor4096=o,l.tychei=u,e.exports=l},84832:function(e,t,n){var r;!function(e,i,a){function s(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function o(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function u(e,t){var n=new s(e),r=t&&t.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.alea=u}(0,e=n.nmd(e),n.amdD)},89049:function(e,t,n){var r;!function(e,i,a){function s(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function o(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function u(e,t){var n=new s(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.tychei=u}(0,e=n.nmd(e),n.amdD)},68652:function(e,t,n){var r;!function(e,i,a){function s(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function u(e,t){var n=new s(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.xor128=u}(0,e=n.nmd(e),n.amdD)},3618:function(e,t,n){var r;!function(e,i,a){function s(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,a=t.i;return t.w=r=r+1640531527|0,n=i[a+34&127],e=i[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=i[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,i,a,s,o=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),i=0,a=-32;a<u;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(s=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(s=s+1640531527|0,i=0==(n=o[127&a]^=r+s)?i+1:0);for(i>=128&&(o[127&(t&&t.length||0)]=-1),i=127,a=512;a>0;--a)r=o[i+34&127],n=o[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,o[i]=r^n;e.w=s,e.X=o,e.i=i}(t,e)}function o(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function u(e,t){null==e&&(e=+new Date);var n=new s(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&(r.X&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.xor4096=u}(0,e=n.nmd(e),n.amdD)},92030:function(e,t,n){var r;!function(e,i,a){function s(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],n=(e^=e>>>7)^e<<24,n^=(e=r[i+1&7])^e>>>10,n^=(e=r[i+3&7])^e>>>3,n^=(e=r[i+4&7])^e<<7,e=r[i+7&7],n^=(e^=e<<13)^e<<9,r[i]=n,t.i=i+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function o(e,t){return t.x=e.x.slice(),t.i=e.i,t}function u(e,t){null==e&&(e=+new Date);var n=new s(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&(r.x&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.xorshift7=u}(0,e=n.nmd(e),n.amdD)},90801:function(e,t,n){var r;!function(e,i,a){function s(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function u(e,t){var n=new s(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&o(r,n),i.state=function(){return o(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,i))||(i.exports=r):this.xorwow=u}(0,e=n.nmd(e),n.amdD)},51971:(e,t,n)=>{var r;!function(i,a){var s,o=(0,eval)("this"),u=256,l=a.pow(u,6),c=a.pow(2,52),d=2*c,h=255;function f(e,t,n){var r=[],h=y(m((t=1==t?{entropy:!0}:t||{}).entropy?[e,v(i)]:null==e?function(){try{var e;return s&&(e=s.randomBytes)?e=e(u):(e=new Uint8Array(u),(o.crypto||o.msCrypto).getRandomValues(e)),v(e)}catch(e){var t=o.navigator,n=t&&t.plugins;return[+new Date,o,n,o.screen,v(i)]}}():e,3),r),f=new p(r),b=function(){for(var e=f.g(6),t=l,n=0;e<c;)e=(e+n)*u,t*=u,n=f.g(1);for(;e>=d;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|f.g(4)},b.quick=function(){return f.g(4)/4294967296},b.double=b,y(v(f.S),i),(t.pass||n||function(e,t,n,r){return r&&(r.S&&g(r,f),e.state=function(){return g(f,{})}),n?(a.random=e,t):e})(b,h,"global"in t?t.global:this==a,t.state)}function p(e){var t,n=e.length,r=this,i=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);i<u;)s[i]=i++;for(i=0;i<u;i++)s[i]=s[a=h&a+e[i%n]+(t=s[i])],s[a]=t;(r.g=function(e){for(var t,n=0,i=r.i,a=r.j,s=r.S;e--;)t=s[i=h&i+1],n=n*u+s[h&(s[i]=s[a=h&a+t])+(s[a]=t)];return r.i=i,r.j=a,n})(u)}function g(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){var n,r=[],i=typeof e;if(t&&"object"==i)for(n in e)try{r.push(m(e[n],t-1))}catch(e){}return r.length?r:"string"==i?e:e+"\0"}function y(e,t){for(var n,r=e+"",i=0;i<r.length;)t[h&i]=h&(n^=19*t[h&i])+r.charCodeAt(i++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(a.seedrandom=f,y(a.random(),i),e.exports){e.exports=f;try{s=n(75042)}catch(e){}}else void 0===(r=function(){return f}.call(t,n,t,e))||(e.exports=r)}([],Math)},50505:(e,t,n)=>{"use strict";n.r(t),n.d(t,{DEFAULT_ACTIONS:()=>d0,default:()=>w0,guessMode:()=>y0,vega:()=>u0,vegaLite:()=>l0});var r={};n.r(r),n.d(r,{JsonPatchError:()=>$,_areEquals:()=>U,applyOperation:()=>B,applyPatch:()=>z,applyReducer:()=>L,deepClone:()=>T,getValueByPointer:()=>R,validate:()=>j,validator:()=>P});var i={};n.r(i),n.d(i,{compare:()=>Y,generate:()=>X,observe:()=>H,unobserve:()=>q});var a={};n.r(a),n.d(a,{aggregate:()=>Bu,bin:()=>zu,collect:()=>Pu,compare:()=>ju,countpattern:()=>Wu,cross:()=>Vu,density:()=>Hu,dotbin:()=>Ju,expression:()=>Zu,extent:()=>tl,facet:()=>rl,field:()=>il,filter:()=>sl,flatten:()=>ol,fold:()=>ul,formula:()=>ll,generate:()=>cl,impute:()=>fl,joinaggregate:()=>pl,kde:()=>gl,key:()=>ml,load:()=>vl,lookup:()=>xl,multiextent:()=>wl,multivalues:()=>_l,params:()=>Cl,pivot:()=>Al,prefacet:()=>El,project:()=>Fl,proxy:()=>Il,quantile:()=>Dl,relay:()=>Nl,sample:()=>$l,sequence:()=>Tl,sieve:()=>Ol,subflow:()=>nl,timeunit:()=>Ml,tupleindex:()=>Bl,values:()=>zl,window:()=>Wl});var s={};n.r(s),n.d(s,{interpolate:()=>vh,interpolateArray:()=>ch,interpolateBasis:()=>Jd,interpolateBasisClosed:()=>Zd,interpolateCubehelix:()=>np,interpolateCubehelixLong:()=>rp,interpolateDate:()=>hh,interpolateDiscrete:()=>uf,interpolateHcl:()=>Uf,interpolateHclLong:()=>Wf,interpolateHsl:()=>xf,interpolateHslLong:()=>wf,interpolateHue:()=>lf,interpolateLab:()=>Pf,interpolateNumber:()=>fh,interpolateNumberArray:()=>uh,interpolateObject:()=>ph,interpolateRgb:()=>ih,interpolateRgbBasis:()=>sh,interpolateRgbBasisClosed:()=>oh,interpolateRound:()=>bh,interpolateString:()=>yh,interpolateTransformCss:()=>gf,interpolateTransformSvg:()=>mf,interpolateZoom:()=>vf,piecewise:()=>af,quantize:()=>ip});var o={};n.r(o),n.d(o,{bound:()=>xx,identifier:()=>_x,mark:()=>Sx,overlap:()=>Cx,render:()=>$x,viewlayout:()=>Zx});var u={};n.r(u),n.d(u,{axisticks:()=>tw,datajoin:()=>nw,encode:()=>iw,legendentries:()=>aw,linkpath:()=>cw,pie:()=>gw,scale:()=>vw,sortitems:()=>kw,stack:()=>Ew});var l={};n.r(l),n.d(l,{contour:()=>aC,geojson:()=>uC,geopath:()=>lC,geopoint:()=>cC,geoshape:()=>dC,graticule:()=>hC,heatmap:()=>fC,isocontour:()=>KS,kde2d:()=>nC,projection:()=>gC});var c={};n.r(c),n.d(c,{force:()=>cA});var d={};n.r(d),n.d(d,{nest:()=>cE,pack:()=>mE,partition:()=>vE,stratify:()=>bE,tree:()=>kE,treelinks:()=>_E,treemap:()=>AE});var h={};n.r(h),n.d(h,{label:()=>GE});var f={};n.r(f),n.d(f,{loess:()=>HE,regression:()=>KE});var p={};n.r(p),n.d(p,{voronoi:()=>vF});var g={};n.r(g),n.d(g,{wordcloud:()=>$F});var m={};n.r(m),n.d(m,{crossfilter:()=>LF,resolvefilter:()=>PF});var y={};n.r(y),n.d(y,{Bounds:()=>mm,CanvasHandler:()=>Hv,CanvasRenderer:()=>Jv,DATE:()=>yr,DAY:()=>vr,DAYOFYEAR:()=>br,Dataflow:()=>fo,Debug:()=>xe,Error:()=>ye,EventStream:()=>Js,Gradient:()=>_g,GroupItem:()=>vm,HOURS:()=>xr,Handler:()=>Iv,Info:()=>be,Item:()=>ym,MILLISECONDS:()=>_r,MINUTES:()=>wr,MONTH:()=>gr,Marks:()=>fv,MultiPulse:()=>uo,None:()=>me,Operator:()=>Ks,Parameters:()=>qs,Pulse:()=>io,QUARTER:()=>pr,RenderType:()=>Lb,Renderer:()=>Nv,ResourceLoader:()=>bm,SECONDS:()=>kr,SVGHandler:()=>eb,SVGRenderer:()=>Sb,SVGStringRenderer:()=>zb,Scenegraph:()=>wv,TIME_UNITS:()=>Sr,Transform:()=>go,View:()=>X$,WEEK:()=>mr,Warn:()=>ve,YEAR:()=>fr,accessor:()=>ee,accessorFields:()=>ne,accessorName:()=>te,array:()=>He,ascending:()=>Qe,bandwidthNRD:()=>Do,bin:()=>No,bootstrapCI:()=>Oo,boundClip:()=>Hb,boundContext:()=>Pm,boundItem:()=>pv,boundMark:()=>mv,boundStroke:()=>km,changeset:()=>Vs,clampRange:()=>Xe,codegenExpression:()=>LB,compare:()=>Ye,constant:()=>tt,cumulativeLogNormal:()=>Ko,cumulativeNormal:()=>Wo,cumulativeUniform:()=>tu,dayofyear:()=>Nr,debounce:()=>nt,defaultLocale:()=>rs,definition:()=>yo,densityLogNormal:()=>Xo,densityNormal:()=>Uo,densityUniform:()=>eu,domChild:()=>Cv,domClear:()=>Av,domCreate:()=>_v,domFind:()=>Sv,dotbin:()=>Mo,error:()=>se,expressionFunction:()=>YN,extend:()=>rt,extent:()=>it,extentIndex:()=>at,falsy:()=>pe,fastmap:()=>lt,field:()=>ue,flush:()=>ct,font:()=>av,fontFamily:()=>iv,fontSize:()=>Zy,format:()=>As,formatLocale:()=>Ka,formats:()=>Es,hasOwnProperty:()=>ot,id:()=>le,identity:()=>ce,inferType:()=>bs,inferTypes:()=>xs,ingest:()=>zs,inherits:()=>dt,inrange:()=>ht,interpolate:()=>Xp,interpolateColors:()=>Gp,interpolateRange:()=>Vp,intersect:()=>Ub,intersectBoxLine:()=>Qm,intersectPath:()=>Hm,intersectPoint:()=>Xm,intersectRule:()=>Ym,isArray:()=>ke,isBoolean:()=>ft,isDate:()=>pt,isFunction:()=>Ke,isIterable:()=>gt,isNumber:()=>mt,isObject:()=>_e,isRegExp:()=>yt,isString:()=>vt,isTuple:()=>Ms,key:()=>bt,lerp:()=>xt,lineHeight:()=>ev,loader:()=>Ds,locale:()=>ns,logger:()=>we,lruCache:()=>wt,markup:()=>yb,merge:()=>kt,mergeConfig:()=>Ce,multiLineOffset:()=>nv,one:()=>he,pad:()=>St,panLinear:()=>Re,panLog:()=>Be,panPow:()=>ze,panSymlog:()=>Le,parse:()=>OR,parseExpression:()=>RB,parseSelector:()=>VB,pathCurves:()=>Cg,pathEqual:()=>Kb,pathParse:()=>Fg,pathRectangle:()=>Jg,pathRender:()=>Lg,pathSymbols:()=>Wg,pathTrail:()=>Zg,peek:()=>Fe,point:()=>Fv,projection:()=>BS,quantileLogNormal:()=>Yo,quantileNormal:()=>Vo,quantileUniform:()=>nu,quantiles:()=>Fo,quantizeInterpolator:()=>qp,quarter:()=>Ge,quartiles:()=>Io,random:()=>$o,randomInteger:()=>Bo,randomKDE:()=>qo,randomLCG:()=>Ro,randomLogNormal:()=>Qo,randomMixture:()=>Jo,randomNormal:()=>Go,randomUniform:()=>ru,read:()=>Is,regressionExp:()=>cu,regressionLinear:()=>uu,regressionLoess:()=>gu,regressionLog:()=>lu,regressionPoly:()=>fu,regressionPow:()=>du,regressionQuad:()=>hu,renderModule:()=>jb,repeat:()=>_t,resetDefaultLocale:()=>is,resetSVGClipId:()=>pm,resetSVGDefIds:()=>Yb,responseType:()=>Fs,runtimeContext:()=>s$,sampleCurve:()=>bu,sampleLogNormal:()=>Ho,sampleNormal:()=>jo,sampleUniform:()=>Zo,scale:()=>Op,sceneEqual:()=>Xb,sceneFromJSON:()=>bv,scenePickVisit:()=>uy,sceneToJSON:()=>vv,sceneVisit:()=>oy,sceneZOrder:()=>sy,scheme:()=>Jp,serializeXML:()=>vb,setRandom:()=>To,span:()=>Ct,splitAccessPath:()=>oe,stringValue:()=>At,textMetrics:()=>Hy,timeBin:()=>mi,timeFloor:()=>Hr,timeFormatLocale:()=>es,timeInterval:()=>Zr,timeOffset:()=>ni,timeSequence:()=>ai,timeUnitSpecifier:()=>Fr,timeUnits:()=>Ar,toBoolean:()=>Et,toDate:()=>It,toNumber:()=>Ie,toSet:()=>Nt,toString:()=>Dt,transform:()=>vo,transforms:()=>mo,truncate:()=>$t,truthy:()=>fe,tupleid:()=>Rs,typeParsers:()=>ms,utcFloor:()=>Yr,utcInterval:()=>ei,utcOffset:()=>ri,utcSequence:()=>si,utcdayofyear:()=>Br,utcquarter:()=>qe,utcweek:()=>zr,version:()=>XB,visitArray:()=>Tt,week:()=>$r,writeConfig:()=>Ae,zero:()=>de,zoomLinear:()=>je,zoomLog:()=>Ue,zoomPow:()=>We,zoomSymlog:()=>Ve});var v={};n.r(v),n.d(v,{compile:()=>mZ,extractTransforms:()=>vZ,normalize:()=>Bq,version:()=>bZ});var b={};n.r(b),n.d(b,{dark:()=>kZ,excel:()=>SZ,fivethirtyeight:()=>IZ,ggplot2:()=>NZ,googlecharts:()=>JZ,latimes:()=>BZ,quartz:()=>PZ,urbaninstitute:()=>XZ,version:()=>ZZ,vox:()=>UZ});var x,w=(x=function(e,t){return x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},x(e,t)},function(e,t){function n(){this.constructor=e}x(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),k=Object.prototype.hasOwnProperty;function _(e,t){return k.call(e,t)}function S(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)_(e,i)&&r.push(i);return r}function C(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function A(e){for(var t,n=0,r=e.length;n<r;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0}function E(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function F(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function I(e){if(void 0===e)return!0;if(e)if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(I(e[t]))return!0}else if("object"==typeof e)for(var r=S(e),i=r.length,a=0;a<i;a++)if(I(e[r[a]]))return!0;return!1}function D(e,t){var n=[e];for(var r in t){var i="object"==typeof t[r]?JSON.stringify(t[r],null,2):t[r];void 0!==i&&n.push(r+": "+i)}return n.join("\n")}var N=function(e){function t(t,n,r,i,a){var s=this.constructor,o=e.call(this,D(t,{name:n,index:r,operation:i,tree:a}))||this;return o.name=n,o.index=r,o.operation=i,o.tree=a,Object.setPrototypeOf(o,s.prototype),o.message=D(t,{name:n,index:r,operation:i,tree:a}),o}return w(t,e),t}(Error),$=N,T=C,O={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=R(n,this.path);r&&(r=C(r));var i=B(n,{op:"remove",path:this.from}).removed;return B(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=R(n,this.from);return B(n,{op:"add",path:this.path,value:C(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:U(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},M={add:function(e,t,n){return A(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:O.move,copy:O.copy,test:O.test,_get:O._get};function R(e,t){if(""==t)return e;var n={op:"_get",path:t};return B(e,n),n.value}function B(e,t,n,r,i,a){if(void 0===n&&(n=!1),void 0===r&&(r=!0),void 0===i&&(i=!0),void 0===a&&(a=0),n&&("function"==typeof n?n(t,0,e,t.path):P(t,0)),""===t.path){var s={newDocument:e};if("add"===t.op)return s.newDocument=t.value,s;if("replace"===t.op)return s.newDocument=t.value,s.removed=e,s;if("move"===t.op||"copy"===t.op)return s.newDocument=R(e,t.from),"move"===t.op&&(s.removed=e),s;if("test"===t.op){if(s.test=U(e,t.value),!1===s.test)throw new $("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return s.newDocument=e,s}if("remove"===t.op)return s.removed=e,s.newDocument=null,s;if("_get"===t.op)return t.value=e,s;if(n)throw new $("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return s}r||(e=C(e));var o=(t.path||"").split("/"),u=e,l=1,c=o.length,d=void 0,h=void 0,f=void 0;for(f="function"==typeof n?n:P;;){if((h=o[l])&&-1!=h.indexOf("~")&&(h=F(h)),i&&("__proto__"==h||"prototype"==h&&l>0&&"constructor"==o[l-1]))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===d&&(void 0===u[h]?d=o.slice(0,l).join("/"):l==c-1&&(d=t.path),void 0!==d&&f(t,0,e,d)),l++,Array.isArray(u)){if("-"===h)h=u.length;else{if(n&&!A(h))throw new $("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);A(h)&&(h=~~h)}if(l>=c){if(n&&"add"===t.op&&h>u.length)throw new $("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);if(!1===(s=M[t.op].call(t,u,h,e)).test)throw new $("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return s}}else if(l>=c){if(!1===(s=O[t.op].call(t,u,h,e)).test)throw new $("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return s}if(u=u[h],n&&l<c&&(!u||"object"!=typeof u))throw new $("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,t,e)}}function z(e,t,n,r,i){if(void 0===r&&(r=!0),void 0===i&&(i=!0),n&&!Array.isArray(t))throw new $("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=C(e));for(var a=new Array(t.length),s=0,o=t.length;s<o;s++)a[s]=B(e,t[s],n,!0,i,s),e=a[s].newDocument;return a.newDocument=e,a}function L(e,t,n){var r=B(e,t);if(!1===r.test)throw new $("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function P(e,t,n,r){if("object"!=typeof e||null===e||Array.isArray(e))throw new $("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!O[e.op])throw new $("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if("string"!=typeof e.path)throw new $("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new $('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new $("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new $("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&I(e.value))throw new $("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n)if("add"==e.op){var i=e.path.split("/").length,a=r.split("/").length;if(i!==a+1&&i!==a)throw new $("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==r)throw new $("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if("move"===e.op||"copy"===e.op){var s=j([{op:"_get",path:e.from,value:void 0}],n);if(s&&"OPERATION_PATH_UNRESOLVABLE"===s.name)throw new $("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}function j(e,t,n){try{if(!Array.isArray(e))throw new $("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)z(C(t),C(e),n||!0);else{n=n||P;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(e){if(e instanceof $)return e;throw e}}function U(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,r,i,a=Array.isArray(e),s=Array.isArray(t);if(a&&s){if((r=e.length)!=t.length)return!1;for(n=r;0!=n--;)if(!U(e[n],t[n]))return!1;return!0}if(a!=s)return!1;var o=Object.keys(e);if((r=o.length)!==Object.keys(t).length)return!1;for(n=r;0!=n--;)if(!t.hasOwnProperty(o[n]))return!1;for(n=r;0!=n--;)if(!U(e[i=o[n]],t[i]))return!1;return!0}return e!=e&&t!=t}var W=new WeakMap,V=function(e){this.observers=new Map,this.obj=e},G=function(e,t){this.callback=e,this.observer=t};function q(e,t){t.unobserve()}function H(e,t){var n,r=function(e){return W.get(e)}(e);if(r){var i=function(e,t){return e.observers.get(t)}(r,t);n=i&&i.observer}else r=new V(e),W.set(e,r);if(n)return n;if(n={},r.value=C(e),t){n.callback=t,n.next=null;var a=function(){X(n)},s=function(){clearTimeout(n.next),n.next=setTimeout(a)};"undefined"!=typeof window&&(window.addEventListener("mouseup",s),window.addEventListener("keyup",s),window.addEventListener("mousedown",s),window.addEventListener("keydown",s),window.addEventListener("change",s))}return n.patches=[],n.object=e,n.unobserve=function(){X(n),clearTimeout(n.next),function(e,t){e.observers.delete(t.callback)}(r,n),"undefined"!=typeof window&&(window.removeEventListener("mouseup",s),window.removeEventListener("keyup",s),window.removeEventListener("mousedown",s),window.removeEventListener("keydown",s),window.removeEventListener("change",s))},r.observers.set(t,new G(t,n)),n}function X(e,t){void 0===t&&(t=!1);var n=W.get(e.object);K(n.value,e.object,e.patches,"",t),e.patches.length&&z(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function K(e,t,n,r,i){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var a=S(t),s=S(e),o=!1,u=s.length-1;u>=0;u--){var l=e[d=s[u]];if(!_(t,d)||void 0===t[d]&&void 0!==l&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+E(d),value:C(l)}),n.push({op:"remove",path:r+"/"+E(d)}),o=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}));else{var c=t[d];"object"==typeof l&&null!=l&&"object"==typeof c&&null!=c&&Array.isArray(l)===Array.isArray(c)?K(l,c,n,r+"/"+E(d),i):l!==c&&(i&&n.push({op:"test",path:r+"/"+E(d),value:C(l)}),n.push({op:"replace",path:r+"/"+E(d),value:C(c)}))}}if(o||a.length!=s.length)for(u=0;u<a.length;u++){var d;_(e,d=a[u])||void 0===t[d]||n.push({op:"add",path:r+"/"+E(d),value:C(t[d])})}}}function Y(e,t,n){void 0===n&&(n=!1);var r=[];return K(e,t,r,"",n),r}Object.assign({},r,i,{JsonPatchError:N,deepClone:C,escapePathComponent:E,unescapePathComponent:F});var Q=n(21801),J=n.n(Q),Z=n(52543);function ee(e,t,n){return e.fields=t||[],e.fname=n,e}function te(e){return null==e?null:e.fname}function ne(e){return null==e?null:e.fields}function re(e){return 1===e.length?ie(e[0]):ae(e)}const ie=e=>function(t){return t[e]},ae=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function se(e){throw Error(e)}function oe(e){const t=[],n=e.length;let r,i,a,s=null,o=0,u="";function l(){t.push(u+e.substring(r,i)),u="",r=i+1}for(e+="",r=i=0;i<n;++i)if(a=e[i],"\\"===a)u+=e.substring(r,i),u+=e.substring(++i,++i),r=i;else if(a===s)l(),s=null,o=-1;else{if(s)continue;r===o&&'"'===a||r===o&&"'"===a?(r=i+1,s=a):"."!==a||o?"["===a?(i>r&&l(),o=r=i+1):"]"===a&&(o||se("Access path missing open bracket: "+e),o>0&&l(),o=0,r=i+1):i>r?l():r=i+1}return o&&se("Access path missing closing bracket: "+e),s&&se("Access path missing closing quote: "+e),i>r&&(i++,l()),t}function ue(e,t,n){const r=oe(e);return e=1===r.length?r[0]:e,ee((n&&n.get||re)(r),[e],t||e)}const le=ue("id"),ce=ee((e=>e),[],"identity"),de=ee((()=>0),[],"zero"),he=ee((()=>1),[],"one"),fe=ee((()=>!0),[],"true"),pe=ee((()=>!1),[],"false");function ge(e,t,n){const r=[t].concat([].slice.call(n));console[e].apply(console,r)}const me=0,ye=1,ve=2,be=3,xe=4;function we(e,t){let n=e||me;return{level(e){return arguments.length?(n=+e,this):n},error(){return n>=ye&&ge(t||"error","ERROR",arguments),this},warn(){return n>=ve&&ge(t||"warn","WARN",arguments),this},info(){return n>=be&&ge(t||"log","INFO",arguments),this},debug(){return n>=xe&&ge(t||"log","DEBUG",arguments),this}}}var ke=Array.isArray;function _e(e){return e===Object(e)}const Se=e=>"__proto__"!==e;function Ce(...e){return e.reduce(((e,t)=>{for(const n in t)if("signals"===n)e.signals=Ee(e.signals,t.signals);else{const r="legend"===n?{layout:1}:"style"===n||null;Ae(e,n,t[n],r)}return e}),{})}function Ae(e,t,n,r){if(!Se(t))return;let i,a;if(_e(n)&&!ke(n))for(i in a=_e(e[t])?e[t]:e[t]={},n)r&&(!0===r||r[i])?Ae(a,i,n[i]):Se(i)&&(a[i]=n[i]);else e[t]=n}function Ee(e,t){if(null==e)return t;const n={},r=[];function i(e){n[e.name]||(n[e.name]=1,r.push(e))}return t.forEach(i),e.forEach(i),r}function Fe(e){return e[e.length-1]}function Ie(e){return null==e||""===e?null:+e}const De=e=>t=>e*Math.exp(t),Ne=e=>t=>Math.log(e*t),$e=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),Te=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e,Oe=e=>t=>t<0?-Math.pow(-t,e):Math.pow(t,e);function Me(e,t,n,r){const i=n(e[0]),a=n(Fe(e)),s=(a-i)*t;return[r(i-s),r(a-s)]}function Re(e,t){return Me(e,t,Ie,ce)}function Be(e,t){var n=Math.sign(e[0]);return Me(e,t,Ne(n),De(n))}function ze(e,t,n){return Me(e,t,Oe(n),Oe(1/n))}function Le(e,t,n){return Me(e,t,$e(n),Te(n))}function Pe(e,t,n,r,i){const a=r(e[0]),s=r(Fe(e)),o=null!=t?r(t):(a+s)/2;return[i(o+(a-o)*n),i(o+(s-o)*n)]}function je(e,t,n){return Pe(e,t,n,Ie,ce)}function Ue(e,t,n){const r=Math.sign(e[0]);return Pe(e,t,n,Ne(r),De(r))}function We(e,t,n,r){return Pe(e,t,n,Oe(r),Oe(1/r))}function Ve(e,t,n,r){return Pe(e,t,n,$e(r),Te(r))}function Ge(e){return 1+~~(new Date(e).getMonth()/3)}function qe(e){return 1+~~(new Date(e).getUTCMonth()/3)}function He(e){return null!=e?ke(e)?e:[e]:[]}function Xe(e,t,n){let r,i=e[0],a=e[1];return a<i&&(r=a,a=i,i=r),r=a-i,r>=n-t?[t,n]:[i=Math.min(Math.max(i,t),n-r),i+r]}function Ke(e){return"function"==typeof e}function Ye(e,t,n){n=n||{},t=He(t)||[];const r=[],i=[],a={},s=n.comparator||Je;return He(e).forEach(((e,s)=>{null!=e&&(r.push("descending"===t[s]?-1:1),i.push(e=Ke(e)?e:ue(e,null,n)),(ne(e)||[]).forEach((e=>a[e]=1)))})),0===i.length?null:ee(s(i,r),Object.keys(a))}const Qe=(e,t)=>(e<t||null==e)&&null!=t?-1:(e>t||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t==t?-1:t!=t&&e==e?1:0),Je=(e,t)=>1===e.length?Ze(e[0],t[0]):et(e,t,e.length),Ze=(e,t)=>function(n,r){return Qe(e(n),e(r))*t},et=(e,t,n)=>(t.push(0),function(r,i){let a,s=0,o=-1;for(;0===s&&++o<n;)a=e[o],s=Qe(a(r),a(i));return s*t[o]});function tt(e){return Ke(e)?e:()=>e}function nt(e,t){let n;return r=>{n&&clearTimeout(n),n=setTimeout((()=>(t(r),n=null)),e)}}function rt(e){for(let t,n,r=1,i=arguments.length;r<i;++r)for(n in t=arguments[r],t)e[n]=t[n];return e}function it(e,t){let n,r,i,a,s=0;if(e&&(n=e.length))if(null==t){for(r=e[s];s<n&&(null==r||r!=r);r=e[++s]);for(i=a=r;s<n;++s)r=e[s],null!=r&&(r<i&&(i=r),r>a&&(a=r))}else{for(r=t(e[s]);s<n&&(null==r||r!=r);r=t(e[++s]));for(i=a=r;s<n;++s)r=t(e[s]),null!=r&&(r<i&&(i=r),r>a&&(a=r))}return[i,a]}function at(e,t){const n=e.length;let r,i,a,s,o,u=-1;if(null==t){for(;++u<n;)if(i=e[u],null!=i&&i>=i){r=a=i;break}if(u===n)return[-1,-1];for(s=o=u;++u<n;)i=e[u],null!=i&&(r>i&&(r=i,s=u),a<i&&(a=i,o=u))}else{for(;++u<n;)if(i=t(e[u],u,e),null!=i&&i>=i){r=a=i;break}if(u===n)return[-1,-1];for(s=o=u;++u<n;)i=t(e[u],u,e),null!=i&&(r>i&&(r=i,s=u),a<i&&(a=i,o=u))}return[s,o]}const st=Object.prototype.hasOwnProperty;function ot(e,t){return st.call(e,t)}const ut={};function lt(e){let t,n={};function r(e){return ot(n,e)&&n[e]!==ut}const i={size:0,empty:0,object:n,has:r,get:e=>r(e)?n[e]:void 0,set(e,t){return r(e)||(++i.size,n[e]===ut&&--i.empty),n[e]=t,this},delete(e){return r(e)&&(--i.size,++i.empty,n[e]=ut),this},clear(){i.size=i.empty=0,i.object=n={}},test(e){return arguments.length?(t=e,i):t},clean(){const e={};let r=0;for(const i in n){const a=n[i];a===ut||t&&t(a)||(e[i]=a,++r)}i.size=r,i.empty=0,i.object=n=e}};return e&&Object.keys(e).forEach((t=>{i.set(t,e[t])})),i}function ct(e,t,n,r,i,a){if(!n&&0!==n)return a;const s=+n;let o,u=e[0],l=Fe(e);l<u&&(o=u,u=l,l=o),o=Math.abs(t-u);const c=Math.abs(l-t);return o<c&&o<=s?r:c<=s?i:a}function dt(e,t,n){const r=e.prototype=Object.create(t.prototype);return Object.defineProperty(r,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),rt(r,n)}function ht(e,t,n,r){let i,a=t[0],s=t[t.length-1];return a>s&&(i=a,a=s,s=i),r=void 0===r||r,((n=void 0===n||n)?a<=e:a<e)&&(r?e<=s:e<s)}function ft(e){return"boolean"==typeof e}function pt(e){return"[object Date]"===Object.prototype.toString.call(e)}function gt(e){return e&&Ke(e[Symbol.iterator])}function mt(e){return"number"==typeof e}function yt(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function vt(e){return"string"==typeof e}function bt(e,t,n){e&&(e=t?He(e).map((e=>e.replace(/\\(.)/g,"$1"))):He(e));const r=e&&e.length,i=n&&n.get||re,a=e=>i(t?[e]:oe(e));let s;if(r)if(1===r){const t=a(e[0]);s=function(e){return""+t(e)}}else{const t=e.map(a);s=function(e){let n=""+t[0](e),i=0;for(;++i<r;)n+="|"+t[i](e);return n}}else s=function(){return""};return ee(s,e,"key")}function xt(e,t){const n=e[0],r=Fe(e),i=+t;return i?1===i?r:n+i*(r-n):n}function wt(e){let t,n,r;e=+e||1e4;const i=()=>{t={},n={},r=0},a=(i,a)=>(++r>e&&(n=t,t={},r=1),t[i]=a);return i(),{clear:i,has:e=>ot(t,e)||ot(n,e),get:e=>ot(t,e)?t[e]:ot(n,e)?a(e,n[e]):void 0,set:(e,n)=>ot(t,e)?t[e]=n:a(e,n)}}function kt(e,t,n,r){const i=t.length,a=n.length;if(!a)return t;if(!i)return n;const s=r||new t.constructor(i+a);let o=0,u=0,l=0;for(;o<i&&u<a;++l)s[l]=e(t[o],n[u])>0?n[u++]:t[o++];for(;o<i;++o,++l)s[l]=t[o];for(;u<a;++u,++l)s[l]=n[u];return s}function _t(e,t){let n="";for(;--t>=0;)n+=e;return n}function St(e,t,n,r){const i=n||" ",a=e+"",s=t-a.length;return s<=0?a:"left"===r?_t(i,s)+a:"center"===r?_t(i,~~(s/2))+a+_t(i,Math.ceil(s/2)):a+_t(i,s)}function Ct(e){return e&&Fe(e)-e[0]||0}function At(e){return ke(e)?"["+e.map(At)+"]":_e(e)||vt(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function Et(e){return null==e||""===e?null:!(!e||"false"===e||"0"===e||!e)}const Ft=e=>mt(e)||pt(e)?e:Date.parse(e);function It(e,t){return t=t||Ft,null==e||""===e?null:t(e)}function Dt(e){return null==e||""===e?null:e+""}function Nt(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function $t(e,t,n,r){const i=null!=r?r:"",a=e+"",s=a.length,o=Math.max(0,t-i.length);return s<=t?a:"left"===n?i+a.slice(s-o):"center"===n?a.slice(0,Math.ceil(o/2))+i+a.slice(s-~~(o/2)):a.slice(0,o)+i}function Tt(e,t,n){if(e)if(t){const r=e.length;for(let i=0;i<r;++i){const r=t(e[i]);r&&n(r,i,e)}}else e.forEach(n)}var Ot={},Mt={};function Rt(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function Bt(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function zt(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function Lt(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,i=[],a=e.length,s=0,o=0,u=a<=0,l=!1;function c(){if(u)return Mt;if(l)return l=!1,Ot;var t,r,i=s;if(34===e.charCodeAt(i)){for(;s++<a&&34!==e.charCodeAt(s)||34===e.charCodeAt(++s););return(t=s)>=a?u=!0:10===(r=e.charCodeAt(s++))?l=!0:13===r&&(l=!0,10===e.charCodeAt(s)&&++s),e.slice(i+1,t-1).replace(/""/g,'"')}for(;s<a;){if(10===(r=e.charCodeAt(t=s++)))l=!0;else if(13===r)l=!0,10===e.charCodeAt(s)&&++s;else if(r!==n)continue;return e.slice(i,t)}return u=!0,e.slice(i,a)}for(10===e.charCodeAt(a-1)&&--a,13===e.charCodeAt(a-1)&&--a;(r=c())!==Mt;){for(var d=[];r!==Ot&&r!==Mt;)d.push(r),r=c();t&&null==(d=t(d,o++))||i.push(d)}return i}function i(t,n){return t.map((function(t){return n.map((function(e){return s(t[e])})).join(e)}))}function a(t){return t.map(s).join(e)}function s(e){return null==e?"":e instanceof Date?function(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":function(e){return e<0?"-"+zt(-e,6):e>9999?"+"+zt(e,6):zt(e,4)}(e.getUTCFullYear())+"-"+zt(e.getUTCMonth()+1,2)+"-"+zt(e.getUTCDate(),2)+(i?"T"+zt(t,2)+":"+zt(n,2)+":"+zt(r,2)+"."+zt(i,3)+"Z":r?"T"+zt(t,2)+":"+zt(n,2)+":"+zt(r,2)+"Z":n||t?"T"+zt(t,2)+":"+zt(n,2)+"Z":"")}(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,i,a=r(e,(function(e,r){if(n)return n(e,r-1);i=e,n=t?function(e,t){var n=Rt(e);return function(r,i){return t(n(r),i,e)}}(e,t):Rt(e)}));return a.columns=i||[],a},parseRows:r,format:function(t,n){return null==n&&(n=Bt(t)),[n.map(s).join(e)].concat(i(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=Bt(e)),i(e,t).join("\n")},formatRows:function(e){return e.map(a).join("\n")},formatRow:a,formatValue:s}}function Pt(e){return e}function jt(e,t){return"string"==typeof t&&(t=e.objects[t]),"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map((function(t){return Ut(e,t)}))}:Ut(e,t)}function Ut(e,t){var n=t.id,r=t.bbox,i=null==t.properties?{}:t.properties,a=Wt(e,t);return null==n&&null==r?{type:"Feature",properties:i,geometry:a}:null==r?{type:"Feature",id:n,properties:i,geometry:a}:{type:"Feature",id:n,bbox:r,properties:i,geometry:a}}function Wt(e,t){var n=function(e){if(null==e)return Pt;var t,n,r=e.scale[0],i=e.scale[1],a=e.translate[0],s=e.translate[1];return function(e,o){o||(t=n=0);var u=2,l=e.length,c=new Array(l);for(c[0]=(t+=e[0])*r+a,c[1]=(n+=e[1])*i+s;u<l;)c[u]=e[u],++u;return c}}(e.transform),r=e.arcs;function i(e,t){t.length&&t.pop();for(var i=r[e<0?~e:e],a=0,s=i.length;a<s;++a)t.push(n(i[a],a));e<0&&function(e,t){for(var n,r=e.length,i=r-t;i<--r;)n=e[i],e[i++]=e[r],e[r]=n}(t,s)}function a(e){return n(e)}function s(e){for(var t=[],n=0,r=e.length;n<r;++n)i(e[n],t);return t.length<2&&t.push(t[0]),t}function o(e){for(var t=s(e);t.length<4;)t.push(t[0]);return t}function u(e){return e.map(o)}return function e(t){var n,r=t.type;switch(r){case"GeometryCollection":return{type:r,geometries:t.geometries.map(e)};case"Point":n=a(t.coordinates);break;case"MultiPoint":n=t.coordinates.map(a);break;case"LineString":n=s(t.arcs);break;case"MultiLineString":n=t.arcs.map(s);break;case"Polygon":n=u(t.arcs);break;case"MultiPolygon":n=t.arcs.map(u);break;default:return null}return{type:r,coordinates:n}}(t)}function Vt(e,t){var n={},r={},i={},a=[],s=-1;function o(e,t){for(var r in e){var i=e[r];delete t[i.start],delete i.start,delete i.end,i.forEach((function(e){n[e<0?~e:e]=1})),a.push(i)}}return t.forEach((function(n,r){var i,a=e.arcs[n<0?~n:n];a.length<3&&!a[1][0]&&!a[1][1]&&(i=t[++s],t[s]=n,t[r]=i)})),t.forEach((function(t){var n,a,s=function(t){var n,r=e.arcs[t<0?~t:t],i=r[0];return e.transform?(n=[0,0],r.forEach((function(e){n[0]+=e[0],n[1]+=e[1]}))):n=r[r.length-1],t<0?[n,i]:[i,n]}(t),o=s[0],u=s[1];if(n=i[o])if(delete i[n.end],n.push(t),n.end=u,a=r[u]){delete r[a.start];var l=a===n?n:n.concat(a);r[l.start=n.start]=i[l.end=a.end]=l}else r[n.start]=i[n.end]=n;else if(n=r[u])if(delete r[n.start],n.unshift(t),n.start=o,a=i[o]){delete i[a.end];var c=a===n?n:a.concat(n);r[c.start=a.start]=i[c.end=n.end]=c}else r[n.start]=i[n.end]=n;else r[(n=[t]).start=o]=i[n.end=u]=n})),o(i,r),o(r,i),t.forEach((function(e){n[e<0?~e:e]||a.push([e])})),a}function Gt(e){return Wt(e,qt.apply(this,arguments))}function qt(e,t,n){var r,i,a;if(arguments.length>1)r=Ht(0,t,n);else for(i=0,r=new Array(a=e.arcs.length);i<a;++i)r[i]=i;return{type:"MultiLineString",arcs:Vt(e,r)}}function Ht(e,t,n){var r,i=[],a=[];function s(e){var t=e<0?~e:e;(a[t]||(a[t]=[])).push({i:e,g:r})}function o(e){e.forEach(s)}function u(e){e.forEach(o)}return function e(t){switch(r=t,t.type){case"GeometryCollection":t.geometries.forEach(e);break;case"LineString":o(t.arcs);break;case"MultiLineString":case"Polygon":u(t.arcs);break;case"MultiPolygon":!function(e){e.forEach(u)}(t.arcs)}}(t),a.forEach(null==n?function(e){i.push(e[0].i)}:function(e){n(e[0].g,e[e.length-1].g)&&i.push(e[0].i)}),i}var Xt=Math.sqrt(50),Kt=Math.sqrt(10),Yt=Math.sqrt(2);function Qt(e,t,n){var r,i,a,s,o=-1;if(n=+n,(e=+e)==(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(s=Jt(e,t,n))||!isFinite(s))return[];if(s>0){let n=Math.round(e/s),r=Math.round(t/s);for(n*s<e&&++n,r*s>t&&--r,a=new Array(i=r-n+1);++o<i;)a[o]=(n+o)*s}else{s=-s;let n=Math.round(e*s),r=Math.round(t*s);for(n/s<e&&++n,r/s>t&&--r,a=new Array(i=r-n+1);++o<i;)a[o]=(n+o)/s}return r&&a.reverse(),a}function Jt(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),a=r/Math.pow(10,i);return i>=0?(a>=Xt?10:a>=Kt?5:a>=Yt?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=Xt?10:a>=Kt?5:a>=Yt?2:1)}function Zt(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),a=r/i;return a>=Xt?i*=10:a>=Kt?i*=5:a>=Yt&&(i*=2),t<e?-i:i}var en,tn=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function nn(e){if(!(t=tn.exec(e)))throw new Error("invalid format: "+e);var t;return new rn({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function rn(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function an(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function sn(e){return(e=an(Math.abs(e)))?e[1]:NaN}function on(e,t){var n=an(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}nn.prototype=rn.prototype,rn.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const un={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>on(100*e,t),r:on,s:function(e,t){var n=an(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(en=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,s=r.length;return a===s?r:a>s?r+new Array(a-s+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+an(e,Math.max(0,t+a-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function ln(e){return e}var cn,dn,hn,fn=Array.prototype.map,pn=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function gn(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?ln:(t=fn.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,a=[],s=0,o=t[0],u=0;i>0&&o>0&&(u+o+1>r&&(o=Math.max(1,r-u)),a.push(e.substring(i-=o,i+o)),!((u+=o+1)>r));)o=t[s=(s+1)%t.length];return a.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",s=void 0===e.decimal?".":e.decimal+"",o=void 0===e.numerals?ln:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(fn.call(e.numerals,String)),u=void 0===e.percent?"%":e.percent+"",l=void 0===e.minus?"":e.minus+"",c=void 0===e.nan?"NaN":e.nan+"";function d(e){var t=(e=nn(e)).fill,n=e.align,d=e.sign,h=e.symbol,f=e.zero,p=e.width,g=e.comma,m=e.precision,y=e.trim,v=e.type;"n"===v?(g=!0,v="g"):un[v]||(void 0===m&&(m=12),y=!0,v="g"),(f||"0"===t&&"="===n)&&(f=!0,t="0",n="=");var b="$"===h?i:"#"===h&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",x="$"===h?a:/[%p]/.test(v)?u:"",w=un[v],k=/[defgprs%]/.test(v);function _(e){var i,a,u,h=b,_=x;if("c"===v)_=w(e)+_,e="";else{var S=(e=+e)<0||1/e<0;if(e=isNaN(e)?c:w(Math.abs(e),m),y&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),S&&0==+e&&"+"!==d&&(S=!1),h=(S?"("===d?d:l:"-"===d||"("===d?"":d)+h,_=("s"===v?pn[8+en/3]:"")+_+(S&&"("===d?")":""),k)for(i=-1,a=e.length;++i<a;)if(48>(u=e.charCodeAt(i))||u>57){_=(46===u?s+e.slice(i+1):e.slice(i))+_,e=e.slice(0,i);break}}g&&!f&&(e=r(e,1/0));var C=h.length+e.length+_.length,A=C<p?new Array(p-C+1).join(t):"";switch(g&&f&&(e=r(A+e,A.length?p-_.length:1/0),A=""),n){case"<":e=h+e+_+A;break;case"=":e=h+A+e+_;break;case"^":e=A.slice(0,C=A.length>>1)+h+e+_+A.slice(C);break;default:e=A+h+e+_}return o(e)}return m=void 0===m?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),_.toString=function(){return e+""},_}return{format:d,formatPrefix:function(e,t){var n=d(((e=nn(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(sn(t)/3))),i=Math.pow(10,-r),a=pn[8+r/3];return function(e){return n(i*e)+a}}}}cn=gn({thousands:",",grouping:[3],currency:["$",""]}),dn=cn.format,hn=cn.formatPrefix;var mn=new Date,yn=new Date;function vn(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,a){var s,o=[];if(n=i.ceil(n),a=null==a?1:Math.floor(a),!(n<r&&a>0))return o;do{o.push(s=new Date(+n)),t(n,a),e(n)}while(s<n&&n<r);return o},i.filter=function(n){return vn((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(i.count=function(t,r){return mn.setTime(+t),yn.setTime(+r),e(mn),e(yn),Math.floor(n(mn,yn))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e==0}:function(t){return i.count(0,t)%e==0}):i:null}),i}const bn=1e3,xn=6e4,wn=36e5,kn=864e5,_n=6048e5,Sn=31536e6;var Cn=vn((e=>e.setHours(0,0,0,0)),((e,t)=>e.setDate(e.getDate()+t)),((e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*xn)/kn),(e=>e.getDate()-1));const An=Cn;function En(e){return vn((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*xn)/_n}))}Cn.range;var Fn=En(0),In=En(1),Dn=En(2),Nn=En(3),$n=En(4),Tn=En(5),On=En(6),Mn=(Fn.range,In.range,Dn.range,Nn.range,$n.range,Tn.range,On.range,vn((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/kn}),(function(e){return e.getUTCDate()-1})));const Rn=Mn;function Bn(e){return vn((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/_n}))}Mn.range;var zn=Bn(0),Ln=Bn(1),Pn=Bn(2),jn=Bn(3),Un=Bn(4),Wn=Bn(5),Vn=Bn(6),Gn=(zn.range,Ln.range,Pn.range,jn.range,Un.range,Wn.range,Vn.range,vn((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()})));Gn.every=function(e){return isFinite(e=Math.floor(e))&&e>0?vn((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};const qn=Gn;Gn.range;var Hn=vn((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()}));const Xn=Hn;Hn.range;var Kn=vn((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*bn-e.getMinutes()*xn)}),(function(e,t){e.setTime(+e+t*wn)}),(function(e,t){return(t-e)/wn}),(function(e){return e.getHours()}));const Yn=Kn;Kn.range;var Qn=vn((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*bn)}),(function(e,t){e.setTime(+e+t*xn)}),(function(e,t){return(t-e)/xn}),(function(e){return e.getMinutes()}));const Jn=Qn;Qn.range;var Zn=vn((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+t*bn)}),(function(e,t){return(t-e)/bn}),(function(e){return e.getUTCSeconds()}));const er=Zn;Zn.range;var tr=vn((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));tr.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?vn((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):tr:null};const nr=tr;tr.range;var rr=vn((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()}));rr.every=function(e){return isFinite(e=Math.floor(e))&&e>0?vn((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};const ir=rr;rr.range;var ar=vn((function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCMonth(e.getUTCMonth()+t)}),(function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())}),(function(e){return e.getUTCMonth()}));const sr=ar;ar.range;var or=vn((function(e){e.setUTCMinutes(0,0,0)}),(function(e,t){e.setTime(+e+t*wn)}),(function(e,t){return(t-e)/wn}),(function(e){return e.getUTCHours()}));const ur=or;or.range;var lr=vn((function(e){e.setUTCSeconds(0,0)}),(function(e,t){e.setTime(+e+t*xn)}),(function(e,t){return(t-e)/xn}),(function(e){return e.getUTCMinutes()}));const cr=lr;function dr(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function hr(e){let t=e,n=e;function r(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){const a=r+i>>>1;n(e[a],t)<0?r=a+1:i=a}return r}return 1===e.length&&(t=(t,n)=>e(t)-n,n=function(e){return(t,n)=>dr(e(t),n)}(e)),{left:r,center:function(e,n,i,a){null==i&&(i=0),null==a&&(a=e.length);const s=r(e,n,i,a-1);return s>i&&t(e[s-1],n)>-t(e[s],n)?s-1:s},right:function(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){const a=r+i>>>1;n(e[a],t)>0?i=a:r=a+1}return r}}}lr.range;const fr="year",pr="quarter",gr="month",mr="week",yr="date",vr="day",br="dayofyear",xr="hours",wr="minutes",kr="seconds",_r="milliseconds",Sr=[fr,pr,gr,mr,yr,vr,br,xr,wr,kr,_r],Cr=Sr.reduce(((e,t,n)=>(e[t]=1+n,e)),{});function Ar(e){const t=He(e).slice(),n={};return t.length||se("Missing time unit."),t.forEach((e=>{ot(Cr,e)?n[e]=1:se("Invalid time unit: ".concat(e,"."))})),(n[mr]||n[vr]?1:0)+(n[pr]||n[gr]||n[yr]?1:0)+(n[br]?1:0)>1&&se("Incompatible time units: ".concat(e)),t.sort(((e,t)=>Cr[e]-Cr[t])),t}const Er={[fr]:"%Y ",[pr]:"Q%q ",[gr]:"%b ",[yr]:"%d ",[mr]:"W%U ",[vr]:"%a ",[br]:"%j ",[xr]:"%H:00",[wr]:"00:%M",[kr]:":%S",[_r]:".%L",["".concat(fr,"-").concat(gr)]:"%Y-%m ",["".concat(fr,"-").concat(gr,"-").concat(yr)]:"%Y-%m-%d ",["".concat(xr,"-").concat(wr)]:"%H:%M"};function Fr(e,t){const n=rt({},Er,t),r=Ar(e),i=r.length;let a,s,o="",u=0;for(u=0;u<i;)for(a=r.length;a>u;--a)if(s=r.slice(u,a).join("-"),null!=n[s]){o+=n[s],u=a;break}return o.trim()}const Ir=new Date;function Dr(e){return Ir.setFullYear(e),Ir.setMonth(0),Ir.setDate(1),Ir.setHours(0,0,0,0),Ir}function Nr(e){return Tr(new Date(e))}function $r(e){return Or(new Date(e))}function Tr(e){return An.count(Dr(e.getFullYear())-1,e)}function Or(e){return Fn.count(Dr(e.getFullYear())-1,e)}function Mr(e){return Dr(e).getDay()}function Rr(e,t,n,r,i,a,s){if(0<=e&&e<100){const o=new Date(-1,t,n,r,i,a,s);return o.setFullYear(e),o}return new Date(e,t,n,r,i,a,s)}function Br(e){return Lr(new Date(e))}function zr(e){return Pr(new Date(e))}function Lr(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return Rn.count(t-1,e)}function Pr(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return zn.count(t-1,e)}function jr(e){return Ir.setTime(Date.UTC(e,0,1)),Ir.getUTCDay()}function Ur(e,t,n,r,i,a,s){if(0<=e&&e<100){const e=new Date(Date.UTC(-1,t,n,r,i,a,s));return e.setUTCFullYear(n.y),e}return new Date(Date.UTC(e,t,n,r,i,a,s))}function Wr(e,t,n,r,i){const a=t||1,s=Fe(e),o=(e,t,i)=>function(e,t,n,r){const i=n<=1?e:r?(t,i)=>r+n*Math.floor((e(t,i)-r)/n):(t,r)=>n*Math.floor(e(t,r)/n);return t?(e,n)=>t(i(e,n),n):i}(n[i=i||e],r[i],e===s&&a,t),u=new Date,l=Nt(e),c=l[fr]?o(fr):tt(2012),d=l[gr]?o(gr):l[pr]?o(pr):de,h=l[mr]&&l[vr]?o(vr,1,mr+vr):l[mr]?o(mr,1):l[vr]?o(vr,1):l[yr]?o(yr,1):l[br]?o(br,1):he,f=l[xr]?o(xr):de,p=l[wr]?o(wr):de,g=l[kr]?o(kr):de,m=l[_r]?o(_r):de;return function(e){u.setTime(+e);const t=c(u);return i(t,d(u),h(u,t),f(u),p(u),g(u),m(u))}}function Vr(e,t,n){return t+7*e-(n+6)%7}const Gr={[fr]:e=>e.getFullYear(),[pr]:e=>Math.floor(e.getMonth()/3),[gr]:e=>e.getMonth(),[yr]:e=>e.getDate(),[xr]:e=>e.getHours(),[wr]:e=>e.getMinutes(),[kr]:e=>e.getSeconds(),[_r]:e=>e.getMilliseconds(),[br]:e=>Tr(e),[mr]:e=>Or(e),[mr+vr]:(e,t)=>Vr(Or(e),e.getDay(),Mr(t)),[vr]:(e,t)=>Vr(1,e.getDay(),Mr(t))},qr={[pr]:e=>3*e,[mr]:(e,t)=>Vr(e,0,Mr(t))};function Hr(e,t){return Wr(e,t||1,Gr,qr,Rr)}const Xr={[fr]:e=>e.getUTCFullYear(),[pr]:e=>Math.floor(e.getUTCMonth()/3),[gr]:e=>e.getUTCMonth(),[yr]:e=>e.getUTCDate(),[xr]:e=>e.getUTCHours(),[wr]:e=>e.getUTCMinutes(),[kr]:e=>e.getUTCSeconds(),[_r]:e=>e.getUTCMilliseconds(),[br]:e=>Lr(e),[mr]:e=>Pr(e),[vr]:(e,t)=>Vr(1,e.getUTCDay(),jr(t)),[mr+vr]:(e,t)=>Vr(Pr(e),e.getUTCDay(),jr(t))},Kr={[pr]:e=>3*e,[mr]:(e,t)=>Vr(e,0,jr(t))};function Yr(e,t){return Wr(e,t||1,Xr,Kr,Ur)}const Qr={[fr]:qn,[pr]:Xn.every(3),[gr]:Xn,[mr]:Fn,[yr]:An,[vr]:An,[br]:An,[xr]:Yn,[wr]:Jn,[kr]:er,[_r]:nr},Jr={[fr]:ir,[pr]:sr.every(3),[gr]:sr,[mr]:zn,[yr]:Rn,[vr]:Rn,[br]:Rn,[xr]:ur,[wr]:cr,[kr]:er,[_r]:nr};function Zr(e){return Qr[e]}function ei(e){return Jr[e]}function ti(e,t,n){return e?e.offset(t,n):void 0}function ni(e,t,n){return ti(Zr(e),t,n)}function ri(e,t,n){return ti(ei(e),t,n)}function ii(e,t,n,r){return e?e.range(t,n,r):void 0}function ai(e,t,n,r){return ii(Zr(e),t,n,r)}function si(e,t,n,r){return ii(ei(e),t,n,r)}const oi=31536e6,ui=[fr,gr,yr,xr,wr,kr,_r],li=ui.slice(0,-1),ci=li.slice(0,-1),di=ci.slice(0,-1),hi=di.slice(0,-1),fi=[fr,gr],pi=[fr],gi=[[li,1,1e3],[li,5,5e3],[li,15,15e3],[li,30,3e4],[ci,1,6e4],[ci,5,3e5],[ci,15,9e5],[ci,30,18e5],[di,1,36e5],[di,3,108e5],[di,6,216e5],[di,12,432e5],[hi,1,864e5],[[fr,mr],1,6048e5],[fi,1,2592e6],[fi,3,7776e6],[pi,1,oi]];function mi(e){const t=e.extent,n=e.maxbins||40,r=Math.abs(Ct(t))/n;let i,a,s=hr((e=>e[2])).right(gi,r);return s===gi.length?(i=pi,a=Zt(t[0]/oi,t[1]/oi,n)):s?(s=gi[r/gi[s-1][2]<gi[s][2]/r?s-1:s],i=s[0],a=s[1]):(i=ui,a=Math.max(Zt(t[0],t[1],n),1)),{units:i,step:a}}function yi(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function vi(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function bi(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function xi(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,a=e.days,s=e.shortDays,o=e.months,u=e.shortMonths,l=$i(i),c=Ti(i),d=$i(a),h=Ti(a),f=$i(s),p=Ti(s),g=$i(o),m=Ti(o),y=$i(u),v=Ti(u),b={a:function(e){return s[e.getDay()]},A:function(e){return a[e.getDay()]},b:function(e){return u[e.getMonth()]},B:function(e){return o[e.getMonth()]},c:null,d:ea,e:ea,f:aa,g:ma,G:va,H:ta,I:na,j:ra,L:ia,m:sa,M:oa,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:ja,s:Ua,S:ua,u:la,U:ca,V:ha,w:fa,W:pa,x:null,X:null,y:ga,Y:ya,Z:ba,"%":Pa},x={a:function(e){return s[e.getUTCDay()]},A:function(e){return a[e.getUTCDay()]},b:function(e){return u[e.getUTCMonth()]},B:function(e){return o[e.getUTCMonth()]},c:null,d:xa,e:xa,f:Ca,g:Ra,G:za,H:wa,I:ka,j:_a,L:Sa,m:Aa,M:Ea,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:ja,s:Ua,S:Fa,u:Ia,U:Da,V:$a,w:Ta,W:Oa,x:null,X:null,y:Ma,Y:Ba,Z:La,"%":Pa},w={a:function(e,t,n){var r=f.exec(t.slice(n));return r?(e.w=p.get(r[0].toLowerCase()),n+r[0].length):-1},A:function(e,t,n){var r=d.exec(t.slice(n));return r?(e.w=h.get(r[0].toLowerCase()),n+r[0].length):-1},b:function(e,t,n){var r=y.exec(t.slice(n));return r?(e.m=v.get(r[0].toLowerCase()),n+r[0].length):-1},B:function(e,t,n){var r=g.exec(t.slice(n));return r?(e.m=m.get(r[0].toLowerCase()),n+r[0].length):-1},c:function(e,n,r){return S(e,t,n,r)},d:Vi,e:Vi,f:Yi,g:Pi,G:Li,H:qi,I:qi,j:Gi,L:Ki,m:Wi,M:Hi,p:function(e,t,n){var r=l.exec(t.slice(n));return r?(e.p=c.get(r[0].toLowerCase()),n+r[0].length):-1},q:Ui,Q:Ji,s:Zi,S:Xi,u:Mi,U:Ri,V:Bi,w:Oi,W:zi,x:function(e,t,r){return S(e,n,t,r)},X:function(e,t,n){return S(e,r,t,n)},y:Pi,Y:Li,Z:ji,"%":Qi};function k(e,t){return function(n){var r,i,a,s=[],o=-1,u=0,l=e.length;for(n instanceof Date||(n=new Date(+n));++o<l;)37===e.charCodeAt(o)&&(s.push(e.slice(u,o)),null!=(i=Ai[r=e.charAt(++o)])?r=e.charAt(++o):i="e"===r?" ":"0",(a=t[r])&&(r=a(n,i)),s.push(r),u=o+1);return s.push(e.slice(u,o)),s.join("")}}function _(e,t){return function(n){var r,i,a=bi(1900,void 0,1);if(S(a,e,n+="",0)!=n.length)return null;if("Q"in a)return new Date(a.Q);if("s"in a)return new Date(1e3*a.s+("L"in a?a.L:0));if(t&&!("Z"in a)&&(a.Z=0),"p"in a&&(a.H=a.H%12+12*a.p),void 0===a.m&&(a.m="q"in a?a.q:0),"V"in a){if(a.V<1||a.V>53)return null;"w"in a||(a.w=1),"Z"in a?(i=(r=vi(bi(a.y,0,1))).getUTCDay(),r=i>4||0===i?Ln.ceil(r):Ln(r),r=Rn.offset(r,7*(a.V-1)),a.y=r.getUTCFullYear(),a.m=r.getUTCMonth(),a.d=r.getUTCDate()+(a.w+6)%7):(i=(r=yi(bi(a.y,0,1))).getDay(),r=i>4||0===i?In.ceil(r):In(r),r=An.offset(r,7*(a.V-1)),a.y=r.getFullYear(),a.m=r.getMonth(),a.d=r.getDate()+(a.w+6)%7)}else("W"in a||"U"in a)&&("w"in a||(a.w="u"in a?a.u%7:"W"in a?1:0),i="Z"in a?vi(bi(a.y,0,1)).getUTCDay():yi(bi(a.y,0,1)).getDay(),a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(i+5)%7:a.w+7*a.U-(i+6)%7);return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,vi(a)):yi(a)}}function S(e,t,n,r){for(var i,a,s=0,o=t.length,u=n.length;s<o;){if(r>=u)return-1;if(37===(i=t.charCodeAt(s++))){if(i=t.charAt(s++),!(a=w[i in Ai?t.charAt(s++):i])||(r=a(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return b.x=k(n,b),b.X=k(r,b),b.c=k(t,b),x.x=k(n,x),x.X=k(r,x),x.c=k(t,x),{format:function(e){var t=k(e+="",b);return t.toString=function(){return e},t},parse:function(e){var t=_(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=k(e+="",x);return t.toString=function(){return e},t},utcParse:function(e){var t=_(e+="",!0);return t.toString=function(){return e},t}}}var wi,ki,_i,Si,Ci,Ai={"-":"",_:" ",0:"0"},Ei=/^\s*\d+/,Fi=/^%/,Ii=/[\\^$*+?|[\]().{}]/g;function Di(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function Ni(e){return e.replace(Ii,"\\$&")}function $i(e){return new RegExp("^(?:"+e.map(Ni).join("|")+")","i")}function Ti(e){return new Map(e.map(((e,t)=>[e.toLowerCase(),t])))}function Oi(e,t,n){var r=Ei.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function Mi(e,t,n){var r=Ei.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function Ri(e,t,n){var r=Ei.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function Bi(e,t,n){var r=Ei.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function zi(e,t,n){var r=Ei.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function Li(e,t,n){var r=Ei.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function Pi(e,t,n){var r=Ei.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function ji(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Ui(e,t,n){var r=Ei.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function Wi(e,t,n){var r=Ei.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function Vi(e,t,n){var r=Ei.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function Gi(e,t,n){var r=Ei.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function qi(e,t,n){var r=Ei.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function Hi(e,t,n){var r=Ei.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function Xi(e,t,n){var r=Ei.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function Ki(e,t,n){var r=Ei.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function Yi(e,t,n){var r=Ei.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Qi(e,t,n){var r=Fi.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function Ji(e,t,n){var r=Ei.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function Zi(e,t,n){var r=Ei.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function ea(e,t){return Di(e.getDate(),t,2)}function ta(e,t){return Di(e.getHours(),t,2)}function na(e,t){return Di(e.getHours()%12||12,t,2)}function ra(e,t){return Di(1+An.count(qn(e),e),t,3)}function ia(e,t){return Di(e.getMilliseconds(),t,3)}function aa(e,t){return ia(e,t)+"000"}function sa(e,t){return Di(e.getMonth()+1,t,2)}function oa(e,t){return Di(e.getMinutes(),t,2)}function ua(e,t){return Di(e.getSeconds(),t,2)}function la(e){var t=e.getDay();return 0===t?7:t}function ca(e,t){return Di(Fn.count(qn(e)-1,e),t,2)}function da(e){var t=e.getDay();return t>=4||0===t?$n(e):$n.ceil(e)}function ha(e,t){return e=da(e),Di($n.count(qn(e),e)+(4===qn(e).getDay()),t,2)}function fa(e){return e.getDay()}function pa(e,t){return Di(In.count(qn(e)-1,e),t,2)}function ga(e,t){return Di(e.getFullYear()%100,t,2)}function ma(e,t){return Di((e=da(e)).getFullYear()%100,t,2)}function ya(e,t){return Di(e.getFullYear()%1e4,t,4)}function va(e,t){var n=e.getDay();return Di((e=n>=4||0===n?$n(e):$n.ceil(e)).getFullYear()%1e4,t,4)}function ba(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Di(t/60|0,"0",2)+Di(t%60,"0",2)}function xa(e,t){return Di(e.getUTCDate(),t,2)}function wa(e,t){return Di(e.getUTCHours(),t,2)}function ka(e,t){return Di(e.getUTCHours()%12||12,t,2)}function _a(e,t){return Di(1+Rn.count(ir(e),e),t,3)}function Sa(e,t){return Di(e.getUTCMilliseconds(),t,3)}function Ca(e,t){return Sa(e,t)+"000"}function Aa(e,t){return Di(e.getUTCMonth()+1,t,2)}function Ea(e,t){return Di(e.getUTCMinutes(),t,2)}function Fa(e,t){return Di(e.getUTCSeconds(),t,2)}function Ia(e){var t=e.getUTCDay();return 0===t?7:t}function Da(e,t){return Di(zn.count(ir(e)-1,e),t,2)}function Na(e){var t=e.getUTCDay();return t>=4||0===t?Un(e):Un.ceil(e)}function $a(e,t){return e=Na(e),Di(Un.count(ir(e),e)+(4===ir(e).getUTCDay()),t,2)}function Ta(e){return e.getUTCDay()}function Oa(e,t){return Di(Ln.count(ir(e)-1,e),t,2)}function Ma(e,t){return Di(e.getUTCFullYear()%100,t,2)}function Ra(e,t){return Di((e=Na(e)).getUTCFullYear()%100,t,2)}function Ba(e,t){return Di(e.getUTCFullYear()%1e4,t,4)}function za(e,t){var n=e.getUTCDay();return Di((e=n>=4||0===n?Un(e):Un.ceil(e)).getUTCFullYear()%1e4,t,4)}function La(){return"+0000"}function Pa(){return"%"}function ja(e){return+e}function Ua(e){return Math.floor(+e/1e3)}function Wa(e){const t={};return n=>t[n]||(t[n]=e(n))}function Va(e){const t=Wa(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(e){const n=nn(e||",");if(null==n.precision){switch(n.precision=12,n.type){case"%":n.precision-=2;break;case"e":n.precision-=1}return function(e,t){return n=>{const r=e(n),i=r.indexOf(t);if(i<0)return r;let a=function(e,t){let n,r=e.lastIndexOf("e");if(r>0)return r;for(r=e.length;--r>t;)if(n=e.charCodeAt(r),n>=48&&n<=57)return r+1}(r,i);const s=a<r.length?r.slice(a):"";for(;--a>i;)if("0"!==r[a]){++a;break}return r.slice(0,a)+s}}(t(n),t(".1f")(1)[1])}return t(n)},formatSpan(e,r,i,a){a=nn(null==a?",f":a);const s=Zt(e,r,i),o=Math.max(Math.abs(e),Math.abs(r));let u;if(null==a.precision)switch(a.type){case"s":return isNaN(u=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(sn(t)/3)))-sn(Math.abs(e)))}(s,o))||(a.precision=u),n(a,o);case"":case"e":case"g":case"p":case"r":isNaN(u=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,sn(t)-sn(e))+1}(s,o))||(a.precision=u-("e"===a.type));break;case"f":case"%":isNaN(u=function(e){return Math.max(0,-sn(Math.abs(e)))}(s))||(a.precision=u-2*("%"===a.type))}return t(a)}}}let Ga,qa;function Ha(){return Ga=Va({format:dn,formatPrefix:hn})}function Xa(e){return Va(gn(e))}function Ka(e){return arguments.length?Ga=Xa(e):Ga}function Ya(e,t,n){_e(n=n||{})||se("Invalid time multi-format specifier: ".concat(n));const r=t(kr),i=t(wr),a=t(xr),s=t(yr),o=t(mr),u=t(gr),l=t(pr),c=t(fr),d=e(n[_r]||".%L"),h=e(n[kr]||":%S"),f=e(n[wr]||"%I:%M"),p=e(n[xr]||"%I %p"),g=e(n[yr]||n[vr]||"%a %d"),m=e(n[mr]||"%b %d"),y=e(n[gr]||"%B"),v=e(n[pr]||"%B"),b=e(n[fr]||"%Y");return e=>(r(e)<e?d:i(e)<e?h:a(e)<e?f:s(e)<e?p:u(e)<e?o(e)<e?g:m:c(e)<e?l(e)<e?y:v:b)(e)}function Qa(e){const t=Wa(e.format),n=Wa(e.utcFormat);return{timeFormat:e=>vt(e)?t(e):Ya(t,Zr,e),utcFormat:e=>vt(e)?n(e):Ya(n,ei,e),timeParse:Wa(e.parse),utcParse:Wa(e.utcParse)}}function Ja(){return qa=Qa({format:ki,parse:_i,utcFormat:Si,utcParse:Ci})}function Za(e){return Qa(xi(e))}function es(e){return arguments.length?qa=Za(e):qa}wi=xi({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),ki=wi.format,_i=wi.parse,Si=wi.utcFormat,Ci=wi.utcParse,Ha(),Ja();const ts=(e,t)=>rt({},e,t);function ns(e,t){const n=e?Xa(e):Ka(),r=t?Za(t):es();return ts(n,r)}function rs(e,t){const n=arguments.length;return n&&2!==n&&se("defaultLocale expects either zero or two arguments."),n?ts(Ka(e),es(t)):ts(Ka(),es())}function is(){return Ha(),Ja(),rs()}const as=/^(data:|([A-Za-z]+:)?\/\/)/,ss=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,os=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,us="file://";async function ls(e,t){const n=await this.sanitize(e,t),r=n.href;return n.localFile?this.file(r):this.http(r,t)}async function cs(e,t){t=rt({},this.options,t);const n=this.fileAccess,r={href:null};let i,a,s;const o=ss.test(e.replace(os,""));null!=e&&"string"==typeof e&&o||se("Sanitize failure, invalid URI: "+At(e));const u=as.test(e);return(s=t.baseURL)&&!u&&(e.startsWith("/")||s.endsWith("/")||(e="/"+e),e=s+e),a=(i=e.startsWith(us))||"file"===t.mode||"http"!==t.mode&&!u&&n,i?e=e.slice(us.length):e.startsWith("//")&&("file"===t.defaultProtocol?(e=e.slice(2),a=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(r,"localFile",{value:!!a}),r.href=e,t.target&&(r.target=t.target+""),t.rel&&(r.rel=t.rel+""),"image"===t.context&&t.crossOrigin&&(r.crossOrigin=t.crossOrigin+""),r}function ds(e){return e?t=>new Promise(((n,r)=>{e.readFile(t,((e,t)=>{e?r(e):n(t)}))})):hs}async function hs(){se("No file system access.")}function fs(e){return e?async function(t,n){const r=rt({},this.options.http,n),i=n&&n.response,a=await e(t,r);return a.ok?Ke(a[i])?a[i]():a.text():se(a.status+""+a.statusText)}:ps}async function ps(){se("No HTTP fetch method available.")}const gs=e=>!(Number.isNaN(+e)||e instanceof Date),ms={boolean:Et,integer:Ie,number:Ie,date:It,string:Dt,unknown:ce},ys=[e=>"true"===e||"false"===e||!0===e||!1===e,e=>gs(e)&&Number.isInteger(+e),gs,e=>!Number.isNaN(Date.parse(e))],vs=["boolean","integer","number","date"];function bs(e,t){if(!e||!e.length)return"unknown";const n=e.length,r=ys.length,i=ys.map(((e,t)=>t+1));for(let s,o,u=0,l=0;u<n;++u)for(o=t?e[u][t]:e[u],s=0;s<r;++s)if(i[s]&&null!=(a=o)&&a==a&&!ys[s](o)&&(i[s]=0,++l,l===ys.length))return"string";var a;return vs[i.reduce(((e,t)=>0===e?t:e),0)-1]}function xs(e,t){return t.reduce(((t,n)=>(t[n]=bs(e,n),t)),{})}function ws(e){const t=function(t,n){const r={delimiter:e};return ks(t,n?rt(n,r):r)};return t.responseType="text",t}function ks(e,t){return t.header&&(e=t.header.map(At).join(t.delimiter)+"\n"+e),Lt(t.delimiter).parse(e+"")}function _s(e,t){const n=t&&t.property?ue(t.property):ce;return!_e(e)||(r=e,"function"==typeof Buffer&&Ke(Buffer.isBuffer)&&Buffer.isBuffer(r))?n(JSON.parse(e)):function(e,t){return!ke(e)&&gt(e)&&(e=[...e]),t&&t.copy?JSON.parse(JSON.stringify(e)):e}(n(e),t);var r}ks.responseType="text",_s.responseType="json";const Ss={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function Cs(e,t){let n,r,i,a;return e=_s(e,t),t&&t.feature?(n=jt,i=t.feature):t&&t.mesh?(n=Gt,i=t.mesh,a=Ss[t.filter]):se("Missing TopoJSON feature or mesh parameter."),r=(r=e.objects[i])?n(e,r,a):se("Invalid TopoJSON object: "+i),r&&r.features||[r]}Cs.responseType="json";const As={dsv:ks,csv:ws(","),tsv:ws("\t"),json:_s,topojson:Cs};function Es(e,t){return arguments.length>1?(As[e]=t,this):ot(As,e)?As[e]:null}function Fs(e){const t=Es(e);return t&&t.responseType||"text"}function Is(e,t,n,r){const i=Es((t=t||{}).type||"json");return i||se("Unknown data format type: "+t.type),e=i(e,t),t.parse&&function(e,t,n,r){if(!e.length)return;const i=es();n=n||i.timeParse,r=r||i.utcParse;let a,s,o,u,l,c,d=e.columns||Object.keys(e[0]);"auto"===t&&(t=xs(e,d)),d=Object.keys(t);const h=d.map((e=>{const i=t[e];let a,s;if(i&&(i.startsWith("date:")||i.startsWith("utc:")))return a=i.split(/:(.+)?/,2),s=a[1],("'"===s[0]&&"'"===s[s.length-1]||'"'===s[0]&&'"'===s[s.length-1])&&(s=s.slice(1,-1)),("utc"===a[0]?r:n)(s);if(!ms[i])throw Error("Illegal format pattern: "+e+":"+i);return ms[i]}));for(o=0,l=e.length,c=d.length;o<l;++o)for(a=e[o],u=0;u<c;++u)s=d[u],a[s]=h[u](a[s])}(e,t.parse,n,r),ot(e,"columns")&&delete e.columns,e}const Ds=function(e,t){return t=>({options:t||{},sanitize:cs,load:ls,fileAccess:!1,file:ds(null),http:fs(e)})}("undefined"!=typeof fetch&&fetch);function Ns(e){const t=e||ce,n=[],r={};return n.add=e=>{const i=t(e);return r[i]||(r[i]=1,n.push(e)),n},n.remove=e=>{const i=t(e);if(r[i]){r[i]=0;const t=n.indexOf(e);t>=0&&n.splice(t,1)}return n},n}async function $s(e,t){try{await t(e)}catch(t){e.error(t)}}const Ts=Symbol("vega_id");let Os=1;function Ms(e){return!(!e||!Rs(e))}function Rs(e){return e[Ts]}function Bs(e,t){return e[Ts]=t,e}function zs(e){const t=e===Object(e)?e:{data:e};return Rs(t)?t:Bs(t,Os++)}function Ls(e){return Ps(e,zs({}))}function Ps(e,t){for(const n in e)t[n]=e[n];return t}function js(e,t){return Bs(t,Rs(e))}function Us(e,t){return e?t?(n,r)=>e(n,r)||Rs(t(n))-Rs(t(r)):(t,n)=>e(t,n)||Rs(t)-Rs(n):null}function Ws(e){return e&&e.constructor===Vs}function Vs(){const e=[],t=[],n=[],r=[],i=[];let a=null,s=!1;return{constructor:Vs,insert(t){const n=He(t),r=n.length;for(let t=0;t<r;++t)e.push(n[t]);return this},remove(e){const n=Ke(e)?r:t,i=He(e),a=i.length;for(let e=0;e<a;++e)n.push(i[e]);return this},modify(e,t,r){const a={field:t,value:tt(r)};return Ke(e)?(a.filter=e,i.push(a)):(a.tuple=e,n.push(a)),this},encode(e,t){return Ke(e)?i.push({filter:e,field:t}):n.push({tuple:e,field:t}),this},clean(e){return a=e,this},reflow(){return s=!0,this},pulse(o,u){const l={},c={};let d,h,f,p,g,m;for(d=0,h=u.length;d<h;++d)l[Rs(u[d])]=1;for(d=0,h=t.length;d<h;++d)g=t[d],l[Rs(g)]=-1;for(d=0,h=r.length;d<h;++d)p=r[d],u.forEach((e=>{p(e)&&(l[Rs(e)]=-1)}));for(d=0,h=e.length;d<h;++d)g=e[d],m=Rs(g),l[m]?l[m]=1:o.add.push(zs(e[d]));for(d=0,h=u.length;d<h;++d)g=u[d],l[Rs(g)]<0&&o.rem.push(g);function y(e,t,n){n?e[t]=n(e):o.encode=t,s||(c[Rs(e)]=e)}for(d=0,h=n.length;d<h;++d)f=n[d],g=f.tuple,p=f.field,m=l[Rs(g)],m>0&&(y(g,p,f.value),o.modifies(p));for(d=0,h=i.length;d<h;++d)f=i[d],p=f.filter,u.forEach((e=>{p(e)&&l[Rs(e)]>0&&y(e,f.field,f.value)})),o.modifies(f.field);if(s)o.mod=t.length||r.length?u.filter((e=>l[Rs(e)]>0)):u.slice();else for(m in c)o.mod.push(c[m]);return(a||null==a&&(t.length||r.length))&&o.clean(!0),o}}}const Gs="_:mod:_";function qs(){Object.defineProperty(this,Gs,{writable:!0,value:{}})}qs.prototype={set(e,t,n,r){const i=this,a=i[e],s=i[Gs];return null!=t&&t>=0?(a[t]!==n||r)&&(a[t]=n,s[t+":"+e]=-1,s[e]=-1):(a!==n||r)&&(i[e]=n,s[e]=ke(n)?1+n.length:-1),i},modified(e,t){const n=this[Gs];if(!arguments.length){for(const e in n)if(n[e])return!0;return!1}if(ke(e)){for(let t=0;t<e.length;++t)if(n[e[t]])return!0;return!1}return null!=t&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[Gs]={},this}};let Hs=0;const Xs=new qs;function Ks(e,t,n,r){this.id=++Hs,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,r)}function Ys(e){return function(t){const n=this.flags;return 0===arguments.length?!!(n&e):(this.flags=t?n|e:n&~e,this)}}Ks.prototype={targets(){return this._targets||(this._targets=Ns(le))},set(e){return this.value!==e?(this.value=e,1):0},skip:Ys(1),modified:Ys(2),parameters(e,t,n){t=!1!==t;const r=this._argval=this._argval||new qs,i=this._argops=this._argops||[],a=[];let s,o,u,l;const c=(e,n,s)=>{s instanceof Ks?(s!==this&&(t&&s.targets().add(this),a.push(s)),i.push({op:s,name:e,index:n})):r.set(e,n,s)};for(s in e)if(o=e[s],"pulse"===s)He(o).forEach((e=>{e instanceof Ks?e!==this&&(e.targets().add(this),a.push(e)):se("Pulse parameters must be operator instances.")})),this.source=o;else if(ke(o))for(r.set(s,-1,Array(u=o.length)),l=0;l<u;++l)c(s,l,o[l]);else c(s,-1,o);return this.marshall().clear(),n&&(i.initonly=!0),a},marshall(e){const t=this._argval||Xs,n=this._argops;let r,i,a,s;if(n){const o=n.length;for(i=0;i<o;++i)r=n[i],a=r.op,s=a.modified()&&a.stamp===e,t.set(r.name,r.index,a.value,s);if(n.initonly){for(i=0;i<o;++i)r=n[i],r.op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,r,i;if(e)for(t=0,n=e.length;t<n;++t)r=e[t],i=r.op,i._targets&&i._targets.remove(this);this.pulse=null,this.source=null},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),r=t.call(this,n,e);if(n.clear(),r!==this.value)this.value=r;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};let Qs=0;function Js(e,t,n){this.id=++Qs,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function Zs(e,t,n){return new Js(e,t,n)}Js.prototype={_filter:fe,_apply:ce,targets(){return this._targets||(this._targets=Ns(le))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,r=n?n.length:0;for(let e=0;e<r;++e)n[e].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=Zs(e);return this.targets().add(t),t},apply(e){const t=Zs(null,e);return this.targets().add(t),t},merge(){const e=Zs();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter((()=>{const n=Date.now();return n-t>e?(t=n,1):0}))},debounce(e){const t=Zs();return this.targets().add(Zs(null,null,nt(e,(e=>{const n=e.dataflow;t.receive(e),n&&n.run&&n.run()})))),t},between(e,t){let n=!1;return e.targets().add(Zs(null,null,(()=>n=!0))),t.targets().add(Zs(null,null,(()=>n=!1))),this.filter((()=>n))},detach(){this._filter=fe,this._targets=null}};const eo={skip:!0};function to(e,t,n,r,i,a){const s=rt({},a,eo);let o,u;Ke(n)||(n=tt(n)),void 0===r?o=t=>e.touch(n(t)):Ke(r)?(u=new Ks(null,r,i,!1),o=t=>{u.evaluate(t);const r=n(t),i=u.value;Ws(i)?e.pulse(r,i,a):e.update(r,i,s)}):o=t=>e.update(n(t),r,s),t.apply(o)}function no(e,t,n,r,i,a){if(void 0===r)t.targets().add(n);else{const s=a||{},o=new Ks(null,function(e,t){return t=Ke(t)?t:tt(t),e?function(n,r){const i=t(n,r);return e.skip()||(e.skip(i!==this.value).value=i),i}:t}(n,r),i,!1);o.modified(s.force),o.rank=t.rank,t.targets().add(o),n&&(o.skip(!0),o.value=n.value,o.targets().add(n),e.connect(n,[o]))}}const ro={};function io(e,t,n){this.dataflow=e,this.stamp=null==t?-1:t,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function ao(e,t){const n=[];return Tt(e,t,(e=>n.push(e))),n}function so(e,t){const n={};return e.visit(t,(e=>{n[Rs(e)]=1})),e=>n[Rs(e)]?null:e}function oo(e,t){return e?(n,r)=>e(n,r)&&t(n,r):t}function uo(e,t,n,r){const i=this,a=n.length;let s=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=r||null,this.pulses=n;for(let e=0;e<a;++e){const r=n[e];if(r.stamp===t){if(r.fields){const e=i.fields||(i.fields={});for(const t in r.fields)e[t]=1}r.changed(i.ADD)&&(s|=i.ADD),r.changed(i.REM)&&(s|=i.REM),r.changed(i.MOD)&&(s|=i.MOD)}}this.changes=s}function lo(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}io.prototype={StopPropagation:ro,ADD:1,REM:2,MOD:4,ADD_REM:3,ADD_MOD:5,ALL:7,REFLOW:8,SOURCE:16,NO_SOURCE:32,NO_FIELDS:64,fork(e){return new io(this.dataflow).init(this,e)},clone(){const e=this.fork(7);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(23)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||(e=new io(this.dataflow).init(this),e.add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,!e.fields||64&t||(n.fields=e.fields),1&t?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),2&t?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),4&t?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),32&t?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||7;return 1&t&&this.add.length||2&t&&this.rem.length||4&t&&this.mod.length},reflow(e){if(e)return this.fork(7).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(4,so(this,1))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return ke(e)?e.forEach((e=>t[e]=!0)):t[e]=!0,this},modified(e,t){const n=this.fields;return!(!t&&!this.mod.length||!n)&&(arguments.length?ke(e)?e.some((e=>n[e])):n[e]:!!n)},filter(e,t){const n=this;return 1&e&&(n.addF=oo(n.addF,t)),2&e&&(n.remF=oo(n.remF,t)),4&e&&(n.modF=oo(n.modF,t)),16&e&&(n.srcF=oo(n.srcF,t)),n},materialize(e){const t=this;return 1&(e=e||7)&&t.addF&&(t.add=ao(t.add,t.addF),t.addF=null),2&e&&t.remF&&(t.rem=ao(t.rem,t.remF),t.remF=null),4&e&&t.modF&&(t.mod=ao(t.mod,t.modF),t.modF=null),16&e&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,r=t;if(16&e)return Tt(n.source,n.srcF,r),n;1&e&&Tt(n.add,n.addF,r),2&e&&Tt(n.rem,n.remF,r),4&e&&Tt(n.mod,n.modF,r);const i=n.source;if(8&e&&i){const e=n.add.length+n.mod.length;e===i.length||Tt(i,e?so(n,5):n.srcF,r)}return n}},dt(uo,io,{fork(e){const t=new io(this.dataflow).init(this,e&this.NO_FIELDS);return void 0!==e&&(e&t.ADD&&this.visit(t.ADD,(e=>t.add.push(e))),e&t.REM&&this.visit(t.REM,(e=>t.rem.push(e))),e&t.MOD&&this.visit(t.MOD,(e=>t.mod.push(e)))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?ke(e)?e.some((e=>n[e])):n[e]:0},filter(){se("MultiPulse does not support filtering.")},materialize(){se("MultiPulse does not support materialization.")},visit(e,t){const n=this,r=n.pulses,i=r.length;let a=0;if(e&n.SOURCE)for(;a<i;++a)r[a].visit(e,t);else for(;a<i;++a)r[a].stamp===n.stamp&&r[a].visit(e,t);return n}});const co={skip:!1,force:!1};function ho(e,t,n,r){let i,a;const s=e[n];for(;n>t&&(a=n-1>>1,i=e[a],r(s,i)<0);)e[n]=i,n=a;return e[n]=s}function fo(){this.logger(we()),this.logLevel(ye),this._clock=0,this._rank=0,this._locale=rs();try{this._loader=Ds()}catch(e){}this._touched=Ns(le),this._input={},this._pulse=null,this._heap=function(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),ho(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let r;return t.length?(r=t[0],t[0]=n,function(e,t,n){const r=t,i=e.length,a=e[t];let s,o=1+(t<<1);for(;o<i;)s=o+1,s<i&&n(e[o],e[s])>=0&&(o=s),e[t]=e[o],o=1+((t=o)<<1);e[t]=a,ho(e,r,t,n)}(t,0,e)):r=n,r}}}(((e,t)=>e.qrank-t.qrank)),this._postrun=[]}function po(e){return function(){return this._log[e].apply(this,arguments)}}function go(e,t){Ks.call(this,e,null,t)}fo.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:po("error"),warn:po("warn"),info:po("info"),debug:po("debug"),logLevel:po("level"),cleanThreshold:1e4,add:function(e,t,n,r){let i,a=1;return e instanceof Ks?i=e:e&&e.prototype instanceof Ks?i=new e:Ke(e)?i=new Ks(null,e):(a=0,i=new Ks(e,t)),this.rank(i),a&&(r=n,n=t),n&&this.connect(i,i.parameters(n,r)),this.touch(i),i},connect:function(e,t){const n=e.rank,r=t.length;for(let i=0;i<r;++i)if(n<t[i].rank)return void this.rerank(e)},rank:function(e){e.rank=++this._rank},rerank:function(e){const t=[e];let n,r,i;for(;t.length;)if(this.rank(n=t.pop()),r=n._targets)for(i=r.length;--i>=0;)t.push(n=r[i]),n===e&&se("Cycle detected in dataflow graph.")},pulse:function(e,t,n){this.touch(e,n||co);const r=new io(this,this._clock+(this._pulse?0:1)),i=e.pulse&&e.pulse.source||[];return r.target=e,this._input[e.id]=t.pulse(r,i),this},touch:function(e,t){const n=t||co;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this},update:function(e,t,n){const r=n||co;return(e.set(t)||r.force)&&this.touch(e,r),this},changeset:Vs,ingest:function(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))},parse:function(e,t){const n=this.locale();return Is(e,t,n.timeParse,n.utcParse)},preload:async function(e,t,n){const r=this,i=r._pending||function(e){let t;const n=new Promise((e=>t=e));return n.requests=0,n.done=()=>{0==--n.requests&&(e._pending=null,t(e))},e._pending=n}(r);i.requests+=1;const a=await r.request(t,n);return r.pulse(e,r.changeset().remove(fe).insert(a.data||[])),i.done(),a},request:async function(e,t){const n=this;let r,i=0;try{r=await n.loader().load(e,{context:"dataflow",response:Fs(t&&t.type)});try{r=n.parse(r,t)}catch(t){i=-2,n.warn("Data ingestion failed",e,t)}}catch(t){i=-1,n.warn("Loading failed",e,t)}return{data:r,status:i}},events:function(e,t,n,r){const i=this,a=Zs(n,r),s=function(e){e.dataflow=i;try{a.receive(e)}catch(e){i.error(e)}finally{i.run()}};let o;o="string"==typeof e&&"undefined"!=typeof document?document.querySelectorAll(e):He(e);const u=o.length;for(let e=0;e<u;++e)o[e].addEventListener(t,s);return a},on:function(e,t,n,r,i){return(e instanceof Ks?no:to)(this,e,t,n,r,i),this},evaluate:async function(e,t,n){const r=this,i=[];if(r._pulse)return lo(r);if(r._pending&&await r._pending,t&&await $s(r,t),!r._touched.length)return r.debug("Dataflow invoked, but nothing to do."),r;const a=++r._clock;r._pulse=new io(r,a,e),r._touched.forEach((e=>r._enqueue(e,!0))),r._touched=Ns(le);let s,o,u,l=0;try{for(;r._heap.size()>0;)s=r._heap.pop(),s.rank===s.qrank?(o=s.run(r._getPulse(s,e)),o.then?o=await o:o.async&&(i.push(o.async),o=ro),o!==ro&&s._targets&&s._targets.forEach((e=>r._enqueue(e))),++l):r._enqueue(s,!0)}catch(e){r._heap.clear(),u=e}if(r._input={},r._pulse=null,r.debug(`Pulse ${a}: ${l} operators`),u&&(r._postrun=[],r.error(u)),r._postrun.length){const e=r._postrun.sort(((e,t)=>t.priority-e.priority));r._postrun=[];for(let t=0;t<e.length;++t)await $s(r,e[t].callback)}return n&&await $s(r,n),i.length&&Promise.all(i).then((e=>r.runAsync(null,(()=>{e.forEach((e=>{try{e(r)}catch(e){r.error(e)}}))})))),r},run:function(e,t,n){return this._pulse?lo(this):(this.evaluate(e,t,n),this)},runAsync:async function(e,t,n){for(;this._running;)await this._running;const r=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(r,r),this._running},runAfter:function(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(e){this.error(e)}},_enqueue:function(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))},_getPulse:function(e,t){const n=e.source,r=this._clock;return n&&ke(n)?new uo(this,r,n.map((e=>e.pulse)),t):this._input[e.id]||function(e,t){return t&&t.stamp===e.stamp?t:(e=e.fork(),t&&t!==ro&&(e.source=t.source),e)}(this._pulse,n&&n.pulse)}},dt(go,Ks,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then((e=>this.pulse=e)):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const mo={};function yo(e){const t=vo(e);return t&&t.Definition||null}function vo(e){return e=e&&e.toLowerCase(),ot(mo,e)?mo[e]:null}function bo(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n<t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function xo(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n>t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}function wo(e,t,n=0,r=e.length-1,i=dr){for(;r>n;){if(r-n>600){const a=r-n+1,s=t-n+1,o=Math.log(a),u=.5*Math.exp(2*o/3),l=.5*Math.sqrt(o*u*(a-u)/a)*(s-a/2<0?-1:1);wo(e,t,Math.max(n,Math.floor(t-s*u/a+l)),Math.min(r,Math.floor(t+(a-s)*u/a+l)),i)}const a=e[t];let s=n,o=r;for(ko(e,n,t),i(e[r],a)>0&&ko(e,n,r);s<o;){for(ko(e,s,o),++s,--o;i(e[s],a)<0;)++s;for(;i(e[o],a)>0;)--o}0===i(e[n],a)?ko(e,n,o):(++o,ko(e,o,r)),o<=t&&(n=o+1),t<=o&&(r=o-1)}return e}function ko(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function _o(e){return null===e?NaN:+e}function So(e,t,n){if(e=Float64Array.from(function*(e,t){if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(yield t);else{let n=-1;for(let r of e)null!=(r=t(r,++n,e))&&(r=+r)>=r&&(yield r)}}(e,n)),r=e.length){if((t=+t)<=0||r<2)return xo(e);if(t>=1)return bo(e);var r,i=(r-1)*t,a=Math.floor(i),s=bo(wo(e,a).subarray(0,a+1));return s+(xo(e.subarray(a+1))-s)*(i-a)}}function Co(e,t,n=_o){if(r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,a=Math.floor(i),s=+n(e[a],a,e);return s+(+n(e[a+1],a+1,e)-s)*(i-a)}}function Ao(e,t){return So(e,.5,t)}function*Eo(e,t){if(null==t)for(let t of e)null!=t&&""!==t&&(t=+t)>=t&&(yield t);else{let n=-1;for(let r of e)r=t(r,++n,e),null!=r&&""!==r&&(r=+r)>=r&&(yield r)}}function Fo(e,t,n){const r=Float64Array.from(Eo(e,n));return r.sort(dr),t.map((e=>Co(r,e)))}function Io(e,t){return Fo(e,[.25,.5,.75],t)}function Do(e,t){const n=e.length,r=function(e,t){const n=function(e,t){let n,r=0,i=0,a=0;if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(n=t-i,i+=n/++r,a+=n*(t-i));else{let s=-1;for(let o of e)null!=(o=t(o,++s,e))&&(o=+o)>=o&&(n=o-i,i+=n/++r,a+=n*(o-i))}if(r>1)return a/(r-1)}(e,t);return n?Math.sqrt(n):n}(e,t),i=Io(e,t),a=(i[2]-i[0])/1.34;return 1.06*(Math.min(r,a)||r||Math.abs(i[0])||1)*Math.pow(n,-.2)}function No(e){const t=e.maxbins||20,n=e.base||10,r=Math.log(n),i=e.divide||[5,2];let a,s,o,u,l,c,d=e.extent[0],h=e.extent[1];const f=e.span||h-d||Math.abs(d)||1;if(e.step)a=e.step;else if(e.steps){for(u=f/t,l=0,c=e.steps.length;l<c&&e.steps[l]<u;++l);a=e.steps[Math.max(0,l-1)]}else{for(s=Math.ceil(Math.log(t)/r),o=e.minstep||0,a=Math.max(o,Math.pow(n,Math.round(Math.log(f)/r)-s));Math.ceil(f/a)>t;)a*=n;for(l=0,c=i.length;l<c;++l)u=a/i[l],u>=o&&f/u<=t&&(a=u)}u=Math.log(a);const p=u>=0?0:1+~~(-u/r),g=Math.pow(n,-p-1);return(e.nice||void 0===e.nice)&&(u=Math.floor(d/a+g)*a,d=d<u?u-a:u,h=Math.ceil(h/a)*a),{start:d,stop:h===d?d+a:h,step:a}}var $o=Math.random;function To(e){$o=e}function Oo(e,t,n,r){if(!e.length)return[void 0,void 0];const i=Float64Array.from(Eo(e,r)),a=i.length,s=t;let o,u,l,c;for(l=0,c=Array(s);l<s;++l){for(o=0,u=0;u<a;++u)o+=i[~~($o()*a)];c[l]=o/a}return c.sort(dr),[So(c,n/2),So(c,1-n/2)]}function Mo(e,t,n,r){r=r||(e=>e);const i=e.length,a=new Float64Array(i);let s,o=0,u=1,l=r(e[0]),c=l,d=l+t;for(;u<i;++u){if(s=r(e[u]),s>=d){for(c=(l+c)/2;o<u;++o)a[o]=c;d=s+t,l=s}c=s}for(c=(l+c)/2;o<u;++o)a[o]=c;return n?function(e,t){const n=e.length;let r,i,a=0,s=1;for(;e[a]===e[s];)++s;for(;s<n;){for(r=s+1;e[s]===e[r];)++r;if(e[s]-e[s-1]<t){for(i=s+(a+r-s-s>>1);i<s;)e[i++]=e[s];for(;i>s;)e[i--]=e[a]}a=s,s=r}return e}(a,t+t/4):a}function Ro(e){return function(){return(e=(1103515245*e+12345)%2147483647)/2147483647}}function Bo(e,t){let n,r,i;null==t&&(t=e,e=0);const a={min(e){return arguments.length?(n=e||0,i=r-n,a):n},max(e){return arguments.length?(r=e||0,i=r-n,a):r},sample:()=>n+Math.floor(i*$o()),pdf:e=>e===Math.floor(e)&&e>=n&&e<r?1/i:0,cdf(e){const t=Math.floor(e);return t<n?0:t>=r?1:(t-n+1)/i},icdf:e=>e>=0&&e<=1?n-1+Math.floor(e*i):NaN};return a.min(e).max(t)}const zo=Math.sqrt(2*Math.PI),Lo=Math.SQRT2;let Po=NaN;function jo(e,t){e=e||0,t=null==t?1:t;let n,r,i=0,a=0;if(Po==Po)i=Po,Po=NaN;else{do{i=2*$o()-1,a=2*$o()-1,n=i*i+a*a}while(0===n||n>1);r=Math.sqrt(-2*Math.log(n)/n),i*=r,Po=a*r}return e+i*t}function Uo(e,t,n){const r=(e-(t||0))/(n=null==n?1:n);return Math.exp(-.5*r*r)/(n*zo)}function Wo(e,t,n){const r=(e-(t=t||0))/(n=null==n?1:n),i=Math.abs(r);let a;if(i>37)a=0;else{const e=Math.exp(-i*i/2);let t;i<7.07106781186547?(t=.0352624965998911*i+.700383064443688,t=t*i+6.37396220353165,t=t*i+33.912866078383,t=t*i+112.079291497871,t=t*i+221.213596169931,t=t*i+220.206867912376,a=e*t,t=.0883883476483184*i+1.75566716318264,t=t*i+16.064177579207,t=t*i+86.7807322029461,t=t*i+296.564248779674,t=t*i+637.333633378831,t=t*i+793.826512519948,t=t*i+440.413735824752,a/=t):(t=i+.65,t=i+4/t,t=i+3/t,t=i+2/t,t=i+1/t,a=e/t/2.506628274631)}return r>0?1-a:a}function Vo(e,t,n){return e<0||e>1?NaN:(t||0)+(null==n?1:n)*Lo*function(e){let t,n=-Math.log((1-e)*(1+e));return n<6.25?(n-=3.125,t=-364441206401782e-35,t=t*n-16850591381820166e-35,t=128584807152564e-32+t*n,t=11157877678025181e-33+t*n,t=t*n-1333171662854621e-31,t=20972767875968562e-33+t*n,t=6637638134358324e-30+t*n,t=t*n-4054566272975207e-29,t=t*n-8151934197605472e-29,t=26335093153082323e-28+t*n,t=t*n-12975133253453532e-27,t=t*n-5415412054294628e-26,t=1.0512122733215323e-9+t*n,t=t*n-4.112633980346984e-9,t=t*n-2.9070369957882005e-8,t=4.2347877827932404e-7+t*n,t=t*n-13654692000834679e-22,t=t*n-13882523362786469e-21,t=.00018673420803405714+t*n,t=t*n-.000740702534166267,t=t*n-.006033670871430149,t=.24015818242558962+t*n,t=1.6536545626831027+t*n):n<16?(n=Math.sqrt(n)-3.25,t=2.2137376921775787e-9,t=9.075656193888539e-8+t*n,t=t*n-2.7517406297064545e-7,t=1.8239629214389228e-8+t*n,t=15027403968909828e-22+t*n,t=t*n-4013867526981546e-21,t=29234449089955446e-22+t*n,t=12475304481671779e-21+t*n,t=t*n-47318229009055734e-21,t=6828485145957318e-20+t*n,t=24031110387097894e-21+t*n,t=t*n-.0003550375203628475,t=.0009532893797373805+t*n,t=t*n-.0016882755560235047,t=.002491442096107851+t*n,t=t*n-.003751208507569241,t=.005370914553590064+t*n,t=1.0052589676941592+t*n,t=3.0838856104922208+t*n):Number.isFinite(n)?(n=Math.sqrt(n)-5,t=-27109920616438573e-27,t=t*n-2.555641816996525e-10,t=1.5076572693500548e-9+t*n,t=t*n-3.789465440126737e-9,t=7.61570120807834e-9+t*n,t=t*n-1.496002662714924e-8,t=2.914795345090108e-8+t*n,t=t*n-6.771199775845234e-8,t=2.2900482228026655e-7+t*n,t=t*n-9.9298272942317e-7,t=4526062597223154e-21+t*n,t=t*n-1968177810553167e-20,t=7599527703001776e-20+t*n,t=t*n-.00021503011930044477,t=t*n-.00013871931833623122,t=1.0103004648645344+t*n,t=4.849906401408584+t*n):t=1/0,t*e}(2*e-1)}function Go(e,t){let n,r;const i={mean(e){return arguments.length?(n=e||0,i):n},stdev(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>jo(n,r),pdf:e=>Uo(e,n,r),cdf:e=>Wo(e,n,r),icdf:e=>Vo(e,n,r)};return i.mean(e).stdev(t)}function qo(e,t){const n=Go();let r=0;const i={data(n){return arguments.length?(e=n,r=n?n.length:0,i.bandwidth(t)):e},bandwidth(n){return arguments.length?(!(t=n)&&e&&(t=Do(e)),i):t},sample:()=>e[~~($o()*r)]+t*n.sample(),pdf(i){let a=0,s=0;for(;s<r;++s)a+=n.pdf((i-e[s])/t);return a/t/r},cdf(i){let a=0,s=0;for(;s<r;++s)a+=n.cdf((i-e[s])/t);return a/r},icdf(){throw Error("KDE icdf not supported.")}};return i.data(e)}function Ho(e,t){return e=e||0,t=null==t?1:t,Math.exp(e+jo()*t)}function Xo(e,t,n){if(e<=0)return 0;t=t||0,n=null==n?1:n;const r=(Math.log(e)-t)/n;return Math.exp(-.5*r*r)/(n*zo*e)}function Ko(e,t,n){return Wo(Math.log(e),t,n)}function Yo(e,t,n){return Math.exp(Vo(e,t,n))}function Qo(e,t){let n,r;const i={mean(e){return arguments.length?(n=e||0,i):n},stdev(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>Ho(n,r),pdf:e=>Xo(e,n,r),cdf:e=>Ko(e,n,r),icdf:e=>Yo(e,n,r)};return i.mean(e).stdev(t)}function Jo(e,t){let n,r=0;const i={weights(e){return arguments.length?(n=function(e){const t=[];let n,i=0;for(n=0;n<r;++n)i+=t[n]=null==e[n]?1:+e[n];for(n=0;n<r;++n)t[n]/=i;return t}(t=e||[]),i):t},distributions(n){return arguments.length?(n?(r=n.length,e=n):(r=0,e=[]),i.weights(t)):e},sample(){const t=$o();let i=e[r-1],a=n[0],s=0;for(;s<r-1;a+=n[++s])if(t<a){i=e[s];break}return i.sample()},pdf(t){let i=0,a=0;for(;a<r;++a)i+=n[a]*e[a].pdf(t);return i},cdf(t){let i=0,a=0;for(;a<r;++a)i+=n[a]*e[a].cdf(t);return i},icdf(){throw Error("Mixture icdf not supported.")}};return i.distributions(e).weights(t)}function Zo(e,t){return null==t&&(t=null==e?1:e,e=0),e+(t-e)*$o()}function eu(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=t&&e<=n?1/(n-t):0}function tu(e,t,n){return null==n&&(n=null==t?1:t,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function nu(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function ru(e,t){let n,r;const i={min(e){return arguments.length?(n=e||0,i):n},max(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>Zo(n,r),pdf:e=>eu(e,n,r),cdf:e=>tu(e,n,r),icdf:e=>nu(e,n,r)};return null==t&&(t=null==e?1:e,e=0),i.min(e).max(t)}function iu(e,t,n,r){const i=r-e*e,a=Math.abs(i)<1e-24?0:(n-e*t)/i;return[t-a*e,a]}function au(e,t,n,r){e=e.filter((e=>{let r=t(e),i=n(e);return null!=r&&(r=+r)>=r&&null!=i&&(i=+i)>=i})),r&&e.sort(((e,n)=>t(e)-t(n)));const i=e.length,a=new Float64Array(i),s=new Float64Array(i);let o,u,l,c=0,d=0,h=0;for(l of e)a[c]=o=+t(l),s[c]=u=+n(l),++c,d+=(o-d)/c,h+=(u-h)/c;for(c=0;c<i;++c)a[c]-=d,s[c]-=h;return[a,s,d,h]}function su(e,t,n,r){let i,a,s=-1;for(const o of e)i=t(o),a=n(o),null!=i&&(i=+i)>=i&&null!=a&&(a=+a)>=a&&r(i,a,++s)}function ou(e,t,n,r,i){let a=0,s=0;return su(e,t,n,((e,t)=>{const n=t-i(e),o=t-r;a+=n*n,s+=o*o})),1-a/s}function uu(e,t,n){let r=0,i=0,a=0,s=0,o=0;su(e,t,n,((e,t)=>{++o,r+=(e-r)/o,i+=(t-i)/o,a+=(e*t-a)/o,s+=(e*e-s)/o}));const u=iu(r,i,a,s),l=e=>u[0]+u[1]*e;return{coef:u,predict:l,rSquared:ou(e,t,n,i,l)}}function lu(e,t,n){let r=0,i=0,a=0,s=0,o=0;su(e,t,n,((e,t)=>{++o,e=Math.log(e),r+=(e-r)/o,i+=(t-i)/o,a+=(e*t-a)/o,s+=(e*e-s)/o}));const u=iu(r,i,a,s),l=e=>u[0]+u[1]*Math.log(e);return{coef:u,predict:l,rSquared:ou(e,t,n,i,l)}}function cu(e,t,n){const[r,i,a,s]=au(e,t,n);let o,u,l,c=0,d=0,h=0,f=0,p=0;su(e,t,n,((e,t)=>{o=r[p++],u=Math.log(t),l=o*t,c+=(t*u-c)/p,d+=(l-d)/p,h+=(l*u-h)/p,f+=(o*l-f)/p}));const[g,m]=iu(d/s,c/s,h/s,f/s),y=e=>Math.exp(g+m*(e-a));return{coef:[Math.exp(g-m*a),m],predict:y,rSquared:ou(e,t,n,s,y)}}function du(e,t,n){let r=0,i=0,a=0,s=0,o=0,u=0;su(e,t,n,((e,t)=>{const n=Math.log(e),l=Math.log(t);++u,r+=(n-r)/u,i+=(l-i)/u,a+=(n*l-a)/u,s+=(n*n-s)/u,o+=(t-o)/u}));const l=iu(r,i,a,s),c=e=>l[0]*Math.pow(e,l[1]);return l[0]=Math.exp(l[0]),{coef:l,predict:c,rSquared:ou(e,t,n,o,c)}}function hu(e,t,n){const[r,i,a,s]=au(e,t,n),o=r.length;let u,l,c,d,h=0,f=0,p=0,g=0,m=0;for(u=0;u<o;)l=r[u],c=i[u++],d=l*l,h+=(d-h)/u,f+=(d*l-f)/u,p+=(d*d-p)/u,g+=(l*c-g)/u,m+=(d*c-m)/u;const y=p-h*h,v=h*y-f*f,b=(m*h-g*f)/v,x=(g*y-m*f)/v,w=-b*h,k=e=>b*(e-=a)*e+x*e+w+s;return{coef:[w-x*a+b*a*a+s,x-2*b*a,b],predict:k,rSquared:ou(e,t,n,s,k)}}function fu(e,t,n,r){if(1===r)return uu(e,t,n);if(2===r)return hu(e,t,n);const[i,a,s,o]=au(e,t,n),u=i.length,l=[],c=[],d=r+1;let h,f,p,g,m;for(h=0;h<d;++h){for(p=0,g=0;p<u;++p)g+=Math.pow(i[p],h)*a[p];for(l.push(g),m=new Float64Array(d),f=0;f<d;++f){for(p=0,g=0;p<u;++p)g+=Math.pow(i[p],h+f);m[f]=g}c.push(m)}c.push(l);const y=function(e){const t=e.length-1,n=[];let r,i,a,s,o;for(r=0;r<t;++r){for(s=r,i=r+1;i<t;++i)Math.abs(e[r][i])>Math.abs(e[r][s])&&(s=i);for(a=r;a<t+1;++a)o=e[a][r],e[a][r]=e[a][s],e[a][s]=o;for(i=r+1;i<t;++i)for(a=t;a>=r;a--)e[a][i]-=e[a][r]*e[r][i]/e[r][r]}for(i=t-1;i>=0;--i){for(o=0,a=i+1;a<t;++a)o+=e[a][i]*n[a];n[i]=(e[t][i]-o)/e[i][i]}return n}(c),v=e=>{e-=s;let t=o+y[0]+y[1]*e+y[2]*e*e;for(h=3;h<d;++h)t+=y[h]*Math.pow(e,h);return t};return{coef:pu(d,y,-s,o),predict:v,rSquared:ou(e,t,n,o,v)}}function pu(e,t,n,r){const i=Array(e);let a,s,o,u;for(a=0;a<e;++a)i[a]=0;for(a=e-1;a>=0;--a)for(o=t[a],u=1,i[a]+=o,s=1;s<=a;++s)u*=(a+1-s)/s,i[a-s]+=o*Math.pow(n,s)*u;return i[0]+=r,i}function gu(e,t,n,r){const[i,a,s,o]=au(e,t,n,!0),u=i.length,l=Math.max(2,~~(r*u)),c=new Float64Array(u),d=new Float64Array(u),h=new Float64Array(u).fill(1);for(let e=-1;++e<=2;){const t=[0,l-1];for(let e=0;e<u;++e){const n=i[e],r=t[0],s=t[1],o=n-i[r]>i[s]-n?r:s;let u=0,l=0,f=0,p=0,g=0;const m=1/Math.abs(i[o]-n||1);for(let e=r;e<=s;++e){const t=i[e],r=a[e],s=mu(Math.abs(n-t)*m)*h[e],o=t*s;u+=s,l+=o,f+=r*s,p+=r*o,g+=t*o}const[y,v]=iu(l/u,f/u,p/u,g/u);c[e]=y+v*n,d[e]=Math.abs(a[e]-c[e]),yu(i,e+1,t)}if(2===e)break;const n=Ao(d);if(Math.abs(n)<1e-12)break;for(let e,t,r=0;r<u;++r)e=d[r]/(6*n),h[r]=e>=1?1e-12:(t=1-e*e)*t}return function(e,t,n,r){const i=e.length,a=[];let s,o=0,u=0,l=[];for(;o<i;++o)s=e[o]+n,l[0]===s?l[1]+=(t[o]-l[1])/++u:(u=0,l[1]+=r,l=[s,t[o]],a.push(l));return l[1]+=r,a}(i,c,s,o)}function mu(e){return(e=1-e*e*e)*e*e}function yu(e,t,n){const r=e[t];let i=n[0],a=n[1]+1;if(!(a>=e.length))for(;t>i&&e[a]-r<=r-e[i];)n[0]=++i,n[1]=a,++a}const vu=.5*Math.PI/180;function bu(e,t,n,r){n=n||25,r=Math.max(n,r||200);const i=t=>[t,e(t)],a=t[0],s=t[1],o=s-a,u=o/r,l=[i(a)],c=[];if(n===r){for(let e=1;e<r;++e)l.push(i(a+e/n*o));return l.push(i(s)),l}c.push(i(s));for(let e=n;--e>0;)c.push(i(a+e/n*o));let d=l[0],h=c[c.length-1];const f=1/o,p=function(e,t){let n=e,r=e;const i=t.length;for(let e=0;e<i;++e){const i=t[e][1];i<n&&(n=i),i>r&&(r=i)}return 1/(r-n)}(d[1],c);for(;h;){const e=i((d[0]+h[0])/2);e[0]-d[0]>=u&&xu(d,e,h,f,p)>vu?c.push(e):(d=h,l.push(h),c.pop()),h=c[c.length-1]}return l}function xu(e,t,n,r,i){const a=Math.atan2(i*(n[1]-e[1]),r*(n[0]-e[0])),s=Math.atan2(i*(t[1]-e[1]),r*(t[0]-e[0]));return Math.abs(a-s)}function wu(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((t-e)/n)),a=new Array(i);++r<i;)a[r]=e+r*n;return a}function ku(e){return e&&e.length?1===e.length?e[0]:(t=e,e=>{const n=t.length;let r=1,i=String(t[0](e));for(;r<n;++r)i+="|"+t[r](e);return i}):function(){return""};var t}function _u(e,t,n){return n||e+(t?"_"+t:"")}const Su=()=>{},Cu={init:Su,add:Su,rem:Su,idx:0},Au={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||void 0===e.min)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||void 0===e.max)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},Eu=Object.keys(Au);function Fu(e,t){return Au[e](t)}function Iu(e,t){return e.idx-t.idx}function Du(){this.valid=0,this.missing=0,this._ops.forEach((e=>e.init(this)))}function Nu(e,t){null!=e&&""!==e?e==e&&(++this.valid,this._ops.forEach((n=>n.add(this,e,t)))):++this.missing}function $u(e,t){null!=e&&""!==e?e==e&&(--this.valid,this._ops.forEach((n=>n.rem(this,e,t)))):--this.missing}function Tu(e){return this._out.forEach((t=>e[t.out]=t.value(this))),e}function Ou(e,t){const n=t||ce,r=function(e){const t={};e.forEach((e=>t[e.name]=e));const n=e=>{e.req&&e.req.forEach((e=>{t[e]||n(t[e]=Au[e]())}))};return e.forEach(n),Object.values(t).sort(Iu)}(e),i=e.slice().sort(Iu);function a(e){this._ops=r,this._out=i,this.cell=e,this.init()}return a.prototype.init=Du,a.prototype.add=Nu,a.prototype.rem=$u,a.prototype.set=Tu,a.prototype.get=n,a.fields=e.map((e=>e.out)),a}function Mu(e){this._key=e?ue(e):Rs,this.reset()}Eu.forEach((e=>{Au[e]=function(e,t){return n=>rt({name:e,out:n||e},Cu,t)}(e,Au[e])}));const Ru=Mu.prototype;function Bu(e){go.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}function zu(e){go.call(this,null,e)}function Lu(e,t,n){const r=e;let i=t||[],a=n||[],s={},o=0;return{add:e=>a.push(e),remove:e=>s[r(e)]=++o,size:()=>i.length,data:(e,t)=>(o&&(i=i.filter((e=>!s[r(e)])),s={},o=0),t&&e&&i.sort(e),a.length&&(i=e?kt(e,i,a.sort(e)):i.concat(a),a=[]),i)}}function Pu(e){go.call(this,[],e)}function ju(e){Ks.call(this,null,Uu,e)}function Uu(e){return this.value&&!e.modified()?this.value:Ye(e.fields,e.orders)}function Wu(e){go.call(this,null,e)}function Vu(e){go.call(this,null,e)}Ru.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},Ru.add=function(e){this._add.push(e)},Ru.rem=function(e){this._rem.push(e)},Ru.values=function(){if(this._get=null,0===this._rem.length)return this._add;const e=this._add,t=this._rem,n=this._key,r=e.length,i=t.length,a=Array(r-i),s={};let o,u,l;for(o=0;o<i;++o)s[n(t[o])]=1;for(o=0,u=0;o<r;++o)s[n(l=e[o])]?s[n(l)]=0:a[u++]=l;return this._rem=[],this._add=a},Ru.distinct=function(e){const t=this.values(),n={};let r,i=t.length,a=0;for(;--i>=0;)r=e(t[i])+"",ot(n,r)||(n[r]=1,++a);return a},Ru.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=at(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},Ru.argmin=function(e){return this.extent(e)[0]||{}},Ru.argmax=function(e){return this.extent(e)[1]||{}},Ru.min=function(e){const t=this.extent(e)[0];return null!=t?e(t):void 0},Ru.max=function(e){const t=this.extent(e)[1];return null!=t?e(t):void 0},Ru.quartile=function(e){return this._get===e&&this._q||(this._q=Io(this.values(),e),this._get=e),this._q},Ru.q1=function(e){return this.quartile(e)[0]},Ru.q2=function(e){return this.quartile(e)[1]},Ru.q3=function(e){return this.quartile(e)[2]},Ru.ci=function(e){return this._get===e&&this._ci||(this._ci=Oo(this.values(),1e3,.05,e),this._get=e),this._ci},Ru.ci0=function(e){return this.ci(e)[0]},Ru.ci1=function(e){return this.ci(e)[1]},Bu.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Eu},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},dt(Bu,go,{transform(e,t){const n=this,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.modified();return n.stamp=r.stamp,n.value&&(i||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=i?n.init(e):{},t.visit(t.SOURCE,(e=>n.add(e)))):(n.value=n.value||n.init(e),t.visit(t.REM,(e=>n.rem(e))),t.visit(t.ADD,(e=>n.add(e)))),r.modifies(n._outputs),n._drop=!1!==e.drop,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&r.clean(!0).runAfter((()=>this.clean())),n.changes(r)},cross(){const e=this,t=e.value,n=e._dnames,r=n.map((()=>({}))),i=n.length;function a(e){let t,a,s,o;for(t in e)for(s=e[t].tuple,a=0;a<i;++a)r[a][o=s[n[a]]]=o}a(e._prev),a(t),function a(s,o,u){const l=n[u],c=r[u++];for(const n in c){const r=s?s+"|"+n:n;o[l]=c[n],u<i?a(r,o,u):t[r]||e.cell(r,o)}}("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],r={};function i(e){const n=He(ne(e)),i=n.length;let a,s=0;for(;s<i;++s)r[a=n[s]]||(r[a]=1,t.push(a))}this._dims=He(e.groupby),this._dnames=this._dims.map((e=>{const t=te(e);return i(e),n.push(t),t})),this.cellkey=e.key?e.key:ku(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const a=e.fields||[null],s=e.ops||["count"],o=e.as||[],u=a.length,l={};let c,d,h,f,p,g;for(u!==s.length&&se("Unmatched number of fields and aggregate ops."),g=0;g<u;++g)c=a[g],d=s[g],null==c&&"count"!==d&&se("Null aggregate field specified."),f=te(c),p=_u(d,f,o[g]),n.push(p),"count"!==d?(h=l[f],h||(i(c),h=l[f]=[],h.field=c,this._measures.push(h)),"count"!==d&&(this._countOnly=!1),h.push(Fu(d,p))):this._counts.push(p);return this._measures=this._measures.map((e=>Ou(e,e.field))),{}},cellkey:ku(),cell(e,t){let n=this.value[e];return n?0===n.num&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const e=this._measures,t=e.length;n.agg=Array(t);for(let r=0;r<t;++r)n.agg[r]=new e[r](n)}return n.store&&(n.data=new Mu),n},newtuple(e,t){const n=this._dnames,r=this._dims,i=r.length,a={};for(let t=0;t<i;++t)a[n[t]]=r[t](e);return t?js(t.tuple,a):zs(a)},clean(){const e=this.value;for(const t in e)0===e[t].num&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const r=n.agg;for(let t=0,n=r.length;t<n;++t)r[t].add(r[t].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const r=n.agg;for(let t=0,n=r.length;t<n;++t)r[t].rem(r[t].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let r=0,i=n.length;r<i;++r)t[n[r]]=e.num;if(!this._countOnly){const n=e.agg;for(let e=0,r=n.length;e<r;++e)n[e].set(t)}return t},changes(e){const t=this._adds,n=this._mods,r=this._prev,i=this._drop,a=e.add,s=e.rem,o=e.mod;let u,l,c,d;if(r)for(l in r)u=r[l],i&&!u.num||s.push(u.tuple);for(c=0,d=this._alen;c<d;++c)a.push(this.celltuple(t[c])),t[c]=null;for(c=0,d=this._mlen;c<d;++c)u=n[c],(0===u.num&&i?s:o).push(this.celltuple(u)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,e}}),zu.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},dt(zu,go,{transform(e,t){const n=!1!==e.interval,r=this._bins(e),i=r.start,a=r.step,s=e.as||["bin0","bin1"],o=s[0],u=s[1];let l;return l=e.modified()?(t=t.reflow(!0)).SOURCE:t.modified(ne(e.field))?t.ADD_MOD:t.ADD,t.visit(l,n?e=>{const t=r(e);e[o]=t,e[u]=null==t?null:i+a*(1+(t-i)/a)}:e=>e[o]=r(e)),t.modifies(n?s:o)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=No(e),r=n.step;let i,a,s=n.start,o=s+Math.ceil((n.stop-s)/r)*r;null!=(i=e.anchor)&&(a=i-(s+r*Math.floor((i-s)/r)),s+=a,o+=a);const u=function(e){let n=Ie(t(e));return null==n?null:n<s?-1/0:n>o?1/0:(n=Math.max(s,Math.min(n,o-r)),s+r*Math.floor(1e-14+(n-s)/r))};return u.start=s,u.stop=n.stop,u.step=r,this.value=ee(u,ne(t),e.name||"bin_"+te(t))}}),Pu.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},dt(Pu,go,{transform(e,t){const n=t.fork(t.ALL),r=Lu(Rs,this.value,n.materialize(n.ADD).add),i=e.sort,a=t.changed()||i&&(e.modified("sort")||t.modified(i.fields));return n.visit(n.REM,r.remove),this.modified(a),this.value=n.source=r.data(Us(i),a),t.source&&t.source.root&&(this.value.root=t.source.root),n}}),dt(ju,Ks),Wu.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]},dt(Wu,go,{transform(e,t){const n=t=>n=>{for(var r,i=function(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase()}return e.match(n)}(o(n),e.case,a)||[],u=0,l=i.length;u<l;++u)s.test(r=i[u])||t(r)},r=this._parameterCheck(e,t),i=this._counts,a=this._match,s=this._stop,o=e.field,u=e.as||["text","count"],l=n((e=>i[e]=1+(i[e]||0))),c=n((e=>i[e]-=1));return r?t.visit(t.SOURCE,l):(t.visit(t.ADD,l),t.visit(t.REM,c)),this._finish(t,u)},_parameterCheck(e,t){let n=!1;return!e.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),!e.modified("pattern")&&this._match||(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,r=this._tuples||(this._tuples={}),i=t[0],a=t[1],s=e.fork(e.NO_SOURCE|e.NO_FIELDS);let o,u,l;for(o in n)u=r[o],l=n[o]||0,!u&&l?(r[o]=u=zs({}),u[i]=o,u[a]=l,s.add.push(u)):0===l?(u&&s.rem.push(u),n[o]=null,r[o]=null):u[a]!==l&&(u[a]=l,s.mod.push(u));return s.modifies(t)}}),Vu.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},dt(Vu,go,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.as||["a","b"],i=r[0],a=r[1],s=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let o=this.value;return s?(o&&(n.rem=o),o=t.materialize(t.SOURCE).source,n.add=this.value=function(e,t,n,r){for(var i,a,s=[],o={},u=e.length,l=0;l<u;++l)for(o[t]=a=e[l],i=0;i<u;++i)o[n]=e[i],r(o)&&(s.push(zs(o)),(o={})[t]=a);return s}(o,i,a,e.filter||fe)):n.mod=o,n.source=this.value,n.modifies(r)}});const Gu={kde:qo,mixture:Jo,normal:Go,lognormal:Qo,uniform:ru};function qu(e,t){const n=e.function;ot(Gu,n)||se("Unknown distribution function: "+n);const r=Gu[n]();for(const n in e)"field"===n?r.data((e.from||t()).map(e[n])):"distributions"===n?r[n](e[n].map((e=>qu(e,t)))):"function"==typeof r[n]&&r[n](e[n]);return r}function Hu(e){go.call(this,null,e)}const Xu=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],Ku={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:Xu},{name:"weights",type:"number",array:!0}]};function Yu(e,t){return e?e.map(((e,n)=>t[n]||te(e))):null}function Qu(e,t,n){const r=[],i=e=>e(u);let a,s,o,u,l,c;if(null==t)r.push(e.map(n));else for(a={},s=0,o=e.length;s<o;++s)u=e[s],l=t.map(i),c=a[l],c||(a[l]=c=[],c.dims=l,r.push(c)),c.push(n(u));return r}function Ju(e){go.call(this,null,e)}function Zu(e){Ks.call(this,null,el,e),this.modified(!0)}function el(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:ee((n=>t(n,e)),ne(t),te(t))}function tl(e){go.call(this,[void 0,void 0],e)}function nl(e,t){Ks.call(this,e),this.parent=t,this.count=0}function rl(e){go.call(this,{},e),this._keys=lt();const t=this._targets=[];t.active=0,t.forEach=e=>{for(let n=0,r=t.active;n<r;++n)e(t[n],n,t)}}function il(e){Ks.call(this,null,al,e)}function al(e){return this.value&&!e.modified()?this.value:ke(e.name)?He(e.name).map((e=>ue(e))):ue(e.name,e.as)}function sl(e){go.call(this,lt(),e)}function ol(e){go.call(this,[],e)}function ul(e){go.call(this,[],e)}function ll(e){go.call(this,null,e)}function cl(e){go.call(this,[],e)}Hu.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:Xu.concat(Ku)},{name:"as",type:"string",array:!0,default:["value","density"]}]},dt(Hu,go,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=qu(e.distribution,function(e){return()=>e.materialize(e.SOURCE).source}(t)),i=e.steps||e.minsteps||25,a=e.steps||e.maxsteps||200;let s=e.method||"pdf";"pdf"!==s&&"cdf"!==s&&se("Invalid density method: "+s),e.extent||r.data||se("Missing density extent parameter."),s=r[s];const o=e.as||["value","density"],u=bu(s,e.extent||it(r.data()),i,a).map((e=>{const t={};return t[o[0]]=e[0],t[o[1]]=e[1],zs(t)}));this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}}),Ju.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]},dt(Ju,go,{transform(e,t){if(this.value&&!e.modified()&&!t.changed())return t;const n=t.materialize(t.SOURCE).source,r=Qu(t.source,e.groupby,ce),i=e.smooth||!1,a=e.field,s=e.step||((e,t)=>Ct(it(e,t))/30)(n,a),o=Us(((e,t)=>a(e)-a(t))),u=e.as||"bin",l=r.length;let c,d=1/0,h=-1/0,f=0;for(;f<l;++f){const e=r[f].sort(o);c=-1;for(const t of Mo(e,s,i,a))t<d&&(d=t),t>h&&(h=t),e[++c][u]=t}return this.value={start:d,stop:h,step:s},t.reflow(!0).modifies(u)}}),dt(Zu,Ks),tl.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},dt(tl,go,{transform(e,t){const n=this.value,r=e.field,i=t.changed()||t.modified(r.fields)||e.modified("field");let a=n[0],s=n[1];if((i||null==a)&&(a=1/0,s=-1/0),t.visit(i?t.SOURCE:t.ADD,(e=>{const t=Ie(r(e));null!=t&&(t<a&&(a=t),t>s&&(s=t))})),!Number.isFinite(a)||!Number.isFinite(s)){let e=te(r);e&&(e=` for field "${e}"`),t.dataflow.warn(`Infinite extent${e}: [${a}, ${s}]`),a=s=void 0}this.value=[a,s]}}),dt(nl,Ks,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}}),dt(rl,go,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,r){const i=this.value;let a,s,o=ot(i,e)&&i[e];return o?o.value.stamp<n.stamp&&(o.init(n),this.activate(o)):(s=r||(s=this._group[e])&&s.tuple,a=n.dataflow,o=new nl(n.fork(n.NO_SOURCE),this),a.add(o).connect(t(a,e,s)),i[e]=o,this.activate(o)),o},clean(){const e=this.value;let t=0;for(const n in e)if(0===e[n].count){const r=e[n].detachSubflow;r&&r(),delete e[n],++t}if(t){const e=this._targets.filter((e=>e&&e.count>0));this.initTargets(e)}},initTargets(e){const t=this._targets,n=t.length,r=e?e.length:0;let i=0;for(;i<r;++i)t[i]=e[i];for(;i<n&&null!=t[i];++i)t[i]=null;t.active=r},transform(e,t){const n=t.dataflow,r=e.key,i=e.subflow,a=this._keys,s=e.modified("key"),o=e=>this.subflow(e,i,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,(e=>{const t=Rs(e),n=a.get(t);void 0!==n&&(a.delete(t),o(n).rem(e))})),t.visit(t.ADD,(e=>{const t=r(e);a.set(Rs(e),t),o(t).add(e)})),s||t.modified(r.fields)?t.visit(t.MOD,(e=>{const t=Rs(e),n=a.get(t),i=r(e);n===i?o(i).mod(e):(a.set(t,i),o(n).rem(e),o(i).add(e))})):t.changed(t.MOD)&&t.visit(t.MOD,(e=>{o(a.get(Rs(e))).mod(e)})),s&&t.visit(t.REFLOW,(e=>{const t=Rs(e),n=a.get(t),i=r(e);n!==i&&(a.set(t,i),o(n).rem(e),o(i).add(e))})),t.clean()?n.runAfter((()=>{this.clean(),a.clean()})):a.empty>n.cleanThreshold&&n.runAfter(a.clean),t}}),dt(il,Ks),sl.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},dt(sl,go,{transform(e,t){const n=t.dataflow,r=this.value,i=t.fork(),a=i.add,s=i.rem,o=i.mod,u=e.expr;let l=!0;function c(t){const n=Rs(t),i=u(t,e),c=r.get(n);i&&c?(r.delete(n),a.push(t)):i||c?l&&i&&!c&&o.push(t):(r.set(n,1),s.push(t))}return t.visit(t.REM,(e=>{const t=Rs(e);r.has(t)?r.delete(t):s.push(e)})),t.visit(t.ADD,(t=>{u(t,e)?a.push(t):r.set(Rs(t),1)})),t.visit(t.MOD,c),e.modified()&&(l=!1,t.visit(t.REFLOW,c)),r.empty>n.cleanThreshold&&n.runAfter(r.clean),i}}),ol.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},dt(ol,go,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=Yu(r,e.as||[]),a=e.index||null,s=i.length;return n.rem=this.value,t.visit(t.SOURCE,(e=>{const t=r.map((t=>t(e))),o=t.reduce(((e,t)=>Math.max(e,t.length)),0);let u,l,c,d=0;for(;d<o;++d){for(l=Ls(e),u=0;u<s;++u)l[i[u]]=null==(c=t[u][d])?null:c;a&&(l[a]=d),n.add.push(l)}})),this.value=n.source=n.add,a&&n.modifies(a),n.modifies(i)}}),ul.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},dt(ul,go,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=r.map(te),a=e.as||["key","value"],s=a[0],o=a[1],u=r.length;return n.rem=this.value,t.visit(t.SOURCE,(e=>{for(let t,a=0;a<u;++a)t=Ls(e),t[s]=i[a],t[o]=r[a](e),n.add.push(t)})),this.value=n.source=n.add,n.modifies(a)}}),ll.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},dt(ll,go,{transform(e,t){const n=e.expr,r=e.as,i=e.modified(),a=e.initonly?t.ADD:i?t.SOURCE:t.modified(n.fields)||t.modified(r)?t.ADD_MOD:t.ADD;return i&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(r),t.visit(a,(t=>t[r]=n(t,e)))}}),dt(cl,go,{transform(e,t){const n=t.fork(t.ALL),r=e.generator;let i,a,s,o=this.value,u=e.size-o.length;if(u>0){for(i=[];--u>=0;)i.push(s=zs(r(e))),o.push(s);n.add=n.add.length?n.materialize(n.ADD).add.concat(i):i}else a=o.slice(0,-u),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(a):a,o=o.slice(-u);return n.source=this.value=o,n}});const dl={value:"value",median:Ao,mean:function(e,t){let n=0,r=0;if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(++n,r+=t);else{let i=-1;for(let a of e)null!=(a=t(a,++i,e))&&(a=+a)>=a&&(++n,r+=a)}if(n)return r/n},min:xo,max:bo},hl=[];function fl(e){go.call(this,[],e)}function pl(e){Bu.call(this,e)}function gl(e){go.call(this,null,e)}function ml(e){Ks.call(this,null,yl,e)}function yl(e){return this.value&&!e.modified()?this.value:bt(e.fields,e.flat)}function vl(e){go.call(this,[],e),this._pending=null}function bl(e,t,n){n.forEach(zs);const r=t.fork(t.NO_FIELDS&t.NO_SOURCE);return r.rem=e.value,e.value=r.source=r.add=n,e._pending=null,r.rem.length&&r.clean(!0),r}function xl(e){go.call(this,{},e)}function wl(e){Ks.call(this,null,kl,e)}function kl(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let r,i,a=1/0,s=-1/0;for(r=0;r<n;++r)i=t[r],i[0]<a&&(a=i[0]),i[1]>s&&(s=i[1]);return[a,s]}function _l(e){Ks.call(this,null,Sl,e)}function Sl(e){return this.value&&!e.modified()?this.value:e.values.reduce(((e,t)=>e.concat(t)),[])}function Cl(e){go.call(this,null,e)}function Al(e){Bu.call(this,e)}function El(e){rl.call(this,e)}function Fl(e){go.call(this,null,e)}function Il(e){go.call(this,null,e)}function Dl(e){go.call(this,null,e)}function Nl(e){go.call(this,null,e)}function $l(e){go.call(this,[],e),this.count=0}function Tl(e){go.call(this,null,e)}function Ol(e){go.call(this,null,e),this.modified(!0)}function Ml(e){go.call(this,null,e)}fl.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},dt(fl,go,{transform(e,t){var n,r,i,a,s,o,u,l,c,d,h=t.fork(t.ALL),f=function(e){var t,n=e.method||dl.value;if(null!=dl[n])return n===dl.value?(t=void 0!==e.value?e.value:0,()=>t):dl[n];se("Unrecognized imputation method: "+n)}(e),p=function(e){const t=e.field;return e=>e?t(e):NaN}(e),g=te(e.field),m=te(e.key),y=(e.groupby||[]).map(te),v=function(e,t,n,r){var i,a,s,o,u,l,c,d,h=e=>e(d),f=[],p=r?r.slice():[],g={},m={};for(p.forEach(((e,t)=>g[e]=t+1)),o=0,c=e.length;o<c;++o)l=n(d=e[o]),u=g[l]||(g[l]=p.push(l)),(s=m[a=(i=t?t.map(h):hl)+""])||(s=m[a]=[],f.push(s),s.values=i),s[u-1]=d;return f.domain=p,f}(t.source,e.groupby,e.key,e.keyvals),b=[],x=this.value,w=v.domain.length;for(s=0,l=v.length;s<l;++s)for(i=(n=v[s]).values,r=NaN,u=0;u<w;++u)if(null==n[u]){for(a=v.domain[u],d={_impute:!0},o=0,c=i.length;o<c;++o)d[y[o]]=i[o];d[m]=a,d[g]=Number.isNaN(r)?r=f(n,p):r,b.push(zs(d))}return b.length&&(h.add=h.materialize(h.ADD).add.concat(b)),x.length&&(h.rem=h.materialize(h.REM).rem.concat(x)),this.value=b,h}}),pl.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:Eu},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},dt(pl,Bu,{transform(e,t){const n=this,r=e.modified();let i;return n.value&&(r||t.modified(n._inputs,!0))?(i=n.value=r?n.init(e):{},t.visit(t.SOURCE,(e=>n.add(e)))):(i=n.value=n.value||this.init(e),t.visit(t.REM,(e=>n.rem(e))),t.visit(t.ADD,(e=>n.add(e)))),n.changes(),t.visit(t.SOURCE,(e=>{rt(e,i[n.cellkey(e)].tuple)})),t.reflow(r).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,r;for(n=0,r=this._alen;n<r;++n)this.celltuple(e[n]),e[n]=null;for(n=0,r=this._mlen;n<r;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}}),gl.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},dt(gl,go,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t.materialize(t.SOURCE).source,i=Qu(r,e.groupby,e.field),a=(e.groupby||[]).map(te),s=e.bandwidth,o=e.cumulative?"cdf":"pdf",u=e.as||["value","density"],l=[];let c=e.extent,d=e.steps||e.minsteps||25,h=e.steps||e.maxsteps||200;"pdf"!==o&&"cdf"!==o&&se("Invalid density method: "+o),"shared"===e.resolve&&(c||(c=it(r,e.field)),d=h=e.steps||h),i.forEach((t=>{const n=qo(t,s)[o],r=e.counts?t.length:1;bu(n,c||it(t),d,h).forEach((e=>{const n={};for(let e=0;e<a.length;++e)n[a[e]]=t.dims[e];n[u[0]]=e[0],n[u[1]]=e[1]*r,l.push(zs(n))}))})),this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}}),dt(ml,Ks),dt(vl,go,{transform(e,t){const n=t.dataflow;if(this._pending)return bl(this,t,this._pending);if(function(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}(e))return t.StopPropagation;if(e.values)return bl(this,t,n.parse(e.values,e.format));if(e.async){const t=n.request(e.url,e.format).then((e=>(this._pending=He(e.data),e=>e.touch(this))));return{async:t}}return n.request(e.url,e.format).then((e=>bl(this,t,He(e.data))))}}),xl.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},dt(xl,go,{transform(e,t){const n=e.fields,r=e.index,i=e.values,a=null==e.default?null:e.default,s=e.modified(),o=n.length;let u,l,c,d=s?t.SOURCE:t.ADD,h=t,f=e.as;return i?(l=i.length,o>1&&!f&&se('Multi-field lookup requires explicit "as" parameter.'),f&&f.length!==o*l&&se('The "as" parameter has too few output field names.'),f=f||i.map(te),u=function(e){for(var t,s,u=0,c=0;u<o;++u)if(null==(s=r.get(n[u](e))))for(t=0;t<l;++t,++c)e[f[c]]=a;else for(t=0;t<l;++t,++c)e[f[c]]=i[t](s)}):(f||se("Missing output field names."),u=function(e){for(var t,i=0;i<o;++i)t=r.get(n[i](e)),e[f[i]]=null==t?a:t}),s?h=t.reflow(!0):(c=n.some((e=>t.modified(e.fields))),d|=c?t.MOD:0),t.visit(d,u),h.modifies(f)}}),dt(wl,Ks),dt(_l,Ks),dt(Cl,go,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),Al.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:Eu,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},dt(Al,Bu,{_transform:Bu.prototype.transform,transform(e,t){return this._transform(function(e,t){const n=e.field,r=e.value,i=("count"===e.op?"__count__":e.op)||"sum",a=ne(n).concat(ne(r)),s=function(e,t,n){const r={},i=[];return n.visit(n.SOURCE,(t=>{const n=e(t);r[n]||(r[n]=1,i.push(n))})),i.sort(Qe),t?i.slice(0,t):i}(n,e.limit||0,t);return t.changed()&&e.set("__pivot__",null,null,!0),{key:e.key,groupby:e.groupby,ops:s.map((()=>i)),fields:s.map((e=>function(e,t,n,r){return ee((r=>t(r)===e?n(r):NaN),r,e+"")}(e,n,r,a))),as:s.map((e=>e+"")),modified:e.modified.bind(e)}}(e,t),t)}}),dt(El,rl,{transform(e,t){const n=e.subflow,r=e.field,i=e=>this.subflow(Rs(e),n,t,e);return(e.modified("field")||r&&t.modified(ne(r)))&&se("PreFacet does not support field modification."),this.initTargets(),r?(t.visit(t.MOD,(e=>{const t=i(e);r(e).forEach((e=>t.mod(e)))})),t.visit(t.ADD,(e=>{const t=i(e);r(e).forEach((e=>t.add(zs(e))))})),t.visit(t.REM,(e=>{const t=i(e);r(e).forEach((e=>t.rem(e)))}))):(t.visit(t.MOD,(e=>i(e).mod(e))),t.visit(t.ADD,(e=>i(e).add(e))),t.visit(t.REM,(e=>i(e).rem(e)))),t.clean()&&t.runAfter((()=>this.clean())),t}}),Fl.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},dt(Fl,go,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=Yu(e.fields,e.as||[]),a=r?(e,t)=>function(e,t,n,r){for(let i=0,a=n.length;i<a;++i)t[r[i]]=n[i](e);return t}(e,t,r,i):Ps;let s;return this.value?s=this.value:(t=t.addAll(),s=this.value={}),t.visit(t.REM,(e=>{const t=Rs(e);n.rem.push(s[t]),s[t]=null})),t.visit(t.ADD,(e=>{const t=a(e,zs({}));s[Rs(e)]=t,n.add.push(t)})),t.visit(t.MOD,(e=>{n.mod.push(a(e,s[Rs(e)]))})),n}}),dt(Il,go,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}}),Dl.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]},dt(Dl,go,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const i=Qu(t.materialize(t.SOURCE).source,e.groupby,e.field),a=(e.groupby||[]).map(te),s=[],o=e.step||.01,u=e.probs||wu(o/2,1-1e-14,o),l=u.length;return i.forEach((e=>{const t=Fo(e,u);for(let n=0;n<l;++n){const i={};for(let t=0;t<a.length;++t)i[a[t]]=e.dims[t];i[r[0]]=u[n],i[r[1]]=t[n],s.push(zs(i))}})),this.value&&(n.rem=this.value),this.value=n.add=n.source=s,n}}),dt(Nl,go,{transform(e,t){let n,r;return this.value?r=this.value:(n=t=t.addAll(),r=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,(e=>{const t=Rs(e);n.rem.push(r[t]),r[t]=null})),t.visit(t.ADD,(e=>{const t=Ls(e);r[Rs(e)]=t,n.add.push(t)})),t.visit(t.MOD,(e=>{const t=r[Rs(e)];for(const r in e)t[r]=e[r],n.modifies(r);n.mod.push(t)}))),n}}),$l.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},dt($l,go,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.modified("size"),i=e.size,a=this.value.reduce(((e,t)=>(e[Rs(t)]=1,e)),{});let s=this.value,o=this.count,u=0;function l(e){let t,r;s.length<i?s.push(e):(r=~~((o+1)*$o()),r<s.length&&r>=u&&(t=s[r],a[Rs(t)]&&n.rem.push(t),s[r]=e)),++o}if(t.rem.length&&(t.visit(t.REM,(e=>{const t=Rs(e);a[t]&&(a[t]=-1,n.rem.push(e)),--o})),s=s.filter((e=>-1!==a[Rs(e)]))),(t.rem.length||r)&&s.length<i&&t.source&&(u=o=s.length,t.visit(t.SOURCE,(e=>{a[Rs(e)]||l(e)})),u=-1),r&&s.length>i){const e=s.length-i;for(let t=0;t<e;++t)a[Rs(s[t])]=-1,n.rem.push(s[t]);s=s.slice(e)}return t.mod.length&&t.visit(t.MOD,(e=>{a[Rs(e)]&&n.mod.push(e)})),t.add.length&&t.visit(t.ADD,l),(t.add.length||u<0)&&(n.add=s.filter((e=>!a[Rs(e)]))),this.count=o,this.value=n.source=s,n}}),Tl.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},dt(Tl,go,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),r=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=wu(e.start,e.stop,e.step||1).map((e=>{const t={};return t[r]=e,zs(t)})),n.add=t.add.concat(this.value),n}}),dt(Ol,go,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});const Rl=["unit0","unit1"];function Bl(e){go.call(this,lt(),e)}function zl(e){go.call(this,null,e)}Ml.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:Sr,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:Rl}]},dt(Ml,go,{transform(e,t){const n=e.field,r=!1!==e.interval,i="utc"===e.timezone,a=this._floor(e,t),s=(i?ei:Zr)(a.unit).offset,o=e.as||Rl,u=o[0],l=o[1],c=a.step;let d=a.start||1/0,h=a.stop||-1/0,f=t.ADD;return(e.modified()||t.modified(ne(n)))&&(f=(t=t.reflow(!0)).SOURCE,d=1/0,h=-1/0),t.visit(f,(e=>{const t=n(e);let i,o;null==t?(e[u]=null,r&&(e[l]=null)):(e[u]=i=o=a(t),r&&(e[l]=o=s(i,c)),i<d&&(d=i),o>h&&(h=o))})),a.start=d,a.stop=h,t.modifies(r?o:u)},_floor(e,t){const n="utc"===e.timezone,{units:r,step:i}=e.units?{units:e.units,step:e.step||1}:mi({extent:e.extent||it(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),a=Ar(r),s=this.value||{},o=(n?Yr:Hr)(a,i);return o.unit=Fe(a),o.units=a,o.step=i,o.start=s.start,o.stop=s.stop,this.value=o}}),dt(Bl,go,{transform(e,t){const n=t.dataflow,r=e.field,i=this.value,a=e=>i.set(r(e),e);let s=!0;return e.modified("field")||t.modified(r.fields)?(i.clear(),t.visit(t.SOURCE,a)):t.changed()?(t.visit(t.REM,(e=>i.delete(r(e)))),t.visit(t.ADD,a)):s=!1,this.modified(s),i.empty>n.cleanThreshold&&n.runAfter(i.clean),t.fork()}}),dt(zl,go,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(Us(e.sort)):t.source).map(e.field))}});const Ll={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?++e:e}}},percent_rank:function(){const e=Ll.rank(),t=e.next;return{init:e.init,next:e=>(t(e)-1)/(e.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,r=t.compare;let i=t.index;if(e<i){for(;i+1<n.length&&!r(n[i],n[i+1]);)++i;e=i}return(1+e)/n.length}}},ntile:function(e,t){(t=+t)>0||se("ntile num must be greater than zero.");const n=Ll.cume_dist(),r=n.next;return{init:n.init,next:e=>Math.ceil(t*r(e))}},lag:function(e,t){return t=+t||1,{next:n=>{const r=n.index-t;return r>=0?e(n.data[r]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const r=n.index+t,i=n.data;return r<i.length?e(i[r]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return(t=+t)>0||se("nth_value nth must be greater than zero."),{next:n=>{const r=n.i0+(t-1);return r<n.i1?e(n.data[r]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const r=e(n.data[n.index]);return null!=r?t=r:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:r=>{const i=r.data;return r.index<=n?t:(n=function(e,t,n){for(let r=t.length;n<r;++n)if(null!=e(t[n]))return n;return-1}(e,i,r.index))<0?(n=i.length,t=null):t=e(i[n])}}}},Pl=Object.keys(Ll);function jl(e){const t=He(e.ops),n=He(e.fields),r=He(e.params),i=He(e.as),a=this.outputs=[],s=this.windows=[],o={},u={},l=[],c=[];let d=!0;function h(e){He(ne(e)).forEach((e=>o[e]=1))}h(e.sort),t.forEach(((e,t)=>{const o=n[t],f=te(o),p=_u(e,f,i[t]);if(h(o),a.push(p),ot(Ll,e))s.push(function(e,t,n,r){const i=Ll[e](t,n);return{init:i.init||de,update:function(e,t){t[r]=i.next(e)}}}(e,n[t],r[t],p));else{if(null==o&&"count"!==e&&se("Null aggregate field specified."),"count"===e)return void l.push(p);d=!1;let t=u[f];t||(t=u[f]=[],t.field=o,c.push(t)),t.push(Fu(e,p))}})),(l.length||c.length)&&(this.cell=function(e,t,n){e=e.map((e=>Ou(e,e.field)));const r={num:0,agg:null,store:!1,count:t};if(!n)for(var i=e.length,a=r.agg=Array(i),s=0;s<i;++s)a[s]=new e[s](r);if(r.store)var o=r.data=new Mu;return r.add=function(e){if(r.num+=1,!n){o&&o.add(e);for(let t=0;t<i;++t)a[t].add(a[t].get(e),e)}},r.rem=function(e){if(r.num-=1,!n){o&&o.rem(e);for(let t=0;t<i;++t)a[t].rem(a[t].get(e),e)}},r.set=function(e){let i,s;for(o&&o.values(),i=0,s=t.length;i<s;++i)e[t[i]]=r.num;if(!n)for(i=0,s=a.length;i<s;++i)a[i].set(e)},r.init=function(){r.num=0,o&&o.reset();for(let e=0;e<i;++e)a[e].init()},r}(c,l,d)),this.inputs=Object.keys(o)}const Ul=jl.prototype;function Wl(e){go.call(this,{},e),this._mlen=0,this._mods=[]}function Vl(e,t,n,r){const i=r.sort,a=i&&!r.ignorePeers,s=r.frame||[null,0],o=e.data(n),u=o.length,l=a?hr(i):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:o,compare:i||tt(-1)};t.init();for(let e=0;e<u;++e)Gl(c,s,e,u),a&&ql(c,l),t.update(c,o[e])}function Gl(e,t,n,r){e.p0=e.i0,e.p1=e.i1,e.i0=null==t[0]?0:Math.max(0,n-Math.abs(t[0])),e.i1=null==t[1]?r:Math.min(r,n+Math.abs(t[1])+1),e.index=n}function ql(e,t){const n=e.i0,r=e.i1-1,i=e.compare,a=e.data,s=a.length-1;n>0&&!i(a[n],a[n-1])&&(e.i0=t.left(a,a[n])),r<s&&!i(a[r],a[r+1])&&(e.i1=t.right(a,a[r]))}function Hl(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function Xl(e){this._context=e}function Kl(){}function Yl(e){this._context=e}function Ql(e){this._context=e}function Jl(e,t){this._basis=new Xl(e),this._beta=t}Ul.init=function(){this.windows.forEach((e=>e.init())),this.cell&&this.cell.init()},Ul.update=function(e,t){const n=this.cell,r=this.windows,i=e.data,a=r&&r.length;let s;if(n){for(s=e.p0;s<e.i0;++s)n.rem(i[s]);for(s=e.p1;s<e.i1;++s)n.add(i[s]);n.set(t)}for(s=0;s<a;++s)r[s].update(e,t)},Wl.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Pl.concat(Eu)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},dt(Wl,go,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),r=Us(e.sort),i=ku(e.groupby),a=e=>this.group(i(e));let s=this.state;s&&!n||(s=this.state=new jl(e)),n||t.modified(s.inputs)?(this.value={},t.visit(t.SOURCE,(e=>a(e).add(e)))):(t.visit(t.REM,(e=>a(e).remove(e))),t.visit(t.ADD,(e=>a(e).add(e))));for(let t=0,n=this._mlen;t<n;++t)Vl(this._mods[t],s,r,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(s.outputs)},group(e){let t=this.value[e];return t||(t=this.value[e]=Lu(Rs),t.stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}}),Xl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Hl(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Hl(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},Yl.prototype={areaStart:Kl,areaEnd:Kl,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:Hl(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},Ql.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:Hl(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},Jl.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var r,i=e[0],a=t[0],s=e[n]-i,o=t[n]-a,u=-1;++u<=n;)r=u/n,this._basis.point(this._beta*e[u]+(1-this._beta)*(i+r*s),this._beta*t[u]+(1-this._beta)*(a+r*o));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};const Zl=function e(t){function n(e){return 1===t?new Xl(e):new Jl(e,t)}return n.beta=function(t){return e(+t)},n}(.85);function ec(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function tc(e,t){this._context=e,this._k=(1-t)/6}tc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:ec(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:ec(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const nc=function e(t){function n(e){return new tc(e,t)}return n.tension=function(t){return e(+t)},n}(0);function rc(e,t){this._context=e,this._k=(1-t)/6}rc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:ec(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const ic=function e(t){function n(e){return new rc(e,t)}return n.tension=function(t){return e(+t)},n}(0);function ac(e,t){this._context=e,this._k=(1-t)/6}ac.prototype={areaStart:Kl,areaEnd:Kl,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:ec(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const sc=function e(t){function n(e){return new ac(e,t)}return n.tension=function(t){return e(+t)},n}(0);var oc=Math.abs,uc=Math.atan2,lc=Math.cos,cc=Math.max,dc=Math.min,hc=Math.sin,fc=Math.sqrt,pc=1e-12,gc=Math.PI,mc=gc/2,yc=2*gc;function vc(e){return e>1?0:e<-1?gc:Math.acos(e)}function bc(e){return e>=1?mc:e<=-1?-mc:Math.asin(e)}function xc(e,t,n){var r=e._x1,i=e._y1,a=e._x2,s=e._y2;if(e._l01_a>pc){var o=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,u=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*o-e._x0*e._l12_2a+e._x2*e._l01_2a)/u,i=(i*o-e._y0*e._l12_2a+e._y2*e._l01_2a)/u}if(e._l23_a>pc){var l=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);a=(a*l+e._x1*e._l23_2a-t*e._l12_2a)/c,s=(s*l+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(r,i,a,s,e._x2,e._y2)}function wc(e,t){this._context=e,this._alpha=t}wc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:xc(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const kc=function e(t){function n(e){return t?new wc(e,t):new tc(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function _c(e,t){this._context=e,this._alpha=t}_c.prototype={areaStart:Kl,areaEnd:Kl,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:xc(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Sc=function e(t){function n(e){return t?new _c(e,t):new ac(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function Cc(e,t){this._context=e,this._alpha=t}Cc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:xc(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Ac=function e(t){function n(e){return t?new Cc(e,t):new rc(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function Ec(e){this._context=e}function Fc(e){return new Ec(e)}function Ic(e){this._context=e}function Dc(e){return e<0?-1:1}function Nc(e,t,n){var r=e._x1-e._x0,i=t-e._x1,a=(e._y1-e._y0)/(r||i<0&&-0),s=(n-e._y1)/(i||r<0&&-0),o=(a*i+s*r)/(r+i);return(Dc(a)+Dc(s))*Math.min(Math.abs(a),Math.abs(s),.5*Math.abs(o))||0}function $c(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function Tc(e,t,n){var r=e._x0,i=e._y0,a=e._x1,s=e._y1,o=(a-r)/3;e._context.bezierCurveTo(r+o,i+o*t,a-o,s-o*n,a,s)}function Oc(e){this._context=e}function Mc(e){this._context=new Rc(e)}function Rc(e){this._context=e}function Bc(e){this._context=e}function zc(e){var t,n,r=e.length-1,i=new Array(r),a=new Array(r),s=new Array(r);for(i[0]=0,a[0]=2,s[0]=e[0]+2*e[1],t=1;t<r-1;++t)i[t]=1,a[t]=4,s[t]=4*e[t]+2*e[t+1];for(i[r-1]=2,a[r-1]=7,s[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=i[t]/a[t-1],a[t]-=n,s[t]-=n*s[t-1];for(i[r-1]=s[r-1]/a[r-1],t=r-2;t>=0;--t)i[t]=(s[t]-i[t+1])/a[t];for(a[r-1]=(e[r]+i[r-1])/2,t=0;t<r-1;++t)a[t]=2*e[t+1]-i[t+1];return[i,a]}function Lc(e,t){this._context=e,this._t=t}Ec.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}},Ic.prototype={areaStart:Kl,areaEnd:Kl,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}},Oc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Tc(this,this._t0,$c(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(t=+t,(e=+e)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Tc(this,$c(this,n=Nc(this,e,t)),n);break;default:Tc(this,this._t0,n=Nc(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}},(Mc.prototype=Object.create(Oc.prototype)).point=function(e,t){Oc.prototype.point.call(this,t,e)},Rc.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,a){this._context.bezierCurveTo(t,e,r,n,a,i)}},Bc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),2===n)this._context.lineTo(e[1],t[1]);else for(var r=zc(e),i=zc(t),a=0,s=1;s<n;++a,++s)this._context.bezierCurveTo(r[0][a],i[0][a],r[1][a],i[1][a],e[s],t[s]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}},Lc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}}this._x=e,this._y=t}};const Pc=Math.PI,jc=2*Pc,Uc=1e-6,Wc=jc-Uc;function Vc(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Gc(){return new Vc}Vc.prototype=Gc.prototype={constructor:Vc,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,r){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(e,t,n,r,i,a){this._+="C"+ +e+","+ +t+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+a)},arcTo:function(e,t,n,r,i){e=+e,t=+t,n=+n,r=+r,i=+i;var a=this._x1,s=this._y1,o=n-e,u=r-t,l=a-e,c=s-t,d=l*l+c*c;if(i<0)throw new Error("negative radius: "+i);if(null===this._x1)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(d>Uc)if(Math.abs(c*o-u*l)>Uc&&i){var h=n-a,f=r-s,p=o*o+u*u,g=h*h+f*f,m=Math.sqrt(p),y=Math.sqrt(d),v=i*Math.tan((Pc-Math.acos((p+d-g)/(2*m*y)))/2),b=v/y,x=v/m;Math.abs(b-1)>Uc&&(this._+="L"+(e+b*l)+","+(t+b*c)),this._+="A"+i+","+i+",0,0,"+ +(c*h>l*f)+","+(this._x1=e+x*o)+","+(this._y1=t+x*u)}else this._+="L"+(this._x1=e)+","+(this._y1=t)},arc:function(e,t,n,r,i,a){e=+e,t=+t,a=!!a;var s=(n=+n)*Math.cos(r),o=n*Math.sin(r),u=e+s,l=t+o,c=1^a,d=a?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+u+","+l:(Math.abs(this._x1-u)>Uc||Math.abs(this._y1-l)>Uc)&&(this._+="L"+u+","+l),n&&(d<0&&(d=d%jc+jc),d>Wc?this._+="A"+n+","+n+",0,1,"+c+","+(e-s)+","+(t-o)+"A"+n+","+n+",0,1,"+c+","+(this._x1=u)+","+(this._y1=l):d>Uc&&(this._+="A"+n+","+n+",0,"+ +(d>=Pc)+","+c+","+(this._x1=e+n*Math.cos(i))+","+(this._y1=t+n*Math.sin(i))))},rect:function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};const qc=Gc;function Hc(e){return function(){return e}}function Xc(e){return e.innerRadius}function Kc(e){return e.outerRadius}function Yc(e){return e.startAngle}function Qc(e){return e.endAngle}function Jc(e){return e&&e.padAngle}function Zc(e,t,n,r,i,a,s,o){var u=n-e,l=r-t,c=s-i,d=o-a,h=d*u-c*l;if(!(h*h<pc))return[e+(h=(c*(t-a)-d*(e-i))/h)*u,t+h*l]}function ed(e,t,n,r,i,a,s){var o=e-n,u=t-r,l=(s?a:-a)/fc(o*o+u*u),c=l*u,d=-l*o,h=e+c,f=t+d,p=n+c,g=r+d,m=(h+p)/2,y=(f+g)/2,v=p-h,b=g-f,x=v*v+b*b,w=i-a,k=h*g-p*f,_=(b<0?-1:1)*fc(cc(0,w*w*x-k*k)),S=(k*b-v*_)/x,C=(-k*v-b*_)/x,A=(k*b+v*_)/x,E=(-k*v+b*_)/x,F=S-m,I=C-y,D=A-m,N=E-y;return F*F+I*I>D*D+N*N&&(S=A,C=E),{cx:S,cy:C,x01:-c,y01:-d,x11:S*(i/w-1),y11:C*(i/w-1)}}function td(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function nd(e){return e[0]}function rd(e){return e[1]}function id(e,t){var n=Hc(!0),r=null,i=Fc,a=null;function s(s){var o,u,l,c=(s=td(s)).length,d=!1;for(null==r&&(a=i(l=qc())),o=0;o<=c;++o)!(o<c&&n(u=s[o],o,s))===d&&((d=!d)?a.lineStart():a.lineEnd()),d&&a.point(+e(u,o,s),+t(u,o,s));if(l)return a=null,l+""||null}return e="function"==typeof e?e:void 0===e?nd:Hc(e),t="function"==typeof t?t:void 0===t?rd:Hc(t),s.x=function(t){return arguments.length?(e="function"==typeof t?t:Hc(+t),s):e},s.y=function(e){return arguments.length?(t="function"==typeof e?e:Hc(+e),s):t},s.defined=function(e){return arguments.length?(n="function"==typeof e?e:Hc(!!e),s):n},s.curve=function(e){return arguments.length?(i=e,null!=r&&(a=i(r)),s):i},s.context=function(e){return arguments.length?(null==e?r=a=null:a=i(r=e),s):r},s}function ad(e,t,n){var r=null,i=Hc(!0),a=null,s=Fc,o=null;function u(u){var l,c,d,h,f,p=(u=td(u)).length,g=!1,m=new Array(p),y=new Array(p);for(null==a&&(o=s(f=qc())),l=0;l<=p;++l){if(!(l<p&&i(h=u[l],l,u))===g)if(g=!g)c=l,o.areaStart(),o.lineStart();else{for(o.lineEnd(),o.lineStart(),d=l-1;d>=c;--d)o.point(m[d],y[d]);o.lineEnd(),o.areaEnd()}g&&(m[l]=+e(h,l,u),y[l]=+t(h,l,u),o.point(r?+r(h,l,u):m[l],n?+n(h,l,u):y[l]))}if(f)return o=null,f+""||null}function l(){return id().defined(i).curve(s).context(a)}return e="function"==typeof e?e:void 0===e?nd:Hc(+e),t="function"==typeof t?t:Hc(void 0===t?0:+t),n="function"==typeof n?n:void 0===n?rd:Hc(+n),u.x=function(t){return arguments.length?(e="function"==typeof t?t:Hc(+t),r=null,u):e},u.x0=function(t){return arguments.length?(e="function"==typeof t?t:Hc(+t),u):e},u.x1=function(e){return arguments.length?(r=null==e?null:"function"==typeof e?e:Hc(+e),u):r},u.y=function(e){return arguments.length?(t="function"==typeof e?e:Hc(+e),n=null,u):t},u.y0=function(e){return arguments.length?(t="function"==typeof e?e:Hc(+e),u):t},u.y1=function(e){return arguments.length?(n=null==e?null:"function"==typeof e?e:Hc(+e),u):n},u.lineX0=u.lineY0=function(){return l().x(e).y(t)},u.lineY1=function(){return l().x(e).y(n)},u.lineX1=function(){return l().x(r).y(t)},u.defined=function(e){return arguments.length?(i="function"==typeof e?e:Hc(!!e),u):i},u.curve=function(e){return arguments.length?(s=e,null!=a&&(o=s(a)),u):s},u.context=function(e){return arguments.length?(null==e?a=o=null:o=s(a=e),u):a},u}Array.prototype.slice;const sd={draw:function(e,t){var n=Math.sqrt(t/gc);e.moveTo(n,0),e.arc(0,0,n,0,yc)}};Math.sqrt(1/3);Math.sin(gc/10),Math.sin(7*gc/10);function od(e,t){if("undefined"!=typeof document&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}Math.sin(yc/10),Math.cos(yc/10),Math.sqrt(3),Math.sqrt(3),Math.sqrt(12);const ud=()=>"undefined"!=typeof Image?Image:null,ld=hr(dr),cd=ld.right,dd=ld.left,hd=(hr(_o).center,cd);function fd(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function pd(e,t){switch(arguments.length){case 0:break;case 1:"function"==typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"==typeof t?this.interpolator(t):this.range(t)}return this}const gd=Symbol("implicit");function md(){var e=new Map,t=[],n=[],r=gd;function i(i){var a=i+"",s=e.get(a);if(!s){if(r!==gd)return r;e.set(a,s=t.push(i))}return n[(s-1)%n.length]}return i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=new Map;for(const r of n){const n=r+"";e.has(n)||e.set(n,t.push(r))}return i},i.range=function(e){return arguments.length?(n=Array.from(e),i):n.slice()},i.unknown=function(e){return arguments.length?(r=e,i):r},i.copy=function(){return md(t,n).unknown(r)},fd.apply(i,arguments),i}var yd=n(16722);function vd(e,t,n,r){var i,a=Zt(e,t,n);switch((r=(0,yd.formatSpecifier)(null==r?",f":r)).type){case"s":var s=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=(0,yd.precisionPrefix)(a,s))||(r.precision=i),(0,yd.formatPrefix)(r,s);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=(0,yd.precisionRound)(a,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=(0,yd.precisionFixed)(a))||(r.precision=i-2*("%"===r.type))}return(0,yd.format)(r)}function bd(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function xd(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function wd(){}var kd=.7,_d=1/kd,Sd="\\s*([+-]?\\d+)\\s*",Cd="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ad="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ed=/^#([0-9a-f]{3,8})$/,Fd=new RegExp("^rgb\\("+[Sd,Sd,Sd]+"\\)$"),Id=new RegExp("^rgb\\("+[Ad,Ad,Ad]+"\\)$"),Dd=new RegExp("^rgba\\("+[Sd,Sd,Sd,Cd]+"\\)$"),Nd=new RegExp("^rgba\\("+[Ad,Ad,Ad,Cd]+"\\)$"),$d=new RegExp("^hsl\\("+[Cd,Ad,Ad]+"\\)$"),Td=new RegExp("^hsla\\("+[Cd,Ad,Ad,Cd]+"\\)$"),Od={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Md(){return this.rgb().formatHex()}function Rd(){return this.rgb().formatRgb()}function Bd(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Ed.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?zd(t):3===n?new Ud(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Ld(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Ld(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Fd.exec(e))?new Ud(t[1],t[2],t[3],1):(t=Id.exec(e))?new Ud(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Dd.exec(e))?Ld(t[1],t[2],t[3],t[4]):(t=Nd.exec(e))?Ld(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=$d.exec(e))?qd(t[1],t[2]/100,t[3]/100,1):(t=Td.exec(e))?qd(t[1],t[2]/100,t[3]/100,t[4]):Od.hasOwnProperty(e)?zd(Od[e]):"transparent"===e?new Ud(NaN,NaN,NaN,0):null}function zd(e){return new Ud(e>>16&255,e>>8&255,255&e,1)}function Ld(e,t,n,r){return r<=0&&(e=t=n=NaN),new Ud(e,t,n,r)}function Pd(e){return e instanceof wd||(e=Bd(e)),e?new Ud((e=e.rgb()).r,e.g,e.b,e.opacity):new Ud}function jd(e,t,n,r){return 1===arguments.length?Pd(e):new Ud(e,t,n,null==r?1:r)}function Ud(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function Wd(){return"#"+Gd(this.r)+Gd(this.g)+Gd(this.b)}function Vd(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function Gd(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function qd(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Kd(e,t,n,r)}function Hd(e){if(e instanceof Kd)return new Kd(e.h,e.s,e.l,e.opacity);if(e instanceof wd||(e=Bd(e)),!e)return new Kd;if(e instanceof Kd)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),s=NaN,o=a-i,u=(a+i)/2;return o?(s=t===a?(n-r)/o+6*(n<r):n===a?(r-t)/o+2:(t-n)/o+4,o/=u<.5?a+i:2-a-i,s*=60):o=u>0&&u<1?0:s,new Kd(s,o,u,e.opacity)}function Xd(e,t,n,r){return 1===arguments.length?Hd(e):new Kd(e,t,n,null==r?1:r)}function Kd(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Yd(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function Qd(e,t,n,r,i){var a=e*e,s=a*e;return((1-3*e+3*a-s)*t+(4-6*a+3*s)*n+(1+3*e+3*a-3*s)*r+s*i)/6}function Jd(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1],s=r>0?e[r-1]:2*i-a,o=r<t-1?e[r+2]:2*a-i;return Qd((n-r/t)*t,s,i,a,o)}}function Zd(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],a=e[r%t],s=e[(r+1)%t],o=e[(r+2)%t];return Qd((n-r/t)*t,i,a,s,o)}}bd(wd,Bd,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Md,formatHex:Md,formatHsl:function(){return Hd(this).formatHsl()},formatRgb:Rd,toString:Rd}),bd(Ud,jd,xd(wd,{brighter:function(e){return e=null==e?_d:Math.pow(_d,e),new Ud(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?kd:Math.pow(kd,e),new Ud(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Wd,formatHex:Wd,formatRgb:Vd,toString:Vd})),bd(Kd,Xd,xd(wd,{brighter:function(e){return e=null==e?_d:Math.pow(_d,e),new Kd(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?kd:Math.pow(kd,e),new Kd(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Ud(Yd(e>=240?e-240:e+120,i,r),Yd(e,i,r),Yd(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));const eh=e=>()=>e;function th(e,t){return function(n){return e+n*t}}function nh(e,t){var n=t-e;return n?th(e,n>180||n<-180?n-360*Math.round(n/360):n):eh(isNaN(e)?t:e)}function rh(e,t){var n=t-e;return n?th(e,n):eh(isNaN(e)?t:e)}const ih=function e(t){var n=function(e){return 1==(e=+e)?rh:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):eh(isNaN(t)?n:t)}}(t);function r(e,t){var r=n((e=jd(e)).r,(t=jd(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),s=rh(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=s(t),e+""}}return r.gamma=e,r}(1);function ah(e){return function(t){var n,r,i=t.length,a=new Array(i),s=new Array(i),o=new Array(i);for(n=0;n<i;++n)r=jd(t[n]),a[n]=r.r||0,s[n]=r.g||0,o[n]=r.b||0;return a=e(a),s=e(s),o=e(o),r.opacity=1,function(e){return r.r=a(e),r.g=s(e),r.b=o(e),r+""}}}var sh=ah(Jd),oh=ah(Zd);function uh(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(n=0;n<r;++n)i[n]=e[n]*(1-a)+t[n]*a;return i}}function lh(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function ch(e,t){return(lh(t)?uh:dh)(e,t)}function dh(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),s=new Array(r);for(n=0;n<i;++n)a[n]=vh(e[n],t[n]);for(;n<r;++n)s[n]=t[n];return function(e){for(n=0;n<i;++n)s[n]=a[n](e);return s}}function hh(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function fh(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function ph(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=vh(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var gh=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,mh=new RegExp(gh.source,"g");function yh(e,t){var n,r,i,a=gh.lastIndex=mh.lastIndex=0,s=-1,o=[],u=[];for(e+="",t+="";(n=gh.exec(e))&&(r=mh.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),o[s]?o[s]+=i:o[++s]=i),(n=n[0])===(r=r[0])?o[s]?o[s]+=r:o[++s]=r:(o[++s]=null,u.push({i:s,x:fh(n,r)})),a=mh.lastIndex;return a<t.length&&(i=t.slice(a),o[s]?o[s]+=i:o[++s]=i),o.length<2?u[0]?function(e){return function(t){return e(t)+""}}(u[0].x):function(e){return function(){return e}}(t):(t=u.length,function(e){for(var n,r=0;r<t;++r)o[(n=u[r]).i]=n.x(e);return o.join("")})}function vh(e,t){var n,r=typeof t;return null==t||"boolean"===r?eh(t):("number"===r?fh:"string"===r?(n=Bd(t))?(t=n,ih):yh:t instanceof Bd?ih:t instanceof Date?hh:lh(t)?uh:Array.isArray(t)?dh:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?ph:fh)(e,t)}function bh(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function xh(e){return+e}var wh=[0,1];function kh(e){return e}function _h(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(e){return function(){return e}}(isNaN(t)?NaN:.5)}function Sh(e,t,n){var r=e[0],i=e[1],a=t[0],s=t[1];return i<r?(r=_h(i,r),a=n(s,a)):(r=_h(r,i),a=n(a,s)),function(e){return a(r(e))}}function Ch(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),a=new Array(r),s=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<r;)i[s]=_h(e[s],e[s+1]),a[s]=n(t[s],t[s+1]);return function(t){var n=hd(e,t,1,r)-1;return a[n](i[n](t))}}function Ah(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Eh(){var e,t,n,r,i,a,s=wh,o=wh,u=vh,l=kh;function c(){var e=Math.min(s.length,o.length);return l!==kh&&(l=function(e,t){var n;return e>t&&(n=e,e=t,t=n),function(n){return Math.max(e,Math.min(t,n))}}(s[0],s[e-1])),r=e>2?Ch:Sh,i=a=null,d}function d(t){return null==t||isNaN(t=+t)?n:(i||(i=r(s.map(e),o,u)))(e(l(t)))}return d.invert=function(n){return l(t((a||(a=r(o,s.map(e),fh)))(n)))},d.domain=function(e){return arguments.length?(s=Array.from(e,xh),c()):s.slice()},d.range=function(e){return arguments.length?(o=Array.from(e),c()):o.slice()},d.rangeRound=function(e){return o=Array.from(e),u=bh,c()},d.clamp=function(e){return arguments.length?(l=!!e||kh,c()):l!==kh},d.interpolate=function(e){return arguments.length?(u=e,c()):u},d.unknown=function(e){return arguments.length?(n=e,d):n},function(n,r){return e=n,t=r,c()}}function Fh(){return Eh()(kh,kh)}function Ih(e){var t=e.domain;return e.ticks=function(e){var n=t();return Qt(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return vd(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i,a=t(),s=0,o=a.length-1,u=a[s],l=a[o],c=10;for(l<u&&(i=u,u=l,l=i,i=s,s=o,o=i);c-- >0;){if((i=Jt(u,l,n))===r)return a[s]=u,a[o]=l,t(a);if(i>0)u=Math.floor(u/i)*i,l=Math.ceil(l/i)*i;else{if(!(i<0))break;u=Math.ceil(u*i)/i,l=Math.floor(l*i)/i}r=i}return e},e}function Dh(e,t){var n,r=0,i=(e=e.slice()).length-1,a=e[r],s=e[i];return s<a&&(n=r,r=i,i=n,n=a,a=s,s=n),e[r]=t.floor(a),e[i]=t.ceil(s),e}function Nh(e){return Math.log(e)}function $h(e){return Math.exp(e)}function Th(e){return-Math.log(-e)}function Oh(e){return-Math.exp(-e)}function Mh(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Rh(e){return function(t){return-e(-t)}}function Bh(e){var t,n,r=e(Nh,$h),i=r.domain,a=10;function s(){return t=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}(a),n=function(e){return 10===e?Mh:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}(a),i()[0]<0?(t=Rh(t),n=Rh(n),e(Th,Oh)):e(Nh,$h),r}return r.base=function(e){return arguments.length?(a=+e,s()):a},r.domain=function(e){return arguments.length?(i(e),s()):i()},r.ticks=function(e){var r,s=i(),o=s[0],u=s[s.length-1];(r=u<o)&&(h=o,o=u,u=h);var l,c,d,h=t(o),f=t(u),p=null==e?10:+e,g=[];if(!(a%1)&&f-h<p){if(h=Math.floor(h),f=Math.ceil(f),o>0){for(;h<=f;++h)for(c=1,l=n(h);c<a;++c)if(!((d=l*c)<o)){if(d>u)break;g.push(d)}}else for(;h<=f;++h)for(c=a-1,l=n(h);c>=1;--c)if(!((d=l*c)<o)){if(d>u)break;g.push(d)}2*g.length<p&&(g=Qt(o,u,p))}else g=Qt(h,f,Math.min(f-h,p)).map(n);return r?g.reverse():g},r.tickFormat=function(e,i){if(null==i&&(i=10===a?".0e":","),"function"!=typeof i&&(i=(0,yd.format)(i)),e===1/0)return i;null==e&&(e=10);var s=Math.max(1,a*e/r.ticks().length);return function(e){var r=e/n(Math.round(t(e)));return r*a<a-.5&&(r*=a),r<=s?i(e):""}},r.nice=function(){return i(Dh(i(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},r}function zh(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Lh(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Ph(e){return e<0?-e*e:e*e}function jh(e){var t=e(kh,kh),n=1;function r(){return 1===n?e(kh,kh):.5===n?e(Lh,Ph):e(zh(n),zh(1/n))}return t.exponent=function(e){return arguments.length?(n=+e,r()):n},Ih(t)}function Uh(){var e=jh(Eh());return e.copy=function(){return Ah(e,Uh()).exponent(e.exponent())},fd.apply(e,arguments),e}function Wh(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function Vh(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function Gh(e){var t=1,n=e(Wh(t),Vh(t));return n.constant=function(n){return arguments.length?e(Wh(t=+n),Vh(t)):t},Ih(n)}function qh(e,t,n,r,i,a){const s=[[er,1,bn],[er,5,5e3],[er,15,15e3],[er,30,3e4],[a,1,xn],[a,5,3e5],[a,15,9e5],[a,30,18e5],[i,1,wn],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,kn],[r,2,1728e5],[n,1,_n],[t,1,2592e6],[t,3,7776e6],[e,1,Sn]];function o(t,n,r){const i=Math.abs(n-t)/r,a=hr((([,,e])=>e)).right(s,i);if(a===s.length)return e.every(Zt(t/Sn,n/Sn,r));if(0===a)return nr.every(Math.max(Zt(t,n,r),1));const[o,u]=s[i/s[a-1][2]<s[a][2]/i?a-1:a];return o.every(u)}return[function(e,t,n){const r=t<e;r&&([e,t]=[t,e]);const i=n&&"function"==typeof n.range?n:o(e,t,n),a=i?i.range(e,+t+1):[];return r?a.reverse():a},o]}const[Hh,Xh]=qh(ir,sr,zn,Rn,ur,cr),[Kh,Yh]=qh(qn,Xn,Fn,An,Yn,Jn);function Qh(e){return new Date(e)}function Jh(e){return e instanceof Date?+e:+new Date(+e)}function Zh(e,t,n,r,i,a,s,o,u,l){var c=Fh(),d=c.invert,h=c.domain,f=l(".%L"),p=l(":%S"),g=l("%I:%M"),m=l("%I %p"),y=l("%a %d"),v=l("%b %d"),b=l("%B"),x=l("%Y");function w(e){return(u(e)<e?f:o(e)<e?p:s(e)<e?g:a(e)<e?m:r(e)<e?i(e)<e?y:v:n(e)<e?b:x)(e)}return c.invert=function(e){return new Date(d(e))},c.domain=function(e){return arguments.length?h(Array.from(e,Jh)):h().map(Qh)},c.ticks=function(t){var n=h();return e(n[0],n[n.length-1],null==t?10:t)},c.tickFormat=function(e,t){return null==t?w:l(t)},c.nice=function(e){var n=h();return e&&"function"==typeof e.range||(e=t(n[0],n[n.length-1],null==e?10:e)),e?h(Dh(n,e)):c},c.copy=function(){return Ah(c,Zh(e,t,n,r,i,a,s,o,u,l))},c}function ef(){var e,t,n,r,i,a=0,s=1,o=kh,u=!1;function l(t){return null==t||isNaN(t=+t)?i:o(0===n?.5:(t=(r(t)-e)*n,u?Math.max(0,Math.min(1,t)):t))}function c(e){return function(t){var n,r;return arguments.length?([n,r]=t,o=e(n,r),l):[o(0),o(1)]}}return l.domain=function(i){return arguments.length?([a,s]=i,e=r(a=+a),t=r(s=+s),n=e===t?0:1/(t-e),l):[a,s]},l.clamp=function(e){return arguments.length?(u=!!e,l):u},l.interpolator=function(e){return arguments.length?(o=e,l):o},l.range=c(vh),l.rangeRound=c(bh),l.unknown=function(e){return arguments.length?(i=e,l):i},function(i){return r=i,e=i(a),t=i(s),n=e===t?0:1/(t-e),l}}function tf(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function nf(){var e=Ih(ef()(kh));return e.copy=function(){return tf(e,nf())},pd.apply(e,arguments)}function rf(){var e=jh(ef());return e.copy=function(){return tf(e,rf()).exponent(e.exponent())},pd.apply(e,arguments)}function af(e,t){void 0===t&&(t=e,e=vh);for(var n=0,r=t.length-1,i=t[0],a=new Array(r<0?0:r);n<r;)a[n]=e(i,i=t[++n]);return function(e){var t=Math.max(0,Math.min(r-1,Math.floor(e*=r)));return a[t](e-t)}}function sf(){var e,t,n,r,i,a,s,o=0,u=.5,l=1,c=1,d=kh,h=!1;function f(e){return isNaN(e=+e)?s:(e=.5+((e=+a(e))-t)*(c*e<c*t?r:i),d(h?Math.max(0,Math.min(1,e)):e))}function p(e){return function(t){var n,r,i;return arguments.length?([n,r,i]=t,d=af(e,[n,r,i]),f):[d(0),d(.5),d(1)]}}return f.domain=function(s){return arguments.length?([o,u,l]=s,e=a(o=+o),t=a(u=+u),n=a(l=+l),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),c=t<e?-1:1,f):[o,u,l]},f.clamp=function(e){return arguments.length?(h=!!e,f):h},f.interpolator=function(e){return arguments.length?(d=e,f):d},f.range=p(vh),f.rangeRound=p(bh),f.unknown=function(e){return arguments.length?(s=e,f):s},function(s){return a=s,e=s(o),t=s(u),n=s(l),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),c=t<e?-1:1,f}}function of(){var e=jh(sf());return e.copy=function(){return tf(e,of()).exponent(e.exponent())},pd.apply(e,arguments)}function uf(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function lf(e,t){var n=nh(+e,+t);return function(e){var t=n(e);return t-360*Math.floor(t/360)}}var cf,df=180/Math.PI,hf={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function ff(e,t,n,r,i,a){var s,o,u;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(u=e*n+t*r)&&(n-=e*u,r-=t*u),(o=Math.sqrt(n*n+r*r))&&(n/=o,r/=o,u/=o),e*r<t*n&&(e=-e,t=-t,u=-u,s=-s),{translateX:i,translateY:a,rotate:Math.atan2(t,e)*df,skewX:Math.atan(u)*df,scaleX:s,scaleY:o}}function pf(e,t,n,r){function i(e){return e.length?e.pop()+" ":""}return function(a,s){var o=[],u=[];return a=e(a),s=e(s),function(e,r,i,a,s,o){if(e!==i||r!==a){var u=s.push("translate(",null,t,null,n);o.push({i:u-4,x:fh(e,i)},{i:u-2,x:fh(r,a)})}else(i||a)&&s.push("translate("+i+t+a+n)}(a.translateX,a.translateY,s.translateX,s.translateY,o,u),function(e,t,n,a){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),a.push({i:n.push(i(n)+"rotate(",null,r)-2,x:fh(e,t)})):t&&n.push(i(n)+"rotate("+t+r)}(a.rotate,s.rotate,o,u),function(e,t,n,a){e!==t?a.push({i:n.push(i(n)+"skewX(",null,r)-2,x:fh(e,t)}):t&&n.push(i(n)+"skewX("+t+r)}(a.skewX,s.skewX,o,u),function(e,t,n,r,a,s){if(e!==n||t!==r){var o=a.push(i(a)+"scale(",null,",",null,")");s.push({i:o-4,x:fh(e,n)},{i:o-2,x:fh(t,r)})}else 1===n&&1===r||a.push(i(a)+"scale("+n+","+r+")")}(a.scaleX,a.scaleY,s.scaleX,s.scaleY,o,u),a=s=null,function(e){for(var t,n=-1,r=u.length;++n<r;)o[(t=u[n]).i]=t.x(e);return o.join("")}}}var gf=pf((function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?hf:ff(t.a,t.b,t.c,t.d,t.e,t.f)}),"px, ","px)","deg)"),mf=pf((function(e){return null==e?hf:(cf||(cf=document.createElementNS("http://www.w3.org/2000/svg","g")),cf.setAttribute("transform",e),(e=cf.transform.baseVal.consolidate())?ff((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):hf)}),", ",")",")");function yf(e){return((e=Math.exp(e))+1/e)/2}const vf=function e(t,n,r){function i(e,i){var a,s,o=e[0],u=e[1],l=e[2],c=i[0],d=i[1],h=i[2],f=c-o,p=d-u,g=f*f+p*p;if(g<1e-12)s=Math.log(h/l)/t,a=function(e){return[o+e*f,u+e*p,l*Math.exp(t*e*s)]};else{var m=Math.sqrt(g),y=(h*h-l*l+r*g)/(2*l*n*m),v=(h*h-l*l-r*g)/(2*h*n*m),b=Math.log(Math.sqrt(y*y+1)-y),x=Math.log(Math.sqrt(v*v+1)-v);s=(x-b)/t,a=function(e){var r=e*s,i=yf(b),a=l/(n*m)*(i*function(e){return((e=Math.exp(2*e))-1)/(e+1)}(t*r+b)-function(e){return((e=Math.exp(e))-1/e)/2}(b));return[o+a*f,u+a*p,l*i/yf(t*r+b)]}}return a.duration=1e3*s*t/Math.SQRT2,a}return i.rho=function(t){var n=Math.max(.001,+t),r=n*n;return e(n,r,r*r)},i}(Math.SQRT2,2,4);function bf(e){return function(t,n){var r=e((t=Xd(t)).h,(n=Xd(n)).h),i=rh(t.s,n.s),a=rh(t.l,n.l),s=rh(t.opacity,n.opacity);return function(e){return t.h=r(e),t.s=i(e),t.l=a(e),t.opacity=s(e),t+""}}}const xf=bf(nh);var wf=bf(rh);const kf=Math.PI/180,_f=180/Math.PI,Sf=.96422,Cf=.82521,Af=4/29,Ef=6/29,Ff=3*Ef*Ef;function If(e){if(e instanceof Nf)return new Nf(e.l,e.a,e.b,e.opacity);if(e instanceof zf)return Lf(e);e instanceof Ud||(e=Pd(e));var t,n,r=Mf(e.r),i=Mf(e.g),a=Mf(e.b),s=$f((.2225045*r+.7168786*i+.0606169*a)/1);return r===i&&i===a?t=n=s:(t=$f((.4360747*r+.3850649*i+.1430804*a)/Sf),n=$f((.0139322*r+.0971045*i+.7141733*a)/Cf)),new Nf(116*s-16,500*(t-s),200*(s-n),e.opacity)}function Df(e,t,n,r){return 1===arguments.length?If(e):new Nf(e,t,n,null==r?1:r)}function Nf(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}function $f(e){return e>.008856451679035631?Math.pow(e,1/3):e/Ff+Af}function Tf(e){return e>Ef?e*e*e:Ff*(e-Af)}function Of(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Mf(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Rf(e){if(e instanceof zf)return new zf(e.h,e.c,e.l,e.opacity);if(e instanceof Nf||(e=If(e)),0===e.a&&0===e.b)return new zf(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*_f;return new zf(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function Bf(e,t,n,r){return 1===arguments.length?Rf(e):new zf(e,t,n,null==r?1:r)}function zf(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function Lf(e){if(isNaN(e.h))return new Nf(e.l,0,0,e.opacity);var t=e.h*kf;return new Nf(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}function Pf(e,t){var n=rh((e=Df(e)).l,(t=Df(t)).l),r=rh(e.a,t.a),i=rh(e.b,t.b),a=rh(e.opacity,t.opacity);return function(t){return e.l=n(t),e.a=r(t),e.b=i(t),e.opacity=a(t),e+""}}function jf(e){return function(t,n){var r=e((t=Bf(t)).h,(n=Bf(n)).h),i=rh(t.c,n.c),a=rh(t.l,n.l),s=rh(t.opacity,n.opacity);return function(e){return t.h=r(e),t.c=i(e),t.l=a(e),t.opacity=s(e),t+""}}}bd(Nf,Df,xd(wd,{brighter:function(e){return new Nf(this.l+18*(null==e?1:e),this.a,this.b,this.opacity)},darker:function(e){return new Nf(this.l-18*(null==e?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new Ud(Of(3.1338561*(t=Sf*Tf(t))-1.6168667*(e=1*Tf(e))-.4906146*(n=Cf*Tf(n))),Of(-.9787684*t+1.9161415*e+.033454*n),Of(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),bd(zf,Bf,xd(wd,{brighter:function(e){return new zf(this.h,this.c,this.l+18*(null==e?1:e),this.opacity)},darker:function(e){return new zf(this.h,this.c,this.l-18*(null==e?1:e),this.opacity)},rgb:function(){return Lf(this).rgb()}}));const Uf=jf(nh);var Wf=jf(rh),Vf=-.14861,Gf=1.78277,qf=-.29227,Hf=-.90649,Xf=1.97294,Kf=Xf*Hf,Yf=Xf*Gf,Qf=Gf*qf-Hf*Vf;function Jf(e){if(e instanceof ep)return new ep(e.h,e.s,e.l,e.opacity);e instanceof Ud||(e=Pd(e));var t=e.r/255,n=e.g/255,r=e.b/255,i=(Qf*r+Kf*t-Yf*n)/(Qf+Kf-Yf),a=r-i,s=(Xf*(n-i)-qf*a)/Hf,o=Math.sqrt(s*s+a*a)/(Xf*i*(1-i)),u=o?Math.atan2(s,a)*_f-120:NaN;return new ep(u<0?u+360:u,o,i,e.opacity)}function Zf(e,t,n,r){return 1===arguments.length?Jf(e):new ep(e,t,n,null==r?1:r)}function ep(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function tp(e){return function t(n){function r(t,r){var i=e((t=Zf(t)).h,(r=Zf(r)).h),a=rh(t.s,r.s),s=rh(t.l,r.l),o=rh(t.opacity,r.opacity);return function(e){return t.h=i(e),t.s=a(e),t.l=s(Math.pow(e,n)),t.opacity=o(e),t+""}}return n=+n,r.gamma=t,r}(1)}bd(ep,Zf,xd(wd,{brighter:function(e){return e=null==e?_d:Math.pow(_d,e),new ep(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?kd:Math.pow(kd,e),new ep(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*kf,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new Ud(255*(t+n*(Vf*r+Gf*i)),255*(t+n*(qf*r+Hf*i)),255*(t+n*(Xf*r)),this.opacity)}}));const np=tp(nh);var rp=tp(rh);function ip(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n}function ap(e,t,n){const r=e-t+2*n;return e?r>0?r:1:0}const sp="linear",op="log",up="pow",lp="sqrt",cp="symlog",dp="time",hp="utc",fp="sequential",pp="diverging",gp="quantile",mp="quantize",yp="threshold",vp="ordinal",bp="point",xp="band",wp="bin-ordinal",kp="continuous",_p="discrete",Sp="discretizing",Cp="interpolating",Ap="temporal";function Ep(){const e=md().unknown(void 0),t=e.domain,n=e.range;let r,i,a=[0,1],s=!1,o=0,u=0,l=.5;function c(){const e=t().length,c=a[1]<a[0],d=a[1-c],h=ap(e,o,u);let f=a[c-0];r=(d-f)/(h||1),s&&(r=Math.floor(r)),f+=(d-f-r*(e-o))*l,i=r*(1-o),s&&(f=Math.round(f),i=Math.round(i));const p=wu(e).map((e=>f+r*e));return n(c?p.reverse():p)}return delete e.unknown,e.domain=function(e){return arguments.length?(t(e),c()):t()},e.range=function(e){return arguments.length?(a=[+e[0],+e[1]],c()):a.slice()},e.rangeRound=function(e){return a=[+e[0],+e[1]],s=!0,c()},e.bandwidth=function(){return i},e.step=function(){return r},e.round=function(e){return arguments.length?(s=!!e,c()):s},e.padding=function(e){return arguments.length?(u=Math.max(0,Math.min(1,e)),o=u,c()):o},e.paddingInner=function(e){return arguments.length?(o=Math.max(0,Math.min(1,e)),c()):o},e.paddingOuter=function(e){return arguments.length?(u=Math.max(0,Math.min(1,e)),c()):u},e.align=function(e){return arguments.length?(l=Math.max(0,Math.min(1,e)),c()):l},e.invertRange=function(e){if(null==e[0]||null==e[1])return;const r=a[1]<a[0],s=r?n().reverse():n(),o=s.length-1;let u,l,c,d=+e[0],h=+e[1];return d!=d||h!=h||(h<d&&(c=d,d=h,h=c),h<s[0]||d>a[1-r])?void 0:(u=Math.max(0,cd(s,d)-1),l=d===h?u:cd(s,h)-1,d-s[u]>i+1e-10&&++u,r&&(c=u,u=o-l,l=o-c),u>l?void 0:t().slice(u,l+1))},e.invert=function(t){const n=e.invertRange([t,t]);return n?n[0]:n},e.copy=function(){return Ep().domain(t()).range(a).round(s).paddingInner(o).paddingOuter(u).align(l)},c()}function Fp(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return Fp(t())},e}var Ip=Array.prototype.map;function Dp(e){return Ip.call(e,Ie)}const Np=Array.prototype.slice,$p={};function Tp(e,t,n){const r=function(){const n=t();return n.invertRange||(n.invertRange=n.invert?(r=n,function(e){let t,n=e[0],i=e[1];return i<n&&(t=n,n=i,i=t),[r.invert(n),r.invert(i)]}):n.invertExtent?function(e){return function(t){const n=e.range();let r,i,a,s,o=t[0],u=t[1],l=-1;for(u<o&&(i=o,o=u,u=i),a=0,s=n.length;a<s;++a)n[a]>=o&&n[a]<=u&&(l<0&&(l=a),r=a);if(!(l<0))return o=e.invertExtent(n[l]),u=e.invertExtent(n[r]),[void 0===o[0]?o[1]:o[0],void 0===u[1]?u[0]:u[1]]}}(n):void 0),n.type=e,n;var r};return r.metadata=Nt(He(n)),r}function Op(e,t,n){return arguments.length>1?($p[e]=Tp(e,t,n),this):Mp(e)?$p[e]:void 0}function Mp(e){return ot($p,e)}function Rp(e,t){const n=$p[e];return n&&n.metadata[t]}function Bp(e){return Rp(e,kp)}function zp(e){return Rp(e,_p)}function Lp(e){return Rp(e,Sp)}function Pp(e){return Rp(e,op)}function jp(e){return Rp(e,Cp)}function Up(e){return Rp(e,gp)}Op("identity",(function e(t){var n;function r(e){return null==e||isNaN(e=+e)?n:e}return r.invert=r,r.domain=r.range=function(e){return arguments.length?(t=Array.from(e,xh),r):t.slice()},r.unknown=function(e){return arguments.length?(n=e,r):n},r.copy=function(){return e(t).unknown(n)},t=arguments.length?Array.from(t,xh):[0,1],Ih(r)})),Op(sp,(function e(){var t=Fh();return t.copy=function(){return Ah(t,e())},fd.apply(t,arguments),Ih(t)}),kp),Op(op,(function e(){var t=Bh(Eh()).domain([1,10]);return t.copy=function(){return Ah(t,e()).base(t.base())},fd.apply(t,arguments),t}),[kp,op]),Op(up,Uh,kp),Op(lp,(function(){return Uh.apply(null,arguments).exponent(.5)}),kp),Op(cp,(function e(){var t=Gh(Eh());return t.copy=function(){return Ah(t,e()).constant(t.constant())},fd.apply(t,arguments)}),kp),Op(dp,(function(){return fd.apply(Zh(Kh,Yh,qn,Xn,Fn,An,Yn,Jn,er,ki).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}),[kp,Ap]),Op(hp,(function(){return fd.apply(Zh(Hh,Xh,ir,sr,zn,Rn,ur,cr,er,Si).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}),[kp,Ap]),Op(fp,nf,[kp,Cp]),Op("".concat(fp,"-").concat(sp),nf,[kp,Cp]),Op("".concat(fp,"-").concat(op),(function e(){var t=Bh(ef()).domain([1,10]);return t.copy=function(){return tf(t,e()).base(t.base())},pd.apply(t,arguments)}),[kp,Cp,op]),Op("".concat(fp,"-").concat(up),rf,[kp,Cp]),Op("".concat(fp,"-").concat(lp),(function(){return rf.apply(null,arguments).exponent(.5)}),[kp,Cp]),Op("".concat(fp,"-").concat(cp),(function e(){var t=Gh(ef());return t.copy=function(){return tf(t,e()).constant(t.constant())},pd.apply(t,arguments)}),[kp,Cp]),Op("".concat(pp,"-").concat(sp),(function e(){var t=Ih(sf()(kh));return t.copy=function(){return tf(t,e())},pd.apply(t,arguments)}),[kp,Cp]),Op("".concat(pp,"-").concat(op),(function e(){var t=Bh(sf()).domain([.1,1,10]);return t.copy=function(){return tf(t,e()).base(t.base())},pd.apply(t,arguments)}),[kp,Cp,op]),Op("".concat(pp,"-").concat(up),of,[kp,Cp]),Op("".concat(pp,"-").concat(lp),(function(){return of.apply(null,arguments).exponent(.5)}),[kp,Cp]),Op("".concat(pp,"-").concat(cp),(function e(){var t=Gh(sf());return t.copy=function(){return tf(t,e()).constant(t.constant())},pd.apply(t,arguments)}),[kp,Cp]),Op(gp,(function e(){var t,n=[],r=[],i=[];function a(){var e=0,t=Math.max(1,r.length);for(i=new Array(t-1);++e<t;)i[e-1]=Co(n,e/t);return s}function s(e){return null==e||isNaN(e=+e)?t:r[hd(i,e)]}return s.invertExtent=function(e){var t=r.indexOf(e);return t<0?[NaN,NaN]:[t>0?i[t-1]:n[0],t<i.length?i[t]:n[n.length-1]]},s.domain=function(e){if(!arguments.length)return n.slice();n=[];for(let t of e)null==t||isNaN(t=+t)||n.push(t);return n.sort(dr),a()},s.range=function(e){return arguments.length?(r=Array.from(e),a()):r.slice()},s.unknown=function(e){return arguments.length?(t=e,s):t},s.quantiles=function(){return i.slice()},s.copy=function(){return e().domain(n).range(r).unknown(t)},fd.apply(s,arguments)}),[Sp,gp]),Op(mp,(function e(){var t,n=0,r=1,i=1,a=[.5],s=[0,1];function o(e){return null!=e&&e<=e?s[hd(a,e,0,i)]:t}function u(){var e=-1;for(a=new Array(i);++e<i;)a[e]=((e+1)*r-(e-i)*n)/(i+1);return o}return o.domain=function(e){return arguments.length?([n,r]=e,n=+n,r=+r,u()):[n,r]},o.range=function(e){return arguments.length?(i=(s=Array.from(e)).length-1,u()):s.slice()},o.invertExtent=function(e){var t=s.indexOf(e);return t<0?[NaN,NaN]:t<1?[n,a[0]]:t>=i?[a[i-1],r]:[a[t-1],a[t]]},o.unknown=function(e){return arguments.length?(t=e,o):o},o.thresholds=function(){return a.slice()},o.copy=function(){return e().domain([n,r]).range(s).unknown(t)},fd.apply(Ih(o),arguments)}),Sp),Op(yp,(function e(){var t,n=[.5],r=[0,1],i=1;function a(e){return null!=e&&e<=e?r[hd(n,e,0,i)]:t}return a.domain=function(e){return arguments.length?(n=Array.from(e),i=Math.min(n.length,r.length-1),a):n.slice()},a.range=function(e){return arguments.length?(r=Array.from(e),i=Math.min(n.length,r.length-1),a):r.slice()},a.invertExtent=function(e){var t=r.indexOf(e);return[n[t-1],n[t]]},a.unknown=function(e){return arguments.length?(t=e,a):t},a.copy=function(){return e().domain(n).range(r).unknown(t)},fd.apply(a,arguments)}),Sp),Op(wp,(function e(){let t=[],n=[];function r(e){return null==e||e!=e?void 0:n[(hd(t,e)-1)%n.length]}return r.domain=function(e){return arguments.length?(t=Dp(e),r):t.slice()},r.range=function(e){return arguments.length?(n=Np.call(e),r):n.slice()},r.tickFormat=function(e,n){return vd(t[0],Fe(t),null==e?10:e,n)},r.copy=function(){return e().domain(r.domain()).range(r.range())},r}),[_p,Sp]),Op(vp,md,_p),Op(xp,Ep,_p),Op(bp,(function(){return Fp(Ep().paddingInner(1))}),_p);const Wp=["clamp","base","constant","exponent"];function Vp(e,t){const n=t[0],r=Fe(t)-n;return function(t){return e(n+t*r)}}function Gp(e,t,n){return af(Xp(t||"rgb",n),e)}function qp(e,t){const n=new Array(t),r=t+1;for(let i=0;i<t;)n[i]=e(++i/r);return n}function Hp(e,t,n){const r=n-t;let i,a,s;return r&&Number.isFinite(r)?(i=(a=e.type).indexOf("-"),a=i<0?a:a.slice(i+1),s=Op(a)().domain([t,n]).range([0,1]),Wp.forEach((t=>e[t]?s[t](e[t]()):0)),s):tt(.5)}function Xp(e,t){const n=s[function(e){return"interpolate"+e.toLowerCase().split("-").map((e=>e[0].toUpperCase()+e.slice(1))).join("")}(e)];return null!=t&&n&&n.gamma?n.gamma(t):n}function Kp(e){const t=e.length/6|0,n=new Array(t);for(let r=0;r<t;)n[r]="#"+e.slice(6*r,6*++r);return n}function Yp(e,t){for(const n in e)Jp(n,t(e[n]))}const Qp={};function Jp(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(Qp[e]=t,this):Qp[e]}Yp({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},Kp),Yp({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},(e=>Gp(Kp(e))));const Zp="symbol",eg=e=>ke(e)?e.map((e=>String(e))):String(e),tg=(e,t)=>e[1]-t[1],ng=(e,t)=>t[1]-e[1];function rg(e,t,n){let r;return mt(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),null!=n&&(t=Math.min(t,Math.floor(Ct(e.domain())/n||1)))),_e(t)&&(r=t.step,t=t.interval),vt(t)&&(t=e.type===dp?Zr(t):e.type==hp?ei(t):se("Only time and utc scales accept interval strings."),r&&(t=t.every(r))),t}function ig(e,t,n){let r=e.range(),i=r[0],a=Fe(r),s=tg;if(i>a&&(r=a,a=i,i=r,s=ng),i=Math.floor(i),a=Math.ceil(a),t=t.map((t=>[t,e(t)])).filter((e=>i<=e[1]&&e[1]<=a)).sort(s).map((e=>e[0])),n>0&&t.length>1){const e=[t[0],Fe(t)];for(;t.length>n&&t.length>=3;)t=t.filter(((e,t)=>!(t%2)));t.length<3&&(t=e)}return t}function ag(e,t){return e.bins?ig(e,e.bins):e.ticks?e.ticks(t):e.domain()}function sg(e,t,n,r,i,a){const s=t.type;let o=eg;if(s===dp||i===dp)o=e.timeFormat(r);else if(s===hp||i===hp)o=e.utcFormat(r);else if(Pp(s)){const i=e.formatFloat(r);if(a||t.bins)o=i;else{const e=og(t,n,!1);o=t=>e(t)?i(t):""}}else if(t.tickFormat){const i=t.domain();o=e.formatSpan(i[0],i[i.length-1],n,r)}else r&&(o=e.format(r));return o}function og(e,t,n){const r=ag(e,t),i=e.base(),a=Math.log(i),s=Math.max(1,i*t/r.length),o=e=>{let t=e/Math.pow(i,Math.round(Math.log(e)/a));return t*i<i-.5&&(t*=i),t<=s};return n?r.filter(o):o}const ug={[gp]:"quantiles",[mp]:"thresholds",[yp]:"domain"},lg={[gp]:"quantiles",[mp]:"domain"};function cg(e,t){return e.bins?function(e){const t=e.slice(0,-1);return t.max=Fe(e),t}(e.bins):e.type===op?og(e,t,!0):ug[e.type]?function(e){const t=[-1/0].concat(e);return t.max=1/0,t}(e[ug[e.type]]()):ag(e,t)}function dg(e,t,n,r,i,a,s){const o=lg[t.type]&&a!==dp&&a!==hp?function(e,t,n){const r=t[lg[t.type]](),i=r.length;let a,s=i>1?r[1]-r[0]:r[0];for(a=1;a<i;++a)s=Math.min(s,r[a]-r[a-1]);return e.formatSpan(0,s,30,n)}(e,t,i):sg(e,t,n,i,a,s);return r===Zp&&(e=>ug[e.type]||e.bins)(t)?hg(o):"discrete"===r?pg(o):gg(o)}const hg=e=>(t,n,r)=>{const i=fg(r[n+1],fg(r.max,1/0)),a=mg(t,e),s=mg(i,e);return a&&s?a+"  "+s:s?"< "+s:" "+a},fg=(e,t)=>null!=e?e:t,pg=e=>(t,n)=>n?e(t):null,gg=e=>t=>e(t),mg=(e,t)=>Number.isFinite(e)?t(e):null;function yg(e,t,n){n=n||{};const r=Math.max(3,n.maxlen||7),i=function(e,t,n,r){const i=r||t.type;return vt(n)&&function(e){return Rp(e,Ap)}(i)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||i!==dp?n||i!==hp?dg(e,t,5,null,n,r,!0):e.utcFormat("%A, %d %B %Y, %X UTC"):e.timeFormat("%A, %d %B %Y, %X")}(e,t,n.format,n.formatType);if(Lp(t.type)){const e=cg(t).slice(1).map(i),n=e.length;return"".concat(n," boundar").concat(1===n?"y":"ies",": ").concat(e.join(", "))}if(zp(t.type)){const e=t.domain(),n=e.length,a=n>r?e.slice(0,r-2).map(i).join(", ")+", ending with "+e.slice(-1).map(i):e.map(i).join(", ");return"".concat(n," value").concat(1===n?"":"s",": ").concat(a)}{const e=t.domain();return"values from ".concat(i(e[0])," to ").concat(i(Fe(e)))}}let vg=0;const bg="p_";function xg(e){return e&&e.gradient}function wg(e,t,n){const r=e.gradient;let i=e.id,a="radial"===r?bg:"";return i||(i=e.id="gradient_"+vg++,"radial"===r?(e.x1=kg(e.x1,.5),e.y1=kg(e.y1,.5),e.r1=kg(e.r1,0),e.x2=kg(e.x2,.5),e.y2=kg(e.y2,.5),e.r2=kg(e.r2,.5),a=bg):(e.x1=kg(e.x1,0),e.y1=kg(e.y1,0),e.x2=kg(e.x2,1),e.y2=kg(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+a+i+")"}function kg(e,t){return null!=e?e:t}function _g(e,t){var n,r=[];return n={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:r,stop:function(e,t){return r.push({offset:e,color:t}),n}}}const Sg={basis:{curve:function(e){return new Xl(e)}},"basis-closed":{curve:function(e){return new Yl(e)}},"basis-open":{curve:function(e){return new Ql(e)}},bundle:{curve:Zl,tension:"beta",value:.85},cardinal:{curve:nc,tension:"tension",value:0},"cardinal-open":{curve:ic,tension:"tension",value:0},"cardinal-closed":{curve:sc,tension:"tension",value:0},"catmull-rom":{curve:kc,tension:"alpha",value:.5},"catmull-rom-closed":{curve:Sc,tension:"alpha",value:.5},"catmull-rom-open":{curve:Ac,tension:"alpha",value:.5},linear:{curve:Fc},"linear-closed":{curve:function(e){return new Ic(e)}},monotone:{horizontal:function(e){return new Mc(e)},vertical:function(e){return new Oc(e)}},natural:{curve:function(e){return new Bc(e)}},step:{curve:function(e){return new Lc(e,.5)}},"step-after":{curve:function(e){return new Lc(e,1)}},"step-before":{curve:function(e){return new Lc(e,0)}}};function Cg(e,t,n){var r=ot(Sg,e)&&Sg[e],i=null;return r&&(i=r.curve||r[t||"vertical"],r.tension&&null!=n&&(i=i[r.tension](n))),i}const Ag={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},Eg=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function Fg(e){const t=[];let n,r,i,a,s,o,u,l,c,d;const h=e.slice().replace(Eg[0],"###$1").split(Eg[1]).slice(1);for(u=0,c=h.length;u<c;++u){for(n=h[u],r=n.slice(1).trim().replace(Eg[2],"$1###$2").replace(Eg[3],"$1###$2").split(Eg[4]),s=n.charAt(0),i=[s],l=0,d=r.length;l<d;++l)(a=+r[l])===a&&i.push(a);if(o=Ag[s.toLowerCase()],i.length-1>o){const e=i.length;for(l=1,t.push([s].concat(i.slice(l,l+=o))),s="M"===s?"L":"m"===s?"l":s;l<e;l+=o)t.push([s].concat(i.slice(l,l+o)))}else t.push(i)}return t}const Ig=Math.PI/180,Dg=Math.PI/2,Ng=2*Math.PI,$g=Math.sqrt(3)/2;var Tg={},Og={},Mg=[].join;function Rg(e){const t=Mg.call(e);if(Og[t])return Og[t];var n=e[0],r=e[1],i=e[2],a=e[3],s=e[4],o=e[5],u=e[6],l=e[7];const c=l*s,d=-u*o,h=u*s,f=l*o,p=Math.cos(i),g=Math.sin(i),m=Math.cos(a),y=Math.sin(a),v=.5*(a-i),b=Math.sin(.5*v),x=8/3*b*b/Math.sin(v),w=n+p-x*g,k=r+g+x*p,_=n+m,S=r+y,C=_+x*y,A=S-x*m;return Og[t]=[c*w+d*k,h*w+f*k,c*C+d*A,h*C+f*A,c*_+d*S,h*_+f*S]}const Bg=["l",0,0,0,0,0,0,0];function zg(e,t,n){const r=Bg[0]=e[0];if("a"===r||"A"===r)Bg[1]=t*e[1],Bg[2]=n*e[2],Bg[3]=e[3],Bg[4]=e[4],Bg[5]=e[5],Bg[6]=t*e[6],Bg[7]=n*e[7];else if("h"===r||"H"===r)Bg[1]=t*e[1];else if("v"===r||"V"===r)Bg[1]=n*e[1];else for(var i=1,a=e.length;i<a;++i)Bg[i]=(i%2==1?t:n)*e[i];return Bg}function Lg(e,t,n,r,i,a){var s,o,u,l,c,d=null,h=0,f=0,p=0,g=0;null==n&&(n=0),null==r&&(r=0),null==i&&(i=1),null==a&&(a=i),e.beginPath&&e.beginPath();for(var m=0,y=t.length;m<y;++m){switch(s=t[m],1===i&&1===a||(s=zg(s,i,a)),s[0]){case"l":h+=s[1],f+=s[2],e.lineTo(h+n,f+r);break;case"L":h=s[1],f=s[2],e.lineTo(h+n,f+r);break;case"h":h+=s[1],e.lineTo(h+n,f+r);break;case"H":h=s[1],e.lineTo(h+n,f+r);break;case"v":f+=s[1],e.lineTo(h+n,f+r);break;case"V":f=s[1],e.lineTo(h+n,f+r);break;case"m":h+=s[1],f+=s[2],e.moveTo(h+n,f+r);break;case"M":h=s[1],f=s[2],e.moveTo(h+n,f+r);break;case"c":o=h+s[5],u=f+s[6],p=h+s[3],g=f+s[4],e.bezierCurveTo(h+s[1]+n,f+s[2]+r,p+n,g+r,o+n,u+r),h=o,f=u;break;case"C":h=s[5],f=s[6],p=s[3],g=s[4],e.bezierCurveTo(s[1]+n,s[2]+r,p+n,g+r,h+n,f+r);break;case"s":o=h+s[3],u=f+s[4],p=2*h-p,g=2*f-g,e.bezierCurveTo(p+n,g+r,h+s[1]+n,f+s[2]+r,o+n,u+r),p=h+s[1],g=f+s[2],h=o,f=u;break;case"S":o=s[3],u=s[4],p=2*h-p,g=2*f-g,e.bezierCurveTo(p+n,g+r,s[1]+n,s[2]+r,o+n,u+r),h=o,f=u,p=s[1],g=s[2];break;case"q":o=h+s[3],u=f+s[4],p=h+s[1],g=f+s[2],e.quadraticCurveTo(p+n,g+r,o+n,u+r),h=o,f=u;break;case"Q":o=s[3],u=s[4],e.quadraticCurveTo(s[1]+n,s[2]+r,o+n,u+r),h=o,f=u,p=s[1],g=s[2];break;case"t":o=h+s[1],u=f+s[2],null===d[0].match(/[QqTt]/)?(p=h,g=f):"t"===d[0]?(p=2*h-l,g=2*f-c):"q"===d[0]&&(p=2*h-p,g=2*f-g),l=p,c=g,e.quadraticCurveTo(p+n,g+r,o+n,u+r),f=u,p=(h=o)+s[1],g=f+s[2];break;case"T":o=s[1],u=s[2],p=2*h-p,g=2*f-g,e.quadraticCurveTo(p+n,g+r,o+n,u+r),h=o,f=u;break;case"a":Pg(e,h+n,f+r,[s[1],s[2],s[3],s[4],s[5],s[6]+h+n,s[7]+f+r]),h+=s[6],f+=s[7];break;case"A":Pg(e,h+n,f+r,[s[1],s[2],s[3],s[4],s[5],s[6]+n,s[7]+r]),h=s[6],f=s[7];break;case"z":case"Z":e.closePath()}d=s}}function Pg(e,t,n,r){const i=function(e,t,n,r,i,a,s,o,u){const l=Mg.call(arguments);if(Tg[l])return Tg[l];const c=s*Ig,d=Math.sin(c),h=Math.cos(c),f=h*(o-e)*.5+d*(u-t)*.5,p=h*(u-t)*.5-d*(o-e)*.5;let g=f*f/((n=Math.abs(n))*n)+p*p/((r=Math.abs(r))*r);g>1&&(g=Math.sqrt(g),n*=g,r*=g);const m=h/n,y=d/n,v=-d/r,b=h/r,x=m*o+y*u,w=v*o+b*u,k=m*e+y*t,_=v*e+b*t;let S=1/((k-x)*(k-x)+(_-w)*(_-w))-.25;S<0&&(S=0);let C=Math.sqrt(S);a==i&&(C=-C);const A=.5*(x+k)-C*(_-w),E=.5*(w+_)+C*(k-x),F=Math.atan2(w-E,x-A);let I=Math.atan2(_-E,k-A)-F;I<0&&1===a?I+=Ng:I>0&&0===a&&(I-=Ng);const D=Math.ceil(Math.abs(I/(Dg+.001))),N=[];for(let e=0;e<D;++e){const t=F+e*I/D,i=F+(e+1)*I/D;N[e]=[A,E,t,i,n,r,d,h]}return Tg[l]=N}(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(let t=0;t<i.length;++t){const n=Rg(i[t]);e.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5])}}const jg=.5773502691896257,Ug={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,Ng)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r),e.lineTo(-n,r),e.lineTo(-r,r),e.lineTo(-r,n),e.lineTo(r,n),e.lineTo(r,r),e.lineTo(n,r),e.lineTo(n,-r),e.lineTo(r,-r),e.lineTo(r,-n),e.lineTo(-r,-n),e.lineTo(-r,-r),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/7,i=n/2.5,a=n/8;e.moveTo(-r,n),e.lineTo(r,n),e.lineTo(r,-a),e.lineTo(i,-a),e.lineTo(0,-n),e.lineTo(-i,-a),e.lineTo(-r,-a),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,r=$g*n,i=r-n*jg,a=n/4;e.moveTo(0,-r-i),e.lineTo(-a,r-i),e.lineTo(a,r-i),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,r=$g*n,i=r-n*jg;e.moveTo(0,-r-i),e.lineTo(-n,r-i),e.lineTo(n,r-i),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=$g*n;e.moveTo(0,-r),e.lineTo(-n,r),e.lineTo(n,r),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=$g*n;e.moveTo(0,r),e.lineTo(-n,-r),e.lineTo(n,-r),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=$g*n;e.moveTo(r,0),e.lineTo(-r,-n),e.lineTo(-r,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=$g*n;e.moveTo(-r,0),e.lineTo(r,-n),e.lineTo(r,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function Wg(e){return ot(Ug,e)?Ug[e]:function(e){if(!ot(Vg,e)){const t=Fg(e);Vg[e]={draw:function(e,n){Lg(e,t,0,0,Math.sqrt(n)/2)}}}return Vg[e]}(e)}var Vg={};const Gg=.448084975506;function qg(e){return e.x}function Hg(e){return e.y}function Xg(e){return e.width}function Kg(e){return e.height}function Yg(e){return"function"==typeof e?e:()=>+e}function Qg(e,t,n){return Math.max(t,Math.min(e,n))}function Jg(){var e=qg,t=Hg,n=Xg,r=Kg,i=Yg(0),a=i,s=i,o=i,u=null;function l(l,c,d){var h,f=null!=c?c:+e.call(this,l),p=null!=d?d:+t.call(this,l),g=+n.call(this,l),m=+r.call(this,l),y=Math.min(g,m)/2,v=Qg(+i.call(this,l),0,y),b=Qg(+a.call(this,l),0,y),x=Qg(+s.call(this,l),0,y),w=Qg(+o.call(this,l),0,y);if(u||(u=h=qc()),v<=0&&b<=0&&x<=0&&w<=0)u.rect(f,p,g,m);else{var k=f+g,_=p+m;u.moveTo(f+v,p),u.lineTo(k-b,p),u.bezierCurveTo(k-Gg*b,p,k,p+Gg*b,k,p+b),u.lineTo(k,_-w),u.bezierCurveTo(k,_-Gg*w,k-Gg*w,_,k-w,_),u.lineTo(f+x,_),u.bezierCurveTo(f+Gg*x,_,f,_-Gg*x,f,_-x),u.lineTo(f,p+v),u.bezierCurveTo(f,p+Gg*v,f+Gg*v,p,f+v,p),u.closePath()}if(h)return u=null,h+""||null}return l.x=function(t){return arguments.length?(e=Yg(t),l):e},l.y=function(e){return arguments.length?(t=Yg(e),l):t},l.width=function(e){return arguments.length?(n=Yg(e),l):n},l.height=function(e){return arguments.length?(r=Yg(e),l):r},l.cornerRadius=function(e,t,n,r){return arguments.length?(i=Yg(e),a=null!=t?Yg(t):i,o=null!=n?Yg(n):i,s=null!=r?Yg(r):a,l):i},l.context=function(e){return arguments.length?(u=null==e?null:e,l):u},l}function Zg(){var e,t,n,r,i,a,s,o,u=null;function l(e,t,n){const r=n/2;if(i){var l=s-t,c=e-a;if(l||c){var d=Math.sqrt(l*l+c*c),h=(l/=d)*o,f=(c/=d)*o,p=Math.atan2(c,l);u.moveTo(a-h,s-f),u.lineTo(e-l*r,t-c*r),u.arc(e,t,r,p-Math.PI,p),u.lineTo(a+h,s+f),u.arc(a,s,o,p,p+Math.PI)}else u.arc(e,t,r,0,Ng);u.closePath()}else i=1;a=e,s=t,o=r}function c(a){var s,o,c,d=a.length,h=!1;for(null==u&&(u=c=qc()),s=0;s<=d;++s)!(s<d&&r(o=a[s],s,a))===h&&(h=!h)&&(i=0),h&&l(+e(o,s,a),+t(o,s,a),+n(o,s,a));if(c)return u=null,c+""||null}return c.x=function(t){return arguments.length?(e=t,c):e},c.y=function(e){return arguments.length?(t=e,c):t},c.size=function(e){return arguments.length?(n=e,c):n},c.defined=function(e){return arguments.length?(r=e,c):r},c.context=function(e){return arguments.length?(u=null==e?null:e,c):u},c}function em(e,t){return null!=e?e:t}const tm=e=>e.x||0,nm=e=>e.y||0,rm=e=>!(!1===e.defined),im=function(){var e=Xc,t=Kc,n=Hc(0),r=null,i=Yc,a=Qc,s=Jc,o=null;function u(){var u,l,c=+e.apply(this,arguments),d=+t.apply(this,arguments),h=i.apply(this,arguments)-mc,f=a.apply(this,arguments)-mc,p=oc(f-h),g=f>h;if(o||(o=u=qc()),d<c&&(l=d,d=c,c=l),d>pc)if(p>yc-pc)o.moveTo(d*lc(h),d*hc(h)),o.arc(0,0,d,h,f,!g),c>pc&&(o.moveTo(c*lc(f),c*hc(f)),o.arc(0,0,c,f,h,g));else{var m,y,v=h,b=f,x=h,w=f,k=p,_=p,S=s.apply(this,arguments)/2,C=S>pc&&(r?+r.apply(this,arguments):fc(c*c+d*d)),A=dc(oc(d-c)/2,+n.apply(this,arguments)),E=A,F=A;if(C>pc){var I=bc(C/c*hc(S)),D=bc(C/d*hc(S));(k-=2*I)>pc?(x+=I*=g?1:-1,w-=I):(k=0,x=w=(h+f)/2),(_-=2*D)>pc?(v+=D*=g?1:-1,b-=D):(_=0,v=b=(h+f)/2)}var N=d*lc(v),$=d*hc(v),T=c*lc(w),O=c*hc(w);if(A>pc){var M,R=d*lc(b),B=d*hc(b),z=c*lc(x),L=c*hc(x);if(p<gc&&(M=Zc(N,$,z,L,R,B,T,O))){var P=N-M[0],j=$-M[1],U=R-M[0],W=B-M[1],V=1/hc(vc((P*U+j*W)/(fc(P*P+j*j)*fc(U*U+W*W)))/2),G=fc(M[0]*M[0]+M[1]*M[1]);E=dc(A,(c-G)/(V-1)),F=dc(A,(d-G)/(V+1))}}_>pc?F>pc?(m=ed(z,L,N,$,d,F,g),y=ed(R,B,T,O,d,F,g),o.moveTo(m.cx+m.x01,m.cy+m.y01),F<A?o.arc(m.cx,m.cy,F,uc(m.y01,m.x01),uc(y.y01,y.x01),!g):(o.arc(m.cx,m.cy,F,uc(m.y01,m.x01),uc(m.y11,m.x11),!g),o.arc(0,0,d,uc(m.cy+m.y11,m.cx+m.x11),uc(y.cy+y.y11,y.cx+y.x11),!g),o.arc(y.cx,y.cy,F,uc(y.y11,y.x11),uc(y.y01,y.x01),!g))):(o.moveTo(N,$),o.arc(0,0,d,v,b,!g)):o.moveTo(N,$),c>pc&&k>pc?E>pc?(m=ed(T,O,R,B,c,-E,g),y=ed(N,$,z,L,c,-E,g),o.lineTo(m.cx+m.x01,m.cy+m.y01),E<A?o.arc(m.cx,m.cy,E,uc(m.y01,m.x01),uc(y.y01,y.x01),!g):(o.arc(m.cx,m.cy,E,uc(m.y01,m.x01),uc(m.y11,m.x11),!g),o.arc(0,0,c,uc(m.cy+m.y11,m.cx+m.x11),uc(y.cy+y.y11,y.cx+y.x11),g),o.arc(y.cx,y.cy,E,uc(y.y11,y.x11),uc(y.y01,y.x01),!g))):o.arc(0,0,c,w,x,g):o.lineTo(T,O)}else o.moveTo(0,0);if(o.closePath(),u)return o=null,u+""||null}return u.centroid=function(){var n=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,r=(+i.apply(this,arguments)+ +a.apply(this,arguments))/2-gc/2;return[lc(r)*n,hc(r)*n]},u.innerRadius=function(t){return arguments.length?(e="function"==typeof t?t:Hc(+t),u):e},u.outerRadius=function(e){return arguments.length?(t="function"==typeof e?e:Hc(+e),u):t},u.cornerRadius=function(e){return arguments.length?(n="function"==typeof e?e:Hc(+e),u):n},u.padRadius=function(e){return arguments.length?(r=null==e?null:"function"==typeof e?e:Hc(+e),u):r},u.startAngle=function(e){return arguments.length?(i="function"==typeof e?e:Hc(+e),u):i},u.endAngle=function(e){return arguments.length?(a="function"==typeof e?e:Hc(+e),u):a},u.padAngle=function(e){return arguments.length?(s="function"==typeof e?e:Hc(+e),u):s},u.context=function(e){return arguments.length?(o=null==e?null:e,u):o},u}().startAngle((e=>e.startAngle||0)).endAngle((e=>e.endAngle||0)).padAngle((e=>e.padAngle||0)).innerRadius((e=>e.innerRadius||0)).outerRadius((e=>e.outerRadius||0)).cornerRadius((e=>e.cornerRadius||0)),am=ad().x(tm).y1(nm).y0((e=>(e.y||0)+(e.height||0))).defined(rm),sm=ad().y(nm).x1(tm).x0((e=>(e.x||0)+(e.width||0))).defined(rm),om=id().x(tm).y(nm).defined(rm),um=Jg().x(tm).y(nm).width((e=>e.width||0)).height((e=>e.height||0)).cornerRadius((e=>em(e.cornerRadiusTopLeft,e.cornerRadius)||0),(e=>em(e.cornerRadiusTopRight,e.cornerRadius)||0),(e=>em(e.cornerRadiusBottomRight,e.cornerRadius)||0),(e=>em(e.cornerRadiusBottomLeft,e.cornerRadius)||0)),lm=function(e,t){var n=null;function r(){var r;if(n||(n=r=qc()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),r)return n=null,r+""||null}return e="function"==typeof e?e:Hc(e||sd),t="function"==typeof t?t:Hc(void 0===t?64:+t),r.type=function(t){return arguments.length?(e="function"==typeof t?t:Hc(t),r):e},r.size=function(e){return arguments.length?(t="function"==typeof e?e:Hc(+e),r):t},r.context=function(e){return arguments.length?(n=null==e?null:e,r):n},r}().type((e=>Wg(e.shape||"circle"))).size((e=>em(e.size,64))),cm=Zg().x(tm).y(nm).defined(rm).size((e=>e.size||1));function dm(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function hm(e,t,n,r){return um.context(e)(t,n,r)}var fm=1;function pm(){fm=1}function gm(e,t,n){var r=t.clip,i=e._defs,a=t.clip_id||(t.clip_id="clip"+fm++),s=i.clipping[a]||(i.clipping[a]={id:a});return Ke(r)?s.path=r(null):dm(n)?s.path=hm(null,n,0,0):(s.width=n.width||0,s.height=n.height||0),"url(#"+a+")"}function mm(e){this.clear(),e&&this.union(e)}function ym(e){this.mark=e,this.bounds=this.bounds||new mm}function vm(e){ym.call(this,e),this.items=this.items||[]}function bm(e){this._pending=0,this._loader=e||Ds()}function xm(e){e._pending+=1}function wm(e){e._pending-=1}function km(e,t,n){if(t.stroke&&0!==t.opacity&&0!==t.strokeOpacity){const r=null!=t.strokeWidth?+t.strokeWidth:1;e.expand(r+(n?function(e,t){return e.strokeJoin&&"miter"!==e.strokeJoin?0:t}(t,r):0))}return e}mm.prototype={clone(){return new mm(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,r){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),r<t?(this.y2=t,this.y1=r):(this.y1=t,this.y2=r),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const r=this.rotatedPoints(e,t,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints(e,t,n){var{x1:r,y1:i,x2:a,y2:s}=this,o=Math.cos(e),u=Math.sin(e),l=t-t*o+n*u,c=n-t*u-n*o;return[o*r-u*i+l,u*r+o*i+c,o*r-u*s+l,u*r+o*s+c,o*a-u*i+l,u*a+o*i+c,o*a-u*s+l,u*a+o*s+c]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}},dt(vm,ym),bm.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return xm(t),t._loader.sanitize(e,{context:"href"}).then((e=>(wm(t),e))).catch((()=>(wm(t),null)))},loadImage(e){const t=this,n=ud();return xm(t),t._loader.sanitize(e,{context:"image"}).then((e=>{const r=e.href;if(!r||!n)throw{url:r};const i=new n,a=ot(e,"crossOrigin")?e.crossOrigin:"anonymous";return null!=a&&(i.crossOrigin=a),i.onload=()=>wm(t),i.onerror=()=>wm(t),i.src=r,i})).catch((e=>(wm(t),{complete:!1,width:0,height:0,src:e&&e.url||""})))},ready(){const e=this;return new Promise((t=>{!function n(r){e.pending()?setTimeout((()=>{n(!0)}),10):t(r)}(!1)}))}};const _m=Ng-1e-8;let Sm,Cm,Am,Em,Fm,Im,Dm,Nm;const $m=(e,t)=>Sm.add(e,t),Tm=(e,t)=>$m(Cm=e,Am=t),Om=e=>$m(e,Sm.y1),Mm=e=>$m(Sm.x1,e),Rm=(e,t)=>Fm*e+Dm*t,Bm=(e,t)=>Im*e+Nm*t,zm=(e,t)=>$m(Rm(e,t),Bm(e,t)),Lm=(e,t)=>Tm(Rm(e,t),Bm(e,t));function Pm(e,t){return Sm=e,t?(Em=t*Ig,Fm=Nm=Math.cos(Em),Im=Math.sin(Em),Dm=-Im):(Fm=Nm=1,Em=Im=Dm=0),jm}const jm={beginPath(){},closePath(){},moveTo:Lm,lineTo:Lm,rect(e,t,n,r){Em?(zm(e+n,t),zm(e+n,t+r),zm(e,t+r),Lm(e,t)):($m(e+n,t+r),Tm(e,t))},quadraticCurveTo(e,t,n,r){const i=Rm(e,t),a=Bm(e,t),s=Rm(n,r),o=Bm(n,r);Um(Cm,i,s,Om),Um(Am,a,o,Mm),Tm(s,o)},bezierCurveTo(e,t,n,r,i,a){const s=Rm(e,t),o=Bm(e,t),u=Rm(n,r),l=Bm(n,r),c=Rm(i,a),d=Bm(i,a);Wm(Cm,s,u,c,Om),Wm(Am,o,l,d,Mm),Tm(c,d)},arc(e,t,n,r,i,a){if(r+=Em,i+=Em,Cm=n*Math.cos(i)+e,Am=n*Math.sin(i)+t,Math.abs(i-r)>_m)$m(e-n,t-n),$m(e+n,t+n);else{const s=r=>$m(n*Math.cos(r)+e,n*Math.sin(r)+t);let o,u;if(s(r),s(i),i!==r)if((r%=Ng)<0&&(r+=Ng),(i%=Ng)<0&&(i+=Ng),i<r&&(a=!a,o=r,r=i,i=o),a)for(i-=Ng,o=r-r%Dg,u=0;u<4&&o>i;++u,o-=Dg)s(o);else for(o=r-r%Dg+Dg,u=0;u<4&&o<i;++u,o+=Dg)s(o)}}};function Um(e,t,n,r){const i=(e-t)/(e+n-2*t);0<i&&i<1&&r(e+(t-e)*i)}function Wm(e,t,n,r,i){const a=r-e+3*t-3*n,s=e+n-2*t,o=e-t;let u,l=0,c=0;Math.abs(a)>1e-14?(u=s*s+o*a,u>=0&&(u=Math.sqrt(u),l=(-s+u)/a,c=(-s-u)/a)):l=.5*o/s,0<l&&l<1&&i(Vm(l,e,t,n,r)),0<c&&c<1&&i(Vm(c,e,t,n,r))}function Vm(e,t,n,r,i){const a=1-e,s=a*a,o=e*e;return s*a*t+3*s*e*n+3*a*o*r+o*e*i}var Gm=(Gm=od(1,1))?Gm.getContext("2d"):null;const qm=new mm;function Hm(e){return function(t,n){if(!Gm)return!0;e(Gm,t),qm.clear().union(t.bounds).intersect(n).round();const{x1:r,y1:i,x2:a,y2:s}=qm;for(let e=i;e<=s;++e)for(let t=r;t<=a;++t)if(Gm.isPointInPath(t,e))return!0;return!1}}function Xm(e,t){return t.contains(e.x||0,e.y||0)}function Km(e,t){const n=e.x||0,r=e.y||0,i=e.width||0,a=e.height||0;return t.intersects(qm.set(n,r,n+i,r+a))}function Ym(e,t){const n=e.x||0,r=e.y||0;return Qm(t,n,r,null!=e.x2?e.x2:n,null!=e.y2?e.y2:r)}function Qm(e,t,n,r,i){const{x1:a,y1:s,x2:o,y2:u}=e,l=r-t,c=i-n;let d,h,f,p,g=0,m=1;for(p=0;p<4;++p){if(0===p&&(d=-l,h=-(a-t)),1===p&&(d=l,h=o-t),2===p&&(d=-c,h=-(s-n)),3===p&&(d=c,h=u-n),Math.abs(d)<1e-10&&h<0)return!1;if(f=h/d,d<0){if(f>m)return!1;f>g&&(g=f)}else if(d>0){if(f<g)return!1;f<m&&(m=f)}}return!0}function Jm(e,t){e.globalCompositeOperation=t.blend||"source-over"}function Zm(e,t){return null==e?t:e}function ey(e,t){const n=t.length;for(let r=0;r<n;++r)e.addColorStop(t[r].offset,t[r].color);return e}function ty(e,t,n){return xg(n)?function(e,t,n){const r=n.width(),i=n.height();let a;if("radial"===t.gradient)a=e.createRadialGradient(n.x1+Zm(t.x1,.5)*r,n.y1+Zm(t.y1,.5)*i,Math.max(r,i)*Zm(t.r1,0),n.x1+Zm(t.x2,.5)*r,n.y1+Zm(t.y2,.5)*i,Math.max(r,i)*Zm(t.r2,.5));else{const s=Zm(t.x1,0),o=Zm(t.y1,0),u=Zm(t.x2,1),l=Zm(t.y2,0);if(s!==u&&o!==l&&r!==i){const n=od(Math.ceil(r),Math.ceil(i)),a=n.getContext("2d");return a.scale(r,i),a.fillStyle=ey(a.createLinearGradient(s,o,u,l),t.stops),a.fillRect(0,0,r,i),e.createPattern(n,"no-repeat")}a=e.createLinearGradient(n.x1+s*r,n.y1+o*i,n.x1+u*r,n.y1+l*i)}return ey(a,t.stops)}(e,n,t.bounds):n}function ny(e,t,n){return(n*=null==t.fillOpacity?1:t.fillOpacity)>0&&(e.globalAlpha=n,e.fillStyle=ty(e,t,t.fill),!0)}var ry=[];function iy(e,t,n){var r=null!=(r=t.strokeWidth)?r:1;return!(r<=0)&&(n*=null==t.strokeOpacity?1:t.strokeOpacity)>0&&(e.globalAlpha=n,e.strokeStyle=ty(e,t,t.stroke),e.lineWidth=r,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||ry),e.lineDashOffset=t.strokeDashOffset||0),!0)}function ay(e,t){return e.zindex-t.zindex||e.index-t.index}function sy(e){if(!e.zdirty)return e.zitems;var t,n,r,i=e.items,a=[];for(n=0,r=i.length;n<r;++n)(t=i[n]).index=n,t.zindex&&a.push(t);return e.zdirty=!1,e.zitems=a.sort(ay)}function oy(e,t){var n,r,i=e.items;if(!i||!i.length)return;const a=sy(e);if(a&&a.length){for(n=0,r=i.length;n<r;++n)i[n].zindex||t(i[n]);i=a}for(n=0,r=i.length;n<r;++n)t(i[n])}function uy(e,t){var n,r,i=e.items;if(!i||!i.length)return null;const a=sy(e);for(a&&a.length&&(i=a),r=i.length;--r>=0;)if(n=t(i[r]))return n;if(i===a)for(r=(i=e.items).length;--r>=0;)if(!i[r].zindex&&(n=t(i[r])))return n;return null}function ly(e){return function(t,n,r){oy(n,(n=>{r&&!r.intersects(n.bounds)||dy(e,t,n,n)}))}}function cy(e){return function(t,n,r){!n.items.length||r&&!r.intersects(n.bounds)||dy(e,t,n.items[0],n.items)}}function dy(e,t,n,r){var i=null==n.opacity?1:n.opacity;0!==i&&(e(t,r)||(Jm(t,n),n.fill&&ny(t,n,i)&&t.fill(),n.stroke&&iy(t,n,i)&&t.stroke()))}function hy(e){return e=e||fe,function(t,n,r,i,a,s){return r*=t.pixelRatio,i*=t.pixelRatio,uy(n,(n=>{const o=n.bounds;if((!o||o.contains(a,s))&&o)return e(t,n,r,i,a,s)?n:void 0}))}}function fy(e,t){return function(n,r,i,a){var s,o,u=Array.isArray(r)?r[0]:r,l=null==t?u.fill:t,c=u.stroke&&n.isPointInStroke;return c&&(s=u.strokeWidth,o=u.strokeCap,n.lineWidth=null!=s?s:1,n.lineCap=null!=o?o:"butt"),!e(n,r)&&(l&&n.isPointInPath(i,a)||c&&n.isPointInStroke(i,a))}}function py(e){return hy(fy(e))}function gy(e,t){return"translate("+e+","+t+")"}function my(e){return"rotate("+e+")"}function yy(e){return gy(e.x||0,e.y||0)}function vy(e,t,n){function r(e,n){var r=n.x||0,i=n.y||0,a=n.angle||0;e.translate(r,i),a&&e.rotate(a*=Ig),e.beginPath(),t(e,n),a&&e.rotate(-a),e.translate(-r,-i)}return{type:e,tag:"path",nested:!1,attr:function(e,n){e("transform",function(e){return gy(e.x||0,e.y||0)+(e.angle?" "+my(e.angle):"")}(n)),e("d",t(null,n))},bound:function(e,n){return t(Pm(e,n.angle),n),km(e,n).translate(n.x||0,n.y||0)},draw:ly(r),pick:py(r),isect:n||Hm(r)}}var by=vy("arc",(function(e,t){return im.context(e)(t)}));function xy(e,t,n){function r(e,n){e.beginPath(),t(e,n)}const i=fy(r);return{type:e,tag:"path",nested:!0,attr:function(e,n){var r=n.mark.items;r.length&&e("d",t(null,r))},bound:function(e,n){var r=n.items;return 0===r.length?e:(t(Pm(e),r),km(e,r[0]))},draw:cy(r),pick:function(e,t,n,r,a,s){var o=t.items,u=t.bounds;return!o||!o.length||u&&!u.contains(a,s)?null:(n*=e.pixelRatio,r*=e.pixelRatio,i(e,o,n,r)?o[0]:null)},isect:Xm,tip:n}}var wy=xy("area",(function(e,t){const n=t[0],r=n.interpolate||"linear";return("horizontal"===n.orient?sm:am).curve(Cg(r,n.orient,n.tension)).context(e)(t)}),(function(e,t){for(var n,r,i="horizontal"===e[0].orient?t[1]:t[0],a="horizontal"===e[0].orient?"y":"x",s=e.length,o=1/0;--s>=0;)!1!==e[s].defined&&(r=Math.abs(e[s][a]-i))<o&&(o=r,n=e[s]);return n}));function ky(e,t){e.beginPath(),dm(t)?hm(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function _y(e){const t=Zm(e.strokeWidth,1);return null!=e.strokeOffset?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function Sy(e,t){const n=_y(t);e("d",hm(null,t,n,n))}function Cy(e,t,n,r){const i=_y(t);e.beginPath(),hm(e,t,(n||0)+i,(r||0)+i)}const Ay=fy(Cy),Ey=fy(Cy,!1),Fy=fy(Cy,!0);var Iy={type:"group",tag:"g",nested:!1,attr:function(e,t){e("transform",yy(t))},bound:function(e,t){if(!t.clip&&t.items){const n=t.items,r=n.length;for(let t=0;t<r;++t)e.union(n[t].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),km(e,t),e.translate(t.x||0,t.y||0)},draw:function(e,t,n){oy(t,(t=>{const r=t.x||0,i=t.y||0,a=t.strokeForeground,s=null==t.opacity?1:t.opacity;(t.stroke||t.fill)&&s&&(Cy(e,t,r,i),Jm(e,t),t.fill&&ny(e,t,s)&&e.fill(),t.stroke&&!a&&iy(e,t,s)&&e.stroke()),e.save(),e.translate(r,i),t.clip&&ky(e,t),n&&n.translate(-r,-i),oy(t,(t=>{this.draw(e,t,n)})),n&&n.translate(r,i),e.restore(),a&&t.stroke&&s&&(Cy(e,t,r,i),Jm(e,t),iy(e,t,s)&&e.stroke())}))},pick:function(e,t,n,r,i,a){if(t.bounds&&!t.bounds.contains(i,a)||!t.items)return null;const s=n*e.pixelRatio,o=r*e.pixelRatio;return uy(t,(u=>{let l,c,d;const h=u.bounds;if(h&&!h.contains(i,a))return;c=u.x||0,d=u.y||0;const f=c+(u.width||0),p=d+(u.height||0),g=u.clip;if(g&&(i<c||i>f||a<d||a>p))return;if(e.save(),e.translate(c,d),c=i-c,d=a-d,g&&dm(u)&&!Fy(e,u,s,o))return e.restore(),null;const m=u.strokeForeground,y=!1!==t.interactive;return y&&m&&u.stroke&&Ey(e,u,s,o)?(e.restore(),u):(l=uy(u,(e=>function(e,t,n){return(!1!==e.interactive||"group"===e.marktype)&&e.bounds&&e.bounds.contains(t,n)}(e,c,d)?this.pick(e,n,r,c,d):null)),!l&&y&&(u.fill||!m&&u.stroke)&&Ay(e,u,s,o)&&(l=u),e.restore(),l||null)}))},isect:Km,content:function(e,t,n){e("clip-path",t.clip?gm(n,t,t):null)},background:function(e,t){e("class","background"),e("aria-hidden",!0),Sy(e,t)},foreground:function(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?Sy(e,t):e("d","")}},Dy={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function Ny(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then((t=>{e.image=t,e.image.url=e.url}))),n}function $y(e,t){return null!=e.width?e.width:t&&t.width?!1!==e.aspect&&e.height?e.height*t.width/t.height:t.width:0}function Ty(e,t){return null!=e.height?e.height:t&&t.height?!1!==e.aspect&&e.width?e.width*t.height/t.width:t.height:0}function Oy(e,t){return"center"===e?t/2:"right"===e?t:0}function My(e,t){return"middle"===e?t/2:"bottom"===e?t:0}var Ry={type:"image",tag:"image",nested:!1,attr:function(e,t,n){const r=Ny(t,n),i=$y(t,r),a=Ty(t,r),s=(t.x||0)-Oy(t.align,i),o=(t.y||0)-My(t.baseline,a);e("href",!r.src&&r.toDataURL?r.toDataURL():r.src||"",Dy["xmlns:xlink"],"xlink:href"),e("transform",gy(s,o)),e("width",i),e("height",a),e("preserveAspectRatio",!1===t.aspect?"none":"xMidYMid")},bound:function(e,t){const n=t.image,r=$y(t,n),i=Ty(t,n),a=(t.x||0)-Oy(t.align,r),s=(t.y||0)-My(t.baseline,i);return e.set(a,s,a+r,s+i)},draw:function(e,t,n){oy(t,(t=>{if(n&&!n.intersects(t.bounds))return;const r=Ny(t,this);let i=$y(t,r),a=Ty(t,r);if(0===i||0===a)return;let s,o,u,l,c=(t.x||0)-Oy(t.align,i),d=(t.y||0)-My(t.baseline,a);!1!==t.aspect&&(o=r.width/r.height,u=t.width/t.height,o==o&&u==u&&o!==u&&(u<o?(l=i/o,d+=(a-l)/2,a=l):(l=a*o,c+=(i-l)/2,i=l))),(r.complete||r.toDataURL)&&(Jm(e,t),e.globalAlpha=null!=(s=t.opacity)?s:1,e.imageSmoothingEnabled=!1!==t.smooth,e.drawImage(r,c,d,i,a))}))},pick:hy(),isect:fe,get:Ny,xOffset:Oy,yOffset:My},By=xy("line",(function(e,t){const n=t[0],r=n.interpolate||"linear";return om.curve(Cg(r,n.orient,n.tension)).context(e)(t)}),(function(e,t){for(var n,r,i=Math.pow(e[0].strokeWidth||1,2),a=e.length;--a>=0;)if(!1!==e[a].defined&&(n=e[a].x-t[0])*n+(r=e[a].y-t[1])*r<i)return e[a];return null}));function zy(e,t){var n=t.path;if(null==n)return!0;var r=t.x||0,i=t.y||0,a=t.scaleX||1,s=t.scaleY||1,o=(t.angle||0)*Ig,u=t.pathCache;u&&u.path===n||((t.pathCache=u=Fg(n)).path=n),o&&e.rotate&&e.translate?(e.translate(r,i),e.rotate(o),Lg(e,u,0,0,a,s),e.rotate(-o),e.translate(-r,-i)):Lg(e,u,r,i,a,s)}var Ly={type:"path",tag:"path",nested:!1,attr:function(e,t){var n=t.scaleX||1,r=t.scaleY||1;1===n&&1===r||e("vector-effect","non-scaling-stroke"),e("transform",function(e){return gy(e.x||0,e.y||0)+(e.angle?" "+my(e.angle):"")+(e.scaleX||e.scaleY?" "+(t=e.scaleX||1,n=e.scaleY||1,"scale("+t+","+n+")"):"");var t,n}(t)),e("d",t.path)},bound:function(e,t){return zy(Pm(e,t.angle),t)?e.set(0,0,0,0):km(e,t,!0)},draw:ly(zy),pick:py(zy),isect:Hm(zy)};function Py(e,t){e.beginPath(),hm(e,t)}var jy={type:"rect",tag:"path",nested:!1,attr:function(e,t){e("d",hm(null,t))},bound:function(e,t){var n,r;return km(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)},draw:ly(Py),pick:py(Py),isect:Km};function Uy(e,t,n){var r,i,a,s;return!(!t.stroke||!iy(e,t,n)||(r=t.x||0,i=t.y||0,a=null!=t.x2?t.x2:r,s=null!=t.y2?t.y2:i,e.beginPath(),e.moveTo(r,i),e.lineTo(a,s),0))}var Wy={type:"rule",tag:"line",nested:!1,attr:function(e,t){e("transform",yy(t)),e("x2",null!=t.x2?t.x2-(t.x||0):0),e("y2",null!=t.y2?t.y2-(t.y||0):0)},bound:function(e,t){var n,r;return km(e.set(n=t.x||0,r=t.y||0,null!=t.x2?t.x2:n,null!=t.y2?t.y2:r),t)},draw:function(e,t,n){oy(t,(t=>{if(!n||n.intersects(t.bounds)){var r=null==t.opacity?1:t.opacity;r&&Uy(e,t,r)&&(Jm(e,t),e.stroke())}}))},pick:hy((function(e,t,n,r){return!!e.isPointInStroke&&Uy(e,t,1)&&e.isPointInStroke(n,r)})),isect:Ym},Vy=vy("shape",(function(e,t){return(t.mark.shape||t.shape).context(e)(t)})),Gy=vy("symbol",(function(e,t){return lm.context(e)(t)}),Xm);const qy=wt();var Hy={height:Zy,measureWidth:Qy,estimateWidth:Ky,width:Ky,canvas:Xy};function Xy(e){Hy.width=e&&Gm?Qy:Ky}function Ky(e,t){return Yy(rv(e,t),Zy(e))}function Yy(e,t){return~~(.8*e.length*t)}function Qy(e,t){return Zy(e)<=0||!(t=rv(e,t))?0:Jy(t,av(e))}function Jy(e,t){const n=`(${t}) ${e}`;let r=qy.get(n);return void 0===r&&(Gm.font=t,r=Gm.measureText(e).width,qy.set(n,r)),r}function Zy(e){return null!=e.fontSize?+e.fontSize||0:11}function ev(e){return null!=e.lineHeight?e.lineHeight:Zy(e)+2}function tv(e){return t=e.lineBreak&&e.text&&!ke(e.text)?e.text.split(e.lineBreak):e.text,ke(t)?t.length>1?t:t[0]:t;var t}function nv(e){const t=tv(e);return(ke(t)?t.length-1:0)*ev(e)}function rv(e,t){const n=null==t?"":(t+"").trim();return e.limit>0&&n.length?function(e,t){var n=+e.limit,r=function(e){if(Hy.width===Qy){const t=av(e);return e=>Jy(e,t)}{const t=Zy(e);return e=>Yy(e,t)}}(e);if(r(t)<n)return t;var i,a=e.ellipsis||"",s="rtl"===e.dir,o=0,u=t.length;if(n-=r(a),s){for(;o<u;)i=o+u>>>1,r(t.slice(i))>n?o=i+1:u=i;return a+t.slice(o)}for(;o<u;)i=1+(o+u>>>1),r(t.slice(0,i))<n?o=i:u=i-1;return t.slice(0,o)+a}(e,n):n}function iv(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function av(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+Zy(e)+"px "+iv(e,t)}function sv(e){var t=e.baseline,n=Zy(e);return Math.round("top"===t?.79*n:"middle"===t?.3*n:"bottom"===t?-.21*n:"line-top"===t?.29*n+.5*ev(e):"line-bottom"===t?.29*n-.5*ev(e):0)}Xy(!0);const ov={left:"start",center:"middle",right:"end"},uv=new mm;function lv(e){var t,n=e.x||0,r=e.y||0,i=e.radius||0;return i&&(t=(e.theta||0)-Dg,n+=i*Math.cos(t),r+=i*Math.sin(t)),uv.x1=n,uv.y1=r,uv}function cv(e,t,n){var r,i=Hy.height(t),a=t.align,s=lv(t),o=s.x1,u=s.y1,l=t.dx||0,c=(t.dy||0)+sv(t)-Math.round(.8*i),d=tv(t);if(ke(d)?(i+=ev(t)*(d.length-1),r=d.reduce(((e,n)=>Math.max(e,Hy.width(t,n))),0)):r=Hy.width(t,d),"center"===a?l-=r/2:"right"===a&&(l-=r),e.set(l+=o,c+=u,l+r,c+i),t.angle&&!n)e.rotate(t.angle*Ig,o,u);else if(2===n)return e.rotatedPoints(t.angle*Ig,o,u);return e}var dv={type:"text",tag:"text",nested:!1,attr:function(e,t){var n,r=t.dx||0,i=(t.dy||0)+sv(t),a=lv(t),s=a.x1,o=a.y1,u=t.angle||0;e("text-anchor",ov[t.align]||"start"),u?(n=gy(s,o)+" "+my(u),(r||i)&&(n+=" "+gy(r,i))):n=gy(s+r,o+i),e("transform",n)},bound:cv,draw:function(e,t,n){oy(t,(t=>{var r,i,a,s,o,u,l,c=null==t.opacity?1:t.opacity;if(!(n&&!n.intersects(t.bounds)||0===c||t.fontSize<=0||null==t.text||0===t.text.length)){if(e.font=av(t),e.textAlign=t.align||"left",i=(r=lv(t)).x1,a=r.y1,t.angle&&(e.save(),e.translate(i,a),e.rotate(t.angle*Ig),i=a=0),i+=t.dx||0,a+=(t.dy||0)+sv(t),u=tv(t),Jm(e,t),ke(u))for(o=ev(t),s=0;s<u.length;++s)l=rv(t,u[s]),t.fill&&ny(e,t,c)&&e.fillText(l,i,a),t.stroke&&iy(e,t,c)&&e.strokeText(l,i,a),a+=o;else l=rv(t,u),t.fill&&ny(e,t,c)&&e.fillText(l,i,a),t.stroke&&iy(e,t,c)&&e.strokeText(l,i,a);t.angle&&e.restore()}}))},pick:hy((function(e,t,n,r,i,a){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var s=lv(t),o=s.x1,u=s.y1,l=cv(uv,t,1),c=-t.angle*Ig,d=Math.cos(c),h=Math.sin(c),f=d*i-h*a+(o-d*o+h*u),p=h*i+d*a+(u-h*o-d*u);return l.contains(f,p)})),isect:function(e,t){const n=cv(uv,e,2);return Qm(t,n[0],n[1],n[2],n[3])||Qm(t,n[0],n[1],n[4],n[5])||Qm(t,n[4],n[5],n[6],n[7])||Qm(t,n[2],n[3],n[6],n[7])}},hv=xy("trail",(function(e,t){return cm.context(e)(t)}),(function(e,t){for(var n,r,i=e.length;--i>=0;)if(!1!==e[i].defined&&(n=e[i].x-t[0])*n+(r=e[i].y-t[1])*r<(n=e[i].size||1)*n)return e[i];return null})),fv={arc:by,area:wy,group:Iy,image:Ry,line:By,path:Ly,rect:jy,rule:Wy,shape:Vy,symbol:Gy,text:dv,trail:hv};function pv(e,t,n){var r=fv[e.mark.marktype],i=t||r.bound;return r.nested&&(e=e.mark),i(e.bounds||(e.bounds=new mm),e,n)}var gv={mark:null};function mv(e,t,n){var r,i,a,s,o=fv[e.marktype],u=o.bound,l=e.items,c=l&&l.length;if(o.nested)return c?a=l[0]:(gv.mark=e,a=gv),s=pv(a,u,n),t&&t.union(s)||s;if(t=t||e.bounds&&e.bounds.clear()||new mm,c)for(r=0,i=l.length;r<i;++r)t.union(pv(l[r],u,n));return e.bounds=t}const yv=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function vv(e,t){return JSON.stringify(e,yv,t)}function bv(e){return xv("string"==typeof e?JSON.parse(e):e)}function xv(e){var t,n,r,i=e.marktype,a=e.items;if(a)for(n=0,r=a.length;n<r;++n)t=i?"mark":"group",a[n][t]=e,a[n].zindex&&(a[n][t].zdirty=!0),"group"===(i||t)&&xv(a[n]);return i&&mv(e),e}function wv(e){arguments.length?this.root=bv(e):(this.root=kv({marktype:"group",name:"root",role:"frame"}),this.root.items=[new vm(this.root)])}function kv(e,t){const n={bounds:new mm,clip:!!e.clip,group:t,interactive:!1!==e.interactive,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return null!=e.aria&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function _v(e,t,n){return!e&&"undefined"!=typeof document&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function Sv(e,t){t=t.toLowerCase();for(var n=e.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===t)return n[r]}function Cv(e,t,n,r){var i,a=e.childNodes[t];return a&&a.tagName.toLowerCase()===n.toLowerCase()||(i=a||null,a=_v(e.ownerDocument,n,r),e.insertBefore(a,i)),a}function Av(e,t){for(var n=e.childNodes,r=n.length;r>t;)e.removeChild(n[--r]);return e}function Ev(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function Fv(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function Iv(e,t){this._active=null,this._handlers={},this._loader=e||Ds(),this._tooltip=t||Dv}function Dv(e,t,n,r){e.element().setAttribute("title",r||"")}function Nv(e){this._el=null,this._bgcolor=null,this._loader=new bm(e)}wv.prototype={toJSON(e){return vv(this.root,e||0)},mark(e,t,n){const r=kv(e,t=t||this.root.items[0]);return t.items[n]=r,r.zindex&&(r.group.zdirty=!0),r}},Iv.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let r=e?e.length:0;--r>=0;)if(e[r].type===t&&(!n||e[r].handler===n))return r;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const e in t)n.push(...t[e]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then((t=>{const n=new MouseEvent(e.type,e),r=_v(null,"a");for(const e in t)r.setAttribute(e,t[e]);r.dispatchEvent(n)})).catch((()=>{}))},handleTooltip(e,t,n){if(t&&null!=t.tooltip){t=function(e,t,n,r){var i,a,s=e&&e.mark;if(s&&(i=fv[s.marktype]).tip){for((a=Fv(t,n))[0]-=r[0],a[1]-=r[1];e=e.mark.group;)a[0]-=e.x||0,a[1]-=e.y||0;e=i.tip(s.items,a)}return e}(t,e,this.canvas(),this._origin);const r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,a=i.width(),s=i.height();let o=i.x1+r[0]+n.left,u=i.y1+r[1]+n.top;for(;e.mark&&(e=e.mark.group);)o+=e.x||0,u+=e.y||0;return{x:o,y:u,width:a,height:s,left:o,top:u,right:o+a,bottom:u+s}}},Nv.prototype={initialize(e,t,n,r,i){return this._el=e,this.resize(t,n,r,i)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return 0===arguments.length?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,r){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=r||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then((()=>t)):Promise.resolve(t)},_load(e,t){var n=this,r=n._loader[e](t);if(!n._ready){const e=n._call;n._ready=n._loader.ready().then((t=>{t&&e(),n._ready=null}))}return r},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const $v="dragenter",Tv="dragleave",Ov="dragover",Mv="mousedown",Rv="mousemove",Bv="mouseout",zv="mouseover",Lv="click",Pv="mousewheel",jv="touchstart",Uv="touchmove",Wv="touchend",Vv=Rv,Gv=Bv,qv=Lv;function Hv(e,t){Iv.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}function Xv(e,t){(e=>e===jv||e===Uv||e===Wv?[jv,Uv,Wv]:[e])(t).forEach((t=>function(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?n=>e[t](n):n=>e.fire(t,n)))}(e,t)))}function Kv(e,t,n){return function(r){const i=this._active,a=this.pickEvent(r);a===i||(i&&i.exit||this.fire(n,r),this._active=a,this.fire(t,r)),this.fire(e,r)}}function Yv(e){return function(t){this.fire(e,t),this._active=null}}dt(Hv,Iv,{initialize(e,t,n){return this._canvas=e&&Sv(e,"canvas"),[Lv,Mv,Rv,Bv,Tv].forEach((e=>Xv(this,e))),Iv.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:["keydown","keypress","keyup",$v,Tv,Ov,Mv,"mouseup",Rv,Bv,zv,Lv,"dblclick","wheel",Pv,jv,Uv,Wv],DOMMouseScroll(e){this.fire(Pv,e)},mousemove:Kv(Rv,zv,Bv),dragover:Kv(Ov,$v,Tv),mouseout:Yv(Bv),dragleave:Yv(Tv),mousedown(e){this._down=this._active,this.fire(Mv,e)},click(e){this._down===this._active&&(this.fire(Lv,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(jv,e,!0)},touchmove(e){this.fire(Uv,e,!0)},touchend(e){this.fire(Wv,e,!0),this._touch=null},fire(e,t,n){const r=n?this._touch:this._active,i=this._handlers[e];if(t.vegaType=e,e===qv&&r&&r.href?this.handleHref(t,r,r.href):e!==Vv&&e!==Gv||this.handleTooltip(t,r,e!==Gv),i)for(let e=0,n=i.length;e<n;++e)i[e].handler.call(this._obj,t,r)},on(e,t){const n=this.eventName(e),r=this._handlers;return this._handlerIndex(r[n],e,t)<0&&(Xv(this,e),(r[n]||(r[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&r.splice(i,1),this},pickEvent(e){const t=Fv(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,r,i){const a=this.context();return fv[e.marktype].pick.call(this,a,e,t,n,r,i)}});var Qv="undefined"!=typeof window&&window.devicePixelRatio||1;function Jv(e){Nv.call(this,e),this._options={},this._redraw=!1,this._dirty=new mm,this._tempb=new mm}const Zv=Nv.prototype;function eb(e,t){Iv.call(this,e,t);const n=this;n._hrefHandler=tb(n,((e,t)=>{t&&t.href&&n.handleHref(e,t,t.href)})),n._tooltipHandler=tb(n,((e,t)=>{n.handleTooltip(e,t,e.type!==Gv)}))}dt(Jv,Nv,{initialize(e,t,n,r,i,a){return this._options=a||{},this._canvas=this._options.externalContext?null:od(1,1,this._options.type),e&&this._canvas&&(Av(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),Zv.initialize.call(this,e,t,n,r,i)},resize(e,t,n,r){if(Zv.resize.call(this,e,t,n,r),this._canvas)!function(e,t,n,r,i,a){const s="undefined"!=typeof HTMLElement&&e instanceof HTMLElement&&null!=e.parentNode,o=e.getContext("2d"),u=s?Qv:i;e.width=t*u,e.height=n*u;for(const e in a)o[e]=a[e];s&&1!==u&&(e.style.width=t+"px",e.style.height=n+"px"),o.pixelRatio=u,o.setTransform(u,0,0,u,u*r[0],u*r[1])}(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const e=this._options.externalContext;e||se("CanvasRenderer is missing a valid canvas or context"),e.scale(this._scale,this._scale),e.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,r=this._width,i=this._height,a=this._dirty,s=((e,t,n)=>(new mm).set(0,0,t,n).translate(-e[0],-e[1]))(n,r,i);t.save();const o=this._redraw||a.empty()?(this._redraw=!1,s.expand(1)):function(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-n[0]%1,-n[1]%1),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}(t,s.intersect(a),n);return this.clear(-n[0],-n[1],r,i),this.draw(t,e,o),t.restore(),a.clear(),this},draw(e,t,n){const r=fv[t.marktype];t.clip&&function(e,t){var n=t.clip;e.save(),Ke(n)?(e.beginPath(),n(e),e.clip()):ky(e,t.group)}(e,t),r.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,r){const i=this._options,a=this.context();"pdf"===i.type||i.externalContext||a.clearRect(e,t,n,r),null!=this._bgcolor&&(a.fillStyle=this._bgcolor,a.fillRect(e,t,n,r))}});const tb=(e,t)=>n=>{let r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,t.call(e._obj,n,r)};dt(eb,Iv,{initialize(e,t,n){let r=this._svg;return r&&(r.removeEventListener(qv,this._hrefHandler),r.removeEventListener(Vv,this._tooltipHandler),r.removeEventListener(Gv,this._tooltipHandler)),this._svg=r=e&&Sv(e,"svg"),r&&(r.addEventListener(qv,this._hrefHandler),r.addEventListener(Vv,this._tooltipHandler),r.addEventListener(Gv,this._tooltipHandler)),Iv.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),r=this._handlers;if(this._handlerIndex(r[n],e,t)<0){const i={type:e,handler:t,listener:tb(this,t)};(r[n]||(r[n]=[])).push(i),this._svg&&this._svg.addEventListener(n,i.listener)}return this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this}});const nb="aria-hidden",rb="aria-label",ib="role",ab="aria-roledescription",sb="graphics-object",ob="graphics-symbol",ub=(e,t,n)=>({[ib]:e,[ab]:t,[rb]:n||void 0}),lb=Nt(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),cb={axis:{desc:"axis",caption:function(e){const t=e.datum,n=e.orient,r=t.title?gb(e):null,i=e.context,a=i.scales[t.scale].value,s=i.dataflow.locale(),o=a.type;return("left"===n||"right"===n?"Y":"X")+"-axis"+(r?` titled '${r}'`:"")+` for a ${zp(o)?"discrete":o} scale`+` with ${yg(s,a,e)}`}},legend:{desc:"legend",caption:function(e){const t=e.datum,n=t.title?gb(e):null,r=`${t.type||""} legend`.trim(),i=t.scales,a=Object.keys(i),s=e.context,o=s.scales[i[a[0]]].value,u=s.dataflow.locale();return((l=r).length?l[0].toUpperCase()+l.slice(1):l)+(n?` titled '${n}'`:"")+` for ${function(e){return(e=e.map((e=>e+("fill"===e||"stroke"===e?" color":"")))).length<2?e[0]:e.slice(0,-1).join(", ")+" and "+Fe(e)}(a)}`+` with ${yg(u,o,e)}`;var l}},"title-text":{desc:"title",caption:e=>`Title text '${pb(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${pb(e)}'`}},db={ariaRole:ib,ariaRoleDescription:ab,description:rb};function hb(e,t){const n=!1===t.aria;if(e(nb,n||void 0),n||null==t.description)for(const t in db)e(db[t],void 0);else{const n=t.mark.marktype;e(rb,t.description),e(ib,t.ariaRole||("group"===n?sb:ob)),e(ab,t.ariaRoleDescription||`${n} mark`)}}function fb(e){return!1===e.aria?{[nb]:!0}:lb[e.role]?null:cb[e.role]?function(e,t){try{const n=e.items[0],r=t.caption||(()=>"");return ub(t.role||ob,t.desc,n.description||r(n))}catch(e){return null}}(e,cb[e.role]):function(e){const t=e.marktype,n="group"===t||"text"===t||e.items.some((e=>null!=e.description&&!1!==e.aria));return ub(n?sb:ob,`${t} mark container`,e.description)}(e)}function pb(e){return He(e.text).join(" ")}function gb(e){try{return He(Fe(e.items).items[0].text).join(" ")}catch(e){return null}}const mb=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");function yb(){let e="",t="",n="";const r=[],i=()=>t=n="",a=(e,n)=>{var r;return null!=n&&(t+=` ${e}="${r=n,mb(r).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")}"`),s},s={open(o,...u){(a=>{t&&(e+=`${t}>${n}`,i()),r.push(a)})(o),t="<"+o;for(const e of u)for(const t in e)a(t,e[t]);return s},close(){const a=r.pop();return e+=t?t+(n?`>${n}</${a}>`:"/>"):`</${a}>`,i(),s},attr:a,text:e=>(n+=mb(e),s),toString:()=>e};return s}const vb=e=>bb(yb(),e)+"";function bb(e,t){if(e.open(t.tagName),t.hasAttributes()){const n=t.attributes,r=n.length;for(let t=0;t<r;++t)e.attr(n[t].name,n[t].value)}if(t.hasChildNodes()){const n=t.childNodes,r=n.length;for(let t=0;t<r;t++){const r=n[t];3===r.nodeType?e.text(r.nodeValue):bb(e,r)}}return e.close()}const xb={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},wb={fill:"none","stroke-miterlimit":10},kb="http://www.w3.org/2000/xmlns/",_b=Dy.xmlns;function Sb(e){Nv.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const Cb=Nv.prototype;function Ab(e,t){for(;e&&e.dirty!==t;e=e.mark.group){if(e.dirty=t,!e.mark||e.mark.dirty===t)return;e.mark.dirty=t}}function Eb(e,t,n){let r,i,a;if("radial"===t.gradient){let r=Cv(e,n++,"pattern",_b);Mb(r,{id:bg+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),r=Cv(r,0,"rect",_b),Mb(r,{width:1,height:1,fill:`url(${Bb()}#${t.id})`}),Mb(e=Cv(e,n++,"radialGradient",_b),{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else Mb(e=Cv(e,n++,"linearGradient",_b),{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(r=0,i=t.stops.length;r<i;++r)a=Cv(e,r,"stop",_b),a.setAttribute("offset",t.stops[r].offset),a.setAttribute("stop-color",t.stops[r].color);return Av(e,r),n}function Fb(e,t,n){let r;return(e=Cv(e,n,"clipPath",_b)).setAttribute("id",t.id),t.path?(r=Cv(e,0,"path",_b),r.setAttribute("d",t.path)):(r=Cv(e,0,"rect",_b),Mb(r,{x:0,y:0,width:t.width,height:t.height})),Av(e,1),n+1}function Ib(e,t,n,r,i){let a,s=e._svg;if(!s&&(a=t.ownerDocument,s=_v(a,r,_b),e._svg=s,e.mark&&(s.__data__=e,s.__values__={fill:"default"},"g"===r))){const t=_v(a,"path",_b);s.appendChild(t),t.__data__=e;const n=_v(a,"g",_b);s.appendChild(n),n.__data__=e;const r=_v(a,"path",_b);s.appendChild(r),r.__data__=e,r.__values__={fill:"default"}}return(s.ownerSVGElement!==i||function(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}(s,n))&&t.insertBefore(s,n?n.nextSibling:t.firstChild),s}dt(Sb,Nv,{initialize(e,t,n,r,i){return this._defs={},this._clearDefs(),e&&(this._svg=Cv(e,0,"svg",_b),this._svg.setAttributeNS(kb,"xmlns",_b),this._svg.setAttributeNS(kb,"xmlns:xlink",Dy["xmlns:xlink"]),this._svg.setAttribute("version",Dy.version),this._svg.setAttribute("class","marks"),Av(e,1),this._root=Cv(this._svg,0,"g",_b),Mb(this._root,wb),Av(this._svg,1)),this.background(this._bgcolor),Cb.initialize.call(this,e,t,n,r,i)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),Cb.background.apply(this,arguments)},resize(e,t,n,r){return Cb.resize.call(this,e,t,n,r),this._svg&&(Mb(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),n=Cv(e,0,"rect",_b),Mb(n,{width:this._width,height:this._height,fill:t}));const r=vb(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),r},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),Av(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,r,i,a,s,o,u;for(s=0,o=e.length;s<o;++s)n=e[s],r=n.mark,r.marktype!==i&&(i=r.marktype,a=fv[i]),r.zdirty&&r.dirty!==t&&(this._dirtyAll=!1,Ab(n,t),r.items.forEach((e=>{e.dirty=t}))),r.zdirty||(n.exit?(a.nested&&r.items.length?(u=r.items[0],u._svg&&this._update(a,u._svg,u)):n._svg&&(u=n._svg.parentNode,u&&u.removeChild(n._svg)),n._svg=null):(n=a.nested?r.items[0]:n,n._update!==t&&(n._svg&&n._svg.ownerSVGElement?this._update(a,n._svg,n):(this._dirtyAll=!1,Ab(n,t)),n._update=t)));return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const r=this._svg,i=fv[t.marktype],a=!1===t.interactive?"none":null,s="g"===i.tag;let o=null,u=0;const l=Ib(t,e,n,"g",r);l.setAttribute("class",Ev(t));const c=fb(t);for(const e in c)Rb(l,e,c[e]);s||Rb(l,"pointer-events",a),Rb(l,"clip-path",t.clip?gm(this,t,t.group):null);const d=e=>{const t=this.isDirty(e),n=Ib(e,l,o,i.tag,r);t&&(this._update(i,n,e),s&&function(e,t,n){t=t.lastChild.previousSibling;let r,i=0;oy(n,(n=>{r=e.mark(t,n,r),++i})),Av(t,1+i)}(this,n,e)),o=n,++u};return i.nested?t.items.length&&d(t.items[0]):oy(t,d),Av(l,u),l},_update(e,t,n){Db=t,Nb=t.__values__,hb(Tb,n),e.attr(Tb,n,this);const r=$b[e.type];r&&r.call(this,e,t,n),Db&&this.style(Db,n)},style(e,t){if(null!=t)for(const n in xb){let r="font"===n?iv(t):t[n];if(r===Nb[n])continue;const i=xb[n];null==r?e.removeAttribute(i):(xg(r)&&(r=wg(r,this._defs.gradient,Bb())),e.setAttribute(i,r+"")),Nb[n]=r}},defs(){const e=this._svg,t=this._defs;let n=t.el,r=0;for(const i in t.gradient)n||(t.el=n=Cv(e,1,"defs",_b)),r=Eb(n,t.gradient[i],r);for(const i in t.clipping)n||(t.el=n=Cv(e,1,"defs",_b)),r=Fb(n,t.clipping[i],r);n&&(0===r?(e.removeChild(n),t.el=null):Av(n,r))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});let Db=null,Nb=null;const $b={group(e,t,n){const r=Db=t.childNodes[2];Nb=r.__values__,e.foreground(Tb,n,this),Nb=t.__values__,Db=t.childNodes[1],e.content(Tb,n,this);const i=Db=t.childNodes[0];e.background(Tb,n,this);const a=!1===n.mark.interactive?"none":null;if(a!==Nb.events&&(Rb(r,"pointer-events",a),Rb(i,"pointer-events",a),Nb.events=a),n.strokeForeground&&n.stroke){const e=n.fill;Rb(r,"display",null),this.style(i,n),Rb(i,"stroke",null),e&&(n.fill=null),Nb=r.__values__,this.style(r,n),e&&(n.fill=e),Db=null}else Rb(r,"display","none")},image(e,t,n){!1===n.smooth?(Ob(t,"image-rendering","optimizeSpeed"),Ob(t,"image-rendering","pixelated")):Ob(t,"image-rendering",null)},text(e,t,n){const r=tv(n);let i,a,s,o;ke(r)?(a=r.map((e=>rv(n,e))),i=a.join("\n"),i!==Nb.text&&(Av(t,0),s=t.ownerDocument,o=ev(n),a.forEach(((e,r)=>{const i=_v(s,"tspan",_b);i.__data__=n,i.textContent=e,r&&(i.setAttribute("x",0),i.setAttribute("dy",o)),t.appendChild(i)})),Nb.text=i)):(a=rv(n,r),a!==Nb.text&&(t.textContent=a,Nb.text=a)),Rb(t,"font-family",iv(n)),Rb(t,"font-size",Zy(n)+"px"),Rb(t,"font-style",n.fontStyle),Rb(t,"font-variant",n.fontVariant),Rb(t,"font-weight",n.fontWeight)}};function Tb(e,t,n){t!==Nb[e]&&(n?function(e,t,n,r){null!=n?e.setAttributeNS(r,t,n):e.removeAttributeNS(r,t)}(Db,e,t,n):Rb(Db,e,t),Nb[e]=t)}function Ob(e,t,n){n!==Nb[t]&&(null==n?e.style.removeProperty(t):e.style.setProperty(t,n+""),Nb[t]=n)}function Mb(e,t){for(const n in t)Rb(e,n,t[n])}function Rb(e,t,n){null!=n?e.setAttribute(t,n):e.removeAttribute(t)}function Bb(){let e;return"undefined"==typeof window?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function zb(e){Nv.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}dt(zb,Nv,{svg(){return this._text},_render(e){const t=yb();t.open("svg",rt({},Dy,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&"transparent"!==n&&"none"!==n&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",wb,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=fv[t.marktype],r=n.tag,i=[hb,n.attr];e.open("g",{class:Ev(t),"clip-path":t.clip?gm(this,t,t.group):null},fb(t),{"pointer-events":"g"!==r&&!1===t.interactive?"none":null});const a=a=>{const s=this.href(a);if(s&&e.open("a",s),e.open(r,this.attr(t,a,i,"g"!==r?r:null)),"text"===r){const t=tv(a);if(ke(t)){const n={x:0,dy:ev(a)};for(let r=0;r<t.length;++r)e.open("tspan",r?n:null).text(rv(a,t[r])).close()}else e.text(rv(a,t))}else if("g"===r){const r=a.strokeForeground,i=a.fill,s=a.stroke;r&&s&&(a.stroke=null),e.open("path",this.attr(t,a,n.background,"bgrect")).close(),e.open("g",this.attr(t,a,n.content)),oy(a,(t=>this.mark(e,t))),e.close(),r&&s?(i&&(a.fill=null),a.stroke=s,e.open("path",this.attr(t,a,n.foreground,"bgrect")).close(),i&&(a.fill=i)):e.open("path",this.attr(t,a,n.foreground,"bgfore")).close()}e.close(),s&&e.close()};return n.nested?t.items&&t.items.length&&a(t.items[0]):oy(t,a),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then((e=>{e["xlink:href"]=e.href,e.href=null,(this._hrefs||(this._hrefs={}))[t]=e}))}return null},attr(e,t,n,r){const i={},a=(e,t,n,r)=>{i[r||e]=t};return Array.isArray(n)?n.forEach((e=>e(a,t,this))):n(a,t,this),r&&function(e,t,n,r,i){if(null==t)return e;if("bgrect"===r&&!1===n.interactive&&(e["pointer-events"]="none"),"bgfore"===r&&(!1===n.interactive&&(e["pointer-events"]="none"),e.display="none",null!==t.fill))return e;"image"===r&&!1===t.smooth&&(e.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),"text"===r&&(e["font-family"]=iv(t),e["font-size"]=Zy(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight);for(const n in xb){let r=t[n];const a=xb[n];("transparent"!==r||"fill"!==a&&"stroke"!==a)&&null!=r&&(xg(r)&&(r=wg(r,i.gradient,"")),e[a]=r)}}(i,t,e,r,this._defs),i},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(0!==Object.keys(t).length+Object.keys(n).length){e.open("defs");for(const n in t){const r=t[n],i=r.stops;"radial"===r.gradient?(e.open("pattern",{id:bg+n,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+n+")"}).close(),e.close(),e.open("radialGradient",{id:n,fx:r.x1,fy:r.y1,fr:r.r1,cx:r.x2,cy:r.y2,r:r.r2})):e.open("linearGradient",{id:n,x1:r.x1,x2:r.x2,y1:r.y1,y2:r.y2});for(let t=0;t<i.length;++t)e.open("stop",{offset:i[t].offset,"stop-color":i[t].color}).close();e.close()}for(const t in n){const r=n[t];e.open("clipPath",{id:t}),r.path?e.open("path",{d:r.path}).close():e.open("rect",{x:0,y:0,width:r.width,height:r.height}).close(),e.close()}e.close()}}});const Lb={Canvas:"canvas",PNG:"png",SVG:"svg",None:"none"},Pb={};function jb(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(Pb[e]=t,this):Pb[e]}function Ub(e,t,n){const r=[],i=(new mm).union(t),a=e.marktype;return a?Wb(e,i,n,r):"group"===a?Vb(e,i,n,r):se("Intersect scene must be mark node or group item.")}function Wb(e,t,n,r){if(function(e,t,n){return e.bounds&&t.intersects(e.bounds)&&("group"===e.marktype||!1!==e.interactive&&(!n||n(e)))}(e,t,n)){const i=e.items,a=e.marktype,s=i.length;let o=0;if("group"===a)for(;o<s;++o)Vb(i[o],t,n,r);else for(const e=fv[a].isect;o<s;++o){const n=i[o];Gb(n,t,e)&&r.push(n)}}return r}function Vb(e,t,n,r){n&&n(e.mark)&&Gb(e,t,fv.group.isect)&&r.push(e);const i=e.items,a=i&&i.length;if(a){const s=e.x||0,o=e.y||0;t.translate(-s,-o);for(let e=0;e<a;++e)Wb(i[e],t,n,r);t.translate(s,o)}return r}function Gb(e,t,n){const r=e.bounds;return t.encloses(r)||t.intersects(r)&&n(e,t)}Pb.canvas=Pb.png={renderer:Jv,headless:Jv,handler:Hv},Pb.svg={renderer:Sb,headless:zb,handler:eb},Pb.none={};const qb=new mm;function Hb(e){const t=e.clip;if(Ke(t))t(Pm(qb.clear()));else{if(!t)return;qb.set(0,0,e.group.width,e.group.height)}e.bounds.intersect(qb)}function Xb(e,t,n){return e===t||("path"===n?Kb(e,t):e instanceof Date&&t instanceof Date?+e==+t:mt(e)&&mt(t)?Math.abs(e-t)<=1e-9:e&&t&&(_e(e)||_e(t))?function(e,t){var n,r,i=Object.keys(e),a=Object.keys(t);if(i.length!==a.length)return!1;for(i.sort(),a.sort(),r=i.length-1;r>=0;r--)if(i[r]!=a[r])return!1;for(r=i.length-1;r>=0;r--)if(!Xb(e[n=i[r]],t[n],n))return!1;return typeof e==typeof t}(e,t):e==t)}function Kb(e,t){return Xb(Fg(e),Fg(t))}function Yb(){pm(),vg=0}const Qb="top",Jb="left",Zb="right",ex="bottom",tx="start",nx="middle",rx="end",ix="group",ax="axis",sx="title",ox="legend",ux="row-header",lx="row-footer",cx="row-title",dx="column-header",hx="column-footer",fx="column-title",px="none",gx="all",mx="each",yx="flush",vx="column",bx="row";function xx(e){go.call(this,null,e)}function wx(e,t,n){return t(e.bounds.clear(),e,n)}dt(xx,go,{transform(e,t){const n=t.dataflow,r=e.mark,i=r.marktype,a=fv[i],s=a.bound;let o,u=r.bounds;if(a.nested)r.items.length&&n.dirty(r.items[0]),u=wx(r,s),r.items.forEach((e=>{e.bounds.clear().union(u)}));else if(i===ix||e.modified())switch(t.visit(t.MOD,(e=>n.dirty(e))),u.clear(),r.items.forEach((e=>u.union(wx(e,s)))),r.role){case ax:case ox:case sx:t.reflow()}else o=t.changed(t.REM),t.visit(t.ADD,(e=>{u.union(wx(e,s))})),t.visit(t.MOD,(e=>{o=o||u.alignsWith(e.bounds),n.dirty(e),u.union(wx(e,s))})),o&&(u.clear(),r.items.forEach((e=>u.union(e.bounds))));return Hb(r),t.modifies("bounds")}});const kx=":vega_identifier:";function _x(e){go.call(this,0,e)}function Sx(e){go.call(this,null,e)}function Cx(e){go.call(this,null,e)}_x.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},dt(_x,go,{transform(e,t){const n=(i=t.dataflow)._signals[kx]||(i._signals[kx]=i.add(0)),r=e.as;var i;let a=n.value;return t.visit(t.ADD,(e=>e[r]=e[r]||++a)),n.set(this.value=a),t}}),dt(Sx,go,{transform(e,t){let n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,function(e){const t=e.groups,n=e.parent;return t&&1===t.size?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const r=n.marktype===ix?vm:ym;return t.visit(t.ADD,(e=>r.call(e,n))),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});const Ax={parity:e=>e.filter(((e,t)=>t%2?e.opacity=0:1)),greedy:(e,t)=>{let n;return e.filter(((e,r)=>r&&Ex(n.bounds,e.bounds,t)?e.opacity=0:(n=e,1)))}},Ex=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),Fx=(e,t)=>{for(var n,r=1,i=e.length,a=e[0].bounds;r<i;a=n,++r)if(Ex(a,n=e[r].bounds,t))return!0},Ix=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},Dx=e=>(e.forEach((e=>e.opacity=1)),e),Nx=(e,t)=>e.reflow(t.modified()).modifies("opacity");function $x(e){go.call(this,null,e)}dt(Cx,go,{transform(e,t){const n=Ax[e.method]||Ax.parity,r=e.separation||0;let i,a,s=t.materialize(t.SOURCE).source;if(!s||!s.length)return;if(!e.method)return e.modified("method")&&(Dx(s),t=Nx(t,e)),t;if(s=s.filter(Ix),!s.length)return;if(e.sort&&(s=s.slice().sort(e.sort)),i=Dx(s),t=Nx(t,e),i.length>=3&&Fx(i,r)){do{i=n(i,r)}while(i.length>=3&&Fx(i,r));i.length<3&&!Fe(s).opacity&&(i.length>1&&(Fe(i).opacity=0),Fe(s).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(a=((e,t,n)=>{var r=e.range(),i=new mm;return t===Qb||t===ex?i.set(r[0],-1/0,r[1],1/0):i.set(-1/0,r[0],1/0,r[1]),i.expand(n||1),e=>i.encloses(e.bounds)})(e.boundScale,e.boundOrient,+e.boundTolerance),s.forEach((e=>{a(e)||(e.opacity=0)})));const o=i[0].mark.bounds.clear();return s.forEach((e=>{e.opacity&&o.union(e.bounds)})),t}}),dt($x,go,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,(e=>n.dirty(e))),t.fields&&t.fields.zindex){const e=t.source&&t.source[0];e&&(e.mark.zdirty=!0)}}});const Tx=new mm;function Ox(e,t,n){return e[t]===n?0:(e[t]=n,1)}function Mx(e){var t=e.items[0].orient;return t===Jb||t===Zb}function Rx(e,t,n,r){var i,a,s=t.items[0],o=s.datum,u=null!=s.translate?s.translate:.5,l=s.orient,c=function(e){let t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}(o),d=s.range,h=s.offset,f=s.position,p=s.minExtent,g=s.maxExtent,m=o.title&&s.items[c[2]].items[0],y=s.titlePadding,v=s.bounds,b=m&&nv(m),x=0,w=0;switch(Tx.clear().union(v),v.clear(),(i=c[0])>-1&&v.union(s.items[i].bounds),(i=c[1])>-1&&v.union(s.items[i].bounds),l){case Qb:x=f||0,w=-h,a=Math.max(p,Math.min(g,-v.y1)),v.add(0,-a).add(d,0),m&&Bx(e,m,a,y,b,0,-1,v);break;case Jb:x=-h,w=f||0,a=Math.max(p,Math.min(g,-v.x1)),v.add(-a,0).add(0,d),m&&Bx(e,m,a,y,b,1,-1,v);break;case Zb:x=n+h,w=f||0,a=Math.max(p,Math.min(g,v.x2)),v.add(0,0).add(a,d),m&&Bx(e,m,a,y,b,1,1,v);break;case ex:x=f||0,w=r+h,a=Math.max(p,Math.min(g,v.y2)),v.add(0,0).add(d,a),m&&Bx(e,m,a,y,0,0,1,v);break;default:x=s.x,w=s.y}return km(v.translate(x,w),s),Ox(s,"x",x+u)|Ox(s,"y",w+u)&&(s.bounds=Tx,e.dirty(s),s.bounds=v,e.dirty(s)),s.mark.bounds.clear().union(v)}function Bx(e,t,n,r,i,a,s,o){const u=t.bounds;if(t.auto){const o=s*(n+i+r);let l=0,c=0;e.dirty(t),a?l=(t.x||0)-(t.x=o):c=(t.y||0)-(t.y=o),t.mark.bounds.clear().union(u.translate(-l,-c)),e.dirty(t)}o.union(u)}const zx=(e,t)=>Math.floor(Math.min(e,t)),Lx=(e,t)=>Math.ceil(Math.max(e,t));function Px(e){return(new mm).set(0,0,e.width||0,e.height||0)}function jx(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function Ux(e,t,n){const r=_e(e)?e[t]:e;return null!=r?r:void 0!==n?n:0}function Wx(e){return e<0?Math.ceil(-e):0}function Vx(e,t,n){var r,i,a,s,o,u,l,c,d,h,f,p=!n.nodirty,g=n.bounds===yx?Px:jx,m=Tx.set(0,0,0,0),y=Ux(n.align,vx),v=Ux(n.align,bx),b=Ux(n.padding,vx),x=Ux(n.padding,bx),w=n.columns||t.length,k=w<=0?1:Math.ceil(t.length/w),_=t.length,S=Array(_),C=Array(w),A=0,E=Array(_),F=Array(k),I=0,D=Array(_),N=Array(_),$=Array(_);for(i=0;i<w;++i)C[i]=0;for(i=0;i<k;++i)F[i]=0;for(i=0;i<_;++i)u=t[i],o=$[i]=g(u),u.x=u.x||0,D[i]=0,u.y=u.y||0,N[i]=0,a=i%w,s=~~(i/w),A=Math.max(A,l=Math.ceil(o.x2)),I=Math.max(I,c=Math.ceil(o.y2)),C[a]=Math.max(C[a],l),F[s]=Math.max(F[s],c),S[i]=b+Wx(o.x1),E[i]=x+Wx(o.y1),p&&e.dirty(t[i]);for(i=0;i<_;++i)i%w==0&&(S[i]=0),i<w&&(E[i]=0);if(y===mx)for(a=1;a<w;++a){for(f=0,i=a;i<_;i+=w)f<S[i]&&(f=S[i]);for(i=a;i<_;i+=w)S[i]=f+C[a-1]}else if(y===gx){for(f=0,i=0;i<_;++i)i%w&&f<S[i]&&(f=S[i]);for(i=0;i<_;++i)i%w&&(S[i]=f+A)}else for(y=!1,a=1;a<w;++a)for(i=a;i<_;i+=w)S[i]+=C[a-1];if(v===mx)for(s=1;s<k;++s){for(f=0,r=(i=s*w)+w;i<r;++i)f<E[i]&&(f=E[i]);for(i=s*w;i<r;++i)E[i]=f+F[s-1]}else if(v===gx){for(f=0,i=w;i<_;++i)f<E[i]&&(f=E[i]);for(i=w;i<_;++i)E[i]=f+I}else for(v=!1,s=1;s<k;++s)for(r=(i=s*w)+w;i<r;++i)E[i]+=F[s-1];for(d=0,i=0;i<_;++i)d=S[i]+(i%w?d:0),D[i]+=d-t[i].x;for(a=0;a<w;++a)for(h=0,i=a;i<_;i+=w)h+=E[i],N[i]+=h-t[i].y;if(y&&Ux(n.center,vx)&&k>1)for(i=0;i<_;++i)(d=(o=y===gx?A:C[i%w])-$[i].x2-t[i].x-D[i])>0&&(D[i]+=d/2);if(v&&Ux(n.center,bx)&&1!==w)for(i=0;i<_;++i)(h=(o=v===gx?I:F[~~(i/w)])-$[i].y2-t[i].y-N[i])>0&&(N[i]+=h/2);for(i=0;i<_;++i)m.union($[i].translate(D[i],N[i]));switch(d=Ux(n.anchor,"x"),h=Ux(n.anchor,"y"),Ux(n.anchor,vx)){case rx:d-=m.width();break;case nx:d-=m.width()/2}switch(Ux(n.anchor,bx)){case rx:h-=m.height();break;case nx:h-=m.height()/2}for(d=Math.round(d),h=Math.round(h),m.clear(),i=0;i<_;++i)t[i].mark.bounds.clear();for(i=0;i<_;++i)(u=t[i]).x+=D[i]+=d,u.y+=N[i]+=h,m.union(u.mark.bounds.union(u.bounds.translate(D[i],N[i]))),p&&e.dirty(u);return m}function Gx(e,t){return"x1"===t?e.x||0:"y1"===t?e.y||0:"x2"===t?(e.x||0)+(e.width||0):"y2"===t?(e.y||0)+(e.height||0):void 0}function qx(e,t){return e.bounds[t]}function Hx(e,t,n,r,i,a,s,o,u,l,c,d,h,f){var p,g,m,y,v,b,x,w,k,_=n.length,S=0,C=0;if(!_)return S;for(p=c;p<_;p+=d)n[p]&&(S=s(S,u(n[p],l)));if(!t.length)return S;for(t.length>i&&(e.warn("Grid headers exceed limit: "+i),t=t.slice(0,i)),S+=a,g=0,y=t.length;g<y;++g)e.dirty(t[g]),t[g].mark.bounds.clear();for(p=c,g=0,y=t.length;g<y;++g,p+=d){for(v=(b=t[g]).mark.bounds,m=p;m>=0&&null==(x=n[m]);m-=h);o?(w=null==f?x.x:Math.round(x.bounds.x1+f*x.bounds.width()),k=S):(w=S,k=null==f?x.y:Math.round(x.bounds.y1+f*x.bounds.height())),v.union(b.bounds.translate(w-(b.x||0),k-(b.y||0))),b.x=w,b.y=k,e.dirty(b),C=s(C,v[l])}return C}function Xx(e,t,n,r,i,a){if(t){e.dirty(t);var s=n,o=n;r?s=Math.round(i.x1+a*i.width()):o=Math.round(i.y1+a*i.height()),t.bounds.translate(s-(t.x||0),o-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=s,t.y=o,e.dirty(t)}}function Kx(e,t,n,r,i,a,s){const o=function(e,t){const n=e[t]||{};return(t,r)=>null!=n[t]?n[t]:null!=e[t]?e[t]:r}(n,t),u=function(e,t){let n=-1/0;return e.forEach((e=>{null!=e.offset&&(n=Math.max(n,e.offset))})),n>-1/0?n:t}(e,o("offset",0)),l=o("anchor",tx),c=l===rx?1:l===nx?.5:0,d={align:mx,bounds:o("bounds",yx),columns:"vertical"===o("direction")?1:e.length,padding:o("margin",8),center:o("center"),nodirty:!0};switch(t){case Jb:d.anchor={x:Math.floor(r.x1)-u,column:rx,y:c*(s||r.height()+2*r.y1),row:l};break;case Zb:d.anchor={x:Math.ceil(r.x2)+u,y:c*(s||r.height()+2*r.y1),row:l};break;case Qb:d.anchor={y:Math.floor(i.y1)-u,row:rx,x:c*(a||i.width()+2*i.x1),column:l};break;case ex:d.anchor={y:Math.ceil(i.y2)+u,x:c*(a||i.width()+2*i.x1),column:l};break;case"top-left":d.anchor={x:u,y:u};break;case"top-right":d.anchor={x:a-u,y:u,column:rx};break;case"bottom-left":d.anchor={x:u,y:s-u,row:rx};break;case"bottom-right":d.anchor={x:a-u,y:s-u,column:rx,row:rx}}return d}function Yx(e,t){var n,r,i=t.items[0],a=i.datum,s=i.orient,o=i.bounds,u=i.x,l=i.y;return i._bounds?i._bounds.clear().union(o):i._bounds=o.clone(),o.clear(),function(e,t,n){var r=t.padding,i=r-n.x,a=r-n.y;if(t.datum.title){var s=t.items[1].items[0],o=s.anchor,u=t.titlePadding||0,l=r-s.x,c=r-s.y;switch(s.orient){case Jb:i+=Math.ceil(s.bounds.width())+u;break;case Zb:case ex:break;default:a+=s.bounds.height()+u}switch((i||a)&&Jx(e,n,i,a),s.orient){case Jb:c+=Qx(t,n,s,o,1,1);break;case Zb:l+=Qx(t,n,s,rx,0,0)+u,c+=Qx(t,n,s,o,1,1);break;case ex:l+=Qx(t,n,s,o,0,0),c+=Qx(t,n,s,rx,-1,0,1)+u;break;default:l+=Qx(t,n,s,o,0,0)}(l||c)&&Jx(e,s,l,c),(l=Math.round(s.bounds.x1-r))<0&&(Jx(e,n,-l,0),Jx(e,s,-l,0))}else(i||a)&&Jx(e,n,i,a)}(e,i,i.items[0].items[0]),o=function(e,t){return e.items.forEach((e=>t.union(e.bounds))),t.x1=e.padding,t.y1=e.padding,t}(i,o),n=2*i.padding,r=2*i.padding,o.empty()||(n=Math.ceil(o.width()+n),r=Math.ceil(o.height()+r)),"symbol"===a.type&&function(e){const t=e.reduce(((e,t)=>(e[t.column]=Math.max(t.bounds.x2-t.x,e[t.column]||0),e)),{});e.forEach((e=>{e.width=t[e.column],e.height=e.bounds.y2-e.y}))}(i.items[0].items[0].items[0].items),s!==px&&(i.x=u=0,i.y=l=0),i.width=n,i.height=r,km(o.set(u,l,u+n,l+r),i),i.mark.bounds.clear().union(o),i}function Qx(e,t,n,r,i,a,s){const o="symbol"!==e.datum.type,u=n.datum.vgrad,l=(!o||!a&&u||s?t:t.items[0]).bounds[i?"y2":"x2"]-e.padding,c=u&&a?l:0,d=u&&a?0:l,h=i<=0?0:nv(n);return Math.round(r===tx?c:r===rx?d-h:.5*(l-h))}function Jx(e,t,n,r){t.x+=n,t.y+=r,t.bounds.translate(n,r),t.mark.bounds.translate(n,r),e.dirty(t)}function Zx(e){go.call(this,null,e)}function ew(e,t){let n=0;if(void 0===t)for(let t of e)(t=+t)&&(n+=t);else{let r=-1;for(let i of e)(i=+t(i,++r,e))&&(n+=i)}return n}function tw(e){go.call(this,null,e)}function nw(e){go.call(this,null,e)}function rw(){return zs({})}function iw(e){go.call(this,null,e)}function aw(e){go.call(this,[],e)}dt(Zx,go,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach((t=>{e.layout&&function(e,t,n){var r,i,a,s,o,u,l,c=function(e){var t,n,r=e.items,i=r.length,a=0;const s={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;a<i;++a)if(n=(t=r[a]).items,t.marktype===ix)switch(t.role){case ax:case ox:case sx:break;case ux:s.rowheaders.push(...n);break;case lx:s.rowfooters.push(...n);break;case dx:s.colheaders.push(...n);break;case hx:s.colfooters.push(...n);break;case cx:s.rowtitle=n[0];break;case fx:s.coltitle=n[0];break;default:s.marks.push(...n)}return s}(t),d=c.marks,h=n.bounds===yx?Gx:qx,f=n.offset,p=n.columns||d.length,g=p<=0?1:Math.ceil(d.length/p),m=g*p;const y=Vx(e,d,n);y.empty()&&y.set(0,0,0,0),c.rowheaders&&(u=Ux(n.headerBand,bx,null),r=Hx(e,c.rowheaders,d,0,g,-Ux(f,"rowHeader"),zx,0,h,"x1",0,p,1,u)),c.colheaders&&(u=Ux(n.headerBand,vx,null),i=Hx(e,c.colheaders,d,0,p,-Ux(f,"columnHeader"),zx,1,h,"y1",0,1,p,u)),c.rowfooters&&(u=Ux(n.footerBand,bx,null),a=Hx(e,c.rowfooters,d,0,g,Ux(f,"rowFooter"),Lx,0,h,"x2",p-1,p,1,u)),c.colfooters&&(u=Ux(n.footerBand,vx,null),s=Hx(e,c.colfooters,d,0,p,Ux(f,"columnFooter"),Lx,1,h,"y2",m-p,1,p,u)),c.rowtitle&&(o=Ux(n.titleAnchor,bx),l=Ux(f,"rowTitle"),l=o===rx?a+l:r-l,u=Ux(n.titleBand,bx,.5),Xx(e,c.rowtitle,l,0,y,u)),c.coltitle&&(o=Ux(n.titleAnchor,vx),l=Ux(f,"columnTitle"),l=o===rx?s+l:i-l,u=Ux(n.titleBand,vx,.5),Xx(e,c.coltitle,l,1,y,u))}(n,t,e.layout),function(e,t,n){var r,i,a,s,o,u=t.items,l=Math.max(0,t.width||0),c=Math.max(0,t.height||0),d=(new mm).set(0,0,l,c),h=d.clone(),f=d.clone(),p=[];for(s=0,o=u.length;s<o;++s)switch((i=u[s]).role){case ax:(Mx(i)?h:f).union(Rx(e,i,l,c));break;case sx:r=i;break;case ox:p.push(Yx(e,i));break;case"frame":case"scope":case ux:case lx:case cx:case dx:case hx:case fx:h.union(i.bounds),f.union(i.bounds);break;default:d.union(i.bounds)}if(p.length){const t={};p.forEach((e=>{(a=e.orient||Zb)!==px&&(t[a]||(t[a]=[])).push(e)}));for(const r in t){const i=t[r];Vx(e,i,Kx(i,r,n.legends,h,f,l,c))}p.forEach((t=>{const r=t.bounds;if(r.equals(t._bounds)||(t.bounds=t._bounds,e.dirty(t),t.bounds=r,e.dirty(t)),n.autosize&&"fit"===n.autosize.type)switch(t.orient){case Jb:case Zb:d.add(r.x1,0).add(r.x2,0);break;case Qb:case ex:d.add(0,r.y1).add(0,r.y2)}else d.union(r)}))}d.union(h).union(f),r&&d.union(function(e,t,n,r,i){var a,s=t.items[0],o=s.frame,u=s.orient,l=s.anchor,c=s.offset,d=s.padding,h=s.items[0].items[0],f=s.items[1]&&s.items[1].items[0],p=u===Jb||u===Zb?r:n,g=0,m=0,y=0,v=0,b=0;if(o!==ix?u===Jb?(g=i.y2,p=i.y1):u===Zb?(g=i.y1,p=i.y2):(g=i.x1,p=i.x2):u===Jb&&(g=r,p=0),a=l===tx?g:l===rx?p:(g+p)/2,f&&f.text){switch(u){case Qb:case ex:b=h.bounds.height()+d;break;case Jb:v=h.bounds.width()+d;break;case Zb:v=-h.bounds.width()-d}Tx.clear().union(f.bounds),Tx.translate(v-(f.x||0),b-(f.y||0)),Ox(f,"x",v)|Ox(f,"y",b)&&(e.dirty(f),f.bounds.clear().union(Tx),f.mark.bounds.clear().union(Tx),e.dirty(f)),Tx.clear().union(f.bounds)}else Tx.clear();switch(Tx.union(h.bounds),u){case Qb:m=a,y=i.y1-Tx.height()-c;break;case Jb:m=i.x1-Tx.width()-c,y=a;break;case Zb:m=i.x2+Tx.width()+c,y=a;break;case ex:m=a,y=i.y2+c;break;default:m=s.x,y=s.y}return Ox(s,"x",m)|Ox(s,"y",y)&&(Tx.translate(m,y),e.dirty(s),s.bounds.clear().union(Tx),t.bounds.clear().union(Tx),e.dirty(s)),s.bounds}(e,r,l,c,d)),t.clip&&d.set(0,0,t.width||0,t.height||0),function(e,t,n,r){const i=r.autosize||{},a=i.type;if(e._autosize<1||!a)return;let s=e._width,o=e._height,u=Math.max(0,t.width||0),l=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,t.height||0),d=Math.max(0,Math.ceil(-n.y1));const h=Math.max(0,Math.ceil(n.x2-u)),f=Math.max(0,Math.ceil(n.y2-c));if("padding"===i.contains){const t=e.padding();s-=t.left+t.right,o-=t.top+t.bottom}a===px?(l=0,d=0,u=s,c=o):"fit"===a?(u=Math.max(0,s-l-h),c=Math.max(0,o-d-f)):"fit-x"===a?(u=Math.max(0,s-l-h),o=c+d+f):"fit-y"===a?(s=u+l+h,c=Math.max(0,o-d-f)):"pad"===a&&(s=u+l+h,o=c+d+f),e._resizeView(s,o,u,c,[l,d],i.resize)}(e,t,d,n)}(n,t,e)})),function(e){return e&&"legend-entry"!==e.mark.role}(e.mark.group)?t.reflow():t}}),dt(tw,go,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,a=e.scale,s=rg(a,null==e.count?e.values?e.values.length:10:e.count,e.minstep),o=e.format||sg(n,a,s,e.formatSpecifier,e.formatType,!!e.values),u=e.values?ig(a,e.values,s):ag(a,s);return i&&(r.rem=i),i=u.map(((e,t)=>zs({index:t/(u.length-1||1),value:e,label:o(e)}))),e.extra&&i.length&&i.push(zs({index:-1,extra:{value:i[0].value},label:""})),r.source=i,r.add=i,this.value=i,r}}),dt(nw,go,{transform(e,t){var n=t.dataflow,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.item||rw,a=e.key||Rs,s=this.value;return ke(r.encode)&&(r.encode=null),s&&(e.modified("key")||t.modified(a))&&se("DataJoin does not support modified key function or fields."),s||(t=t.addAll(),this.value=s=function(e){const t=lt().test((e=>e.exit));return t.lookup=n=>t.get(e(n)),t}(a)),t.visit(t.ADD,(e=>{const t=a(e);let n=s.get(t);n?n.exit?(s.empty--,r.add.push(n)):r.mod.push(n):(n=i(e),s.set(t,n),r.add.push(n)),n.datum=e,n.exit=!1})),t.visit(t.MOD,(e=>{const t=a(e),n=s.get(t);n&&(n.datum=e,r.mod.push(n))})),t.visit(t.REM,(e=>{const t=a(e),n=s.get(t);e!==n.datum||n.exit||(r.rem.push(n),n.exit=!0,++s.empty)})),t.changed(t.ADD_MOD)&&r.modifies("datum"),(t.clean()||e.clean&&s.empty>n.cleanThreshold)&&n.runAfter(s.clean),r}}),dt(iw,go,{transform(e,t){var n=t.fork(t.ADD_REM),r=e.mod||!1,i=e.encoders,a=t.encode;if(ke(a)){if(!n.changed()&&!a.every((e=>i[e])))return t.StopPropagation;a=a[0],n.encode=null}var s="enter"===a,o=i.update||pe,u=i.enter||pe,l=i.exit||pe,c=(a&&!s?i[a]:o)||pe;if(t.changed(t.ADD)&&(t.visit(t.ADD,(t=>{u(t,e),o(t,e)})),n.modifies(u.output),n.modifies(o.output),c!==pe&&c!==o&&(t.visit(t.ADD,(t=>{c(t,e)})),n.modifies(c.output))),t.changed(t.REM)&&l!==pe&&(t.visit(t.REM,(t=>{l(t,e)})),n.modifies(l.output)),s||c!==pe){const i=t.MOD|(e.modified()?t.REFLOW:0);s?(t.visit(i,(t=>{const i=u(t,e)||r;(c(t,e)||i)&&n.mod.push(t)})),n.mod.length&&n.modifies(u.output)):t.visit(i,(t=>{(c(t,e)||r)&&n.mod.push(t)})),n.mod.length&&n.modifies(c.output)}return n.changed()?n:t.StopPropagation}}),dt(aw,go,{transform(e,t){if(null!=this.value&&!e.modified())return t.StopPropagation;var n,r,i,a,s,o=t.dataflow.locale(),u=t.fork(t.NO_SOURCE|t.NO_FIELDS),l=this.value,c=e.type||Zp,d=e.scale,h=+e.limit,f=rg(d,null==e.count?5:e.count,e.minstep),p=!!e.values||c===Zp,g=e.format||dg(o,d,f,c,e.formatSpecifier,e.formatType,p),m=e.values||cg(d,f);return l&&(u.rem=l),c===Zp?(h&&m.length>h?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),l=m.slice(0,h-1),s=!0):l=m,Ke(i=e.size)?(e.values||0!==d(l[0])||(l=l.slice(1)),a=l.reduce(((t,n)=>Math.max(t,i(n,e))),0)):i=tt(a=i||8),l=l.map(((t,n)=>zs({index:n,label:g(t,n,l),value:t,offset:a,size:i(t,e)}))),s&&(s=m[l.length],l.push(zs({index:l.length,label:"".concat(m.length-l.length," entries"),value:s,offset:a,size:i(s,e)})))):"gradient"===c?(n=d.domain(),r=Hp(d,n[0],Fe(n)),m.length<3&&!e.values&&n[0]!==Fe(n)&&(m=[n[0],Fe(n)]),l=m.map(((e,t)=>zs({index:t,label:g(e,t,m),value:e,perc:r(e)})))):(i=m.length-1,r=function(e){const t=e.domain(),n=t.length-1;let r=+t[0],i=+Fe(t),a=i-r;if(e.type===yp){const e=n?a/n:.1;r-=e,i+=e,a=i-r}return e=>(e-r)/a}(d),l=m.map(((e,t)=>zs({index:t,label:g(e,t,m),value:e,perc:t?r(e):0,perc2:t===i?1:r(m[t+1])})))),u.source=l,u.add=l,this.value=l,u}});const sw=e=>e.source.x,ow=e=>e.source.y,uw=e=>e.target.x,lw=e=>e.target.y;function cw(e){go.call(this,{},e)}cw.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},dt(cw,go,{transform(e,t){var n=e.sourceX||sw,r=e.sourceY||ow,i=e.targetX||uw,a=e.targetY||lw,s=e.as||"path",o=e.orient||"vertical",u=e.shape||"line",l=pw.get(u+"-"+o)||pw.get(u);return l||se("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,(e=>{e[s]=l(n(e),r(e),i(e),a(e))})),t.reflow(e.modified()).modifies(s)}});const dw=(e,t,n,r)=>"M"+e+","+t+"L"+n+","+r,hw=(e,t,n,r)=>{var i=n-e,a=r-t,s=Math.sqrt(i*i+a*a)/2;return"M"+e+","+t+"A"+s+","+s+" "+180*Math.atan2(a,i)/Math.PI+" 0 1 "+n+","+r},fw=(e,t,n,r)=>{const i=n-e,a=r-t,s=.2*(i+a),o=.2*(a-i);return"M"+e+","+t+"C"+(e+s)+","+(t+o)+" "+(n+o)+","+(r-s)+" "+n+","+r},pw=lt({line:dw,"line-radial":(e,t,n,r)=>dw(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),arc:hw,"arc-radial":(e,t,n,r)=>hw(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),curve:fw,"curve-radial":(e,t,n,r)=>fw(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),"orthogonal-horizontal":(e,t,n,r)=>"M"+e+","+t+"V"+r+"H"+n,"orthogonal-vertical":(e,t,n,r)=>"M"+e+","+t+"H"+n+"V"+r,"orthogonal-radial":(e,t,n,r)=>{const i=Math.cos(e),a=Math.sin(e),s=Math.cos(n),o=Math.sin(n);return"M"+t*i+","+t*a+"A"+t+","+t+" 0 0,"+((Math.abs(n-e)>Math.PI?n<=e:n>e)?1:0)+" "+t*s+","+t*o+"L"+r*s+","+r*o},"diagonal-horizontal":(e,t,n,r)=>{const i=(e+n)/2;return"M"+e+","+t+"C"+i+","+t+" "+i+","+r+" "+n+","+r},"diagonal-vertical":(e,t,n,r)=>{const i=(t+r)/2;return"M"+e+","+t+"C"+e+","+i+" "+n+","+i+" "+n+","+r},"diagonal-radial":(e,t,n,r)=>{const i=Math.cos(e),a=Math.sin(e),s=Math.cos(n),o=Math.sin(n),u=(t+r)/2;return"M"+t*i+","+t*a+"C"+u*i+","+u*a+" "+u*s+","+u*o+" "+r*s+","+r*o}});function gw(e){go.call(this,null,e)}function mw(e){return Bp(e)&&e!==fp}gw.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},dt(gw,go,{transform(e,t){var n,r,i,a=e.as||["startAngle","endAngle"],s=a[0],o=a[1],u=e.field||he,l=e.startAngle||0,c=null!=e.endAngle?e.endAngle:2*Math.PI,d=t.source,h=d.map(u),f=h.length,p=l,g=(c-l)/ew(h),m=wu(f);for(e.sort&&m.sort(((e,t)=>h[e]-h[t])),n=0;n<f;++n)i=h[m[n]],(r=d[m[n]])[s]=p,r[o]=p+=i*g;return this.value=h,t.reflow(e.modified()).modifies(a)}});const yw=Nt(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function vw(e){go.call(this,null,e),this.modified(!0)}function bw(e,t,n){return Pp(e)&&Math.abs(t.reduce(((e,t)=>e+(t<0?-1:t>0?1:0)),0))!==t.length&&n.warn("Log scale domain includes zero: "+At(t)),t}function xw(e,t,n){return Ke(e)&&(t||n)?Vp(e,ww(t||[0,1],n)):e}function ww(e,t){return t?e.slice().reverse():e}function kw(e){go.call(this,null,e)}dt(vw,go,{transform(e,t){var n=t.dataflow,r=this.value,i=function(e){var t,n=e.type,r="";return n===fp?"sequential-linear":(function(e){const t=e.type;return Bp(t)&&t!==dp&&t!==hp&&(e.scheme||e.range&&e.range.length&&e.range.every(vt))}(e)&&(r=2===(t=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(null!=e.domainMid):0)?"sequential-":3===t?"diverging-":""),(r+n||sp).toLowerCase())}(e);for(i in r&&i===r.type||(this.value=r=Op(i)()),e)if(!yw[i]){if("padding"===i&&mw(r.type))continue;Ke(r[i])?r[i](e[i]):n.warn("Unsupported scale property: "+i)}return function(e,t,n){var r=e.type,i=t.round||!1,a=t.range;if(null!=t.rangeStep)a=function(e,t,n){e!==xp&&e!==bp&&se("Only band and point scales support rangeStep.");var r=(null!=t.paddingOuter?t.paddingOuter:t.padding)||0,i=e===bp?1:(null!=t.paddingInner?t.paddingInner:t.padding)||0;return[0,t.rangeStep*ap(n,i,r)]}(r,t,n);else if(t.scheme&&(a=function(e,t,n){var r,i=t.schemeExtent;return ke(t.scheme)?r=Gp(t.scheme,t.interpolate,t.interpolateGamma):(r=Jp(t.scheme.toLowerCase()))||se("Unrecognized scheme name: ".concat(t.scheme)),n=e===yp?n+1:e===wp?n-1:e===gp||e===mp?+t.schemeCount||5:n,jp(e)?xw(r,i,t.reverse):Ke(r)?qp(xw(r,i),n):e===vp?r:r.slice(0,n)}(r,t,n),Ke(a))){if(e.interpolator)return e.interpolator(a);se("Scale type ".concat(r," does not support interpolating color schemes."))}if(a&&jp(r))return e.interpolator(Gp(ww(a,t.reverse),t.interpolate,t.interpolateGamma));a&&t.interpolate&&e.interpolate?e.interpolate(Xp(t.interpolate,t.interpolateGamma)):Ke(e.round)?e.round(i):Ke(e.rangeRound)&&e.interpolate(i?bh:vh),a&&e.range(ww(a,t.reverse))}(r,e,function(e,t,n){let r=t.bins;if(r&&!ke(r)){const t=e.domain(),n=t[0],i=Fe(t),a=r.step;let s=null==r.start?n:r.start,o=null==r.stop?i:r.stop;a||se("Scale bins parameter missing step property."),s<n&&(s=a*Math.ceil(n/a)),o>i&&(o=a*Math.floor(i/a)),r=wu(s,o+a/2,a)}return r?e.bins=r:e.bins&&delete e.bins,e.type===wp&&(r?t.domain||t.domainRaw||(e.domain(r),n=r.length):e.bins=e.domain()),n}(r,e,function(e,t,n){const r=function(e,t,n){return t?(e.domain(bw(e.type,t,n)),t.length):-1}(e,t.domainRaw,n);if(r>-1)return r;var i,a,s=t.domain,o=e.type,u=t.zero||void 0===t.zero&&function(e){const t=e.type;return!e.bins&&(t===sp||t===up||t===lp)}(e);if(!s)return 0;if(mw(o)&&t.padding&&s[0]!==Fe(s)&&(s=function(e,t,n,r,i,a){var s=Math.abs(Fe(n)-n[0]),o=s/(s-2*r),u=e===op?Ue(t,null,o):e===lp?We(t,null,o,.5):e===up?We(t,null,o,i||1):e===cp?Ve(t,null,o,a||1):je(t,null,o);return(t=t.slice())[0]=u[0],t[t.length-1]=u[1],t}(o,s,t.range,t.padding,t.exponent,t.constant)),(u||null!=t.domainMin||null!=t.domainMax||null!=t.domainMid)&&(i=(s=s.slice()).length-1||1,u&&(s[0]>0&&(s[0]=0),s[i]<0&&(s[i]=0)),null!=t.domainMin&&(s[0]=t.domainMin),null!=t.domainMax&&(s[i]=t.domainMax),null!=t.domainMid)){const e=(a=t.domainMid)>s[i]?i+1:a<s[0]?0:i;e!==i&&n.warn("Scale domainMid exceeds domain min or max.",a),s.splice(e,0,a)}return e.domain(bw(o,s,n)),o===vp&&e.unknown(t.domainImplicit?gd:void 0),t.nice&&e.nice&&e.nice(!0!==t.nice&&rg(e,t.nice)||null),s.length}(r,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),dt(kw,go,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(Us(e.sort)),this.modified(n),t}});const _w="zero",Sw="center",Cw="normalize",Aw=["y0","y1"];function Ew(e){go.call(this,null,e)}function Fw(e,t,n,r,i){for(var a,s=(t-e.sum)/2,o=e.length,u=0;u<o;++u)(a=e[u])[r]=s,a[i]=s+=Math.abs(n(a))}function Iw(e,t,n,r,i){for(var a,s=1/e.sum,o=0,u=e.length,l=0,c=0;l<u;++l)(a=e[l])[r]=o,a[i]=o=s*(c+=Math.abs(n(a)))}function Dw(e,t,n,r,i){for(var a,s,o=0,u=0,l=e.length,c=0;c<l;++c)(a=+n(s=e[c]))<0?(s[r]=u,s[i]=u+=a):(s[r]=o,s[i]=o+=a)}Ew.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:_w,values:[_w,Sw,Cw]},{name:"as",type:"string",array:!0,length:2,default:Aw}]},dt(Ew,go,{transform(e,t){var n,r,i,a,s=e.as||Aw,o=s[0],u=s[1],l=Us(e.sort),c=e.field||he,d=e.offset===Sw?Fw:e.offset===Cw?Iw:Dw;for(n=function(e,t,n,r){var i,a,s,o,u,l,c,d,h,f=[],p=e=>e(u);if(null==t)f.push(e.slice());else for(i={},a=0,s=e.length;a<s;++a)u=e[a],(c=i[l=t.map(p)])||(i[l]=c=[],f.push(c)),c.push(u);for(l=0,h=0,o=f.length;l<o;++l){for(a=0,d=0,s=(c=f[l]).length;a<s;++a)d+=Math.abs(r(c[a]));c.sum=d,d>h&&(h=d),n&&c.sort(n)}return f.max=h,f}(t.source,e.groupby,l,c),r=0,i=n.length,a=n.max;r<i;++r)d(n[r],a,c,o,u);return t.reflow(e.modified()).modifies(s)}});const Nw=e=>e;function $w(e,t){e&&Ow.hasOwnProperty(e.type)&&Ow[e.type](e,t)}var Tw={Feature:function(e,t){$w(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)$w(n[r].geometry,t)}},Ow={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){Mw(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)Mw(n[r],t,0)},Polygon:function(e,t){Rw(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)Rw(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)$w(n[r],t)}};function Mw(e,t,n){var r,i=-1,a=e.length-n;for(t.lineStart();++i<a;)r=e[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function Rw(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)Mw(e[n],t,1);t.polygonEnd()}function Bw(e,t){e&&Tw.hasOwnProperty(e.type)?Tw[e.type](e,t):$w(e,t)}class zw{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let n=0;for(let r=0;r<this._n&&r<32;r++){const i=t[r],a=e+i,s=Math.abs(e)<Math.abs(i)?e-(a-i):i-(a-e);s&&(t[n++]=s),e=a}return t[n]=e,this._n=n+1,this}valueOf(){const e=this._partials;let t,n,r,i=this._n,a=0;if(i>0){for(a=e[--i];i>0&&(t=a,n=e[--i],a=t+n,r=n-(a-t),!r););i>0&&(r<0&&e[i-1]<0||r>0&&e[i-1]>0)&&(n=2*r,t=a+n,n==t-a&&(a=t))}return a}}var Lw=1e-6,Pw=1e-12,jw=Math.PI,Uw=jw/2,Ww=jw/4,Vw=2*jw,Gw=180/jw,qw=jw/180,Hw=Math.abs,Xw=Math.atan,Kw=Math.atan2,Yw=Math.cos,Qw=Math.ceil,Jw=Math.exp,Zw=(Math.floor,Math.hypot),ek=Math.log,tk=Math.pow,nk=Math.sin,rk=Math.sign||function(e){return e>0?1:e<0?-1:0},ik=Math.sqrt,ak=Math.tan;function sk(e){return e>1?0:e<-1?jw:Math.acos(e)}function ok(e){return e>1?Uw:e<-1?-Uw:Math.asin(e)}function uk(){}var lk,ck,dk,hk,fk=new zw,pk=new zw,gk={point:uk,lineStart:uk,lineEnd:uk,polygonStart:function(){gk.lineStart=mk,gk.lineEnd=bk},polygonEnd:function(){gk.lineStart=gk.lineEnd=gk.point=uk,fk.add(Hw(pk)),pk=new zw},result:function(){var e=fk/2;return fk=new zw,e}};function mk(){gk.point=yk}function yk(e,t){gk.point=vk,lk=dk=e,ck=hk=t}function vk(e,t){pk.add(hk*e-dk*t),dk=e,hk=t}function bk(){vk(lk,ck)}const xk=gk;var wk=1/0,kk=wk,_k=-wk,Sk=_k,Ck={point:function(e,t){e<wk&&(wk=e),e>_k&&(_k=e),t<kk&&(kk=t),t>Sk&&(Sk=t)},lineStart:uk,lineEnd:uk,polygonStart:uk,polygonEnd:uk,result:function(){var e=[[wk,kk],[_k,Sk]];return _k=Sk=-(kk=wk=1/0),e}};const Ak=Ck;var Ek,Fk,Ik,Dk,Nk=0,$k=0,Tk=0,Ok=0,Mk=0,Rk=0,Bk=0,zk=0,Lk=0,Pk={point:jk,lineStart:Uk,lineEnd:Gk,polygonStart:function(){Pk.lineStart=qk,Pk.lineEnd=Hk},polygonEnd:function(){Pk.point=jk,Pk.lineStart=Uk,Pk.lineEnd=Gk},result:function(){var e=Lk?[Bk/Lk,zk/Lk]:Rk?[Ok/Rk,Mk/Rk]:Tk?[Nk/Tk,$k/Tk]:[NaN,NaN];return Nk=$k=Tk=Ok=Mk=Rk=Bk=zk=Lk=0,e}};function jk(e,t){Nk+=e,$k+=t,++Tk}function Uk(){Pk.point=Wk}function Wk(e,t){Pk.point=Vk,jk(Ik=e,Dk=t)}function Vk(e,t){var n=e-Ik,r=t-Dk,i=ik(n*n+r*r);Ok+=i*(Ik+e)/2,Mk+=i*(Dk+t)/2,Rk+=i,jk(Ik=e,Dk=t)}function Gk(){Pk.point=jk}function qk(){Pk.point=Xk}function Hk(){Kk(Ek,Fk)}function Xk(e,t){Pk.point=Kk,jk(Ek=Ik=e,Fk=Dk=t)}function Kk(e,t){var n=e-Ik,r=t-Dk,i=ik(n*n+r*r);Ok+=i*(Ik+e)/2,Mk+=i*(Dk+t)/2,Rk+=i,Bk+=(i=Dk*e-Ik*t)*(Ik+e),zk+=i*(Dk+t),Lk+=3*i,jk(Ik=e,Dk=t)}const Yk=Pk;function Qk(e){this._context=e}Qk.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,Vw)}},result:uk};var Jk,Zk,e_,t_,n_,r_=new zw,i_={point:uk,lineStart:function(){i_.point=a_},lineEnd:function(){Jk&&s_(Zk,e_),i_.point=uk},polygonStart:function(){Jk=!0},polygonEnd:function(){Jk=null},result:function(){var e=+r_;return r_=new zw,e}};function a_(e,t){i_.point=s_,Zk=t_=e,e_=n_=t}function s_(e,t){t_-=e,n_-=t,r_.add(ik(t_*t_+n_*n_)),t_=e,n_=t}const o_=i_;function u_(){this._string=[]}function l_(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function c_(e,t){var n,r,i=4.5;function a(e){return e&&("function"==typeof i&&r.pointRadius(+i.apply(this,arguments)),Bw(e,n(r))),r.result()}return a.area=function(e){return Bw(e,n(xk)),xk.result()},a.measure=function(e){return Bw(e,n(o_)),o_.result()},a.bounds=function(e){return Bw(e,n(Ak)),Ak.result()},a.centroid=function(e){return Bw(e,n(Yk)),Yk.result()},a.projection=function(t){return arguments.length?(n=null==t?(e=null,Nw):(e=t).stream,a):e},a.context=function(e){return arguments.length?(r=null==e?(t=null,new u_):new Qk(t=e),"function"!=typeof i&&r.pointRadius(i),a):t},a.pointRadius=function(e){return arguments.length?(i="function"==typeof e?e:(r.pointRadius(+e),+e),a):i},a.projection(e).context(t)}function d_(){var e,t=[];return{point:function(t,n,r){e.push([t,n,r])},lineStart:function(){t.push(e=[])},lineEnd:uk,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function h_(e,t){return Hw(e[0]-t[0])<Lw&&Hw(e[1]-t[1])<Lw}function f_(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function p_(e,t,n,r,i){var a,s,o=[],u=[];if(e.forEach((function(e){if(!((t=e.length-1)<=0)){var t,n,r=e[0],s=e[t];if(h_(r,s)){if(!r[2]&&!s[2]){for(i.lineStart(),a=0;a<t;++a)i.point((r=e[a])[0],r[1]);return void i.lineEnd()}s[0]+=2e-6}o.push(n=new f_(r,e,null,!0)),u.push(n.o=new f_(r,null,n,!1)),o.push(n=new f_(s,e,null,!1)),u.push(n.o=new f_(s,null,n,!0))}})),o.length){for(u.sort(t),g_(o),g_(u),a=0,s=u.length;a<s;++a)u[a].e=n=!n;for(var l,c,d=o[0];;){for(var h=d,f=!0;h.v;)if((h=h.n)===d)return;l=h.z,i.lineStart();do{if(h.v=h.o.v=!0,h.e){if(f)for(a=0,s=l.length;a<s;++a)i.point((c=l[a])[0],c[1]);else r(h.x,h.n.x,1,i);h=h.n}else{if(f)for(l=h.p.z,a=l.length-1;a>=0;--a)i.point((c=l[a])[0],c[1]);else r(h.x,h.p.x,-1,i);h=h.p}l=(h=h.o).z,f=!f}while(!h.v);i.lineEnd()}}}function g_(e){if(t=e.length){for(var t,n,r=0,i=e[0];++r<t;)i.n=n=e[r],n.p=i,i=n;i.n=n=e[0],n.p=i}}function m_(e){return[Kw(e[1],e[0]),ok(e[2])]}function y_(e){var t=e[0],n=e[1],r=Yw(n);return[r*Yw(t),r*nk(t),nk(n)]}function v_(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function b_(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function x_(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function w_(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function k_(e){var t=ik(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function __(e){return Hw(e[0])<=jw?e[0]:rk(e[0])*((Hw(e[0])+jw)%Vw-jw)}function S_(e){return Array.from(function*(e){for(const t of e)yield*t}(e))}function C_(e,t,n,r){return function(i){var a,s,o,u=t(i),l=d_(),c=t(l),d=!1,h={point:f,lineStart:g,lineEnd:m,polygonStart:function(){h.point=y,h.lineStart=v,h.lineEnd=b,s=[],a=[]},polygonEnd:function(){h.point=f,h.lineStart=g,h.lineEnd=m,s=S_(s);var e=function(e,t){var n=__(t),r=t[1],i=nk(r),a=[nk(n),-Yw(n),0],s=0,o=0,u=new zw;1===i?r=Uw+Lw:-1===i&&(r=-Uw-Lw);for(var l=0,c=e.length;l<c;++l)if(h=(d=e[l]).length)for(var d,h,f=d[h-1],p=__(f),g=f[1]/2+Ww,m=nk(g),y=Yw(g),v=0;v<h;++v,p=x,m=k,y=_,f=b){var b=d[v],x=__(b),w=b[1]/2+Ww,k=nk(w),_=Yw(w),S=x-p,C=S>=0?1:-1,A=C*S,E=A>jw,F=m*k;if(u.add(Kw(F*C*nk(A),y*_+F*Yw(A))),s+=E?S+C*Vw:S,E^p>=n^x>=n){var I=b_(y_(f),y_(b));k_(I);var D=b_(a,I);k_(D);var N=(E^S>=0?-1:1)*ok(D[2]);(r>N||r===N&&(I[0]||I[1]))&&(o+=E^S>=0?1:-1)}}return(s<-1e-6||s<Lw&&u<-1e-12)^1&o}(a,r);s.length?(d||(i.polygonStart(),d=!0),p_(s,E_,e,n,i)):e&&(d||(i.polygonStart(),d=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),d&&(i.polygonEnd(),d=!1),s=a=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function f(t,n){e(t,n)&&i.point(t,n)}function p(e,t){u.point(e,t)}function g(){h.point=p,u.lineStart()}function m(){h.point=f,u.lineEnd()}function y(e,t){o.push([e,t]),c.point(e,t)}function v(){c.lineStart(),o=[]}function b(){y(o[0][0],o[0][1]),c.lineEnd();var e,t,n,r,u=c.clean(),h=l.result(),f=h.length;if(o.pop(),a.push(o),o=null,f)if(1&u){if((t=(n=h[0]).length-1)>0){for(d||(i.polygonStart(),d=!0),i.lineStart(),e=0;e<t;++e)i.point((r=n[e])[0],r[1]);i.lineEnd()}}else f>1&&2&u&&h.push(h.pop().concat(h.shift())),s.push(h.filter(A_))}return h}}function A_(e){return e.length>1}function E_(e,t){return((e=e.x)[0]<0?e[1]-Uw-Lw:Uw-e[1])-((t=t.x)[0]<0?t[1]-Uw-Lw:Uw-t[1])}u_.prototype={_radius:4.5,_circle:l_(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._string.push("M",e,",",t),this._point=1;break;case 1:this._string.push("L",e,",",t);break;default:null==this._circle&&(this._circle=l_(this._radius)),this._string.push("M",e,",",t,this._circle)}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}return null}};const F_=C_((function(){return!0}),(function(e){var t,n=NaN,r=NaN,i=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(a,s){var o=a>0?jw:-jw,u=Hw(a-n);Hw(u-jw)<Lw?(e.point(n,r=(r+s)/2>0?Uw:-Uw),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(o,r),e.point(a,r),t=0):i!==o&&u>=jw&&(Hw(n-i)<Lw&&(n-=i*Lw),Hw(a-o)<Lw&&(a-=o*Lw),r=function(e,t,n,r){var i,a,s=nk(e-n);return Hw(s)>Lw?Xw((nk(t)*(a=Yw(r))*nk(n)-nk(r)*(i=Yw(t))*nk(e))/(i*a*s)):(t+r)/2}(n,r,a,s),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(o,r),t=0),e.point(n=a,r=s),i=o},lineEnd:function(){e.lineEnd(),n=r=NaN},clean:function(){return 2-t}}}),(function(e,t,n,r){var i;if(null==e)i=n*Uw,r.point(-jw,i),r.point(0,i),r.point(jw,i),r.point(jw,0),r.point(jw,-i),r.point(0,-i),r.point(-jw,-i),r.point(-jw,0),r.point(-jw,i);else if(Hw(e[0]-t[0])>Lw){var a=e[0]<t[0]?jw:-jw;i=n*a/2,r.point(-a,i),r.point(0,i),r.point(a,i)}else r.point(t[0],t[1])}),[-jw,-Uw]);function I_(e,t){(t=y_(t))[0]-=e,k_(t);var n=sk(-t[1]);return((-t[2]<0?-n:n)+Vw-Lw)%Vw}function D_(e){var t=Yw(e),n=6*qw,r=t>0,i=Hw(t)>Lw;function a(e,n){return Yw(e)*Yw(n)>t}function s(e,n,r){var i=[1,0,0],a=b_(y_(e),y_(n)),s=v_(a,a),o=a[0],u=s-o*o;if(!u)return!r&&e;var l=t*s/u,c=-t*o/u,d=b_(i,a),h=w_(i,l);x_(h,w_(a,c));var f=d,p=v_(h,f),g=v_(f,f),m=p*p-g*(v_(h,h)-1);if(!(m<0)){var y=ik(m),v=w_(f,(-p-y)/g);if(x_(v,h),v=m_(v),!r)return v;var b,x=e[0],w=n[0],k=e[1],_=n[1];w<x&&(b=x,x=w,w=b);var S=w-x,C=Hw(S-jw)<Lw;if(!C&&_<k&&(b=k,k=_,_=b),C||S<Lw?C?k+_>0^v[1]<(Hw(v[0]-x)<Lw?k:_):k<=v[1]&&v[1]<=_:S>jw^(x<=v[0]&&v[0]<=w)){var A=w_(f,(-p+y)/g);return x_(A,h),[v,m_(A)]}}}function o(t,n){var i=r?e:jw-e,a=0;return t<-i?a|=1:t>i&&(a|=2),n<-i?a|=4:n>i&&(a|=8),a}return C_(a,(function(e){var t,n,u,l,c;return{lineStart:function(){l=u=!1,c=1},point:function(d,h){var f,p=[d,h],g=a(d,h),m=r?g?0:o(d,h):g?o(d+(d<0?jw:-jw),h):0;if(!t&&(l=u=g)&&e.lineStart(),g!==u&&(!(f=s(t,p))||h_(t,f)||h_(p,f))&&(p[2]=1),g!==u)c=0,g?(e.lineStart(),f=s(p,t),e.point(f[0],f[1])):(f=s(t,p),e.point(f[0],f[1],2),e.lineEnd()),t=f;else if(i&&t&&r^g){var y;m&n||!(y=s(p,t,!0))||(c=0,r?(e.lineStart(),e.point(y[0][0],y[0][1]),e.point(y[1][0],y[1][1]),e.lineEnd()):(e.point(y[1][0],y[1][1]),e.lineEnd(),e.lineStart(),e.point(y[0][0],y[0][1],3)))}!g||t&&h_(t,p)||e.point(p[0],p[1]),t=p,u=g,n=m},lineEnd:function(){u&&e.lineEnd(),t=null},clean:function(){return c|(l&&u)<<1}}}),(function(t,r,i,a){!function(e,t,n,r,i,a){if(n){var s=Yw(t),o=nk(t),u=r*n;null==i?(i=t+r*Vw,a=t-u/2):(i=I_(s,i),a=I_(s,a),(r>0?i<a:i>a)&&(i+=r*Vw));for(var l,c=i;r>0?c>a:c<a;c-=u)l=m_([s,-o*Yw(c),-o*nk(c)]),e.point(l[0],l[1])}}(a,e,n,i,t,r)}),r?[0,-e]:[-jw,e-jw])}var N_=1e9,$_=-N_;function T_(e,t,n,r){function i(i,a){return e<=i&&i<=n&&t<=a&&a<=r}function a(i,a,o,l){var c=0,d=0;if(null==i||(c=s(i,o))!==(d=s(a,o))||u(i,a)<0^o>0)do{l.point(0===c||3===c?e:n,c>1?r:t)}while((c=(c+o+4)%4)!==d);else l.point(a[0],a[1])}function s(r,i){return Hw(r[0]-e)<Lw?i>0?0:3:Hw(r[0]-n)<Lw?i>0?2:1:Hw(r[1]-t)<Lw?i>0?1:0:i>0?3:2}function o(e,t){return u(e.x,t.x)}function u(e,t){var n=s(e,1),r=s(t,1);return n!==r?n-r:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(s){var u,l,c,d,h,f,p,g,m,y,v,b=s,x=d_(),w={point:k,lineStart:function(){w.point=_,l&&l.push(c=[]),y=!0,m=!1,p=g=NaN},lineEnd:function(){u&&(_(d,h),f&&m&&x.rejoin(),u.push(x.result())),w.point=k,m&&b.lineEnd()},polygonStart:function(){b=x,u=[],l=[],v=!0},polygonEnd:function(){var t=function(){for(var t=0,n=0,i=l.length;n<i;++n)for(var a,s,o=l[n],u=1,c=o.length,d=o[0],h=d[0],f=d[1];u<c;++u)a=h,s=f,h=(d=o[u])[0],f=d[1],s<=r?f>r&&(h-a)*(r-s)>(f-s)*(e-a)&&++t:f<=r&&(h-a)*(r-s)<(f-s)*(e-a)&&--t;return t}(),n=v&&t,i=(u=S_(u)).length;(n||i)&&(s.polygonStart(),n&&(s.lineStart(),a(null,null,1,s),s.lineEnd()),i&&p_(u,o,t,a,s),s.polygonEnd()),b=s,u=l=c=null}};function k(e,t){i(e,t)&&b.point(e,t)}function _(a,s){var o=i(a,s);if(l&&c.push([a,s]),y)d=a,h=s,f=o,y=!1,o&&(b.lineStart(),b.point(a,s));else if(o&&m)b.point(a,s);else{var u=[p=Math.max($_,Math.min(N_,p)),g=Math.max($_,Math.min(N_,g))],x=[a=Math.max($_,Math.min(N_,a)),s=Math.max($_,Math.min(N_,s))];!function(e,t,n,r,i,a){var s,o=e[0],u=e[1],l=0,c=1,d=t[0]-o,h=t[1]-u;if(s=n-o,d||!(s>0)){if(s/=d,d<0){if(s<l)return;s<c&&(c=s)}else if(d>0){if(s>c)return;s>l&&(l=s)}if(s=i-o,d||!(s<0)){if(s/=d,d<0){if(s>c)return;s>l&&(l=s)}else if(d>0){if(s<l)return;s<c&&(c=s)}if(s=r-u,h||!(s>0)){if(s/=h,h<0){if(s<l)return;s<c&&(c=s)}else if(h>0){if(s>c)return;s>l&&(l=s)}if(s=a-u,h||!(s<0)){if(s/=h,h<0){if(s>c)return;s>l&&(l=s)}else if(h>0){if(s<l)return;s<c&&(c=s)}return l>0&&(e[0]=o+l*d,e[1]=u+l*h),c<1&&(t[0]=o+c*d,t[1]=u+c*h),!0}}}}}(u,x,e,t,n,r)?o&&(b.lineStart(),b.point(a,s),v=!1):(m||(b.lineStart(),b.point(u[0],u[1])),b.point(x[0],x[1]),o||b.lineEnd(),v=!1)}p=a,g=s,m=o}return w}}function O_(e,t){function n(n,r){return n=e(n,r),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,r){return(n=t.invert(n,r))&&e.invert(n[0],n[1])}),n}function M_(e,t){return[Hw(e)>jw?e+Math.round(-e/Vw)*Vw:e,t]}function R_(e,t,n){return(e%=Vw)?t||n?O_(z_(e),L_(t,n)):z_(e):t||n?L_(t,n):M_}function B_(e){return function(t,n){return[(t+=e)>jw?t-Vw:t<-jw?t+Vw:t,n]}}function z_(e){var t=B_(e);return t.invert=B_(-e),t}function L_(e,t){var n=Yw(e),r=nk(e),i=Yw(t),a=nk(t);function s(e,t){var s=Yw(t),o=Yw(e)*s,u=nk(e)*s,l=nk(t),c=l*n+o*r;return[Kw(u*i-c*a,o*n-l*r),ok(c*i+u*a)]}return s.invert=function(e,t){var s=Yw(t),o=Yw(e)*s,u=nk(e)*s,l=nk(t),c=l*i-u*a;return[Kw(u*i+l*a,o*n+c*r),ok(c*n-o*r)]},s}function P_(e){return function(t){var n=new j_;for(var r in e)n[r]=e[r];return n.stream=t,n}}function j_(){}function U_(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),null!=r&&e.clipExtent(null),Bw(n,e.stream(Ak)),t(Ak.result()),null!=r&&e.clipExtent(r),e}function W_(e,t,n){return U_(e,(function(n){var r=t[1][0]-t[0][0],i=t[1][1]-t[0][1],a=Math.min(r/(n[1][0]-n[0][0]),i/(n[1][1]-n[0][1])),s=+t[0][0]+(r-a*(n[1][0]+n[0][0]))/2,o=+t[0][1]+(i-a*(n[1][1]+n[0][1]))/2;e.scale(150*a).translate([s,o])}),n)}function V_(e,t,n){return W_(e,[[0,0],t],n)}function G_(e,t,n){return U_(e,(function(n){var r=+t,i=r/(n[1][0]-n[0][0]),a=(r-i*(n[1][0]+n[0][0]))/2,s=-i*n[0][1];e.scale(150*i).translate([a,s])}),n)}function q_(e,t,n){return U_(e,(function(n){var r=+t,i=r/(n[1][1]-n[0][1]),a=-i*n[0][0],s=(r-i*(n[1][1]+n[0][1]))/2;e.scale(150*i).translate([a,s])}),n)}M_.invert=M_,j_.prototype={constructor:j_,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var H_=Yw(30*qw);function X_(e,t){return+t?function(e,t){function n(r,i,a,s,o,u,l,c,d,h,f,p,g,m){var y=l-r,v=c-i,b=y*y+v*v;if(b>4*t&&g--){var x=s+h,w=o+f,k=u+p,_=ik(x*x+w*w+k*k),S=ok(k/=_),C=Hw(Hw(k)-1)<Lw||Hw(a-d)<Lw?(a+d)/2:Kw(w,x),A=e(C,S),E=A[0],F=A[1],I=E-r,D=F-i,N=v*I-y*D;(N*N/b>t||Hw((y*I+v*D)/b-.5)>.3||s*h+o*f+u*p<H_)&&(n(r,i,a,s,o,u,E,F,C,x/=_,w/=_,k,g,m),m.point(E,F),n(E,F,C,x,w,k,l,c,d,h,f,p,g,m))}}return function(t){var r,i,a,s,o,u,l,c,d,h,f,p,g={point:m,lineStart:y,lineEnd:b,polygonStart:function(){t.polygonStart(),g.lineStart=x},polygonEnd:function(){t.polygonEnd(),g.lineStart=y}};function m(n,r){n=e(n,r),t.point(n[0],n[1])}function y(){c=NaN,g.point=v,t.lineStart()}function v(r,i){var a=y_([r,i]),s=e(r,i);n(c,d,l,h,f,p,c=s[0],d=s[1],l=r,h=a[0],f=a[1],p=a[2],16,t),t.point(c,d)}function b(){g.point=m,t.lineEnd()}function x(){y(),g.point=w,g.lineEnd=k}function w(e,t){v(r=e,t),i=c,a=d,s=h,o=f,u=p,g.point=v}function k(){n(c,d,l,h,f,p,i,a,r,s,o,u,16,t),g.lineEnd=b,b()}return g}}(e,t):function(e){return P_({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}(e)}var K_=P_({point:function(e,t){this.stream.point(e*qw,t*qw)}});function Y_(e,t,n,r,i,a){if(!a)return function(e,t,n,r,i){function a(a,s){return[t+e*(a*=r),n-e*(s*=i)]}return a.invert=function(a,s){return[(a-t)/e*r,(n-s)/e*i]},a}(e,t,n,r,i);var s=Yw(a),o=nk(a),u=s*e,l=o*e,c=s/e,d=o/e,h=(o*n-s*t)/e,f=(o*t+s*n)/e;function p(e,a){return[u*(e*=r)-l*(a*=i)+t,n-l*e-u*a]}return p.invert=function(e,t){return[r*(c*e-d*t+h),i*(f-d*e-c*t)]},p}function Q_(e){return J_((function(){return e}))()}function J_(e){var t,n,r,i,a,s,o,u,l,c,d=150,h=480,f=250,p=0,g=0,m=0,y=0,v=0,b=0,x=1,w=1,k=null,_=F_,S=null,C=Nw,A=.5;function E(e){return u(e[0]*qw,e[1]*qw)}function F(e){return(e=u.invert(e[0],e[1]))&&[e[0]*Gw,e[1]*Gw]}function I(){var e=Y_(d,0,0,x,w,b).apply(null,t(p,g)),r=Y_(d,h-e[0],f-e[1],x,w,b);return n=R_(m,y,v),o=O_(t,r),u=O_(n,o),s=X_(o,A),D()}function D(){return l=c=null,E}return E.stream=function(e){return l&&c===e?l:l=K_(function(e){return P_({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}(n)(_(s(C(c=e)))))},E.preclip=function(e){return arguments.length?(_=e,k=void 0,D()):_},E.postclip=function(e){return arguments.length?(C=e,S=r=i=a=null,D()):C},E.clipAngle=function(e){return arguments.length?(_=+e?D_(k=e*qw):(k=null,F_),D()):k*Gw},E.clipExtent=function(e){return arguments.length?(C=null==e?(S=r=i=a=null,Nw):T_(S=+e[0][0],r=+e[0][1],i=+e[1][0],a=+e[1][1]),D()):null==S?null:[[S,r],[i,a]]},E.scale=function(e){return arguments.length?(d=+e,I()):d},E.translate=function(e){return arguments.length?(h=+e[0],f=+e[1],I()):[h,f]},E.center=function(e){return arguments.length?(p=e[0]%360*qw,g=e[1]%360*qw,I()):[p*Gw,g*Gw]},E.rotate=function(e){return arguments.length?(m=e[0]%360*qw,y=e[1]%360*qw,v=e.length>2?e[2]%360*qw:0,I()):[m*Gw,y*Gw,v*Gw]},E.angle=function(e){return arguments.length?(b=e%360*qw,I()):b*Gw},E.reflectX=function(e){return arguments.length?(x=e?-1:1,I()):x<0},E.reflectY=function(e){return arguments.length?(w=e?-1:1,I()):w<0},E.precision=function(e){return arguments.length?(s=X_(o,A=e*e),D()):ik(A)},E.fitExtent=function(e,t){return W_(E,e,t)},E.fitSize=function(e,t){return V_(E,e,t)},E.fitWidth=function(e,t){return G_(E,e,t)},E.fitHeight=function(e,t){return q_(E,e,t)},function(){return t=e.apply(this,arguments),E.invert=t.invert&&F,I()}}function Z_(e){var t=0,n=jw/3,r=J_(e),i=r(t,n);return i.parallels=function(e){return arguments.length?r(t=e[0]*qw,n=e[1]*qw):[t*Gw,n*Gw]},i}function eS(e,t){var n=nk(e),r=(n+nk(t))/2;if(Hw(r)<Lw)return function(e){var t=Yw(e);function n(e,n){return[e*t,nk(n)/t]}return n.invert=function(e,n){return[e/t,ok(n*t)]},n}(e);var i=1+n*(2*r-n),a=ik(i)/r;function s(e,t){var n=ik(i-2*r*nk(t))/r;return[n*nk(e*=r),a-n*Yw(e)]}return s.invert=function(e,t){var n=a-t,s=Kw(e,Hw(n))*rk(n);return n*r<0&&(s-=jw*rk(e)*rk(n)),[s/r,ok((i-(e*e+n*n)*r*r)/(2*r))]},s}function tS(){return Z_(eS).scale(155.424).center([0,33.6442])}function nS(){return tS().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function rS(e){return function(t,n){var r=Yw(t),i=Yw(n),a=e(r*i);return a===1/0?[2,0]:[a*i*nk(t),a*nk(n)]}}function iS(e){return function(t,n){var r=ik(t*t+n*n),i=e(r),a=nk(i),s=Yw(i);return[Kw(t*a,r*s),ok(r&&n*a/r)]}}var aS=rS((function(e){return ik(2/(1+e))}));aS.invert=iS((function(e){return 2*ok(e/2)}));var sS=rS((function(e){return(e=sk(e))&&e/nk(e)}));function oS(e,t){return[e,ek(ak((Uw+t)/2))]}function uS(e){var t,n,r,i=Q_(e),a=i.center,s=i.scale,o=i.translate,u=i.clipExtent,l=null;function c(){var a=jw*s(),o=i(function(e){function t(t){return(t=e(t[0]*qw,t[1]*qw))[0]*=Gw,t[1]*=Gw,t}return e=R_(e[0]*qw,e[1]*qw,e.length>2?e[2]*qw:0),t.invert=function(t){return(t=e.invert(t[0]*qw,t[1]*qw))[0]*=Gw,t[1]*=Gw,t},t}(i.rotate()).invert([0,0]));return u(null==l?[[o[0]-a,o[1]-a],[o[0]+a,o[1]+a]]:e===oS?[[Math.max(o[0]-a,l),t],[Math.min(o[0]+a,n),r]]:[[l,Math.max(o[1]-a,t)],[n,Math.min(o[1]+a,r)]])}return i.scale=function(e){return arguments.length?(s(e),c()):s()},i.translate=function(e){return arguments.length?(o(e),c()):o()},i.center=function(e){return arguments.length?(a(e),c()):a()},i.clipExtent=function(e){return arguments.length?(null==e?l=t=n=r=null:(l=+e[0][0],t=+e[0][1],n=+e[1][0],r=+e[1][1]),c()):null==l?null:[[l,t],[n,r]]},c()}function lS(e){return ak((Uw+e)/2)}function cS(e,t){var n=Yw(e),r=e===t?nk(e):ek(n/Yw(t))/ek(lS(t)/lS(e)),i=n*tk(lS(e),r)/r;if(!r)return oS;function a(e,t){i>0?t<-Uw+Lw&&(t=-Uw+Lw):t>Uw-Lw&&(t=Uw-Lw);var n=i/tk(lS(t),r);return[n*nk(r*e),i-n*Yw(r*e)]}return a.invert=function(e,t){var n=i-t,a=rk(r)*ik(e*e+n*n),s=Kw(e,Hw(n))*rk(n);return n*r<0&&(s-=jw*rk(e)*rk(n)),[s/r,2*Xw(tk(i/a,1/r))-Uw]},a}function dS(e,t){return[e,t]}function hS(e,t){var n=Yw(e),r=e===t?nk(e):(n-Yw(t))/(t-e),i=n/r+e;if(Hw(r)<Lw)return dS;function a(e,t){var n=i-t,a=r*e;return[n*nk(a),i-n*Yw(a)]}return a.invert=function(e,t){var n=i-t,a=Kw(e,Hw(n))*rk(n);return n*r<0&&(a-=jw*rk(e)*rk(n)),[a/r,i-rk(r)*ik(e*e+n*n)]},a}sS.invert=iS((function(e){return e})),oS.invert=function(e,t){return[e,2*Xw(Jw(t))-Uw]},dS.invert=dS;var fS=1.340264,pS=-.081106,gS=893e-6,mS=.003796,yS=ik(3)/2;function vS(e,t){var n=ok(yS*nk(t)),r=n*n,i=r*r*r;return[e*Yw(n)/(yS*(fS+3*pS*r+i*(7*gS+9*mS*r))),n*(fS+pS*r+i*(gS+mS*r))]}function bS(e,t){var n=Yw(t),r=Yw(e)*n;return[n*nk(e)/r,nk(t)/r]}function xS(e,t){var n=t*t,r=n*n;return[e*(.8707-.131979*n+r*(r*(.003971*n-.001529*r)-.013791)),t*(1.007226+n*(.015085+r*(.028874*n-.044475-.005916*r)))]}function wS(e,t){return[Yw(t)*nk(e),nk(t)]}function kS(e,t){var n=Yw(t),r=1+Yw(e)*n;return[n*nk(e)/r,nk(t)/r]}function _S(e,t){return[ek(ak((Uw+t)/2)),-e]}vS.invert=function(e,t){for(var n,r=t,i=r*r,a=i*i*i,s=0;s<12&&(a=(i=(r-=n=(r*(fS+pS*i+a*(gS+mS*i))-t)/(fS+3*pS*i+a*(7*gS+9*mS*i)))*r)*i*i,!(Hw(n)<Pw));++s);return[yS*e*(fS+3*pS*i+a*(7*gS+9*mS*i))/Yw(r),ok(nk(r)/yS)]},bS.invert=iS(Xw),xS.invert=function(e,t){var n,r=t,i=25;do{var a=r*r,s=a*a;r-=n=(r*(1.007226+a*(.015085+s*(.028874*a-.044475-.005916*s)))-t)/(1.007226+a*(.045255+s*(.259866*a-.311325-.005916*11*s)))}while(Hw(n)>Lw&&--i>0);return[e/(.8707+(a=r*r)*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979)),r]},wS.invert=iS(ok),kS.invert=iS((function(e){return 2*Xw(e)})),_S.invert=function(e,t){return[-t,2*Xw(Jw(e))-Uw]};var SS=Math.abs,CS=(Math.atan,Math.atan2,Math.ceil,Math.cos),AS=(Math.exp,Math.floor,Math.log,Math.max,Math.min,Math.pow,Math.round,Math.sign,Math.sin),ES=(Math.tan,Math.PI),FS=ES/2,IS=(Math.SQRT1_2,NS(2));function DS(e){return e>1?FS:e<-1?-FS:Math.asin(e)}function NS(e){return e>0?Math.sqrt(e):0}function $S(e,t){var n,r=e*AS(t),i=30;do{t-=n=(t+AS(t)-r)/(1+CS(t))}while(SS(n)>1e-6&&--i>0);return t/2}NS(ES);var TS=function(e,t,n){function r(r,i){return[e*r*CS(i=$S(n,i)),t*AS(i)]}return r.invert=function(r,i){return i=DS(i/t),[r/(e*CS(i)),DS((2*i+AS(2*i))/n)]},r}(IS/FS,IS,ES);const OS=c_(),MS=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function RS(e,t){return function n(){const r=t();return r.type=e,r.path=c_().projection(r),r.copy=r.copy||function(){const e=n();return MS.forEach((t=>{r[t]&&e[t](r[t]())})),e.path.pointRadius(r.path.pointRadius()),e},r}}function BS(e,t){if(!e||"string"!=typeof e)throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(LS[e]=RS(e,t),this):LS[e]||null}function zS(e){return e&&e.path||OS}const LS={albers:nS,albersusa:function(){var e,t,n,r,i,a,s=nS(),o=tS().rotate([154,0]).center([-2,58.5]).parallels([55,65]),u=tS().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(e,t){a=[e,t]}};function c(e){var t=e[0],s=e[1];return a=null,n.point(t,s),a||(r.point(t,s),a)||(i.point(t,s),a)}function d(){return e=t=null,c}return c.invert=function(e){var t=s.scale(),n=s.translate(),r=(e[0]-n[0])/t,i=(e[1]-n[1])/t;return(i>=.12&&i<.234&&r>=-.425&&r<-.214?o:i>=.166&&i<.234&&r>=-.214&&r<-.115?u:s).invert(e)},c.stream=function(n){return e&&t===n?e:(r=[s.stream(t=n),o.stream(n),u.stream(n)],i=r.length,e={point:function(e,t){for(var n=-1;++n<i;)r[n].point(e,t)},sphere:function(){for(var e=-1;++e<i;)r[e].sphere()},lineStart:function(){for(var e=-1;++e<i;)r[e].lineStart()},lineEnd:function(){for(var e=-1;++e<i;)r[e].lineEnd()},polygonStart:function(){for(var e=-1;++e<i;)r[e].polygonStart()},polygonEnd:function(){for(var e=-1;++e<i;)r[e].polygonEnd()}});var r,i},c.precision=function(e){return arguments.length?(s.precision(e),o.precision(e),u.precision(e),d()):s.precision()},c.scale=function(e){return arguments.length?(s.scale(e),o.scale(.35*e),u.scale(e),c.translate(s.translate())):s.scale()},c.translate=function(e){if(!arguments.length)return s.translate();var t=s.scale(),a=+e[0],c=+e[1];return n=s.translate(e).clipExtent([[a-.455*t,c-.238*t],[a+.455*t,c+.238*t]]).stream(l),r=o.translate([a-.307*t,c+.201*t]).clipExtent([[a-.425*t+Lw,c+.12*t+Lw],[a-.214*t-Lw,c+.234*t-Lw]]).stream(l),i=u.translate([a-.205*t,c+.212*t]).clipExtent([[a-.214*t+Lw,c+.166*t+Lw],[a-.115*t-Lw,c+.234*t-Lw]]).stream(l),d()},c.fitExtent=function(e,t){return W_(c,e,t)},c.fitSize=function(e,t){return V_(c,e,t)},c.fitWidth=function(e,t){return G_(c,e,t)},c.fitHeight=function(e,t){return q_(c,e,t)},c.scale(1070)},azimuthalequalarea:function(){return Q_(aS).scale(124.75).clipAngle(179.999)},azimuthalequidistant:function(){return Q_(sS).scale(79.4188).clipAngle(179.999)},conicconformal:function(){return Z_(cS).scale(109.5).parallels([30,30])},conicequalarea:tS,conicequidistant:function(){return Z_(hS).scale(131.154).center([0,13.9389])},equalEarth:function(){return Q_(vS).scale(177.158)},equirectangular:function(){return Q_(dS).scale(152.63)},gnomonic:function(){return Q_(bS).scale(144.049).clipAngle(60)},identity:function(){var e,t,n,r,i,a,s,o=1,u=0,l=0,c=1,d=1,h=0,f=null,p=1,g=1,m=P_({point:function(e,t){var n=b([e,t]);this.stream.point(n[0],n[1])}}),y=Nw;function v(){return p=o*c,g=o*d,a=s=null,b}function b(n){var r=n[0]*p,i=n[1]*g;if(h){var a=i*e-r*t;r=r*e+i*t,i=a}return[r+u,i+l]}return b.invert=function(n){var r=n[0]-u,i=n[1]-l;if(h){var a=i*e+r*t;r=r*e-i*t,i=a}return[r/p,i/g]},b.stream=function(e){return a&&s===e?a:a=m(y(s=e))},b.postclip=function(e){return arguments.length?(y=e,f=n=r=i=null,v()):y},b.clipExtent=function(e){return arguments.length?(y=null==e?(f=n=r=i=null,Nw):T_(f=+e[0][0],n=+e[0][1],r=+e[1][0],i=+e[1][1]),v()):null==f?null:[[f,n],[r,i]]},b.scale=function(e){return arguments.length?(o=+e,v()):o},b.translate=function(e){return arguments.length?(u=+e[0],l=+e[1],v()):[u,l]},b.angle=function(n){return arguments.length?(t=nk(h=n%360*qw),e=Yw(h),v()):h*Gw},b.reflectX=function(e){return arguments.length?(c=e?-1:1,v()):c<0},b.reflectY=function(e){return arguments.length?(d=e?-1:1,v()):d<0},b.fitExtent=function(e,t){return W_(b,e,t)},b.fitSize=function(e,t){return V_(b,e,t)},b.fitWidth=function(e,t){return G_(b,e,t)},b.fitHeight=function(e,t){return q_(b,e,t)},b},mercator:function(){return uS(oS).scale(961/Vw)},mollweide:function(){return Q_(TS).scale(169.529)},naturalEarth1:function(){return Q_(xS).scale(175.295)},orthographic:function(){return Q_(wS).scale(249.5).clipAngle(90.000001)},stereographic:function(){return Q_(kS).scale(250).clipAngle(142)},transversemercator:function(){var e=uS(_S),t=e.center,n=e.rotate;return e.center=function(e){return arguments.length?t([-e[1],e[0]]):[(e=t())[1],-e[0]]},e.rotate=function(e){return arguments.length?n([e[0],e[1],e.length>2?e[2]+90:90]):[(e=n())[0],e[1],e[2]-90]},n([0,0,90]).scale(159.155)}};for(const e in LS)BS(e,LS[e]);function PS(e,t,n){var r=wu(e,t-Lw,n).concat(t);return function(e){return r.map((function(t){return[e,t]}))}}function jS(e,t,n){var r=wu(e,t-Lw,n).concat(t);return function(e){return r.map((function(t){return[t,e]}))}}function US(){}const WS=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function VS(){var e=1,t=1,n=s;function r(e,t){return t.map((t=>i(e,t)))}function i(r,i){var s=[],o=[];return function(n,r,i){var s,o,u,l,c,d,h=new Array,f=new Array;for(s=o=-1,l=n[0]>=r,WS[l<<1].forEach(p);++s<e-1;)u=l,l=n[s+1]>=r,WS[u|l<<1].forEach(p);for(WS[l<<0].forEach(p);++o<t-1;){for(s=-1,l=n[o*e+e]>=r,c=n[o*e]>=r,WS[l<<1|c<<2].forEach(p);++s<e-1;)u=l,l=n[o*e+e+s+1]>=r,d=c,c=n[o*e+s+1]>=r,WS[u|l<<1|c<<2|d<<3].forEach(p);WS[l|c<<3].forEach(p)}for(s=-1,c=n[o*e]>=r,WS[c<<2].forEach(p);++s<e-1;)d=c,c=n[o*e+s+1]>=r,WS[c<<2|d<<3].forEach(p);function p(e){var t,n,r=[e[0][0]+s,e[0][1]+o],u=[e[1][0]+s,e[1][1]+o],l=a(r),c=a(u);(t=f[l])?(n=h[c])?(delete f[t.end],delete h[n.start],t===n?(t.ring.push(u),i(t.ring)):h[t.start]=f[n.end]={start:t.start,end:n.end,ring:t.ring.concat(n.ring)}):(delete f[t.end],t.ring.push(u),f[t.end=c]=t):(t=h[c])?(n=f[l])?(delete h[t.start],delete f[n.end],t===n?(t.ring.push(u),i(t.ring)):h[n.start]=f[t.end]={start:n.start,end:t.end,ring:n.ring.concat(t.ring)}):(delete h[t.start],t.ring.unshift(r),h[t.start=l]=t):h[l]=f[c]={start:l,end:c,ring:[r,u]}}WS[c<<3].forEach(p)}(r,i,(e=>{n(e,r,i),function(e){for(var t=0,n=e.length,r=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)r+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return r}(e)>0?s.push([e]):o.push(e)})),o.forEach((e=>{for(var t,n=0,r=s.length;n<r;++n)if(-1!==GS((t=s[n])[0],e))return void t.push(e)})),{type:"MultiPolygon",value:i,coordinates:s}}function a(t){return 2*t[0]+t[1]*(e+1)*4}function s(n,r,i){n.forEach((n=>{var a,s=n[0],o=n[1],u=0|s,l=0|o,c=r[l*e+u];s>0&&s<e&&u===s&&(a=r[l*e+u-1],n[0]=s+(i-a)/(c-a)-.5),o>0&&o<t&&l===o&&(a=r[(l-1)*e+u],n[1]=o+(i-a)/(c-a)-.5)}))}return r.contour=i,r.size=function(n){if(!arguments.length)return[e,t];var i=Math.floor(n[0]),a=Math.floor(n[1]);return i>=0&&a>=0||se("invalid size"),e=i,t=a,r},r.smooth=function(e){return arguments.length?(n=e?s:US,r):n===s},r}function GS(e,t){for(var n,r=-1,i=t.length;++r<i;)if(n=qS(e,t[r]))return n;return 0}function qS(e,t){for(var n=t[0],r=t[1],i=-1,a=0,s=e.length,o=s-1;a<s;o=a++){var u=e[a],l=u[0],c=u[1],d=e[o],h=d[0],f=d[1];if(HS(u,d,t))return 0;c>r!=f>r&&n<(h-l)*(r-c)/(f-c)+l&&(i=-i)}return i}function HS(e,t,n){var r,i,a,s;return function(e,t,n){return(t[0]-e[0])*(n[1]-e[1])==(n[0]-e[0])*(t[1]-e[1])}(e,t,n)&&(i=e[r=+(e[0]===t[0])],a=n[r],s=t[r],i<=a&&a<=s||s<=a&&a<=i)}function XS(e,t,n){return function(r){var i=it(r),a=n?Math.min(i[0],0):i[0],s=i[1],o=s-a,u=t?Zt(a,s,e):o/(e+1);return wu(a+u,s,u)}}function KS(e){go.call(this,null,e)}function YS(e,t,n,r,i){const a=e.x1||0,s=e.y1||0,o=t*n<0;function u(e){e.forEach(l)}function l(e){o&&e.reverse(),e.forEach(c)}function c(e){e[0]=(e[0]-a)*t+r,e[1]=(e[1]-s)*n+i}return function(e){return e.coordinates.forEach(u),e}}function QS(e,t,n){const r=e>=0?e:Do(t,n);return Math.round((Math.sqrt(4*r*r+1)-1)/2)}function JS(e){return Ke(e)?e:tt(+e)}function ZS(){var e=e=>e[0],t=e=>e[1],n=he,r=[-1,-1],i=960,a=500,s=2;function o(o,u){const l=QS(r[0],o,e)>>s,c=QS(r[1],o,t)>>s,d=l?l+2:0,h=c?c+2:0,f=2*d+(i>>s),p=2*h+(a>>s),g=new Float32Array(f*p),m=new Float32Array(f*p);let y=g;o.forEach((r=>{const i=d+(+e(r)>>s),a=h+(+t(r)>>s);i>=0&&i<f&&a>=0&&a<p&&(g[i+a*f]+=+n(r))})),l>0&&c>0?(eC(f,p,g,m,l),tC(f,p,m,g,c),eC(f,p,g,m,l),tC(f,p,m,g,c),eC(f,p,g,m,l),tC(f,p,m,g,c)):l>0?(eC(f,p,g,m,l),eC(f,p,m,g,l),eC(f,p,g,m,l),y=m):c>0&&(tC(f,p,g,m,c),tC(f,p,m,g,c),tC(f,p,g,m,c),y=m);const v=u?Math.pow(2,-2*s):1/ew(y);for(let e=0,t=f*p;e<t;++e)y[e]*=v;return{values:y,scale:1<<s,width:f,height:p,x1:d,y1:h,x2:d+(i>>s),y2:h+(a>>s)}}return o.x=function(t){return arguments.length?(e=JS(t),o):e},o.y=function(e){return arguments.length?(t=JS(e),o):t},o.weight=function(e){return arguments.length?(n=JS(e),o):n},o.size=function(e){if(!arguments.length)return[i,a];var t=+e[0],n=+e[1];return t>=0&&n>=0||se("invalid size"),i=t,a=n,o},o.cellSize=function(e){return arguments.length?((e=+e)>=1||se("invalid cell size"),s=Math.floor(Math.log(e)/Math.LN2),o):1<<s},o.bandwidth=function(e){return arguments.length?(1===(e=He(e)).length&&(e=[+e[0],+e[0]]),2!==e.length&&se("invalid bandwidth"),r=e,o):r},o}function eC(e,t,n,r,i){const a=1+(i<<1);for(let s=0;s<t;++s)for(let t=0,o=0;t<e+i;++t)t<e&&(o+=n[t+s*e]),t>=i&&(t>=a&&(o-=n[t-a+s*e]),r[t-i+s*e]=o/Math.min(t+1,e-1+a-t,a))}function tC(e,t,n,r,i){const a=1+(i<<1);for(let s=0;s<e;++s)for(let o=0,u=0;o<t+i;++o)o<t&&(u+=n[s+o*e]),o>=i&&(o>=a&&(u-=n[s+(o-a)*e]),r[s+(o-i)*e]=u/Math.min(o+1,t-1+a-o,a))}function nC(e){go.call(this,null,e)}KS.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},dt(KS,go,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=e.field||ce,a=VS().smooth(!1!==e.smooth),s=e.thresholds||function(e,t,n){const r=XS(n.levels||10,n.nice,!1!==n.zero);return"shared"!==n.resolve?r:r(e.map((e=>bo(t(e).values))))}(r,i,e),o=null===e.as?null:e.as||"contour",u=[];return r.forEach((t=>{const n=i(t),r=a.size([n.width,n.height])(n.values,ke(s)?s:s(n.values));!function(e,t,n,r){let i=r.scale||t.scale,a=r.translate||t.translate;if(Ke(i)&&(i=i(n,r)),Ke(a)&&(a=a(n,r)),(1===i||null==i)&&!a)return;const s=(mt(i)?i:i[0])||1,o=(mt(i)?i:i[1])||1,u=a&&a[0]||0,l=a&&a[1]||0;e.forEach(YS(t,s,o,u,l))}(r,n,t,e),r.forEach((e=>{u.push(Ps(t,zs(null!=o?{[o]:e}:e)))}))})),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}}),nC.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const rC=["x","y","weight","size","cellSize","bandwidth"];function iC(e,t){return rC.forEach((n=>null!=t[n]?e[n](t[n]):0)),e}function aC(e){go.call(this,null,e)}dt(nC,go,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=function(e,t){var n,r,i,a,s,o,u=[],l=e=>e(a);if(null==t)u.push(e);else for(n={},r=0,i=e.length;r<i;++r)a=e[r],(o=n[s=t.map(l)])||(n[s]=o=[],o.dims=s,u.push(o)),o.push(a);return u}(t.materialize(t.SOURCE).source,e.groupby),a=(e.groupby||[]).map(te),s=iC(ZS(),e),o=e.as||"grid";return n=i.map((t=>zs(function(e,t){for(let n=0;n<a.length;++n)e[a[n]]=t[n];return e}({[o]:s(t,e.counts)},t.dims)))),this.value&&(r.rem=this.value),this.value=r.source=r.add=n,r}}),aC.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},dt(aC,go,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=VS().smooth(!1!==e.smooth),s=e.values,o=e.thresholds||XS(e.count||10,e.nice,!!s),u=e.size;return s||(s=t.materialize(t.SOURCE).source,r=YS(n=iC(ZS(),e)(s,!0),n.scale||1,n.scale||1,0,0),u=[n.width,n.height],s=n.values),o=ke(o)?o:o(s),s=a.size(u)(s,o),r&&s.forEach(r),this.value&&(i.rem=this.value),this.value=i.source=i.add=(s||[]).map(zs),i}});const sC="Feature",oC="FeatureCollection";function uC(e){go.call(this,null,e)}function lC(e){go.call(this,null,e)}function cC(e){go.call(this,null,e)}function dC(e){go.call(this,null,e)}function hC(e){go.call(this,[],e),this.generator=function(){var e,t,n,r,i,a,s,o,u,l,c,d,h=10,f=h,p=90,g=360,m=2.5;function y(){return{type:"MultiLineString",coordinates:v()}}function v(){return wu(Qw(r/p)*p,n,p).map(c).concat(wu(Qw(o/g)*g,s,g).map(d)).concat(wu(Qw(t/h)*h,e,h).filter((function(e){return Hw(e%p)>Lw})).map(u)).concat(wu(Qw(a/f)*f,i,f).filter((function(e){return Hw(e%g)>Lw})).map(l))}return y.lines=function(){return v().map((function(e){return{type:"LineString",coordinates:e}}))},y.outline=function(){return{type:"Polygon",coordinates:[c(r).concat(d(s).slice(1),c(n).reverse().slice(1),d(o).reverse().slice(1))]}},y.extent=function(e){return arguments.length?y.extentMajor(e).extentMinor(e):y.extentMinor()},y.extentMajor=function(e){return arguments.length?(r=+e[0][0],n=+e[1][0],o=+e[0][1],s=+e[1][1],r>n&&(e=r,r=n,n=e),o>s&&(e=o,o=s,s=e),y.precision(m)):[[r,o],[n,s]]},y.extentMinor=function(n){return arguments.length?(t=+n[0][0],e=+n[1][0],a=+n[0][1],i=+n[1][1],t>e&&(n=t,t=e,e=n),a>i&&(n=a,a=i,i=n),y.precision(m)):[[t,a],[e,i]]},y.step=function(e){return arguments.length?y.stepMajor(e).stepMinor(e):y.stepMinor()},y.stepMajor=function(e){return arguments.length?(p=+e[0],g=+e[1],y):[p,g]},y.stepMinor=function(e){return arguments.length?(h=+e[0],f=+e[1],y):[h,f]},y.precision=function(h){return arguments.length?(m=+h,u=PS(a,i,90),l=jS(t,e,m),c=PS(o,s,90),d=jS(r,n,m),y):m},y.extentMajor([[-180,-89.999999],[180,89.999999]]).extentMinor([[-180,-80.000001],[180,80.000001]])}()}function fC(e){go.call(this,null,e)}function pC(e){if(!Ke(e))return!1;const t=Nt(ne(e));return t.$x||t.$y||t.$value||t.$max}function gC(e){go.call(this,null,e),this.modified(!0)}function mC(e,t,n){Ke(e[t])&&e[t](n)}function yC(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,a,s,o,u,l,c,d,h,f=e._root,p={data:r},g=e._x0,m=e._y0,y=e._x1,v=e._y1;if(!f)return e._root=p,e;for(;f.length;)if((l=t>=(a=(g+y)/2))?g=a:y=a,(c=n>=(s=(m+v)/2))?m=s:v=s,i=f,!(f=f[d=c<<1|l]))return i[d]=p,e;if(o=+e._x.call(null,f.data),u=+e._y.call(null,f.data),t===o&&n===u)return p.next=f,i?i[d]=p:e._root=p,e;do{i=i?i[d]=new Array(4):e._root=new Array(4),(l=t>=(a=(g+y)/2))?g=a:y=a,(c=n>=(s=(m+v)/2))?m=s:v=s}while((d=c<<1|l)==(h=(u>=s)<<1|o>=a));return i[h]=f,i[d]=p,e}function vC(e,t,n,r,i){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=i}function bC(e){return e[0]}function xC(e){return e[1]}function wC(e,t,n){var r=new kC(null==t?bC:t,null==n?xC:n,NaN,NaN,NaN,NaN);return null==e?r:r.addAll(e)}function kC(e,t,n,r,i,a){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=i,this._y1=a,this._root=void 0}function _C(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}uC.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},dt(uC,go,{transform(e,t){var n,r=this._features,i=this._points,a=e.fields,s=a&&a[0],o=a&&a[1],u=e.geojson||!a&&ce,l=t.ADD;n=e.modified()||t.changed(t.REM)||t.modified(ne(u))||s&&t.modified(ne(s))||o&&t.modified(ne(o)),this.value&&!n||(l=t.SOURCE,this._features=r=[],this._points=i=[]),u&&t.visit(l,(e=>r.push(u(e)))),s&&o&&(t.visit(l,(e=>{var t=s(e),n=o(e);null!=t&&null!=n&&(t=+t)===t&&(n=+n)===n&&i.push([t,n])})),r=r.concat({type:sC,geometry:{type:"MultiPoint",coordinates:i}})),this.value={type:oC,features:r}}}),lC.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},dt(lC,go,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.field||ce,a=e.as||"path",s=n.SOURCE;!r||e.modified()?(this.value=r=zS(e.projection),n.materialize().reflow()):s=i===ce||t.modified(i.fields)?n.ADD_MOD:n.ADD;const o=function(e,t){const n=e.pointRadius();return e.context(null),null!=t&&e.pointRadius(t),n}(r,e.pointRadius);return n.visit(s,(e=>e[a]=r(i(e)))),r.pointRadius(o),n.modifies(a)}}),cC.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},dt(cC,go,{transform(e,t){var n,r=e.projection,i=e.fields[0],a=e.fields[1],s=e.as||["x","y"],o=s[0],u=s[1];function l(e){const t=r([i(e),a(e)]);t?(e[o]=t[0],e[u]=t[1]):(e[o]=void 0,e[u]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,l):(n=t.modified(i.fields)||t.modified(a.fields),t.visit(n?t.ADD_MOD:t.ADD,l)),t.modifies(s)}}),dC.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},dt(dC,go,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.as||"shape",a=n.ADD;return r&&!e.modified()||(this.value=r=function(e,t,n){const r=null==n?n=>e(t(n)):r=>{var i=e.pointRadius(),a=e.pointRadius(n)(t(r));return e.pointRadius(i),a};return r.context=t=>(e.context(t),r),r}(zS(e.projection),e.field||ue("datum"),e.pointRadius),n.materialize().reflow(),a=n.SOURCE),n.visit(a,(e=>e[i]=r)),n.modifies(i)}}),hC.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},dt(hC,go,{transform(e,t){var n,r=this.value,i=this.generator;if(!r.length||e.modified())for(const t in e)Ke(i[t])&&i[t](e[t]);return n=i(),r.length?t.mod.push(js(r[0],n)):t.add.push(zs(n)),r[0]=n,t}}),fC.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},dt(fC,go,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,r="shared"===e.resolve,i=e.field||ce,a=function(e,t){let n;return Ke(e)?(n=n=>e(n,t),n.dep=pC(e)):e?n=tt(e):(n=e=>e.$value/e.$max||0,n.dep=!0),n}(e.opacity,e),s=function(e,t){let n;return Ke(e)?(n=n=>jd(e(n,t)),n.dep=pC(e)):n=tt(jd(e||"#888")),n}(e.color,e),o=e.as||"image",u={$x:0,$y:0,$value:0,$max:r?bo(n.map((e=>bo(i(e).values)))):0};return n.forEach((e=>{const t=i(e),n=rt({},e,u);r||(n.$max=bo(t.values||[])),e[o]=function(e,t,n,r){const i=e.width,a=e.height,s=e.x1||0,o=e.y1||0,u=e.x2||i,l=e.y2||a,c=e.values,d=c?e=>c[e]:de,h=od(u-s,l-o),f=h.getContext("2d"),p=f.getImageData(0,0,u-s,l-o),g=p.data;for(let e=o,a=0;e<l;++e){t.$y=e-o;for(let o=s,l=e*i;o<u;++o,a+=4){t.$x=o-s,t.$value=d(o+l);const e=n(t);g[a+0]=e.r,g[a+1]=e.g,g[a+2]=e.b,g[a+3]=~~(255*r(t))}}return f.putImageData(p,0,0),h}(t,n,s.dep?s:tt(s(n)),a.dep?a:tt(a(n)))})),t.reflow(!0).modifies(o)}}),dt(gC,go,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=function(e){const t=BS((e||"mercator").toLowerCase());return t||se("Unrecognized projection type: "+e),t()}(e.type),MS.forEach((t=>{null!=e[t]&&mC(n,t,e[t])}))):MS.forEach((t=>{e.modified(t)&&mC(n,t,e[t])})),null!=e.pointRadius&&n.path.pointRadius(e.pointRadius),e.fit&&function(e,t){const n=function(e){return 1===(e=He(e)).length?e[0]:{type:oC,features:e.reduce(((e,t)=>e.concat(function(e){return e.type===oC?e.features:He(e).filter((e=>null!=e)).map((e=>e.type===sC?e:{type:sC,geometry:e}))}(t))),[])}}(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});var SC=wC.prototype=kC.prototype;function CC(e){return function(){return e}}function AC(e){return 1e-6*(e()-.5)}function EC(e){return e.x+e.vx}function FC(e){return e.y+e.vy}SC.copy=function(){var e,t,n=new kC(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=_C(r),n;for(e=[{source:r,target:n._root=new Array(4)}];r=e.pop();)for(var i=0;i<4;++i)(t=r.source[i])&&(t.length?e.push({source:t,target:r.target[i]=new Array(4)}):r.target[i]=_C(t));return n},SC.add=function(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return yC(this.cover(t,n),t,n,e)},SC.addAll=function(e){var t,n,r,i,a=e.length,s=new Array(a),o=new Array(a),u=1/0,l=1/0,c=-1/0,d=-1/0;for(n=0;n<a;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(i=+this._y.call(null,t))||(s[n]=r,o[n]=i,r<u&&(u=r),r>c&&(c=r),i<l&&(l=i),i>d&&(d=i));if(u>c||l>d)return this;for(this.cover(u,l).cover(c,d),n=0;n<a;++n)yC(this,s[n],o[n],e[n]);return this},SC.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,a=this._y1;if(isNaN(n))i=(n=Math.floor(e))+1,a=(r=Math.floor(t))+1;else{for(var s,o,u=i-n||1,l=this._root;n>e||e>=i||r>t||t>=a;)switch(o=(t<r)<<1|e<n,(s=new Array(4))[o]=l,l=s,u*=2,o){case 0:i=n+u,a=r+u;break;case 1:n=i-u,a=r+u;break;case 2:i=n+u,r=a-u;break;case 3:n=i-u,r=a-u}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=r,this._x1=i,this._y1=a,this},SC.data=function(){var e=[];return this.visit((function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)})),e},SC.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},SC.find=function(e,t,n){var r,i,a,s,o,u,l,c=this._x0,d=this._y0,h=this._x1,f=this._y1,p=[],g=this._root;for(g&&p.push(new vC(g,c,d,h,f)),null==n?n=1/0:(c=e-n,d=t-n,h=e+n,f=t+n,n*=n);u=p.pop();)if(!(!(g=u.node)||(i=u.x0)>h||(a=u.y0)>f||(s=u.x1)<c||(o=u.y1)<d))if(g.length){var m=(i+s)/2,y=(a+o)/2;p.push(new vC(g[3],m,y,s,o),new vC(g[2],i,y,m,o),new vC(g[1],m,a,s,y),new vC(g[0],i,a,m,y)),(l=(t>=y)<<1|e>=m)&&(u=p[p.length-1],p[p.length-1]=p[p.length-1-l],p[p.length-1-l]=u)}else{var v=e-+this._x.call(null,g.data),b=t-+this._y.call(null,g.data),x=v*v+b*b;if(x<n){var w=Math.sqrt(n=x);c=e-w,d=t-w,h=e+w,f=t+w,r=g.data}}return r},SC.remove=function(e){if(isNaN(a=+this._x.call(null,e))||isNaN(s=+this._y.call(null,e)))return this;var t,n,r,i,a,s,o,u,l,c,d,h,f=this._root,p=this._x0,g=this._y0,m=this._x1,y=this._y1;if(!f)return this;if(f.length)for(;;){if((l=a>=(o=(p+m)/2))?p=o:m=o,(c=s>=(u=(g+y)/2))?g=u:y=u,t=f,!(f=f[d=c<<1|l]))return this;if(!f.length)break;(t[d+1&3]||t[d+2&3]||t[d+3&3])&&(n=t,h=d)}for(;f.data!==e;)if(r=f,!(f=f.next))return this;return(i=f.next)&&delete f.next,r?(i?r.next=i:delete r.next,this):t?(i?t[d]=i:delete t[d],(f=t[0]||t[1]||t[2]||t[3])&&f===(t[3]||t[2]||t[1]||t[0])&&!f.length&&(n?n[h]=f:this._root=f),this):(this._root=i,this)},SC.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},SC.root=function(){return this._root},SC.size=function(){var e=0;return this.visit((function(t){if(!t.length)do{++e}while(t=t.next)})),e},SC.visit=function(e){var t,n,r,i,a,s,o=[],u=this._root;for(u&&o.push(new vC(u,this._x0,this._y0,this._x1,this._y1));t=o.pop();)if(!e(u=t.node,r=t.x0,i=t.y0,a=t.x1,s=t.y1)&&u.length){var l=(r+a)/2,c=(i+s)/2;(n=u[3])&&o.push(new vC(n,l,c,a,s)),(n=u[2])&&o.push(new vC(n,r,c,l,s)),(n=u[1])&&o.push(new vC(n,l,i,a,c)),(n=u[0])&&o.push(new vC(n,r,i,l,c))}return this},SC.visitAfter=function(e){var t,n=[],r=[];for(this._root&&n.push(new vC(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var i=t.node;if(i.length){var a,s=t.x0,o=t.y0,u=t.x1,l=t.y1,c=(s+u)/2,d=(o+l)/2;(a=i[0])&&n.push(new vC(a,s,o,c,d)),(a=i[1])&&n.push(new vC(a,c,o,u,d)),(a=i[2])&&n.push(new vC(a,s,d,c,l)),(a=i[3])&&n.push(new vC(a,c,d,u,l))}r.push(t)}for(;t=r.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},SC.x=function(e){return arguments.length?(this._x=e,this):this._x},SC.y=function(e){return arguments.length?(this._y=e,this):this._y};var IC={value:()=>{}};function DC(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new NC(r)}function NC(e){this._=e}function $C(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",r=e.indexOf(".");if(r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}function TC(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}function OC(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=IC,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}NC.prototype=DC.prototype={constructor:NC,on:function(e,t){var n,r=this._,i=$C(e+"",r),a=-1,s=i.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++a<s;)if(n=(e=i[a]).type)r[n]=OC(r[n],e.name,t);else if(null==t)for(n in r)r[n]=OC(r[n],e.name,null);return this}for(;++a<s;)if((n=(e=i[a]).type)&&(n=TC(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new NC(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),a=0;a<n;++a)i[a]=arguments[a+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=0,n=(r=this._[e]).length;a<n;++a)r[a].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,a=r.length;i<a;++i)r[i].value.apply(t,n)}};const MC=DC;var RC,BC,zC=0,LC=0,PC=0,jC=0,UC=0,WC=0,VC="object"==typeof performance&&performance.now?performance:Date,GC="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function qC(){return UC||(GC(HC),UC=VC.now()+WC)}function HC(){UC=0}function XC(){this._call=this._time=this._next=null}function KC(e,t,n){var r=new XC;return r.restart(e,t,n),r}function YC(){UC=(jC=VC.now())+WC,zC=LC=0;try{!function(){qC(),++zC;for(var e,t=RC;t;)(e=UC-t._time)>=0&&t._call.call(null,e),t=t._next;--zC}()}finally{zC=0,function(){for(var e,t,n=RC,r=1/0;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:RC=t);BC=e,JC(r)}(),UC=0}}function QC(){var e=VC.now(),t=e-jC;t>1e3&&(WC-=t,jC=e)}function JC(e){zC||(LC&&(LC=clearTimeout(LC)),e-UC>24?(e<1/0&&(LC=setTimeout(YC,e-VC.now()-WC)),PC&&(PC=clearInterval(PC))):(PC||(jC=VC.now(),PC=setInterval(QC,1e3)),zC=1,GC(YC)))}XC.prototype=KC.prototype={constructor:XC,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?qC():+n)+(null==t?0:+t),this._next||BC===this||(BC?BC._next=this:RC=this,BC=this),this._call=e,this._time=n,JC()},stop:function(){this._call&&(this._call=null,this._time=1/0,JC())}};const ZC=4294967296;function eA(e){return e.x}function tA(e){return e.y}var nA=Math.PI*(3-Math.sqrt(5));function rA(e){return e.index}function iA(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}const aA={center:function(e,t){var n,r=1;function i(){var i,a,s=n.length,o=0,u=0;for(i=0;i<s;++i)o+=(a=n[i]).x,u+=a.y;for(o=(o/s-e)*r,u=(u/s-t)*r,i=0;i<s;++i)(a=n[i]).x-=o,a.y-=u}return null==e&&(e=0),null==t&&(t=0),i.initialize=function(e){n=e},i.x=function(t){return arguments.length?(e=+t,i):e},i.y=function(e){return arguments.length?(t=+e,i):t},i.strength=function(e){return arguments.length?(r=+e,i):r},i},collide:function(e){var t,n,r,i=1,a=1;function s(){for(var e,s,u,l,c,d,h,f=t.length,p=0;p<a;++p)for(s=wC(t,EC,FC).visitAfter(o),e=0;e<f;++e)u=t[e],d=n[u.index],h=d*d,l=u.x+u.vx,c=u.y+u.vy,s.visit(g);function g(e,t,n,a,s){var o=e.data,f=e.r,p=d+f;if(!o)return t>l+p||a<l-p||n>c+p||s<c-p;if(o.index>u.index){var g=l-o.x-o.vx,m=c-o.y-o.vy,y=g*g+m*m;y<p*p&&(0===g&&(y+=(g=AC(r))*g),0===m&&(y+=(m=AC(r))*m),y=(p-(y=Math.sqrt(y)))/y*i,u.vx+=(g*=y)*(p=(f*=f)/(h+f)),u.vy+=(m*=y)*p,o.vx-=g*(p=1-p),o.vy-=m*p)}}}function o(e){if(e.data)return e.r=n[e.data.index];for(var t=e.r=0;t<4;++t)e[t]&&e[t].r>e.r&&(e.r=e[t].r)}function u(){if(t){var r,i,a=t.length;for(n=new Array(a),r=0;r<a;++r)i=t[r],n[i.index]=+e(i,r,t)}}return"function"!=typeof e&&(e=CC(null==e?1:+e)),s.initialize=function(e,n){t=e,r=n,u()},s.iterations=function(e){return arguments.length?(a=+e,s):a},s.strength=function(e){return arguments.length?(i=+e,s):i},s.radius=function(t){return arguments.length?(e="function"==typeof t?t:CC(+t),u(),s):e},s},nbody:function(){var e,t,n,r,i,a=CC(-30),s=1,o=1/0,u=.81;function l(n){var i,a=e.length,s=wC(e,eA,tA).visitAfter(d);for(r=n,i=0;i<a;++i)t=e[i],s.visit(h)}function c(){if(e){var t,n,r=e.length;for(i=new Array(r),t=0;t<r;++t)n=e[t],i[n.index]=+a(n,t,e)}}function d(e){var t,n,r,a,s,o=0,u=0;if(e.length){for(r=a=s=0;s<4;++s)(t=e[s])&&(n=Math.abs(t.value))&&(o+=t.value,u+=n,r+=n*t.x,a+=n*t.y);e.x=r/u,e.y=a/u}else{(t=e).x=t.data.x,t.y=t.data.y;do{o+=i[t.data.index]}while(t=t.next)}e.value=o}function h(e,a,l,c){if(!e.value)return!0;var d=e.x-t.x,h=e.y-t.y,f=c-a,p=d*d+h*h;if(f*f/u<p)return p<o&&(0===d&&(p+=(d=AC(n))*d),0===h&&(p+=(h=AC(n))*h),p<s&&(p=Math.sqrt(s*p)),t.vx+=d*e.value*r/p,t.vy+=h*e.value*r/p),!0;if(!(e.length||p>=o)){(e.data!==t||e.next)&&(0===d&&(p+=(d=AC(n))*d),0===h&&(p+=(h=AC(n))*h),p<s&&(p=Math.sqrt(s*p)));do{e.data!==t&&(f=i[e.data.index]*r/p,t.vx+=d*f,t.vy+=h*f)}while(e=e.next)}}return l.initialize=function(t,r){e=t,n=r,c()},l.strength=function(e){return arguments.length?(a="function"==typeof e?e:CC(+e),c(),l):a},l.distanceMin=function(e){return arguments.length?(s=e*e,l):Math.sqrt(s)},l.distanceMax=function(e){return arguments.length?(o=e*e,l):Math.sqrt(o)},l.theta=function(e){return arguments.length?(u=e*e,l):Math.sqrt(u)},l},link:function(e){var t,n,r,i,a,s,o=rA,u=function(e){return 1/Math.min(i[e.source.index],i[e.target.index])},l=CC(30),c=1;function d(r){for(var i=0,o=e.length;i<c;++i)for(var u,l,d,h,f,p,g,m=0;m<o;++m)l=(u=e[m]).source,h=(d=u.target).x+d.vx-l.x-l.vx||AC(s),f=d.y+d.vy-l.y-l.vy||AC(s),h*=p=((p=Math.sqrt(h*h+f*f))-n[m])/p*r*t[m],f*=p,d.vx-=h*(g=a[m]),d.vy-=f*g,l.vx+=h*(g=1-g),l.vy+=f*g}function h(){if(r){var s,u,l=r.length,c=e.length,d=new Map(r.map(((e,t)=>[o(e,t,r),e])));for(s=0,i=new Array(l);s<c;++s)(u=e[s]).index=s,"object"!=typeof u.source&&(u.source=iA(d,u.source)),"object"!=typeof u.target&&(u.target=iA(d,u.target)),i[u.source.index]=(i[u.source.index]||0)+1,i[u.target.index]=(i[u.target.index]||0)+1;for(s=0,a=new Array(c);s<c;++s)u=e[s],a[s]=i[u.source.index]/(i[u.source.index]+i[u.target.index]);t=new Array(c),f(),n=new Array(c),p()}}function f(){if(r)for(var n=0,i=e.length;n<i;++n)t[n]=+u(e[n],n,e)}function p(){if(r)for(var t=0,i=e.length;t<i;++t)n[t]=+l(e[t],t,e)}return null==e&&(e=[]),d.initialize=function(e,t){r=e,s=t,h()},d.links=function(t){return arguments.length?(e=t,h(),d):e},d.id=function(e){return arguments.length?(o=e,d):o},d.iterations=function(e){return arguments.length?(c=+e,d):c},d.strength=function(e){return arguments.length?(u="function"==typeof e?e:CC(+e),f(),d):u},d.distance=function(e){return arguments.length?(l="function"==typeof e?e:CC(+e),p(),d):l},d},x:function(e){var t,n,r,i=CC(.1);function a(e){for(var i,a=0,s=t.length;a<s;++a)(i=t[a]).vx+=(r[a]-i.x)*n[a]*e}function s(){if(t){var a,s=t.length;for(n=new Array(s),r=new Array(s),a=0;a<s;++a)n[a]=isNaN(r[a]=+e(t[a],a,t))?0:+i(t[a],a,t)}}return"function"!=typeof e&&(e=CC(null==e?0:+e)),a.initialize=function(e){t=e,s()},a.strength=function(e){return arguments.length?(i="function"==typeof e?e:CC(+e),s(),a):i},a.x=function(t){return arguments.length?(e="function"==typeof t?t:CC(+t),s(),a):e},a},y:function(e){var t,n,r,i=CC(.1);function a(e){for(var i,a=0,s=t.length;a<s;++a)(i=t[a]).vy+=(r[a]-i.y)*n[a]*e}function s(){if(t){var a,s=t.length;for(n=new Array(s),r=new Array(s),a=0;a<s;++a)n[a]=isNaN(r[a]=+e(t[a],a,t))?0:+i(t[a],a,t)}}return"function"!=typeof e&&(e=CC(null==e?0:+e)),a.initialize=function(e){t=e,s()},a.strength=function(e){return arguments.length?(i="function"==typeof e?e:CC(+e),s(),a):i},a.y=function(t){return arguments.length?(e="function"==typeof t?t:CC(+t),s(),a):e},a}},sA="forces",oA=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],uA=["static","iterations"],lA=["x","y","vx","vy"];function cA(e){go.call(this,null,e)}function dA(e,t,n,r){var i,a,s,o,u=He(t.forces);for(i=0,a=oA.length;i<a;++i)(s=oA[i])!==sA&&t.modified(s)&&e[s](t[s]);for(i=0,a=u.length;i<a;++i)o=sA+i,(s=n||t.modified(sA,i)?fA(u[i]):r&&hA(u[i],r)?e.force(o):null)&&e.force(o,s);for(a=e.numForces||0;i<a;++i)e.force(sA+i,null);return e.numForces=u.length,e}function hA(e,t){var n,r;for(n in e)if(Ke(r=e[n])&&t.modified(ne(r)))return 1;return 0}function fA(e){var t,n;for(n in ot(aA,e.force)||se("Unrecognized force: "+e.force),t=aA[e.force](),e)Ke(t[n])&&pA(t[n],e[n],e);return t}function pA(e,t,n){e(Ke(t)?e=>t(e,n):t)}function gA(e){var t=0,n=e.children,r=n&&n.length;if(r)for(;--r>=0;)t+=n[r].value;else t=1;e.value=t}function mA(e,t){e instanceof Map?(e=[void 0,e],void 0===t&&(t=vA)):void 0===t&&(t=yA);for(var n,r,i,a,s,o=new wA(e),u=[o];n=u.pop();)if((i=t(n.data))&&(s=(i=Array.from(i)).length))for(n.children=i,a=s-1;a>=0;--a)u.push(r=i[a]=new wA(i[a])),r.parent=n,r.depth=n.depth+1;return o.eachBefore(xA)}function yA(e){return e.children}function vA(e){return Array.isArray(e)?e[1]:null}function bA(e){void 0!==e.data.value&&(e.value=e.data.value),e.data=e.data.data}function xA(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function wA(e){this.data=e,this.depth=this.height=0,this.parent=null}function kA(e,t){var n,r;if(CA(t,e))return[t];for(n=0;n<e.length;++n)if(_A(t,e[n])&&CA(EA(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(r=n+1;r<e.length;++r)if(_A(EA(e[n],e[r]),t)&&_A(EA(e[n],t),e[r])&&_A(EA(e[r],t),e[n])&&CA(FA(e[n],e[r],t),e))return[e[n],e[r],t];throw new Error}function _A(e,t){var n=e.r-t.r,r=t.x-e.x,i=t.y-e.y;return n<0||n*n<r*r+i*i}function SA(e,t){var n=e.r-t.r+1e-9*Math.max(e.r,t.r,1),r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function CA(e,t){for(var n=0;n<t.length;++n)if(!SA(e,t[n]))return!1;return!0}function AA(e){switch(e.length){case 1:return{x:(t=e[0]).x,y:t.y,r:t.r};case 2:return EA(e[0],e[1]);case 3:return FA(e[0],e[1],e[2])}var t}function EA(e,t){var n=e.x,r=e.y,i=e.r,a=t.x,s=t.y,o=t.r,u=a-n,l=s-r,c=o-i,d=Math.sqrt(u*u+l*l);return{x:(n+a+u/d*c)/2,y:(r+s+l/d*c)/2,r:(d+i+o)/2}}function FA(e,t,n){var r=e.x,i=e.y,a=e.r,s=t.x,o=t.y,u=t.r,l=n.x,c=n.y,d=n.r,h=r-s,f=r-l,p=i-o,g=i-c,m=u-a,y=d-a,v=r*r+i*i-a*a,b=v-s*s-o*o+u*u,x=v-l*l-c*c+d*d,w=f*p-h*g,k=(p*x-g*b)/(2*w)-r,_=(g*m-p*y)/w,S=(f*b-h*x)/(2*w)-i,C=(h*y-f*m)/w,A=_*_+C*C-1,E=2*(a+k*_+S*C),F=k*k+S*S-a*a,I=-(A?(E+Math.sqrt(E*E-4*A*F))/(2*A):F/E);return{x:r+k+_*I,y:i+S+C*I,r:I}}function IA(e,t,n){var r,i,a,s,o=e.x-t.x,u=e.y-t.y,l=o*o+u*u;l?(i=t.r+n.r,i*=i,s=e.r+n.r,i>(s*=s)?(r=(l+s-i)/(2*l),a=Math.sqrt(Math.max(0,s/l-r*r)),n.x=e.x-r*o-a*u,n.y=e.y-r*u+a*o):(r=(l+i-s)/(2*l),a=Math.sqrt(Math.max(0,i/l-r*r)),n.x=t.x+r*o-a*u,n.y=t.y+r*u+a*o)):(n.x=t.x+n.r,n.y=t.y)}function DA(e,t){var n=e.r+t.r-1e-6,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function NA(e){var t=e._,n=e.next._,r=t.r+n.r,i=(t.x*n.r+n.x*t.r)/r,a=(t.y*n.r+n.y*t.r)/r;return i*i+a*a}function $A(e){this._=e,this.next=null,this.previous=null}function TA(e){if(!(i=(e=function(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}(e)).length))return 0;var t,n,r,i,a,s,o,u,l,c,d;if((t=e[0]).x=0,t.y=0,!(i>1))return t.r;if(n=e[1],t.x=-n.r,n.x=t.r,n.y=0,!(i>2))return t.r+n.r;IA(n,t,r=e[2]),t=new $A(t),n=new $A(n),r=new $A(r),t.next=r.previous=n,n.next=t.previous=r,r.next=n.previous=t;e:for(o=3;o<i;++o){IA(t._,n._,r=e[o]),r=new $A(r),u=n.next,l=t.previous,c=n._.r,d=t._.r;do{if(c<=d){if(DA(u._,r._)){n=u,t.next=n,n.previous=t,--o;continue e}c+=u._.r,u=u.next}else{if(DA(l._,r._)){(t=l).next=n,n.previous=t,--o;continue e}d+=l._.r,l=l.previous}}while(u!==l.next);for(r.previous=t,r.next=n,t.next=n.previous=n=r,a=NA(t);(r=r.next)!==n;)(s=NA(r))<a&&(t=r,a=s);n=t.next}for(t=[n._],r=n;(r=r.next)!==n;)t.push(r._);for(r=function(e){for(var t,n,r=0,i=(e=function(e){for(var t,n,r=e.length;r;)n=Math.random()*r--|0,t=e[r],e[r]=e[n],e[n]=t;return e}(Array.from(e))).length,a=[];r<i;)t=e[r],n&&SA(n,t)?++r:(n=AA(a=kA(a,t)),r=0);return n}(t),o=0;o<i;++o)(t=e[o]).x-=r.x,t.y-=r.y;return r.r}function OA(e){return null==e?null:MA(e)}function MA(e){if("function"!=typeof e)throw new Error;return e}function RA(){return 0}function BA(e){return function(){return e}}function zA(e){return Math.sqrt(e.value)}function LA(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function PA(e,t){return function(n){if(r=n.children){var r,i,a,s=r.length,o=e(n)*t||0;if(o)for(i=0;i<s;++i)r[i].r+=o;if(a=TA(r),o)for(i=0;i<s;++i)r[i].r-=o;n.r=a+o}}}function jA(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}function UA(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function WA(e,t,n,r,i){for(var a,s=e.children,o=-1,u=s.length,l=e.value&&(r-t)/e.value;++o<u;)(a=s[o]).y0=n,a.y1=i,a.x0=t,a.x1=t+=a.value*l}cA.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:lA}]},dt(cA,go,{transform(e,t){var n,r,i=this.value,a=t.changed(t.ADD_REM),s=e.modified(oA),o=e.iterations||300;if(i?(a&&(t.modifies("index"),i.nodes(t.source)),(s||t.changed(t.MOD))&&dA(i,e,0,t)):(this.value=i=function(e,t){const n=function(e){var t,n=1,r=.001,i=1-Math.pow(r,1/300),a=0,s=.6,o=new Map,u=KC(d),l=MC("tick","end"),c=function(){let e=1;return()=>(e=(1664525*e+1013904223)%ZC)/ZC}();function d(){h(),l.call("tick",t),n<r&&(u.stop(),l.call("end",t))}function h(r){var u,l,c=e.length;void 0===r&&(r=1);for(var d=0;d<r;++d)for(n+=(a-n)*i,o.forEach((function(e){e(n)})),u=0;u<c;++u)null==(l=e[u]).fx?l.x+=l.vx*=s:(l.x=l.fx,l.vx=0),null==l.fy?l.y+=l.vy*=s:(l.y=l.fy,l.vy=0);return t}function f(){for(var t,n=0,r=e.length;n<r;++n){if((t=e[n]).index=n,null!=t.fx&&(t.x=t.fx),null!=t.fy&&(t.y=t.fy),isNaN(t.x)||isNaN(t.y)){var i=10*Math.sqrt(.5+n),a=n*nA;t.x=i*Math.cos(a),t.y=i*Math.sin(a)}(isNaN(t.vx)||isNaN(t.vy))&&(t.vx=t.vy=0)}}function p(t){return t.initialize&&t.initialize(e,c),t}return null==e&&(e=[]),f(),t={tick:h,restart:function(){return u.restart(d),t},stop:function(){return u.stop(),t},nodes:function(n){return arguments.length?(e=n,f(),o.forEach(p),t):e},alpha:function(e){return arguments.length?(n=+e,t):n},alphaMin:function(e){return arguments.length?(r=+e,t):r},alphaDecay:function(e){return arguments.length?(i=+e,t):+i},alphaTarget:function(e){return arguments.length?(a=+e,t):a},velocityDecay:function(e){return arguments.length?(s=1-e,t):1-s},randomSource:function(e){return arguments.length?(c=e,o.forEach(p),t):c},force:function(e,n){return arguments.length>1?(null==n?o.delete(e):o.set(e,p(n)),t):o.get(e)},find:function(t,n,r){var i,a,s,o,u,l=0,c=e.length;for(null==r?r=1/0:r*=r,l=0;l<c;++l)(s=(i=t-(o=e[l]).x)*i+(a=n-o.y)*a)<r&&(u=o,r=s);return u},on:function(e,n){return arguments.length>1?(l.on(e,n),t):l.on(e)}}}(e),r=n.stop,i=n.restart;let a=!1;return n.stopped=()=>a,n.restart=()=>(a=!1,i()),n.stop=()=>(a=!0,r()),dA(n,t,!0).on("end",(()=>a=!0))}(t.source,e),i.on("tick",(n=t.dataflow,r=this,()=>n.touch(r).run())),e.static||(a=!0,i.tick()),t.modifies("index")),s||a||e.modified(uA)||t.changed()&&e.restart)if(i.alpha(Math.max(i.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(i.alphaMin(),1/o)),e.static)for(i.stop();--o>=0;)i.tick();else if(i.stopped()&&i.restart(),!a)return t.StopPropagation;return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let e,t=this._argops,o=0,u=t.length;o<u;++o)if(e=t[o],e.name===sA&&"link"===e.op._argval.force)for(var r,i=e.op._argops,a=0,s=i.length;a<s;++a)if("links"===i[a].name&&(r=i[a].op.source)){n.pulse(r,n.changeset().reflow());break}return t.reflow(e.modified()).modifies(lA)}}),wA.prototype=mA.prototype={constructor:wA,count:function(){return this.eachAfter(gA)},each:function(e,t){let n=-1;for(const r of this)e.call(t,r,++n,this);return this},eachAfter:function(e,t){for(var n,r,i,a=this,s=[a],o=[],u=-1;a=s.pop();)if(o.push(a),n=a.children)for(r=0,i=n.length;r<i;++r)s.push(n[r]);for(;a=o.pop();)e.call(t,a,++u,this);return this},eachBefore:function(e,t){for(var n,r,i=this,a=[i],s=-1;i=a.pop();)if(e.call(t,i,++s,this),n=i.children)for(r=n.length-1;r>=0;--r)a.push(n[r]);return this},find:function(e,t){let n=-1;for(const r of this)if(e.call(t,r,++n,this))return r},sum:function(e){return this.eachAfter((function(t){for(var n=+e(t.data)||0,r=t.children,i=r&&r.length;--i>=0;)n+=r[i].value;t.value=n}))},sort:function(e){return this.eachBefore((function(t){t.children&&t.children.sort(e)}))},path:function(e){for(var t=this,n=function(e,t){if(e===t)return e;var n=e.ancestors(),r=t.ancestors(),i=null;for(e=n.pop(),t=r.pop();e===t;)i=e,e=n.pop(),t=r.pop();return i}(t,e),r=[t];t!==n;)t=t.parent,r.push(t);for(var i=r.length;e!==n;)r.splice(i,0,e),e=e.parent;return r},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){return Array.from(this)},leaves:function(){var e=[];return this.eachBefore((function(t){t.children||e.push(t)})),e},links:function(){var e=this,t=[];return e.each((function(n){n!==e&&t.push({source:n.parent,target:n})})),t},copy:function(){return mA(this).eachBefore(bA)},[Symbol.iterator]:function*(){var e,t,n,r,i=this,a=[i];do{for(e=a.reverse(),a=[];i=e.pop();)if(yield i,t=i.children)for(n=0,r=t.length;n<r;++n)a.push(t[n])}while(a.length)}};var VA={depth:-1},GA={};function qA(e){return e.id}function HA(e){return e.parentId}function XA(){var e=qA,t=HA;function n(n){var r,i,a,s,o,u,l,c=Array.from(n),d=c.length,h=new Map;for(i=0;i<d;++i)r=c[i],o=c[i]=new wA(r),null!=(u=e(r,i,n))&&(u+="")&&(l=o.id=u,h.set(l,h.has(l)?GA:o)),null!=(u=t(r,i,n))&&(u+="")&&(o.parent=u);for(i=0;i<d;++i)if(u=(o=c[i]).parent){if(!(s=h.get(u)))throw new Error("missing: "+u);if(s===GA)throw new Error("ambiguous: "+u);s.children?s.children.push(o):s.children=[o],o.parent=s}else{if(a)throw new Error("multiple roots");a=o}if(!a)throw new Error("no root");if(a.parent=VA,a.eachBefore((function(e){e.depth=e.parent.depth+1,--d})).eachBefore(xA),a.parent=null,d>0)throw new Error("cycle");return a}return n.id=function(t){return arguments.length?(e=MA(t),n):e},n.parentId=function(e){return arguments.length?(t=MA(e),n):t},n}function KA(e,t){return e.parent===t.parent?1:2}function YA(e){var t=e.children;return t?t[0]:e.t}function QA(e){var t=e.children;return t?t[t.length-1]:e.t}function JA(e,t,n){var r=n/(t.i-e.i);t.c-=r,t.s+=n,e.c+=r,t.z+=n,t.m+=n}function ZA(e,t,n){return e.a.parent===t.parent?e.a:n}function eE(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}function tE(e,t){return e.parent===t.parent?1:2}function nE(e,t){return e+t.x}function rE(e,t){return Math.max(e,t.y)}function iE(e,t,n,r,i){for(var a,s=e.children,o=-1,u=s.length,l=e.value&&(i-n)/e.value;++o<u;)(a=s[o]).x0=t,a.x1=r,a.y0=n,a.y1=n+=a.value*l}eE.prototype=Object.create(wA.prototype);var aE=(1+Math.sqrt(5))/2;function sE(e,t,n,r,i,a){for(var s,o,u,l,c,d,h,f,p,g,m,y=[],v=t.children,b=0,x=0,w=v.length,k=t.value;b<w;){u=i-n,l=a-r;do{c=v[x++].value}while(!c&&x<w);for(d=h=c,m=c*c*(g=Math.max(l/u,u/l)/(k*e)),p=Math.max(h/m,m/d);x<w;++x){if(c+=o=v[x].value,o<d&&(d=o),o>h&&(h=o),m=c*c*g,(f=Math.max(h/m,m/d))>p){c-=o;break}p=f}y.push(s={value:c,dice:u<l,children:v.slice(b,x)}),s.dice?WA(s,n,r,i,k?r+=l*c/k:a):iE(s,n,r,k?n+=u*c/k:i,a),k-=c,b=x}return y}const oE=function e(t){function n(e,n,r,i,a){sE(t,e,n,r,i,a)}return n.ratio=function(t){return e((t=+t)>1?t:1)},n}(aE),uE=function e(t){function n(e,n,r,i,a){if((s=e._squarify)&&s.ratio===t)for(var s,o,u,l,c,d=-1,h=s.length,f=e.value;++d<h;){for(u=(o=s[d]).children,l=o.value=0,c=u.length;l<c;++l)o.value+=u[l].value;o.dice?WA(o,n,r,i,f?r+=(a-r)*o.value/f:a):iE(o,n,r,f?n+=(i-n)*o.value/f:i,a),f-=o.value}else e._squarify=s=sE(t,e,n,r,i,a),s.ratio=t}return n.ratio=function(t){return e((t=+t)>1?t:1)},n}(aE);function lE(e,t,n){const r={};return e.each((e=>{const i=e.data;n(i)&&(r[t(i)]=e)})),e.lookup=r,e}function cE(e){go.call(this,null,e)}cE.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const dE=e=>e.values;function hE(){const e=[],t={entries:e=>r(n(e,0),0),key:n=>(e.push(n),t)};function n(t,r){if(r>=e.length)return t;const i=t.length,a=e[r++],s={},o={};let u,l,c,d=-1;for(;++d<i;)u=a(l=t[d])+"",(c=s[u])?c.push(l):s[u]=[l];for(u in s)o[u]=n(s[u],r);return o}function r(t,n){if(++n>e.length)return t;const i=[];for(const e in t)i.push({key:e,values:r(t[e],n)});return i}return t}function fE(e){go.call(this,null,e)}dt(cE,go,{transform(e,t){t.source||se("Nest transform requires an upstream data source.");var n=e.generate,r=e.modified(),i=t.clone(),a=this.value;return(!a||r||t.changed())&&(a&&a.each((e=>{e.children&&Ms(e.data)&&i.rem.push(e.data)})),this.value=a=mA({values:He(e.keys).reduce(((e,t)=>(e.key(t),e)),hE()).entries(i.source)},dE),n&&a.each((e=>{e.children&&(e=zs(e.data),i.add.push(e),i.source.push(e))})),lE(a,Rs,Rs)),i.source.root=a,i}});const pE=(e,t)=>e.parent===t.parent?1:2;dt(fE,go,{transform(e,t){t.source&&t.source.root||se(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),r=this.fields,i=t.source.root,a=e.as||r;e.field?i.sum(e.field):i.count(),e.sort&&i.sort(Us(e.sort,(e=>e.data))),function(e,t,n){for(let r,i=0,a=t.length;i<a;++i)r=t[i],r in n&&e[r](n[r])}(n,this.params,e),n.separation&&n.separation(!1!==e.separation?pE:he);try{this.value=n(i)}catch(e){se(e)}return i.each((e=>function(e,t,n){const r=e.data,i=t.length-1;for(let a=0;a<i;++a)r[n[a]]=e[t[a]];r[n[i]]=e.children?e.children.length:0}(e,r,a))),t.reflow(e.modified()).modifies(a).modifies("leaf")}});const gE=["x","y","r","depth","children"];function mE(e){fE.call(this,e)}mE.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:gE.length,default:gE}]},dt(mE,fE,{layout:function(){var e=null,t=1,n=1,r=RA;function i(i){return i.x=t/2,i.y=n/2,e?i.eachBefore(LA(e)).eachAfter(PA(r,.5)).eachBefore(jA(1)):i.eachBefore(LA(zA)).eachAfter(PA(RA,1)).eachAfter(PA(r,i.r/Math.min(t,n))).eachBefore(jA(Math.min(t,n)/(2*i.r))),i}return i.radius=function(t){return arguments.length?(e=OA(t),i):e},i.size=function(e){return arguments.length?(t=+e[0],n=+e[1],i):[t,n]},i.padding=function(e){return arguments.length?(r="function"==typeof e?e:BA(+e),i):r},i},params:["radius","size","padding"],fields:gE});const yE=["x0","y0","x1","y1","depth","children"];function vE(e){fE.call(this,e)}function bE(e){go.call(this,null,e)}vE.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:yE.length,default:yE}]},dt(vE,fE,{layout:function(){var e=1,t=1,n=0,r=!1;function i(i){var a=i.height+1;return i.x0=i.y0=n,i.x1=e,i.y1=t/a,i.eachBefore(function(e,t){return function(r){r.children&&WA(r,r.x0,e*(r.depth+1)/t,r.x1,e*(r.depth+2)/t);var i=r.x0,a=r.y0,s=r.x1-n,o=r.y1-n;s<i&&(i=s=(i+s)/2),o<a&&(a=o=(a+o)/2),r.x0=i,r.y0=a,r.x1=s,r.y1=o}}(t,a)),r&&i.eachBefore(UA),i}return i.round=function(e){return arguments.length?(r=!!e,i):r},i.size=function(n){return arguments.length?(e=+n[0],t=+n[1],i):[e,t]},i.padding=function(e){return arguments.length?(n=+e,i):n},i},params:["size","round","padding"],fields:yE}),bE.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},dt(bE,go,{transform(e,t){t.source||se("Stratify transform requires an upstream data source.");let n=this.value;const r=e.modified(),i=t.fork(t.ALL).materialize(t.SOURCE),a=!n||r||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return i.source=i.source.slice(),a&&(n=i.source.length?lE(XA().id(e.key).parentId(e.parentKey)(i.source),e.key,fe):lE(XA()([{}]),e.key,e.key)),i.source.root=this.value=n,i}});const xE={tidy:function(){var e=KA,t=1,n=1,r=null;function i(i){var u=function(e){for(var t,n,r,i,a,s=new eE(e,0),o=[s];t=o.pop();)if(r=t._.children)for(t.children=new Array(a=r.length),i=a-1;i>=0;--i)o.push(n=t.children[i]=new eE(r[i],i)),n.parent=t;return(s.parent=new eE(null,0)).children=[s],s}(i);if(u.eachAfter(a),u.parent.m=-u.z,u.eachBefore(s),r)i.eachBefore(o);else{var l=i,c=i,d=i;i.eachBefore((function(e){e.x<l.x&&(l=e),e.x>c.x&&(c=e),e.depth>d.depth&&(d=e)}));var h=l===c?1:e(l,c)/2,f=h-l.x,p=t/(c.x+h+f),g=n/(d.depth||1);i.eachBefore((function(e){e.x=(e.x+f)*p,e.y=e.depth*g}))}return i}function a(t){var n=t.children,r=t.parent.children,i=t.i?r[t.i-1]:null;if(n){!function(e){for(var t,n=0,r=0,i=e.children,a=i.length;--a>=0;)(t=i[a]).z+=n,t.m+=n,n+=t.s+(r+=t.c)}(t);var a=(n[0].z+n[n.length-1].z)/2;i?(t.z=i.z+e(t._,i._),t.m=t.z-a):t.z=a}else i&&(t.z=i.z+e(t._,i._));t.parent.A=function(t,n,r){if(n){for(var i,a=t,s=t,o=n,u=a.parent.children[0],l=a.m,c=s.m,d=o.m,h=u.m;o=QA(o),a=YA(a),o&&a;)u=YA(u),(s=QA(s)).a=t,(i=o.z+d-a.z-l+e(o._,a._))>0&&(JA(ZA(o,t,r),t,i),l+=i,c+=i),d+=o.m,l+=a.m,h+=u.m,c+=s.m;o&&!QA(s)&&(s.t=o,s.m+=d-c),a&&!YA(u)&&(u.t=a,u.m+=l-h,r=t)}return r}(t,i,t.parent.A||r[0])}function s(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function o(e){e.x*=t,e.y=e.depth*n}return i.separation=function(t){return arguments.length?(e=t,i):e},i.size=function(e){return arguments.length?(r=!1,t=+e[0],n=+e[1],i):r?null:[t,n]},i.nodeSize=function(e){return arguments.length?(r=!0,t=+e[0],n=+e[1],i):r?[t,n]:null},i},cluster:function(){var e=tE,t=1,n=1,r=!1;function i(i){var a,s=0;i.eachAfter((function(t){var n=t.children;n?(t.x=function(e){return e.reduce(nE,0)/e.length}(n),t.y=function(e){return 1+e.reduce(rE,0)}(n)):(t.x=a?s+=e(t,a):0,t.y=0,a=t)}));var o=function(e){for(var t;t=e.children;)e=t[0];return e}(i),u=function(e){for(var t;t=e.children;)e=t[t.length-1];return e}(i),l=o.x-e(o,u)/2,c=u.x+e(u,o)/2;return i.eachAfter(r?function(e){e.x=(e.x-i.x)*t,e.y=(i.y-e.y)*n}:function(e){e.x=(e.x-l)/(c-l)*t,e.y=(1-(i.y?e.y/i.y:1))*n})}return i.separation=function(t){return arguments.length?(e=t,i):e},i.size=function(e){return arguments.length?(r=!1,t=+e[0],n=+e[1],i):r?null:[t,n]},i.nodeSize=function(e){return arguments.length?(r=!0,t=+e[0],n=+e[1],i):r?[t,n]:null},i}},wE=["x","y","depth","children"];function kE(e){fE.call(this,e)}function _E(e){go.call(this,[],e)}kE.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:wE.length,default:wE}]},dt(kE,fE,{layout(e){const t=e||"tidy";if(ot(xE,t))return xE[t]();se("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:wE}),_E.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},dt(_E,go,{transform(e,t){const n=this.value,r=t.source&&t.source.root,i=t.fork(t.NO_SOURCE),a={};return r||se("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(i.rem=n,t.visit(t.SOURCE,(e=>a[Rs(e)]=1)),r.each((e=>{const t=e.data,n=e.parent&&e.parent.data;n&&a[Rs(t)]&&a[Rs(n)]&&i.add.push(zs({source:n,target:t}))})),this.value=i.add):t.changed(t.MOD)&&(t.visit(t.MOD,(e=>a[Rs(e)]=1)),n.forEach((e=>{(a[Rs(e.source)]||a[Rs(e.target)])&&i.mod.push(e)}))),i}});const SE={binary:function(e,t,n,r,i){var a,s,o=e.children,u=o.length,l=new Array(u+1);for(l[0]=s=a=0;a<u;++a)l[a+1]=s+=o[a].value;!function e(t,n,r,i,a,s,u){if(t>=n-1){var c=o[t];return c.x0=i,c.y0=a,c.x1=s,void(c.y1=u)}for(var d=l[t],h=r/2+d,f=t+1,p=n-1;f<p;){var g=f+p>>>1;l[g]<h?f=g+1:p=g}h-l[f-1]<l[f]-h&&t+1<f&&--f;var m=l[f]-d,y=r-m;if(s-i>u-a){var v=r?(i*y+s*m)/r:s;e(t,f,m,i,a,v,u),e(f,n,y,v,a,s,u)}else{var b=r?(a*y+u*m)/r:u;e(t,f,m,i,a,s,b),e(f,n,y,i,b,s,u)}}(0,u,e.value,t,n,r,i)},dice:WA,slice:iE,slicedice:function(e,t,n,r,i){(1&e.depth?iE:WA)(e,t,n,r,i)},squarify:oE,resquarify:uE},CE=["x0","y0","x1","y1","depth","children"];function AE(e){fE.call(this,e)}function EE(e,t,n,r){const i=e.width,a=e.height,s=n||r,o=od(i,a).getContext("2d");t.forEach((e=>FE(o,e,s)));const u=new Uint32Array(o.getImageData(0,0,i,a).data.buffer),l=e.bitmap(),c=s&&e.bitmap();let d,h,f,p,g;for(h=0;h<a;++h)for(d=0;d<i;++d)g=4278190080&u[h*i+d],g&&(f=e(d),p=e(h),r||l.set(f,p),s&&268435456^g&&c.set(f,p));return[l,c]}function FE(e,t,n){if(!t.length)return;const r=t[0].mark.marktype;"group"===r?t.forEach((t=>{t.items.forEach((t=>FE(e,t.items,n)))})):fv[r].draw(e,{items:n?t.map(IE):t})}function IE(e){const t=Ps(e,{});return t.stroke&&(t.strokeOpacity=1),t.fill&&(t.fillOpacity=.0625,t.stroke="#000",t.strokeOpacity=1,t.strokeWidth=2),t}AE.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:CE.length,default:CE}]},dt(AE,fE,{layout(){const e=function(){var e=oE,t=!1,n=1,r=1,i=[0],a=RA,s=RA,o=RA,u=RA,l=RA;function c(e){return e.x0=e.y0=0,e.x1=n,e.y1=r,e.eachBefore(d),i=[0],t&&e.eachBefore(UA),e}function d(t){var n=i[t.depth],r=t.x0+n,c=t.y0+n,d=t.x1-n,h=t.y1-n;d<r&&(r=d=(r+d)/2),h<c&&(c=h=(c+h)/2),t.x0=r,t.y0=c,t.x1=d,t.y1=h,t.children&&(n=i[t.depth+1]=a(t)/2,r+=l(t)-n,c+=s(t)-n,(d-=o(t)-n)<r&&(r=d=(r+d)/2),(h-=u(t)-n)<c&&(c=h=(c+h)/2),e(t,r,c,d,h))}return c.round=function(e){return arguments.length?(t=!!e,c):t},c.size=function(e){return arguments.length?(n=+e[0],r=+e[1],c):[n,r]},c.tile=function(t){return arguments.length?(e=MA(t),c):e},c.padding=function(e){return arguments.length?c.paddingInner(e).paddingOuter(e):c.paddingInner()},c.paddingInner=function(e){return arguments.length?(a="function"==typeof e?e:BA(+e),c):a},c.paddingOuter=function(e){return arguments.length?c.paddingTop(e).paddingRight(e).paddingBottom(e).paddingLeft(e):c.paddingTop()},c.paddingTop=function(e){return arguments.length?(s="function"==typeof e?e:BA(+e),c):s},c.paddingRight=function(e){return arguments.length?(o="function"==typeof e?e:BA(+e),c):o},c.paddingBottom=function(e){return arguments.length?(u="function"==typeof e?e:BA(+e),c):u},c.paddingLeft=function(e){return arguments.length?(l="function"==typeof e?e:BA(+e),c):l},c}();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{ot(SE,t)?e.tile(SE[t]):se("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:CE});const DE=31,NE=new Uint32Array(33),$E=new Uint32Array(33);$E[0]=0,NE[0]=~$E[0];for(let e=1;e<=32;++e)$E[e]=$E[e-1]<<1|1,NE[e]=~$E[e];function TE(e,t,n,r,i,a){let s=n/2;return e-s<0||e+s>i||t-(s=r/2)<0||t+s>a}function OE(e,t,n,r,i,a,s,o){const u=i*a/(2*r),l=e(t-u),c=e(t+u),d=e(n-(a/=2)),h=e(n+a);return s.outOfBounds(l,d,c,h)||s.getRange(l,d,c,h)||o&&o.getRange(l,d,c,h)}const ME=[-1,-1,1,1],RE=[-1,1,-1,1],BE=["right","center","left"],zE=["bottom","middle","top"];function LE(e,t,n,r,i,a,s,o,u,l,c,d){return!(i.outOfBounds(e,n,t,r)||(d&&a?a.getRange(e,n,t,r)||!function(e,t,n,r,i){return i[0]<=e&&n<=i[2]&&i[3]<=t&&r<=i[5]}(s,u,o,l,c):i.getRange(e,n,t,r)))}const PE={"top-left":0,top:1,"top-right":2,left:4,middle:5,right:6,"bottom-left":8,bottom:9,"bottom-right":10},jE={naive:function(e,t,n,r){const i=e.width,a=e.height;return function(e){const t=e.datum.datum.items[r].items,n=t.length,s=e.datum.fontSize,o=Hy.width(e.datum,e.datum.text);let u,l,c,d,h,f,p,g=0;for(let r=0;r<n;++r)u=t[r].x,c=t[r].y,l=void 0===t[r].x2?u:t[r].x2,d=void 0===t[r].y2?c:t[r].y2,h=(u+l)/2,f=(c+d)/2,p=Math.abs(l-u+d-c),p>=g&&(g=p,e.x=h,e.y=f);return h=o/2,f=s/2,u=e.x-h,l=e.x+h,c=e.y-f,d=e.y+f,e.align="center",u<0&&l<=i?e.align="left":0<=u&&i<l&&(e.align="right"),e.baseline="middle",c<0&&d<=a?e.baseline="top":0<=c&&a<d&&(e.baseline="bottom"),!0}},"reduced-search":function(e,t,n,r){const i=e.width,a=e.height,s=t[0],o=t[1];function u(t,n,r,u,l){const c=e.invert(t),d=e.invert(n);let h,f=r,p=a;if(!TE(c,d,u,l,i,a)&&!OE(e,c,d,l,u,f,s,o)&&!OE(e,c,d,l,u,l,s,null)){for(;p-f>=1;)h=(f+p)/2,OE(e,c,d,l,u,h,s,o)?p=h:f=h;if(f>r)return[c,d,f,!0]}}return function(t){const o=t.datum.datum.items[r].items,l=o.length,c=t.datum.fontSize,d=Hy.width(t.datum,t.datum.text);let h,f,p,g,m,y,v,b,x,w,k,_,S,C,A,E,F,I=n?c:0,D=!1,N=!1,$=0;for(let r=0;r<l;++r){for(h=o[r].x,p=o[r].y,f=void 0===o[r].x2?h:o[r].x2,g=void 0===o[r].y2?p:o[r].y2,h>f&&(F=h,h=f,f=F),p>g&&(F=p,p=g,g=F),x=e(h),k=e(f),w=~~((x+k)/2),_=e(p),C=e(g),S=~~((_+C)/2),v=w;v>=x;--v)for(b=S;b>=_;--b)E=u(v,b,I,d,c),E&&([t.x,t.y,I,D]=E);for(v=w;v<=k;++v)for(b=S;b<=C;++b)E=u(v,b,I,d,c),E&&([t.x,t.y,I,D]=E);D||n||(A=Math.abs(f-h+g-p),m=(h+f)/2,y=(p+g)/2,A>=$&&!TE(m,y,d,c,i,a)&&!OE(e,m,y,c,d,c,s,null)&&($=A,t.x=m,t.y=y,N=!0))}return!(!D&&!N||(m=d/2,y=c/2,s.setRange(e(t.x-m),e(t.y-y),e(t.x+m),e(t.y+y)),t.align="center",t.baseline="middle",0))}},floodfill:function(e,t,n,r){const i=e.width,a=e.height,s=t[0],o=t[1],u=e.bitmap();return function(t){const l=t.datum.datum.items[r].items,c=l.length,d=t.datum.fontSize,h=Hy.width(t.datum,t.datum.text),f=[];let p,g,m,y,v,b,x,w,k,_,S,C,A=n?d:0,E=!1,F=!1,I=0;for(let r=0;r<c;++r){for(p=l[r].x,m=l[r].y,g=void 0===l[r].x2?p:l[r].x2,y=void 0===l[r].y2?m:l[r].y2,f.push([e((p+g)/2),e((m+y)/2)]);f.length;)if([x,w]=f.pop(),!(s.get(x,w)||o.get(x,w)||u.get(x,w))){u.set(x,w);for(let e=0;e<4;++e)v=x+ME[e],b=w+RE[e],u.outOfBounds(v,b,v,b)||f.push([v,b]);if(v=e.invert(x),b=e.invert(w),k=A,_=a,!TE(v,b,h,d,i,a)&&!OE(e,v,b,d,h,k,s,o)&&!OE(e,v,b,d,h,d,s,null)){for(;_-k>=1;)S=(k+_)/2,OE(e,v,b,d,h,S,s,o)?_=S:k=S;k>A&&(t.x=v,t.y=b,A=k,E=!0)}}E||n||(C=Math.abs(g-p+y-m),v=(p+g)/2,b=(m+y)/2,C>=I&&!TE(v,b,h,d,i,a)&&!OE(e,v,b,d,h,d,s,null)&&(I=C,t.x=v,t.y=b,F=!0))}return!(!E&&!F||(v=h/2,b=d/2,s.setRange(e(t.x-v),e(t.y-b),e(t.x+v),e(t.y+b)),t.align="center",t.baseline="middle",0))}}};function UE(e,t,n,r,i,a,s,o,u,l,c){if(!e.length)return e;const d=Math.max(r.length,i.length),h=function(e,t){const n=new Float64Array(t),r=e.length;for(let t=0;t<r;++t)n[t]=e[t]||0;for(let e=r;e<t;++e)n[e]=n[r-1];return n}(r,d),f=function(e,t){const n=new Int8Array(t),r=e.length;for(let t=0;t<r;++t)n[t]|=PE[e[t]];for(let e=r;e<t;++e)n[e]=n[r-1];return n}(i,d),p=(x=e[0].datum)&&x.mark&&x.mark.marktype,g="group"===p&&e[0].datum.items[u].marktype,m="area"===g,y=function(e,t,n,r){const i=e=>[e.x,e.x,e.x,e.y,e.y,e.y];return e?"line"===e||"area"===e?e=>i(e.datum):"line"===t?e=>{const t=e.datum.items[r].items;return i(t.length?t["start"===n?0:t.length-1]:{x:NaN,y:NaN})}:e=>{const t=e.datum.bounds;return[t.x1,(t.x1+t.x2)/2,t.x2,t.y1,(t.y1+t.y2)/2,t.y2]}:i}(p,g,o,u),v=function(e,t,n){const r=Math.max(1,Math.sqrt(e*t/1e6)),i=~~((e+2*n+r)/r),a=~~((t+2*n+r)/r),s=e=>~~((e+n)/r);return s.invert=e=>e*r-n,s.bitmap=()=>function(e,t){const n=new Uint32Array(~~((e*t+32)/32));function r(e,t){n[e]|=t}function i(e,t){n[e]&=t}return{array:n,get:(t,r)=>{const i=r*e+t;return n[i>>>5]&1<<(i&DE)},set:(t,n)=>{const i=n*e+t;r(i>>>5,1<<(i&DE))},clear:(t,n)=>{const r=n*e+t;i(r>>>5,~(1<<(r&DE)))},getRange:(t,r,i,a)=>{let s,o,u,l,c=a;for(;c>=r;--c)if(s=c*e+t,o=c*e+i,u=s>>>5,l=o>>>5,u===l){if(n[u]&NE[s&DE]&$E[1+(o&DE)])return!0}else{if(n[u]&NE[s&DE])return!0;if(n[l]&$E[1+(o&DE)])return!0;for(let e=u+1;e<l;++e)if(n[e])return!0}return!1},setRange:(t,n,i,a)=>{let s,o,u,l,c;for(;n<=a;++n)if(s=n*e+t,o=n*e+i,u=s>>>5,l=o>>>5,u===l)r(u,NE[s&DE]&$E[1+(o&DE)]);else for(r(u,NE[s&DE]),r(l,$E[1+(o&DE)]),c=u+1;c<l;++c)r(c,4294967295)},clearRange:(t,n,r,a)=>{let s,o,u,l,c;for(;n<=a;++n)if(s=n*e+t,o=n*e+r,u=s>>>5,l=o>>>5,u===l)i(u,$E[s&DE]|NE[1+(o&DE)]);else for(i(u,$E[s&DE]),i(l,NE[1+(o&DE)]),c=u+1;c<l;++c)i(c,0)},outOfBounds:(n,r,i,a)=>n<0||r<0||a>=t||i>=e}}(i,a),s.ratio=r,s.padding=n,s.width=e,s.height=t,s}(t[0],t[1],l),b=m&&"naive"===c;var x;const w=e.map((e=>({datum:e,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:y(e)})));let k;if(!b){n&&w.sort(((e,t)=>n(e.datum,t.datum)));let t=!1;for(let e=0;e<f.length&&!t;++e)t=5===f[e]||h[e]<0;p&&(s||m)&&(a=[e.map((e=>e.datum))].concat(a)),k=a.length?EE(v,a,t,m):function(e,t){const n=e.bitmap();return(t||[]).forEach((t=>n.set(e(t.boundary[0]),e(t.boundary[3])))),[n,void 0]}(v,s&&w)}const _=m?jE[c](v,k,s,u):function(e,t,n,r){const i=e.width,a=e.height,s=t[0],o=t[1],u=r.length;return function(t){const l=t.boundary,c=t.datum.fontSize;if(l[2]<0||l[5]<0||l[0]>i||l[3]>a)return!1;let d,h,f,p,g,m,y,v,b,x,w,k,_,S,C,A=0;for(let i=0;i<u;++i){if(d=(3&n[i])-1,h=(n[i]>>>2&3)-1,f=0===d&&0===h||r[i]<0,p=d&&h?Math.SQRT1_2:1,g=r[i]<0?-1:1,m=l[1+d]+r[i]*d*p,w=l[4+h]+g*c*h/2+r[i]*h*p,v=w-c/2,b=w+c/2,k=e(m),S=e(v),C=e(b),!A){if(!LE(k,k,S,C,s,o,m,m,v,b,l,f))continue;A=Hy.width(t.datum,t.datum.text)}if(x=m+g*A*d/2,m=x-A/2,y=x+A/2,k=e(m),_=e(y),LE(k,_,S,C,s,o,m,y,v,b,l,f))return t.x=d?d*g<0?y:m:x,t.y=h?h*g<0?b:v:w,t.align=BE[d*g+1],t.baseline=zE[h*g+1],s.setRange(k,S,_,C),!0}return!1}}(v,k,f,h);return w.forEach((e=>e.opacity=+_(e))),w}const WE=["x","y","opacity","align","baseline"],VE=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function GE(e){go.call(this,null,e)}function qE(e,t){var n,r,i,a,s,o,u=[],l=function(e){return e(a)};if(null==t)u.push(e);else for(n={},r=0,i=e.length;r<i;++r)a=e[r],(o=n[s=t.map(l)])||(n[s]=o=[],o.dims=s,u.push(o)),o.push(a);return u}function HE(e){go.call(this,null,e)}GE.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:VE},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:WE.length,default:WE}]},dt(GE,go,{transform(e,t){const n=e.modified();if(!(n||t.changed(t.ADD_REM)||function(n){const r=e.sort;return Ke(r)&&t.modified(r.fields)}()))return;e.size&&2===e.size.length||se("Size parameter should be specified as a [width, height] array.");const r=e.as||WE;return UE(t.materialize(t.SOURCE).source,e.size,e.sort,He(e.offset||1),He(e.anchor||VE),e.avoidMarks||[],!1!==e.avoidBaseMark,e.lineAnchor||"end",e.markIndex||0,e.padding||0,e.method||"naive").forEach((e=>{const t=e.datum;t[r[0]]=e.x,t[r[1]]=e.y,t[r[2]]=e.opacity,t[r[3]]=e.align,t[r[4]]=e.baseline})),t.reflow(n).modifies(r)}}),HE.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},dt(HE,go,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=qE(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map(te),a=i.length,s=e.as||[te(e.x),te(e.y)],o=[];r.forEach((t=>{gu(t,e.x,e.y,e.bandwidth||.3).forEach((e=>{const n={};for(let e=0;e<a;++e)n[i[e]]=t.dims[e];n[s[0]]=e[0],n[s[1]]=e[1],o.push(zs(n))}))})),this.value&&(n.rem=this.value),this.value=n.add=n.source=o}return n}});const XE={linear:uu,log:lu,exp:cu,pow:du,quad:hu,poly:fu};function KE(e){go.call(this,null,e)}KE.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(XE)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},dt(KE,go,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=qE(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map(te),a=e.method||"linear",s=e.order||3,o=((e,t)=>"poly"===e?t:"quad"===e?2:1)(a,s),u=e.as||[te(e.x),te(e.y)],l=XE[a],c=[];let d=e.extent;ot(XE,a)||se("Invalid regression method: "+a),null!=d&&"log"===a&&d[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),d=null),r.forEach((n=>{if(n.length<=o)return void t.dataflow.warn("Skipping regression with more parameters than data points.");const r=l(n,e.x,e.y,s);if(e.params)return void c.push(zs({keys:n.dims,coef:r.coef,rSquared:r.rSquared}));const h=d||it(n,e.x),f=e=>{const t={};for(let e=0;e<i.length;++e)t[i[e]]=n.dims[e];t[u[0]]=e[0],t[u[1]]=e[1],c.push(zs(t))};"linear"===a?h.forEach((e=>f([e,r.predict(e)]))):bu(r.predict,h,25,200).forEach(f)})),this.value&&(n.rem=this.value),this.value=n.add=n.source=c}return n}});const YE=Math.pow(2,-52),QE=new Uint32Array(512);class JE{static from(e,t=sF,n=oF){const r=e.length,i=new Float64Array(2*r);for(let a=0;a<r;a++){const r=e[a];i[2*a]=t(r),i[2*a+1]=n(r)}return new JE(i)}constructor(e){const t=e.length>>1;if(t>0&&"number"!=typeof e[0])throw new Error("Expected coords to contain numbers.");this.coords=e;const n=Math.max(2*t-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:n,_hullTri:r,_hullHash:i}=this,a=e.length>>1;let s=1/0,o=1/0,u=-1/0,l=-1/0;for(let t=0;t<a;t++){const n=e[2*t],r=e[2*t+1];n<s&&(s=n),r<o&&(o=r),n>u&&(u=n),r>l&&(l=r),this._ids[t]=t}const c=(s+u)/2,d=(o+l)/2;let h,f,p,g=1/0;for(let t=0;t<a;t++){const n=ZE(c,d,e[2*t],e[2*t+1]);n<g&&(h=t,g=n)}const m=e[2*h],y=e[2*h+1];g=1/0;for(let t=0;t<a;t++){if(t===h)continue;const n=ZE(m,y,e[2*t],e[2*t+1]);n<g&&n>0&&(f=t,g=n)}let v=e[2*f],b=e[2*f+1],x=1/0;for(let t=0;t<a;t++){if(t===h||t===f)continue;const n=rF(m,y,v,b,e[2*t],e[2*t+1]);n<x&&(p=t,x=n)}let w=e[2*p],k=e[2*p+1];if(x===1/0){for(let t=0;t<a;t++)this._dists[t]=e[2*t]-e[0]||e[2*t+1]-e[1];iF(this._ids,this._dists,0,a-1);const t=new Uint32Array(a);let n=0;for(let e=0,r=-1/0;e<a;e++){const i=this._ids[e];this._dists[i]>r&&(t[n++]=i,r=this._dists[i])}return this.hull=t.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(tF(m,y,v,b,w,k)){const e=f,t=v,n=b;f=p,v=w,b=k,p=e,w=t,k=n}const _=function(e,t,n,r,i,a){const s=n-e,o=r-t,u=i-e,l=a-t,c=s*s+o*o,d=u*u+l*l,h=.5/(s*l-o*u);return{x:e+(l*c-o*d)*h,y:t+(s*d-u*c)*h}}(m,y,v,b,w,k);this._cx=_.x,this._cy=_.y;for(let t=0;t<a;t++)this._dists[t]=ZE(e[2*t],e[2*t+1],_.x,_.y);iF(this._ids,this._dists,0,a-1),this._hullStart=h;let S=3;n[h]=t[p]=f,n[f]=t[h]=p,n[p]=t[f]=h,r[h]=0,r[f]=1,r[p]=2,i.fill(-1),i[this._hashKey(m,y)]=h,i[this._hashKey(v,b)]=f,i[this._hashKey(w,k)]=p,this.trianglesLen=0,this._addTriangle(h,f,p,-1,-1,-1);for(let a,s,o=0;o<this._ids.length;o++){const u=this._ids[o],l=e[2*u],c=e[2*u+1];if(o>0&&Math.abs(l-a)<=YE&&Math.abs(c-s)<=YE)continue;if(a=l,s=c,u===h||u===f||u===p)continue;let d=0;for(let e=0,t=this._hashKey(l,c);e<this._hashSize&&(d=i[(t+e)%this._hashSize],-1===d||d===n[d]);e++);d=t[d];let g,m=d;for(;g=n[m],!tF(l,c,e[2*m],e[2*m+1],e[2*g],e[2*g+1]);)if(m=g,m===d){m=-1;break}if(-1===m)continue;let y=this._addTriangle(m,u,n[m],-1,-1,r[m]);r[u]=this._legalize(y+2),r[m]=y,S++;let v=n[m];for(;g=n[v],tF(l,c,e[2*v],e[2*v+1],e[2*g],e[2*g+1]);)y=this._addTriangle(v,u,g,r[u],-1,r[v]),r[u]=this._legalize(y+2),n[v]=v,S--,v=g;if(m===d)for(;g=t[m],tF(l,c,e[2*g],e[2*g+1],e[2*m],e[2*m+1]);)y=this._addTriangle(g,u,m,-1,r[m],r[g]),this._legalize(y+2),r[g]=y,n[m]=m,S--,m=g;this._hullStart=t[u]=m,n[m]=t[v]=u,n[u]=v,i[this._hashKey(l,c)]=u,i[this._hashKey(e[2*m],e[2*m+1])]=m}this.hull=new Uint32Array(S);for(let e=0,t=this._hullStart;e<S;e++)this.hull[e]=t,t=n[t];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(function(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:n,coords:r}=this;let i=0,a=0;for(;;){const s=n[e],o=e-e%3;if(a=o+(e+2)%3,-1===s){if(0===i)break;e=QE[--i];continue}const u=s-s%3,l=o+(e+1)%3,c=u+(s+2)%3,d=t[a],h=t[e],f=t[l],p=t[c];if(nF(r[2*d],r[2*d+1],r[2*h],r[2*h+1],r[2*f],r[2*f+1],r[2*p],r[2*p+1])){t[e]=p,t[s]=d;const r=n[c];if(-1===r){let t=this._hullStart;do{if(this._hullTri[t]===c){this._hullTri[t]=e;break}t=this._hullPrev[t]}while(t!==this._hullStart)}this._link(e,r),this._link(s,n[a]),this._link(a,c);const o=u+(s+1)%3;i<QE.length&&(QE[i++]=o)}else{if(0===i)break;e=QE[--i]}}return a}_link(e,t){this._halfedges[e]=t,-1!==t&&(this._halfedges[t]=e)}_addTriangle(e,t,n,r,i,a){const s=this.trianglesLen;return this._triangles[s]=e,this._triangles[s+1]=t,this._triangles[s+2]=n,this._link(s,r),this._link(s+1,i),this._link(s+2,a),this.trianglesLen+=3,s}}function ZE(e,t,n,r){const i=e-n,a=t-r;return i*i+a*a}function eF(e,t,n,r,i,a){const s=(r-t)*(i-e),o=(n-e)*(a-t);return Math.abs(s-o)>=33306690738754716e-32*Math.abs(s+o)?s-o:0}function tF(e,t,n,r,i,a){return(eF(i,a,e,t,n,r)||eF(e,t,n,r,i,a)||eF(n,r,i,a,e,t))<0}function nF(e,t,n,r,i,a,s,o){const u=e-s,l=t-o,c=n-s,d=r-o,h=i-s,f=a-o,p=c*c+d*d,g=h*h+f*f;return u*(d*g-p*f)-l*(c*g-p*h)+(u*u+l*l)*(c*f-d*h)<0}function rF(e,t,n,r,i,a){const s=n-e,o=r-t,u=i-e,l=a-t,c=s*s+o*o,d=u*u+l*l,h=.5/(s*l-o*u),f=(l*c-o*d)*h,p=(s*d-u*c)*h;return f*f+p*p}function iF(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const r=e[i],a=t[r];let s=i-1;for(;s>=n&&t[e[s]]>a;)e[s+1]=e[s--];e[s+1]=r}else{let i=n+1,a=r;aF(e,n+r>>1,i),t[e[n]]>t[e[r]]&&aF(e,n,r),t[e[i]]>t[e[r]]&&aF(e,i,r),t[e[n]]>t[e[i]]&&aF(e,n,i);const s=e[i],o=t[s];for(;;){do{i++}while(t[e[i]]<o);do{a--}while(t[e[a]]>o);if(a<i)break;aF(e,i,a)}e[n+1]=e[a],e[a]=s,r-i+1>=a-n?(iF(e,t,i,r),iF(e,t,n,a-1)):(iF(e,t,n,a-1),iF(e,t,i,r))}}function aF(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function sF(e){return e[0]}function oF(e){return e[1]}const uF=1e-6;class lF{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,n){const r=(e=+e)+(n=+n),i=t=+t;if(n<0)throw new Error("negative radius");null===this._x1?this._+=`M${r},${i}`:(Math.abs(this._x1-r)>uF||Math.abs(this._y1-i)>uF)&&(this._+="L"+r+","+i),n&&(this._+=`A${n},${n},0,1,1,${e-n},${t}A${n},${n},0,1,1,${this._x1=r},${this._y1=i}`)}rect(e,t,n,r){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+n}v${+r}h${-n}Z`}value(){return this._||null}}class cF{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class dF{constructor(e,[t,n,r,i]=[0,0,960,500]){if(!((r=+r)>=(t=+t)&&(i=+i)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(2*e.points.length),this.vectors=new Float64Array(2*e.points.length),this.xmax=r,this.xmin=t,this.ymax=i,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:n},vectors:r}=this,i=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let t,r,a=0,s=0,o=n.length;a<o;a+=3,s+=2){const o=2*n[a],u=2*n[a+1],l=2*n[a+2],c=e[o],d=e[o+1],h=e[u],f=e[u+1],p=e[l],g=e[l+1],m=h-c,y=f-d,v=p-c,b=g-d,x=m*m+y*y,w=v*v+b*b,k=2*(m*b-y*v);if(k)if(Math.abs(k)<1e-8)t=(c+p)/2,r=(d+g)/2;else{const e=1/k;t=c+(b*x-y*w)*e,r=d+(m*w-v*x)*e}else t=(c+p)/2-1e8*b,r=(d+g)/2+1e8*v;i[s]=t,i[s+1]=r}let a,s,o,u=t[t.length-1],l=4*u,c=e[2*u],d=e[2*u+1];r.fill(0);for(let n=0;n<t.length;++n)u=t[n],a=l,s=c,o=d,l=4*u,c=e[2*u],d=e[2*u+1],r[a+2]=r[l]=o-d,r[a+3]=r[l+1]=c-s}render(e){const t=null==e?e=new lF:void 0,{delaunay:{halfedges:n,inedges:r,hull:i},circumcenters:a,vectors:s}=this;if(i.length<=1)return null;for(let t=0,r=n.length;t<r;++t){const r=n[t];if(r<t)continue;const i=2*Math.floor(t/3),s=2*Math.floor(r/3),o=a[i],u=a[i+1],l=a[s],c=a[s+1];this._renderSegment(o,u,l,c,e)}let o,u=i[i.length-1];for(let t=0;t<i.length;++t){o=u,u=i[t];const n=2*Math.floor(r[u]/3),l=a[n],c=a[n+1],d=4*o,h=this._project(l,c,s[d+2],s[d+3]);h&&this._renderSegment(l,c,h[0],h[1],e)}return t&&t.value()}renderBounds(e){const t=null==e?e=new lF:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const n=null==t?t=new lF:void 0,r=this._clip(e);if(null===r||!r.length)return;t.moveTo(r[0],r[1]);let i=r.length;for(;r[0]===r[i-2]&&r[1]===r[i-1]&&i>1;)i-=2;for(let e=2;e<i;e+=2)r[e]===r[e-2]&&r[e+1]===r[e-1]||t.lineTo(r[e],r[e+1]);return t.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,n=e.length/2;t<n;++t){const e=this.cellPolygon(t);e&&(e.index=t,yield e)}}cellPolygon(e){const t=new cF;return this.renderCell(e,t),t.value()}_renderSegment(e,t,n,r,i){let a;const s=this._regioncode(e,t),o=this._regioncode(n,r);0===s&&0===o?(i.moveTo(e,t),i.lineTo(n,r)):(a=this._clipSegment(e,t,n,r,s,o))&&(i.moveTo(a[0],a[1]),i.lineTo(a[2],a[3]))}contains(e,t,n){return(t=+t)==t&&(n=+n)==n&&this.delaunay._step(e,t,n)===e}*neighbors(e){const t=this._clip(e);if(t)for(const n of this.delaunay.neighbors(e)){const e=this._clip(n);if(e)e:for(let r=0,i=t.length;r<i;r+=2)for(let a=0,s=e.length;a<s;a+=2)if(t[r]==e[a]&&t[r+1]==e[a+1]&&t[(r+2)%i]==e[(a+s-2)%s]&&t[(r+3)%i]==e[(a+s-1)%s]){yield n;break e}}}_cell(e){const{circumcenters:t,delaunay:{inedges:n,halfedges:r,triangles:i}}=this,a=n[e];if(-1===a)return null;const s=[];let o=a;do{const n=Math.floor(o/3);if(s.push(t[2*n],t[2*n+1]),o=o%3==2?o-2:o+1,i[o]!==e)break;o=r[o]}while(o!==a&&-1!==o);return s}_clip(e){if(0===e&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(null===t)return null;const{vectors:n}=this,r=4*e;return n[r]||n[r+1]?this._clipInfinite(e,t,n[r],n[r+1],n[r+2],n[r+3]):this._clipFinite(e,t)}_clipFinite(e,t){const n=t.length;let r,i,a,s,o,u=null,l=t[n-2],c=t[n-1],d=this._regioncode(l,c);for(let h=0;h<n;h+=2)if(r=l,i=c,l=t[h],c=t[h+1],a=d,d=this._regioncode(l,c),0===a&&0===d)s=o,o=0,u?u.push(l,c):u=[l,c];else{let t,n,h,f,p;if(0===a){if(null===(t=this._clipSegment(r,i,l,c,a,d)))continue;[n,h,f,p]=t}else{if(null===(t=this._clipSegment(l,c,r,i,d,a)))continue;[f,p,n,h]=t,s=o,o=this._edgecode(n,h),s&&o&&this._edge(e,s,o,u,u.length),u?u.push(n,h):u=[n,h]}s=o,o=this._edgecode(f,p),s&&o&&this._edge(e,s,o,u,u.length),u?u.push(f,p):u=[f,p]}if(u)s=o,o=this._edgecode(u[0],u[1]),s&&o&&this._edge(e,s,o,u,u.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return u}_clipSegment(e,t,n,r,i,a){for(;;){if(0===i&&0===a)return[e,t,n,r];if(i&a)return null;let s,o,u=i||a;8&u?(s=e+(n-e)*(this.ymax-t)/(r-t),o=this.ymax):4&u?(s=e+(n-e)*(this.ymin-t)/(r-t),o=this.ymin):2&u?(o=t+(r-t)*(this.xmax-e)/(n-e),s=this.xmax):(o=t+(r-t)*(this.xmin-e)/(n-e),s=this.xmin),i?(e=s,t=o,i=this._regioncode(e,t)):(n=s,r=o,a=this._regioncode(n,r))}}_clipInfinite(e,t,n,r,i,a){let s,o=Array.from(t);if((s=this._project(o[0],o[1],n,r))&&o.unshift(s[0],s[1]),(s=this._project(o[o.length-2],o[o.length-1],i,a))&&o.push(s[0],s[1]),o=this._clipFinite(e,o))for(let t,n=0,r=o.length,i=this._edgecode(o[r-2],o[r-1]);n<r;n+=2)t=i,i=this._edgecode(o[n],o[n+1]),t&&i&&(n=this._edge(e,t,i,o,n),r=o.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(o=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return o}_edge(e,t,n,r,i){for(;t!==n;){let n,a;switch(t){case 5:t=4;continue;case 4:t=6,n=this.xmax,a=this.ymin;break;case 6:t=2;continue;case 2:t=10,n=this.xmax,a=this.ymax;break;case 10:t=8;continue;case 8:t=9,n=this.xmin,a=this.ymax;break;case 9:t=1;continue;case 1:t=5,n=this.xmin,a=this.ymin}r[i]===n&&r[i+1]===a||!this.contains(e,n,a)||(r.splice(i,0,n,a),i+=2)}if(r.length>4)for(let e=0;e<r.length;e+=2){const t=(e+2)%r.length,n=(e+4)%r.length;(r[e]===r[t]&&r[t]===r[n]||r[e+1]===r[t+1]&&r[t+1]===r[n+1])&&(r.splice(t,2),e-=2)}return i}_project(e,t,n,r){let i,a,s,o=1/0;if(r<0){if(t<=this.ymin)return null;(i=(this.ymin-t)/r)<o&&(s=this.ymin,a=e+(o=i)*n)}else if(r>0){if(t>=this.ymax)return null;(i=(this.ymax-t)/r)<o&&(s=this.ymax,a=e+(o=i)*n)}if(n>0){if(e>=this.xmax)return null;(i=(this.xmax-e)/n)<o&&(a=this.xmax,s=t+(o=i)*r)}else if(n<0){if(e<=this.xmin)return null;(i=(this.xmin-e)/n)<o&&(a=this.xmin,s=t+(o=i)*r)}return[a,s]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}}const hF=2*Math.PI,fF=Math.pow;function pF(e){return e[0]}function gF(e){return e[1]}function mF(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class yF{static from(e,t=pF,n=gF,r){return new yF("length"in e?function(e,t,n,r){const i=e.length,a=new Float64Array(2*i);for(let s=0;s<i;++s){const i=e[s];a[2*s]=t.call(r,i,s,e),a[2*s+1]=n.call(r,i,s,e)}return a}(e,t,n,r):Float64Array.from(function*(e,t,n,r){let i=0;for(const a of e)yield t.call(r,a,i,e),yield n.call(r,a,i,e),++i}(e,t,n,r)))}constructor(e){this._delaunator=new JE(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&function(e){const{triangles:t,coords:n}=e;for(let e=0;e<t.length;e+=3){const r=2*t[e],i=2*t[e+1],a=2*t[e+2];if((n[a]-n[r])*(n[i+1]-n[r+1])-(n[i]-n[r])*(n[a+1]-n[r+1])>1e-10)return!1}return!0}(e)){this.collinear=Int32Array.from({length:t.length/2},((e,t)=>t)).sort(((e,n)=>t[2*e]-t[2*n]||t[2*e+1]-t[2*n+1]));const e=this.collinear[0],n=this.collinear[this.collinear.length-1],r=[t[2*e],t[2*e+1],t[2*n],t[2*n+1]],i=1e-8*Math.hypot(r[3]-r[1],r[2]-r[0]);for(let e=0,n=t.length/2;e<n;++e){const n=mF(t[2*e],t[2*e+1],i);t[2*e]=n[0],t[2*e+1]=n[1]}this._delaunator=new JE(t)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,i=this.triangles=this._delaunator.triangles,a=this.inedges.fill(-1),s=this._hullIndex.fill(-1);for(let e=0,t=n.length;e<t;++e){const t=i[e%3==2?e-2:e+1];-1!==n[e]&&-1!==a[t]||(a[t]=e)}for(let e=0,t=r.length;e<t;++e)s[r[e]]=e;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],this.triangles[1]=r[1],this.triangles[2]=r[1],a[r[0]]=1,2===r.length&&(a[r[1]]=0))}voronoi(e){return new dF(this,e)}*neighbors(e){const{inedges:t,hull:n,_hullIndex:r,halfedges:i,triangles:a,collinear:s}=this;if(s){const t=s.indexOf(e);return t>0&&(yield s[t-1]),void(t<s.length-1&&(yield s[t+1]))}const o=t[e];if(-1===o)return;let u=o,l=-1;do{if(yield l=a[u],u=u%3==2?u-2:u+1,a[u]!==e)return;if(u=i[u],-1===u){const t=n[(r[e]+1)%n.length];return void(t!==l&&(yield t))}}while(u!==o)}find(e,t,n=0){if((e=+e)!=e||(t=+t)!=t)return-1;const r=n;let i;for(;(i=this._step(n,e,t))>=0&&i!==n&&i!==r;)n=i;return i}_step(e,t,n){const{inedges:r,hull:i,_hullIndex:a,halfedges:s,triangles:o,points:u}=this;if(-1===r[e]||!u.length)return(e+1)%(u.length>>1);let l=e,c=fF(t-u[2*e],2)+fF(n-u[2*e+1],2);const d=r[e];let h=d;do{let r=o[h];const d=fF(t-u[2*r],2)+fF(n-u[2*r+1],2);if(d<c&&(c=d,l=r),h=h%3==2?h-2:h+1,o[h]!==e)break;if(h=s[h],-1===h){if(h=i[(a[e]+1)%i.length],h!==r&&fF(t-u[2*h],2)+fF(n-u[2*h+1],2)<c)return h;break}}while(h!==d);return l}render(e){const t=null==e?e=new lF:void 0,{points:n,halfedges:r,triangles:i}=this;for(let t=0,a=r.length;t<a;++t){const a=r[t];if(a<t)continue;const s=2*i[t],o=2*i[a];e.moveTo(n[s],n[s+1]),e.lineTo(n[o],n[o+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t=2){const n=null==e?e=new lF:void 0,{points:r}=this;for(let n=0,i=r.length;n<i;n+=2){const i=r[n],a=r[n+1];e.moveTo(i+t,a),e.arc(i,a,t,0,hF)}return n&&n.value()}renderHull(e){const t=null==e?e=new lF:void 0,{hull:n,points:r}=this,i=2*n[0],a=n.length;e.moveTo(r[i],r[i+1]);for(let t=1;t<a;++t){const i=2*n[t];e.lineTo(r[i],r[i+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new cF;return this.renderHull(e),e.value()}renderTriangle(e,t){const n=null==t?t=new lF:void 0,{points:r,triangles:i}=this,a=2*i[e*=3],s=2*i[e+1],o=2*i[e+2];return t.moveTo(r[a],r[a+1]),t.lineTo(r[s],r[s+1]),t.lineTo(r[o],r[o+1]),t.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,n=e.length/3;t<n;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new cF;return this.renderTriangle(e,t),t.value()}}function vF(e){go.call(this,null,e)}vF.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const bF=[-1e5,-1e5,1e5,1e5];function xF(e){const t=e[0][0],n=e[0][1];let r=e.length-1;for(;e[r][0]===t&&e[r][1]===n;--r);return"M"+e.slice(0,r+1).join("L")+"Z"}dt(vF,go,{transform(e,t){const n=e.as||"path",r=t.source;if(!r||!r.length)return t;let i=e.size;i=i?[0,0,i[0],i[1]]:(i=e.extent)?[i[0][0],i[0][1],i[1][0],i[1][1]]:bF;const a=this.value=yF.from(r,e.x,e.y).voronoi(i);for(let e=0,t=r.length;e<t;++e){const t=a.cellPolygon(e);r[e][n]=t?xF(t):null}return t.reflow(e.modified()).modifies(n)}});var wF=Math.PI/180,kF=2048;function _F(e,t,n,r){if(!t.sprite){var i=e.context,a=e.ratio;i.clearRect(0,0,2048/a,kF/a);var s,o,u,l,c,d=0,h=0,f=0,p=n.length;for(--r;++r<p;){if(t=n[r],i.save(),i.font=t.style+" "+t.weight+" "+~~((t.size+1)/a)+"px "+t.font,s=i.measureText(t.text+"m").width*a,u=t.size<<1,t.rotate){var g=Math.sin(t.rotate*wF),m=Math.cos(t.rotate*wF),y=s*m,v=s*g,b=u*m,x=u*g;s=Math.max(Math.abs(y+x),Math.abs(y-x))+31>>5<<5,u=~~Math.max(Math.abs(v+b),Math.abs(v-b))}else s=s+31>>5<<5;if(u>f&&(f=u),d+s>=2048&&(d=0,h+=f,f=0),h+u>=kF)break;i.translate((d+(s>>1))/a,(h+(u>>1))/a),t.rotate&&i.rotate(t.rotate*wF),i.fillText(t.text,0,0),t.padding&&(i.lineWidth=2*t.padding,i.strokeText(t.text,0,0)),i.restore(),t.width=s,t.height=u,t.xoff=d,t.yoff=h,t.x1=s>>1,t.y1=u>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,d+=s}for(var w=i.getImageData(0,0,2048/a,kF/a).data,k=[];--r>=0;)if((t=n[r]).hasText){for(o=(s=t.width)>>5,u=t.y1-t.y0,l=0;l<u*o;l++)k[l]=0;if(null==(d=t.xoff))return;h=t.yoff;var _=0,S=-1;for(c=0;c<u;c++){for(l=0;l<s;l++){var C=o*c+(l>>5),A=w[2048*(h+c)+(d+l)<<2]?1<<31-l%32:0;k[C]|=A,_|=A}_?S=c:(t.y0++,u--,c--,h++)}t.y1=t.y0+S,t.sprite=k.slice(0,(t.y1-t.y0)*o)}}}function SF(e,t,n){n>>=5;for(var r,i=e.sprite,a=e.width>>5,s=e.x-(a<<4),o=127&s,u=32-o,l=e.y1-e.y0,c=(e.y+e.y0)*n+(s>>5),d=0;d<l;d++){r=0;for(var h=0;h<=a;h++)if((r<<u|(h<a?(r=i[d*a+h])>>>o:0))&t[c+h])return!0;c+=n}return!1}function CF(e,t){var n=e[0],r=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>r.x&&(r.x=t.x+t.x1),t.y+t.y1>r.y&&(r.y=t.y+t.y1)}function AF(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function EF(e){var t=e[0]/e[1];return function(e){return[t*(e*=.1)*Math.cos(e),e*Math.sin(e)]}}function FF(e){return"function"==typeof e?e:function(){return e}}var IF={archimedean:EF,rectangular:function(e){var t=4*e[0]/e[1],n=0,r=0;return function(e){var i=e<0?-1:1;switch(Math.sqrt(1+4*i*e)-i&3){case 0:n+=t;break;case 1:r+=4;break;case 2:n-=t;break;default:r-=4}return[n,r]}}};const DF=["x","y","font","fontSize","fontStyle","fontWeight","angle"],NF=["text","font","rotate","fontSize","fontStyle","fontWeight"];function $F(e){go.call(this,function(){var e,t,n,r,i,a,s,o=[256,256],u=EF,l=[],c=Math.random,d={};function h(e,t,n){for(var r,i,a,s=t.x,l=t.y,d=Math.sqrt(o[0]*o[0]+o[1]*o[1]),h=u(o),f=c()<.5?1:-1,p=-f;(r=h(p+=f))&&(i=~~r[0],a=~~r[1],!(Math.min(Math.abs(i),Math.abs(a))>=d));)if(t.x=s+i,t.y=l+a,!(t.x+t.x0<0||t.y+t.y0<0||t.x+t.x1>o[0]||t.y+t.y1>o[1])&&(!n||!SF(t,e,o[0]))&&(!n||AF(t,n))){for(var g,m=t.sprite,y=t.width>>5,v=o[0]>>5,b=t.x-(y<<4),x=127&b,w=32-x,k=t.y1-t.y0,_=(t.y+t.y0)*v+(b>>5),S=0;S<k;S++){g=0;for(var C=0;C<=y;C++)e[_+C]|=g<<w|(C<y?(g=m[S*y+C])>>>x:0);_+=v}return t.sprite=null,!0}return!1}return d.layout=function(){for(var u=function(e){e.width=e.height=1;var t=Math.sqrt(e.getContext("2d").getImageData(0,0,1,1).data.length>>2);e.width=2048/t,e.height=kF/t;var n=e.getContext("2d");return n.fillStyle=n.strokeStyle="red",n.textAlign="center",{context:n,ratio:t}}(od()),d=function(e){for(var t=[],n=-1;++n<e;)t[n]=0;return t}((o[0]>>5)*o[1]),f=null,p=l.length,g=-1,m=[],y=l.map((o=>({text:e(o),font:t(o),style:r(o),weight:i(o),rotate:a(o),size:~~(n(o)+1e-14),padding:s(o),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:o}))).sort(((e,t)=>t.size-e.size));++g<p;){var v=y[g];v.x=o[0]*(c()+.5)>>1,v.y=o[1]*(c()+.5)>>1,_F(u,v,y,g),v.hasText&&h(d,v,f)&&(m.push(v),f?CF(f,v):f=[{x:v.x+v.x0,y:v.y+v.y0},{x:v.x+v.x1,y:v.y+v.y1}],v.x-=o[0]>>1,v.y-=o[1]>>1)}return m},d.words=function(e){return arguments.length?(l=e,d):l},d.size=function(e){return arguments.length?(o=[+e[0],+e[1]],d):o},d.font=function(e){return arguments.length?(t=FF(e),d):t},d.fontStyle=function(e){return arguments.length?(r=FF(e),d):r},d.fontWeight=function(e){return arguments.length?(i=FF(e),d):i},d.rotate=function(e){return arguments.length?(a=FF(e),d):a},d.text=function(t){return arguments.length?(e=FF(t),d):e},d.spiral=function(e){return arguments.length?(u=IF[e]||e,d):u},d.fontSize=function(e){return arguments.length?(n=FF(e),d):n},d.padding=function(e){return arguments.length?(s=FF(e),d):s},d.random=function(e){return arguments.length?(c=e,d):c},d}(),e)}$F.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:DF}]},dt($F,go,{transform(e,t){!e.size||e.size[0]&&e.size[1]||se("Wordcloud size dimensions must be non-zero.");const n=e.modified();if(!(n||t.changed(t.ADD_REM)||NF.some((function(n){const r=e[n];return Ke(r)&&t.modified(r.fields)}))))return;const r=t.materialize(t.SOURCE).source,i=this.value,a=e.as||DF;let s,o=e.fontSize||14;if(Ke(o)?s=e.fontSizeRange:o=tt(o),s){const e=o,t=Op("sqrt")().domain(it(r,e)).range(s);o=n=>t(e(n))}r.forEach((e=>{e[a[0]]=NaN,e[a[1]]=NaN,e[a[3]]=0}));const u=i.words(r).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(o).random($o).layout(),l=i.size(),c=l[0]>>1,d=l[1]>>1,h=u.length;for(let e,t,n=0;n<h;++n)e=u[n],t=e.datum,t[a[0]]=e.x+c,t[a[1]]=e.y+d,t[a[2]]=e.font,t[a[3]]=e.size,t[a[4]]=e.style,t[a[5]]=e.weight,t[a[6]]=e.rotate;return t.reflow(n).modifies(a)}});const TF=e=>new Uint8Array(e),OF=e=>new Uint16Array(e),MF=e=>new Uint32Array(e);function RF(e,t,n){const r=(t<257?TF:t<65537?OF:MF)(e);return n&&r.set(n),r}function BF(e,t,n){const r=1<<t;return{one:r,zero:~r,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(e,t){const n=this,i=n.bisect(n.range,e.value),a=e.index,s=i[0],o=i[1],u=a.length;let l;for(l=0;l<s;++l)t[a[l]]|=r;for(l=o;l<u;++l)t[a[l]]|=r;return n}}}function zF(){let e=MF(0),t=[],n=0;return{insert:function(r,i,a){if(!i.length)return[];const s=n,o=i.length,u=MF(o);let l,c,d,h=Array(o);for(d=0;d<o;++d)h[d]=r(i[d]),u[d]=d;if(h=function(e,t){return e.sort.call(t,((t,n)=>{const r=e[t],i=e[n];return r<i?-1:r>i?1:0})),function(e,t){return Array.from(t,(t=>e[t]))}(e,t)}(h,u),s)l=t,c=e,t=Array(s+o),e=MF(s+o),function(e,t,n,r,i,a,s,o,u){let l,c=0,d=0;for(l=0;c<r&&d<s;++l)t[c]<i[d]?(o[l]=t[c],u[l]=n[c++]):(o[l]=i[d],u[l]=a[d++]+e);for(;c<r;++c,++l)o[l]=t[c],u[l]=n[c];for(;d<s;++d,++l)o[l]=i[d],u[l]=a[d]+e}(a,l,c,s,h,u,o,t,e);else{if(a>0)for(d=0;d<o;++d)u[d]+=a;t=h,e=u}return n=s+o,{index:u,value:h}},remove:function(r,i){const a=n;let s,o,u;for(o=0;!i[e[o]]&&o<a;++o);for(u=o;o<a;++o)i[s=e[o]]||(e[u]=s,t[u]=t[o],++u);n=a-r},bisect:function(e,r){let i;return r?i=r.length:(r=t,i=n),[dd(r,e[0],0,i),cd(r,e[1],0,i)]},reindex:function(t){for(let r=0,i=n;r<i;++r)e[r]=t[e[r]]},index:()=>e,size:()=>n}}function LF(e){go.call(this,function(){let e=8,t=[],n=MF(0),r=RF(0,e),i=RF(0,e);return{data:()=>t,seen:()=>n=function(e,t,n){return e.length>=t?e:((n=n||new e.constructor(t)).set(e),n)}(n,t.length),add(e){for(let n,r=0,i=t.length,a=e.length;r<a;++r)n=e[r],n._index=i++,t.push(n)},remove(e,n){const a=t.length,s=Array(a-e),o=t;let u,l,c;for(l=0;!n[l]&&l<a;++l)s[l]=t[l],o[l]=l;for(c=l;l<a;++l)u=t[l],n[l]?o[l]=-1:(o[l]=c,r[c]=r[l],i[c]=i[l],s[c]=u,u._index=c++),r[l]=0;return t=s,o},size:()=>t.length,curr:()=>r,prev:()=>i,reset:e=>i[e]=r[e],all:()=>e<257?255:e<65537?65535:4294967295,set(e,t){r[e]|=t},clear(e,t){r[e]&=~t},resize(t,n){(t>r.length||n>e)&&(e=Math.max(n,e),r=RF(t,e,r),i=RF(t,e))}}}(),e),this._indices=null,this._dims=null}function PF(e){go.call(this,null,e)}LF.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},dt(LF,go,{transform(e,t){return this._dims?e.modified("fields")||e.fields.some((e=>t.modified(e.fields)))?this.reinit(e,t):this.eval(e,t):this.init(e,t)},init(e,t){const n=e.fields,r=e.query,i=this._indices={},a=this._dims=[],s=r.length;let o,u,l=0;for(;l<s;++l)o=n[l].fname,u=i[o]||(i[o]=zF()),a.push(BF(u,l,r[l]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),r=e.fields,i=e.query,a=this._indices,s=this._dims,o=this.value,u=o.curr(),l=o.prev(),c=o.all(),d=n.rem=n.add,h=n.mod,f=i.length,p={};let g,m,y,v,b,x,w,k,_;if(l.set(u),t.rem.length&&(b=this.remove(e,t,n)),t.add.length&&o.add(t.add),t.mod.length)for(x={},v=t.mod,w=0,k=v.length;w<k;++w)x[v[w]._index]=1;for(w=0;w<f;++w)_=r[w],(!s[w]||e.modified("fields",w)||t.modified(_.fields))&&(y=_.fname,(g=p[y])||(a[y]=m=zF(),p[y]=g=m.insert(_,t.source,0)),s[w]=BF(m,w,i[w]).onAdd(g,u));for(w=0,k=o.data().length;w<k;++w)b[w]||(l[w]!==u[w]?d.push(w):x[w]&&u[w]!==c&&h.push(w));return o.mask=(1<<f)-1,n},eval(e,t){const n=t.materialize().fork(),r=this._dims.length;let i=0;return t.rem.length&&(this.remove(e,t,n),i|=(1<<r)-1),e.modified("query")&&!e.modified("fields")&&(i|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),i|=(1<<r)-1),t.mod.length&&(this.modify(t,n),i|=(1<<r)-1),this.value.mask=i,n},insert(e,t,n){const r=t.add,i=this.value,a=this._dims,s=this._indices,o=e.fields,u={},l=n.add,c=i.size()+r.length,d=a.length;let h,f,p,g=i.size();i.resize(c,d),i.add(r);const m=i.curr(),y=i.prev(),v=i.all();for(h=0;h<d;++h)f=o[h].fname,p=u[f]||(u[f]=s[f].insert(o[h],r,g)),a[h].onAdd(p,m);for(;g<c;++g)y[g]=v,m[g]!==v&&l.push(g)},modify(e,t){const n=t.mod,r=this.value,i=r.curr(),a=r.all(),s=e.mod;let o,u,l;for(o=0,u=s.length;o<u;++o)l=s[o]._index,i[l]!==a&&n.push(l)},remove(e,t,n){const r=this._indices,i=this.value,a=i.curr(),s=i.prev(),o=i.all(),u={},l=n.rem,c=t.rem;let d,h,f,p;for(d=0,h=c.length;d<h;++d)f=c[d]._index,u[f]=1,s[f]=p=a[f],a[f]=o,p!==o&&l.push(f);for(f in r)r[f].remove(h,u);return this.reindex(t,h,u),u},reindex(e,t,n){const r=this._indices,i=this.value;e.runAfter((()=>{const e=i.remove(t,n);for(const t in r)r[t].reindex(e)}))},update(e,t,n){const r=this._dims,i=e.query,a=t.stamp,s=r.length;let o,u,l=0;for(n.filters=0,u=0;u<s;++u)e.modified("query",u)&&(o=u,++l);if(1===l)l=r[o].one,this.incrementOne(r[o],i[o],n.add,n.rem);else for(u=0,l=0;u<s;++u)e.modified("query",u)&&(l|=r[u].one,this.incrementAll(r[u],i[u],a,n.add),n.rem=n.add);return l},incrementAll(e,t,n,r){const i=this.value,a=i.seen(),s=i.curr(),o=i.prev(),u=e.index(),l=e.bisect(e.range),c=e.bisect(t),d=c[0],h=c[1],f=l[0],p=l[1],g=e.one;let m,y,v;if(d<f)for(m=d,y=Math.min(f,h);m<y;++m)v=u[m],a[v]!==n&&(o[v]=s[v],a[v]=n,r.push(v)),s[v]^=g;else if(d>f)for(m=f,y=Math.min(d,p);m<y;++m)v=u[m],a[v]!==n&&(o[v]=s[v],a[v]=n,r.push(v)),s[v]^=g;if(h>p)for(m=Math.max(d,p),y=h;m<y;++m)v=u[m],a[v]!==n&&(o[v]=s[v],a[v]=n,r.push(v)),s[v]^=g;else if(h<p)for(m=Math.max(f,h),y=p;m<y;++m)v=u[m],a[v]!==n&&(o[v]=s[v],a[v]=n,r.push(v)),s[v]^=g;e.range=t.slice()},incrementOne(e,t,n,r){const i=this.value.curr(),a=e.index(),s=e.bisect(e.range),o=e.bisect(t),u=o[0],l=o[1],c=s[0],d=s[1],h=e.one;let f,p,g;if(u<c)for(f=u,p=Math.min(c,l);f<p;++f)g=a[f],i[g]^=h,n.push(g);else if(u>c)for(f=c,p=Math.min(u,d);f<p;++f)g=a[f],i[g]^=h,r.push(g);if(l>d)for(f=Math.max(u,d),p=l;f<p;++f)g=a[f],i[g]^=h,n.push(g);else if(l<d)for(f=Math.max(c,l),p=d;f<p;++f)g=a[f],i[g]^=h,r.push(g);e.range=t.slice()}}),PF.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},dt(PF,go,{transform(e,t){const n=~(e.ignore||0),r=e.filter,i=r.mask;if(0==(i&n))return t.StopPropagation;const a=t.fork(t.ALL),s=r.data(),o=r.curr(),u=r.prev(),l=e=>o[e]&n?null:s[e];return a.filter(a.MOD,l),i&i-1?(a.filter(a.ADD,(e=>{const t=o[e]&n;return!t&&t^u[e]&n?s[e]:null})),a.filter(a.REM,(e=>{const t=o[e]&n;return!t||t^t^u[e]&n?null:s[e]}))):(a.filter(a.ADD,l),a.filter(a.REM,(e=>(o[e]&n)===i?s[e]:null))),a.filter(a.SOURCE,(e=>l(e._index)))}});const jF="Literal",UF="CallExpression";function WF(e){this.type=e}var VF,GF,qF,HF,XF;WF.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(t=function(e){switch(e.type){case"ArrayExpression":return e.elements;case"BinaryExpression":case"LogicalExpression":return[e.left,e.right];case UF:return[e.callee].concat(e.arguments);case"ConditionalExpression":return[e.test,e.consequent,e.alternate];case"MemberExpression":return[e.object,e.property];case"ObjectExpression":return e.properties;case"Property":return[e.key,e.value];case"UnaryExpression":return[e.argument];default:return[]}}(this),n=0,r=t.length;n<r;++n)if(t[n].visit(e))return 1},(VF={})[1]="Boolean",VF[2]="<end>",VF[3]="Identifier",VF[4]="Keyword",VF[5]="Null",VF[6]="Numeric",VF[7]="Punctuator",VF[8]="String",VF[9]="RegularExpression";var KF="Identifier",YF="Unexpected token %0",QF="Invalid regular expression",JF="Invalid regular expression: missing /",ZF="Octal literals are not allowed in strict mode.",eI="ILLEGAL",tI="Disabled.",nI=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),rI=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function iI(e,t){if(!e)throw new Error("ASSERT: "+t)}function aI(e){return e>=48&&e<=57}function sI(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function oI(e){return"01234567".indexOf(e)>=0}function uI(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function lI(e){return 10===e||13===e||8232===e||8233===e}function cI(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&nI.test(String.fromCharCode(e))}function dI(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&rI.test(String.fromCharCode(e))}const hI={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function fI(){for(;qF<HF;){const e=GF.charCodeAt(qF);if(!uI(e)&&!lI(e))break;++qF}}function pI(e){var t,n,r,i=0;for(n="u"===e?4:2,t=0;t<n;++t)qF<HF&&sI(GF[qF])?(r=GF[qF++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):FI({},YF,eI);return String.fromCharCode(i)}function gI(){var e,t,n,r;for(t=0,"}"===(e=GF[qF])&&FI({},YF,eI);qF<HF&&sI(e=GF[qF++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&FI({},YF,eI),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function mI(){var e,t;for(e=GF.charCodeAt(qF++),t=String.fromCharCode(e),92===e&&(117!==GF.charCodeAt(qF)&&FI({},YF,eI),++qF,(e=pI("u"))&&"\\"!==e&&cI(e.charCodeAt(0))||FI({},YF,eI),t=e);qF<HF&&dI(e=GF.charCodeAt(qF));)++qF,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==GF.charCodeAt(qF)&&FI({},YF,eI),++qF,(e=pI("u"))&&"\\"!==e&&dI(e.charCodeAt(0))||FI({},YF,eI),t+=e);return t}function yI(){var e,t,n,r,i=qF,a=GF.charCodeAt(qF),s=GF[qF];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++qF,{type:7,value:String.fromCharCode(a),start:i,end:qF};default:if(61===(e=GF.charCodeAt(qF+1)))switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return qF+=2,{type:7,value:String.fromCharCode(a)+String.fromCharCode(e),start:i,end:qF};case 33:case 61:return qF+=2,61===GF.charCodeAt(qF)&&++qF,{type:7,value:GF.slice(i,qF),start:i,end:qF}}}return">>>="===(r=GF.substr(qF,4))?{type:7,value:r,start:i,end:qF+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:i,end:qF+=3}:s===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(s)>=0||"=>"===t?{type:7,value:t,start:i,end:qF+=2}:("//"===t&&FI({},YF,eI),"<>=!+-*%&|^/".indexOf(s)>=0?{type:7,value:s,start:i,end:++qF}:void FI({},YF,eI))}function vI(){var e,t,n;if(iI(aI((n=GF[qF]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=qF,e="","."!==n){if(e=GF[qF++],n=GF[qF],"0"===e){if("x"===n||"X"===n)return++qF,function(e){let t="";for(;qF<HF&&sI(GF[qF]);)t+=GF[qF++];return 0===t.length&&FI({},YF,eI),cI(GF.charCodeAt(qF))&&FI({},YF,eI),{type:6,value:parseInt("0x"+t,16),start:e,end:qF}}(t);if(oI(n))return function(e){let t="0"+GF[qF++];for(;qF<HF&&oI(GF[qF]);)t+=GF[qF++];return(cI(GF.charCodeAt(qF))||aI(GF.charCodeAt(qF)))&&FI({},YF,eI),{type:6,value:parseInt(t,8),octal:!0,start:e,end:qF}}(t);n&&aI(n.charCodeAt(0))&&FI({},YF,eI)}for(;aI(GF.charCodeAt(qF));)e+=GF[qF++];n=GF[qF]}if("."===n){for(e+=GF[qF++];aI(GF.charCodeAt(qF));)e+=GF[qF++];n=GF[qF]}if("e"===n||"E"===n)if(e+=GF[qF++],"+"!==(n=GF[qF])&&"-"!==n||(e+=GF[qF++]),aI(GF.charCodeAt(qF)))for(;aI(GF.charCodeAt(qF));)e+=GF[qF++];else FI({},YF,eI);return cI(GF.charCodeAt(qF))&&FI({},YF,eI),{type:6,value:parseFloat(e),start:t,end:qF}}function bI(){if(fI(),qF>=HF)return{type:2,start:qF,end:qF};const e=GF.charCodeAt(qF);return cI(e)?function(){var e,t;return e=qF,t=92===GF.charCodeAt(qF)?mI():function(){var e,t;for(e=qF++;qF<HF;){if(92===(t=GF.charCodeAt(qF)))return qF=e,mI();if(!dI(t))break;++qF}return GF.slice(e,qF)}(),{type:1===t.length?3:hI.hasOwnProperty(t)?4:"null"===t?5:"true"===t||"false"===t?1:3,value:t,start:e,end:qF}}():40===e||41===e||59===e?yI():39===e||34===e?function(){var e,t,n,r,i="",a=!1;for(iI("'"===(e=GF[qF])||'"'===e,"String literal must starts with a quote"),t=qF,++qF;qF<HF;){if((n=GF[qF++])===e){e="";break}if("\\"===n)if((n=GF[qF++])&&lI(n.charCodeAt(0)))"\r"===n&&"\n"===GF[qF]&&++qF;else switch(n){case"u":case"x":"{"===GF[qF]?(++qF,i+=gI()):i+=pI(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:oI(n)?(0!==(r="01234567".indexOf(n))&&(a=!0),qF<HF&&oI(GF[qF])&&(a=!0,r=8*r+"01234567".indexOf(GF[qF++]),"0123".indexOf(n)>=0&&qF<HF&&oI(GF[qF])&&(r=8*r+"01234567".indexOf(GF[qF++]))),i+=String.fromCharCode(r)):i+=n}else{if(lI(n.charCodeAt(0)))break;i+=n}}return""!==e&&FI({},YF,eI),{type:8,value:i,octal:a,start:t,end:qF}}():46===e?aI(GF.charCodeAt(qF+1))?vI():yI():aI(e)?vI():yI()}function xI(){const e=XF;return qF=e.end,XF=bI(),qF=e.end,e}function wI(){const e=qF;XF=bI(),qF=e}function kI(e,t,n){const r=new WF("||"===e||"&&"===e?"LogicalExpression":"BinaryExpression");return r.operator=e,r.left=t,r.right=n,r}function _I(e,t){const n=new WF("CallExpression");return n.callee=e,n.arguments=t,n}function SI(e){const t=new WF(KF);return t.name=e,t}function CI(e){const t=new WF("Literal");return t.value=e.value,t.raw=GF.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function AI(e,t,n){const r=new WF("MemberExpression");return r.computed="["===e,r.object=t,r.property=n,r.computed||(n.member=!0),r}function EI(e,t,n){const r=new WF("Property");return r.key=t,r.value=n,r.kind=e,r}function FI(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,((e,t)=>(iI(t<r.length,"Message reference must be in range"),r[t])));throw(n=new Error(i)).index=qF,n.description=i,n}function II(e){2===e.type&&FI(e,"Unexpected end of input"),6===e.type&&FI(e,"Unexpected number"),8===e.type&&FI(e,"Unexpected string"),3===e.type&&FI(e,"Unexpected identifier"),4===e.type&&FI(e,"Unexpected reserved word"),FI(e,YF,e.value)}function DI(e){const t=xI();7===t.type&&t.value===e||II(t)}function NI(e){return 7===XF.type&&XF.value===e}function $I(e){return 4===XF.type&&XF.value===e}function TI(){qF=XF.start;const e=xI();return 8===e.type||6===e.type?(e.octal&&FI(e,ZF),CI(e)):SI(e.value)}function OI(){var e,t,n;return qF=XF.start,3===(e=XF).type?(n=TI(),DI(":"),EI("init",n,UI())):2!==e.type&&7!==e.type?(t=TI(),DI(":"),EI("init",t,UI())):void II(e)}const MI={if:1};function RI(){var e,t,n;if(NI("("))return function(){DI("(");const e=WI();return DI(")"),e}();if(NI("["))return function(){const e=[];for(qF=XF.start,DI("[");!NI("]");)NI(",")?(xI(),e.push(null)):(e.push(UI()),NI("]")||DI(","));return xI(),function(e){const t=new WF("ArrayExpression");return t.elements=e,t}(e)}();if(NI("{"))return function(){var e,t,n=[],r={},i=String;for(qF=XF.start,DI("{");!NI("}");)t="$"+((e=OI()).key.type===KF?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?FI({},"Duplicate data property in object literal not allowed in strict mode"):r[t]=!0,n.push(e),NI("}")||DI(",");return DI("}"),function(e){const t=new WF("ObjectExpression");return t.properties=e,t}(n)}();if(e=XF.type,qF=XF.start,3===e||MI[XF.value])n=SI(xI().value);else if(8===e||6===e)XF.octal&&FI(XF,ZF),n=CI(xI());else{if(4===e)throw new Error(tI);1===e?((t=xI()).value="true"===t.value,n=CI(t)):5===e?((t=xI()).value=null,n=CI(t)):NI("/")||NI("/=")?(n=CI(function(){var e,t,n,r;return XF=null,fI(),e=qF,t=function(){var e,t,n,r;for(iI("/"===(e=GF[qF]),"Regular expression literal must start with a slash"),t=GF[qF++],n=!1,r=!1;qF<HF;)if(t+=e=GF[qF++],"\\"===e)lI((e=GF[qF++]).charCodeAt(0))&&FI({},JF),t+=e;else if(lI(e.charCodeAt(0)))FI({},JF);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||FI({},JF),{value:t.substr(1,t.length-2),literal:t}}(),n=function(){var e,t,n;for(t="",n="";qF<HF&&dI((e=GF[qF]).charCodeAt(0));)++qF,"\\"===e&&qF<HF?FI({},YF,eI):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&FI({},QF,n),{value:n,literal:t}}(),r=function(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,((e,t)=>{if(parseInt(t,16)<=1114111)return"x";FI({},QF)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(e){FI({},QF)}try{return new RegExp(e,t)}catch(e){return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:qF}}()),wI()):II(xI())}return n}function BI(){const e=[];if(DI("("),!NI(")"))for(;qF<HF&&(e.push(UI()),!NI(")"));)DI(",");return DI(")"),e}function zI(){DI("[");const e=WI();return DI("]"),e}function LI(){const e=function(){var e;for(e=RI();;)if(NI("."))e=AI(".",e,(DI("."),function(){qF=XF.start;const e=xI();return function(e){return 3===e.type||4===e.type||1===e.type||5===e.type}(e)||II(e),SI(e.value)}()));else if(NI("("))e=_I(e,BI());else{if(!NI("["))break;e=AI("[",e,zI())}return e}();if(7===XF.type&&(NI("++")||NI("--")))throw new Error(tI);return e}function PI(){var e,t;if(7!==XF.type&&4!==XF.type)t=LI();else{if(NI("++")||NI("--"))throw new Error(tI);if(NI("+")||NI("-")||NI("~")||NI("!"))e=xI(),t=PI(),t=function(e,t){const n=new WF("UnaryExpression");return n.operator=e,n.argument=t,n.prefix=!0,n}(e.value,t);else{if($I("delete")||$I("void")||$I("typeof"))throw new Error(tI);t=LI()}}return t}function jI(e){let t=0;if(7!==e.type&&4!==e.type)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function UI(){var e,t;return e=function(){var e,t,n,r,i,a,s,o,u,l;if(e=XF,u=PI(),0===(i=jI(r=XF)))return u;for(r.prec=i,xI(),t=[e,XF],a=[u,r,s=PI()];(i=jI(XF))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)s=a.pop(),o=a.pop().value,u=a.pop(),t.pop(),n=kI(o,u,s),a.push(n);(r=xI()).prec=i,a.push(r),t.push(XF),n=PI(),a.push(n)}for(n=a[l=a.length-1],t.pop();l>1;)t.pop(),n=kI(a[l-1].value,a[l-2],n),l-=2;return n}(),NI("?")&&(xI(),t=UI(),DI(":"),e=function(e,t,n){const r=new WF("ConditionalExpression");return r.test=e,r.consequent=t,r.alternate=n,r}(e,t,UI())),e}function WI(){const e=UI();if(NI(","))throw new Error(tI);return e}var VI={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function GI(e){function t(t,n,r){return i=>function(t,n,r,i){let a=e(n[0]);return r&&(a=r+"("+a+")",0===r.lastIndexOf("new ",0)&&(a="("+a+")")),a+"."+t+(i<0?"":0===i?"()":"("+n.slice(1).map(e).join(",")+")")}(t,i,n,r)}const n="new Date",r="String",i="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(t){t.length<3&&se("Missing arguments to clamp function."),t.length>3&&se("Too many arguments to clamp function.");const n=t.map(e);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase",r,0),lower:t("toLowerCase",r,0),substring:t("substring",r),split:t("split",r),trim:t("trim",r,0),regexp:i,test:t("test",i),if:function(t){t.length<3&&se("Missing arguments to if function."),t.length>3&&se("Too many arguments to if function.");const n=t.map(e);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}var qI,HI,XI,KI,YI,QI,JI,ZI,eD,tD,nD,rD,iD,aD,sD,oD,uD=new zw,lD=new zw,cD={point:uk,lineStart:uk,lineEnd:uk,polygonStart:function(){uD=new zw,cD.lineStart=dD,cD.lineEnd=hD},polygonEnd:function(){var e=+uD;lD.add(e<0?Vw+e:e),this.lineStart=this.lineEnd=this.point=uk},sphere:function(){lD.add(Vw)}};function dD(){cD.point=fD}function hD(){pD(qI,HI)}function fD(e,t){cD.point=pD,qI=e,HI=t,XI=e*=qw,KI=Yw(t=(t*=qw)/2+Ww),YI=nk(t)}function pD(e,t){var n=(e*=qw)-XI,r=n>=0?1:-1,i=r*n,a=Yw(t=(t*=qw)/2+Ww),s=nk(t),o=YI*s,u=KI*a+o*Yw(i),l=o*r*nk(i);uD.add(Kw(l,u)),XI=e,KI=a,YI=s}var gD,mD,yD,vD,bD,xD,wD,kD,_D,SD,CD,AD,ED,FD,ID,DD,ND={point:$D,lineStart:OD,lineEnd:MD,polygonStart:function(){ND.point=RD,ND.lineStart=BD,ND.lineEnd=zD,aD=new zw,cD.polygonStart()},polygonEnd:function(){cD.polygonEnd(),ND.point=$D,ND.lineStart=OD,ND.lineEnd=MD,uD<0?(QI=-(ZI=180),JI=-(eD=90)):aD>Lw?eD=90:aD<-1e-6&&(JI=-90),oD[0]=QI,oD[1]=ZI},sphere:function(){QI=-(ZI=180),JI=-(eD=90)}};function $D(e,t){sD.push(oD=[QI=e,ZI=e]),t<JI&&(JI=t),t>eD&&(eD=t)}function TD(e,t){var n=y_([e*qw,t*qw]);if(iD){var r=b_(iD,n),i=b_([r[1],-r[0],0],r);k_(i),i=m_(i);var a,s=e-tD,o=s>0?1:-1,u=i[0]*Gw*o,l=Hw(s)>180;l^(o*tD<u&&u<o*e)?(a=i[1]*Gw)>eD&&(eD=a):l^(o*tD<(u=(u+360)%360-180)&&u<o*e)?(a=-i[1]*Gw)<JI&&(JI=a):(t<JI&&(JI=t),t>eD&&(eD=t)),l?e<tD?LD(QI,e)>LD(QI,ZI)&&(ZI=e):LD(e,ZI)>LD(QI,ZI)&&(QI=e):ZI>=QI?(e<QI&&(QI=e),e>ZI&&(ZI=e)):e>tD?LD(QI,e)>LD(QI,ZI)&&(ZI=e):LD(e,ZI)>LD(QI,ZI)&&(QI=e)}else sD.push(oD=[QI=e,ZI=e]);t<JI&&(JI=t),t>eD&&(eD=t),iD=n,tD=e}function OD(){ND.point=TD}function MD(){oD[0]=QI,oD[1]=ZI,ND.point=$D,iD=null}function RD(e,t){if(iD){var n=e-tD;aD.add(Hw(n)>180?n+(n>0?360:-360):n)}else nD=e,rD=t;cD.point(e,t),TD(e,t)}function BD(){cD.lineStart()}function zD(){RD(nD,rD),cD.lineEnd(),Hw(aD)>Lw&&(QI=-(ZI=180)),oD[0]=QI,oD[1]=ZI,iD=null}function LD(e,t){return(t-=e)<0?t+360:t}function PD(e,t){return e[0]-t[0]}function jD(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var UD={sphere:uk,point:WD,lineStart:GD,lineEnd:XD,polygonStart:function(){UD.lineStart=KD,UD.lineEnd=YD},polygonEnd:function(){UD.lineStart=GD,UD.lineEnd=XD}};function WD(e,t){e*=qw;var n=Yw(t*=qw);VD(n*Yw(e),n*nk(e),nk(t))}function VD(e,t,n){++gD,yD+=(e-yD)/gD,vD+=(t-vD)/gD,bD+=(n-bD)/gD}function GD(){UD.point=qD}function qD(e,t){e*=qw;var n=Yw(t*=qw);FD=n*Yw(e),ID=n*nk(e),DD=nk(t),UD.point=HD,VD(FD,ID,DD)}function HD(e,t){e*=qw;var n=Yw(t*=qw),r=n*Yw(e),i=n*nk(e),a=nk(t),s=Kw(ik((s=ID*a-DD*i)*s+(s=DD*r-FD*a)*s+(s=FD*i-ID*r)*s),FD*r+ID*i+DD*a);mD+=s,xD+=s*(FD+(FD=r)),wD+=s*(ID+(ID=i)),kD+=s*(DD+(DD=a)),VD(FD,ID,DD)}function XD(){UD.point=WD}function KD(){UD.point=QD}function YD(){JD(AD,ED),UD.point=WD}function QD(e,t){AD=e,ED=t,e*=qw,t*=qw,UD.point=JD;var n=Yw(t);FD=n*Yw(e),ID=n*nk(e),DD=nk(t),VD(FD,ID,DD)}function JD(e,t){e*=qw;var n=Yw(t*=qw),r=n*Yw(e),i=n*nk(e),a=nk(t),s=ID*a-DD*i,o=DD*r-FD*a,u=FD*i-ID*r,l=Zw(s,o,u),c=ok(l),d=l&&-c/l;_D.add(d*s),SD.add(d*o),CD.add(d*u),mD+=c,xD+=c*(FD+(FD=r)),wD+=c*(ID+(ID=i)),kD+=c*(DD+(DD=a)),VD(FD,ID,DD)}function ZD(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}Map;class eN extends Set{constructor(e,t=tN){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),null!=e)for(const t of e)this.add(t)}has(e){return super.has(function({_intern:e,_key:t},n){const r=t(n);return e.has(r)?e.get(r):n}(this,e))}add(e){return super.add(function({_intern:e,_key:t},n){const r=t(n);return e.has(r)?e.get(r):(e.set(r,n),n)}(this,e))}delete(e){return super.delete(function({_intern:e,_key:t},n){const r=t(n);return e.has(r)&&(n=e.get(n),e.delete(r)),n}(this,e))}}function tN(e){return null!==e&&"object"==typeof e?e.valueOf():e}function nN(e){return e instanceof eN?e:new eN(e)}var rN;(rN={})[1]="Boolean",rN[2]="<end>",rN[3]="Identifier",rN[4]="Keyword",rN[5]="Null",rN[6]="Numeric",rN[7]="Punctuator",rN[8]="String",rN[9]="RegularExpression";const iN="intersect",aN="union",sN="_vgsid_",oN=ue(sN),uN="index:unit";function lN(e,t){for(var n,r,i=t.fields,a=t.values,s=i.length,o=0;o<s;++o)if((r=i[o]).getter=ue.getter||ue(r.field),pt(n=r.getter(e))&&(n=Ie(n)),pt(a[o])&&(a[o]=Ie(a[o])),pt(a[o][0])&&(a[o]=a[o].map(Ie)),"E"===r.type){if(ke(a[o])?a[o].indexOf(n)<0:n!==a[o])return!1}else if("R"===r.type){if(!ht(n,a[o]))return!1}else if("R-RE"===r.type){if(!ht(n,a[o],!0,!1))return!1}else if("R-E"===r.type){if(!ht(n,a[o],!1,!1))return!1}else if("R-LE"===r.type&&!ht(n,a[o],!1,!0))return!1;return!0}const cN=function(e){let t=e,n=e,r=e;function i(e,t,i=0,a=e.length){if(i<a){if(0!==n(t,t))return a;do{const n=i+a>>>1;r(e[n],t)<0?i=n+1:a=n}while(i<a)}return i}return 2!==e.length&&(t=(t,n)=>e(t)-n,n=ZD,r=(t,n)=>ZD(e(t),n)),{left:i,center:function(e,n,r=0,a=e.length){const s=i(e,n,r,a-1);return s>r&&t(e[s-1],n)>-t(e[s],n)?s-1:s},right:function(e,t,i=0,a=e.length){if(i<a){if(0!==n(t,t))return a;do{const n=i+a>>>1;r(e[n],t)<=0?i=n+1:a=n}while(i<a)}return i}}}(oN),dN=cN.left,hN=cN.right;var fN={["".concat(sN,"_union")]:function(...e){const t=new eN;for(const n of e)for(const e of n)t.add(e);return t},["".concat(sN,"_intersect")]:function(e,...t){e=new eN(e),t=t.map(nN);e:for(const n of e)for(const r of t)if(!r.has(n)){e.delete(n);continue e}return e},E_union:function(e,t){if(!e.length)return t;for(var n=0,r=t.length;n<r;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter((e=>t.indexOf(e)>=0)):t},R_union:function(e,t){var n=Ie(t[0]),r=Ie(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<r&&(e[1]=r),e):[n,r]},R_intersect:function(e,t){var n=Ie(t[0]),r=Ie(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?r<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>r&&(e[1]=r),e):[n,r]}};function pN(e,t,n,r){"Literal"!==t[0].type&&se("First argument to selection functions must be a string literal.");const i=t[0].value,a=":"+i;(t.length>=2&&Fe(t).value)!==iN||ot(r,"@unit")||(r["@unit"]=n.getData(i).indataRef(n,"unit")),ot(r,a)||(r[a]=n.getData(i).tuplesRef())}function gN(e){const t=this.context.data[e];return t?t.values.value:[]}const mN=e=>function(t,n){return this.context.dataflow.locale()[e](n)(t)},yN=mN("format"),vN=mN("timeFormat"),bN=mN("utcFormat"),xN=mN("timeParse"),wN=mN("utcParse"),kN=new Date(2e3,0,1);function _N(e,t,n){return Number.isInteger(e)&&Number.isInteger(t)?(kN.setYear(2e3),kN.setMonth(e),kN.setDate(t),vN.call(this,kN,n)):""}function SN(e,t,n,r){t[0].type!==jF&&se("First argument to data functions must be a string literal.");const i=t[0].value,a=":"+i;if(!ot(a,r))try{r[a]=n.getData(i).tuplesRef()}catch(e){}}function CN(e,t,n,r){if(t[0].type===jF)AN(n,r,t[0].value);else for(e in n.scales)AN(n,r,e)}function AN(e,t,n){const r="%"+n;if(!ot(t,r))try{t[r]=e.scaleRef(n)}catch(e){}}function EN(e,t){let n;return Ke(e)?e:vt(e)?(n=t.scales[e])&&n.value:void 0}function FN(e,t){return function(n,r,i){if(n){const t=EN(n,(i||this).context);return t&&t.path[e](r)}return t(r)}}const IN=FN("area",(function(e){return lD=new zw,Bw(e,cD),2*lD})),DN=FN("bounds",(function(e){var t,n,r,i,a,s,o;if(eD=ZI=-(QI=JI=1/0),sD=[],Bw(e,ND),n=sD.length){for(sD.sort(PD),t=1,a=[r=sD[0]];t<n;++t)jD(r,(i=sD[t])[0])||jD(r,i[1])?(LD(r[0],i[1])>LD(r[0],r[1])&&(r[1]=i[1]),LD(i[0],r[1])>LD(r[0],r[1])&&(r[0]=i[0])):a.push(r=i);for(s=-1/0,t=0,r=a[n=a.length-1];t<=n;r=i,++t)i=a[t],(o=LD(r[1],i[0]))>s&&(s=o,QI=i[0],ZI=r[1])}return sD=oD=null,QI===1/0||JI===1/0?[[NaN,NaN],[NaN,NaN]]:[[QI,JI],[ZI,eD]]})),NN=FN("centroid",(function(e){gD=mD=yD=vD=bD=xD=wD=kD=0,_D=new zw,SD=new zw,CD=new zw,Bw(e,UD);var t=+_D,n=+SD,r=+CD,i=Zw(t,n,r);return i<Pw&&(t=xD,n=wD,r=kD,mD<Lw&&(t=yD,n=vD,r=bD),(i=Zw(t,n,r))<Pw)?[NaN,NaN]:[Kw(n,t)*Gw,ok(r/i)*Gw]}));function $N(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(t){e.warn(t)}return n[n.length-1]}function TN(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ON(e){const t=jd(e);return.2126*TN(t.r)+.7152*TN(t.g)+.0722*TN(t.b)}function MN(e,t){return e===t||e!=e&&t!=t||(ke(e)?!(!ke(t)||e.length!==t.length)&&function(e,t){for(let n=0,r=e.length;n<r;++n)if(!MN(e[n],t[n]))return!1;return!0}(e,t):!(!_e(e)||!_e(t))&&RN(e,t))}function RN(e,t){for(const n in e)if(!MN(e[n],t[n]))return!1;return!0}function BN(e){return t=>RN(e,t)}const zN={};function LN(e){return ke(e)||ArrayBuffer.isView(e)?e:null}function PN(e){return LN(e)||(vt(e)?e:null)}const jN=e=>e.data;function UN(e,t){const n=gN.call(t,e);return n.root&&n.root.lookup||{}}const WN=()=>"undefined"!=typeof window&&window||null,VN={random:()=>$o(),cumulativeNormal:Wo,cumulativeLogNormal:Ko,cumulativeUniform:tu,densityNormal:Uo,densityLogNormal:Xo,densityUniform:eu,quantileNormal:Vo,quantileLogNormal:Yo,quantileUniform:nu,sampleNormal:jo,sampleLogNormal:Ho,sampleUniform:Zo,isArray:ke,isBoolean:ft,isDate:pt,isDefined:e=>void 0!==e,isNumber:mt,isObject:_e,isRegExp:yt,isString:vt,isTuple:Ms,isValid:e=>null!=e&&e==e,toBoolean:Et,toDate:It,toNumber:Ie,toString:Dt,indexof:function(e,...t){return PN(e).indexOf(...t)},join:function(e,...t){return LN(e).join(...t)},lastindexof:function(e,...t){return PN(e).lastIndexOf(...t)},replace:function(e,t,n){return Ke(n)&&se("Function argument passed to replace."),String(e).replace(t,n)},reverse:function(e){return LN(e).slice().reverse()},slice:function(e,...t){return PN(e).slice(...t)},flush:ct,lerp:xt,merge:function(){const e=[].slice.call(arguments);return e.unshift({}),rt(...e)},pad:St,peek:Fe,pluck:function(e,t){const n=zN[t]||(zN[t]=ue(t));return ke(e)?e.map(n):n(e)},span:Ct,inrange:ht,truncate:$t,rgb:jd,lab:Df,hcl:Bf,hsl:Xd,luminance:ON,contrast:function(e,t){const n=ON(e),r=ON(t);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)},sequence:wu,format:yN,utcFormat:bN,utcParse:wN,utcOffset:ri,utcSequence:si,timeFormat:vN,timeParse:xN,timeOffset:ni,timeSequence:ai,timeUnitSpecifier:Fr,monthFormat:function(e){return _N.call(this,e,1,"%B")},monthAbbrevFormat:function(e){return _N.call(this,e,1,"%b")},dayFormat:function(e){return _N.call(this,0,2+e,"%A")},dayAbbrevFormat:function(e){return _N.call(this,0,2+e,"%a")},quarter:Ge,utcquarter:qe,week:$r,utcweek:zr,dayofyear:Nr,utcdayofyear:Br,warn:function(){return $N(this.context.dataflow,"warn",arguments)},info:function(){return $N(this.context.dataflow,"info",arguments)},debug:function(){return $N(this.context.dataflow,"debug",arguments)},extent:it,inScope:function(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n},intersect:function(e,t,n){if(!e)return[];const[r,i]=e,a=(new mm).set(r[0],r[1],i[0],i[1]);return Ub(n||this.context.dataflow.scenegraph().root,a,function(e){let t=null;if(e){const n=He(e.marktype),r=He(e.markname);t=e=>(!n.length||n.some((t=>e.marktype===t)))&&(!r.length||r.some((t=>e.name===t)))}return t}(t))},clampRange:Xe,pinchDistance:function(e){const t=e.touches,n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)},pinchAngle:function(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)},screen:function(){const e=WN();return e?e.screen:{}},containerSize:function(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]},windowSize:function(){const e=WN();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]},bandspace:function(e,t,n){return ap(e||0,t||0,n||0)},setdata:function(e,t){const n=this.context.dataflow,r=this.context.data[e].input;return n.pulse(r,n.changeset().remove(fe).insert(t)),1},pathShape:function(e){let t=null;return function(n){return n?Lg(n,t=t||Fg(e)):e}},panLinear:Re,panLog:Be,panPow:ze,panSymlog:Le,zoomLinear:je,zoomLog:Ue,zoomPow:We,zoomSymlog:Ve,encode:function(e,t,n){if(e){const n=this.context.dataflow,r=e.mark.source;n.pulse(r,n.changeset().encode(e,t))}return void 0!==n?n:e},modify:function(e,t,n,r,i,a){const s=this.context.dataflow,o=this.context.data[e],u=o.input,l=s.stamp();let c,d,h=o.changes;if(!1===s._trigger||!(u.value.length||t||r))return 0;if((!h||h.stamp<l)&&(o.changes=h=s.changeset(),h.stamp=l,s.runAfter((()=>{o.modified=!0,s.pulse(u,h).run()}),!0,1)),n&&(c=!0===n?fe:ke(n)||Ms(n)?n:BN(n),h.remove(c)),t&&h.insert(t),r&&(c=BN(r),u.value.some(c)?h.remove(c):h.insert(r)),i)for(d in a)h.modify(i,d,a[d]);return 1}},GN=["view","item","group","xy","x","y"],qN="this.",HN={},XN={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>`_[${At("$"+e)}]`,functions:function(e){const t=GI(e);GN.forEach((e=>t[e]="event.vega."+e));for(const e in VN)t[e]=qN+e;return rt(t,function(e,t,n){t.__bandwidth=e=>e&&e.bandwidth?e.bandwidth():0,n._bandwidth=CN,n._range=CN,n._scale=CN;const r=t=>"_["+(t.type===jF?At("%"+t.value):At("%")+"+"+e(t))+"]";return{_bandwidth:e=>`this.__bandwidth(${r(e[0])})`,_range:e=>`${r(e[0])}.range()`,_scale:t=>`${r(t[0])}(${e(t[1])})`}}(e,VN,HN)),t},constants:VI,visitors:HN},KN=function(e){const t=(e=e||{}).allowed?Nt(e.allowed):{},n=e.forbidden?Nt(e.forbidden):{},r=e.constants||VI,i=(e.functions||GI)(d),a=e.globalvar,s=e.fieldvar,o=Ke(a)?a:e=>`${a}["${e}"]`;let u={},l={},c=0;function d(e){if(vt(e))return e;const t=h[e.type];return null==t&&se("Unsupported type: "+e.type),t(e)}const h={Literal:e=>e.raw,Identifier:e=>{const i=e.name;return c>0?i:ot(n,i)?se("Illegal identifier: "+i):ot(r,i)?r[i]:ot(t,i)?i:(u[i]=1,o(i))},MemberExpression:e=>{const t=!e.computed,n=d(e.object);t&&(c+=1);const r=d(e.property);return n===s&&(l[function(e){const t=e&&e.length-1;return t&&('"'===e[0]&&'"'===e[t]||"'"===e[0]&&"'"===e[t])?e.slice(1,-1):e}(r)]=1),t&&(c-=1),n+(t?"."+r:"["+r+"]")},CallExpression:e=>{"Identifier"!==e.callee.type&&se("Illegal callee type: "+e.callee.type);const t=e.callee.name,n=e.arguments,r=ot(i,t)&&i[t];return r||se("Unrecognized function: "+t),Ke(r)?r(n):r+"("+n.map(d).join(",")+")"},ArrayExpression:e=>"["+e.elements.map(d).join(",")+"]",BinaryExpression:e=>"("+d(e.left)+" "+e.operator+" "+d(e.right)+")",UnaryExpression:e=>"("+e.operator+d(e.argument)+")",ConditionalExpression:e=>"("+d(e.test)+"?"+d(e.consequent)+":"+d(e.alternate)+")",LogicalExpression:e=>"("+d(e.left)+e.operator+d(e.right)+")",ObjectExpression:e=>"{"+e.properties.map(d).join(",")+"}",Property:e=>{c+=1;const t=d(e.key);return c-=1,t+":"+d(e.value)}};function f(e){const t={code:d(e),globals:Object.keys(u),fields:Object.keys(l)};return u={},l={},t}return f.functions=i,f.constants=r,f}(XN);function YN(e,t,n){return 1===arguments.length?VN[e]:(VN[e]=t,n&&(HN[e]=n),KN&&(KN.functions[e]=qN+e),this)}function QN(e,t){const n={};let r;try{r=function(e){qF=0,HF=(GF=e).length,XF=null,wI();const t=WI();if(2!==XF.type)throw new Error("Unexpect token after expression.");return t}(e=vt(e)?e:At(e)+"")}catch(t){se("Expression parse error: "+e)}r.visit((e=>{if(e.type!==UF)return;const r=e.callee.name,i=XN.visitors[r];i&&i(r,e.arguments,t,n)}));const i=KN(r);return i.globals.forEach((e=>{const r="$"+e;!ot(n,r)&&t.getSignal(e)&&(n[r]=t.signalRef(e))})),{$expr:rt({code:i.code},t.options.ast?{ast:r}:null),$fields:i.fields,$params:n}}YN("bandwidth",(function(e,t){const n=EN(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}),CN),YN("copy",(function(e,t){const n=EN(e,(t||this).context);return n?n.copy():void 0}),CN),YN("domain",(function(e,t){const n=EN(e,(t||this).context);return n?n.domain():[]}),CN),YN("range",(function(e,t){const n=EN(e,(t||this).context);return n&&n.range?n.range():[]}),CN),YN("invert",(function(e,t,n){const r=EN(e,(n||this).context);return r?ke(t)?(r.invertRange||r.invert)(t):(r.invert||r.invertExtent)(t):void 0}),CN),YN("scale",(function(e,t,n){const r=EN(e,(n||this).context);return r?r(t):void 0}),CN),YN("gradient",(function(e,t,n,r,i){e=EN(e,(i||this).context);const a=_g(t,n);let s=e.domain(),o=s[0],u=Fe(s),l=ce;return u-o?l=Hp(e,o,u):e=(e.interpolator?Op("sequential")().interpolator(e.interpolator()):Op("linear")().interpolate(e.interpolate()).range(e.range())).domain([o=0,u=1]),e.ticks&&(s=e.ticks(+r||15),o!==s[0]&&s.unshift(o),u!==Fe(s)&&s.push(u)),s.forEach((t=>a.stop(l(t),e(t)))),a}),CN),YN("geoArea",IN,CN),YN("geoBounds",DN,CN),YN("geoCentroid",NN,CN),YN("geoShape",(function(e,t,n){const r=EN(e,(n||this).context);return function(e){return r?r.path.context(e)(t):""}}),CN),YN("indata",(function(e,t,n){const r=this.context.data[e]["index:"+t],i=r?r.value.get(n):void 0;return i?i.count:i}),(function(e,t,n,r){t[0].type!==jF&&se("First argument to indata must be a string literal."),t[1].type!==jF&&se("Second argument to indata must be a string literal.");const i=t[0].value,a=t[1].value,s="@"+a;ot(s,r)||(r[s]=n.getData(i).indataRef(n,a))})),YN("data",gN,SN),YN("treePath",(function(e,t,n){const r=UN(e,this),i=r[t],a=r[n];return i&&a?i.path(a).map(jN):void 0}),SN),YN("treeAncestors",(function(e,t){const n=UN(e,this)[t];return n?n.ancestors().map(jN):void 0}),SN),YN("vlSelectionTest",(function(e,t,n){for(var r,i,a,s,o,u=this.context.data[e],l=u?u.values.value:[],c=u?u[uN]&&u[uN].value:void 0,d=n===iN,h=l.length,f=0;f<h;++f)if(r=l[f],c&&d){if(-1===(a=(i=i||{})[s=r.unit]||0))continue;if(o=lN(t,r),i[s]=o?-1:++a,o&&1===c.size)return!0;if(!o&&a===c.get(s).count)return!1}else if(d^(o=lN(t,r)))return o;return h&&d}),pN),YN("vlSelectionIdTest",(function(e,t,n){const r=this.context.data[e],i=r?r.values.value:[],a=r?r[uN]&&r[uN].value:void 0,s=n===iN,o=oN(t),u=dN(i,o);if(u===i.length)return!1;if(oN(i[u])!==o)return!1;if(a&&s){if(1===a.size)return!0;if(hN(i,o)-u<a.size)return!1}return!0}),pN),YN("vlSelectionResolve",(function(e,t,n,r){for(var i,a,s,o,u,l,c,d,h,f,p,g,m=this.context.data[e],y=m?m.values.value:[],v={},b={},x={},w=y.length,k=0;k<w;++k)if(o=(i=y[k]).unit,a=i.fields,s=i.values,a&&s){for(p=0,g=a.length;p<g;++p)u=a[p],d=(c=v[u.field]||(v[u.field]={}))[o]||(c[o]=[]),x[u.field]=h=u.type.charAt(0),f=fN["".concat(h,"_union")],c[o]=f(d,He(s[p]));n&&(d=b[o]||(b[o]=[])).push(He(s).reduce(((e,t,n)=>(e[a[n].field]=t,e)),{}))}else u=sN,l=oN(i),(d=(c=v[u]||(v[u]={}))[o]||(c[o]=[])).push(l),n&&(d=b[o]||(b[o]=[])).push({[sN]:l});return t=t||aN,v._vgsid_?v._vgsid_=fN["".concat(sN,"_").concat(t)](...Object.values(v._vgsid_)):Object.keys(v).forEach((e=>{v[e]=Object.keys(v[e]).map((t=>v[e][t])).reduce(((n,r)=>void 0===n?r:fN["".concat(x[e],"_").concat(t)](n,r)))})),y=Object.keys(b),n&&y.length&&(v[r?"vlPoint":"vlMulti"]=t===aN?{or:y.reduce(((e,t)=>(e.push(...b[t]),e)),[])}:{and:y.map((e=>({or:b[e]})))}),v}),pN),YN("vlSelectionTuples",(function(e,t){return e.map((e=>rt(t.fields?{values:t.fields.map((t=>(t.getter||(t.getter=ue(t.field)))(e.datum)))}:{[sN]:oN(e.datum)},t)))}));const JN=Nt(["rule"]),ZN=Nt(["group","image","rect"]);function e$(e){return(e+"").toLowerCase()}function t$(e,t,n){";"!==n[n.length-1]&&(n="return("+n+");");const r=Function(...t.concat(n));return e&&e.functions?r.bind(e.functions):r}var n$={operator:(e,t)=>t$(e,["_"],t.code),parameter:(e,t)=>t$(e,["datum","_"],t.code),event:(e,t)=>t$(e,["event"],t.code),handler:(e,t)=>t$(e,["_","event"],"var datum=event.item&&event.item.datum;return ".concat(t.code,";")),encode:(e,t)=>{const{marktype:n,channels:r}=t;let i="var o=item,datum=o.datum,m=0,$;";for(const e in r){const t="o["+At(e)+"]";i+="$=".concat(r[e].code,";if(").concat(t,"!==$)").concat(t,"=$,m=1;")}return i+=function(e,t){let n="";return JN[t]||(e.x2&&(e.x?(ZN[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(ZN[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}(r,n),i+="return m;",t$(e,["item","_"],i)},codegen:{get(e){const t="[".concat(e.map(At).join("]["),"]"),n=Function("_","return _".concat(t,";"));return n.path=t,n},comparator(e,t){let n;const r=Function("a","b","var u, v; return "+e.map(((e,r)=>{const i=t[r];let a,s;return e.path?(a="a".concat(e.path),s="b".concat(e.path)):((n=n||{})["f"+r]=e,a="this.f".concat(r,"(a)"),s="this.f".concat(r,"(b)")),function(e,t,n,r){return"((u = ".concat(e,") < (v = ").concat(t,") || u == null) && v != null ? ").concat(n,"\n  : (u > v || v == null) && u != null ? ").concat(r,"\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ").concat(n,"\n  : v !== v && u === u ? ").concat(r," : ")}(a,s,-i,i)})).join("")+"0;");return n?r.bind(n):r}}};function r$(e,t,n){if(!e||!_e(e))return e;for(let r,i=0,a=i$.length;i<a;++i)if(r=i$[i],ot(e,r.key))return r.parse(e,t,n);return e}var i$=[{key:"$ref",parse:function(e,t){return t.get(e.$ref)||se("Operator not defined: "+e.$ref)}},{key:"$key",parse:function(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=bt(e.$key,e.$flat,t.expr.codegen))}},{key:"$expr",parse:function(e,t,n){e.$params&&t.parseParameters(e.$params,n);const r="e:"+e.$expr.code+"_"+e.$name;return t.fn[r]||(t.fn[r]=ee(t.parameterExpression(e.$expr),e.$fields,e.$name))}},{key:"$field",parse:function(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=ue(e.$field,e.$name,t.expr.codegen))}},{key:"$encode",parse:function(e,t){const n=e.$encode,r={};for(const e in n){const i=n[e];r[e]=ee(t.encodeExpression(i.$expr),i.$fields),r[e].output=i.$output}return r}},{key:"$compare",parse:function(e,t){const n="c:"+e.$compare+"_"+e.$order,r=He(e.$compare).map((e=>e&&e.$tupleid?Rs:e));return t.fn[n]||(t.fn[n]=Ye(r,e.$order,t.expr.codegen))}},{key:"$context",parse:function(e,t){return t}},{key:"$subflow",parse:function(e,t){const n=e.$subflow;return function(e,r,i){const a=t.fork().parse(n),s=a.get(n.operators[0].id),o=a.signals.parent;return o&&o.set(i),s.detachSubflow=()=>t.detach(a),s}}},{key:"$tupleid",parse:function(){return Rs}}];const a$={skip:!0};function s$(e,t,n,r){return new o$(e,t,n,r)}function o$(e,t,n,r){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=r||n$,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function u$(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}function l$(e,t){e&&(null==t?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}o$.prototype=u$.prototype={fork(){const e=new u$(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter((t=>t!==e));const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,r=n.dataflow,i=e.value;if(n.set(e.id,t),"collect"===e$(e.type)&&i&&(i.$ingest?r.ingest(t,i.$ingest,i.$format):i.$request?r.preload(t,i.$request,i.$format):r.pulse(t,r.changeset().insert(i))),e.root&&(n.root=t),e.parent){let i=n.get(e.parent.$ref);i?(r.connect(i,[t]),t.targets().add(i)):(n.unresolved=n.unresolved||[]).push((()=>{i=n.get(e.parent.$ref),r.connect(i,[t]),t.targets().add(i)}))}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const r in e.data){const i=n.data[r]||(n.data[r]={});e.data[r].forEach((e=>i[e]=t))}},resolve(){return(this.unresolved||[]).forEach((e=>e())),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[e$(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,r,i){this.dataflow.on(t,n,r,i,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:function(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach((e=>t.parseOperator(e))),n.forEach((e=>t.parseOperatorParameters(e))),(e.streams||[]).forEach((e=>t.parseStream(e))),(e.updates||[]).forEach((e=>t.parseUpdate(e))),t.resolve()},parseOperator:function(e){const t=this;"operator"!==e$(e.type)&&e.type?t.transform(e,e.type):t.operator(e,e.update?t.operatorExpression(e.update):null)},parseOperatorParameters:function(e){const t=this;if(e.params){const n=t.get(e.id);n||se("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}},parseParameters:function(e,t){t=t||{};const n=this;for(const r in e){const i=e[r];t[r]=ke(i)?i.map((e=>r$(e,n,t))):r$(i,n,t)}return t},parseStream:function(e){var t,n=this,r=null!=e.filter?n.eventExpression(e.filter):void 0,i=null!=e.stream?n.get(e.stream):void 0;e.source?i=n.events(e.source,e.type,r):e.merge&&(i=(t=e.merge.map((e=>n.get(e))))[0].merge.apply(t[0],t.slice(1))),e.between&&(t=e.between.map((e=>n.get(e))),i=i.between(t[0],t[1])),e.filter&&(i=i.filter(r)),null!=e.throttle&&(i=i.throttle(+e.throttle)),null!=e.debounce&&(i=i.debounce(+e.debounce)),null==i&&se("Invalid stream definition: "+JSON.stringify(e)),e.consume&&i.consume(!0),n.stream(e,i)},parseUpdate:function(e){var t,n=this,r=_e(r=e.source)?r.$ref:r,i=n.get(r),a=e.update,s=void 0;i||se("Source not defined: "+e.source),t=e.target&&e.target.$expr?n.eventExpression(e.target.$expr):n.get(e.target),a&&a.$expr&&(a.$params&&(s=n.parseParameters(a.$params)),a=n.handlerExpression(a.$expr)),n.update(e,i,t,a,s)},getState:function(e){var t=this,n={};if(e.signals){var r=n.signals={};Object.keys(t.signals).forEach((n=>{const i=t.signals[n];e.signals(n,i)&&(r[n]=i.value)}))}if(e.data){var i=n.data={};Object.keys(t.data).forEach((n=>{const r=t.data[n];e.data(n,r)&&(i[n]=r.input.value)}))}return t.subcontext&&!1!==e.recurse&&(n.subcontext=t.subcontext.map((t=>t.getState(e)))),n},setState:function(e){var t=this,n=t.dataflow,r=e.data,i=e.signals;Object.keys(i||{}).forEach((e=>{n.update(t.signals[e],i[e],a$)})),Object.keys(r||{}).forEach((e=>{n.pulse(t.data[e].input,n.changeset().remove(fe).insert(r[e]))})),(e.subcontext||[]).forEach(((e,n)=>{const r=t.subcontext[n];r&&r.setState(e)}))}};const c$="default";function d$(e,t){const n=e.globalCursor()?"undefined"!=typeof document&&document.body:e.container();if(n)return null==t?n.style.removeProperty("cursor"):n.style.cursor=t}function h$(e,t){var n=e._runtime.data;return ot(n,t)||se("Unrecognized data set: "+t),n[t]}function f$(e,t){Ws(t)||se("Second argument to changes must be a changeset.");const n=h$(this,e);return n.modified=!0,this.pulse(n.input,t)}function p$(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function g$(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function m$(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}const y$="view",v$={trap:!1};function b$(e,t,n,r){e._eventListeners.push({type:n,sources:He(t),handler:r})}function x$(e,t,n){const r=e._eventConfig&&e._eventConfig[t];return!(!1===r||_e(r)&&!r[n])||(e.warn(`Blocked ${t} ${n} event listener.`),!1)}function w$(e){return e.item}function k$(e){return e.item.mark.source}function _$(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function S$(e,t,n){const r=document.createElement(e);for(const e in t)r.setAttribute(e,t[e]);return null!=n&&(r.textContent=n),r}function C$(e,t,n,r){const i=n.event||"input",a=()=>e.update(t.value);r.signal(n.signal,t.value),t.addEventListener(i,a),b$(r,t,i,a),e.set=e=>{t.value=e,t.dispatchEvent(function(e){return"undefined"!=typeof Event?new Event(e):{type:e}}(i))}}function A$(e,t,n,r){const i=r.signal(n.signal),a=S$("div",{class:"vega-bind"}),s="radio"===n.input?a:a.appendChild(S$("label"));s.appendChild(S$("span",{class:"vega-bind-name"},n.name||n.signal)),t.appendChild(a);let o=E$;switch(n.input){case"checkbox":o=F$;break;case"select":o=I$;break;case"radio":o=D$;break;case"range":o=N$}o(e,s,n,i)}function E$(e,t,n,r){const i=S$("input");for(const e in n)"signal"!==e&&"element"!==e&&i.setAttribute("input"===e?"type":e,n[e]);i.setAttribute("name",n.signal),i.value=r,t.appendChild(i),i.addEventListener("input",(()=>e.update(i.value))),e.elements=[i],e.set=e=>i.value=e}function F$(e,t,n,r){const i={type:"checkbox",name:n.signal};r&&(i.checked=!0);const a=S$("input",i);t.appendChild(a),a.addEventListener("change",(()=>e.update(a.checked))),e.elements=[a],e.set=e=>a.checked=!!e||null}function I$(e,t,n,r){const i=S$("select",{name:n.signal}),a=n.labels||[];n.options.forEach(((e,t)=>{const n={value:e};$$(e,r)&&(n.selected=!0),i.appendChild(S$("option",n,(a[t]||e)+""))})),t.appendChild(i),i.addEventListener("change",(()=>{e.update(n.options[i.selectedIndex])})),e.elements=[i],e.set=e=>{for(let t=0,r=n.options.length;t<r;++t)if($$(n.options[t],e))return void(i.selectedIndex=t)}}function D$(e,t,n,r){const i=S$("span",{class:"vega-bind-radio"}),a=n.labels||[];t.appendChild(i),e.elements=n.options.map(((t,s)=>{const o={type:"radio",name:n.signal,value:t};$$(t,r)&&(o.checked=!0);const u=S$("input",o);u.addEventListener("change",(()=>e.update(t)));const l=S$("label",{},(a[s]||t)+"");return l.prepend(u),i.appendChild(l),u})),e.set=t=>{const n=e.elements,r=n.length;for(let e=0;e<r;++e)$$(n[e].value,t)&&(n[e].checked=!0)}}function N$(e,t,n,r){r=void 0!==r?r:(+n.max+ +n.min)/2;const i=null!=n.max?n.max:Math.max(100,+r)||100,a=n.min||Math.min(0,i,+r)||0,s=n.step||Zt(a,i,100),o=S$("input",{type:"range",name:n.signal,min:a,max:i,step:s});o.value=r;const u=S$("span",{},+r);t.appendChild(o),t.appendChild(u);const l=()=>{u.textContent=o.value,e.update(+o.value)};o.addEventListener("input",l),o.addEventListener("change",l),e.elements=[o],e.set=e=>{o.value=e,u.textContent=e}}function $$(e,t){return e===t||e+""==t+""}function T$(e,t,n,r,i,a){return(t=t||new r(e.loader())).initialize(n,p$(e),g$(e),m$(e),i,a).background(e.background())}function O$(e,t){return t?function(){try{t.apply(this,arguments)}catch(t){e.error(t)}}:null}function M$(e,t,n){if("string"==typeof t){if("undefined"==typeof document)return e.error("DOM document instance not found."),null;if(!(t=document.querySelector(t)))return e.error("Signal bind element not found: "+t),null}if(t&&n)try{t.innerHTML=""}catch(n){t=null,e.error(n)}return t}const R$=e=>+e||0;function B$(e){return _e(e)?{top:R$(e.top),bottom:R$(e.bottom),left:R$(e.left),right:R$(e.right)}:(e=>({top:e,bottom:e,left:e,right:e}))(R$(e))}async function z$(e,t,n,r){const i=jb(t),a=i&&i.headless;return a||se("Unrecognized renderer type: "+t),await e.runAsync(),T$(e,null,null,a,n,r).renderAsync(e._scenegraph.root)}var L$="padding",P$={skip:!0};function j$(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===L$?r.left+r.right:0)}function U$(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===L$?r.top+r.bottom:0)}function W$(e,t){return t.modified&&ke(t.input.value)&&e.indexOf("_:vega:_")}function V$(e,t){return!("parent"===e||t instanceof mo.proxy)}function G$(e,t,n,r){const i=e.element();i&&i.setAttribute("title",function(e){return null==e?"":ke(e)?q$(e):_e(e)&&!pt(e)?(t=e,Object.keys(t).map((e=>{const n=t[e];return e+": "+(ke(n)?q$(n):H$(n))})).join("\n")):e+"";var t}(r))}function q$(e){return"["+e.map(H$).join(", ")+"]"}function H$(e){return ke(e)?"[]":_e(e)&&!pt(e)?"{}":e}function X$(e,t){const n=this;if(t=t||{},fo.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),null!=t.logLevel&&n.logLevel(t.logLevel),t.locale||e.locale){const r=rt({},e.locale,t.locale);n.locale(ns(r.number,r.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||Lb.Canvas,n._scenegraph=new wv;const r=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||G$,n._redraw=!0,n._handler=(new Hv).scene(r),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=function(e){const t=rt({defaults:{}},e),n=(e,t)=>{t.forEach((t=>{ke(e[t])&&(e[t]=Nt(e[t]))}))};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const i=function(e,t,n){return s$(e,mo,VN,n).parse(t)}(n,e,t.expr);n._runtime=i,n._signals=i.signals,n._bind=(e.bindings||[]).map((e=>({state:null,param:rt({},e)}))),i.root&&i.root.set(r),r.source=i.data.root.input,n.pulse(i.data.root.input,n.changeset().insert(r.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=j$(n,n._width),n._viewHeight=U$(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,function(e){var t=e._signals,n=t.width,r=t.height,i=t.padding;function a(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,(t=>{e._width=t.size,e._viewWidth=j$(e,t.size),a()}),{size:n}),e._resizeHeight=e.add(null,(t=>{e._height=t.size,e._viewHeight=U$(e,t.size),a()}),{size:r});const s=e.add(null,a,{pad:i});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=r.rank+1,s.rank=i.rank+1}(n),function(e){e.add(null,(t=>(e._background=t.bg,e._resize=1,t.bg)),{bg:e._signals.background})}(n),function(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:c$,item:null}));e.on(e.events("view","mousemove"),t,((e,n)=>{const r=t.value,i=r?vt(r)?r:r.user:c$,a=n.item&&n.item.cursor||null;return r&&i===r.user&&a==r.item?r:{user:i,item:a}})),e.add(null,(function(t){let n=t.cursor,r=this.value;return vt(n)||(r=n.item,n=n.user),d$(e,n&&n!==c$?n:r||n),r}),{cursor:t})}(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function K$(e,t){return ot(e._signals,t)?e._signals[t]:se("Unrecognized signal name: "+At(t))}function Y$(e,t){const n=(e._targets||[]).filter((e=>e._update&&e._update.handler===t));return n.length?n[0]:null}function Q$(e,t,n,r){let i=Y$(n,r);return i||(i=O$(e,(()=>r(t,n.value))),i.handler=r,e.on(n,null,i)),e}function J$(e,t,n){const r=Y$(t,n);return r&&t._targets.remove(r),e}dt(X$,fo,{async evaluate(e,t,n){if(await fo.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,i=m$(r=this),a=p$(r),s=g$(r),r._renderer.background(r.background()),r._renderer.resize(a,s,i),r._handler.origin(i),r._resizeListeners.forEach((e=>{try{e(a,s)}catch(e){r.error(e)}}))),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(e){this.error(e)}var r,i,a,s;return n&&$s(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=null!=e?e+"":null;return t!==this._desc&&l$(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const r=K$(this,e);return 1===arguments.length?r.value:this.update(r,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",B$(e)):B$(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(jb(e)||se("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(fo.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(K$(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:function(e,t,n,r,i,a){this.runAfter((s=>{let o=0;s._autosize=0,s.width()!==n&&(o=1,s.signal("width",n,P$),s._resizeWidth.skip(!0)),s.height()!==r&&(o=1,s.signal("height",r,P$),s._resizeHeight.skip(!0)),s._viewWidth!==e&&(s._resize=1,s._viewWidth=e),s._viewHeight!==t&&(s._resize=1,s._viewHeight=t),s._origin[0]===i[0]&&s._origin[1]===i[1]||(s._resize=1,s._origin=i),o&&s.run("enter"),a&&s.runAfter((e=>e.resize()))}),!1,1)},addEventListener(e,t,n){let r=t;return n&&!1===n.trap||(r=O$(this,t),r.raw=t),this._handler.on(e,r),this},removeEventListener(e,t){for(var n,r,i=this._handler.handlers(e),a=i.length;--a>=0;)if(r=i[a].type,n=i[a].handler,e===r&&(t===n||t===n.raw)){this._handler.off(r,n);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return Q$(this,e,K$(this,e),t)},removeSignalListener(e,t){return J$(this,K$(this,e),t)},addDataListener(e,t){return Q$(this,e,h$(this,e).values,t)},removeDataListener(e,t){return J$(this,h$(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=d$(this,null);this._globalCursor=!!e,t&&d$(this,t)}return this}return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:function(e,t){this._timers.push(function(e,t,n){var r=new XC,i=t;return null==t?(r.restart(e,t,n),r):(r._restart=r.restart,r.restart=function(e,t,n){t=+t,n=null==n?qC():+n,r._restart((function a(s){s+=i,r._restart(a,i+=t,n),e(s)}),t,n)},r.restart(e,t,n),r)}((function(t){e({timestamp:Date.now(),elapsed:t})}),t))},events:function(e,t,n){var r,i=this,a=new Js(n),s=function(n,r){i.runAsync(null,(()=>{e===y$&&function(e,t){var n=e._eventConfig.defaults,r=n.prevent,i=n.allow;return!1!==r&&!0!==i&&(!0===r||!1===i||(r?r[t]:i?!i[t]:e.preventDefault()))}(i,t)&&n.preventDefault(),a.receive(function(e,t,n){var r,i,a=e._renderer,s=a&&a.canvas();return s&&(i=m$(e),(r=Fv(t.changedTouches?t.changedTouches[0]:t,s))[0]-=i[0],r[1]-=i[1]),t.dataflow=e,t.item=n,t.vega=function(e,t,n){const r=t?"group"===t.mark.marktype?t:t.mark.group:null;function i(e){var n,i=r;if(e)for(n=t;n;n=n.mark.group)if(n.mark.name===e){i=n;break}return i&&i.mark&&i.mark.interactive?i:{}}function a(e){if(!e)return n;vt(e)&&(e=i(e));const t=n.slice();for(;e;)t[0]-=e.x||0,t[1]-=e.y||0,e=e.mark&&e.mark.group;return t}return{view:tt(e),item:tt(t||{}),group:i,xy:a,x:e=>a(e)[0],y:e=>a(e)[1]}}(e,n,r),t}(i,n,r))}))};if("timer"===e)x$(i,"timer",t)&&i.timer(s,t);else if(e===y$)x$(i,"view",t)&&i.addEventListener(t,s,v$);else if("window"===e?x$(i,"window",t)&&"undefined"!=typeof window&&(r=[window]):"undefined"!=typeof document&&x$(i,"selector",t)&&(r=document.querySelectorAll(e)),r){for(var o=0,u=r.length;o<u;++o)r[o].addEventListener(t,s);b$(i,r,t,s)}else i.warn("Can not resolve event source: "+e);return a},finalize:function(){var e,t,n,r=this._tooltip,i=this._timers,a=this._eventListeners;for(e=i.length;--e>=0;)i[e].stop();for(e=a.length;--e>=0;)for(t=(n=a[e]).sources.length;--t>=0;)n.sources[t].removeEventListener(n.type,n.handler);return r&&r.call(this,this._handler,null,null,null),this},hover:function(e,t){return t=[t||"update",(e=[e||"hover"])[0]],this.on(this.events("view","mouseover",w$),k$,_$(e)),this.on(this.events("view","mouseout",w$),k$,_$(t)),this},data:function(e,t){return arguments.length<2?h$(this,e).values.value:f$.call(this,e,Vs().remove(fe).insert(t))},change:f$,insert:function(e,t){return f$.call(this,e,Vs().insert(t))},remove:function(e,t){return f$.call(this,e,Vs().remove(t))},scale:function(e){var t=this._runtime.scales;return ot(t,e)||se("Unrecognized scale or projection: "+e),t[e].value},initialize:function(e,t){const n=this,r=n._renderType,i=n._eventConfig.bind,a=jb(r);e=n._el=e?M$(n,e,!0):null,function(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),l$(t,e.description()))}(n),a||n.error("Unrecognized renderer type: "+r);const s=a.handler||Hv,o=e?a.renderer:a.headless;return n._renderer=o?T$(n,n._renderer,e,o):null,n._handler=function(e,t,n,r){const i=new r(e.loader(),O$(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,m$(e),e);return t&&t.handlers().forEach((e=>{i.on(e.type,e.handler)})),i}(n,n._handler,e,s),n._redraw=!0,e&&"none"!==i&&(t=t?n._elBind=M$(n,t,!0):e.appendChild(S$("form",{class:"vega-bindings"})),n._bind.forEach((e=>{e.param.element&&"container"!==i&&(e.element=M$(n,e.param.element,!!e.param.input))})),n._bind.forEach((e=>{!function(e,t,n){if(!t)return;const r=n.param;let i=n.state;i||(i=n.state={elements:null,active:!1,set:null,update:t=>{t!=e.signal(r.signal)&&e.runAsync(null,(()=>{i.source=!0,e.signal(r.signal,t)}))}},r.debounce&&(i.update=nt(r.debounce,i.update))),(null==r.input&&r.element?C$:A$)(i,t,r,e),i.active||(e.on(e._signals[r.signal],null,(()=>{i.source?i.source=!1:i.set(e.signal(r.signal))})),i.active=!0)}(n,e.element||t,e)}))),n},toImageURL:async function(e,t){e!==Lb.Canvas&&e!==Lb.SVG&&e!==Lb.PNG&&se("Unrecognized image type: "+e);const n=await z$(this,e,t);return e===Lb.SVG?function(e,t){const n=new Blob([e],{type:"image/svg+xml"});return window.URL.createObjectURL(n)}(n.svg()):n.canvas().toDataURL("image/png")},toCanvas:async function(e,t){return(await z$(this,Lb.Canvas,e,t)).canvas()},toSVG:async function(e){return(await z$(this,Lb.SVG,e)).svg()},getState:function(e){return this._runtime.getState(e||{data:W$,signals:V$,recurse:!0})},setState:function(e){return this.runAsync(null,(t=>{t._trigger=!1,t._runtime.setState(e)}),(e=>{e._trigger=!0})),this}});const Z$=/[[\]{}]/,eT={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let tT,nT;function rT(e,t,n,r,i){const a=e.length;let s,o=0;for(;t<a;++t){if(s=e[t],!o&&s===n)return t;i&&i.indexOf(s)>=0?--o:r&&r.indexOf(s)>=0&&++o}return t}function iT(e){const t=[],n=e.length;let r=0,i=0;for(;i<n;)i=rT(e,i,",","[{","]}"),t.push(e.substring(r,i).trim()),r=++i;if(0===t.length)throw"Empty event selector: "+e;return t}function aT(e){return"["===e[0]?function(e){const t=e.length;let n,r=1;if(r=rT(e,r,"]","[","]"),r===t)throw"Empty between selector: "+e;if(n=iT(e.substring(1,r)),2!==n.length)throw"Between selector must have two elements: "+e;if(">"!==(e=e.slice(r+1).trim())[0])throw"Expected '>' after between selector: "+e;n=n.map(aT);const i=aT(e.slice(1).trim());return i.between?{between:n,stream:i}:(i.between=n,i)}(e):function(e){const t={source:tT},n=[];let r,i,a=[0,0],s=0,o=0,u=e.length,l=0;if("}"===e[u-1]){if(l=e.lastIndexOf("{"),!(l>=0))throw"Unmatched right brace: "+e;try{a=function(e){const t=e.split(",");if(!e.length||t.length>2)throw e;return t.map((t=>{const n=+t;if(n!=n)throw e;return n}))}(e.substring(l+1,u-1))}catch(t){throw"Invalid throttle specification: "+e}u=(e=e.slice(0,l).trim()).length,l=0}if(!u)throw e;if("@"===e[0]&&(s=++l),r=rT(e,l,":"),r<u&&(n.push(e.substring(o,r).trim()),o=l=++r),l=rT(e,l,"["),l===u)n.push(e.substring(o,u).trim());else if(n.push(e.substring(o,l).trim()),i=[],o=++l,o===u)throw"Unmatched left bracket: "+e;for(;l<u;){if(l=rT(e,l,"]"),l===u)throw"Unmatched left bracket: "+e;if(i.push(e.substring(o,l).trim()),l<u-1&&"["!==e[++l])throw"Expected left bracket: "+e;o=++l}if(!(u=n.length)||Z$.test(n[u-1]))throw"Invalid event selector: "+e;var c;return u>1?(t.type=n[1],s?t.markname=n[0].slice(1):(c=n[0],nT[c]?t.marktype=n[0]:t.source=n[0])):t.type=n[0],"!"===t.type.slice(-1)&&(t.consume=!0,t.type=t.type.slice(0,-1)),null!=i&&(t.filter=i),a[0]&&(t.throttle=a[0]),a[1]&&(t.debounce=a[1]),t}(e)}function sT(e){return _e(e)?e:{type:e||"pad"}}const oT=e=>+e||0;function uT(e){return _e(e)?e.signal?e:{top:oT(e.top),bottom:oT(e.bottom),left:oT(e.left),right:oT(e.right)}:{top:t=oT(e),bottom:t,left:t,right:t};var t}const lT=e=>_e(e)&&!ke(e)?rt({},e):{value:e};function cT(e,t,n,r){return null!=n?(_e(n)&&!ke(n)||ke(n)&&n.length&&_e(n[0])?e.update[t]=n:e[r||"enter"][t]={value:n},1):0}function dT(e,t,n){for(const n in t)cT(e,n,t[n]);for(const t in n)cT(e,t,n[t],"update")}function hT(e,t,n){for(const r in t)n&&ot(n,r)||(e[r]=rt(e[r]||{},t[r]));return e}function fT(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const pT="mark",gT="frame",mT="scope",yT="legend-label";function vT(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const bT=e=>vt(e)?At(e):e.signal?`(${e.signal})`:_T(e);function xT(e){if(null!=e.gradient)return function(e){const t=[e.start,e.stop,e.count].map((e=>null==e?null:At(e)));for(;t.length&&null==Fe(t);)t.pop();return t.unshift(bT(e.gradient)),`gradient(${t.join(",")})`}(e);let t=e.signal?`(${e.signal})`:e.color?function(e){return e.c?wT("hcl",e.h,e.c,e.l):e.h||e.s?wT("hsl",e.h,e.s,e.l):e.l||e.a?wT("lab",e.l,e.a,e.b):e.r||e.g||e.b?wT("rgb",e.r,e.g,e.b):null}(e.color):null!=e.field?_T(e.field):void 0!==e.value?At(e.value):void 0;return null!=e.scale&&(t=function(e,t){const n=bT(e.scale);return null!=e.range?t=`lerp(_range(${n}), ${+e.range})`:(void 0!==t&&(t=`_scale(${n}, ${t})`),e.band&&(t=(t?t+"+":"")+`_bandwidth(${n})`+(1==+e.band?"":"*"+kT(e.band)),e.extra&&(t=`(datum.extra ? _scale(${n}, datum.extra.value) : ${t})`)),null==t&&(t="0")),t}(e,t)),void 0===t&&(t=null),null!=e.exponent&&(t=`pow(${t},${kT(e.exponent)})`),null!=e.mult&&(t+=`*${kT(e.mult)}`),null!=e.offset&&(t+=`+${kT(e.offset)}`),e.round&&(t=`round(${t})`),t}const wT=(e,t,n,r)=>`(${e}(${[t,n,r].map(xT).join(",")})+'')`;function kT(e){return _e(e)?"("+xT(e)+")":e}function _T(e){return ST(_e(e)?e:{datum:e})}function ST(e){let t,n,r;if(e.signal)t="datum",r=e.signal;else if(e.group||e.parent){for(n=Math.max(1,e.level||1),t="item";n-- >0;)t+=".mark.group";e.parent?(r=e.parent,t+=".datum"):r=e.group}else e.datum?(t="datum",r=e.datum):se("Invalid field reference: "+At(e));return e.signal||(r=vt(r)?oe(r).map(At).join("]["):ST(r)),t+"["+r+"]"}function CT(e,t,n,r,i,a){const s={};(a=a||{}).encoders={$encode:s},e=function(e,t,n,r,i){const a={},s={};let o,u,l,c;for(u in u="lineBreak","text"!==t||null==i[u]||fT(u,e)||vT(a,u,i[u]),("legend"==n||String(n).startsWith("axis"))&&(n=null),c=n===gT?i.group:n===pT?rt({},i.mark,i[t]):null,c)l=fT(u,e)||("fill"===u||"stroke"===u)&&(fT("fill",e)||fT("stroke",e)),l||vT(a,u,c[u]);for(u in He(r).forEach((t=>{const n=i.style&&i.style[t];for(const t in n)fT(t,e)||vT(a,t,n[t])})),e=rt({},e),a)c=a[u],c.signal?(o=o||{})[u]=c:s[u]=c;return e.enter=rt(s,e.enter),o&&(e.update=rt(o,e.update)),e}(e,t,n,r,i.config);for(const n in e)s[n]=AT(e[n],t,a,i);return a}function AT(e,t,n,r){const i={},a={};for(const t in e)null!=e[t]&&(i[t]=ET((s=e[t],ke(s)?function(e){let t="";return e.forEach((e=>{const n=xT(e);t+=e.test?`(${e.test})?${n}:`:n})),":"===Fe(t)&&(t+="null"),t}(s):xT(s)),r,n,a));var s;return{$expr:{marktype:t,channels:i},$fields:Object.keys(a),$output:Object.keys(e)}}function ET(e,t,n,r){const i=QN(e,t);return i.$fields.forEach((e=>r[e]=1)),rt(n,i.$params),i.$expr}const FT=["value","update","init","react","bind"];function IT(e,t){se(e+' for "outer" push: '+At(t))}function DT(e,t){const n=e.name;if("outer"===e.push)t.signals[n]||IT("No prior signal definition",n),FT.forEach((t=>{void 0!==e[t]&&IT("Invalid property ",t)}));else{const r=t.addSignal(n,e.value);!1===e.react&&(r.react=!1),e.bind&&t.addBinding(n,e.bind)}}function NT(e,t,n,r){this.id=-1,this.type=e,this.value=t,this.params=n,r&&(this.parent=r)}function $T(e,t,n,r){return new NT(e,t,n,r)}function TT(e,t){return $T("operator",e,t)}function OT(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function MT(e,t){return t?{$field:e,$name:t}:{$field:e}}const RT=MT("key");function BT(e,t){return{$compare:e,$order:t}}function zT(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const LT="scope",PT="view";function jT(e){return e&&e.signal}function UT(e){if(jT(e))return!0;if(_e(e))for(const t in e)if(UT(e[t]))return!0;return!1}function WT(e,t){return null!=e?e:t}function VT(e){return e&&e.signal||e}const GT="timer";function qT(e,t){return(e.merge?HT:e.stream?XT:e.type?KT:se("Invalid stream specification: "+At(e)))(e,t)}function HT(e,t){const n=YT({merge:e.merge.map((e=>qT(e,t)))},e,t);return t.addStream(n).id}function XT(e,t){const n=YT({stream:qT(e.stream,t)},e,t);return t.addStream(n).id}function KT(e,t){let n;var r;e.type===GT?(n=t.event(GT,e.throttle),e={between:e.between,filter:e.filter}):n=t.event((r=e.source)===LT?PT:r||PT,e.type);const i=YT({stream:n},e,t);return 1===Object.keys(i).length?n:t.addStream(i).id}function YT(e,t,n){let r=t.between;return r&&(2!==r.length&&se('Stream "between" parameter must have 2 entries: '+At(t)),e.between=[qT(r[0],n),qT(r[1],n)]),r=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&r.push(function(e,t,n){const r="event.item";return r+(e&&"*"!==e?"&&"+r+".mark.marktype==='"+e+"'":"")+(n?"&&"+r+".mark.role==='"+n+"'":"")+(t?"&&"+r+".mark.name==='"+t+"'":"")}(t.marktype,t.markname,t.markrole)),t.source===LT&&r.push("inScope(event.item)"),r.length&&(e.filter=QN("("+r.join(")&&(")+")",n).$expr),null!=(r=t.throttle)&&(e.throttle=+r),null!=(r=t.debounce)&&(e.debounce=+r),t.consume&&(e.consume=!0),e}const QT={code:"_.$value",ast:{type:"Identifier",value:"value"}};function JT(e){return{signal:"["+e.map((e=>e.scale?'scale("'+e.scale+'")':e.signal))+"]"}}const ZT=e=>(t,n,r)=>$T(e,n,t||void 0,r),eO=ZT("aggregate"),tO=ZT("axisticks"),nO=ZT("bound"),rO=ZT("collect"),iO=ZT("compare"),aO=ZT("datajoin"),sO=ZT("encode"),oO=ZT("expression"),uO=ZT("facet"),lO=ZT("field"),cO=ZT("key"),dO=ZT("legendentries"),hO=ZT("load"),fO=ZT("mark"),pO=ZT("multiextent"),gO=ZT("multivalues"),mO=ZT("overlap"),yO=ZT("params"),vO=ZT("prefacet"),bO=ZT("projection"),xO=ZT("proxy"),wO=ZT("relay"),kO=ZT("render"),_O=ZT("scale"),SO=ZT("sieve"),CO=ZT("sortitems"),AO=ZT("viewlayout"),EO=ZT("values");let FO=0;const IO={min:"min",max:"max",count:"sum"};function DO(e,t){const n=t.getScale(e.name).params;let r;for(r in n.domain=OO(e.domain,e,t),null!=e.range&&(n.range=UO(e,t,n)),null!=e.interpolate&&function(e,t){t.interpolate=NO(e.type||e),null!=e.gamma&&(t.interpolateGamma=NO(e.gamma))}(e.interpolate,n),null!=e.nice&&(n.nice=function(e){return _e(e)?{interval:NO(e.interval),step:NO(e.step)}:NO(e)}(e.nice)),null!=e.bins&&(n.bins=function(e,t){return e.signal||ke(e)?$O(e,t):t.objectProperty(e)}(e.bins,t)),e)ot(n,r)||"name"===r||(n[r]=NO(e[r],t))}function NO(e,t){return _e(e)?e.signal?t.signalRef(e.signal):se("Unsupported object: "+At(e)):e}function $O(e,t){return e.signal?t.signalRef(e.signal):e.map((e=>NO(e,t)))}function TO(e){se("Can not find data set: "+At(e))}function OO(e,t,n){if(e)return e.signal?n.signalRef(e.signal):(ke(e)?MO:e.fields?BO:RO)(e,t,n);null==t.domainMin&&null==t.domainMax||se("No scale domain defined for domainMin/domainMax to override.")}function MO(e,t,n){return e.map((e=>NO(e,n)))}function RO(e,t,n){const r=n.getData(e.data);return r||TO(e.data),zp(t.type)?r.valuesRef(n,e.field,LO(e.sort,!1)):Up(t.type)?r.domainRef(n,e.field):r.extentRef(n,e.field)}function BO(e,t,n){const r=e.data,i=e.fields.reduce(((e,t)=>(t=vt(t)?{data:r,field:t}:ke(t)||t.signal?function(e,t){const n="_:vega:_"+FO++,r=rO({});if(ke(e))r.value={$ingest:e};else if(e.signal){const i="setdata("+At(n)+","+e.signal+")";r.params.input=t.signalRef(i)}return t.addDataPipeline(n,[r,SO({})]),{data:n,field:"data"}}(t,n):t,e.push(t),e)),[]);return(zp(t.type)?zO:Up(t.type)?PO:jO)(e,n,i)}function zO(e,t,n){const r=LO(e.sort,!0);let i,a;const s=n.map((e=>{const n=t.getData(e.data);return n||TO(e.data),n.countsRef(t,e.field,r)})),o={groupby:RT,pulse:s};r&&(i=r.op||"count",a=r.field?zT(i,r.field):"count",o.ops=[IO[i]],o.fields=[t.fieldRef(a)],o.as=[a]),i=t.add(eO(o));const u=t.add(rO({pulse:OT(i)}));return a=t.add(EO({field:RT,sort:t.sortRef(r),pulse:OT(u)})),OT(a)}function LO(e,t){return e&&(e.field||e.op?e.field||"count"===e.op?t&&e.field&&e.op&&!IO[e.op]&&se("Multiple domain scales can not be sorted using "+e.op):se("No field provided for sort aggregate op: "+e.op):_e(e)?e.field="key":e={field:"key"}),e}function PO(e,t,n){const r=n.map((e=>{const n=t.getData(e.data);return n||TO(e.data),n.domainRef(t,e.field)}));return OT(t.add(gO({values:r})))}function jO(e,t,n){const r=n.map((e=>{const n=t.getData(e.data);return n||TO(e.data),n.extentRef(t,e.field)}));return OT(t.add(pO({extents:r})))}function UO(e,t,n){const r=t.config.range;let i=e.range;if(i.signal)return t.signalRef(i.signal);if(vt(i)){if(r&&ot(r,i))return UO(e=rt({},e,{range:r[i]}),t,n);"width"===i?i=[0,{signal:"width"}]:"height"===i?i=zp(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:se("Unrecognized scale range value: "+At(i))}else{if(i.scheme)return n.scheme=ke(i.scheme)?$O(i.scheme,t):NO(i.scheme,t),i.extent&&(n.schemeExtent=$O(i.extent,t)),void(i.count&&(n.schemeCount=NO(i.count,t)));if(i.step)return void(n.rangeStep=NO(i.step,t));if(zp(e.type)&&!ke(i))return OO(i,e,t);ke(i)||se("Unsupported range type: "+At(i))}return i.map((e=>(ke(e)?$O:NO)(e,t)))}function WO(e,t,n){return ke(e)?e.map((e=>WO(e,t,n))):_e(e)?e.signal?n.signalRef(e.signal):"fit"===t?e:se("Unsupported parameter object: "+At(e)):e}const VO="top",GO="left",qO="right",HO="bottom",XO="label",KO="perc",YO="value",QO="guide-label",JO="guide-title",ZO="symbol",eM="gradient",tM="discrete",nM="size",rM=[nM,"shape","fill","stroke","strokeWidth","strokeDash","opacity"],iM={name:1,style:1,interactive:1},aM={value:0},sM={value:1},oM="group",uM="rect",lM="rule",cM="text";function dM(e){return e.type=oM,e.interactive=e.interactive||!1,e}function hM(e,t){const n=(n,r)=>WT(e[n],WT(t[n],r));return n.isVertical=n=>"vertical"===WT(e.direction,t.direction||(n?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>WT(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>WT(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>WT(e.columns,WT(t.columns,+n.isVertical(!0))),n}function fM(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function pM(e,t,n){return`item.anchor === 'start' ? ${e} : item.anchor === 'end' ? ${t} : ${n}`}const gM=pM(At(GO),At(qO),At("center"));function mM(e,t){return t?e?_e(e)?Object.assign({},e,{offset:mM(e.offset,t)}):{value:e,offset:t}:t:e}function yM(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=hT(e.encode,t,iM)):e.interactive=!1,e}function vM(e,t,n,r){const i=hM(e,n),a=i.isVertical(),s=i.gradientThickness(),o=i.gradientLength();let u,l,c,d,h;a?(l=[0,1],c=[0,0],d=s,h=o):(l=[0,0],c=[1,0],d=o,h=s);const f={enter:u={opacity:aM,x:aM,y:aM,width:lT(d),height:lT(h)},update:rt({},u,{opacity:sM,fill:{gradient:t,start:l,stop:c}}),exit:{opacity:aM}};return dT(f,{stroke:i("gradientStrokeColor"),strokeWidth:i("gradientStrokeWidth")},{opacity:i("gradientOpacity")}),yM({type:uM,role:"legend-gradient",encode:f},r)}function bM(e,t,n,r,i){const a=hM(e,n),s=a.isVertical(),o=a.gradientThickness(),u=a.gradientLength();let l,c,d,h,f="";s?(l="y",d="y2",c="x",h="width",f="1-"):(l="x",d="x2",c="y",h="height");const p={opacity:aM,fill:{scale:t,field:YO}};p[l]={signal:f+"datum."+KO,mult:u},p[c]=aM,p[d]={signal:f+"datum.perc2",mult:u},p[h]=lT(o);const g={enter:p,update:rt({},p,{opacity:sM}),exit:{opacity:aM}};return dT(g,{stroke:a("gradientStrokeColor"),strokeWidth:a("gradientStrokeWidth")},{opacity:a("gradientOpacity")}),yM({type:uM,role:"legend-band",key:YO,from:i,encode:g},r)}function xM(e,t,n,r){const i=hM(e,t),a=i.isVertical(),s=lT(i.gradientThickness()),o=i.gradientLength();let u,l,c,d,h=i("labelOverlap"),f="";const p={enter:u={opacity:aM},update:l={opacity:sM,text:{field:XO}},exit:{opacity:aM}};return dT(p,{fill:i("labelColor"),fillOpacity:i("labelOpacity"),font:i("labelFont"),fontSize:i("labelFontSize"),fontStyle:i("labelFontStyle"),fontWeight:i("labelFontWeight"),limit:WT(e.labelLimit,t.gradientLabelLimit)}),a?(u.align={value:"left"},u.baseline=l.baseline={signal:'datum.perc<=0?"bottom":datum.perc>=1?"top":"middle"'},c="y",d="x",f="1-"):(u.align=l.align={signal:'datum.perc<=0?"left":datum.perc>=1?"right":"center"'},u.baseline={value:"top"},c="x",d="y"),u[c]=l[c]={signal:f+"datum."+KO,mult:o},u[d]=l[d]=s,s.offset=WT(e.labelOffset,t.gradientLabelOffset)||0,h=h?{separation:i("labelSeparation"),method:h,order:"datum.index"}:void 0,yM({type:cM,role:yT,style:QO,key:YO,from:r,encode:p,overlap:h},n)}function wM(e,t,n,r,i){const a=hM(e,t),s=n.entries,o=!(!s||!s.interactive),u=s?s.name:void 0,l=a("clipHeight"),c=a("symbolOffset"),d={data:"value"},h=`(${i}) ? datum.offset : datum.size`,f=l?lT(l):{field:nM},p="datum.index",g=`max(1, ${i})`;let m,y,v,b,x;f.mult=.5,m={enter:y={opacity:aM,x:{signal:h,mult:.5,offset:c},y:f},update:v={opacity:sM,x:y.x,y:y.y},exit:{opacity:aM}};let w=null,k=null;e.fill||(w=t.symbolBaseFillColor,k=t.symbolBaseStrokeColor),dT(m,{fill:a("symbolFillColor",w),shape:a("symbolType"),size:a("symbolSize"),stroke:a("symbolStrokeColor",k),strokeDash:a("symbolDash"),strokeDashOffset:a("symbolDashOffset"),strokeWidth:a("symbolStrokeWidth")},{opacity:a("symbolOpacity")}),rM.forEach((t=>{e[t]&&(v[t]=y[t]={scale:e[t],field:YO})}));const _=yM({type:"symbol",role:"legend-symbol",key:YO,from:d,clip:!!l||void 0,encode:m},n.symbols),S=lT(c);S.offset=a("labelOffset"),m={enter:y={opacity:aM,x:{signal:h,offset:S},y:f},update:v={opacity:sM,text:{field:XO},x:y.x,y:y.y},exit:{opacity:aM}},dT(m,{align:a("labelAlign"),baseline:a("labelBaseline"),fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontStyle:a("labelFontStyle"),fontWeight:a("labelFontWeight"),limit:a("labelLimit")});const C=yM({type:cM,role:yT,style:QO,key:YO,from:d,encode:m},n.labels);return m={enter:{noBound:{value:!l},width:aM,height:l?lT(l):aM,opacity:aM},exit:{opacity:aM},update:v={opacity:sM,row:{signal:null},column:{signal:null}}},a.isVertical(!0)?(b=`ceil(item.mark.items.length / ${g})`,v.row.signal=`${p}%${b}`,v.column.signal=`floor(${p} / ${b})`,x={field:["row",p]}):(v.row.signal=`floor(${p} / ${g})`,v.column.signal=`${p} % ${g}`,x={field:p}),v.column.signal=`(${i})?${v.column.signal}:${p}`,dM({role:mT,from:r={facet:{data:r,name:"value",groupby:"index"}},encode:hT(m,s,iM),marks:[_,C],name:u,interactive:o,sort:x})}const kM='item.orient === "left"',_M='item.orient === "right"',SM=`(${kM} || ${_M})`,CM=`datum.vgrad && ${SM}`,AM=pM('"top"','"bottom"','"middle"'),EM=`datum.vgrad && ${_M} ? (${pM('"right"','"left"','"center"')}) : (${SM} && !(datum.vgrad && ${kM})) ? "left" : ${gM}`,FM=`item._anchor || (${SM} ? "middle" : "start")`,IM=`${CM} ? (${kM} ? -90 : 90) : 0`,DM=`${SM} ? (datum.vgrad ? (${_M} ? "bottom" : "top") : ${AM}) : "top"`;function NM(e,t){let n;return _e(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+$M(e.path)+")":e.sphere&&(n="geoShape("+$M(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function $M(e){return _e(e)&&e.signal?e.signal:At(e)}function TM(e){const t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")&&t.indexOf("title")?e.type===oM?mT:t||pT:t}function OM(e){return{marktype:e.type,name:e.name||void 0,role:e.role||TM(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function MM(e,t){return e&&e.signal?t.signalRef(e.signal):!1!==e}function RM(e,t){const n=yo(e.type);n||se("Unrecognized transform type: "+At(e.type));const r=$T(n.type.toLowerCase(),null,BM(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(r)),r.metadata=n.metadata||{},r}function BM(e,t,n){const r={},i=e.params.length;for(let a=0;a<i;++a){const i=e.params[a];r[i.name]=zM(i,t,n)}return r}function zM(e,t,n){const r=e.type,i=t[e.name];return"index"===r?function(e,t,n){return vt(t.from)||se('Lookup "from" parameter must be a string literal.'),n.getData(t.from).lookupRef(n,t.key)}(0,t,n):void 0!==i?"param"===r?function(e,t,n){const r=t[e.name];return e.array?(ke(r)||se("Expected an array of sub-parameters. Instead: "+At(r)),r.map((t=>PM(e,t,n)))):PM(e,r,n)}(e,t,n):"projection"===r?n.projectionRef(t[e.name]):e.array&&!jT(i)?i.map((t=>LM(e,t,n))):LM(e,i,n):void(e.required&&se("Missing required "+At(t.type)+" parameter: "+At(e.name)))}function LM(e,t,n){const r=e.type;if(jT(t))return VM(r)?se("Expression references can not be signals."):GM(r)?n.fieldRef(t):qM(r)?n.compareRef(t):n.signalRef(t.signal);{const i=e.expr||GM(r);return i&&jM(t)?n.exprRef(t.expr,t.as):i&&UM(t)?MT(t.field,t.as):VM(r)?QN(t,n):WM(r)?OT(n.getData(t).values):GM(r)?MT(t):qM(r)?n.compareRef(t):t}}function PM(e,t,n){const r=e.params.length;let i;for(let n=0;n<r;++n){i=e.params[n];for(const e in i.key)if(i.key[e]!==t[e]){i=null;break}if(i)break}i||se("Unsupported parameter: "+At(t));const a=rt(BM(i,t,n),i.key);return OT(n.add(yO(a)))}const jM=e=>e&&e.expr,UM=e=>e&&e.field,WM=e=>"data"===e,VM=e=>"expr"===e,GM=e=>"field"===e,qM=e=>"compare"===e;function HM(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:OT(t.getData(e.data).output)}function XM(e,t,n,r,i){this.scope=e,this.input=t,this.output=n,this.values=r,this.aggregate=i,this.index={}}function KM(e){return vt(e)?e:null}function YM(e,t,n){const r=zT(n.op,n.field);let i;if(t.ops){for(let e=0,n=t.as.length;e<n;++e)if(t.as[e]===r)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((i=n.op.signal)?e.signalRef(i):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(r))}function QM(e,t,n,r,i,a,s){const o=t[n]||(t[n]={}),u=function(e){return _e(e)?("descending"===e.order?"-":"+")+zT(e.op,e.field):""}(a);let l,c,d=KM(i);if(null!=d&&(e=t.scope,d+=u?"|"+u:"",l=o[d]),!l){const n=a?{field:RT,pulse:t.countsRef(e,i,a)}:{field:e.fieldRef(i),pulse:OT(t.output)};u&&(n.sort=e.sortRef(a)),c=e.add($T(r,void 0,n)),s&&(t.index[i]=c),l=OT(c),null!=d&&(o[d]=l)}return l}function JM(e,t,n){const r=e.remove,i=e.insert,a=e.toggle,s=e.modify,o=e.values,u=t.add(TT()),l=QN("if("+e.trigger+',modify("'+n+'",'+[i,r,a,s,o].map((e=>null==e?"null":e)).join(",")+"),0)",t);u.update=l.$expr,u.params=l.$params}function ZM(e,t){const n=TM(e),r=e.type===oM,i=e.from&&e.from.facet,a=e.overlap;let s,o,u,l,c,d,h,f=e.layout||n===mT||n===gT;const p=n===pT||f||i,g=function(e,t,n){let r,i,a,s,o;return e?(r=e.facet)&&(t||se("Only group marks can be faceted."),null!=r.field?s=o=HM(r,n):(e.data?o=OT(n.getData(e.data).aggregate):(a=RM(rt({type:"aggregate",groupby:He(r.groupby)},r.aggregate),n),a.params.key=n.keyRef(r.groupby),a.params.pulse=HM(r,n),s=o=OT(n.add(a))),i=n.keyRef(r.groupby,!0))):s=OT(n.add(rO(null,[{}]))),s||(s=HM(e,n)),{key:i,pulse:s,parent:o}}(e.from,r,t);o=t.add(aO({key:g.key||(e.key?MT(e.key):void 0),pulse:g.pulse,clean:!r}));const m=OT(o);o=u=t.add(rO({pulse:m})),o=t.add(fO({markdef:OM(e),interactive:MM(e.interactive,t),clip:NM(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:OT(o)}));const y=OT(o);o=l=t.add(sO(CT(e.encode,e.type,n,e.style,t,{mod:!1,pulse:y}))),o.params.parent=t.encode(),e.transform&&e.transform.forEach((e=>{const n=RM(e,t),r=n.metadata;(r.generates||r.changes)&&se("Mark transforms should not generate new data."),r.nomod||(l.params.mod=!0),n.params.pulse=OT(o),t.add(o=n)})),e.sort&&(o=t.add(CO({sort:t.compareRef(e.sort),pulse:OT(o)})));const v=OT(o);(i||f)&&(f=t.add(AO({layout:t.objectProperty(e.layout),legends:t.legends,mark:y,pulse:v})),d=OT(f));const b=t.add(nO({mark:y,pulse:d||v}));h=OT(b),r&&(p&&(s=t.operators,s.pop(),f&&s.pop()),t.pushState(v,d||h,m),i?function(e,t,n){const r=e.from.facet,i=r.name,a=HM(r,t);let s;r.name||se("Facet must have a name: "+At(r)),r.data||se("Facet must reference a data set: "+At(r)),r.field?s=t.add(vO({field:t.fieldRef(r.field),pulse:a})):r.groupby?s=t.add(uO({key:t.keyRef(r.groupby),group:OT(t.proxy(n.parent)),pulse:a})):se("Facet must specify groupby or field: "+At(r));const o=t.fork(),u=o.add(rO()),l=o.add(SO({pulse:OT(u)}));o.addData(i,new XM(o,u,u,l)),o.addSignal("parent",null),s.params.subflow={$subflow:o.parse(e).toRuntime()}}(e,t,g):p?function(e,t,n){const r=t.add(vO({pulse:n.pulse})),i=t.fork();i.add(SO()),i.addSignal("parent",null),r.params.subflow={$subflow:i.parse(e).toRuntime()}}(e,t,g):t.parse(e),t.popState(),p&&(f&&s.push(f),s.push(b))),a&&(h=function(e,t,n){const r=e.method,i=e.bound,a=e.separation,s={separation:jT(a)?n.signalRef(a.signal):a,method:jT(r)?n.signalRef(r.signal):r,pulse:t};if(e.order&&(s.sort=n.compareRef({field:e.order})),i){const e=i.tolerance;s.boundTolerance=jT(e)?n.signalRef(e.signal):+e,s.boundScale=n.scaleRef(i.scale),s.boundOrient=i.orient}return OT(n.add(mO(s)))}(a,h,t));const x=t.add(kO({pulse:h})),w=t.add(SO({pulse:OT(x)},void 0,t.parent()));null!=e.name&&(c=e.name,t.addData(c,new XM(t,u,x,w)),e.on&&e.on.forEach((e=>{(e.insert||e.remove||e.toggle)&&se("Marks only support modify triggers."),JM(e,t,c)})))}function eR(e,t,n){const r={enter:{},update:{}};return dT(r,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),r}function tR(e,t,n){return t[e]?`scale("${t[e]}",datum)`:fM(e,n[0].encode)}function nR(e,t){const n={enter:{},update:{}};return dT(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:gM},angle:{signal:'item.orient==="left"?-90:item.orient==="right"?90:0'},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),hT(n,t,iM)}function rR(e){const t=rO({},e);return t.metadata={source:!0},t}function iR(e,t){return hO({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}XM.fromEntries=function(e,t){const n=t.length,r=t[n-1],i=t[n-2];let a=t[0],s=null,o=1;for(a&&"load"===a.type&&(a=t[1]),e.add(t[0]);o<n;++o)t[o].params.pulse=OT(t[o-1]),e.add(t[o]),"aggregate"===t[o].type&&(s=t[o]);return new XM(e,a,i,r,s)},XM.prototype={countsRef(e,t,n){const r=this,i=r.counts||(r.counts={}),a=KM(t);let s,o,u;return null!=a&&(e=r.scope,s=i[a]),s?n&&n.field&&YM(e,s.agg.params,n):(u={groupby:e.fieldRef(t,"key"),pulse:OT(r.output)},n&&n.field&&YM(e,u,n),o=e.add(eO(u)),s=e.add(rO({pulse:OT(o)})),s={agg:o,ref:OT(s)},null!=a&&(i[a]=s)),s.ref},tuplesRef(){return OT(this.values)},extentRef(e,t){return QM(e,this,"extent","extent",t,!1)},domainRef(e,t){return QM(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return QM(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return QM(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return QM(e,this,"indata","tupleindex",t,!0,!0)}};const aR=e=>e===HO||e===VO,sR=(e,t,n)=>jT(e)?hR(e.signal,t,n):e===GO||e===VO?t:n,oR=(e,t,n)=>jT(e)?cR(e.signal,t,n):aR(e)?t:n,uR=(e,t,n)=>jT(e)?dR(e.signal,t,n):aR(e)?n:t,lR=(e,t,n)=>jT(e)?fR(e.signal,t,n):e===VO?{value:t}:{value:n},cR=(e,t,n)=>pR(`${e} === 'top' || ${e} === 'bottom'`,t,n),dR=(e,t,n)=>pR(`${e} !== 'top' && ${e} !== 'bottom'`,t,n),hR=(e,t,n)=>mR(`${e} === 'left' || ${e} === 'top'`,t,n),fR=(e,t,n)=>mR(`${e} === 'top'`,t,n),pR=(e,t,n)=>(t=null!=t?lT(t):t,n=null!=n?lT(n):n,gR(t)&&gR(n)?{signal:`${e} ? (${t=t?t.signal||At(t.value):null}) : (${n=n?n.signal||At(n.value):null})`}:[rt({test:e},t)].concat(n||[])),gR=e=>null==e||1===Object.keys(e).length,mR=(e,t,n)=>({signal:`${e} ? (${vR(t)}) : (${vR(n)})`}),yR=(e,t,n,r,i)=>({signal:(null!=r?`${e} === 'left' ? (${vR(r)}) : `:"")+(null!=n?`${e} === 'bottom' ? (${vR(n)}) : `:"")+(null!=i?`${e} === 'right' ? (${vR(i)}) : `:"")+(null!=t?`${e} === 'top' ? (${vR(t)}) : `:"")+"(null)"}),vR=e=>jT(e)?e.signal:null==e?null:At(e),bR=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function xR(e,t,n,r){let i;if(t&&ot(t,e))return t[e];if(ot(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":i="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":i=e[5].toLowerCase()+e.slice(6)}return r["guide-title"][i]}if(e.startsWith("label")){switch(e){case"labelColor":i="fill";break;case"labelFont":case"labelFontSize":i=e[5].toLowerCase()+e.slice(6)}return r["guide-label"][i]}return null}function wR(e){const t={};for(const n of e)if(n)for(const e in n)t[e]=1;return Object.keys(t)}function kR(e,t){return{scale:e.scale,range:t}}function _R(e,t,n,r,i){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+r+","+i+")"}}function SR(e,t,n,r,i,a){const s=hM(e,t),o=e.orient,u=e.scale,l=sR(o,-1,1),c=VT(s("labelFlush")),d=VT(s("labelFlushOffset")),h=s("labelAlign"),f=s("labelBaseline");let p,g=0===c||!!c;const m=lT(i);m.mult=l,m.offset=lT(s("labelPadding")||0),m.offset.mult=l;const y={scale:u,field:YO,band:.5,offset:mM(a.offset,s("labelOffset"))},v=oR(o,g?_R(u,c,'"left"','"right"','"center"'):{value:"center"},((e,t,n)=>jT(e)?((e,t,n)=>mR(`${e} === 'right'`,t,n))(e.signal,t,n):e===qO?{value:t}:{value:n})(o,"left","right")),b=oR(o,lR(o,"bottom","top"),g?_R(u,c,'"top"','"bottom"','"middle"'):{value:"middle"}),x=_R(u,c,`-(${d})`,d,0);g=g&&d;const w={opacity:aM,x:oR(o,y,m),y:uR(o,y,m)},k={enter:w,update:p={opacity:sM,text:{field:XO},x:w.x,y:w.y,align:v,baseline:b},exit:{opacity:aM,x:w.x,y:w.y}};dT(k,{dx:!h&&g?oR(o,x):null,dy:!f&&g?uR(o,x):null}),dT(k,{angle:s("labelAngle"),fill:s("labelColor"),fillOpacity:s("labelOpacity"),font:s("labelFont"),fontSize:s("labelFontSize"),fontWeight:s("labelFontWeight"),fontStyle:s("labelFontStyle"),limit:s("labelLimit"),lineHeight:s("labelLineHeight")},{align:h,baseline:f});const _=s("labelBound");let S=s("labelOverlap");return S=S||_?{separation:s("labelSeparation"),method:S,order:"datum.index",bound:_?{scale:u,orient:o,tolerance:_}:null}:void 0,p.align!==v&&(p.align=bR(p.align,v)),p.baseline!==b&&(p.baseline=bR(p.baseline,b)),yM({type:cM,role:"axis-label",style:QO,key:YO,from:r,encode:k,overlap:S},n)}function CR(e,t){const n=function(e,t){var n,r,i,a=t.config,s=a.style,o=a.axis,u="band"===t.scaleType(e.scale)&&a.axisBand,l=e.orient;if(jT(l)){const e=wR([a.axisX,a.axisY]),t=wR([a.axisTop,a.axisBottom,a.axisLeft,a.axisRight]);for(i of(n={},e))n[i]=oR(l,xR(i,a.axisX,o,s),xR(i,a.axisY,o,s));for(i of(r={},t))r[i]=yR(l.signal,xR(i,a.axisTop,o,s),xR(i,a.axisBottom,o,s),xR(i,a.axisLeft,o,s),xR(i,a.axisRight,o,s))}else n=l===VO||l===HO?a.axisX:a.axisY,r=a["axis"+l[0].toUpperCase()+l.slice(1)];return n||r||u?rt({},o,n,r,u):o}(e,t),r=e.encode||{},i=r.axis||{},a=i.name||void 0,s=i.interactive,o=i.style,u=hM(e,n),l=function(e){const t=e("tickBand");let n,r,i=e("tickOffset");return t?t.signal?(n={signal:`(${t.signal}) === 'extent' ? 1 : 0.5`},r={signal:`(${t.signal}) === 'extent'`},_e(i)||(i={signal:`(${t.signal}) === 'extent' ? 0 : ${i}`})):"extent"===t?(n=1,r=!0,i=0):(n=.5,r=!1):(n=e("bandPosition"),r=e("tickExtra")),{extra:r,band:n,offset:i}}(u),c={scale:e.scale,ticks:!!u("ticks"),labels:!!u("labels"),grid:!!u("grid"),domain:!!u("domain"),title:null!=e.title},d=OT(t.add(rO({},[c]))),h=OT(t.add(tO({scale:t.scaleRef(e.scale),extra:t.property(l.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),f=[];let p;return c.grid&&f.push(function(e,t,n,r,i){const a=hM(e,t),s=e.orient,o=e.gridScale,u=sR(s,1,-1),l=function(e,t){if(1===t);else if(_e(e)){let n=e=rt({},e);for(;null!=n.mult;){if(!_e(n.mult))return n.mult=jT(t)?{signal:`(${n.mult}) * (${t.signal})`}:n.mult*t,e;n=n.mult=rt({},n.mult)}n.mult=t}else e=jT(t)?{signal:`(${t.signal}) * (${e||0})`}:t*(e||0);return e}(e.offset,u);let c,d,h;const f={enter:c={opacity:aM},update:h={opacity:sM},exit:d={opacity:aM}};dT(f,{stroke:a("gridColor"),strokeCap:a("gridCap"),strokeDash:a("gridDash"),strokeDashOffset:a("gridDashOffset"),strokeOpacity:a("gridOpacity"),strokeWidth:a("gridWidth")});const p={scale:e.scale,field:YO,band:i.band,extra:i.extra,offset:i.offset,round:a("tickRound")},g=oR(s,{signal:"height"},{signal:"width"}),m=o?{scale:o,range:0,mult:u,offset:l}:{value:0,offset:l},y=o?{scale:o,range:1,mult:u,offset:l}:rt(g,{mult:u,offset:l});return c.x=h.x=oR(s,p,m),c.y=h.y=uR(s,p,m),c.x2=h.x2=uR(s,y),c.y2=h.y2=oR(s,y),d.x=oR(s,p),d.y=uR(s,p),yM({type:lM,role:"axis-grid",key:YO,from:r,encode:f},n)}(e,n,r.grid,h,l)),c.ticks&&(p=u("tickSize"),f.push(function(e,t,n,r,i,a){const s=hM(e,t),o=e.orient,u=sR(o,-1,1);let l,c,d;const h={enter:l={opacity:aM},update:d={opacity:sM},exit:c={opacity:aM}};dT(h,{stroke:s("tickColor"),strokeCap:s("tickCap"),strokeDash:s("tickDash"),strokeDashOffset:s("tickDashOffset"),strokeOpacity:s("tickOpacity"),strokeWidth:s("tickWidth")});const f=lT(i);f.mult=u;const p={scale:e.scale,field:YO,band:a.band,extra:a.extra,offset:a.offset,round:s("tickRound")};return d.y=l.y=oR(o,aM,p),d.y2=l.y2=oR(o,f),c.x=oR(o,p),d.x=l.x=uR(o,aM,p),d.x2=l.x2=uR(o,f),c.y=uR(o,p),yM({type:lM,role:"axis-tick",key:YO,from:r,encode:h},n)}(e,n,r.ticks,h,p,l))),c.labels&&(p=c.ticks?p:0,f.push(SR(e,n,r.labels,h,p,l))),c.domain&&f.push(function(e,t,n,r){const i=hM(e,t),a=e.orient;let s,o;const u={enter:s={opacity:aM},update:o={opacity:sM},exit:{opacity:aM}};dT(u,{stroke:i("domainColor"),strokeCap:i("domainCap"),strokeDash:i("domainDash"),strokeDashOffset:i("domainDashOffset"),strokeWidth:i("domainWidth"),strokeOpacity:i("domainOpacity")});const l=kR(e,0),c=kR(e,1);return s.x=o.x=oR(a,l,aM),s.x2=o.x2=oR(a,c),s.y=o.y=uR(a,l,aM),s.y2=o.y2=uR(a,c),yM({type:lM,role:"axis-domain",from:r,encode:u},n)}(e,n,r.domain,d)),c.title&&f.push(function(e,t,n,r){const i=hM(e,t),a=e.orient,s=sR(a,-1,1);let o,u;const l={enter:o={opacity:aM,anchor:lT(i("titleAnchor",null)),align:{signal:gM}},update:u=rt({},o,{opacity:sM,text:lT(e.title)}),exit:{opacity:aM}},c={signal:`lerp(range("${e.scale}"), ${pM(0,1,.5)})`};return u.x=oR(a,c),u.y=uR(a,c),o.angle=oR(a,aM,((e,t)=>jT(e)?{signal:`(${e.signal}) * 90`}:{value:90*e})(s)),o.baseline=oR(a,lR(a,HO,VO),{value:HO}),u.angle=o.angle,u.baseline=o.baseline,dT(l,{fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),angle:i("titleAngle"),baseline:i("titleBaseline")}),function(e,t,n,r){const i=(e,t)=>null!=e?(n.update[t]=bR(lT(e),n.update[t]),!1):!fT(t,r),a=i(e("titleX"),"x"),s=i(e("titleY"),"y");n.enter.auto=s===a?lT(s):oR(t,lT(s),lT(a))}(i,a,l,n),l.update.align=bR(l.update.align,o.align),l.update.angle=bR(l.update.angle,o.angle),l.update.baseline=bR(l.update.baseline,o.baseline),yM({type:cM,role:"axis-title",style:JO,from:r,encode:l},n)}(e,n,r.title,d)),ZM(dM({role:"axis",from:d,encode:hT(AR(u,e),i,iM),marks:f,aria:u("aria"),description:u("description"),zindex:u("zindex"),name:a,interactive:s,style:o}),t)}function AR(e,t){const n={enter:{},update:{}};return dT(n,{orient:e("orient"),offset:e("offset")||0,position:WT(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:`abs(span(range("${t.scale}")))`},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function ER(e,t,n){const r=He(e.signals),i=He(e.scales);return n||r.forEach((e=>DT(e,t))),He(e.projections).forEach((e=>function(e,t){const n=t.config.projection||{},r={};for(const n in e)"name"!==n&&(r[n]=WO(e[n],n,t));for(const e in n)null==r[e]&&(r[e]=WO(n[e],e,t));t.addProjection(e.name,r)}(e,t))),i.forEach((e=>function(e,t){const n=e.type||"linear";Mp(n)||se("Unrecognized scale type: "+At(n)),t.addScale(e.name,{type:n,domain:void 0})}(e,t))),He(e.data).forEach((e=>function(e,t){const n=[];e.transform&&e.transform.forEach((e=>{n.push(RM(e,t))})),e.on&&e.on.forEach((n=>{JM(n,t,e.name)})),t.addDataPipeline(e.name,function(e,t,n){const r=[];let i,a,s,o,u,l=null,c=!1,d=!1;for(e.values?jT(e.values)||UT(e.format)?(r.push(iR(t,e)),r.push(l=rR())):r.push(l=rR({$ingest:e.values,$format:e.format})):e.url?UT(e.url)||UT(e.format)?(r.push(iR(t,e)),r.push(l=rR())):r.push(l=rR({$request:e.url,$format:e.format})):e.source&&(l=i=He(e.source).map((e=>OT(t.getData(e).output))),r.push(null)),a=0,s=n.length;a<s;++a)o=n[a],u=o.metadata,l||u.source||r.push(l=rR()),r.push(o),u.generates&&(d=!0),u.modifies&&!d&&(c=!0),u.source?l=o:u.changes&&(l=null);return i&&(s=i.length-1,r[0]=wO({derive:c,pulse:s?i:i[0]}),(c||s)&&r.splice(1,0,rR())),l||r.push(rR()),r.push(SO({})),r}(e,t,n))}(e,t))),i.forEach((e=>DO(e,t))),(n||r).forEach((e=>function(e,t){const n=t.getSignal(e.name);let r=e.update;e.init&&(r?se("Signals can not include both init and update expressions."):(r=e.init,n.initonly=!0)),r&&(r=QN(r,t),n.update=r.$expr,n.params=r.$params),e.on&&e.on.forEach((e=>function(e,t,n){const r=e.encode,i={target:n};let a=e.events,s=e.update,o=[];var u,l;a||se("Signal update missing events specification."),vt(a)&&(u=a,l=t.isSubscope()?LT:PT,tT=l||"view",nT=eT,a=iT(u.trim()).map(aT)),a=He(a).filter((e=>e.signal||e.scale?(o.push(e),0):1)),o.length>1&&(o=[JT(o)]),a.length&&o.push(a.length>1?{merge:a}:a[0]),null!=r&&(s&&se("Signal encode and update are mutually exclusive."),s="encode(item(),"+At(r)+")"),i.update=vt(s)?QN(s,t):null!=s.expr?QN(s.expr,t):null!=s.value?s.value:null!=s.signal?{$expr:QT,$params:{$value:t.signalRef(s.signal)}}:se("Invalid signal update specification."),e.force&&(i.options={force:!0}),o.forEach((e=>t.addUpdate(rt(function(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):qT(e,t)}}(e,t),i))))}(e,t,n.id)))}(e,t))),He(e.axes).forEach((e=>CR(e,t))),He(e.marks).forEach((e=>ZM(e,t))),He(e.legends).forEach((e=>function(e,t){const n=t.config.legend,r=e.encode||{},i=hM(e,n),a=r.legend||{},s=a.name||void 0,o=a.interactive,u=a.style,l={};let c,d,h,f=0;rM.forEach((t=>e[t]?(l[t]=e[t],f=f||e[t]):0)),f||se("Missing valid scale for legend.");const p=function(e,t){let n=e.type||ZO;return e.type||1!==function(e){return rM.reduce(((t,n)=>t+(e[n]?1:0)),0)}(e)||!e.fill&&!e.stroke||(n=Bp(t)?eM:Lp(t)?tM:ZO),n!==eM?n:Lp(t)?tM:eM}(e,t.scaleType(f)),g={title:null!=e.title,scales:l,type:p,vgrad:"symbol"!==p&&i.isVertical()},m=OT(t.add(rO(null,[g]))),y=OT(t.add(dO(d={type:p,scale:t.scaleRef(f),count:t.objectProperty(i("tickCount")),limit:t.property(i("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return p===eM?(h=[vM(e,f,n,r.gradient),xM(e,n,r.labels,y)],d.count=d.count||t.signalRef(`max(2,2*floor((${VT(i.gradientLength())})/100))`)):p===tM?h=[bM(e,f,n,r.gradient,y),xM(e,n,r.labels,y)]:(c=function(e,t){const n=hM(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}(e,n),h=[wM(e,n,r,y,VT(c.columns))],d.size=function(e,t,n){const r=VT(tR("size",e,n)),i=VT(tR("strokeWidth",e,n)),a=VT(function(e,t,n){return fM("fontSize",e)||function(e,t,n){const r=t.config.style["guide-label"];return r&&r.fontSize}(0,t)}(n[1].encode,t));return QN(`max(ceil(sqrt(${r})+${i}),${a})`,t)}(e,t,h[0].marks)),h=[dM({role:"legend-entry",from:m,encode:{enter:{x:{value:0},y:{value:0}}},marks:h,layout:c,interactive:o})],g.title&&h.push(function(e,t,n,r){const i=hM(e,t),a={enter:{opacity:aM},update:{opacity:sM,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:aM}};return dT(a,{orient:i("titleOrient"),_anchor:i("titleAnchor"),anchor:{signal:FM},angle:{signal:IM},align:{signal:EM},baseline:{signal:DM},text:e.title,fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),baseline:i("titleBaseline")}),yM({type:cM,role:"legend-title",style:JO,from:r,encode:a},n)}(e,n,r.title,m)),ZM(dM({role:"legend",from:m,encode:hT(eR(i,e,n),a,iM),marks:h,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:s,interactive:o,style:u}),t)}(e,t))),e.title&&function(e,t){const n=hM(e=vt(e)?{text:e}:e,t.config.title),r=e.encode||{},i=r.group||{},a=i.name||void 0,s=i.interactive,o=i.style,u=[],l=OT(t.add(rO(null,[{}])));u.push(function(e,t,n,r){const i={value:0},a={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return dT(a,{text:e.text,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),yM({type:cM,role:"title-text",style:"group-title",from:r,encode:a},n)}(e,n,function(e){const t=e.encode;return t&&t.title||rt({name:e.name,interactive:e.interactive,style:e.style},t)}(e),l)),e.subtitle&&u.push(function(e,t,n,r){const i={value:0},a={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return dT(a,{text:e.subtitle,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),yM({type:cM,role:"title-subtitle",style:"group-subtitle",from:r,encode:a},n)}(e,n,r.subtitle,l)),ZM(dM({role:"title",from:l,encode:nR(n,i),marks:u,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:a,interactive:s,style:o}),t)}(e.title,t),t.parseLambdas(),t}function FR(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function IR(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function DR(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function NR(e){return(ke(e)?$R:TR)(e)}function $R(e){const t=e.length;let n="[";for(let r=0;r<t;++r){const t=e[r];n+=(r>0?",":"")+(_e(t)?t.signal||NR(t):At(t))}return n+"]"}function TR(e){let t,n,r="{",i=0;for(t in e)n=e[t],r+=(++i>1?",":"")+At(t)+":"+(_e(n)?n.signal||NR(n):At(n));return r+"}"}function OR(e,t,n){return _e(e)||se("Input Vega specification must be an object."),t=Ce(function(){const e="sans-serif",t="#4c78a8",n="#000",r="#888",i="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:t},area:{fill:t},image:null,line:{stroke:t,strokeWidth:2},path:{stroke:t},rect:{fill:t},rule:{stroke:n},shape:{stroke:t},symbol:{fill:t,size:64},text:{fill:n,font:e,fontSize:11},trail:{fill:t,size:2},style:{"guide-label":{fill:n,font:e,fontSize:10},"guide-title":{fill:n,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:n,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:n,font:e,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:i}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:r,grid:!1,gridWidth:1,gridColor:i,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:r,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:i,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:r,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}(),t,e.config),function(e,t){const n=t.config,r=OT(t.root=t.add(TT())),i=function(e,t){const n=n=>WT(e[n],t[n]),r=[FR("background",n("background")),FR("autosize",sT(n("autosize"))),FR("padding",uT(n("padding"))),FR("width",n("width")||0),FR("height",n("height")||0)],i=r.reduce(((e,t)=>(e[t.name]=t,e)),{}),a={};return He(e.signals).forEach((e=>{ot(i,e.name)?e=rt(i[e.name],e):r.push(e),a[e.name]=e})),He(t.signals).forEach((e=>{ot(a,e.name)||ot(i,e.name)||r.push(e)})),r}(e,n);i.forEach((e=>DT(e,t))),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const a=t.add(rO()),s=t.add(sO(CT((e=>hT({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e))(e.encode),oM,gT,e.style,t,{pulse:OT(a)}))),o=t.add(AO({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:r,pulse:OT(s)}));t.operators.pop(),t.pushState(OT(s),OT(o),null),ER(e,t,i),t.operators.push(o);let u=t.add(nO({mark:r,pulse:OT(o)}));return u=t.add(kO({pulse:OT(u)})),u=t.add(SO({pulse:OT(u)})),t.addData("root",new XM(t,a,a,u)),t}(e,new IR(t,n)).toRuntime()}IR.prototype=DR.prototype={parse(e){return ER(e,this)},fork(){return new DR(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach((t=>{t.$ref=e.id})),e.refs=null),e},proxy(e){const t=e instanceof NT?OT(e):e;return this.add(xO({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(e,t,n){let r,i;e&&(r=e.data||(e.data={}),i=r[t]||(r[t]=[]),i.push(n))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const r in t.index)n(t.index[r],e,"index:"+r)}return this},pushState(e,t,n){this._encode.push(OT(this.add(SO({pulse:e})))),this._parent.push(t),this._lookup.push(n?OT(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return Fe(this._parent)},encode(){return Fe(this._encode)},lookup(){return Fe(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(vt(e))return MT(e,t);e.signal||se("Unsupported field reference: "+At(e));const n=e.signal;let r=this.field[n];if(!r){const e={name:this.signalRef(n)};t&&(e.as=t),this.field[n]=r=OT(this.add(lO(e)))}return r},compareRef(e){let t=!1;const n=e=>jT(e)?(t=!0,this.signalRef(e.signal)):function(e){return e&&e.expr}(e)?(t=!0,this.exprRef(e.expr)):e,r=He(e.field).map(n),i=He(e.order).map(n);return t?OT(this.add(iO({fields:r,orders:i}))):BT(r,i)},keyRef(e,t){let n=!1;const r=this.signals;return e=He(e).map((e=>jT(e)?(n=!0,OT(r[e.signal])):e)),n?OT(this.add(cO({fields:e,flat:t}))):function(e,t){const n={$key:e};return t&&(n.$flat=!0),n}(e,t)},sortRef(e){if(!e)return e;const t=zT(e.op,e.field),n=e.order||"ascending";return n.signal?OT(this.add(iO({fields:t,orders:this.signalRef(n.signal)}))):BT(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const r=this.id();this.streams.push({id:r,source:e,type:t}),this.events[n]=r}return this.events[n]},hasOwnSignal(e){return ot(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&se("Duplicate signal name: "+At(e));const n=t instanceof NT?t:this.add(TT(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||se("Unrecognized signal name: "+At(e)),this.signals[e]},signalRef(e){return this.signals[e]?OT(this.signals[e]):(ot(this.lambdas,e)||(this.lambdas[e]=this.add(TT(null))),OT(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const n=e[t],r=QN(n,this),i=this.lambdas[n];i.params=r.$params,i.update=r.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return e&&_e(e)?this.signalRef(e.signal||NR(e)):e},exprRef(e,t){const n={expr:QN(e,this)};return t&&(n.expr.$name=t),OT(this.add(oO(n)))},addBinding(e,t){this.bindings||se("Nested signals do not support binding: "+At(e)),this.bindings.push(rt({signal:e},t))},addScaleProj(e,t){ot(this.scales,e)&&se("Duplicate scale or projection name: "+At(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,_O(t))},addProjection(e,t){this.addScaleProj(e,bO(t))},getScale(e){return this.scales[e]||se("Unrecognized scale name: "+At(e)),this.scales[e]},scaleRef(e){return OT(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return ot(this.data,e)&&se("Duplicate data set name: "+At(e)),this.data[e]=t},getData(e){return this.data[e]||se("Undefined data set name: "+At(e)),this.data[e]},addDataPipeline(e,t){return ot(this.data,e)&&se("Duplicate data set name: "+At(e)),this.addData(e,XM.fromEntries(this,t))}};function MR(e){this.type=e}var RR,BR,zR,LR,PR;MR.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(t=function(e){switch(e.type){case"ArrayExpression":return e.elements;case"BinaryExpression":case"LogicalExpression":return[e.left,e.right];case"CallExpression":return[e.callee].concat(e.arguments);case"ConditionalExpression":return[e.test,e.consequent,e.alternate];case"MemberExpression":return[e.object,e.property];case"ObjectExpression":return e.properties;case"Property":return[e.key,e.value];case"UnaryExpression":return[e.argument];default:return[]}}(this),n=0,r=t.length;n<r;++n)if(t[n].visit(e))return 1},(RR={})[1]="Boolean",RR[2]="<end>",RR[3]="Identifier",RR[4]="Keyword",RR[5]="Null",RR[6]="Numeric",RR[7]="Punctuator",RR[8]="String",RR[9]="RegularExpression";var jR="Identifier",UR="Unexpected token %0",WR="Invalid regular expression",VR="Invalid regular expression: missing /",GR="Octal literals are not allowed in strict mode.",qR="ILLEGAL",HR="Disabled.",XR=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),KR=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function YR(e,t){if(!e)throw new Error("ASSERT: "+t)}function QR(e){return e>=48&&e<=57}function JR(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function ZR(e){return"01234567".indexOf(e)>=0}function eB(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function tB(e){return 10===e||13===e||8232===e||8233===e}function nB(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&XR.test(String.fromCharCode(e))}function rB(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&KR.test(String.fromCharCode(e))}const iB={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function aB(){for(;zR<LR;){const e=BR.charCodeAt(zR);if(!eB(e)&&!tB(e))break;++zR}}function sB(e){var t,n,r,i=0;for(n="u"===e?4:2,t=0;t<n;++t)zR<LR&&JR(BR[zR])?(r=BR[zR++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):xB({},UR,qR);return String.fromCharCode(i)}function oB(){var e,t,n,r;for(t=0,"}"===(e=BR[zR])&&xB({},UR,qR);zR<LR&&JR(e=BR[zR++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&xB({},UR,qR),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function uB(){var e,t;for(e=BR.charCodeAt(zR++),t=String.fromCharCode(e),92===e&&(117!==BR.charCodeAt(zR)&&xB({},UR,qR),++zR,(e=sB("u"))&&"\\"!==e&&nB(e.charCodeAt(0))||xB({},UR,qR),t=e);zR<LR&&rB(e=BR.charCodeAt(zR));)++zR,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==BR.charCodeAt(zR)&&xB({},UR,qR),++zR,(e=sB("u"))&&"\\"!==e&&rB(e.charCodeAt(0))||xB({},UR,qR),t+=e);return t}function lB(){var e,t,n,r,i=zR,a=BR.charCodeAt(zR),s=BR[zR];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++zR,{type:7,value:String.fromCharCode(a),start:i,end:zR};default:if(61===(e=BR.charCodeAt(zR+1)))switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return zR+=2,{type:7,value:String.fromCharCode(a)+String.fromCharCode(e),start:i,end:zR};case 33:case 61:return zR+=2,61===BR.charCodeAt(zR)&&++zR,{type:7,value:BR.slice(i,zR),start:i,end:zR}}}return">>>="===(r=BR.substr(zR,4))?{type:7,value:r,start:i,end:zR+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:i,end:zR+=3}:s===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(s)>=0||"=>"===t?{type:7,value:t,start:i,end:zR+=2}:("//"===t&&xB({},UR,qR),"<>=!+-*%&|^/".indexOf(s)>=0?{type:7,value:s,start:i,end:++zR}:void xB({},UR,qR))}function cB(){var e,t,n;if(YR(QR((n=BR[zR]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=zR,e="","."!==n){if(e=BR[zR++],n=BR[zR],"0"===e){if("x"===n||"X"===n)return++zR,function(e){let t="";for(;zR<LR&&JR(BR[zR]);)t+=BR[zR++];return 0===t.length&&xB({},UR,qR),nB(BR.charCodeAt(zR))&&xB({},UR,qR),{type:6,value:parseInt("0x"+t,16),start:e,end:zR}}(t);if(ZR(n))return function(e){let t="0"+BR[zR++];for(;zR<LR&&ZR(BR[zR]);)t+=BR[zR++];return(nB(BR.charCodeAt(zR))||QR(BR.charCodeAt(zR)))&&xB({},UR,qR),{type:6,value:parseInt(t,8),octal:!0,start:e,end:zR}}(t);n&&QR(n.charCodeAt(0))&&xB({},UR,qR)}for(;QR(BR.charCodeAt(zR));)e+=BR[zR++];n=BR[zR]}if("."===n){for(e+=BR[zR++];QR(BR.charCodeAt(zR));)e+=BR[zR++];n=BR[zR]}if("e"===n||"E"===n)if(e+=BR[zR++],"+"!==(n=BR[zR])&&"-"!==n||(e+=BR[zR++]),QR(BR.charCodeAt(zR)))for(;QR(BR.charCodeAt(zR));)e+=BR[zR++];else xB({},UR,qR);return nB(BR.charCodeAt(zR))&&xB({},UR,qR),{type:6,value:parseFloat(e),start:t,end:zR}}function dB(){if(aB(),zR>=LR)return{type:2,start:zR,end:zR};const e=BR.charCodeAt(zR);return nB(e)?function(){var e,t;return e=zR,t=92===BR.charCodeAt(zR)?uB():function(){var e,t;for(e=zR++;zR<LR;){if(92===(t=BR.charCodeAt(zR)))return zR=e,uB();if(!rB(t))break;++zR}return BR.slice(e,zR)}(),{type:1===t.length?3:iB.hasOwnProperty(t)?4:"null"===t?5:"true"===t||"false"===t?1:3,value:t,start:e,end:zR}}():40===e||41===e||59===e?lB():39===e||34===e?function(){var e,t,n,r,i="",a=!1;for(YR("'"===(e=BR[zR])||'"'===e,"String literal must starts with a quote"),t=zR,++zR;zR<LR;){if((n=BR[zR++])===e){e="";break}if("\\"===n)if((n=BR[zR++])&&tB(n.charCodeAt(0)))"\r"===n&&"\n"===BR[zR]&&++zR;else switch(n){case"u":case"x":"{"===BR[zR]?(++zR,i+=oB()):i+=sB(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:ZR(n)?(0!==(r="01234567".indexOf(n))&&(a=!0),zR<LR&&ZR(BR[zR])&&(a=!0,r=8*r+"01234567".indexOf(BR[zR++]),"0123".indexOf(n)>=0&&zR<LR&&ZR(BR[zR])&&(r=8*r+"01234567".indexOf(BR[zR++]))),i+=String.fromCharCode(r)):i+=n}else{if(tB(n.charCodeAt(0)))break;i+=n}}return""!==e&&xB({},UR,qR),{type:8,value:i,octal:a,start:t,end:zR}}():46===e?QR(BR.charCodeAt(zR+1))?cB():lB():QR(e)?cB():lB()}function hB(){const e=PR;return zR=e.end,PR=dB(),zR=e.end,e}function fB(){const e=zR;PR=dB(),zR=e}function pB(e,t,n){const r=new MR("||"===e||"&&"===e?"LogicalExpression":"BinaryExpression");return r.operator=e,r.left=t,r.right=n,r}function gB(e,t){const n=new MR("CallExpression");return n.callee=e,n.arguments=t,n}function mB(e){const t=new MR(jR);return t.name=e,t}function yB(e){const t=new MR("Literal");return t.value=e.value,t.raw=BR.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function vB(e,t,n){const r=new MR("MemberExpression");return r.computed="["===e,r.object=t,r.property=n,r.computed||(n.member=!0),r}function bB(e,t,n){const r=new MR("Property");return r.key=t,r.value=n,r.kind=e,r}function xB(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,((e,t)=>(YR(t<r.length,"Message reference must be in range"),r[t])));throw(n=new Error(i)).index=zR,n.description=i,n}function wB(e){2===e.type&&xB(e,"Unexpected end of input"),6===e.type&&xB(e,"Unexpected number"),8===e.type&&xB(e,"Unexpected string"),3===e.type&&xB(e,"Unexpected identifier"),4===e.type&&xB(e,"Unexpected reserved word"),xB(e,UR,e.value)}function kB(e){const t=hB();7===t.type&&t.value===e||wB(t)}function _B(e){return 7===PR.type&&PR.value===e}function SB(e){return 4===PR.type&&PR.value===e}function CB(){zR=PR.start;const e=hB();return 8===e.type||6===e.type?(e.octal&&xB(e,GR),yB(e)):mB(e.value)}function AB(){var e,t,n;return zR=PR.start,3===(e=PR).type?(n=CB(),kB(":"),bB("init",n,OB())):2!==e.type&&7!==e.type?(t=CB(),kB(":"),bB("init",t,OB())):void wB(e)}const EB={if:1};function FB(){var e,t,n;if(_B("("))return function(){kB("(");const e=MB();return kB(")"),e}();if(_B("["))return function(){const e=[];for(zR=PR.start,kB("[");!_B("]");)_B(",")?(hB(),e.push(null)):(e.push(OB()),_B("]")||kB(","));return hB(),function(e){const t=new MR("ArrayExpression");return t.elements=e,t}(e)}();if(_B("{"))return function(){var e,t,n=[],r={},i=String;for(zR=PR.start,kB("{");!_B("}");)t="$"+((e=AB()).key.type===jR?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?xB({},"Duplicate data property in object literal not allowed in strict mode"):r[t]=!0,n.push(e),_B("}")||kB(",");return kB("}"),function(e){const t=new MR("ObjectExpression");return t.properties=e,t}(n)}();if(e=PR.type,zR=PR.start,3===e||EB[PR.value])n=mB(hB().value);else if(8===e||6===e)PR.octal&&xB(PR,GR),n=yB(hB());else{if(4===e)throw new Error(HR);1===e?((t=hB()).value="true"===t.value,n=yB(t)):5===e?((t=hB()).value=null,n=yB(t)):_B("/")||_B("/=")?(n=yB(function(){var e,t,n,r;return PR=null,aB(),e=zR,t=function(){var e,t,n,r;for(YR("/"===(e=BR[zR]),"Regular expression literal must start with a slash"),t=BR[zR++],n=!1,r=!1;zR<LR;)if(t+=e=BR[zR++],"\\"===e)tB((e=BR[zR++]).charCodeAt(0))&&xB({},VR),t+=e;else if(tB(e.charCodeAt(0)))xB({},VR);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||xB({},VR),{value:t.substr(1,t.length-2),literal:t}}(),n=function(){var e,t,n;for(t="",n="";zR<LR&&rB((e=BR[zR]).charCodeAt(0));)++zR,"\\"===e&&zR<LR?xB({},UR,qR):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&xB({},WR,n),{value:n,literal:t}}(),r=function(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,((e,t)=>{if(parseInt(t,16)<=1114111)return"x";xB({},WR)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(e){xB({},WR)}try{return new RegExp(e,t)}catch(e){return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:zR}}()),fB()):wB(hB())}return n}function IB(){const e=[];if(kB("("),!_B(")"))for(;zR<LR&&(e.push(OB()),!_B(")"));)kB(",");return kB(")"),e}function DB(){kB("[");const e=MB();return kB("]"),e}function NB(){const e=function(){var e;for(e=FB();;)if(_B("."))e=vB(".",e,(kB("."),function(){zR=PR.start;const e=hB();return function(e){return 3===e.type||4===e.type||1===e.type||5===e.type}(e)||wB(e),mB(e.value)}()));else if(_B("("))e=gB(e,IB());else{if(!_B("["))break;e=vB("[",e,DB())}return e}();if(7===PR.type&&(_B("++")||_B("--")))throw new Error(HR);return e}function $B(){var e,t;if(7!==PR.type&&4!==PR.type)t=NB();else{if(_B("++")||_B("--"))throw new Error(HR);if(_B("+")||_B("-")||_B("~")||_B("!"))e=hB(),t=$B(),t=function(e,t){const n=new MR("UnaryExpression");return n.operator=e,n.argument=t,n.prefix=!0,n}(e.value,t);else{if(SB("delete")||SB("void")||SB("typeof"))throw new Error(HR);t=NB()}}return t}function TB(e){let t=0;if(7!==e.type&&4!==e.type)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function OB(){var e,t;return e=function(){var e,t,n,r,i,a,s,o,u,l;if(e=PR,u=$B(),0===(i=TB(r=PR)))return u;for(r.prec=i,hB(),t=[e,PR],a=[u,r,s=$B()];(i=TB(PR))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)s=a.pop(),o=a.pop().value,u=a.pop(),t.pop(),n=pB(o,u,s),a.push(n);(r=hB()).prec=i,a.push(r),t.push(PR),n=$B(),a.push(n)}for(n=a[l=a.length-1],t.pop();l>1;)t.pop(),n=pB(a[l-1].value,a[l-2],n),l-=2;return n}(),_B("?")&&(hB(),t=OB(),kB(":"),e=function(e,t,n){const r=new MR("ConditionalExpression");return r.test=e,r.consequent=t,r.alternate=n,r}(e,t,OB())),e}function MB(){const e=OB();if(_B(","))throw new Error(HR);return e}function RB(e){zR=0,LR=(BR=e).length,PR=null,fB();const t=MB();if(2!==PR.type)throw new Error("Unexpect token after expression.");return t}var BB={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function zB(e){function t(t,n,r){return i=>function(t,n,r,i){let a=e(n[0]);return r&&(a=r+"("+a+")",0===r.lastIndexOf("new ",0)&&(a="("+a+")")),a+"."+t+(i<0?"":0===i?"()":"("+n.slice(1).map(e).join(",")+")")}(t,i,n,r)}const n="new Date",r="String",i="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(t){t.length<3&&se("Missing arguments to clamp function."),t.length>3&&se("Too many arguments to clamp function.");const n=t.map(e);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase",r,0),lower:t("toLowerCase",r,0),substring:t("substring",r),split:t("split",r),trim:t("trim",r,0),regexp:i,test:t("test",i),if:function(t){t.length<3&&se("Missing arguments to if function."),t.length>3&&se("Too many arguments to if function.");const n=t.map(e);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}function LB(e){const t=(e=e||{}).allowed?Nt(e.allowed):{},n=e.forbidden?Nt(e.forbidden):{},r=e.constants||BB,i=(e.functions||zB)(d),a=e.globalvar,s=e.fieldvar,o=Ke(a)?a:e=>"".concat(a,'["').concat(e,'"]');let u={},l={},c=0;function d(e){if(vt(e))return e;const t=h[e.type];return null==t&&se("Unsupported type: "+e.type),t(e)}const h={Literal:e=>e.raw,Identifier:e=>{const i=e.name;return c>0?i:ot(n,i)?se("Illegal identifier: "+i):ot(r,i)?r[i]:ot(t,i)?i:(u[i]=1,o(i))},MemberExpression:e=>{const t=!e.computed,n=d(e.object);t&&(c+=1);const r=d(e.property);return n===s&&(l[function(e){const t=e&&e.length-1;return t&&('"'===e[0]&&'"'===e[t]||"'"===e[0]&&"'"===e[t])?e.slice(1,-1):e}(r)]=1),t&&(c-=1),n+(t?"."+r:"["+r+"]")},CallExpression:e=>{"Identifier"!==e.callee.type&&se("Illegal callee type: "+e.callee.type);const t=e.callee.name,n=e.arguments,r=ot(i,t)&&i[t];return r||se("Unrecognized function: "+t),Ke(r)?r(n):r+"("+n.map(d).join(",")+")"},ArrayExpression:e=>"["+e.elements.map(d).join(",")+"]",BinaryExpression:e=>"("+d(e.left)+" "+e.operator+" "+d(e.right)+")",UnaryExpression:e=>"("+e.operator+d(e.argument)+")",ConditionalExpression:e=>"("+d(e.test)+"?"+d(e.consequent)+":"+d(e.alternate)+")",LogicalExpression:e=>"("+d(e.left)+e.operator+d(e.right)+")",ObjectExpression:e=>"{"+e.properties.map(d).join(",")+"}",Property:e=>{c+=1;const t=d(e.key);return c-=1,t+":"+d(e.value)}};function f(e){const t={code:d(e),globals:Object.keys(u),fields:Object.keys(l)};return u={},l={},t}return f.functions=i,f.constants=r,f}const PB=/[[\]{}]/,jB={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let UB,WB;function VB(e,t,n){return UB=t||"view",WB=n||jB,qB(e.trim()).map(HB)}function GB(e,t,n,r,i){const a=e.length;let s,o=0;for(;t<a;++t){if(s=e[t],!o&&s===n)return t;i&&i.indexOf(s)>=0?--o:r&&r.indexOf(s)>=0&&++o}return t}function qB(e){const t=[],n=e.length;let r=0,i=0;for(;i<n;)i=GB(e,i,",","[{","]}"),t.push(e.substring(r,i).trim()),r=++i;if(0===t.length)throw"Empty event selector: "+e;return t}function HB(e){return"["===e[0]?function(e){const t=e.length;let n,r=1;if(r=GB(e,r,"]","[","]"),r===t)throw"Empty between selector: "+e;if(n=qB(e.substring(1,r)),2!==n.length)throw"Between selector must have two elements: "+e;if(">"!==(e=e.slice(r+1).trim())[0])throw"Expected '>' after between selector: "+e;n=n.map(HB);const i=HB(e.slice(1).trim());return i.between?{between:n,stream:i}:(i.between=n,i)}(e):function(e){const t={source:UB},n=[];let r,i,a=[0,0],s=0,o=0,u=e.length,l=0;if("}"===e[u-1]){if(l=e.lastIndexOf("{"),!(l>=0))throw"Unmatched right brace: "+e;try{a=function(e){const t=e.split(",");if(!e.length||t.length>2)throw e;return t.map((t=>{const n=+t;if(n!=n)throw e;return n}))}(e.substring(l+1,u-1))}catch(t){throw"Invalid throttle specification: "+e}u=(e=e.slice(0,l).trim()).length,l=0}if(!u)throw e;if("@"===e[0]&&(s=++l),r=GB(e,l,":"),r<u&&(n.push(e.substring(o,r).trim()),o=l=++r),l=GB(e,l,"["),l===u)n.push(e.substring(o,u).trim());else if(n.push(e.substring(o,l).trim()),i=[],o=++l,o===u)throw"Unmatched left bracket: "+e;for(;l<u;){if(l=GB(e,l,"]"),l===u)throw"Unmatched left bracket: "+e;if(i.push(e.substring(o,l).trim()),l<u-1&&"["!==e[++l])throw"Expected left bracket: "+e;o=++l}if(!(u=n.length)||PB.test(n[u-1]))throw"Invalid event selector: "+e;var c;return u>1?(t.type=n[1],s?t.markname=n[0].slice(1):(c=n[0],WB[c]?t.marktype=n[0]:t.source=n[0])):t.type=n[0],"!"===t.type.slice(-1)&&(t.consume=!0,t.type=t.type.slice(0,-1)),null!=i&&(t.filter=i),a[0]&&(t.throttle=a[0]),a[1]&&(t.debounce=a[1]),t}(e)}rt(mo,a,o,u,l,c,h,d,f,p,g,m);const XB="5.20.0";function KB(e,t,n){return e.fields=t||[],e.fname=n,e}function YB(e){return 1===e.length?QB(e[0]):JB(e)}const QB=e=>function(t){return t[e]},JB=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function ZB(e){throw Error(e)}function ez(e){var t,n,r,i=[],a=null,s=0,o=e.length,u="";function l(){i.push(u+e.substring(t,n)),u="",t=n+1}for(e+="",t=n=0;n<o;++n)if("\\"===(r=e[n]))u+=e.substring(t,n),u+=e.substring(++n,++n),t=n;else if(r===a)l(),a=null,s=-1;else{if(a)continue;t===s&&'"'===r||t===s&&"'"===r?(t=n+1,a=r):"."!==r||s?"["===r?(n>t&&l(),s=t=n+1):"]"===r&&(s||ZB("Access path missing open bracket: "+e),s>0&&l(),s=0,t=n+1):n>t?l():t=n+1}return s&&ZB("Access path missing closing bracket: "+e),a&&ZB("Access path missing closing quote: "+e),n>t&&(n++,l()),i}var tz=[],nz=(function(e,t,n){const r=ez(e);e=1===r.length?r[0]:e,KB(YB(r),[e],e)}("id"),KB((function(e){return e}),tz,"identity"));function rz(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}KB((function(){return 0}),tz,"zero"),KB((function(){return 1}),tz,"one"),KB((function(){return!0}),tz,"true"),KB((function(){return!1}),tz,"false");const iz=Array.isArray;function az(e){return e===Object(e)}const sz=e=>"__proto__"!==e;function oz(...e){return e.reduce(((e,t)=>{for(var n in t)if("signals"===n)e.signals=lz(e.signals,t.signals);else{var r="legend"===n?{layout:1}:"style"===n||null;uz(e,n,t[n],r)}return e}),{})}function uz(e,t,n,r){var i,a;if(sz(t))if(az(n)&&!iz(n))for(i in a=az(e[t])?e[t]:e[t]={},n)r&&(!0===r||r[i])?uz(a,i,n[i]):sz(i)&&(a[i]=n[i]);else e[t]=n}function lz(e,t){if(null==e)return t;const n={},r=[];function i(e){n[e.name]||(n[e.name]=1,r.push(e))}return t.forEach(i),e.forEach(i),r}function cz(e){return null!=e?iz(e)?e:[e]:[]}const dz=Object.prototype.hasOwnProperty;function hz(e,t){return dz.call(e,t)}function fz(e){return"boolean"==typeof e}function pz(e){return"number"==typeof e}function gz(e){return"string"==typeof e}function mz(e){return iz(e)?"["+e.map(mz)+"]":az(e)||gz(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function yz(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=!0;return t}function vz(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Object.create,Object.create,Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,(function(n,r){return Array.isArray(r)?n.push.apply(n,e.call(r,t-1)):n.push(r),n}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var bz=n(16313),xz=n.n(bz),wz=n(64063),kz=n.n(wz),_z=n(35035),Sz=n.n(_z);function Cz(e){return!!e.or}function Az(e){return!!e.and}function Ez(e){return!!e.not}function Fz(e,t){if(Ez(e))Fz(e.not,t);else if(Az(e))for(const n of e.and)Fz(n,t);else if(Cz(e))for(const n of e.or)Fz(n,t);else t(e)}function Iz(e,t){return Ez(e)?{not:Iz(e.not,t)}:Az(e)?{and:e.and.map((e=>Iz(e,t)))}:Cz(e)?{or:e.or.map((e=>Iz(e,t)))}:t(e)}const Dz=kz(),Nz=xz();function $z(e,t){const n={};for(const r of t)hz(e,r)&&(n[r]=e[r]);return n}function Tz(e,t){const n=Object.assign({},e);for(const e of t)delete n[e];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map((e=>Sz()(e))).join(",")})`};const Oz=Sz();function Mz(e){if(pz(e))return e;const t=gz(e)?e:Sz()(e);if(t.length<250)return t;let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n&=n;return n}function Rz(e){return!1===e||null===e}function Bz(e,t){return e.indexOf(t)>-1}function zz(e,t){let n=0;for(const[r,i]of e.entries())if(t(i,r,n++))return!0;return!1}function Lz(e,t){let n=0;for(const[r,i]of e.entries())if(!t(i,r,n++))return!1;return!0}function Pz(e,t){for(const n of qz(t))uz(e,n,t[n],!0)}function jz(e,t){const n=[],r={};let i;for(const a of e)i=t(a),i in r||(r[i]=1,n.push(a));return n}function Uz(e,t){for(const n of e)if(t.has(n))return!0;return!1}function Wz(e){const t=new Set;for(const n of e){const e=ez(n).map(((e,t)=>0===t?e:`[${e}]`)),r=e.map(((t,n)=>e.slice(0,n+1).join("")));for(const e of r)t.add(e)}return t}function Vz(e,t){return void 0===e||void 0===t||Uz(Wz(e),Wz(t))}function Gz(e){return 0===qz(e).length}const qz=Object.keys,Hz=Object.values;function Xz(e){const t=[];for(const n in e)hz(e,n)&&t.push({key:n,value:e[n]});return t}function Kz(e){return!0===e||!1===e}function Yz(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function Qz(e,t){return Ez(e)?"!("+Qz(e.not,t)+")":Az(e)?"("+e.and.map((e=>Qz(e,t))).join(") && (")+")":Cz(e)?"("+e.or.map((e=>Qz(e,t))).join(") || (")+")":t(e)}function Jz(e,t){if(0===t.length)return!0;const n=t.shift();return n in e&&Jz(e[n],t)&&delete e[n],Gz(e)}function Zz(e){return e.charAt(0).toUpperCase()+e.substr(1)}function eL(e,t="datum"){const n=ez(e),r=[];for(let e=1;e<=n.length;e++){const i=`[${n.slice(0,e).map(mz).join("][")}]`;r.push(`${t}${i}`)}return r.join(" && ")}function tL(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function nL(e){return`${ez(e).map(tL).join("\\.")}`}function rL(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function iL(e){return`${ez(e).join(".")}`}function aL(e){return e?ez(e).length:0}function sL(...e){for(const t of e)if(void 0!==t)return t}let oL=42;function uL(e){if(void 0!==e)return(e%360+360)%360}function lL(e){return!!pz(e)||!isNaN(e)&&!isNaN(parseFloat(e))}const cL={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDash"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDash"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function dL(e){return e&&e.condition}const hL=["domain","grid","labels","ticks","title"],fL={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},pL={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},gL=Object.assign(Object.assign({},pL),{style:1,labelExpr:1,encoding:1});function mL(e){return!!gL[e]}qz(gL);const yL={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},vL=yL.arc,bL=yL.area,xL=yL.bar,wL=yL.image,kL=yL.line,_L=yL.point,SL=yL.rect,CL=yL.rule,AL=yL.text,EL=yL.tick,FL=yL.trail,IL=yL.circle,DL=yL.square,NL=yL.geoshape;function $L(e){return Bz(["line","area","trail"],e)}function TL(e){return Bz(["rect","bar","image","arc"],e)}const OL=qz(yL);function ML(e){return e.type}yz(OL);const RL=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit","fill","fillOpacity"],BL=qz({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1}),zL={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]};function LL(e){return"mark"in e}class PL{constructor(e,t){this.name=e,this.run=t}hasMatchingType(e){return!!LL(e)&&function(e){return ML(e)?e.type:e}(e.mark)===this.name}}const jL={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},UL={count:1,min:1,max:1};function WL(e){return!!e&&!!e.argmin}function VL(e){return!!e&&!!e.argmax}function GL(e){return gz(e)&&!!jL[e]}qz(jL);const qL=["count","valid","missing","distinct"];function HL(e){return gz(e)&&Bz(qL,e)}const XL=["count","sum","distinct","valid","missing"],KL=yz(["mean","average","median","q1","q3","min","max"]),YL="row",QL="column",JL="facet",ZL="x",eP="y",tP="x2",nP="y2",rP="radius",iP="radius2",aP="theta",sP="theta2",oP="latitude",uP="longitude",lP="latitude2",cP="longitude2",dP="color",hP="fill",fP="stroke",pP="shape",gP="size",mP="angle",yP="opacity",vP="fillOpacity",bP="strokeOpacity",xP="strokeWidth",wP="strokeDash",kP="text",_P="order",SP="detail",CP="key",AP="tooltip",EP="href",FP="url",IP="description",DP={theta:1,theta2:1,radius:1,radius2:1};function NP(e){return e in DP}const $P={longitude:1,longitude2:1,latitude:1,latitude2:1},TP=qz($P),OP=Object.assign(Object.assign(Object.assign(Object.assign({},{x:1,y:1,x2:1,y2:1}),DP),$P),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function MP(e){return e===dP||e===hP||e===fP}const RP={row:1,column:1,facet:1},BP=qz(RP),zP=Object.assign(Object.assign({},OP),RP),LP=qz(zP),{order:PP,detail:jP,tooltip:UP}=zP,WP=vz(zP,["order","detail","tooltip"]),{row:VP,column:GP,facet:qP}=WP,HP=vz(WP,["row","column","facet"]);function XP(e){return!!zP[e]}qz(WP),qz(HP);const KP=[tP,nP,lP,cP,sP,iP];function YP(e){return QP(e)!==e}function QP(e){switch(e){case tP:return ZL;case nP:return eP;case lP:return oP;case cP:return uP;case sP:return aP;case iP:return rP}return e}function JP(e){if(NP(e))switch(e){case aP:return"startAngle";case sP:return"endAngle";case rP:return"outerRadius";case iP:return"innerRadius"}return e}function ZP(e){switch(e){case ZL:return tP;case eP:return nP;case oP:return lP;case uP:return cP;case aP:return sP;case rP:return iP}}function ej(e){switch(e){case ZL:case tP:return"width";case eP:case nP:return"height"}}qz(OP);const{x:tj,y:nj,x2:rj,y2:ij,latitude:aj,longitude:sj,latitude2:oj,longitude2:uj,theta:lj,theta2:cj,radius:dj,radius2:hj}=OP,fj=vz(OP,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),pj=qz(fj),gj={x:1,y:1},mj=qz(gj);function yj(e){return e in gj}const vj={theta:1,radius:1},bj=qz(vj);function xj(e){return"width"===e?ZL:eP}const{text:wj,tooltip:kj,href:_j,url:Sj,description:Cj,detail:Aj,key:Ej,order:Fj}=fj,Ij=vz(fj,["text","tooltip","href","url","description","detail","key","order"]),Dj=qz(Ij),Nj=Object.assign(Object.assign(Object.assign({},gj),vj),Ij),$j=qz(Nj);function Tj(e){return!!Nj[e]}const Oj={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},{geoshape:Mj}=Oj,Rj=vz(Oj,["geoshape"]);function Bj(e){switch(e){case ZL:case eP:case aP:case rP:case gP:case mP:case xP:case yP:case vP:case bP:case tP:case nP:case sP:case iP:return;case JL:case YL:case QL:case pP:case wP:case kP:case AP:case EP:case FP:case IP:return"discrete";case dP:case hP:case fP:return"flexible";case oP:case uP:case lP:case cP:case SP:case CP:case _P:return}}function zj(e){return fz(e)&&(e=GV(e,void 0)),"bin"+qz(e).map((t=>Uj(e[t])?Yz(`_${t}_${Object.entries(e[t])}`):Yz(`_${t}_${e[t]}`))).join("")}function Lj(e){return!0===e||jj(e)&&!e.binned}function Pj(e){return"binned"===e||jj(e)&&!0===e.binned}function jj(e){return az(e)}function Uj(e){return null==e?void 0:e.selection}function Wj(e){switch(e){case YL:case QL:case gP:case dP:case hP:case fP:case xP:case yP:case vP:case bP:case pP:return 6;case wP:return 4;default:return 10}}function Vj(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}function Gj(e){return("width"==e?"Width":"Height")+' "container" only works for single views and layered views.'}function qj(e){return`${"width"==e?"Width":"Height"} "container" only works well with autosize "fit" or "fit-${"width"==e?"x":"y"}".`}function Hj(e){return e?`Dropping "fit-${e}" because spec has discrete ${ej(e)}.`:'Dropping "fit" because spec has discrete size.'}function Xj(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function Kj(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function Yj(e){return`Selection not supported for ${e} yet.`}function Qj(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}function Jj(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}function Zj(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function eU(e){return`Invalid field type "${e}".`}function tU(e,t){const{fill:n,stroke:r}=t;return`Dropping color ${e} as the plot also has ${n&&r?"fill and stroke":n?"fill":"stroke"}.`}function nU(e,t){return`Dropping ${Oz(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}function rU(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function iU(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function aU(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${"ordinal"===t?"order":"magnitude"}.`}function sU(e){return`Using unaggregated domain with raw field has no effect (${Oz(e)}).`}function oU(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function uU(e){return`Unaggregated domain is currently unsupported for log scale (${Oz(e)}).`}function lU(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function cU(e){return`The step for "${e}" is dropped because the ${"width"===e?"x":"y"} is continuous.`}const dU="Domains that should be unioned has conflicting sort properties. Sort will be set to true.";function hU(e,t){return`Invalid ${e}: ${Oz(t)}.`}function fU(e){return`1D error band does not support ${e}.`}function pU(e){return`Channel ${e} is required for "binned" bin.`}const gU=(mU=2,{level:function(e){return arguments.length?(mU=+e,this):mU},error:function(){return mU>=1&&rz("error","ERROR",arguments),this},warn:function(){return mU>=2&&rz("warn","WARN",arguments),this},info:function(){return mU>=3&&rz("log","INFO",arguments),this},debug:function(){return mU>=4&&rz("log","DEBUG",arguments),this}});var mU;let yU=gU;function vU(...e){yU.warn(...e)}function bU(e){if(e&&az(e))for(const t of EU)if(t in e)return!0;return!1}const xU=["january","february","march","april","may","june","july","august","september","october","november","december"],wU=xU.map((e=>e.substr(0,3))),kU=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],_U=kU.map((e=>e.substr(0,3)));function SU(e,t){const n=[];if(t&&void 0!==e.day&&qz(e).length>1&&(vU(function(e){return`Dropping day from datetime ${Oz(e)} as day cannot be combined with other units.`}(e)),delete(e=Nz(e)).day),void 0!==e.year?n.push(e.year):n.push(2012),void 0!==e.month){const r=t?function(e){if(lL(e)&&(e=+e),pz(e))return e-1;{const t=e.toLowerCase(),n=xU.indexOf(t);if(-1!==n)return n;const r=t.substr(0,3),i=wU.indexOf(r);if(-1!==i)return i;throw new Error(hU("month",e))}}(e.month):e.month;n.push(r)}else if(void 0!==e.quarter){const r=t?function(e){if(lL(e)&&(e=+e),pz(e))return e>4&&vU(hU("quarter",e)),e-1;throw new Error(hU("quarter",e))}(e.quarter):e.quarter;n.push(pz(r)?3*r:r+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){const r=t?function(e){if(lL(e)&&(e=+e),pz(e))return e%7;{const t=e.toLowerCase(),n=kU.indexOf(t);if(-1!==n)return n;const r=t.substr(0,3),i=_U.indexOf(r);if(-1!==i)return i;throw new Error(hU("day",e))}}(e.day):e.day;n.push(pz(r)?r+1:r+"+1")}else n.push(1);for(const t of["hours","minutes","seconds","milliseconds"]){const r=e[t];n.push(void 0===r?0:r)}return n}function CU(e){const t=SU(e,!0).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}const AU={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},EU=qz(AU);function FU(e){return e.startsWith("utc")}const IU={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function DU(e){const t=[];for(const n of EU)NU(e,n)&&t.push(n);return t}function NU(e,t){const n=e.indexOf(t);return!(n<0||n>0&&"seconds"===t&&"i"===e.charAt(n-1)||e.length>n+3&&"day"===t&&"o"===e.charAt(n+3)||n>0&&"year"===t&&"f"===e.charAt(n-1))}function $U(e){if(!e)return;const t=DU(e);return`timeUnitSpecifier(${Sz()(t)}, ${Sz()(IU)})`}function TU(e){if(!e)return;let t;return gz(e)?t={unit:e}:az(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),FU(t.unit)&&(t.utc=!0,t.unit=t.unit.substr(3)),t}function OU(e){return e&&!!e.signal}function MU(e){return!!e.step}function RU(e){return!iz(e)&&"field"in e&&"data"in e}const BU=qz({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1}),zU={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},LU=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function PU(e){return e&&!!e.field&&void 0!==e.equal}function jU(e){return e&&!!e.field&&void 0!==e.lt}function UU(e){return e&&!!e.field&&void 0!==e.lte}function WU(e){return e&&!!e.field&&void 0!==e.gt}function VU(e){return e&&!!e.field&&void 0!==e.gte}function GU(e){if(e&&e.field){if(iz(e.range)&&2===e.range.length)return!0;if(OU(e.range))return!0}return!1}function qU(e){return e&&!!e.field&&(iz(e.oneOf)||iz(e.in))}function HU(e){return qU(e)||PU(e)||GU(e)||jU(e)||WU(e)||UU(e)||VU(e)}function XU(e,t){return XV(e,{timeUnit:t,wrapTime:!0})}function KU(e,t=!0){var n;const{field:r}=e,i=null===(n=TU(e.timeUnit))||void 0===n?void 0:n.unit,a=i?"time("+function(e,t,{end:n}={end:!1}){const r=eL(t),i=FU(e)?"utc":"";let a;const s={};for(const t of EU)NU(e,t)&&(s[t]="quarter"===(o=t)?`(${i}quarter(${r})-1)`:`${i}${o}(${r})`,a=t);var o;return n&&(s[a]+="+1"),function(e){const t=SU(e,!1).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}(s)}(i,r)+")":DV(e,{expr:"datum"});if(PU(e))return a+"==="+XU(e.equal,i);if(jU(e))return`${a}<${XU(e.lt,i)}`;if(WU(e))return`${a}>${XU(e.gt,i)}`;if(UU(e))return`${a}<=${XU(e.lte,i)}`;if(VU(e))return`${a}>=${XU(e.gte,i)}`;if(qU(e))return`indexof([${function(e,t){return e.map((e=>XU(e,t)))}(e.oneOf,i).join(",")}], ${a}) !== -1`;if(function(e){return e&&!!e.field&&void 0!==e.valid}(e))return YU(a,e.valid);if(GU(e)){const{range:n}=e,r=OU(n)?{signal:`${n.signal}[0]`}:n[0],s=OU(n)?{signal:`${n.signal}[1]`}:n[1];if(null!==r&&null!==s&&t)return"inrange("+a+", ["+XU(r,i)+", "+XU(s,i)+"])";const o=[];return null!==r&&o.push(`${a} >= ${XU(r,i)}`),null!==s&&o.push(`${a} <= ${XU(s,i)}`),o.length>0?o.join(" && "):"true"}throw new Error(`Invalid field predicate: ${JSON.stringify(e)}`)}function YU(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function QU(e){var t;return HU(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:null===(t=TU(e.timeUnit))||void 0===t?void 0:t.unit}):e}const JU={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},ZU=JU.quantitative,eW=JU.ordinal,tW=JU.temporal,nW=JU.nominal,rW=JU.geojson,iW=qz(JU),aW="linear",sW="time",oW="utc",uW="point",lW={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},cW=qz(lW);function dW(e,t){const n=lW[e],r=lW[t];return n===r||"ordinal-position"===n&&"time"===r||"ordinal-position"===r&&"time"===n}const hW={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function fW(e){return hW[e]}const pW=["linear","log","pow","sqrt","symlog","time","utc"],gW=yz(pW),mW=yz(["linear","log","pow","sqrt","symlog"]),yW=yz(["quantile","quantize","threshold"]),vW=yz(pW.concat(["quantile","quantize","threshold","sequential","identity"])),bW=yz(["ordinal","bin-ordinal","point","band"]);function xW(e){return e in bW}function wW(e){return e in vW}function kW(e){return e in gW}function _W(e){return e in yW}function SW(e){return null==e?void 0:e.selection}const CW={type:1,domain:1,domainMid:1,align:1,range:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},{type:AW,domain:EW,range:FW,scheme:IW}=(qz(CW),CW),DW=vz(CW,["type","domain","range","scheme"]),NW=qz(DW);function $W(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!Bz(["point","band","identity"],e);case"bins":return!Bz(["point","band","identity","ordinal"],e);case"round":return kW(e)||"band"===e||"point"===e;case"padding":return kW(e)||Bz(["point","band"],e);case"paddingOuter":case"align":return Bz(["point","band"],e);case"paddingInner":return"band"===e;case"domainMid":case"clamp":return kW(e);case"nice":return kW(e)||"quantize"===e||"threshold"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"constant":return"symlog"===e;case"zero":return wW(e)&&!Bz(["log","time","utc","threshold","quantile"],e)}}function TW(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return MP(e)?void 0:`Cannot use the scale property "${e}" with non-color channel.`;case"align":case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"reverse":case"round":case"clamp":case"zero":return}}function OW(e,t){return Bz([eW,nW],t)?void 0===e||xW(e):t===tW?Bz([sW,oW,void 0],e):t!==ZU||Bz(["log","pow","sqrt","symlog","quantile","quantize","threshold",aW,void 0],e)}function MW(e,t){if(!Tj(e))return!1;switch(e){case ZL:case eP:case aP:case rP:return kW(t)||Bz(["band","point"],t);case gP:case xP:case yP:case vP:case bP:case mP:return kW(t)||_W(t)||Bz(["band","point","ordinal"],t);case dP:case hP:case fP:return"band"!==t;case wP:return"ordinal"===t||_W(t);case pP:return"ordinal"===t}}function RW(e,t){return e+"_"+t}function BW(e){const{channel:t,channelDef:n,markDef:r,scale:i,config:a}=e,s=WW(e);return vV(n)&&!HL(n.aggregate)&&i&&kW(i.get("type"))&&!1===i.get("zero")?zW({fieldDef:n,channel:t,markDef:r,ref:s,config:a}):s}function zW({fieldDef:e,channel:t,markDef:n,ref:r,config:i}){return $L(n.type)||null===rG("invalid",n,i)?r:[LW(e,t),r]}function LW(e,t){const n=PW(e,!0),r="y"===QP(t)?{field:{group:"height"}}:{value:0};return Object.assign({test:n},r)}function PW(e,t=!0){return YU(gz(e)?e:DV(e,{expr:"datum"}),!t)}function jW(e,t,n,r){const i={};if(t&&(i.scale=t),xV(e)){const{datum:t}=e;bU(t)?i.signal=CU(t):OU(t)?i.signal=t.signal:i.value=t}else i.field=DV(e,n);if(r){const{offset:e,band:t}=r;e&&(i.offset=e),t&&(i.band=t)}return i}function UW({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:r,startSuffix:i,band:a=.5}){const s=0<a&&a<1?"datum":void 0,o=DV(t,{expr:s,suffix:i}),u=void 0!==n?DV(n,{expr:s}):DV(t,{suffix:"end",expr:s}),l={};if(0===a||1===a){l.scale=e;const t=0===a?o:u;l.field=t}else{const t=`${a} * ${o} + ${1-a} * ${u}`;l.signal=`scale("${e}", ${t})`}return r&&(l.offset=r),l}function WW({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:a,scale:s,stack:o,offset:u,defaultRef:l,band:c}){var d;if(t){if(_V(t)){if(SV(t)){c=null!=c?c:fV({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:o,config:i,isMidPoint:!0});const{bin:s,timeUnit:l,type:d}=t;if(Lj(s)||c&&l&&d===tW)return o&&o.impute?jW(t,a,{binSuffix:"mid"},{offset:u}):c?UW({scaleName:a,fieldOrDatumDef:t,band:c,offset:u}):jW(t,a,YV(t,e)?{binSuffix:"range"}:{},{offset:u});if(Pj(s)){if(vV(n))return UW({scaleName:a,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:c,offset:u});vU(pU(e===ZL?tP:nP))}}const l=null==s?void 0:s.get("type");return jW(t,a,xW(l)?{binSuffix:"range"}:{},{offset:u,band:"band"===l?null!==(d=null!=c?c:t.band)&&void 0!==d?d:.5:void 0})}if(CV(t)){const n=t.value,r=u?{offset:u}:{};return Object.assign(Object.assign({},VW(e,n)),r)}}return"function"==typeof l&&(l=l()),l?Object.assign(Object.assign({},l),u?{offset:u}:{}):l}function VW(e,t){return Bz(["x","x2"],e)&&"width"===t?{field:{group:"width"}}:Bz(["y","y2"],e)&&"height"===t?{field:{group:"height"}}:ZV(t)}function GW(e){return e&&"number"!==e&&"time"!==e}function qW(e,t,n){return`${e}(${t}${n?`, ${JSON.stringify(n)}`:""})`}function HW({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:a}){var s,o;if(GW(n))return KW({fieldOrDatumDef:e,format:t,formatType:n,expr:r,config:a});const u=XW(e,r,i);if(HV(e)){const n=function(e,t,n,r,i){return!t||n?`${i?"utc":"time"}Format(${e}, '${n=gz(n)?n:r}')`:function(e,t,n){if(!e)return;const r=$U(e);return`${n||FU(e)?"utc":"time"}Format(${t}, ${r})`}(t,e,i)}(u,vV(e)?null===(s=TU(e.timeUnit))||void 0===s?void 0:s.unit:void 0,t,a.timeFormat,AV(e)&&(null===(o=e.scale)||void 0===o?void 0:o.type)===oW);return n?{signal:n}:void 0}return t=JW(bV(e),t,a),vV(e)&&Lj(e.bin)?{signal:tV(u,DV(e,{expr:r,binSuffix:"end"}),t,n,a)}:t||"quantitative"===bV(e)?{signal:`${ZW(u,t)}`}:{signal:`isValid(${u}) ? ${u} : ""+${u}`}}function XW(e,t,n){return vV(e)?n?`${DV(e,{expr:t,suffix:"end"})}-${DV(e,{expr:t,suffix:"start"})}`:DV(e,{expr:t}):function(e){const{datum:t}=e;return bU(t)?CU(t):`${JSON.stringify(t)}`}(e)}function KW({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:a,field:s}){return s=null!=s?s:XW(e,r,i),vV(e)&&Lj(e.bin)?{signal:tV(s,DV(e,{expr:r,binSuffix:"end"}),t,n,a)}:{signal:qW(n,s,t)}}function YW(e,t,n,r,i,a){var s;if(!GW(r))return HV(e)?function(e,t,n,r){return e||(t?{signal:$U(t)}:r?void 0:n.timeFormat)}(n,vV(e)?null===(s=TU(e.timeUnit))||void 0===s?void 0:s.unit:void 0,i,a):JW(t,n,i)}function QW(e,t,n){return e&&(OU(e)||"number"===e||"time"===e)?e:HV(t)&&"time"!==n&&"utc"!==n?"time":void 0}function JW(e,t,n){return gz(t)?t:e===ZU?n.numberFormat:void 0}function ZW(e,t){return`format(${e}, "${t||""}")`}function eV(e,t,n,r){var i;return GW(n)?qW(n,e,t):ZW(e,null!==(i=gz(t)?t:void 0)&&void 0!==i?i:r.numberFormat)}function tV(e,t,n,r,i){const a=eV(e,n,r,i),s=eV(t,n,r,i);return`${YU(e,!1)} ? "null" : ${a} + "  " + ${s}`}!function(){var e;const t={};for(const n of LP)for(const r of iW)for(const i of cW){const a=RW(n,r);MW(n,i)&&OW(i,r)&&(t[a]=null!==(e=t[a])&&void 0!==e?e:[],t[a].push(i))}}();const nV="min",rV={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function iV(e){return e in rV}function aV(e){return!!e&&!!e.encoding}function sV(e){return!(!e||"count"!==e.op&&!e.field)}function oV(e){return!!e&&iz(e)}function uV(e){return"row"in e||"column"in e}function lV(e){return!!e&&"header"in e}function cV(e){return"facet"in e}function dV(e){const{field:t,timeUnit:n,bin:r,aggregate:i}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),r?{bin:r}:{}),i?{aggregate:i}:{}),{field:t})}function hV(e){return SV(e)&&"sort"in e}function fV({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:i,config:a,isMidPoint:s}){if(_V(t)&&void 0!==t.band)return t.band;if(vV(t)){const{timeUnit:e,bin:i}=t;if(e&&!n)return s?iG("timeUnitBandPosition",r,a):TL(r.type)?iG("timeUnitBand",r,a):0;if(Lj(i))return TL(r.type)&&!s?1:.5}return(null==i?void 0:i.fieldChannel)===e&&s?.5:void 0}function pV(e,t,n,r,i,a){return!!(Lj(t.bin)||t.timeUnit&&SV(t)&&"temporal"===t.type)&&!!fV({channel:e,fieldDef:t,fieldDef2:n,stack:r,markDef:i,config:a})}function gV(e){return!!e&&"condition"in e}function mV(e){const t=e&&e.condition;return!!t&&!iz(t)&&vV(t)}function yV(e){const t=e&&e.condition;return!!t&&!iz(t)&&_V(t)}function vV(e){return!(!e||!e.field&&"count"!==e.aggregate)}function bV(e){return e&&e.type}function xV(e){return!!e&&"datum"in e}function wV(e){return SV(e)&&$V(e)||kV(e)}function kV(e){return xV(e)&&pz(e.datum)}function _V(e){return vV(e)||xV(e)}function SV(e){return!!e&&("field"in e&&"type"in e||"count"===e.aggregate)}function CV(e){return e&&"value"in e&&"value"in e}function AV(e){return!!e&&("scale"in e||"sort"in e)}function EV(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function FV(e){return!!e&&"legend"in e}function IV(e){return!!e&&("format"in e||"formatType"in e)}function DV(e,t={}){var n,r,i;let a=e.field;const s=t.prefix;let o=t.suffix,u="";if(function(e){return"count"===e.aggregate}(e))a=function(e){return 0===e.indexOf("__")}(l="count")?l:"__count";else{let s;if(!t.nofn)if(function(e){return"op"in e}(e))s=e.op;else{const{bin:l,aggregate:c,timeUnit:d}=e;Lj(l)?(s=zj(l),o=(null!==(n=t.binSuffix)&&void 0!==n?n:"")+(null!==(r=t.suffix)&&void 0!==r?r:"")):c?VL(c)?(u=`["${a}"]`,a=`argmax_${c.argmax}`):WL(c)?(u=`["${a}"]`,a=`argmin_${c.argmin}`):s=String(c):d&&(s=function(e){const t=TU(e),{utc:n}=t,r=vz(t,["utc"]);return r.unit?(n?"utc":"")+qz(r).map((e=>Yz(`${"unit"===e?"":`_${e}_`}${r[e]}`))).join(""):(n?"utc":"")+"timeunit"+qz(r).map((e=>Yz(`_${e}_${r[e]}`))).join("")}(d),o=(!Bz(["range","mid"],t.binSuffix)&&t.binSuffix||"")+(null!==(i=t.suffix)&&void 0!==i?i:""))}s&&(a=a?`${s}_${a}`:s)}var l;return o&&(a=`${a}_${o}`),s&&(a=`${s}_${a}`),t.forAs?iL(a):t.expr?function(e,t="datum"){return`${t}[${mz(ez(e).join("."))}]`}(a,t.expr)+u:nL(a)+u}function NV(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return vV(e)&&!!e.bin;case"temporal":return!1}throw new Error(eU(e.type))}function $V(e){return!NV(e)}const TV=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return function(e){const{aggregate:t,bin:n,timeUnit:r,field:i}=e;if(VL(t))return`${i} for argmax(${t.argmax})`;if(WL(t))return`${i} for argmin(${t.argmin})`;const a=TU(r),s=t||(null==a?void 0:a.unit)||(null==a?void 0:a.maxbins)&&"timeunit"||Lj(n)&&"bin";return s?s.toUpperCase()+"("+i+")":i}(e);default:return function(e,t){var n;const{field:r,bin:i,timeUnit:a,aggregate:s}=e;if("count"===s)return t.countTitle;if(Lj(i))return`${r} (binned)`;if(a){const e=null===(n=TU(a))||void 0===n?void 0:n.unit;if(e)return`${r} (${DU(e).join("-")})`}else if(s)return VL(s)?`${r} for max ${s.argmax}`:WL(s)?`${r} for min ${s.argmin}`:`${Zz(s)} of ${r}`;return r}(e,t)}};let OV=TV;function MV(e){OV=e}function RV(e,t,{allowDisabling:n,includeDefault:r=!0}){var i,a;const s=(null!==(i=BV(e))&&void 0!==i?i:{}).title;if(!vV(e))return s;const o=e,u=r?zV(o,t):void 0;return n?sL(s,o.title,u):null!==(a=null!=s?s:o.title)&&void 0!==a?a:u}function BV(e){return EV(e)&&e.axis?e.axis:FV(e)&&e.legend?e.legend:lV(e)&&e.header?e.header:void 0}function zV(e,t){return OV(e,t)}function LV(e){var t;if(IV(e)){const{format:t,formatType:n}=e;return{format:t,formatType:n}}{const n=null!==(t=BV(e))&&void 0!==t?t:{},{format:r,formatType:i}=n;return{format:r,formatType:i}}}function PV(e){return vV(e)?e:mV(e)?e.condition:void 0}function jV(e){return _V(e)?e:yV(e)?e.condition:void 0}function UV(e,t,n){return gz(e)||pz(e)||fz(e)?(vU(function(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${Oz(n)}}.`}(t,gz(e)?"string":pz(e)?"number":"boolean",e)),{value:e}):_V(e)?WV(e,t,n):yV(e)?Object.assign(Object.assign({},e),{condition:WV(e.condition,t,n)}):e}function WV(e,t,n){if(IV(e)){const{format:r,formatType:i}=e,a=vz(e,["format","formatType"]);if(GW(i)&&!n.customFormatTypes)return vU(Zj(t)),WV(a,t,n)}else{const r=EV(e)?"axis":FV(e)?"legend":lV(e)?"header":null;if(r&&e[r]){const i=e[r],{format:a,formatType:s}=i,o=vz(i,["format","formatType"]);if(GW(s)&&!n.customFormatTypes)return vU(Zj(t)),WV(Object.assign(Object.assign({},e),{[r]:o}),t,n)}}return vV(e)?VV(e,t):function(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=pz(n)?"quantitative":gz(n)?"nominal":bU(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}(e)}function VV(e,t){const{aggregate:n,timeUnit:r,bin:i,field:a}=e,s=Object.assign({},e);if(!n||GL(n)||VL(n)||WL(n)||(vU(function(e){return`Invalid aggregation operator "${e}".`}(n)),delete s.aggregate),r&&(s.timeUnit=TU(r)),a&&(s.field=`${a}`),Lj(i)&&(s.bin=GV(i,t)),Pj(i)&&!yj(t)&&vU(`Channel ${t} should not be used with "binned" bin.`),SV(s)){const{type:e}=s,t=function(e){if(e)switch(e=e.toLowerCase()){case"q":case ZU:return"quantitative";case"t":case tW:return"temporal";case"o":case eW:return"ordinal";case"n":case nW:return"nominal";case rW:return"geojson"}}(e);e!==t&&(s.type=t),"quantitative"!==e&&HL(n)&&(vU(function(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}(e,n)),s.type="quantitative")}else if(!YP(t)){const e=function(e,t){if(e.timeUnit)return"temporal";if(Lj(e.bin))return"quantitative";switch(Bj(t)){case"continuous":default:return"quantitative";case"discrete":case"flexible":return"nominal"}}(s,t);vU(function(e,t){return`Missing type for channel "${e}", using "${t}" instead.`}(t,e)),s.type=e}if(SV(s)){const{compatible:e,warning:n}=function(e,t){const n=e.type;if("geojson"===n&&"shape"!==t)return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case YL:case QL:case JL:return $V(e)?{compatible:!1,warning:iU(t)}:qV;case ZL:case eP:case dP:case hP:case fP:case kP:case SP:case CP:case AP:case EP:case FP:case mP:case aP:case rP:case IP:return qV;case uP:case cP:case oP:case lP:return n!==ZU?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:qV;case yP:case vP:case bP:case xP:case gP:case sP:case iP:case tP:case nP:return"nominal"!==n||e.sort?qV:{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`};case wP:return Bz(["ordinal","nominal"],e.type)?qV:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case pP:return Bz(["ordinal","nominal","geojson"],e.type)?qV:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case _P:return"nominal"!==e.type||"sort"in e?qV:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}(s,t);e||vU(n)}if(hV(s)&&gz(s.sort)){const{sort:e}=s;if(iV(e))return Object.assign(Object.assign({},s),{sort:{encoding:e}});const t=e.substr(1);if("-"===e.charAt(0)&&iV(t))return Object.assign(Object.assign({},s),{sort:{encoding:t,order:"descending"}})}if(lV(s)){const{header:e}=s,{orient:t}=e,n=vz(e,["orient"]);if(t)return Object.assign(Object.assign({},s),{header:Object.assign(Object.assign({},n),{labelOrient:e.labelOrient||t,titleOrient:e.titleOrient||t})})}return s}function GV(e,t){return fz(e)?{maxbins:Wj(t)}:"binned"===e?{binned:!0}:e.maxbins||e.step?e:Object.assign(Object.assign({},e),{maxbins:Wj(t)})}const qV={compatible:!0};function HV(e){const{formatType:t}=LV(e);return"time"===t||!t&&function(e){return e&&("temporal"===e.type||vV(e)&&!!e.timeUnit)}(e)}function XV(e,{timeUnit:t,type:n,wrapTime:r,undefinedIfExprNotRequired:i}){var a;const s=t&&(null===(a=TU(t))||void 0===a?void 0:a.unit);let o,u=s||"temporal"===n;return OU(e)?o=e.signal:bU(e)?(u=!0,o=CU(e)):(gz(e)||pz(e))&&u&&(o=`datetime(${JSON.stringify(e)})`,function(e){return!!AU[e]}(s)&&(pz(e)&&e<1e4||gz(e)&&isNaN(Date.parse(e)))&&(o=CU({[s]:e}))),o?r&&u?`time(${o})`:o:i?void 0:JSON.stringify(e)}function KV(e,t){const{type:n}=e;return t.map((t=>{const r=XV(t,{timeUnit:vV(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return void 0!==r?{signal:r}:t}))}function YV(e,t){return Lj(e.bin)?Tj(t)&&Bz(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}function QV(e){const{anchor:t,frame:n,offset:r,orient:i,color:a,subtitleColor:s,subtitleFont:o,subtitleFontSize:u,subtitleFontStyle:l,subtitleFontWeight:c,subtitleLineHeight:d,subtitlePadding:h}=e,f=vz(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},f),a?{fill:a}:{}),g=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),r?{offset:r}:{}),i?{orient:i}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},s?{subtitleColor:s}:{}),o?{subtitleFont:o}:{}),u?{subtitleFontSize:u}:{}),l?{subtitleFontStyle:l}:{}),c?{subtitleFontWeight:c}:{}),d?{subtitleLineHeight:d}:{}),h?{subtitlePadding:h}:{});return{titleMarkConfig:p,subtitleMarkConfig:$z(p,["align","baseline","dx","dy","limit"]),nonMark:g,subtitle:m}}function JV(e){return gz(e)||iz(e)&&gz(e[0])}function ZV(e){return OU(e)?e:void 0!==e?{value:e}:void 0}function eG(e){return OU(e)?e.signal:mz(e.value)}function tG(e){return OU(e)?e.signal:null==e?null:mz(e)}function nG(e){var t;return[].concat(e.type,null!==(t=e.style)&&void 0!==t?t:[])}function rG(e,t,n,r={}){const{vgChannel:i,ignoreVgConfig:a}=r;return i&&void 0!==t[i]?t[i]:void 0!==t[e]?t[e]:!a||i&&i!==e?iG(e,t,n,r):void 0}function iG(e,t,n,{vgChannel:r}={}){return sL(r?aG(e,t,n.style):void 0,aG(e,t,n.style),r?n[t.type][r]:void 0,n[t.type][e],r?n.mark[r]:n.mark[e])}function aG(e,t,n){return sG(e,nG(t),n)}function sG(e,t,n){let r;t=cz(t);for(const i of t){const t=n[i];t&&void 0!==t[e]&&(r=t[e])}return r}function oG(e,t){return cz(e).reduce(((e,n)=>{var r;return e.field.push(DV(n,t)),e.order.push(null!==(r=n.sort)&&void 0!==r?r:"ascending"),e}),{field:[],order:[]})}function uG(e,t){const n=[...e];return t.forEach((e=>{for(const t of n)if(Dz(t,e))return;n.push(e)})),n}function lG(e,t){return Dz(e,t)||!t?e:e?[...cz(e),...cz(t)].join(", "):t}function cG(e,t){const n=e.value,r=t.value;if(null==n||null===r)return{explicit:e.explicit,value:null};if((JV(n)||OU(n))&&(JV(r)||OU(r)))return{explicit:e.explicit,value:lG(n,r)};if(JV(n)||OU(n))return{explicit:e.explicit,value:n};if(JV(r)||OU(r))return{explicit:e.explicit,value:r};if(!(JV(n)||OU(n)||JV(r)||OU(r)))return{explicit:e.explicit,value:uG(n,r)};throw new Error("It should never reach here")}function dG(e,t){const n=e&&e[t];return!!n&&(iz(n)?zz(n,(e=>!!e.field)):vV(n)||mV(n))}function hG(e){return zz(LP,(t=>{if(dG(e,t)){const n=e[t];if(iz(n))return zz(n,(e=>!!e.aggregate));{const e=PV(n);return e&&!!e.aggregate}}return!1}))}function fG(e,t){const n=[],r=[],i=[],a=[],s={};return mG(e,((o,u)=>{if(vV(o)){const{field:l,aggregate:c,bin:d,timeUnit:h}=o,f=vz(o,["field","aggregate","bin","timeUnit"]);if(c||h||d){const e=BV(o),p=e&&e.title;let g=DV(o,{forAs:!0});const m=Object.assign(Object.assign(Object.assign({},p?[]:{title:RV(o,t,{allowDisabling:!0})}),f),{field:g});if(c){let e;if(VL(c)?(e="argmax",g=DV({op:"argmax",field:c.argmax},{forAs:!0}),m.field=`${g}.${l}`):WL(c)?(e="argmin",g=DV({op:"argmin",field:c.argmin},{forAs:!0}),m.field=`${g}.${l}`):"boxplot"!==c&&"errorbar"!==c&&"errorband"!==c&&(e=c),e){const t={op:e,as:g};l&&(t.field=l),a.push(t)}}else if(n.push(g),SV(o)&&Lj(d)){if(r.push({bin:d,field:l,as:g}),n.push(DV(o,{binSuffix:"end"})),YV(o,u)&&n.push(DV(o,{binSuffix:"range"})),yj(u)){const e={field:g+"_end"};s[u+"2"]=e}m.bin="binned",YP(u)||(m.type=ZU)}else if(h){i.push({timeUnit:h,field:l,as:g});const e=SV(o)&&o.type!==tW&&"time";e&&(u===kP||u===AP?m.formatType=e:function(e){return!!fj[e]}(u)?m.legend=Object.assign({formatType:e},m.legend):yj(u)&&(m.axis=Object.assign({formatType:e},m.axis)))}s[u]=m}else n.push(l),s[u]=e[u]}else s[u]=e[u]})),{bins:r,timeUnits:i,aggregate:a,groupby:n,encoding:s}}function pG(e,t,n){const r=t.type;return qz(e).reduce(((i,a)=>{if(!XP(a))return vU(function(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}(a)),i;const s=e[a];if("angle"!==a||"arc"!==r||e.theta||(vU("Arc marks uses theta channel rather than angle, replacing angle with theta."),a=aP),!function(e,t,n){const r=function(e,t){return function(e){switch(e){case dP:case hP:case fP:case IP:case SP:case CP:case AP:case EP:case _P:case yP:case vP:case bP:case xP:case JL:case YL:case QL:return Oj;case ZL:case eP:case oP:case uP:return Rj;case tP:case nP:case lP:case cP:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case gP:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case wP:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case pP:return{point:"always",geoshape:"always"};case kP:return{text:"always"};case mP:return{point:"always",square:"always",text:"always"};case FP:return{image:"always"};case aP:case rP:return{text:"always",arc:"always"};case sP:case iP:return{arc:"always"}}}(e)[t]}(t,n);if(!r)return!1;if("binned"===r){const n=e[t===tP?ZL:eP];return!!(vV(n)&&vV(e[t])&&Pj(n.bin))}return!0}(e,a,r))return vU(rU(a,r)),i;if(a===gP&&"line"===r){const t=PV(e[a]);if(null==t?void 0:t.aggregate)return vU("Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead."),i}if(a===dP&&(t.filled?"fill"in e:"stroke"in e))return vU(tU("encoding",{fill:"fill"in e,stroke:"stroke"in e})),i;if(a===SP||a===_P&&!iz(s)&&!CV(s)||a===AP&&iz(s))s&&(i[a]=cz(s).reduce(((e,t)=>(vV(t)?e.push(VV(t,a)):vU(nU(t,a)),e)),[]));else{if(a===AP&&null===s)i[a]=null;else if(!(vV(s)||xV(s)||CV(s)||gV(s)||OU(s)))return vU(nU(s,a)),i;i[a]=UV(s,a,n)}return i}),{})}function gG(e){const t=[];for(const n of qz(e))if(dG(e,n)){const r=cz(e[n]);for(const e of r)vV(e)?t.push(e):mV(e)&&t.push(e.condition)}return t}function mG(e,t,n){if(e)for(const r of qz(e)){const i=e[r];if(iz(i))for(const e of i)t.call(n,e,r);else t.call(n,i,r)}}function yG(e,t,n,r){return e?qz(e).reduce(((n,i)=>{const a=e[i];return iz(a)?a.reduce(((e,n)=>t.call(r,e,n,i)),n):t.call(r,n,a,i)}),n):n}function vG(e,t){return qz(t).reduce(((n,r)=>{switch(r){case ZL:case eP:case EP:case IP:case FP:case tP:case nP:case aP:case sP:case rP:case iP:case oP:case uP:case lP:case cP:case kP:case pP:case mP:case AP:return n;case _P:if("line"===e||"trail"===e)return n;case SP:case CP:{const e=t[r];if(iz(e)||vV(e))for(const t of cz(e))t.aggregate||n.push(DV(t,{}));return n}case gP:if("trail"===e)return n;case dP:case hP:case fP:case yP:case vP:case bP:case wP:case xP:{const e=PV(t[r]);return e&&!e.aggregate&&n.push(DV(e,{})),n}}}),[])}function bG(e,t,n,r=!0){return"tooltip"in n?{tooltip:n.tooltip}:{tooltip:[...e.map((({fieldPrefix:e,titlePrefix:n})=>{const i=r?` of ${t.field}`:"";return{field:e+t.field,type:t.type,title:OU(n)?{signal:n+`"${escape(i)}"`}:n+i}})),...gG(n)]}}function xG(e){const{axis:t,title:n,field:r}=e;return t&&void 0!==t.title?void 0:sL(n,r)}function wG(e,t,n,r,i){const{scale:a,axis:s}=n;return({partName:o,mark:u,positionPrefix:l,endPositionPrefix:c,aria:d,extraEncoding:h={}})=>{const f=xG(n);return kG(e,o,i,d,{mark:u,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:l+"_"+n.field,type:n.type},void 0!==f?{title:f}:{}),void 0!==a?{scale:a}:{}),void 0!==s?{axis:s}:{})},gz(c)?{[t+"2"]:{field:c+"_"+n.field}}:{}),r),h)})}}function kG(e,t,n,r,i){const{clip:a,color:s,opacity:o}=e,u=e.type;return e[t]||void 0===e[t]&&n[t]?[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),a?{clip:a}:{}),s?{color:s}:{}),o?{opacity:o}:{}),ML(i.mark)?i.mark:{type:i.mark}),{style:`${u}-${t}`}),fz(e[t])?{}:e[t]),!1===r?{aria:r}:{})})]:[]}function _G(e,t,n){const{encoding:r}=e,i="vertical"===t?"y":"x",a=r[i],s=r[i+"2"],o=r[i+"Error"],u=r[i+"Error2"];return{continuousAxisChannelDef:SG(a,n),continuousAxisChannelDef2:SG(s,n),continuousAxisChannelDefError:SG(o,n),continuousAxisChannelDefError2:SG(u,n),continuousAxis:i}}function SG(e,t){if(e&&e.aggregate){const{aggregate:n}=e,r=vz(e,["aggregate"]);return n!==t&&vU(function(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}(n,t)),r}return e}function CG(e,t){const{mark:n,encoding:r}=e,{x:i,y:a}=r;if(wV(i)){if(wV(a)){const e=vV(i)&&i.aggregate,r=vV(a)&&a.aggregate;if(e||r!==t){if(r||e!==t){if(e===t&&r===t)throw new Error("Both x and y cannot have aggregate");return ML(n)&&n.orient?n.orient:"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if(wV(a))return"vertical";throw new Error("Need a valid continuous axis for "+t+"s")}const AG="boxplot",EG=new PL(AG,IG);function FG(e){return pz(e)?"tukey":e}function IG(e,{config:t}){var n,r;const{mark:i,encoding:a,selection:s,projection:o}=e,u=vz(e,["mark","encoding","selection","projection"]),l=ML(i)?i:{type:i};s&&vU(Yj("boxplot"));const c=null!==(n=l.extent)&&void 0!==n?n:t.boxplot.extent,d=rG("size",l,t),h=FG(c),{transform:f,continuousAxisChannelDef:p,continuousAxis:g,groupby:m,aggregate:y,encodingWithoutContinuousAxis:v,ticksOrient:b,boxOrient:x,customTooltipWithoutAggregatedField:w}=function(e,t,n){const r=CG(e,AG),{continuousAxisChannelDef:i,continuousAxis:a}=_G(e,r,AG),s=i.field,o=FG(t),u=[...DG(s),{op:"median",field:s,as:"mid_box_"+s},{op:"min",field:s,as:("min-max"===o?"lower_whisker_":"min_")+s},{op:"max",field:s,as:("min-max"===o?"upper_whisker_":"max_")+s}],l="min-max"===o||"tukey"===o?[]:[{calculate:`datum["upper_box_${s}"] - datum["lower_box_${s}"]`,as:"iqr_"+s},{calculate:`min(datum["upper_box_${s}"] + datum["iqr_${s}"] * ${t}, datum["max_${s}"])`,as:"upper_whisker_"+s},{calculate:`max(datum["lower_box_${s}"] - datum["iqr_${s}"] * ${t}, datum["min_${s}"])`,as:"lower_whisker_"+s}],c=e.encoding,d=a,h=(c[d],vz(c,["symbol"==typeof d?d:d+""])),{customTooltipWithoutAggregatedField:f,filteredEncoding:p}=function(e){const{tooltip:t}=e,n=vz(e,["tooltip"]);if(!t)return{filteredEncoding:e};let r,i;if(iz(t)){for(const e of t)e.aggregate?(r||(r=[]),r.push(e)):(i||(i=[]),i.push(e));r&&(n.tooltip=r)}else t.aggregate?n.tooltip=t:i=t;return iz(i)&&1===i.length&&(i=i[0]),{customTooltipWithoutAggregatedField:i,filteredEncoding:n}}(h),{bins:g,timeUnits:m,aggregate:y,groupby:v,encoding:b}=fG(p,n),x="vertical"===r?"horizontal":"vertical",w=r;return{transform:[...g,...m,{aggregate:[...y,...u],groupby:v},...l],groupby:v,aggregate:y,continuousAxisChannelDef:i,continuousAxis:a,encodingWithoutContinuousAxis:b,ticksOrient:x,boxOrient:w,customTooltipWithoutAggregatedField:f}}(e,c,t),{color:k,size:_}=v,S=vz(v,["color","size"]),C=e=>wG(l,g,p,e,t.boxplot),A=C(S),E=C(v),F=C(Object.assign(Object.assign({},S),_?{size:_}:{})),I=bG([{fieldPrefix:"min-max"===h?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:"min-max"===h?"lower_whisker_":"min_",titlePrefix:"Min"}],p,v),D={type:"tick",color:"black",opacity:1,orient:b,invalid:null},N="min-max"===h?I:bG([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],p,v),$=[...A({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",aria:!1,extraEncoding:N}),...A({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",aria:!1,extraEncoding:N}),...A({partName:"ticks",mark:D,positionPrefix:"lower_whisker",aria:!1,extraEncoding:N}),...A({partName:"ticks",mark:D,positionPrefix:"upper_whisker",aria:!1,extraEncoding:N})],T=[..."tukey"!==h?$:[],...E({partName:"box",mark:Object.assign(Object.assign({type:"bar"},d?{size:d}:{}),{orient:x,invalid:null}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",aria:!1,extraEncoding:I}),...F({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},az(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),d?{size:d}:{}),{orient:b,ariaRoleDescription:"box"}),positionPrefix:"mid_box",extraEncoding:I})];let O;if("min-max"!==h){const e=`datum["lower_box_${p.field}"]`,n=`datum["upper_box_${p.field}"]`,r=`(${n} - ${e})`,i=`${e} - ${c} * ${r}`,a=`${n} + ${c} * ${r}`,s=`datum["${p.field}"]`,o={joinaggregate:DG(p.field),groupby:m};let u;"tukey"===h&&(u={transform:[{filter:`(${i} <= ${s}) && (${s} <= ${a})`},{aggregate:[{op:"min",field:p.field,as:"lower_whisker_"+p.field},{op:"max",field:p.field,as:"upper_whisker_"+p.field},{op:"min",field:"lower_box_"+p.field,as:"lower_box_"+p.field},{op:"max",field:"upper_box_"+p.field,as:"upper_box_"+p.field},...y],groupby:m}],layer:$});const{tooltip:d}=S,f=vz(S,["tooltip"]),{scale:v,axis:b}=p,x=xG(p),k=kG(l,"outliers",t.boxplot,!0,{transform:[{filter:`(${s} < ${i}) || (${s} > ${a})`}],mark:"point",encoding:Object.assign(Object.assign({[g]:Object.assign(Object.assign(Object.assign({field:p.field,type:p.type},void 0!==x?{title:x}:{}),void 0!==v?{scale:v}:{}),void 0!==b?{axis:b}:{})},f),w?{tooltip:w}:{})})[0];k&&u?O={transform:[o],layer:[k,u]}:k?(O=k,O.transform.unshift(o)):u&&(O=u,O.transform.unshift(o))}return O?Object.assign(Object.assign({},u),{layer:[O,{transform:f,layer:T}]}):Object.assign(Object.assign({},u),{transform:(null!==(r=u.transform)&&void 0!==r?r:[]).concat(f),layer:T})}function DG(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}const NG="errorbar",$G=new PL(NG,TG);function TG(e,{config:t}){const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:a,ticksOrient:s,markDef:o,outerSpec:u,tooltipEncoding:l}=OG(e,NG,t),c=wG(o,i,r,a,t.errorbar),d={type:"tick",orient:s},h=[...c({partName:"ticks",mark:d,positionPrefix:"lower",aria:!1,extraEncoding:l}),...c({partName:"ticks",mark:d,positionPrefix:"upper",aria:!1,extraEncoding:l}),...c({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar"},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})];return Object.assign(Object.assign(Object.assign({},u),{transform:n}),h.length>1?{layer:h}:Object.assign({},h[0]))}function OG(e,t,n){var r;const{mark:i,encoding:a,selection:s,projection:o}=e,u=vz(e,["mark","encoding","selection","projection"]),l=ML(i)?i:{type:i};s&&vU(Yj(t));const{orient:c,inputType:d}=function(e,t){const{encoding:n}=e;if(function(e){return(_V(e.x)||_V(e.y))&&!_V(e.x2)&&!_V(e.y2)&&!_V(e.xError)&&!_V(e.xError2)&&!_V(e.yError)&&!_V(e.yError2)}(n))return{orient:CG(e,t),inputType:"raw"};const r=function(e){return _V(e.x2)||_V(e.y2)}(n),i=function(e){return _V(e.xError)||_V(e.xError2)||_V(e.yError)||_V(e.yError2)}(n),a=n.x,s=n.y;if(r){if(i)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const e=n.x2,r=n.y2;if(_V(e)&&_V(r))throw new Error(`${t} cannot have both x2 and y2`);if(_V(e)){if(wV(a))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}if(_V(r)){if(wV(s))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}{const e=n.xError,r=n.xError2,i=n.yError,o=n.yError2;if(_V(r)&&!_V(e))throw new Error(`${t} cannot have xError2 without xError`);if(_V(o)&&!_V(i))throw new Error(`${t} cannot have yError2 without yError`);if(_V(e)&&_V(i))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(_V(e)){if(wV(a))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(_V(i)){if(wV(s))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}(e,t),{continuousAxisChannelDef:h,continuousAxisChannelDef2:f,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:g,continuousAxis:m}=_G(e,c,t),{errorBarSpecificAggregate:y,postAggregateCalculates:v,tooltipSummary:b,tooltipTitleWithFieldName:x}=function(e,t,n,r,i,a,s,o){let u=[],l=[];const c=t.field;let d,h=!1;if("raw"===a){const t=e.center?e.center:e.extent?"iqr"===e.extent?"median":"mean":o.errorbar.center,n=e.extent?e.extent:"mean"===t?"stderr":"iqr";if("median"===t!=("iqr"===n)&&vU(function(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}(t,n,s)),"stderr"===n||"stdev"===n)u=[{op:n,field:c,as:"extent_"+c},{op:t,field:c,as:"center_"+c}],l=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:"upper_"+c},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:"lower_"+c}],d=[{fieldPrefix:"center_",titlePrefix:Zz(t)},{fieldPrefix:"upper_",titlePrefix:MG(t,n,"+")},{fieldPrefix:"lower_",titlePrefix:MG(t,n,"-")}],h=!0;else{let t,r,i;e.center&&e.extent&&vU(function(e,t){return`Center is not needed to be specified in ${t} when extent is ${e}.`}(e.extent,s)),"ci"===n?(t="mean",r="ci0",i="ci1"):(t="median",r="q1",i="q3"),u=[{op:r,field:c,as:"lower_"+c},{op:i,field:c,as:"upper_"+c},{op:t,field:c,as:"center_"+c}],d=[{fieldPrefix:"upper_",titlePrefix:RV({field:c,aggregate:i,type:"quantitative"},o,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:RV({field:c,aggregate:r,type:"quantitative"},o,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:RV({field:c,aggregate:t,type:"quantitative"},o,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&vU(function(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}(e.center,e.extent)),"aggregated-upper-lower"===a?(d=[],l=[{calculate:`datum["${n.field}"]`,as:"upper_"+c},{calculate:`datum["${c}"]`,as:"lower_"+c}]):"aggregated-error"===a&&(d=[{fieldPrefix:"",titlePrefix:c}],l=[{calculate:`datum["${c}"] + datum["${r.field}"]`,as:"upper_"+c}],i?l.push({calculate:`datum["${c}"] + datum["${i.field}"]`,as:"lower_"+c}):l.push({calculate:`datum["${c}"] - datum["${r.field}"]`,as:"lower_"+c}));for(const e of l)d.push({fieldPrefix:e.as.substring(0,6),titlePrefix:rL(rL(e.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:l,errorBarSpecificAggregate:u,tooltipSummary:d,tooltipTitleWithFieldName:h}}(l,h,f,p,g,d,t,n),w=a,k=m,_=(w[k],"x"===m?"x2":"y2"),S=(w[_],"x"===m?"xError":"yError"),C=(w[S],"x"===m?"xError2":"yError2"),A=(w[C],vz(w,["symbol"==typeof k?k:k+"","symbol"==typeof _?_:_+"","symbol"==typeof S?S:S+"","symbol"==typeof C?C:C+""])),{bins:E,timeUnits:F,aggregate:I,groupby:D,encoding:N}=fG(A,n),$=[...I,...y],T="raw"!==d?[]:D,O=bG(b,h,N,x);return{transform:[...null!==(r=u.transform)&&void 0!==r?r:[],...E,...F,...0===$.length?[]:[{aggregate:$,groupby:T}],...v],groupby:T,continuousAxisChannelDef:h,continuousAxis:m,encodingWithoutContinuousAxis:N,ticksOrient:"vertical"===c?"horizontal":"vertical",markDef:l,outerSpec:u,tooltipEncoding:O}}function MG(e,t,n){return Zz(e)+" "+n+" "+t}const RG="errorband",BG=new PL(RG,zG);function zG(e,{config:t}){const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:a,markDef:s,outerSpec:o,tooltipEncoding:u}=OG(e,RG,t),l=s,c=wG(l,i,r,a,t.errorband),d=void 0!==e.encoding.x&&void 0!==e.encoding.y;let h={type:d?"area":"rect"},f={type:d?"line":"rule"};const p=Object.assign(Object.assign({},l.interpolate?{interpolate:l.interpolate}:{}),l.tension&&l.interpolate?{tension:l.tension}:{});return d?(h=Object.assign(Object.assign(Object.assign({},h),p),{ariaRoleDescription:"errorband"}),f=Object.assign(Object.assign({},f),p)):l.interpolate?vU(fU("interpolate")):l.tension&&vU(fU("tension")),Object.assign(Object.assign({},o),{transform:n,layer:[...c({partName:"band",mark:h,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u}),...c({partName:"borders",mark:f,positionPrefix:"lower",aria:!1,extraEncoding:u}),...c({partName:"borders",mark:f,positionPrefix:"upper",aria:!1,extraEncoding:u})]})}const LG={};function PG(e,t,n){const r=new PL(e,t);LG[e]={normalizer:r,parts:n}}PG(AG,IG,["box","median","outliers","rule","ticks"]),PG(NG,TG,["ticks","rule"]),PG(RG,zG,["band","borders"]);const jG=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],UG=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],WG={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},VG={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},GG=(qz(VG),"_vgsid_"),qG={single:{on:"click",fields:[GG],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[GG],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function HG(e){return!(!e||"legend"!==e&&!e.legend)}function XG(e){return HG(e)&&az(e)}function KG(e){return"concat"in e}function YG(e){return"vconcat"in e}function QG(e){return"hconcat"in e}function JG(e){return az(e)&&void 0!==e.step}function ZG(e){return e.view||e.width||e.height}const eq=qz({align:1,bounds:1,center:1,columns:1,spacing:1});function tq(e,t){var n;return null!==(n=e[t])&&void 0!==n?n:e["width"===t?"continuousWidth":"continuousHeight"]}function nq(e,t){const n=rq(e,t);return JG(n)?n.step:iq}function rq(e,t){var n;return sL(null!==(n=e[t])&&void 0!==n?n:e["width"===t?"discreteWidth":"discreteHeight"],{step:e.step})}const iq=20,aq={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:iq},mark:{color:"#4c78a8",invalid:"filter",timeUnitBand:1},arc:{},area:{},bar:{binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},circle:{},geoshape:{},image:{},line:{},point:{},rect:{binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5},rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:qG,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},sq=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],oq={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},uq={blue:sq[0],orange:sq[1],red:sq[2],teal:sq[3],green:sq[4],yellow:sq[5],purple:sq[6],pink:sq[7],brown:sq[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function lq(e={}){const{color:t,font:n,fontSize:r}=e,i=vz(e,["color","font","fontSize"]);return oz({},aq,n?function(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}(n):{},t?function(e={}){return{signals:[{name:"color",value:az(e)?Object.assign(Object.assign({},uq),e):uq}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}(t):{},r?function(e){return{signals:[{name:"fontSize",value:az(e)?Object.assign(Object.assign({},oq),e):oq}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}(r):{},i||{})}const cq=["view",...OL],dq=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],hq=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]});function fq(e,t,n,r){const i=r?e[t][r]:e[t];"view"===t&&(n="cell");const a=Object.assign(Object.assign({},i),e.style[null!=n?n:t]);Gz(a)||(e.style[null!=n?n:t]=a),r||delete e[t]}function pq(e){return"layer"in e}class gq{map(e,t){return cV(e)?this.mapFacet(e,t):function(e){return"repeat"in e}(e)?this.mapRepeat(e,t):QG(e)?this.mapHConcat(e,t):YG(e)?this.mapVConcat(e,t):KG(e)?this.mapConcat(e,t):this.mapLayerOrUnit(e,t)}mapLayerOrUnit(e,t){if(pq(e))return this.mapLayer(e,t);if(LL(e))return this.mapUnit(e,t);throw new Error(Vj(e))}mapLayer(e,t){return Object.assign(Object.assign({},e),{layer:e.layer.map((e=>this.mapLayerOrUnit(e,t)))})}mapHConcat(e,t){return Object.assign(Object.assign({},e),{hconcat:e.hconcat.map((e=>this.map(e,t)))})}mapVConcat(e,t){return Object.assign(Object.assign({},e),{vconcat:e.vconcat.map((e=>this.map(e,t)))})}mapConcat(e,t){const{concat:n}=e,r=vz(e,["concat"]);return Object.assign(Object.assign({},r),{concat:n.map((e=>this.map(e,t)))})}mapFacet(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}mapRepeat(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}}const mq={zero:1,center:1,normalize:1},yq=new Set([vL,xL,bL,CL,_L,IL,DL,kL,AL,EL]),vq=new Set([xL,bL,vL]);function bq(e,t){var n,r;const i="x"===t?"y":"radius",a=e[t],s=e[i];if(vV(a)&&vV(s))if("quantitative"===bV(a)&&"quantitative"===bV(s)){if(a.stack)return t;if(s.stack)return i;const e=vV(a)&&!!a.aggregate;if(e!==(vV(s)&&!!s.aggregate))return e?t:i;{const e=null===(n=a.scale)||void 0===n?void 0:n.type,o=null===(r=s.scale)||void 0===r?void 0:r.type;if(e&&"linear"!==e)return i;if(o&&"linear"!==o)return t}}else{if("quantitative"===bV(a))return t;if("quantitative"===bV(s))return i}else{if("quantitative"===bV(a))return t;if("quantitative"===bV(s))return i}}function xq(e,t,n={}){const r=ML(e)?e.type:e;if(!yq.has(r))return null;const i=bq(t,"x")||bq(t,"theta");if(!i)return null;const a=t[i],s=vV(a)?DV(a,{}):void 0;let o=function(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(i),u=t[o],l=vV(u)?DV(u,{}):void 0;l===s&&(l=void 0,u=void 0,o=void 0);const c=pj.reduce(((e,n)=>{if("tooltip"!==n&&dG(t,n)){const r=t[n];for(const t of cz(r)){const r=PV(t);if(r.aggregate)continue;const i=DV(r,{});i&&i===l||e.push({channel:n,fieldDef:r})}}return e}),[]);let d;if(void 0!==a.stack?d=fz(a.stack)?a.stack?"zero":null:a.stack:c.length>0&&vq.has(r)&&(d="zero"),!d||!(d in mq))return null;var h;if(hG(t)&&0===c.length)return null;if(a.scale&&a.scale.type&&a.scale.type!==aW){if(n.disallowNonLinearStack)return null;vU(function(e){return`Cannot stack non-linear scale (${e}).`}(a.scale.type))}return _V(t[ZP(i)])?(void 0!==a.stack&&vU(`Cannot stack "${h=i}" if there is already "${h}2".`),null):(vV(a)&&a.aggregate&&!Bz(XL,a.aggregate)&&vU(`Stacking is applied even though the aggregate function is non-summative ("${a.aggregate}").`),{groupbyChannel:u?o:void 0,groupbyField:l,fieldChannel:i,impute:null!==a.impute&&$L(r),stackBy:c,offset:d})}function wq(e){const{point:t,line:n}=e,r=vz(e,["point","line"]);return qz(r).length>1?r:r.type}function kq(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:Tz(e[t],["point","line"])}));return e}function _q(e,t={},n){return"transparent"===e.point?{opacity:0}:e.point?az(e.point)?e.point:{}:void 0!==e.point?null:t.point||n.shape?az(t.point)?t.point:{}:void 0}function Sq(e,t={}){return e.line?!0===e.line?{}:e.line:void 0!==e.line?null:t.line?!0===t.line?{}:t.line:void 0}class Cq{constructor(){this.name="path-overlay"}hasMatchingType(e,t){if(LL(e)){const{mark:n,encoding:r}=e,i=ML(n)?n:{type:n};switch(i.type){case"line":case"rule":case"trail":return!!_q(i,t[i.type],r);case"area":return!!_q(i,t[i.type],r)||!!Sq(i,t[i.type])}}return!1}run(e,t,n){const{config:r}=t,{selection:i,projection:a,encoding:s,mark:o}=e,u=vz(e,["selection","projection","encoding","mark"]),l=ML(o)?o:{type:o},c=_q(l,r[l.type],s),d="area"===l.type&&Sq(l,r[l.type]),h=[Object.assign(Object.assign({},i?{selection:i}:{}),{mark:wq(Object.assign(Object.assign({},"area"===l.type&&void 0===l.opacity&&void 0===l.fillOpacity?{opacity:.7}:{}),l)),encoding:Tz(s,["shape"])})],f=xq(l,s);let p=s;if(f){const{fieldChannel:e,offset:t}=f;p=Object.assign(Object.assign({},s),{[e]:Object.assign(Object.assign({},s[e]),t?{stack:t}:{})})}return d&&h.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"line"},$z(l,["clip","interpolate","tension","tooltip"])),d),encoding:p})),c&&h.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},$z(l,["clip","tooltip"])),c),encoding:p})),n(Object.assign(Object.assign({},u),{layer:h}),Object.assign(Object.assign({},t),{config:kq(r)}))}}class Aq{constructor(){this.name="RangeStep"}hasMatchingType(e){var t;if(LL(e)&&e.encoding)for(const n of mj){const r=e.encoding[n];if(r&&_V(r)&&(null===(t=null==r?void 0:r.scale)||void 0===t?void 0:t.rangeStep))return!0}return!1}run(e){var t;const n={};let r=Object.assign({},e.encoding);for(const e of mj){const i=ej(e),a=r[e];if(a&&_V(a)&&(null===(t=null==a?void 0:a.scale)||void 0===t?void 0:t.rangeStep)){const{scale:t}=a,s=vz(a,["scale"]),o=t,{rangeStep:u}=o,l=vz(o,["rangeStep"]);n[i]={step:t.rangeStep},vU('Scale\'s "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.'),r=Object.assign(Object.assign({},r),{[e]:Object.assign(Object.assign({},s),Gz(l)?{}:{scale:l})})}}return Object.assign(Object.assign(Object.assign({},n),e),{encoding:r})}}function Eq(e,t){return t?uV(e)?Tq(e,t):Dq(e,t):e}function Fq(e,t){return t?Tq(e,t):e}function Iq(e,t,n){const r=t[e];return(i=r)&&!gz(i)&&"repeat"in i?r.repeat in n?Object.assign(Object.assign({},t),{[e]:n[r.repeat]}):void vU(function(e){return`Unknown repeated value "${e}".`}(r.repeat)):t;var i}function Dq(e,t){if(void 0!==(e=Iq("field",e,t))){if(null===e)return null;if(hV(e)&&sV(e.sort)){const n=Iq("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function Nq(e,t){if(vV(e))return Dq(e,t);{const n=Iq("datum",e,t);return n===e||n.type||(n.type="nominal"),n}}function $q(e,t){if(!_V(e)){if(yV(e)){const n=Nq(e.condition,t);if(n)return Object.assign(Object.assign({},e),{condition:n});{const{condition:t}=e;return vz(e,["condition"])}}return e}{const n=Nq(e,t);if(n)return n;if(gV(e))return{condition:e.condition}}}function Tq(e,t){const n={};for(const r in e)if(hz(e,r)){const i=e[r];if(iz(i))n[r]=i.map((e=>$q(e,t))).filter((e=>e));else{const e=$q(i,t);void 0!==e&&(n[r]=e)}}return n}class Oq{constructor(){this.name="RuleForRangedLine"}hasMatchingType(e){if(LL(e)){const{encoding:t,mark:n}=e;if("line"===n)for(const e of KP){const n=t[QP(e)];if(t[e]&&(vV(n)&&!Pj(n.bin)||xV(n)))return!0}}return!1}run(e,t,n){const{encoding:r}=e;var i,a;return vU((i=!!r.x2,a=!!r.y2,`Line mark is for continuous lines and thus cannot be used with ${i&&a?"x2 and y2":i?"x2":"y2"}. We will use the rule mark (line segments) instead.`)),n(Object.assign(Object.assign({},e),{mark:"rule"}),t)}}function Mq(e){const{parentEncoding:t,encoding:n}=e;if(t&&n){const e=qz(t).reduce(((e,t)=>(n[t]&&e.push(t),e)),[]);e.length>0&&vU(`Layer's shared ${(r=e).join(",")} channel ${1===r.length?"is":"are"} overriden.`)}var r;const i=Object.assign(Object.assign({},null!=t?t:{}),null!=n?n:{});return Gz(i)?void 0:i}function Rq(e){const{parentProjection:t,projection:n}=e;return t&&n&&vU(function(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${Oz(t)} is overridden by a child projection ${Oz(n)}.`}({parentProjection:t,projection:n})),null!=n?n:t}function Bq(e,t){void 0===t&&(t=lq(e.config));const n=function(e,t={}){return zq.map(e,{config:t})}(e,t),{width:r,height:i}=e,a=function(e,t,n){let{width:r,height:i}=t;const a=LL(e)||pq(e),s={};a?"container"==r&&"container"==i?(s.type="fit",s.contains="padding"):"container"==r?(s.type="fit-x",s.contains="padding"):"container"==i&&(s.type="fit-y",s.contains="padding"):("container"==r&&(vU(Gj("width")),r=void 0),"container"==i&&(vU(Gj("height")),i=void 0));const o=Object.assign(Object.assign(Object.assign({type:"pad"},s),n?Lq(n.autosize):{}),Lq(e.autosize));if("fit"!==o.type||a||(vU('Autosize "fit" only works for single views and layered views.'),o.type="pad"),"container"==r&&"fit"!=o.type&&"fit-x"!=o.type&&vU(qj("width")),"container"==i&&"fit"!=o.type&&"fit-y"!=o.type&&vU(qj("height")),!Dz(o,{type:"pad"}))return o}(n,{width:r,height:i,autosize:e.autosize},t);return Object.assign(Object.assign({},n),a?{autosize:a}:{})}const zq=new class extends gq{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[EG,$G,BG,new Cq,new Oq,new Aq]}map(e,t){if(LL(e)){const n=dG(e.encoding,YL),r=dG(e.encoding,QL),i=dG(e.encoding,JL);if(n||r||i)return this.mapFacetedUnit(e,t)}return super.map(e,t)}mapUnit(e,t){const{parentEncoding:n,parentProjection:r}=t,i=Object.assign(Object.assign({},e),{encoding:Fq(e.encoding,t.repeater)});if(n||r)return this.mapUnitWithParentEncodingOrProjection(i,t);const a=this.mapLayerOrUnit.bind(this);for(const e of this.nonFacetUnitNormalizers)if(e.hasMatchingType(i,t.config))return e.run(i,t,a);return i}mapRepeat(e,t){return function(e){return!iz(e.repeat)&&e.repeat.layer}(e)?this.mapLayerRepeat(e,t):this.mapNonLayerRepeat(e,t)}mapLayerRepeat(e,t){const{repeat:n,spec:r}=e,i=vz(e,["repeat","spec"]),{row:a,column:s,layer:o}=n,{repeater:u={},repeaterPrefix:l=""}=t;return a||s?this.mapRepeat(Object.assign(Object.assign({},e),{repeat:Object.assign(Object.assign({},a?{row:a}:{}),s?{column:s}:{}),spec:{repeat:{layer:o},spec:r}}),t):Object.assign(Object.assign({},i),{layer:o.map((e=>{const n=Object.assign(Object.assign({},u),{layer:e}),i=(r.name||"")+l+`child__layer_${Yz(e)}`,a=this.mapLayerOrUnit(r,Object.assign(Object.assign({},t),{repeater:n,repeaterPrefix:i}));return a.name=i,a}))})}mapNonLayerRepeat(e,t){var n;const{repeat:r,spec:i,data:a}=e,s=vz(e,["repeat","spec","data"]);!iz(r)&&e.columns&&(e=Tz(e,["columns"]),vU(Qj("repeat")));const o=[],{repeater:u={},repeaterPrefix:l=""}=t,c=!iz(r)&&r.row||[u?u.row:null],d=!iz(r)&&r.column||[u?u.column:null],h=iz(r)&&r||[u?u.repeat:null];for(const e of h)for(const n of c)for(const a of d){const s={repeat:e,row:n,column:a,layer:u.layer},c=(i.name||"")+l+"child__"+(iz(r)?`${Yz(e)}`:(r.row?`row_${Yz(n)}`:"")+(r.column?`column_${Yz(a)}`:"")),d=this.map(i,Object.assign(Object.assign({},t),{repeater:s,repeaterPrefix:c}));d.name=c,o.push(Tz(d,["data"]))}const f=iz(r)?e.columns:r.column?r.column.length:1;return Object.assign(Object.assign({data:null!==(n=i.data)&&void 0!==n?n:a,align:"all"},s),{columns:f,concat:o})}mapFacet(e,t){const{facet:n}=e;return uV(n)&&e.columns&&(e=Tz(e,["columns"]),vU(Qj("facet"))),super.mapFacet(e,t)}mapUnitWithParentEncodingOrProjection(e,t){const{encoding:n,projection:r}=e,{parentEncoding:i,parentProjection:a,config:s}=t,o=Rq({parentProjection:a,projection:r}),u=Mq({parentEncoding:i,encoding:Fq(n,t.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},e),o?{projection:o}:{}),u?{encoding:u}:{}),{config:s})}mapFacetedUnit(e,t){const n=e.encoding,{row:r,column:i,facet:a}=n,s=vz(n,["row","column","facet"]),{mark:o,width:u,projection:l,height:c,view:d,selection:h,encoding:f}=e,p=vz(e,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:g,layout:m}=this.getFacetMappingAndLayout({row:r,column:i,facet:a},t),y=Fq(s,t.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},p),m),{facet:g,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},u?{width:u}:{}),c?{height:c}:{}),d?{view:d}:{}),l?{projection:l}:{}),{mark:o,encoding:y}),h?{selection:h}:{})}),t)}getFacetMappingAndLayout(e,t){var n;const{row:r,column:i,facet:a}=e;if(r||i){a&&vU(`Facet encoding dropped as ${(s=[...r?[YL]:[],...i?[QL]:[]]).join(" and ")} ${s.length>1?"are":"is"} also specified.`);const t={},o={};for(const r of[YL,QL]){const i=e[r];if(i){const{align:e,center:a,spacing:s,columns:u}=i,l=vz(i,["align","center","spacing","columns"]);t[r]=l;for(const e of["align","center","spacing"])void 0!==i[e]&&(o[e]=null!==(n=o[e])&&void 0!==n?n:{},o[e][r]=i[e])}}return{facetMapping:t,layout:o}}{const{align:e,center:n,spacing:r,columns:i}=a;return{facetMapping:Eq(vz(a,["align","center","spacing","columns"]),t.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},e?{align:e}:{}),n?{center:n}:{}),r?{spacing:r}:{}),i?{columns:i}:{})}}var s}mapLayer(e,t){var{parentEncoding:n,parentProjection:r}=t,i=vz(t,["parentEncoding","parentProjection"]);const{encoding:a,projection:s}=e,o=vz(e,["encoding","projection"]),u=Object.assign(Object.assign({},i),{parentEncoding:Mq({parentEncoding:n,encoding:a}),parentProjection:Rq({parentProjection:r,projection:s})});return super.mapLayer(o,u)}};function Lq(e){return gz(e)?{type:e}:null!=e?e:{}}const Pq=["background","padding"];function jq(e){return Pq.reduce(((t,n)=>(e&&void 0!==e[n]&&(t[n]=e[n]),t)),{})}class Uq{constructor(e={},t={}){this.explicit=e,this.implicit=t}clone(){return new Uq(Nz(this.explicit),Nz(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(e){return sL(this.explicit[e],this.implicit[e])}getWithExplicit(e){return void 0!==this.explicit[e]?{explicit:!0,value:this.explicit[e]}:void 0!==this.implicit[e]?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}}setWithExplicit(e,t){void 0!==t.value&&this.set(e,t.value,t.explicit)}set(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this}copyKeyFromSplit(e,t){void 0!==t.explicit[e]?this.set(e,t.explicit[e],!0):void 0!==t.implicit[e]&&this.set(e,t.implicit[e],!1)}copyKeyFromObject(e,t){void 0!==t[e]&&this.set(e,t[e],!0)}copyAll(e){for(const t of qz(e.combine())){const n=e.getWithExplicit(t);this.setWithExplicit(t,n)}}}function Wq(e){return{explicit:!0,value:e}}function Vq(e){return{explicit:!1,value:e}}function Gq(e){return(t,n,r,i)=>{const a=e(t.value,n.value);return a>0?t:a<0?n:qq(t,n,r,i)}}function qq(e,t,n,r){return e.explicit&&t.explicit&&vU(function(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${Oz(n)} and ${Oz(r)}). Using ${Oz(n)}.`}(n,r,e.value,t.value)),e}function Hq(e,t,n,r,i=qq){return void 0===e||void 0===e.value?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:Dz(e.value,t.value)?e:i(e,t,n,r)}class Xq extends Uq{constructor(e={},t={},n=!1){super(e,t),this.explicit=e,this.implicit=t,this.parseNothing=n}clone(){const e=super.clone();return e.parseNothing=this.parseNothing,e}}function Kq(e){return"url"in e}function Yq(e){return"values"in e}function Qq(e){return"name"in e&&!Kq(e)&&!Yq(e)&&!Jq(e)}function Jq(e){return e&&(Zq(e)||eH(e)||tH(e))}function Zq(e){return"sequence"in e}function eH(e){return"sphere"in e}function tH(e){return"graticule"in e}const nH="main",rH="raw";function iH(e){return"filter"in e}function aH(e){return"lookup"in e}function sH(e){return"pivot"in e}function oH(e){return"density"in e}function uH(e){return"quantile"in e}function lH(e){return"regression"in e}function cH(e){return"loess"in e}function dH(e){return"sample"in e}function hH(e){return"window"in e}function fH(e){return"joinaggregate"in e}function pH(e){return"flatten"in e}function gH(e){return"calculate"in e}function mH(e){return"bin"in e}function yH(e){return"impute"in e}function vH(e){return"timeUnit"in e}function bH(e){return"aggregate"in e}function xH(e){return"stack"in e}function wH(e){return"fold"in e}function kH(e,t,n,r){const i=gV(t)&&t.condition,a=r(t);if(i){const t=cz(i).map((t=>{const n=r(t),i=function(e){return e.selection}(t)?XK(e,t.selection):YK(e,t.test);return Object.assign({test:i},n)}));return{[n]:[...t,...void 0!==a?[a]:[]]}}return void 0!==a?{[n]:a}:{}}function _H(e,t="text"){const n=e.encoding[t];return kH(e,n,t,(t=>SH(t,e.config)))}function SH(e,t,n="datum"){if(e){if(CV(e))return ZV(e.value);if(_V(e)){const{format:r,formatType:i}=LV(e);return HW({fieldOrDatumDef:e,format:r,formatType:i,expr:n,config:t})}}}function CH(e,t={}){const{encoding:n,markDef:r,config:i,stack:a}=e,s=n.tooltip;if(iz(s))return{tooltip:EH({tooltip:s},a,i,t)};{const o=t.reactiveGeom?"datum.datum":"datum";return kH(e,s,"tooltip",(e=>{const s=SH(e,i,o);if(s)return s;if(null===e)return;let u=rG("tooltip",r,i);return!0===u&&(u={content:"encoding"}),gz(u)?{value:u}:az(u)?"encoding"===u.content?EH(n,a,i,t):{signal:o}:void 0}))}}function AH(e,t,n,{reactiveGeom:r}={}){const i={},a=r?"datum.datum":"datum",s=[];function o(r,o){const u=QP(o),l=SV(r)?r:Object.assign(Object.assign({},r),{type:e[u].type}),c=cz(RV(l,n,{allowDisabling:!1})).join(", ");let d;if(yj(o)){const r="x"===o?"x2":"y2",s=PV(e[r]);if(Pj(l.bin)&&s){const e=DV(l,{expr:a}),t=DV(s,{expr:a}),{format:o,formatType:u}=LV(l);d=tV(e,t,o,u,n),i[r]=!0}else if(t&&t.fieldChannel===o&&"normalize"===t.offset){const{format:e,formatType:t}=LV(l);d=HW({fieldOrDatumDef:l,format:e,formatType:t,expr:a,config:n,normalizeStack:!0}).signal}}d=null!=d?d:SH(l,n,a).signal,s.push({channel:o,key:c,value:d})}mG(e,((e,t)=>{vV(e)?o(e,t):mV(e)&&o(e.condition,t)}));const u={};for(const{channel:e,key:t,value:n}of s)i[e]||u[t]||(u[mz(t)]=n);return u}function EH(e,t,n,{reactiveGeom:r}={}){const i=Xz(AH(e,t,n,{reactiveGeom:r})).map((({key:e,value:t})=>`${e}: ${t}`));return i.length>0?{signal:`{${i.join(", ")}}`}:void 0}function FH(e,t,n={}){const{markDef:r,encoding:i,config:a}=t,{vgChannel:s}=n;let{defaultRef:o,defaultValue:u}=n;void 0===o&&(u=null!=u?u:rG(e,r,a,{vgChannel:s,ignoreVgConfig:!0}),void 0!==u&&(o=ZV(u)));const l=i[e];return kH(t,l,null!=s?s:e,(n=>WW({channel:e,channelDef:n,markDef:r,config:a,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:o})))}function IH(e,t={filled:void 0}){var n,r,i,a;const{markDef:s,encoding:o,config:u}=e,{type:l}=s,c=null!==(n=t.filled)&&void 0!==n?n:rG("filled",s,u),d=Bz(["bar","point","circle","square","geoshape"],l)?"transparent":void 0,h=null!==(i=null!==(r=rG(!0===c?"color":void 0,s,u,{vgChannel:"fill"}))&&void 0!==r?r:u.mark[!0===c&&"color"])&&void 0!==i?i:d,f=null!==(a=rG(!1===c?"color":void 0,s,u,{vgChannel:"stroke"}))&&void 0!==a?a:u.mark[!1===c&&"color"],p=c?"fill":"stroke",g=Object.assign(Object.assign({},h?{fill:ZV(h)}:{}),f?{stroke:ZV(f)}:{});return s.color&&(c?s.fill:s.stroke)&&vU(tU("property",{fill:"fill"in s,stroke:"stroke"in s})),Object.assign(Object.assign(Object.assign(Object.assign({},g),FH("color",e,{vgChannel:p,defaultValue:c?h:f})),FH("fill",e,{defaultValue:o.fill?h:void 0})),FH("stroke",e,{defaultValue:o.stroke?f:void 0}))}function DH(e,t){const n=function(e){switch(e){case ZL:return"xOffset";case eP:return"yOffset";case tP:return"x2Offset";case nP:return"y2Offset";case aP:return"thetaOffset";case rP:return"radiusOffset";case sP:return"theta2Offset";case iP:return"radius2Offset"}}(e),r=t[n];if(r)return r}function NH(e,t,{defaultPos:n,vgChannel:r,isMidPoint:i}){const{encoding:a,markDef:s,config:o,stack:u}=t,l=a[e],c=a[ZP(e)],d=t.scaleName(e),h=t.getScaleComponent(e),f=DH(e,s),p=$H({model:t,defaultPos:n,channel:e,scaleName:d,scale:h}),g=!l&&yj(e)&&(a.latitude||a.longitude)?{field:t.getName(e)}:function(e){const{channel:t,channelDef:n,isMidPoint:r,scaleName:i,stack:a,offset:s,markDef:o,config:u}=e;if(_V(n)&&a&&t===a.fieldChannel){if(vV(n)){const e=fV({channel:t,fieldDef:n,isMidPoint:r,markDef:o,stack:a,config:u});if(void 0!==e)return UW({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",band:e,offset:s})}return jW(n,i,{suffix:"end"},{offset:s})}return BW(e)}({channel:e,channelDef:l,channel2Def:c,markDef:s,config:o,isMidPoint:i,scaleName:d,scale:h,stack:u,offset:f,defaultRef:p});return g?{[r||e]:g}:void 0}function $H({model:e,defaultPos:t,channel:n,scaleName:r,scale:i}){const{markDef:a,config:s}=e;return()=>{const o=QP(n),u=JP(n),l=rG(n,a,s,{vgChannel:u});if(void 0!==l)return VW(n,l);switch(t){case"zeroOrMin":case"zeroOrMax":if(r){const e=i.get("type");if(Bz(["log",sW,oW],e));else if(i.domainDefinitelyIncludesZero())return{scale:r,value:0}}if("zeroOrMin"===t)return"y"===o?{field:{group:"height"}}:{value:0};switch(o){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const t=e[ej(n)];return Object.assign(Object.assign({},t),{mult:.5})}}}}const TH={left:"x",center:"xc",right:"x2"},OH={top:"y",middle:"yc",bottom:"y2"};function MH(e,t,n,r="middle"){if("radius"===e||"theta"===e)return JP(e);const i=rG("x"===e?"align":"baseline",t,n);return"x"===e?TH[i||("top"===r?"left":"center")]:OH[i||r]}function RH(e,t,{defaultPos:n,defaultPos2:r,range:i}){return i?BH(e,t,{defaultPos:n,defaultPos2:r}):NH(e,t,{defaultPos:n})}function BH(e,t,{defaultPos:n,defaultPos2:r}){const{markDef:i,config:a}=t,s=ZP(e),o=ej(e),u=function(e,t,n){const{encoding:r,mark:i,markDef:a,stack:s,config:o}=e,u=QP(n),l=ej(n),c=JP(n),d=r[u],h=e.scaleName(u),f=e.getScaleComponent(u),p=DH(n in r||n in a?n:u,e.markDef);if(!d&&("x2"===n||"y2"===n)&&(r.latitude||r.longitude))return{[c]:{field:e.getName(n)}};const g=function({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:a,scale:s,stack:o,offset:u,defaultRef:l}){return _V(t)&&o&&e.charAt(0)===o.fieldChannel.charAt(0)?jW(t,a,{suffix:"start"},{offset:u}):BW({channel:e,channelDef:n,scaleName:a,scale:s,stack:o,markDef:r,config:i,offset:u,defaultRef:l})}({channel:n,channelDef:d,channel2Def:r[n],markDef:a,config:o,scaleName:h,scale:f,stack:s,offset:p,defaultRef:void 0});return void 0!==g?{[c]:g}:zH(n,a)||zH(n,{[n]:aG(n,a,o.style),[l]:aG(l,a,o.style)})||zH(n,o[i])||zH(n,o.mark)||{[c]:$H({model:e,defaultPos:t,channel:n,scaleName:h,scale:f})()}}(t,r,s),l=u[o]?MH(e,i,a):JP(e);return Object.assign(Object.assign({},NH(e,t,{defaultPos:n,vgChannel:l})),u)}function zH(e,t){const n=ej(e),r=JP(e);return void 0!==t[r]?{[r]:VW(e,t[r])}:void 0!==t[e]?{[r]:VW(e,t[e])}:t[n]?{[n]:VW(e,t[n])}:void 0}function LH(e,t,n){var r,i,a,s;const{config:o,encoding:u,markDef:l,stack:c}=e,d=ZP(t),h=ej(t),f=u[t],p=u[d],g=e.getScaleComponent(t),m=g?g.get("type"):void 0,y=e.scaleName(t),v=l.orient,b=null!==(i=null!==(r=u[h])&&void 0!==r?r:u.size)&&void 0!==i?i:rG("size",l,o,{vgChannel:h}),x="bar"===n&&("x"===t?"vertical"===v:"horizontal"===v);if(vV(f)&&(Lj(f.bin)||Pj(f.bin)||f.timeUnit&&!p)&&!b&&!xW(m)){const n=fV({channel:t,fieldDef:f,stack:c,markDef:l,config:o}),r=null===(a=e.component.axes[t])||void 0===a?void 0:a[0];return function({fieldDef:e,fieldDef2:t,channel:n,band:r,scaleName:i,markDef:a,spacing:s=0,axisTranslate:o,reverse:u,config:l}){const c=ZP(n),d=JP(n),h=JP(c),f=DH(n,a);if(Lj(e.bin)||e.timeUnit)return{[h]:UH({channel:n,fieldDef:e,scaleName:i,markDef:a,band:(1-r)/2,offset:jH(c,s,u,o,f),config:l}),[d]:UH({channel:n,fieldDef:e,scaleName:i,markDef:a,band:1-(1-r)/2,offset:jH(n,s,u,o,f),config:l})};if(Pj(e.bin)){const r=jW(e,i,{},{offset:jH(c,s,u,o,f)});if(vV(t))return{[h]:r,[d]:jW(t,i,{},{offset:jH(n,s,u,o,f)})};if(jj(e.bin)&&e.bin.step)return{[h]:r,[d]:{signal:`scale("${i}", ${DV(e,{expr:"datum"})} + ${e.bin.step})`,offset:jH(n,s,u,o,f)}}}vU(pU(c))}({fieldDef:f,fieldDef2:p,channel:t,markDef:l,scaleName:y,band:n,axisTranslate:null!==(s=null==r?void 0:r.get("translate"))&&void 0!==s?s:.5,spacing:yj(t)?rG("binSpacing",l,o):void 0,reverse:g.get("reverse"),config:o})}return(_V(f)&&xW(m)||x)&&!p?function(e,t,n,r){var i;const{markDef:a,encoding:s,config:o,stack:u}=r,l=a.orient,c=r.scaleName(n),d=r.getScaleComponent(n),h=ej(n),f=ZP(n),p="horizontal"===l&&"y"===n||"vertical"===l&&"x"===n,g=rG(p?"size":h,a,o,{vgChannel:h});let m;(s.size||void 0!==g)&&(p?m=FH("size",r,{vgChannel:h,defaultValue:g}):vU(function(e){return`Cannot apply size to non-oriented mark "${e}".`}(a.type)));const y=null!==(i=_V(t)?fV({channel:n,fieldDef:t,markDef:a,stack:u,config:o}):void 0)&&void 0!==i?i:1;m=m||{[h]:PH(e,h,c,d,o,y)};const v="band"!==(null==d?void 0:d.get("type"))||!("band"in m[h]),b=MH(n,a,o,v?"middle":"top"),x=DH(n,a),w=BW({channel:n,channelDef:t,markDef:a,config:o,scaleName:c,scale:d,stack:u,offset:x,defaultRef:$H({model:r,defaultPos:"mid",channel:n,scaleName:c,scale:d}),band:v?.5:(1-y)/2});if(h)return Object.assign({[b]:w},m);{const e=JP(f),t=m[h],n=x?Object.assign(Object.assign({},t),{offset:x}):t;return{[b]:w,[e]:iz(w)?[w[0],Object.assign(Object.assign({},w[1]),{offset:n})]:Object.assign(Object.assign({},w),{offset:n})}}}(n,f,t,e):BH(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function PH(e,t,n,r,i,a){if(r){const t=r.get("type");if("point"===t||"band"===t){if(void 0!==i[e].discreteBandSize)return{value:i[e].discreteBandSize};if(t===uW){const e=r.get("range");return MU(e)&&pz(e.step)?{value:e.step-2}:{value:iq-2}}return{scale:n,band:a}}return{value:i[e].continuousBandSize}}const s=nq(i.view,t),o=sL(i[e].discreteBandSize,s-2);return void 0!==o?{value:o}:void 0}function jH(e,t,n,r,i){if(NP(e))return 0;const a="x"===e||"y2"===e?-t/2:t/2;if(OU(n)){const e=tG(i);return{signal:`${n.signal} ? ${r-a}${e?"-"+e:""} : ${r+a}${e?"+"+e:""}`}}if(OU(i)){const e=r+(n?-a:a);return{signal:`${e||""}${n?" - ":e?" + ":""}${i.signal}`}}return i=i||0,r+(n?-i-a:+i+a)}function UH({channel:e,fieldDef:t,scaleName:n,markDef:r,band:i,offset:a,config:s}){return zW({fieldDef:t,channel:e,markDef:r,ref:UW({scaleName:n,fieldOrDatumDef:t,band:i,offset:a}),config:s})}const WH=new Set(["aria"]);function VH(e,t){const{fill:n,stroke:r}="include"===t.color?IH(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},function(e,t){return BU.reduce(((n,r)=>(WH.has(r)||void 0===e[r]||"ignore"===t[r]||(n[r]=ZV(e[r])),n)),{})}(e.markDef,t)),GH(e,"fill",n)),GH(e,"stroke",r)),FH("opacity",e)),FH("fillOpacity",e)),FH("strokeOpacity",e)),FH("strokeWidth",e)),FH("strokeDash",e)),CH(e)),_H(e,"href")),function(e){const{markDef:t,config:n}=e,r=rG("aria",t,n);return!1===r?{}:Object.assign(Object.assign(Object.assign({},r?{aria:r}:{}),function(e){const{mark:t,markDef:n,config:r}=e;if(!1===r.aria)return{};const i=rG("ariaRoleDescription",n,r);return null!=i?{ariaRoleDescription:{value:i}}:t in zU?{}:{ariaRoleDescription:{value:t}}}(e)),function(e){const{encoding:t,markDef:n,config:r,stack:i}=e,a=t.description;if(a)return kH(e,a,"description",(t=>SH(t,e.config)));const s=rG("description",n,r);if(null!=s)return{description:ZV(s)};if(!1===r.aria)return{};const o=AH(t,i,r);return Gz(o)?void 0:{description:{signal:Xz(o).map((({key:e,value:t})=>`${e} + ": " + (${t})`)).join(' + "; " + ')}}}(e))}(e))}function GH(e,t,n){const{config:r,mark:i,markDef:a}=e;if("hide"===rG("invalid",a,r)&&n&&!$L(i)){const r=function(e,{invalid:t=!1,channels:n}){const r=n.reduce(((t,n)=>{const r=e.getScaleComponent(n);if(r){const i=r.get("type"),a=e.vgField(n,{expr:"datum"});a&&wW(i)&&(t[a]=!0)}return t}),{}),i=qz(r);if(i.length>0){const e=t?"||":"&&";return i.map((e=>PW(e,t))).join(` ${e} `)}}(e,{invalid:!0,channels:$j});if(r)return{[t]:[{test:r,value:null},...cz(n)]}}return n?{[t]:n}:{}}function qH(e){const{config:t,markDef:n}=e;if(rG("invalid",n,t)){const t=function(e,{invalid:t=!1,channels:n}){const r=n.reduce(((t,n)=>{const r=e.getScaleComponent(n);if(r){const i=r.get("type"),a=e.vgField(n,{expr:"datum"});a&&wW(i)&&(t[a]=!0)}return t}),{}),i=qz(r);if(i.length>0){const e=t?"||":"&&";return i.map((e=>PW(e,t))).join(` ${e} `)}}(e,{channels:mj});if(t)return{defined:{signal:t}}}return{}}function HH(e,t){if(void 0!==t)return{[e]:ZV(t)}}const XH="voronoi",KH={has:e=>"interval"!==e.type&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(XH)},marks:(e,t,n)=>{const{x:r,y:i}=t.project.hasChannel,a=e.mark;if($L(a))return vU(`The "nearest" transform is not supported for ${a} marks.`),n;const s={name:e.getName(XH),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},CH(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:r||!i?"datum.datum.x || 0":"0"},y:{expr:i||!r?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let o=0,u=!1;return n.forEach(((t,n)=>{var r;const i=null!==(r=t.name)&&void 0!==r?r:"";i===e.component.mark[0].name?o=n:i.indexOf(XH)>=0&&(u=!0)})),u||n.splice(o+1,0,s),n}},YH=KH;class QH{constructor(e,t){this.debugName=t,this._children=[],this._parent=null,e&&(this.parent=e)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(e){this._parent=e,e&&e.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(e,t){this._children.indexOf(e)>-1?console.warn("Attempt to add the same child twice."):void 0!==t?this._children.splice(t,0,e):this._children.push(e)}removeChild(e){const t=this._children.indexOf(e);return this._children.splice(t,1),t}remove(){let e=this._parent.removeChild(this);for(const t of this._children)t._parent=this._parent,this._parent.addChild(t,e++)}insertAsParentOf(e){const t=e.parent;t.removeChild(this),this.parent=t,e.parent=this}swapWithParent(){const e=this._parent,t=e.parent;for(const t of this._children)t.parent=e;this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this}}class JH extends QH{constructor(e,t,n,r){super(e,t),this.type=n,this.refCounts=r,this._source=this._name=t,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const e=new this.constructor;return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e}dependentFields(){return new Set}producedFields(){return new Set}hash(){return void 0===this._hash&&(this._hash=`Output ${function(e){const t=++oL;return t}()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(e){this._source=e}}class ZH extends QH{constructor(e,t){super(e),this.formula=t}clone(){return new ZH(null,Nz(this.formula))}static makeFromEncoding(e,t){const n=t.reduceFieldDef(((e,n,r)=>{const{field:i,timeUnit:a}=n,s=vJ(t)?t.encoding[ZP(r)]:void 0,o=vJ(t)&&pV(r,n,s,t.stack,t.markDef,t.config);if(a){const t=DV(n,{forAs:!0});e[Mz({as:t,field:i,timeUnit:a})]=Object.assign({as:t,field:i,timeUnit:a},o?{band:!0}:{})}return e}),{});return Gz(n)?null:new ZH(e,n)}static makeFromTransform(e,t){const n=Object.assign({},t),{timeUnit:r}=n,i=vz(n,["timeUnit"]),a=TU(r),s=Object.assign(Object.assign({},i),{timeUnit:a});return new ZH(e,{[Mz(s)]:s})}merge(e){this.formula=Object.assign({},this.formula);for(const t in e.formula)this.formula[t]&&!e.formula[t].band||(this.formula[t]=e.formula[t]);for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}producedFields(){return new Set(Hz(this.formula).map((e=>e.as)))}dependentFields(){return new Set(Hz(this.formula).map((e=>e.field)))}hash(){return`TimeUnit ${Mz(this.formula)}`}assemble(){const e=[];for(const t of Hz(this.formula)){const{field:n,as:r,timeUnit:i}=t,a=TU(i),{unit:s,utc:o}=a,u=vz(a,["unit","utc"]);e.push(Object.assign(Object.assign(Object.assign(Object.assign({field:nL(n),type:"timeunit"},s?{units:DU(s)}:{}),o?{timezone:"utc"}:{}),u),{as:[r,`${r}_end`]}))}return e}}const eX="_tuple_fields";class tX{constructor(...e){this.items=e,this.hasChannel={},this.hasField={}}}const nX={has:()=>!0,parse:(e,t,n)=>{var r,i,a;const s=t.name,o=null!==(r=t.project)&&void 0!==r?r:t.project=new tX,u={},l={},c=new Set,d=(e,t)=>{const n="visual"===t?e.channel:e.field;let r=Yz(`${s}_${n}`);for(let e=1;c.has(r);e++)r=Yz(`${s}_${n}_${e}`);return c.add(r),{[t]:r}};if(!n.fields&&!n.encodings){const t=e.config.selection[n.type];if(n.init)for(const e of cz(n.init))for(const r of qz(e))HP[r]?(n.encodings||(n.encodings=[])).push(r):"interval"===n.type?(vU('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=t.encodings):(n.fields||(n.fields=[])).push(r);else n.encodings=t.encodings,n.fields=t.fields}for(const e of null!==(i=n.fields)&&void 0!==i?i:[]){const t={type:"E",field:e};t.signals=Object.assign({},d(t,"data")),o.items.push(t),o.hasField[e]=t}for(const r of null!==(a=n.encodings)&&void 0!==a?a:[]){const n=e.fieldDef(r);if(n){let i=n.field;if(n.aggregate){vU(Kj(r,n.aggregate));continue}if(!i){vU(Xj(r));continue}if(n.timeUnit){i=e.vgField(r);const t={timeUnit:n.timeUnit,as:i,field:n.field};l[Mz(t)]=t}if(!u[i]){let a="E";"interval"===t.type?wW(e.getScaleComponent(r).get("type"))&&(a="R"):n.bin&&(a="R-RE");const s={field:i,channel:r,type:a};s.signals=Object.assign(Object.assign({},d(s,"data")),d(s,"visual")),o.items.push(u[i]=s),o.hasField[i]=o.hasChannel[r]=u[i]}}else vU(Xj(r))}if(n.init){const e=e=>o.items.map((t=>void 0!==e[t.channel]?e[t.channel]:e[t.field]));if("interval"===n.type)t.init=e(n.init);else{const r=cz(n.init);t.init=r.map(e)}}Gz(l)||(o.timeUnit=new ZH(null,l))},signals:(e,t,n)=>{const r=t.name+eX;return n.filter((e=>e.name===r)).length>0?n:n.concat({name:r,value:t.project.items.map((e=>{const{signals:t,hasLegend:n}=e,r=vz(e,["signals","hasLegend"]);return r.field=nL(r.field),r}))})}},rX={has:e=>"single"===e.type&&"global"===e.resolve&&e.bind&&"scales"!==e.bind&&!HG(e.bind),parse:(e,t,n,r)=>{r.on||delete t.events,r.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const r=t.name,i=t.project,a=t.bind,s=t.init&&t.init[0],o=YH.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return i.items.forEach(((e,i)=>{var u,l;const c=Yz(`${r}_${e.field}`);n.filter((e=>e.name===c)).length||n.unshift(Object.assign(Object.assign({name:c},s?{init:kX(s[i])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${o}[${mz(e.field)}] : null`}]:[],bind:null!==(l=null!==(u=a[e.field])&&void 0!==u?u:a[e.channel])&&void 0!==l?l:a}))})),n},signals:(e,t,n)=>{const r=t.name,i=t.project,a=n.filter((e=>e.name===r+TX))[0],s=r+eX,o=i.items.map((e=>Yz(`${r}_${e.field}`))),u=o.map((e=>`${e} !== null`)).join(" && ");return o.length&&(a.update=`${u} ? {fields: ${s}, values: [${o.join(", ")}]} : null`),delete a.value,delete a.on,n}},iX=rX,aX="_toggle",sX={has:e=>"multi"===e.type&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+aX,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+TX,r=t.name+aX;return`${r} ? null : ${n}, `+("global"===t.resolve?`${r} ? null : true, `:`${r} ? null : {unit: ${BX(e)}}, `)+`${r} ? ${n} : null`}},oX={has:e=>void 0!==e.clear&&!1!==e.clear,parse:(e,t,n)=>{n.clear&&(t.clear=gz(n.clear)?VB(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(iX.has(t))for(const e of t.project.items){const r=n.findIndex((n=>n.name===Yz(`${t.name}_${e.field}`)));-1!==r&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function r(e,r){-1!==e&&n[e].on&&n[e].on.push({events:t.clear,update:r})}if("interval"===t.type)for(const e of t.project.items){const t=n.findIndex((t=>t.name===e.signals.visual));r(t,"[0, 0]"),-1===t&&r(n.findIndex((t=>t.name===e.signals.data)),"null")}else{let e=n.findIndex((e=>e.name===t.name+TX));r(e,"null"),sX.has(t)&&(e=n.findIndex((e=>e.name===t.name+aX)),r(e,"false"))}return n}},uX={has:e=>"interval"===e.type&&"global"===e.resolve&&e.bind&&"scales"===e.bind,parse:(e,t)=>{const n=t.scales=[];for(const r of t.project.items){const i=r.channel;if(!Tj(i))continue;const a=e.getScaleComponent(i),s=a?a.get("type"):void 0;if(!a||!wW(s)){vU("Scale bindings are currently only supported for scales with unbinned, continuous domains.");continue}const o={selection:t.name,field:r.field};a.set("selectionExtent",o,!0),n.push(r)}},topLevelSignals:(e,t,n)=>{const r=t.scales.filter((e=>0===n.filter((t=>t.name===e.signals.data)).length));if(!e.parent||dX(e)||0===r.length)return n;const i=n.filter((e=>e.name===t.name))[0];let a=i.update;if(a.indexOf(OX)>=0)i.update=`{${r.map((e=>`${mz(e.field)}: ${e.signals.data}`)).join(", ")}}`;else{for(const e of r){const t=`${mz(e.field)}: ${e.signals.data}`;a.indexOf(t)<0&&(a=`${a.substring(0,a.length-1)}, ${t}}`)}i.update=a}return n.concat(r.map((e=>({name:e.signals.data}))))},signals:(e,t,n)=>{if(e.parent&&!dX(e))for(const e of t.scales){const t=n.filter((t=>t.name===e.signals.data))[0];t.push="outer",delete t.value,delete t.update}return n}},lX=uX;function cX(e,t){return`domain(${mz(e.scaleName(t))})`}function dX(e){var t;return e.parent&&wJ(e.parent)&&(null!==(t=!e.parent.parent)&&void 0!==t?t:dX(e.parent.parent))}const hX={has:e=>{const t="global"===e.resolve&&e.bind&&HG(e.bind),n=1===e.project.items.length&&e.project.items[0].field!==GG;return t&&!n&&vU("Legend bindings are only supported for selections over an individual field or encoding channel."),t&&n},parse:(e,t,n,r)=>{var i;if(r.on||delete t.events,r.clear||delete t.clear,r.on||r.clear){const e='event.item && indexof(event.item.mark.role, "legend") < 0';for(const n of t.events)n.filter=cz(null!==(i=n.filter)&&void 0!==i?i:[]),n.filter.indexOf(e)<0&&n.filter.push(e)}const a=XG(t.bind)?t.bind.legend:"click",s=gz(a)?VB(a,"view"):cz(a);t.bind={legend:{merge:s}}},topLevelSignals:(e,t,n)=>{const r=t.name,i=XG(t.bind)&&t.bind.legend,a=e=>t=>{const n=Nz(t);return n.markname=e,n};for(const e of t.project.items){if(!e.hasLegend)continue;const s=`${Yz(e.field)}_legend`,o=`${r}_${s}`;if(0===n.filter((e=>e.name===o)).length){const e=i.merge.map(a(`${s}_symbols`)).concat(i.merge.map(a(`${s}_labels`))).concat(i.merge.map(a(`${s}_entries`)));n.unshift(Object.assign(Object.assign({name:o},t.init?{}:{value:null}),{on:[{events:e,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:i.merge,update:`!event.item || !datum ? null : ${o}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const r=t.name,i=t.project,a=n.find((e=>e.name===r+TX)),s=r+eX,o=i.items.filter((e=>e.hasLegend)).map((e=>Yz(`${r}_${Yz(e.field)}_legend`))),u=`${o.map((e=>`${e} !== null`)).join(" && ")} ? {fields: ${s}, values: [${o.join(", ")}]} : null`;t.events&&o.length>0?a.on.push({events:o.map((e=>({signal:e}))),update:u}):o.length>0&&(a.update=u,delete a.value,delete a.on);const l=n.find((e=>e.name===r+aX)),c=XG(t.bind)&&t.bind.legend;return l&&(t.events?l.on.push(Object.assign(Object.assign({},l.on[0]),{events:c})):l.on[0].events=c),n}},fX="_translate_anchor",pX="_translate_delta",gX={has:e=>"interval"===e.type&&e.translate,signals:(e,t,n)=>{const r=t.name,i=lX.has(t),a=r+fX,{x:s,y:o}=t.project.hasChannel;let u=VB(t.translate,"scope");return i||(u=u.map((e=>(e.between[0].markname=r+CX,e)))),n.push({name:a,value:{},on:[{events:u.map((e=>e.between[0])),update:"{x: x(unit), y: y(unit)"+(void 0!==s?", extent_x: "+(i?cX(e,ZL):`slice(${s.signals.visual})`):"")+(void 0!==o?", extent_y: "+(i?cX(e,eP):`slice(${o.signals.visual})`):"")+"}"}]},{name:r+pX,value:{},on:[{events:u,update:`{x: ${a}.x - x(unit), y: ${a}.y - y(unit)}`}]}),void 0!==s&&mX(e,t,s,"width",n),void 0!==o&&mX(e,t,o,"height",n),n}};function mX(e,t,n,r,i){var a;const s=t.name,o=s+fX,u=s+pX,l=n.channel,c=lX.has(t),d=i.filter((e=>e.name===n.signals[c?"data":"visual"]))[0],h=e.getSizeSignalRef(r).signal,f=e.getScaleComponent(l),p=f.get("type"),g=`${o}.extent_${l}`,m=`${c?"log"===p?"panLog":"pow"===p?"panPow":"panLinear":"panLinear"}(${g}, ${`${c&&l===ZL?"-":""}${u}.${l} / `+(c?`${h}`:`span(${g})`)}`+(c&&"pow"===p?`, ${null!==(a=f.get("exponent"))&&void 0!==a?a:1}`:"")+")";d.on.push({events:{signal:u},update:c?m:`clampRange(${m}, 0, ${h})`})}const yX="_zoom_delta",vX={has:e=>"interval"===e.type&&e.zoom,signals:(e,t,n)=>{const r=t.name,i=lX.has(t),a=r+yX,{x:s,y:o}=t.project.hasChannel,u=mz(e.scaleName(ZL)),l=mz(e.scaleName(eP));let c=VB(t.zoom,"scope");return i||(c=c.map((e=>(e.markname=r+CX,e)))),n.push({name:r+"_zoom_anchor",on:[{events:c,update:i?"{"+[u?`x: invert(${u}, x(unit))`:"",l?`y: invert(${l}, y(unit))`:""].filter((e=>!!e)).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:a,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),void 0!==s&&bX(e,t,s,"width",n),void 0!==o&&bX(e,t,o,"height",n),n}};function bX(e,t,n,r,i){var a;const s=t.name,o=n.channel,u=lX.has(t),l=i.filter((e=>e.name===n.signals[u?"data":"visual"]))[0],c=e.getSizeSignalRef(r).signal,d=e.getScaleComponent(o),h=d.get("type"),f=u?cX(e,o):l.name,p=s+yX,g=`${u?"log"===h?"zoomLog":"pow"===h?"zoomPow":"zoomLinear":"zoomLinear"}(${f}, ${s}_zoom_anchor.${o}, ${p}`+(u&&"pow"===h?`, ${null!==(a=d.get("exponent"))&&void 0!==a?a:1}`:"")+")";l.on.push({events:{signal:p},update:u?g:`clampRange(${g}, 0, ${c})`})}const xX=[nX,sX,lX,hX,gX,vX,iX,YH,oX];function wX(e,t){for(const n of xX)n.has(e)&&t(n)}function kX(e,t=!0,n=nz){if(iz(e)){const r=e.map((e=>kX(e,t,n)));return t?`[${r.join(", ")}]`:r}return bU(e)?n(t?CU(e):function(e){const t=SU(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}(e)):t?n(JSON.stringify(e)):e}function _X(e,t){return RX(e,((n,r)=>{t=r.marks?r.marks(e,n,t):t,wX(n,(r=>{r.marks&&(t=r.marks(e,n,t))}))})),t}function SX(e){return e.map((e=>(e.on&&!e.on.length&&delete e.on,e)))}const CX="_brush",AX="_scale_trigger",EX={signals:(e,t)=>{const n=t.name,r=n+eX,i=lX.has(t),a=[],s=[],o=[];if(t.translate&&!i){const e=`!event.item || event.item.mark.name !== ${mz(n+CX)}`;FX(t,((t,n)=>{var r;const i=cz(null!==(r=n.between[0].filter)&&void 0!==r?r:n.between[0].filter=[]);return i.indexOf(e)<0&&i.push(e),t}))}t.project.items.forEach(((n,r)=>{const i=n.channel;if(i!==ZL&&i!==eP)return void vU("Interval selections only support x and y encoding channels.");const u=t.init?t.init[r]:null,l=function(e,t,n,r){const i=n.channel,a=n.signals.visual,s=n.signals.data,o=lX.has(t),u=mz(e.scaleName(i)),l=e.getScaleComponent(i),c=l?l.get("type"):void 0,d=e=>`scale(${u}, ${e})`,h=e.getSizeSignalRef(i===ZL?"width":"height").signal,f=`${i}(unit)`,p=FX(t,((e,t)=>[...e,{events:t.between[0],update:`[${f}, ${f}]`},{events:t,update:`[${a}[0], clamp(${f}, 0, ${h})]`}]));return p.push({events:{signal:t.name+AX},update:wW(c)?`[${d(`${s}[0]`)}, ${d(`${s}[1]`)}]`:"[0, 0]"}),o?[{name:s,on:[]}]:[Object.assign(Object.assign({name:a},r?{init:kX(r,!0,d)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:s},r?{init:kX(r)}:{}),{on:[{events:{signal:a},update:`${a}[0] === ${a}[1] ? null : invert(${u}, ${a})`}]})]}(e,t,n,u),c=n.signals.data,d=n.signals.visual,h=mz(e.scaleName(i)),f=wW(e.getScaleComponent(i).get("type"))?"+":"";a.push(...l),s.push(c),o.push({scaleName:e.scaleName(i),expr:`(!isArray(${c}) || (${f}invert(${h}, ${d})[0] === ${f}${c}[0] && ${f}invert(${h}, ${d})[1] === ${f}${c}[1]))`})})),i||a.push({name:n+AX,value:{},on:[{events:o.map((e=>({scale:e.scaleName}))),update:o.map((e=>e.expr)).join(" && ")+` ? ${n+AX} : {}`}]});const u=t.init,l=`unit: ${BX(e)}, fields: ${r}, values`;return a.concat(Object.assign(Object.assign({name:n+TX},u?{init:`{${l}: ${kX(u)}}`}:{}),{on:[{events:[{signal:s.join(" || ")}],update:s.join(" && ")+` ? {${l}: [${s}]} : null`}]}))},modifyExpr:(e,t)=>t.name+TX+", "+("global"===t.resolve?"true":`{unit: ${BX(e)}}`),marks:(e,t,n)=>{const r=t.name,{x:i,y:a}=t.project.hasChannel,s=i&&i.signals.visual,o=a&&a.signals.visual,u=`data(${mz(t.name+$X)})`;if(lX.has(t))return n;const l={x:void 0!==i?{signal:`${s}[0]`}:{value:0},y:void 0!==a?{signal:`${o}[0]`}:{value:0},x2:void 0!==i?{signal:`${s}[1]`}:{field:{group:"width"}},y2:void 0!==a?{signal:`${o}[1]`}:{field:{group:"height"}}};if("global"===t.resolve)for(const t of qz(l))l[t]=[Object.assign({test:`${u}.length && ${u}[0].unit === ${BX(e)}`},l[t]),{value:0}];const c=t.mark,{fill:d,fillOpacity:h,cursor:f}=c,p=vz(c,["fill","fillOpacity","cursor"]),g=qz(p).reduce(((e,t)=>(e[t]=[{test:[void 0!==i&&`${s}[0] !== ${s}[1]`,void 0!==a&&`${o}[0] !== ${o}[1]`].filter((e=>e)).join(" && "),value:p[t]},{value:null}],e)),{});return[{name:r+CX+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:d},fillOpacity:{value:h}},update:l}},...n,{name:r+CX,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},f?{cursor:{value:f}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},l),g)}}]}};function FX(e,t){return e.events.reduce(((e,n)=>n.between?t(e,n):(vU(`${n} is not an ordered event stream for interval selections.`),e)),[])}function IX(e,t){const n=t.name,r=n+eX,i=t.project,a="(item().isVoronoi ? datum.datum : datum)",s=i.items.map((t=>{const n=e.fieldDef(t.channel);return n&&n.bin?`[${a}[${mz(e.vgField(t.channel,{}))}], ${a}[${mz(e.vgField(t.channel,{binSuffix:"end"}))}]]`:`${a}[${mz(t.field)}]`})).join(", "),o=`unit: ${BX(e)}, fields: ${r}, values`,u=t.events;return[{name:n+TX,on:u?[{events:u,update:`datum && item().mark.marktype !== 'group' ? {${o}: [${s}]} : null`,force:!0}]:[]}]}const DX={signals:IX,modifyExpr:(e,t)=>t.name+TX+", "+("global"===t.resolve?"null":`{unit: ${BX(e)}}`)},NX={signals:IX,modifyExpr:(e,t)=>t.name+TX+", "+("global"===t.resolve?"true":`{unit: ${BX(e)}}`)},$X="_store",TX="_tuple",OX="vlSelectionResolve",MX={single:NX,multi:DX,interval:EX};function RX(e,t){const n=e.component.selection;if(n)for(const e of Hz(n))if(!0===t(e,MX[e.type]))break}function BX(e,{escape:t}={escape:!0}){let n=t?mz(e.name):e.name;const r=function(e){let t=e.parent;for(;t&&!bJ(t);)t=t.parent;return t}(e);if(r){const{facet:e}=r;for(const t of BP)e[t]&&(n+=` + '__facet_${t}_' + (facet[${mz(r.vgField(t))}])`)}return n}function zX(e){let t=!1;return RX(e,(e=>{t=t||e.project.items.some((e=>e.field===GG))})),t}function LX(e){this.type=e}var PX,jX,UX,WX,VX;LX.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(t=function(e){switch(e.type){case"ArrayExpression":return e.elements;case"BinaryExpression":case"LogicalExpression":return[e.left,e.right];case"CallExpression":return[e.callee].concat(e.arguments);case"ConditionalExpression":return[e.test,e.consequent,e.alternate];case"MemberExpression":return[e.object,e.property];case"ObjectExpression":return e.properties;case"Property":return[e.key,e.value];case"UnaryExpression":return[e.argument];default:return[]}}(this),n=0,r=t.length;n<r;++n)if(t[n].visit(e))return 1},(PX={})[1]="Boolean",PX[2]="<end>",PX[3]="Identifier",PX[4]="Keyword",PX[5]="Null",PX[6]="Numeric",PX[7]="Punctuator",PX[8]="String",PX[9]="RegularExpression";var GX="Identifier",qX="Unexpected token %0",HX="Invalid regular expression",XX="Invalid regular expression: missing /",KX="Octal literals are not allowed in strict mode.",YX="ILLEGAL",QX="Disabled.",JX=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),ZX=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function eK(e,t){if(!e)throw new Error("ASSERT: "+t)}function tK(e){return e>=48&&e<=57}function nK(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function rK(e){return"01234567".indexOf(e)>=0}function iK(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function aK(e){return 10===e||13===e||8232===e||8233===e}function sK(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&JX.test(String.fromCharCode(e))}function oK(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&ZX.test(String.fromCharCode(e))}var uK={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function lK(){for(var e;UX<WX&&(iK(e=jX.charCodeAt(UX))||aK(e));)++UX}function cK(e){var t,n,r,i=0;for(n="u"===e?4:2,t=0;t<n;++t)UX<WX&&nK(jX[UX])?(r=jX[UX++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):_K({},qX,YX);return String.fromCharCode(i)}function dK(){var e,t,n,r;for(t=0,"}"===(e=jX[UX])&&_K({},qX,YX);UX<WX&&nK(e=jX[UX++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&_K({},qX,YX),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function hK(){var e,t;for(e=jX.charCodeAt(UX++),t=String.fromCharCode(e),92===e&&(117!==jX.charCodeAt(UX)&&_K({},qX,YX),++UX,(e=cK("u"))&&"\\"!==e&&sK(e.charCodeAt(0))||_K({},qX,YX),t=e);UX<WX&&oK(e=jX.charCodeAt(UX));)++UX,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==jX.charCodeAt(UX)&&_K({},qX,YX),++UX,(e=cK("u"))&&"\\"!==e&&oK(e.charCodeAt(0))||_K({},qX,YX),t+=e);return t}function fK(){var e,t,n,r,i=UX,a=jX.charCodeAt(UX),s=jX[UX];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++UX,{type:7,value:String.fromCharCode(a),start:i,end:UX};default:if(61===(e=jX.charCodeAt(UX+1)))switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return UX+=2,{type:7,value:String.fromCharCode(a)+String.fromCharCode(e),start:i,end:UX};case 33:case 61:return UX+=2,61===jX.charCodeAt(UX)&&++UX,{type:7,value:jX.slice(i,UX),start:i,end:UX}}}return">>>="===(r=jX.substr(UX,4))?{type:7,value:r,start:i,end:UX+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:i,end:UX+=3}:s===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(s)>=0||"=>"===t?{type:7,value:t,start:i,end:UX+=2}:"<>=!+-*%&|^/".indexOf(s)>=0?{type:7,value:s,start:i,end:++UX}:void _K({},qX,YX)}function pK(){var e,t,n;if(eK(tK((n=jX[UX]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=UX,e="","."!==n){if(e=jX[UX++],n=jX[UX],"0"===e){if("x"===n||"X"===n)return++UX,function(e){for(var t="";UX<WX&&nK(jX[UX]);)t+=jX[UX++];return 0===t.length&&_K({},qX,YX),sK(jX.charCodeAt(UX))&&_K({},qX,YX),{type:6,value:parseInt("0x"+t,16),start:e,end:UX}}(t);if(rK(n))return function(e){for(var t="0"+jX[UX++];UX<WX&&rK(jX[UX]);)t+=jX[UX++];return(sK(jX.charCodeAt(UX))||tK(jX.charCodeAt(UX)))&&_K({},qX,YX),{type:6,value:parseInt(t,8),octal:!0,start:e,end:UX}}(t);n&&tK(n.charCodeAt(0))&&_K({},qX,YX)}for(;tK(jX.charCodeAt(UX));)e+=jX[UX++];n=jX[UX]}if("."===n){for(e+=jX[UX++];tK(jX.charCodeAt(UX));)e+=jX[UX++];n=jX[UX]}if("e"===n||"E"===n)if(e+=jX[UX++],"+"!==(n=jX[UX])&&"-"!==n||(e+=jX[UX++]),tK(jX.charCodeAt(UX)))for(;tK(jX.charCodeAt(UX));)e+=jX[UX++];else _K({},qX,YX);return sK(jX.charCodeAt(UX))&&_K({},qX,YX),{type:6,value:parseFloat(e),start:t,end:UX}}function gK(){var e;return lK(),UX>=WX?{type:2,start:UX,end:UX}:sK(e=jX.charCodeAt(UX))?function(){var e,t;return e=UX,t=92===jX.charCodeAt(UX)?hK():function(){var e,t;for(e=UX++;UX<WX;){if(92===(t=jX.charCodeAt(UX)))return UX=e,hK();if(!oK(t))break;++UX}return jX.slice(e,UX)}(),{type:1===t.length?3:uK.hasOwnProperty(t)?4:"null"===t?5:"true"===t||"false"===t?1:3,value:t,start:e,end:UX}}():40===e||41===e||59===e?fK():39===e||34===e?function(){var e,t,n,r,i="",a=!1;for(eK("'"===(e=jX[UX])||'"'===e,"String literal must starts with a quote"),t=UX,++UX;UX<WX;){if((n=jX[UX++])===e){e="";break}if("\\"===n)if((n=jX[UX++])&&aK(n.charCodeAt(0)))"\r"===n&&"\n"===jX[UX]&&++UX;else switch(n){case"u":case"x":"{"===jX[UX]?(++UX,i+=dK()):i+=cK(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:rK(n)?(0!==(r="01234567".indexOf(n))&&(a=!0),UX<WX&&rK(jX[UX])&&(a=!0,r=8*r+"01234567".indexOf(jX[UX++]),"0123".indexOf(n)>=0&&UX<WX&&rK(jX[UX])&&(r=8*r+"01234567".indexOf(jX[UX++]))),i+=String.fromCharCode(r)):i+=n}else{if(aK(n.charCodeAt(0)))break;i+=n}}return""!==e&&_K({},qX,YX),{type:8,value:i,octal:a,start:t,end:UX}}():46===e?tK(jX.charCodeAt(UX+1))?pK():fK():tK(e)?pK():fK()}function mK(){var e;return UX=(e=VX).end,VX=gK(),UX=e.end,e}function yK(){var e;e=UX,VX=gK(),UX=e}function vK(e,t,n){var r=new LX("||"===e||"&&"===e?"LogicalExpression":"BinaryExpression");return r.operator=e,r.left=t,r.right=n,r}function bK(e){var t=new LX(GX);return t.name=e,t}function xK(e){var t=new LX("Literal");return t.value=e.value,t.raw=jX.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function wK(e,t,n){var r=new LX("MemberExpression");return r.computed="["===e,r.object=t,r.property=n,r.computed||(n.member=!0),r}function kK(e,t,n){var r=new LX("Property");return r.key=t,r.value=n,r.kind=e,r}function _K(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(function(e,t){return eK(t<r.length,"Message reference must be in range"),r[t]}));throw(n=new Error(i)).index=UX,n.description=i,n}function SK(e){2===e.type&&_K(e,"Unexpected end of input"),6===e.type&&_K(e,"Unexpected number"),8===e.type&&_K(e,"Unexpected string"),3===e.type&&_K(e,"Unexpected identifier"),4===e.type&&_K(e,"Unexpected reserved word"),_K(e,qX,e.value)}function CK(e){var t=mK();7===t.type&&t.value===e||SK(t)}function AK(e){return 7===VX.type&&VX.value===e}function EK(e){return 4===VX.type&&VX.value===e}function FK(){var e;return UX=VX.start,8===(e=mK()).type||6===e.type?(e.octal&&_K(e,KX),xK(e)):bK(e.value)}function IK(){var e,t,n;return UX=VX.start,3===(e=VX).type?(n=FK(),CK(":"),kK("init",n,BK())):2!==e.type&&7!==e.type?(t=FK(),CK(":"),kK("init",t,BK())):void SK(e)}var DK={if:1};function NK(){var e,t,n;if(AK("("))return function(){var e;return CK("("),e=zK(),CK(")"),e}();if(AK("["))return function(){var e=[];for(UX=VX.start,CK("[");!AK("]");)AK(",")?(mK(),e.push(null)):(e.push(BK()),AK("]")||CK(","));return mK(),function(e){var t=new LX("ArrayExpression");return t.elements=e,t}(e)}();if(AK("{"))return function(){var e,t,n=[],r={},i=String;for(UX=VX.start,CK("{");!AK("}");)t="$"+((e=IK()).key.type===GX?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?_K({},"Duplicate data property in object literal not allowed in strict mode"):r[t]=!0,n.push(e),AK("}")||CK(",");return CK("}"),function(e){var t=new LX("ObjectExpression");return t.properties=e,t}(n)}();if(e=VX.type,UX=VX.start,3===e||DK[VX.value])n=bK(mK().value);else if(8===e||6===e)VX.octal&&_K(VX,KX),n=xK(mK());else{if(4===e)throw new Error(QX);1===e?((t=mK()).value="true"===t.value,n=xK(t)):5===e?((t=mK()).value=null,n=xK(t)):AK("/")||AK("/=")?(n=xK(function(){var e,t,n,r;return VX=null,lK(),e=UX,t=function(){var e,t,n,r;for(eK("/"===(e=jX[UX]),"Regular expression literal must start with a slash"),t=jX[UX++],n=!1,r=!1;UX<WX;)if(t+=e=jX[UX++],"\\"===e)aK((e=jX[UX++]).charCodeAt(0))&&_K({},XX),t+=e;else if(aK(e.charCodeAt(0)))_K({},XX);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||_K({},XX),{value:t.substr(1,t.length-2),literal:t}}(),n=function(){var e,t,n;for(t="",n="";UX<WX&&oK((e=jX[UX]).charCodeAt(0));)++UX,"\\"===e&&UX<WX?_K({},qX,YX):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&_K({},HX,n),{value:n,literal:t}}(),r=function(e,t){var n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(function(e,t){if(parseInt(t,16)<=1114111)return"x";_K({},HX)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(e){_K({},HX)}try{return new RegExp(e,t)}catch(e){return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:UX}}()),yK()):SK(mK())}return n}function $K(){var e=[];if(CK("("),!AK(")"))for(;UX<WX&&(e.push(BK()),!AK(")"));)CK(",");return CK(")"),e}function TK(){var e;return CK("["),e=zK(),CK("]"),e}function OK(){var e=function(){var e,t,n,r,i;for(e=NK();;)if(AK("."))e=wK(".",e,(i=void 0,CK("."),UX=VX.start,function(e){return 3===e.type||4===e.type||1===e.type||5===e.type}(i=mK())||SK(i),bK(i.value)));else if(AK("("))t=e,n=$K(),r=void 0,(r=new LX("CallExpression")).callee=t,r.arguments=n,e=r;else{if(!AK("["))break;e=wK("[",e,TK())}return e}();if(7===VX.type&&(AK("++")||AK("--")))throw new Error(QX);return e}function MK(){var e,t;if(7!==VX.type&&4!==VX.type)t=OK();else{if(AK("++")||AK("--"))throw new Error(QX);if(AK("+")||AK("-")||AK("~")||AK("!"))e=mK(),t=MK(),t=function(e,t){var n=new LX("UnaryExpression");return n.operator=e,n.argument=t,n.prefix=!0,n}(e.value,t);else{if(EK("delete")||EK("void")||EK("typeof"))throw new Error(QX);t=OK()}}return t}function RK(e){var t=0;if(7!==e.type&&4!==e.type)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function BK(){var e,t;return e=function(){var e,t,n,r,i,a,s,o,u,l;if(e=VX,u=MK(),0===(i=RK(r=VX)))return u;for(r.prec=i,mK(),t=[e,VX],a=[u,r,s=MK()];(i=RK(VX))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)s=a.pop(),o=a.pop().value,u=a.pop(),t.pop(),n=vK(o,u,s),a.push(n);(r=mK()).prec=i,a.push(r),t.push(VX),n=MK(),a.push(n)}for(n=a[l=a.length-1],t.pop();l>1;)t.pop(),n=vK(a[l-1].value,a[l-2],n),l-=2;return n}(),AK("?")&&(mK(),t=BK(),CK(":"),e=function(e,t,n){var r=new LX("ConditionalExpression");return r.test=e,r.consequent=t,r.alternate=n,r}(e,t,BK())),e}function zK(){var e=BK();if(AK(","))throw new Error(QX);return e}function LK(e,t,n){return e.fields=t||[],e.fname=n,e}function PK(e){return 1===e.length?jK(e[0]):UK(e)}const jK=e=>function(t){return t[e]},UK=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function WK(e){throw Error(e)}function VK(e){const t=[];return"Identifier"===e.type?[e.name]:"Literal"===e.type?[e.value]:("MemberExpression"===e.type&&(t.push(...VK(e.object)),t.push(...VK(e.property))),t)}function GK(e){return"MemberExpression"===e.object.type?GK(e.object):"datum"===e.object.name}function qK(e){const t=function(e){UX=0,WX=(jX=e).length,VX=null,yK();var t=zK();if(2!==VX.type)throw new Error("Unexpect token after expression.");return t}(e),n=new Set;return t.visit((e=>{"MemberExpression"===e.type&&GK(e)&&n.add(VK(e).slice(1).join("."))})),n}(function(e,t,n){const r=function(e){const t=[],n=e.length;let r,i,a,s=null,o=0,u="";function l(){t.push(u+e.substring(r,i)),u="",r=i+1}for(e+="",r=i=0;i<n;++i)if(a=e[i],"\\"===a)u+=e.substring(r,i),u+=e.substring(++i,++i),r=i;else if(a===s)l(),s=null,o=-1;else{if(s)continue;r===o&&'"'===a||r===o&&"'"===a?(r=i+1,s=a):"."!==a||o?"["===a?(i>r&&l(),o=r=i+1):"]"===a&&(o||WK("Access path missing open bracket: "+e),o>0&&l(),o=0,r=i+1):i>r?l():r=i+1}return o&&WK("Access path missing closing bracket: "+e),s&&WK("Access path missing closing quote: "+e),i>r&&(i++,l()),t}(e);e=1===r.length?r[0]:e,LK((n&&n.get||PK)(r),[e],t||e)})("id"),LK((e=>e),[],"identity"),LK((()=>0),[],"zero"),LK((()=>1),[],"one"),LK((()=>!0),[],"true"),LK((()=>!1),[],"false"),Array.isArray,Object.prototype.hasOwnProperty;class HK extends QH{constructor(e,t,n){super(e),this.model=t,this.filter=n,this.expr=YK(this.model,this.filter,this),this._dependentFields=qK(this.expr)}clone(){return new HK(null,this.model,Nz(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function XK(e,t,n,r="datum"){const i=[],a=Qz(t,(function(t){const a=Yz(t),s=e.getSelectionComponent(a,t),o=mz(a+$X);if(s.project.timeUnit){const t=null!=n?n:e.component.data.raw,r=s.project.timeUnit.clone();t.parent?r.insertAsParentOf(t):t.parent=r}return"none"!==s.empty&&i.push(o),`vlSelectionTest(${o}, ${r}`+("global"===s.resolve?")":`, ${mz(s.resolve)})`)}));return(i.length?"!("+i.map((e=>`length(data(${e}))`)).join(" || ")+") || ":"")+`(${a})`}function KK(e,t){const n=t.encoding;let r=t.field;if(n||r){if(n&&!r){const i=e.project.items.filter((e=>e.channel===n));!i.length||i.length>1?(r=e.project.items[0].field,vU((i.length?"Multiple ":"No ")+`matching ${mz(n)} encoding found for selection ${mz(t.selection)}. `+`Using "field": ${mz(r)}.`)):r=i[0].field}}else r=e.project.items[0].field,e.project.items.length>1&&vU(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${mz(r)}.`);return`${e.name}[${mz(r)}]`}function YK(e,t,n){return Qz(t,(t=>gz(t)?t:function(e){return null==e?void 0:e.selection}(t)?XK(e,t.selection,n):KU(t)))}function QK(e,t,n,r){var i,a,s;e.encode=null!==(i=e.encode)&&void 0!==i?i:{},e.encode[t]=null!==(a=e.encode[t])&&void 0!==a?a:{},e.encode[t].update=null!==(s=e.encode[t].update)&&void 0!==s?s:{},e.encode[t].update[n]=r}function JK(e,t,n,r={header:!1}){var i,a;const s=e.combine(),{disable:o,orient:u,scale:l,labelExpr:c,title:d,zindex:h}=s,f=vz(s,["disable","orient","scale","labelExpr","title","zindex"]);if(!o){for(const e in f){const n=fL[e],r=f[e];if(n&&n!==t&&"both"!==n)delete f[e];else if(dL(r)){const{condition:t}=r,n=vz(r,["condition"]),i=cz(t),a=cL[e];if(a){const{vgProp:t,part:r}=a,s=[...i.map((e=>{const{test:t}=e,n=vz(e,["test"]);return Object.assign({test:YK(null,t)},n)})),n];QK(f,r,t,s),delete f[e]}else if(null===a){const t={signal:i.map((e=>{const{test:t}=e,n=vz(e,["test"]);return`${YK(null,t)} ? ${eG(n)} : `})).join("")+eG(n)};f[e]=t}}else if(OU(r)){const t=cL[e];if(t){const{vgProp:n,part:i}=t;QK(f,i,n,r),delete f[e]}}}if("grid"===t){if(!f.grid)return;if(f.encode){const{grid:e}=f.encode;f.encode=Object.assign({},e?{grid:e}:{}),Gz(f.encode)&&delete f.encode}return Object.assign(Object.assign({scale:l,orient:u},f),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:sL(h,0)})}{if(!r.header&&e.mainExtracted)return;if(void 0!==c){let e=c;(null===(a=null===(i=f.encode)||void 0===i?void 0:i.labels)||void 0===a?void 0:a.update)&&OU(f.encode.labels.update.text)&&(e=rL(c,"datum.label",f.encode.labels.update.text.signal)),QK(f,"labels","text",{signal:e})}if(null===f.labelAlign&&delete f.labelAlign,f.encode){for(const t of hL)e.hasAxisPart(t)||delete f.encode[t];Gz(f.encode)&&delete f.encode}const t=function(e,t){if(e)return iz(e)&&!JV(e)?e.map((e=>zV(e,t))).join(", "):e}(d,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:l,orient:u,grid:!1},t?{title:t}:{}),f),!1===n.aria?{aria:!1}:{}),{zindex:sL(h,0)})}}}function ZK(e){const{axes:t}=e.component,n=[];for(const r of mj)if(t[r])for(const i of t[r])if(!i.get("disable")&&!i.get("gridScale")){const t="x"===r?"height":"width",i=e.getSizeSignalRef(t).signal;t!==i&&n.push({name:t,update:i})}return n}const eY={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},tY={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},nY=qz(eY),rY=qz(tY);function iY(e,t,n,r){return Object.assign.apply(null,[{},...e.map((e=>{if("axisOrient"===e){const e="x"===n?"bottom":"left",i=t["x"===n?"axisBottom":"axisLeft"]||{},a=t["x"===n?"axisTop":"axisRight"]||{},s=new Set([...qz(i),...qz(a)]),o={};for(const t of s.values())o[t]={signal:`${r.signal} === "${e}" ? ${tG(i[t])} : ${tG(a[t])}`};return o}return t[e]}))])}function aY(e,t){var n;const r=[{}];for(const i of e){let e=null===(n=t[i])||void 0===n?void 0:n.style;if(e){e=cz(e);for(const n of e)r.push(t.style[n])}}return Object.assign.apply(null,r)}function sY(e,t,n,r={}){var i;const a=sG(e,n,t.style);if(void 0!==a)return{configFrom:"style",configValue:a};for(const t of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(void 0!==(null===(i=r[t])||void 0===i?void 0:i[e]))return{configFrom:t,configValue:r[t][e]};return{}}const oY={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:r,formatType:i}=n;return YW(e,e.type,r,i,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return QW(r,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var r;return(!vV(e)||!Pj(e.bin))&&(null!==(r=t.grid)&&void 0!==r?r:function(e,t){return!xW(e)&&vV(t)&&!Lj(null==t?void 0:t.bin)}(n,e))},gridScale:({model:e,channel:t})=>function(e,t){const n="x"===t?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n)}(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelAlign||cY(t,n,r),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelBaseline||lY(t,n,r),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var r;return null!==(r=e.labelFlush)&&void 0!==r?r:function(e,t){if("x"===t&&Bz(["quantitative","temporal"],e))return!0}(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var r;return null!==(r=e.labelOverlap)&&void 0!==r?r:function(e,t){if("nominal"!==e)return"log"!==t||"greedy"}(t.type,n)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:r,scaleType:i})=>{var a;const s="x"===e?"width":"y"===e?"height":void 0,o=s?t.getSizeSignalRef(s):void 0;return null!==(a=n.tickCount)&&void 0!==a?a:function({fieldOrDatumDef:e,scaleType:t,size:n,values:r}){var i;if(!r&&!xW(t)&&"log"!==t){if(vV(e)){if(Lj(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&Bz(["month","hours","day","quarter"],null===(i=TU(e.timeUnit))||void 0===i?void 0:i.unit))return}return{signal:`ceil(${n.signal}/40)`}}}({fieldOrDatumDef:r,scaleType:i,size:o,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(void 0!==e.title)return e.title;const r=dY(t,n);if(void 0!==r)return r;const i=t.typedFieldDef(n),a="x"===n?"x2":"y2",s=t.fieldDef(a);return uG(i?[dV(i)]:[],vV(s)?[dV(s)]:[])},values:({axis:e,fieldOrDatumDef:t})=>function(e,t){const n=e.values;return iz(n)?KV(t,n):OU(n)?n:void 0}(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var r;return null!==(r=e.zindex)&&void 0!==r?r:function(e,t){return"rect"===e&&NV(t)?1:0}(n,t)}};function uY(e){return`(((${e.signal} % 360) + 360) % 360)`}function lY(e,t,n,r){if(void 0!==e){if("x"===n){if(OU(e)){const n=uY(e);return{signal:`(45 < ${n} && ${n} < 135) || (225 < ${n} && ${n} < 315) ? "middle" :(${n} <= 45 || 315 <= ${n}) === ${OU(t)?`(${t.signal} === "top")`:"top"===t} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(OU(t)){const n=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${n} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==("top"===t)?"bottom":"top"}if(OU(e)){const n=uY(e);return{signal:`${n} <= 45 || 315 <= ${n} || (135 <= ${n} && ${n} <= 225) ? ${r?'"middle"':"null"} : (45 <= ${n} && ${n} <= 135) === ${OU(t)?`(${t.signal} === "left")`:"left"===t} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return r?"middle":null;if(OU(t)){const n=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${n} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==("left"===t)?"top":"bottom"}}function cY(e,t,n){if(void 0===e)return;const r="x"===n,i=r?0:90,a=r?"bottom":"left";if(OU(e)){const n=uY(e);return{signal:`(${i?"("+n+" + 90)":n} % 180 === 0) ? ${r?null:'"center"'} :(${i} < ${n} && ${n} < ${180+i}) === ${OU(t)?`(${t.signal} === "${a}")`:t===a} ? "left" : "right"`}}if((e+i)%180==0)return r?null:"center";if(OU(t)){const n=i<e&&e<180+i?"===":"!==";return{signal:`${t.signal} ${n} "${a}" ? "left" : "right"`}}return(i<e&&e<180+i)==(t===a)?"left":"right"}function dY(e,t){const n="x"===t?"x2":"y2",r=e.fieldDef(t),i=e.fieldDef(n),a=r?r.title:void 0,s=i?i.title:void 0;return a&&s?lG(a,s):a||s||(void 0!==a?a:void 0!==s?s:void 0)}class hY extends QH{constructor(e,t){super(e),this.transform=t,this._dependentFields=qK(this.transform.calculate)}clone(){return new hY(null,Nz(this.transform))}static parseAllForSortIndex(e,t){return t.forEachFieldDef(((t,n)=>{if(AV(t)&&oV(t.sort)){const{field:r,timeUnit:i}=t,a=t.sort,s=a.map(((e,t)=>`${KU({field:r,timeUnit:i,equal:e})} ? ${t} : `)).join("")+a.length;e=new hY(e,{calculate:s,as:fY(t,n,{forAs:!0})})}})),e}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${Mz(this.transform)}`}}function fY(e,t,n){return DV(e,Object.assign({prefix:t,suffix:"sort_index"},null!=n?n:{}))}function pY(e,t){return Bz(["top","bottom"],t)?"column":Bz(["left","right"],t)||"row"===e?"row":"column"}function gY(e,t,n,r){const i="row"===r?n.headerRow:"column"===r?n.headerColumn:n.headerFacet;return sL(((null==t?void 0:t.header)||{})[e],i[e],n.header[e])}function mY(e,t,n,r){const i={};for(const a of e){const e=gY(a,t,n,r);void 0!==e&&(i[a]=e)}return i}const yY=["row","column"],vY=["header","footer"];function bY(e,t){const n=e.component.layoutHeaders[t].title,r=e.config?e.config:void 0,i=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:a,titleAngle:s,titleOrient:o}=mY(["titleAnchor","titleAngle","titleOrient"],i,r,t),u=pY(t,o),l=uL(s);return{name:`${t}-title`,type:"group",role:`${u}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},"row"===t?{orient:"left"}:{}),{style:"guide-title"}),wY(l,u)),xY(u,l,a)),FY(r,i,t,nY,eY))}}function xY(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const r=cY(t,"row"===e?"left":"top","row"===e?"y":"x");return r?{align:r}:{}}function wY(e,t){const n=lY(e,"row"===t?"left":"top","row"===t?"y":"x",!0);return n?{baseline:n}:{}}function kY(e,t){const n=e.component.layoutHeaders[t],r=[];for(const i of vY)if(n[i])for(const a of n[i]){const s=CY(e,t,i,n,a);null!=s&&r.push(s)}return r}function _Y(e,t){var n;const{sort:r}=e;return sV(r)?{field:DV(r,{expr:"datum"}),order:null!==(n=r.order)&&void 0!==n?n:"ascending"}:iz(r)?{field:fY(e,t,{expr:"datum"}),order:"ascending"}:{field:DV(e,{expr:"datum"}),order:null!=r?r:"ascending"}}function SY(e,t,n){const{format:r,formatType:i,labelAngle:a,labelAnchor:s,labelOrient:o,labelExpr:u}=mY(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e,n,t),l=HW({fieldOrDatumDef:e,format:r,formatType:i,expr:"parent",config:n}).signal,c=pY(t,o);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:u?rL(rL(u,"datum.label",l),"datum.value",DV(e,{expr:"parent"})):l}},"row"===t?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),wY(a,c)),xY(c,a,s)),FY(n,e,t,rY,tY))}function CY(e,t,n,r,i){if(i){let a=null;const{facetFieldDef:s}=r,o=e.config?e.config:void 0;if(s&&i.labels){const{labelOrient:e}=mY(["labelOrient"],s,o,t);("row"===t&&!Bz(["top","bottom"],e)||"column"===t&&!Bz(["left","right"],e))&&(a=SY(s,t,o))}const u=bJ(e)&&!uV(e.facet),l=i.axes,c=(null==l?void 0:l.length)>0;if(a||c){const o="row"===t?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},r.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:_Y(s,t)}:{}),c&&u?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),a?{title:a}:{}),i.sizeSignal?{encode:{update:{[o]:i.sizeSignal}}}:{}),c?{axes:l}:{})}}return null}const AY={column:{start:0,end:1},row:{start:1,end:0}};function EY(e,t){return AY[t][e]}function FY(e,t,n,r,i){const a={};for(const s of r){if(!i[s])continue;const r=gY(s,t,e,n);void 0!==r&&(a[i[s]]=r)}return a}function IY(e){return[...DY(e,"width"),...DY(e,"height"),...DY(e,"childWidth"),...DY(e,"childHeight")]}function DY(e,t){const n="width"===t?"x":"y",r=e.component.layoutSize.get(t);if(!r||"merged"===r)return[];const i=e.getSizeSignalRef(t).signal;if("step"===r){const t=e.getScaleComponent(n);if(t){const r=t.get("type"),a=t.get("range");if(xW(r)&&MU(a)){const r=e.scaleName(n);return bJ(e.parent)&&"independent"===e.parent.component.resolve.scale[n]?[NY(r,a)]:[NY(r,a),{name:i,update:$Y(r,t,`domain('${r}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}if("container"==r){const t=i.endsWith("width"),n=t?"containerSize()[0]":"containerSize()[1]",r=`isFinite(${n}) ? ${n} : ${tq(e.config.view,t?"width":"height")}`;return[{name:i,init:r,on:[{update:r,events:"window:resize"}]}]}return[{name:i,value:r}]}function NY(e,t){return{name:e+"_step",value:t.step}}function $Y(e,t,n){const r=t.get("type"),i=t.get("padding"),a=sL(t.get("paddingOuter"),i);let s=t.get("paddingInner");return s="band"===r?void 0!==s?s:i:1,`bandspace(${n}, ${s}, ${a}) * ${e}_step`}function TY(e){return"childWidth"===e?"width":"childHeight"===e?"height":e}function OY(e,t){return qz(e).reduce(((n,r)=>{const i=e[r];return Object.assign(Object.assign({},n),kH(t,i,r,(e=>OU(e)?e:{value:e.value})))}),{})}function MY(e,t){if(wJ(t)||bJ(t))return"shared";if(xJ(t))return yj(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function RY(e,t){const n=e.scale[t],r=yj(t)?"axis":"legend";return"independent"===n?("shared"===e[r][t]&&vU(function(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}(t)),"independent"):e[r][t]||"shared"}const BY=Object.assign(Object.assign({},VG),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),zY=qz(BY);class LY extends Uq{}const PY={symbols:function(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i,legendType:a}){var s,o,u,l,c;if("symbol"!==a)return;const{markDef:d,encoding:h,config:f,mark:p}=n,g=d.filled&&"trail"!==p;let m=Object.assign(Object.assign({},function(e,t,n){for(const r of n){const n=iG(r,t.markDef,t.config);void 0!==n&&(e[r]=ZV(n))}return e}({},n,RL)),IH(n,{filled:g}));const y=null!==(s=jY(h.opacity))&&void 0!==s?s:d.opacity;if(m.fill)if("fill"===r||g&&r===dP)delete m.fill;else if(m.fill.field)i.get("symbolFillColor")?delete m.fill:(m.fill=ZV(null!==(o=f.legend.symbolBaseFillColor)&&void 0!==o?o:"black"),m.fillOpacity=ZV(null!=y?y:1));else if(iz(m.fill)){const e=null!==(c=null!==(l=UY(null!==(u=h.fill)&&void 0!==u?u:h.color))&&void 0!==l?l:d.fill)&&void 0!==c?c:g&&d.color;e&&(m.fill=ZV(e))}if(m.stroke)if("stroke"===r||!g&&r===dP)delete m.stroke;else if(m.stroke.field)delete m.stroke;else if(iz(m.stroke)){const e=sL(UY(h.stroke||h.color),d.stroke,g?d.color:void 0);e&&(m.stroke={value:e})}if(r!==yP){const e=vV(t)&&VY(0,i,t);e?m.opacity=[Object.assign({test:e},ZV(null!=y?y:1)),ZV(f.legend.unselectedOpacity)]:y&&(m.opacity=ZV(y))}return m=Object.assign(Object.assign({},m),e),Gz(m)?void 0:m},gradient:function(e,{model:t,legendType:n}){if("gradient"!==n)return;let r={};const i=jY(t.encoding.opacity)||t.markDef.opacity;return i&&(r.opacity=ZV(i)),r=Object.assign(Object.assign({},r),e),Gz(r)?void 0:r},labels:function(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i}){const a=n.legend(r)||{},s=n.config,o=vV(t)?VY(0,i,t):void 0,u=o?[{test:o,value:1},{value:s.legend.unselectedOpacity}]:void 0,{format:l,formatType:c}=a,d=GW(c)?KW({fieldOrDatumDef:t,field:"datum.value",format:l,formatType:c,config:s}):void 0,h=Object.assign(Object.assign(Object.assign({},u?{opacity:u}:{}),d?{text:d}:{}),e);return Gz(h)?void 0:h},entries:function(e,{legendCmpt:t}){const n=t.get("selections");return(null==n?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}};function jY(e){return WY(e,((e,t)=>Math.max(e,t.value)))}function UY(e){return WY(e,((e,t)=>sL(e,t.value)))}function WY(e,t){return function(e){const t=e&&e.condition;return!!t&&(iz(t)||CV(t))}(e)?cz(e.condition).reduce(t,e.value):CV(e)?e.value:void 0}function VY(e,t,n){const r=t.get("selections");if(!(null==r?void 0:r.length))return;const i=mz(n.field);return r.map((e=>`(!length(data(${mz(Yz(e)+$X)})) || (${e}[${i}] && indexof(${e}[${i}], datum.value) >= 0))`)).join(" || ")}const GY={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:r,formatType:i}=t;return YW(e,e.type,r,i,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return QW(r,t,n)},gradientLength:e=>{var t,n;const{legend:r,legendConfig:i}=e;return null!==(n=null!==(t=r.gradientLength)&&void 0!==t?t:i.gradientLength)&&void 0!==n?n:function({legendConfig:e,model:t,direction:n,orient:r,scaleType:i}){const{gradientHorizontalMaxLength:a,gradientHorizontalMinLength:s,gradientVerticalMaxLength:o,gradientVerticalMinLength:u}=e;if(kW(i))return"horizontal"===n?"top"===r||"bottom"===r?HY(t,"width",s,a):s:HY(t,"height",u,o)}(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var r,i;return null!==(i=null!==(r=e.labelOverlap)&&void 0!==r?r:t.labelOverlap)&&void 0!==i?i:function(e){if(Bz(["quantile","threshold","log"],e))return"greedy"}(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:r})=>{var i;return null!==(i=e.symbolType)&&void 0!==i?i:function(e,t,n,r){var i;if("shape"!==t){const e=null!==(i=UY(n))&&void 0!==i?i:r;if(e)return e}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(t.type,n,r.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>RV(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(MP(n)&&kW(t)){if("gradient"===e)return}else if("symbol"===e)return;return e},values:({fieldOrDatumDef:e,legend:t})=>function(e,t){const n=e.values;return iz(n)?KV(t,n):OU(n)?n:void 0}(t,e)};function qY({legendConfig:e,legendType:t,orient:n,legend:r}){var i,a;return null!==(a=null!==(i=r.direction)&&void 0!==i?i:e[t?"gradientDirection":"symbolDirection"])&&void 0!==a?a:function(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return"gradient"===t?"horizontal":void 0}}(n,t)}function HY(e,t,n,r){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${r})`}}function XY(e){const t=vJ(e)?function(e){const{encoding:t}=e,n={};for(const r of[dP,...UG]){const i=jV(t[r]);i&&e.getScaleComponent(r)&&(r===pP&&vV(i)&&i.type===rW||(n[r]=YY(e,r)))}return n}(e):function(e){const{legends:t,resolve:n}=e.component;for(const r of e.children){XY(r);for(const i of qz(r.component.legends))n.legend[i]=RY(e.component.resolve,i),"shared"===n.legend[i]&&(t[i]=QY(t[i],r.component.legends[i]),t[i]||(n.legend[i]="independent",delete t[i]))}for(const r of qz(t))for(const t of e.children)t.component.legends[r]&&"shared"===n.legend[r]&&delete t.component.legends[r];return t}(e);return e.component.legends=t,t}function KY(e,t,n,r){switch(t){case"disable":return void 0!==n;case"values":return!!(null==n?void 0:n.values);case"title":if("title"===t&&e===(null==r?void 0:r.title))return!0}return e===(n||{})[t]}function YY(e,t){var n,r,i;let a=e.legend(t);const{markDef:s,encoding:o,config:u}=e,l=u.legend,c=new LY({},function(e,t){const n=e.scaleName(t);if("trail"===e.mark){if("color"===t)return{stroke:n};if("size"===t)return{strokeWidth:n}}return"color"===t?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}(e,t));!function(e,t,n){var r;const i=null===(r=e.fieldDef(t))||void 0===r?void 0:r.field;RX(e,(e=>{var r,a;const s=null!==(r=e.project.hasField[i])&&void 0!==r?r:e.project.hasChannel[t];if(s&&hX.has(e)){const t=null!==(a=n.get("selections"))&&void 0!==a?a:[];t.push(e.name),n.set("selections",t,!1),s.hasLegend=!0}}))}(e,t,c);const d=void 0!==a?!a:l.disable;if(c.set("disable",d,void 0!==a),d)return c;a=a||{};const h=e.getScaleComponent(t).get("type"),f=jV(o[t]),p=vV(f)?null===(n=TU(f.timeUnit))||void 0===n?void 0:n.unit:void 0,g=a.orient||u.legend.orient||"right",m=function(e){const{legend:t}=e;return sL(t.type,function({channel:e,timeUnit:t,scaleType:n}){if(MP(e)){if(Bz(["quarter","month","day"],t))return"symbol";if(kW(n))return"gradient"}return"symbol"}(e))}({legend:a,channel:t,timeUnit:p,scaleType:h}),y={legend:a,channel:t,model:e,markDef:s,encoding:o,fieldOrDatumDef:f,legendConfig:l,config:u,scaleType:h,orient:g,legendType:m,direction:qY({legend:a,legendType:m,orient:g,legendConfig:l})};for(const n of zY){const r=n in GY?GY[n](y):a[n];if(void 0!==r){const i=KY(r,n,a,e.fieldDef(t));(i||void 0===u.legend[n])&&c.set(n,r,i)}}const v=null!==(r=null==a?void 0:a.encoding)&&void 0!==r?r:{},b=c.get("selections"),x={},w={fieldOrDatumDef:f,model:e,channel:t,legendCmpt:c,legendType:m};for(const t of["labels","legend","title","symbols","gradient","entries"]){const n=OY(null!==(i=v[t])&&void 0!==i?i:{},e),r=t in PY?PY[t](n,w):n;void 0===r||Gz(r)||(x[t]=Object.assign(Object.assign(Object.assign({},(null==b?void 0:b.length)&&vV(f)?{name:`${Yz(f.field)}_legend_${t}`}:{}),(null==b?void 0:b.length)?{interactive:!!b}:{}),{update:r}))}return Gz(x)||c.set("encode",x,!!(null==a?void 0:a.encoding)),c}function QY(e,t){var n,r,i,a;if(!e)return t.clone();const s=e.getWithExplicit("orient"),o=t.getWithExplicit("orient");if(s.explicit&&o.explicit&&s.value!==o.value)return;let u=!1;for(const n of zY){const r=Hq(e.getWithExplicit(n),t.getWithExplicit(n),n,"legend",((e,t)=>{switch(n){case"symbolType":return r=e,"circle"===(i=t).value?i:r;case"title":return cG(e,t);case"type":return u=!0,Vq("symbol")}var r,i;return qq(e,t,n,"legend")}));e.setWithExplicit(n,r)}return u&&((null===(r=null===(n=e.implicit)||void 0===n?void 0:n.encode)||void 0===r?void 0:r.gradient)&&Jz(e.implicit,["encode","gradient"]),(null===(a=null===(i=e.explicit)||void 0===i?void 0:i.encode)||void 0===a?void 0:a.gradient)&&Jz(e.explicit,["encode","gradient"])),e}function JY(e,t,n,r){var i,a,s;e.encode=null!==(i=e.encode)&&void 0!==i?i:{},e.encode[t]=null!==(a=e.encode[t])&&void 0!==a?a:{},e.encode[t].update=null!==(s=e.encode[t].update)&&void 0!==s?s:{},e.encode[t].update[n]=r}function ZY(e){const t=e.component.legends,n={};for(const r of qz(t)){const i=e.getScaleComponent(r),a=Oz(i.get("domains"));if(n[a])for(const e of n[a])QY(e,t[r])||n[a].push(t[r]);else n[a]=[t[r].clone()]}const r=Hz(n).flat().map((t=>function(e,t){var n,r,i;const a=e.combine(),{disable:s,labelExpr:o,selections:u}=a,l=vz(a,["disable","labelExpr","selections"]);if(!s){if(!1===t.aria&&null==l.aria&&(l.aria=!1),null===(n=l.encode)||void 0===n?void 0:n.symbols){const e=l.encode.symbols.update;!e.fill||"transparent"===e.fill.value||e.stroke||l.stroke||(e.stroke={value:"transparent"});for(const t of UG)l[t]&&delete e[t]}if(l.title||delete l.title,void 0!==o){let e=o;(null===(i=null===(r=l.encode)||void 0===r?void 0:r.labels)||void 0===i?void 0:i.update)&&OU(l.encode.labels.update.text)&&(e=rL(o,"datum.label",l.encode.labels.update.text.signal)),JY(l,"labels","text",{signal:e})}for(const e in l){const t=l[e];if(OU(t)){const n=WG[e];if(n){const{vgProp:r,part:i}=n;JY(l,i,r,t),delete l[e]}}}return l}}(t,e.config))).filter((e=>void 0!==e));return r}function eQ(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:r}=n;if(t.data){const i={signal:`[${t.size.map((e=>e.signal)).join(", ")}]`},a=t.data.reduce(((t,n)=>{const r=OU(n)?n.signal:`data('${e.lookupDataSource(n)}')`;return Bz(t,r)||t.push(r),t}),[]);if(a.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:r,size:i,fit:{signal:a.length>1?`[${a.join(", ")}]`:a[0]}},n)]}return[Object.assign(Object.assign({name:r},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const tQ=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class nQ extends Uq{constructor(e,t,n,r){super(Object.assign({},t),{name:e}),this.specifiedProjection=t,this.size=n,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function rQ(e){e.component.projection=vJ(e)?function(e){var t;if(e.hasProjection){const n=e.specifiedProjection,r=!(n&&(null!=n.scale||null!=n.translate)),i=r?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,a=r?function(e){const t=[],{encoding:n}=e;for(const r of[[uP,oP],[cP,lP]])(jV(n[r[0]])||jV(n[r[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(pP)&&e.typedFieldDef(pP).type===rW&&t.push({signal:e.getName(`geojson_${t.length}`)}),0===t.length&&t.push(e.requestDataName(nH)),t}(e):void 0;return new nQ(e.projectionName(!0),Object.assign(Object.assign({},null!==(t=e.config.projection)&&void 0!==t?t:{}),null!=n?n:{}),i,a)}}(e):function(e){if(0===e.children.length)return;let t;for(const t of e.children)rQ(t);const n=Lz(e.children,(e=>{const n=e.component.projection;if(n){if(t){const e=function(e,t){const n=Lz(tQ,(n=>!hz(e.explicit,n)&&!hz(t.explicit,n)||!(!hz(e.explicit,n)||!hz(t.explicit,n)||Oz(e.get(n))!==Oz(t.get(n)))));if(Oz(e.size)===Oz(t.size)){if(n)return e;if(Oz(e.explicit)===Oz({}))return t;if(Oz(t.explicit)===Oz({}))return e}return null}(t,n);return e&&(t=e),!!e}return t=n,!0}return!0}));if(t&&n){const n=e.projectionName(!0),r=new nQ(n,t.specifiedProjection,t.size,Nz(t.data));for(const t of e.children){const e=t.component.projection;e&&(e.isFit&&r.data.push(...t.component.projection.data),t.renameProjection(e.get("name"),n),e.merged=!0)}return r}}(e)}function iQ(e,t){return`${zj(e)}_${t}`}function aQ(e,t,n){var r;const i=iQ(null!==(r=GV(n,void 0))&&void 0!==r?r:{},t);return e.getName(`${i}_bins`)}function sQ(e,t,n){let r,i;r=function(e){return"as"in e}(e)?gz(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:[DV(e,{forAs:!0}),DV(e,{binSuffix:"end",forAs:!0})];const a=Object.assign({},GV(t,void 0)),s=iQ(a,e.field),{signal:o,extentSignal:u}=function(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}(n,s);if(Uj(a.extent)){const e=a.extent,t=e.selection;i=KK(n.getSelectionComponent(Yz(t),t),e),delete a.extent}return{key:s,binComponent:Object.assign(Object.assign(Object.assign({bin:a,field:e.field,as:[r]},o?{signal:o}:{}),u?{extentSignal:u}:{}),i?{span:i}:{})}}class oQ extends QH{constructor(e,t){super(e),this.bins=t}clone(){return new oQ(null,Nz(this.bins))}static makeFromEncoding(e,t){const n=t.reduceFieldDef(((e,n,r)=>{if(SV(n)&&Lj(n.bin)){const{key:i,binComponent:a}=sQ(n,n.bin,t);e[i]=Object.assign(Object.assign(Object.assign({},a),e[i]),function(e,t,n,r){var i,a;if(YV(t,n)){const s=vJ(e)&&null!==(a=null!==(i=e.axis(n))&&void 0!==i?i:e.legend(n))&&void 0!==a?a:{},o=DV(t,{expr:"datum"}),u=DV(t,{expr:"datum",binSuffix:"end"});return{formulaAs:DV(t,{binSuffix:"range",forAs:!0}),formula:tV(o,u,s.format,s.formatType,r)}}return{}}(t,n,r,t.config))}return e}),{});return Gz(n)?null:new oQ(e,n)}static makeFromTransform(e,t,n){const{key:r,binComponent:i}=sQ(t,t.bin,n);return new oQ(e,{[r]:i})}merge(e,t){for(const n of qz(e.bins))n in this.bins?(t(e.bins[n].signal,this.bins[n].signal),this.bins[n].as=jz([...this.bins[n].as,...e.bins[n].as],Mz)):this.bins[n]=e.bins[n];for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}producedFields(){return new Set(Hz(this.bins).map((e=>e.as)).flat(2))}dependentFields(){return new Set(Hz(this.bins).map((e=>e.field)))}hash(){return`Bin ${Mz(this.bins)}`}assemble(){return Hz(this.bins).flatMap((e=>{const t=[],[n,...r]=e.as,i=e.bin,{extent:a}=i,s=vz(i,["extent"]),o=Object.assign(Object.assign(Object.assign({type:"bin",field:nL(e.field),as:n,signal:e.signal},Uj(a)?{extent:null}:{extent:a}),e.span?{span:{signal:`span(${e.span})`}}:{}),s);!a&&e.extentSignal&&(t.push({type:"extent",field:nL(e.field),signal:e.extentSignal}),o.extent={signal:e.extentSignal}),t.push(o);for(const e of r)for(let r=0;r<2;r++)t.push({type:"formula",expr:DV({field:n[r]},{expr:"datum"}),as:e[r]});return e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t}))}}class uQ extends QH{constructor(e){let t;if(super(null),Jq(e=null!=e?e:{name:"source"})||(t=e.format?Object.assign({},Tz(e.format,["parse"])):{}),Yq(e))this._data={values:e.values};else if(Kq(e)){if(this._data={url:e.url},!t.type){let n=/(?:\.([^.]+))?$/.exec(e.url)[1];Bz(["json","csv","tsv","dsv","topojson"],n)||(n="json"),t.type=n}}else eH(e)?this._data={values:[{type:"Sphere"}]}:(Qq(e)||Jq(e))&&(this._data={});this._generator=Jq(e),e.name&&(this._name=e.name),t&&!Gz(t)&&(this._data.format=t)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(e){this._name=e}set parent(e){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}function lQ(e){for(const t of e){for(const e of t.children)if(e.parent!==t)return console.error("Dataflow graph is inconsistent.",t,e),!1;if(!lQ(t.children))return!1}return!0}class cQ extends QH{constructor(e,t){super(e),this.params=t}clone(){return new cQ(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${Mz(this.params)}`}assemble(){return Object.assign({type:"graticule"},!0===this.params?{}:this.params)}}class dQ extends QH{constructor(e,t){super(e),this.params=t}clone(){return new dQ(null,this.params)}dependentFields(){return new Set}producedFields(){var e;return new Set([null!==(e=this.params.as)&&void 0!==e?e:"data"])}hash(){return`Hash ${Mz(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}function hQ(e){return e instanceof uQ||e instanceof cQ||e instanceof dQ}class fQ{constructor(){this._mutated=!1}setMutated(){this._mutated=!0}get mutatedFlag(){return this._mutated}}class pQ extends fQ{constructor(){super(),this._continue=!1}setContinue(){this._continue=!0}get continueFlag(){return this._continue}get flags(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}}set flags({continueFlag:e,mutatedFlag:t}){e&&this.setContinue(),t&&this.setMutated()}reset(){}optimizeNextFromLeaves(e){if(hQ(e))return!1;const t=e.parent,{continueFlag:n}=this.run(e);return n&&this.optimizeNextFromLeaves(t),this.mutatedFlag}}class gQ extends fQ{}class mQ extends QH{constructor(e,t,n){super(e),this.dimensions=t,this.measures=n}clone(){return new mQ(null,new Set(this.dimensions),Nz(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(e,t){let n=!1;t.forEachFieldDef((e=>{e.aggregate&&(n=!0)}));const r={},i=new Set;return n?(t.forEachFieldDef(((e,n)=>{var a,s,o,u;const{aggregate:l,field:c}=e;if(l)if("count"===l)r["*"]=null!==(a=r["*"])&&void 0!==a?a:{},r["*"].count=new Set([DV(e,{forAs:!0})]);else{if(WL(l)||VL(l)){const e=WL(l)?"argmin":"argmax",t=l[e];r[t]=null!==(s=r[t])&&void 0!==s?s:{},r[t][e]=new Set([DV({op:e,field:t},{forAs:!0})])}else r[c]=null!==(o=r[c])&&void 0!==o?o:{},r[c][l]=new Set([DV(e,{forAs:!0})]);Tj(n)&&"unaggregated"===t.scaleDomain(n)&&(r[c]=null!==(u=r[c])&&void 0!==u?u:{},r[c].min=new Set([DV({field:c,aggregate:"min"},{forAs:!0})]),r[c].max=new Set([DV({field:c,aggregate:"max"},{forAs:!0})]))}else!function(e,t,n,r){const i=vJ(r)?r.encoding[ZP(t)]:void 0;if(SV(n)&&vJ(r)&&pV(t,n,i,r.stack,r.markDef,r.config))e.add(DV(n,{})),e.add(DV(n,{suffix:"end"})),n.bin&&YV(n,t)&&e.add(DV(n,{binSuffix:"range"}));else if(t in $P){const n=function(e){switch(e){case oP:return"y";case lP:return"y2";case uP:return"x";case cP:return"x2"}}(t);e.add(r.getName(n))}else e.add(DV(n))}(i,n,e,t)})),i.size+qz(r).length===0?null:new mQ(e,i,r)):null}static makeFromTransform(e,t){var n,r,i;const a=new Set,s={};for(const e of t.aggregate){const{op:t,field:i,as:a}=e;t&&("count"===t?(s["*"]=null!==(n=s["*"])&&void 0!==n?n:{},s["*"].count=new Set([a||DV(e,{forAs:!0})])):(s[i]=null!==(r=s[i])&&void 0!==r?r:{},s[i][t]=new Set([a||DV(e,{forAs:!0})])))}for(const e of null!==(i=t.groupby)&&void 0!==i?i:[])a.add(e);return a.size+qz(s).length===0?null:new mQ(e,a,s)}merge(e){return function(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}(this.dimensions,e.dimensions)?(function(e,t){var n;for(const r of qz(t)){const i=t[r];for(const t of qz(i))r in e?e[r][t]=new Set([...null!==(n=e[r][t])&&void 0!==n?n:[],...i[t]]):e[r]={[t]:i[t]}}}(this.measures,e.measures),!0):(function(...e){yU.debug(...e)}("different dimensions, cannot merge"),!1)}addDimensions(e){e.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...qz(this.measures)])}producedFields(){const e=new Set;for(const t of qz(this.measures))for(const n of qz(this.measures[t])){const r=this.measures[t][n];0===r.size?e.add(`${n}_${t}`):r.forEach(e.add,e)}return e}hash(){return`Aggregate ${Mz({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const e=[],t=[],n=[];for(const r of qz(this.measures))for(const i of qz(this.measures[r]))for(const a of this.measures[r][i])n.push(a),e.push(i),t.push("*"===r?null:nL(r));return{type:"aggregate",groupby:[...this.dimensions].map(nL),ops:e,fields:t,as:n}}}class yQ extends QH{constructor(e,t,n,r){super(e),this.model=t,this.name=n,this.data=r;for(const e of BP){const n=t.facet[e];if(n){const{bin:r,sort:i}=n;this[e]=Object.assign({name:t.getName(`${e}_domain`),fields:[DV(n),...Lj(r)?[DV(n,{binSuffix:"end"})]:[]]},sV(i)?{sortField:i}:iz(i)?{sortIndexField:fY(n,e)}:{})}}this.childModel=t.child}hash(){let e="Facet";for(const t of BP)this[t]&&(e+=` ${t.charAt(0)}:${Mz(this[t])}`);return e}get fields(){var e;const t=[];for(const n of BP)(null===(e=this[n])||void 0===e?void 0:e.fields)&&t.push(...this[n].fields);return t}dependentFields(){const e=new Set(this.fields);for(const t of BP)this[t]&&(this[t].sortField&&e.add(this[t].sortField.field),this[t].sortIndexField&&e.add(this[t].sortIndexField));return e}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const e={};for(const t of mj){const n=this.childModel.component.scales[t];if(n&&!n.merged){const r=n.get("type"),i=n.get("range");if(xW(r)&&MU(i)){const n=JQ(ZQ(this.childModel,t));n?e[t]=n:vU(`Unknown field for ${t}. Cannot calculate view size.`)}}}return e}assembleRowColumnHeaderData(e,t,n){const r={row:"y",column:"x"}[e],i=[],a=[],s=[];n&&n[r]&&(t?(i.push(`distinct_${n[r]}`),a.push("max")):(i.push(n[r]),a.push("distinct")),s.push(`distinct_${n[r]}`));const{sortField:o,sortIndexField:u}=this[e];if(o){const{op:e=nV,field:t}=o;i.push(t),a.push(e),s.push(DV(o,{forAs:!0}))}else u&&(i.push(u),a.push("max"),s.push(u));return{name:this[e].name,source:null!=t?t:this.data,transform:[Object.assign({type:"aggregate",groupby:this[e].fields},i.length?{fields:i,ops:a,as:s}:{})]}}assembleFacetHeaderData(e){var t,n;const{columns:r}=this.model.layout,{layoutHeaders:i}=this.model.component,a=[],s={};for(const e of yY){for(const r of vY){const a=null!==(t=i[e]&&i[e][r])&&void 0!==t?t:[];for(const t of a)if((null===(n=t.axes)||void 0===n?void 0:n.length)>0){s[e]=!0;break}}if(s[e]){const t=`length(data("${this.facet.name}"))`,n="row"===e?r?{signal:`ceil(${t} / ${r})`}:1:r?{signal:`min(${t}, ${r})`}:{signal:t};a.push({name:`${this.facet.name}_${e}`,transform:[{type:"sequence",start:0,stop:n}]})}}const{row:o,column:u}=s;return(o||u)&&a.unshift(this.assembleRowColumnHeaderData("facet",null,e)),a}assemble(){var e,t;const n=[];let r=null;const i=this.getChildIndependentFieldsWithStep(),{column:a,row:s,facet:o}=this;if(a&&s&&(i.x||i.y)){r=`cross_${this.column.name}_${this.row.name}`;const a=[].concat(null!==(e=i.x)&&void 0!==e?e:[],null!==(t=i.y)&&void 0!==t?t:[]),s=a.map((()=>"distinct"));n.push({name:r,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:a,ops:s}]})}for(const e of[QL,YL])this[e]&&n.push(this.assembleRowColumnHeaderData(e,r,i));if(o){const e=this.assembleFacetHeaderData(i);e&&n.push(...e)}return n}}function vQ(e){return"'"===e[0]&&"'"===e[e.length-1]||'"'===e[0]&&'"'===e[e.length-1]?e.slice(1,-1):e}function bQ(e){const t={};return Fz(e.filter,(e=>{var n;if(HU(e)){let r=null;PU(e)?r=e.equal:GU(e)?r=e.range[0]:qU(e)&&(r=(null!==(n=e.oneOf)&&void 0!==n?n:e.in)[0]),r&&(bU(r)?t[e.field]="date":pz(r)?t[e.field]="number":gz(r)&&(t[e.field]="string")),e.timeUnit&&(t[e.field]="date")}})),t}class xQ extends QH{constructor(e,t){super(e),this._parse=t}clone(){return new xQ(null,Nz(this._parse))}hash(){return`Parse ${Mz(this._parse)}`}static makeExplicit(e,t,n){let r={};const i=t.data;return!Jq(i)&&i&&i.format&&i.format.parse&&(r=i.format.parse),this.makeWithAncestors(e,r,{},n)}static makeWithAncestors(e,t,n,r){for(const e of qz(n)){const t=r.getWithExplicit(e);void 0!==t.value&&(t.explicit||t.value===n[e]||"derived"===t.value||"flatten"===n[e]?delete n[e]:vU(Jj(e,n[e],t.value)))}for(const e of qz(t)){const n=r.get(e);void 0!==n&&(n===t[e]?delete t[e]:vU(Jj(e,t[e],n)))}const i=new Uq(t,n);r.copyAll(i);const a={};for(const e of qz(i.combine())){const t=i.get(e);null!==t&&(a[e]=t)}return 0===qz(a).length||r.parseNothing?null:new xQ(e,a)}get parse(){return this._parse}merge(e){this._parse=Object.assign(Object.assign({},this._parse),e.parse),e.remove()}assembleFormatParse(){const e={};for(const t of qz(this._parse)){const n=this._parse[t];1===aL(t)&&(e[t]=n)}return e}producedFields(){return new Set(qz(this._parse))}dependentFields(){return new Set(qz(this._parse))}assembleTransforms(e=!1){return qz(this._parse).filter((t=>!e||aL(t)>1)).map((e=>{const t=function(e,t){const n=eL(e);return"number"===t?`toNumber(${n})`:"boolean"===t?`toBoolean(${n})`:"string"===t?`toString(${n})`:"date"===t?`toDate(${n})`:"flatten"===t?n:0===t.indexOf("date:")?`timeParse(${n},'${vQ(t.slice(5,t.length))}')`:0===t.indexOf("utc:")?`utcParse(${n},'${vQ(t.slice(4,t.length))}')`:(vU(`Unrecognized parse "${t}".`),null)}(e,this._parse[e]);return t?{type:"formula",expr:t,as:iL(e)}:null})).filter((e=>null!==e))}}class wQ extends QH{clone(){return new wQ(null)}constructor(e){super(e)}dependentFields(){return new Set}producedFields(){return new Set([GG])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:GG}}}class kQ extends QH{constructor(e,t){super(e),this.transform=t}clone(){return new kQ(null,Nz(this.transform))}addDimensions(e){this.transform.groupby=jz(this.transform.groupby.concat(e),(e=>e))}dependentFields(){const e=new Set;return this.transform.groupby&&this.transform.groupby.forEach(e.add,e),this.transform.joinaggregate.map((e=>e.field)).filter((e=>void 0!==e)).forEach(e.add,e),e}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:DV(e)}hash(){return`JoinAggregateTransform ${Mz(this.transform)}`}assemble(){const e=[],t=[],n=[];for(const r of this.transform.joinaggregate)t.push(r.op),n.push(this.getDefaultName(r)),e.push(void 0===r.field?null:r.field);const r=this.transform.groupby;return Object.assign({type:"joinaggregate",as:n,ops:t,fields:e},void 0!==r?{groupby:r}:{})}}class _Q extends QH{constructor(e,t){super(e),this._stack=t}clone(){return new _Q(null,Nz(this._stack))}static makeFromTransform(e,t){const{stack:n,groupby:r,as:i,offset:a="zero"}=t,s=[],o=[];if(void 0!==t.sort)for(const e of t.sort)s.push(e.field),o.push(sL(e.order,"ascending"));const u={field:s,order:o};let l;return l=function(e){return iz(e)&&e.every((e=>gz(e)))&&e.length>1}(i)?i:gz(i)?[i,i+"_end"]:[t.stack+"_start",t.stack+"_end"],new _Q(e,{stackField:n,groupby:r,offset:a,sort:u,facetby:[],as:l})}static makeFromEncoding(e,t){const n=t.stack,{encoding:r}=t;if(!n)return null;const{groupbyChannel:i,fieldChannel:a,offset:s,impute:o}=n;let u;i&&(u=PV(r[i]));const l=function(e){return e.stack.stackBy.reduce(((e,t)=>{const n=DV(t.fieldDef);return n&&e.push(n),e}),[])}(t),c=t.encoding.order;let d;return d=iz(c)||vV(c)?oG(c):l.reduce(((e,t)=>(e.field.push(t),e.order.push("y"===a?"descending":"ascending"),e)),{field:[],order:[]}),new _Q(e,{dimensionFieldDef:u,stackField:t.vgField(a),facetby:[],stackby:l,sort:d,offset:s,impute:o,as:[t.vgField(a,{suffix:"start",forAs:!0}),t.vgField(a,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(e){this._stack.facetby.push(...e)}dependentFields(){const e=new Set;return e.add(this._stack.stackField),this.getGroupbyFields().forEach(e.add,e),this._stack.facetby.forEach(e.add,e),this._stack.sort.field.forEach(e.add,e),e}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${Mz(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:e,impute:t,groupby:n}=this._stack;return e?e.bin?t?[DV(e,{binSuffix:"mid"})]:[DV(e,{}),DV(e,{binSuffix:"end"})]:[DV(e)]:null!=n?n:[]}assemble(){const e=[],{facetby:t,dimensionFieldDef:n,stackField:r,stackby:i,sort:a,offset:s,impute:o,as:u}=this._stack;if(o&&n){const{band:a=.5,bin:s}=n;s&&e.push({type:"formula",expr:`${a}*`+DV(n,{expr:"datum"})+`+${1-a}*`+DV(n,{expr:"datum",binSuffix:"end"}),as:DV(n,{binSuffix:"mid",forAs:!0})}),e.push({type:"impute",field:r,groupby:[...i,...t],key:DV(n,{binSuffix:"mid"}),method:"value",value:0})}return e.push({type:"stack",groupby:[...this.getGroupbyFields(),...t],field:r,sort:a,as:u,offset:s}),e}}class SQ extends QH{constructor(e,t){super(e),this.transform=t}clone(){return new SQ(null,Nz(this.transform))}addDimensions(e){this.transform.groupby=jz(this.transform.groupby.concat(e),(e=>e))}dependentFields(){var e,t;const n=new Set;return(null!==(e=this.transform.groupby)&&void 0!==e?e:[]).forEach(n.add,n),(null!==(t=this.transform.sort)&&void 0!==t?t:[]).forEach((e=>n.add(e.field))),this.transform.window.map((e=>e.field)).filter((e=>void 0!==e)).forEach(n.add,n),n}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:DV(e)}hash(){return`WindowTransform ${Mz(this.transform)}`}assemble(){var e;const t=[],n=[],r=[],i=[];for(const e of this.transform.window)n.push(e.op),r.push(this.getDefaultName(e)),i.push(void 0===e.param?null:e.param),t.push(void 0===e.field?null:e.field);const a=this.transform.frame,s=this.transform.groupby;if(a&&null===a[0]&&null===a[1]&&n.every((e=>GL(e))))return Object.assign({type:"joinaggregate",as:r,ops:n,fields:t},void 0!==s?{groupby:s}:{});const o=[],u=[];if(void 0!==this.transform.sort)for(const t of this.transform.sort)o.push(t.field),u.push(null!==(e=t.order)&&void 0!==e?e:"ascending");const l={field:o,order:u},c=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:i,as:r,ops:n,fields:t,sort:l},void 0!==c?{ignorePeers:c}:{}),void 0!==s?{groupby:s}:{}),void 0!==a?{frame:a}:{})}}class CQ extends pQ{run(e){const t=e.parent;if(e instanceof xQ){if(hQ(t))return this.flags;if(t.numChildren()>1)return this.setContinue(),this.flags;if(t instanceof xQ)this.setMutated(),t.merge(e);else{if(Vz(t.producedFields(),e.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),e.swapWithParent()}}return this.setContinue(),this.flags}}class AQ extends gQ{mergeNodes(e,t){const n=t.shift();for(const r of t)e.removeChild(r),r.parent=n,r.remove()}run(e){const t=e.children.map((e=>e.hash())),n={};for(let r=0;r<t.length;r++)void 0===n[t[r]]?n[t[r]]=[e.children[r]]:n[t[r]].push(e.children[r]);for(const t of qz(n))n[t].length>1&&(this.setMutated(),this.mergeNodes(e,n[t]));for(const t of e.children)this.run(t);return this.mutatedFlag}}class EQ extends pQ{run(e){return e instanceof JH||e.numChildren()>0||e instanceof yQ||(this.setMutated(),e.remove()),this.flags}}class FQ extends pQ{constructor(){super(...arguments),this.fields=new Set,this.prev=null}run(e){if(this.setContinue(),e instanceof ZH){const t=e.producedFields();Uz(t,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([...this.fields,...t]),this.prev=e}return this.flags}reset(){this.fields.clear()}}class IQ extends pQ{run(e){this.setContinue();const t=e.parent.children.filter((e=>e instanceof ZH)),n=t.pop();for(const e of t)this.setMutated(),n.merge(e);return this.flags}}function DQ(e){if(e instanceof yQ)if(1!==e.numChildren()||e.children[0]instanceof JH){const n=e.model.component.data.main;NQ(n);const r=(t=e,function e(n){if(!(n instanceof yQ)){const r=n.clone();if(r instanceof JH){const e=zQ+r.getSource();r.setSource(e),t.model.component.data.outputNodes[e]=r}else(r instanceof mQ||r instanceof _Q||r instanceof SQ||r instanceof kQ)&&r.addDimensions(t.fields);for(const t of n.children.flatMap(e))t.parent=r;return[r]}return n.children.flatMap(e)}),i=e.children.map(r).flat();for(const e of i)e.parent=n}else{const t=e.children[0];(t instanceof mQ||t instanceof _Q||t instanceof SQ||t instanceof kQ)&&t.addDimensions(e.fields),t.swapWithParent(),DQ(e)}else e.children.map(DQ);var t}function NQ(e){if(e instanceof JH&&e.type===nH&&1===e.numChildren()){const t=e.children[0];t instanceof yQ||(t.swapWithParent(),NQ(e))}}class $Q extends gQ{constructor(){super()}run(e){e instanceof JH&&!e.isRequired()&&(this.setMutated(),e.remove());for(const t of e.children)this.run(t);return this.mutatedFlag}}class TQ extends gQ{constructor(e){super(),this.requiresSelectionId=e&&zX(e)}run(e){e instanceof wQ&&(this.requiresSelectionId&&(hQ(e.parent)||e.parent instanceof mQ||e.parent instanceof xQ)||(this.setMutated(),e.remove()));for(const t of e.children)this.run(t);return this.mutatedFlag}}class OQ extends pQ{run(e){const t=e.parent,n=[...t.children],r=t.children.filter((e=>e instanceof xQ));if(t.numChildren()>1&&r.length>=1){const e={},i=new Set;for(const t of r){const n=t.parse;for(const t of qz(n))t in e?e[t]!==n[t]&&i.add(t):e[t]=n[t]}for(const t of i)delete e[t];if(!Gz(e)){this.setMutated();const r=new xQ(t,e);for(const i of n){if(i instanceof xQ)for(const t of qz(e))delete i.parse[t];t.removeChild(i),i.parent=r,i instanceof xQ&&0===qz(i.parse).length&&i.remove()}}}return this.setContinue(),this.flags}}class MQ extends pQ{run(e){const t=e.parent,n=t.children.filter((e=>e instanceof mQ)),r={};for(const e of n){const t=Mz(e.groupBy);t in r||(r[t]=[]),r[t].push(e)}for(const e of qz(r)){const n=r[e];if(n.length>1){const e=n.pop();for(const r of n)e.merge(r)&&(t.removeChild(r),r.parent=e,r.remove(),this.setMutated())}}return this.setContinue(),this.flags}}class RQ extends pQ{constructor(e){super(),this.model=e}run(e){const t=e.parent,n=!(hQ(t)||t instanceof HK||t instanceof xQ||t instanceof wQ),r=[],i=[];for(const e of t.children)e instanceof oQ&&(n&&!Vz(t.producedFields(),e.dependentFields())?r.push(e):i.push(e));if(r.length>0){const e=r.pop();for(const t of r)e.merge(t,this.model.renameSignal.bind(this.model));this.setMutated(),t instanceof oQ?t.merge(e,this.model.renameSignal.bind(this.model)):e.swapWithParent()}if(i.length>1){const e=i.pop();for(const t of i)e.merge(t,this.model.renameSignal.bind(this.model));this.setMutated()}return this.setContinue(),this.flags}}class BQ extends pQ{run(e){const t=e.parent,n=[...t.children];if(!zz(n,(e=>e instanceof JH))||t.numChildren()<=1)return this.setContinue(),this.flags;const r=[];let i;for(const e of n)if(e instanceof JH){let n=e;for(;1===n.numChildren();){const e=n.children[0];if(!(e instanceof JH))break;n=e}r.push(...n.children),i?(t.removeChild(e),e.parent=i.parent,i.parent.removeChild(i),i.parent=n,this.setMutated()):i=n}else r.push(e);if(r.length){this.setMutated();for(const e of r)e.parent.removeChild(e),e.parent=i}return this.setContinue(),this.flags}}const zQ="scale_";function LQ(e){const t=[];function n(e){if(0===e.numChildren())t.push(e);else for(const t of e.children)n(t)}for(const t of e)n(t);return t}function PQ(e){return e}function jQ(e,t){return t.map((t=>{if(e instanceof pQ){const n=e.optimizeNextFromLeaves(t);return e.reset(),n}return e.run(t)})).some(PQ)}function UQ(e,t){let n=e.sources;const r=new Set;return r.add(jQ(new $Q,n)),r.add(jQ(new TQ(t),n)),n=n.filter((e=>e.numChildren()>0)),r.add(jQ(new EQ,LQ(n))),n=n.filter((e=>e.numChildren()>0)),r.add(jQ(new CQ,LQ(n))),r.add(jQ(new RQ(t),LQ(n))),r.add(jQ(new FQ,LQ(n))),r.add(jQ(new OQ,LQ(n))),r.add(jQ(new MQ,LQ(n))),r.add(jQ(new IQ,LQ(n))),r.add(jQ(new AQ,n)),r.add(jQ(new BQ,LQ(n))),e.sources=n,r.has(!0)}class WQ{constructor(e){Object.defineProperty(this,"signal",{enumerable:!0,get:e})}static fromName(e,t){return new WQ((()=>e(t)))}}function VQ(e){vJ(e)?function(e){const t=e.component.scales;for(const n of qz(t)){const r=GQ(e,n);if(t[n].setWithExplicit("domains",r),KQ(e,n),e.component.data.isFaceted){let t=e;for(;!bJ(t)&&t.parent;)t=t.parent;if("shared"===t.component.resolve.scale[n])for(const e of r.value)RU(e)&&(e.data=zQ+e.data.replace(zQ,""))}}}(e):function(e){for(const t of e.children)VQ(t);const t=e.component.scales;for(const n of qz(t)){let r,i=null;for(const t of e.children){const e=t.component.scales[n];if(e){r=void 0===r?e.getWithExplicit("domains"):Hq(r,e.getWithExplicit("domains"),"domains","scale",QQ);const t=e.get("selectionExtent");i&&t&&i.selection!==t.selection&&vU("The same selection must be used to override scale domains in a layered view."),i=t}}t[n].setWithExplicit("domains",r),i&&t[n].set("selectionExtent",i,!0)}}(e)}function GQ(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:r}=e,i=function(e,t,n,r){if("unaggregated"===e){const{valid:e,reason:r}=YQ(t,n);if(!e)return void vU(r)}else if(void 0===e&&r.useUnaggregatedDomain){const{valid:e}=YQ(t,n);if(e)return"unaggregated"}return e}(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return i!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:i})),"x"===t&&jV(r.x2)?jV(r.x)?Hq(HQ(n,i,e,"x"),HQ(n,i,e,"x2"),"domain","scale",QQ):HQ(n,i,e,"x2"):"y"===t&&jV(r.y2)?jV(r.y)?Hq(HQ(n,i,e,"y"),HQ(n,i,e,"y2"),"domain","scale",QQ):HQ(n,i,e,"y2"):HQ(n,i,e,t)}function qQ(e,t,n){var r;const i=null===(r=TU(n))||void 0===r?void 0:r.unit;return"temporal"===t||i?function(e,t,n){return e.map((e=>({signal:`{data: ${XV(e,{timeUnit:n,type:t})}}`})))}(e,t,i):[e]}function HQ(e,t,n,r){const{encoding:i}=n,a=jV(i[r]),{type:s}=a,o=a.timeUnit;if(function(e){return e&&e.unionWith}(t)){const i=HQ(e,void 0,n,r),a=qQ(t.unionWith,s,o);return Wq([...i.value,...a])}if(OU(t))return Wq([t]);if(t&&"unaggregated"!==t&&!SW(t))return Wq(qQ(t,s,o));const u=n.stack;if(u&&r===u.fieldChannel){if("normalize"===u.offset)return Vq([[0,1]]);const e=n.requestDataName(nH);return Vq([{data:e,field:n.vgField(r,{suffix:"start"})},{data:e,field:n.vgField(r,{suffix:"end"})}])}const l=Tj(r)&&vV(a)?function(e,t,n){if(!xW(n))return;const r=e.fieldDef(t),i=r.sort;if(oV(i))return{op:"min",field:fY(r,t),order:"ascending"};const{stack:a}=e,s=a?[...a.groupbyField?[a.groupbyField]:[],...a.stackBy.map((e=>e.fieldDef.field))]:void 0;if(sV(i))return XQ(i,a&&!Bz(s,i.field));if(aV(i)){const{encoding:t,order:n}=i,r=e.fieldDef(t),{aggregate:o,field:u}=r,l=a&&!Bz(s,u);if(WL(o)||VL(o))return XQ({field:DV(r),order:n},l);if(GL(o)||!o)return XQ({op:o,field:u,order:n},l)}else{if("descending"===i)return{op:"min",field:e.vgField(t),order:"descending"};if(Bz(["ascending",void 0],i))return!0}}(n,r,e):void 0;if(xV(a))return Vq(qQ([a.datum],s,o));const c=a;if("unaggregated"===t){const e=n.requestDataName(nH),{field:t}=a;return Vq([{data:e,field:DV({field:t,aggregate:"min"})},{data:e,field:DV({field:t,aggregate:"max"})}])}if(Lj(c.bin)){if(xW(e))return Vq("bin-ordinal"===e?[]:[{data:Kz(l)?n.requestDataName(nH):n.requestDataName(rH),field:n.vgField(r,YV(c,r)?{binSuffix:"range"}:{}),sort:!0!==l&&az(l)?l:{field:n.vgField(r,{}),op:"min"}}]);{const{bin:e}=c;if(Lj(e)){const t=aQ(n,c.field,e);return Vq([new WQ((()=>{const e=n.getSignalName(t);return`[${e}.start, ${e}.stop]`}))])}return Vq([{data:n.requestDataName(nH),field:n.vgField(r,{})}])}}if(c.timeUnit&&Bz(["time","utc"],e)&&pV(r,c,vJ(n)?n.encoding[ZP(r)]:void 0,n.stack,n.markDef,n.config)){const e=n.requestDataName(nH);return Vq([{data:e,field:n.vgField(r)},{data:e,field:n.vgField(r,{suffix:"end"})}])}return Vq(l?[{data:Kz(l)?n.requestDataName(nH):n.requestDataName(rH),field:n.vgField(r),sort:l}]:[{data:n.requestDataName(nH),field:n.vgField(r)}])}function XQ(e,t){const{op:n,field:r,order:i}=e;return Object.assign(Object.assign({op:null!=n?n:t?"sum":nV},r?{field:nL(r)}:{}),i?{order:i}:{})}function KQ(e,t){var n;const r=e.component.scales[t],i=e.specifiedScales[t].domain,a=null===(n=e.fieldDef(t))||void 0===n?void 0:n.bin,s=SW(i)&&i,o=jj(a)&&Uj(a.extent)&&a.extent;(s||o)&&r.set("selectionExtent",null!=s?s:o,!0)}function YQ(e,t){const{aggregate:n,type:r}=e;return n?gz(n)&&!KL[n]?{valid:!1,reason:oU(n)}:"quantitative"===r&&"log"===t?{valid:!1,reason:uU(e)}:{valid:!0}:{valid:!1,reason:sU(e)}}function QQ(e,t,n,r){return e.explicit&&t.explicit&&vU(function(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${Oz(n)} and ${Oz(r)}). Using the union of the two domains.`}(n,r,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function JQ(e){if(RU(e)&&gz(e.field))return e.field;if(function(e){return!iz(e)&&"fields"in e&&!("data"in e)}(e)){let t;for(const n of e.fields)if(RU(n)&&gz(n.field))if(t){if(t!==n.field)return vU("Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect."),t}else t=n.field;return vU("Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect."),t}if(function(e){return!iz(e)&&"fields"in e&&"data"in e}(e)){vU("Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.");const t=e.fields[0];return gz(t)?t:void 0}}function ZQ(e,t){return function(e){const t=jz(e.map((e=>{if(RU(e)){const{sort:t}=e;return vz(e,["sort"])}return e})),Mz),n=jz(e.map((e=>{if(RU(e)){const t=e.sort;return void 0===t||Kz(t)||("op"in t&&"count"===t.op&&delete t.field,"ascending"===t.order&&delete t.order),t}})).filter((e=>void 0!==e)),Mz);if(0===t.length)return;if(1===t.length){const t=e[0];if(RU(t)&&n.length>0){let e=n[0];if(n.length>1)vU(dU),e=!0;else if(az(e)&&"field"in e){const n=e.field;t.field===n&&(e=!e.order||{order:e.order})}return Object.assign(Object.assign({},t),{sort:e})}return t}const r=jz(n.map((e=>Kz(e)||!("op"in e)||e.op in UL?e:(vU(function(e){return`Dropping sort property ${Oz(e)} as unioned domains only support boolean or op "count", "min", and "max".`}(e)),!0))),Mz);let i;1===r.length?i=r[0]:r.length>1&&(vU(dU),i=!0);const a=jz(e.map((e=>RU(e)?e.data:null)),(e=>e));return 1===a.length&&null!==a[0]?Object.assign({data:a[0],fields:t.map((e=>e.field))},i?{sort:i}:{}):Object.assign({fields:t},i?{sort:i}:{})}(e.component.scales[t].get("domains").map((t=>(RU(t)&&(t.data=e.lookupDataSource(t.data)),t))))}function eJ(e){return wJ(e)||xJ(e)?e.children.reduce(((e,t)=>e.concat(eJ(t))),tJ(e)):tJ(e)}function tJ(e){return qz(e.component.scales).reduce(((t,n)=>{const r=e.component.scales[n];if(r.merged)return t;const i=r.combine(),{name:a,type:s,selectionExtent:o,domains:u,range:l,reverse:c}=i,d=vz(i,["name","type","selectionExtent","domains","range","reverse"]),h=function(e,t,n){return yj(n)&&MU(e)?{step:{signal:t+"_step"}}:e}(i.range,a,n);let f;o&&(f=function(e,t){const n=t.selection;return{signal:KK(e.getSelectionComponent(n,Yz(n)),t)}}(e,o));const p=ZQ(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:a,type:s},p?{domain:p}:{}),f?{domainRaw:f}:{}),{range:h}),void 0!==c?{reverse:c}:{}),d)),t}),[])}class nJ extends Uq{constructor(e,t){super({},{name:e}),this.merged=!1,this.setWithExplicit("type",t)}domainDefinitelyIncludesZero(){return!1!==this.get("zero")||zz(this.get("domains"),(e=>iz(e)&&2===e.length&&e[0]<=0&&e[1]>=0))}}const rJ=["range","scheme"];function iJ(e){return"x"===e?"width":"y"===e?"height":void 0}function aJ(e,t){const n=e.fieldDef(t);if(n&&n.bin&&Lj(n.bin)){const r=aQ(e,n.field,n.bin),i=iJ(t),a=e.getName(i);return new WQ((()=>{const t=e.getSignalName(r),n=`(${t}.stop - ${t}.start) / ${t}.step`;return`${e.getSignalName(a)} / (${n})`}))}}function sJ(e,t){const n=t.specifiedScales[e],{size:r}=t,i=t.getScaleComponent(e).get("type");for(const r of rJ)if(void 0!==n[r]){const a=$W(i,r),s=TW(e,r);if(a)if(s)vU(s);else switch(r){case"range":return iz(n.range)&&yj(e)?Wq(n.range.map((e=>{if("width"===e||"height"===e){const n=t.getName(e),r=t.getSignalName.bind(t);return WQ.fromName(r,n)}return e}))):Wq(n.range);case"scheme":return Wq(oJ(n[r]))}else vU(lU(i,r,e))}if(e===ZL||e===eP){const t=e===ZL?"width":"height",n=r[t];if(JG(n)){if(xW(i))return Wq({step:n.step});vU(cU(t))}}return Vq(function(e,t){const{size:n,config:r,mark:i,encoding:a}=t,s=t.getSignalName.bind(t),{type:o}=jV(a[e]),u=t.getScaleComponent(e).get("type"),{domain:l,domainMid:c}=t.specifiedScales[e];switch(e){case ZL:case eP:{if(Bz(["point","band"],u))if(e!==ZL||n.width){if(e===eP&&!n.height){const e=rq(r.view,"height");if(JG(e))return e}}else{const e=rq(r.view,"width");if(JG(e))return e}const i=iJ(e),a=t.getName(i);return e===eP&&wW(u)?[WQ.fromName(s,a),0]:[0,WQ.fromName(s,a)]}case gP:{const a=uJ(i,t.component.scales[e].get("zero"),r),s=function(e,t,n,r){const i={x:aJ(n,"x"),y:aJ(n,"y")};switch(e){case"bar":case"tick":{if(void 0!==r.scale.maxBandSize)return r.scale.maxBandSize;const e=cJ(t,i,r.view);return pz(e)?e-1:new WQ((()=>`${e.signal} - 1`))}case"line":case"trail":case"rule":return r.scale.maxStrokeWidth;case"text":return r.scale.maxFontSize;case"point":case"square":case"circle":{if(r.scale.maxSize)return r.scale.maxSize;const e=cJ(t,i,r.view);return pz(e)?Math.pow(lJ*e,2):new WQ((()=>`pow(0.95 * ${e.signal}, 2)`))}}throw new Error(rU("size",e))}(i,n,t,r);return _W(u)?function(e,t,n){const r=()=>{const r=tG(t),i=tG(e),a=`(${r} - ${i}) / (${n} - 1)`;return`sequence(${i}, ${r} + ${a}, ${a})`};return OU(t)?new WQ(r):{signal:r()}}(a,s,function(e,t,n,r){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return void 0!==n&&iz(n)?n.length+1:(vU(function(e){return`Domain for ${e} is required for threshold scale.`}(r)),3)}}(u,r,l,e)):[a,s]}case aP:return[0,2*Math.PI];case mP:return[0,360];case rP:return[0,new WQ((()=>`min(${t.getSignalName("width")},${t.getSignalName("height")})/2`))];case xP:return[r.scale.minStrokeWidth,r.scale.maxStrokeWidth];case wP:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case pP:return"symbol";case dP:case hP:case fP:return"ordinal"===u?"nominal"===o?"category":"ordinal":void 0!==c?"diverging":"rect"===i||"geoshape"===i?"heatmap":"ramp";case yP:case vP:case bP:return[r.scale.minOpacity,r.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${e}`)}(e,t))}function oJ(e){return function(e){return!gz(e)&&!!e.name}(e)?Object.assign({scheme:e.name},Tz(e,["name"])):{scheme:e}}function uJ(e,t,n){if(t)return OU(t)?{signal:`${t.signal} ? 0 : ${uJ(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(rU("size",e))}const lJ=.95;function cJ(e,t,n){const r=JG(e.width)?e.width.step:nq(n,"width"),i=JG(e.height)?e.height.step:nq(n,"height");return t.x||t.y?new WQ((()=>`min(${[t.x?t.x.signal:r,t.y?t.y.signal:i].join(", ")})`)):Math.min(r,i)}function dJ(e,t){vJ(e)?function(e,t){const n=e.component.scales,{config:r,encoding:i,markDef:a,specifiedScales:s}=e;for(const o of qz(n)){const u=s[o],l=n[o],c=e.getScaleComponent(o),d=jV(i[o]),h=u[t],f=c.get("type"),p=c.get("padding"),g=c.get("paddingInner"),m=$W(f,t),y=TW(o,t);if(void 0!==h&&(m?y&&vU(y):vU(lU(f,t,o))),m&&void 0===y)if(void 0!==h)l.copyKeyFromObject(t,u);else{const n=t in hJ?hJ[t]({model:e,channel:o,fieldOrDatumDef:d,scaleType:f,scalePadding:p,scalePaddingInner:g,domain:u.domain,markDef:a,config:r}):r.scale[t];void 0!==n&&l.set(t,n,!1)}}}(e,t):pJ(e,t)}const hJ={bins:({model:e,fieldOrDatumDef:t})=>vV(t)?function(e,t){const n=t.bin;if(Lj(n)){const r=aQ(e,t.field,n);return new WQ((()=>e.getSignalName(r)))}if(Pj(n)&&jj(n)&&void 0!==n.step)return{step:n.step}}(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>function(e,t){if(Bz([dP,hP,fP],e)&&"nominal"!==t)return"hcl"}(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>function(e,t,n){var r;if(!(null===(r=PV(n))||void 0===r?void 0:r.bin)&&!Bz([sW,oW],e))return t in gj||void 0}(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:r,config:i})=>function(e,t,n,r,i,a){if(e in gj){if(kW(t)){if(void 0!==n.continuousPadding)return n.continuousPadding;const{type:t,orient:s}=i;if("bar"===t&&(!vV(r)||!r.bin&&!r.timeUnit)&&("vertical"===s&&"x"===e||"horizontal"===s&&"y"===e))return a.continuousBandSize}if(t===uW)return n.pointPadding}}(e,t,i.scale,n,r,i.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:r})=>function(e,t,n,r){if(void 0===e&&t in gj){const{bandPaddingInner:e,barBandPaddingInner:t,rectBandPaddingInner:i}=r;return sL(e,"bar"===n?t:i)}}(e,t,n.type,r.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:r,scalePaddingInner:i,config:a})=>function(e,t,n,r,i,a){if(void 0===e&&t in gj&&"band"===n){const{bandPaddingOuter:e}=a;return sL(e,OU(i)?{signal:`${i.signal}/2`}:i/2)}}(e,t,n,r.type,i,a.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:r})=>function(e,t,n,r){return"x"===n&&void 0!==r.xReverse?wW(e)&&"descending"===t?OU(r.xReverse)?{signal:`!${r.xReverse.signal}`}:!r.xReverse:r.xReverse:!(!wW(e)||"descending"!==t)||void 0}(t,vV(e)?e.sort:void 0,n,r.scale),zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:r,scaleType:i})=>function(e,t,n,r,i){if(n&&"unaggregated"!==n&&wW(i)){if(iz(n)){const e=n[0],t=n[n.length-1];if(e<=0&&t>=0)return!0}return!1}if("size"===e&&"quantitative"===t.type&&!_W(i))return!0;if((!vV(t)||!t.bin)&&Bz([...mj,...bj],e)){const{orient:t,type:n}=r;return!Bz(["bar","area","line","trail"],n)||!("horizontal"===t&&"y"===e||"vertical"===t&&"x"===e)}return!1}(e,t,n,r,i)};function fJ(e){vJ(e)?function(e){const t=e.component.scales;for(const n of $j){const r=t[n];if(!r)continue;const i=sJ(n,e);r.setWithExplicit("range",i)}}(e):pJ(e,"range")}function pJ(e,t){const n=e.component.scales;for(const n of e.children)"range"===t?fJ(n):dJ(n,t);for(const r of qz(n)){let i;for(const n of e.children){const e=n.component.scales[r];e&&(i=Hq(i,e.getWithExplicit(t),t,"scale",Gq(((e,n)=>"range"===t&&e.step&&n.step?e.step-n.step:0))))}n[r].setWithExplicit(t,i)}}function gJ(e){vJ(e)?e.component.scales=function(e){const{encoding:t,mark:n}=e;return $j.reduce(((r,i)=>{const a=jV(t[i]);if(a&&n===NL&&i===pP&&a.type===rW)return r;let s=a&&a.scale;if(a&&null!==s&&!1!==s){s=null!=s?s:{};const t=function(e,t,n,r){const i=function(e,t,n){var r;switch(t.type){case"nominal":case"ordinal":if(MP(e)||"discrete"===Bj(e))return"shape"===e&&"ordinal"===t.type&&vU(aU(e,"ordinal")),"ordinal";if(e in gj){if(Bz(["rect","bar","image","rule"],n))return"band"}else if("arc"===n&&e in vj)return"band";return void 0!==t.band||EV(t)&&(null===(r=t.axis)||void 0===r?void 0:r.tickBand)?"band":"point";case"temporal":return MP(e)?"time":"discrete"===Bj(e)?(vU(aU(e,"temporal")),"ordinal"):vV(t)&&t.timeUnit&&TU(t.timeUnit).utc?"utc":"time";case"quantitative":return MP(e)?vV(t)&&Lj(t.bin)?"bin-ordinal":"linear":"discrete"===Bj(e)?(vU(aU(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(eU(t.type))}(t,n,r),{type:a}=e;return Tj(t)?void 0!==a?MW(t,a)?vV(n)&&!OW(a,n.type)?(vU(function(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}(a,i)),i):a:(vU(function(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}(t,a,i)),i):i:null}(s,i,a,n);r[i]=new nJ(e.scaleName(i+"",!0),{value:t,explicit:s.type===t})}return r}),{})}(e):e.component.scales=function(e){var t;const n=e.component.scales={},r={},i=e.component.resolve;for(const n of e.children){gJ(n);for(const a of qz(n.component.scales))if(i.scale[a]=null!==(t=i.scale[a])&&void 0!==t?t:MY(a,e),"shared"===i.scale[a]){const e=r[a],t=n.component.scales[a].getWithExplicit("type");e?dW(e.value,t.value)?r[a]=Hq(e,t,"type","scale",mJ):(i.scale[a]="independent",delete r[a]):r[a]=t}}for(const t of qz(r)){const i=e.scaleName(t,!0),a=r[t];n[t]=new nJ(i,a);for(const n of e.children){const e=n.component.scales[t];e&&(n.renameScale(e.get("name"),i),e.merged=!0)}}return n}(e)}const mJ=Gq(((e,t)=>fW(e)-fW(t)));class yJ{constructor(){this.nameMap={}}rename(e,t){this.nameMap[e]=t}has(e){return void 0!==this.nameMap[e]}get(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e}}function vJ(e){return"unit"===(null==e?void 0:e.type)}function bJ(e){return"facet"===(null==e?void 0:e.type)}function xJ(e){return"concat"===(null==e?void 0:e.type)}function wJ(e){return"layer"===(null==e?void 0:e.type)}class kJ{constructor(e,t,n,r,i,a,s){var o,u;this.type=t,this.parent=n,this.config=i,this.view=s,this.children=[],this.correctDataNames=e=>(e.from&&e.from.data&&(e.from.data=this.lookupDataSource(e.from.data)),e.from&&e.from.facet&&e.from.facet.data&&(e.from.facet.data=this.lookupDataSource(e.from.facet.data)),e),this.parent=n,this.config=i,this.name=null!==(o=e.name)&&void 0!==o?o:r,this.title=JV(e.title)?{text:e.title}:e.title,this.scaleNameMap=n?n.scaleNameMap:new yJ,this.projectionNameMap=n?n.projectionNameMap:new yJ,this.signalNameMap=n?n.signalNameMap:new yJ,this.data=e.data,this.description=e.description,this.transforms=(null!==(u=e.transform)&&void 0!==u?u:[]).map((e=>iH(e)?{filter:Iz(e.filter,QU)}:e)),this.layout="layer"===t||"unit"===t?{}:function(e,t,n){var r,i;const a=n[t],s={},{spacing:o,columns:u}=a;void 0!==o&&(s.spacing=o),void 0!==u&&(cV(e)&&!uV(e.facet)||KG(e))&&(s.columns=u),YG(e)&&(s.columns=1);for(const t of eq)if(void 0!==e[t])if("spacing"===t){const n=e[t];s[t]=pz(n)?n:{row:null!==(r=n.row)&&void 0!==r?r:o,column:null!==(i=n.column)&&void 0!==i?i:o}}else s[t]=e[t];return s}(e,t,i),this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:cV(e)||n&&n.component.data.isFaceted&&void 0===e.data},layoutSize:new Uq,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},a?Nz(a):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){!function(e,{ignoreRange:t}={}){gJ(e),VQ(e);for(const t of NW)dJ(e,t);t||fJ(e)}(this)}parseProjection(){rQ(this)}renameTopLevelLayoutSizeSignal(){"width"!==this.getName("width")&&this.renameSignal(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameSignal(this.getName("height"),"height")}parseLegends(){XY(this)}assembleGroupStyle(){var e,t;if("unit"===this.type||"layer"===this.type)return null!==(t=null===(e=this.view)||void 0===e?void 0:e.style)&&void 0!==t?t:"cell"}assembleEncodeFromView(e){const{style:t}=e,n=vz(e,["style"]),r={};for(const e of qz(n)){const t=n[e];void 0!==t&&(r[e]=ZV(t))}return r}assembleGroupEncodeEntry(e){let t={};return this.view&&(t=this.assembleEncodeFromView(this.view)),e||(this.description&&(t.description=ZV(this.description)),"unit"!==this.type&&"layer"!==this.type)?Gz(t)?void 0:t:Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},null!=t?t:{})}assembleLayout(){if(!this.layout)return;const e=this.layout,{spacing:t}=e,n=vz(e,["spacing"]),{component:r,config:i}=this,a=function(e,t){const n={};for(const r of BP){const i=e[r];if(null==i?void 0:i.facetFieldDef){const{titleAnchor:e,titleOrient:a}=mY(["titleAnchor","titleOrient"],i.facetFieldDef,t,r),s=pY(r,a),o=EY(e,s);void 0!==o&&(n[s]=o)}}return Gz(n)?void 0:n}(r.layoutHeaders,i);return Object.assign(Object.assign(Object.assign({padding:t},this.assembleDefaultLayout()),n),a?{titleBand:a}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:e}=this.component;let t=[];for(const n of BP)e[n].title&&t.push(bY(this,n));for(const e of yY)t=t.concat(kY(this,e));return t}assembleAxes(){return function(e,t){const{x:n=[],y:r=[]}=e;return[...n.map((e=>JK(e,"grid",t))),...r.map((e=>JK(e,"grid",t))),...n.map((e=>JK(e,"main",t))),...r.map((e=>JK(e,"main",t)))].filter((e=>e))}(this.component.axes,this.config)}assembleLegends(){return ZY(this)}assembleProjections(){return wJ(e=this)||xJ(e)?function(e){return e.children.reduce(((e,t)=>e.concat(t.assembleProjections())),eQ(e))}(e):eQ(e);var e}assembleTitle(){var e,t,n;const r=null!==(e=this.title)&&void 0!==e?e:{},{encoding:i}=r,a=vz(r,["encoding"]),s=Object.assign(Object.assign(Object.assign({},QV(this.config.title).nonMark),a),i?{encode:{update:i}}:{});if(s.text)return Bz(["unit","layer"],this.type)?Bz(["middle",void 0],s.anchor)&&(s.frame=null!==(t=s.frame)&&void 0!==t?t:"group"):s.anchor=null!==(n=s.anchor)&&void 0!==n?n:"start",Gz(s)?void 0:s}assembleGroup(e=[]){const t={};(e=e.concat(this.assembleSignals())).length>0&&(t.signals=e);const n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||bJ(this.parent)?eJ(this):[];r.length>0&&(t.scales=r);const i=this.assembleAxes();i.length>0&&(t.axes=i);const a=this.assembleLegends();return a.length>0&&(t.legends=a),t}getName(e){return Yz((this.name?this.name+"_":"")+e)}requestDataName(e){var t;const n=this.getName(e),r=this.component.data.outputNodeRefCounts;return r[n]=(null!==(t=r[n])&&void 0!==t?t:0)+1,n}getSizeSignalRef(e){if(bJ(this.parent)){const t=xj(TY(e)),n=this.component.scales[t];if(n&&!n.merged){const e=n.get("type"),r=n.get("range");if(xW(e)&&MU(r)){const e=n.get("name"),r=JQ(ZQ(this,t));return r?{signal:$Y(e,n,DV({aggregate:"distinct",field:r},{expr:"datum"}))}:(vU(`Unknown field for ${t}. Cannot calculate view size.`),null)}}}return{signal:this.signalNameMap.get(this.getName(e))}}lookupDataSource(e){const t=this.component.data.outputNodes[e];return t?t.getSource():e}getSignalName(e){return this.signalNameMap.get(e)}renameSignal(e,t){this.signalNameMap.rename(e,t)}renameScale(e,t){this.scaleNameMap.rename(e,t)}renameProjection(e,t){this.projectionNameMap.rename(e,t)}scaleName(e,t){return t?this.getName(e):XP(e)&&Tj(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0}projectionName(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0}getSelectionComponent(e,t){let n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(`Cannot find a selection named "${t}".`);return n}hasAxisOrientSignalRef(){var e,t;return(null===(e=this.component.axes.x)||void 0===e?void 0:e.some((e=>e.hasOrientSignalRef())))||(null===(t=this.component.axes.y)||void 0===t?void 0:t.some((e=>e.hasOrientSignalRef())))}}class _J extends kJ{vgField(e,t={}){const n=this.fieldDef(e);if(n)return DV(n,t)}reduceFieldDef(e,t){return yG(this.getMapping(),((t,n,r)=>{const i=PV(n);return i?e(t,i,r):t}),t)}forEachFieldDef(e,t){mG(this.getMapping(),((t,n)=>{const r=PV(t);r&&e(r,n)}),t)}}class SJ extends QH{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=Nz(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"value",null!==(i=a[1])&&void 0!==i?i:"density"]}clone(){return new SJ(null,Nz(this.transform))}dependentFields(){var e;return new Set([this.transform.density,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${Mz(this.transform)}`}assemble(){const e=this.transform,{density:t}=e,n=vz(e,["density"]);return Object.assign({type:"kde",field:t},n)}}class CJ extends QH{constructor(e,t){super(e),this.filter=t}clone(){return new CJ(null,Object.assign({},this.filter))}static make(e,t){const{config:n,mark:r,markDef:i}=t;if("filter"!==rG("invalid",i,n))return null;const a=t.reduceFieldDef(((e,n,i)=>{const a=Tj(i)&&t.getScaleComponent(i);return a&&wW(a.get("type"))&&"count"!==n.aggregate&&!$L(r)&&(e[n.field]=n),e}),{});return qz(a).length?new CJ(e,a):null}dependentFields(){return new Set(qz(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${Mz(this.filter)}`}assemble(){const e=qz(this.filter).reduce(((e,t)=>{const n=this.filter[t],r=DV(n,{expr:"datum"});return null!==n&&("temporal"===n.type?e.push(`(isDate(${r}) || (isValid(${r}) && isFinite(+${r})))`):"quantitative"===n.type&&(e.push(`isValid(${r})`),e.push(`isFinite(+${r})`))),e}),[]);return e.length>0?{type:"filter",expr:e.join(" && ")}:null}}class AJ extends QH{constructor(e,t){super(e),this.transform=t,this.transform=Nz(t);const{flatten:n,as:r=[]}=this.transform;this.transform.as=n.map(((e,t)=>{var n;return null!==(n=r[t])&&void 0!==n?n:e}))}clone(){return new AJ(this.parent,Nz(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${Mz(this.transform)}`}assemble(){const{flatten:e,as:t}=this.transform;return{type:"flatten",fields:e,as:t}}}class EJ extends QH{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=Nz(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"key",null!==(i=a[1])&&void 0!==i?i:"value"]}clone(){return new EJ(null,Nz(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${Mz(this.transform)}`}assemble(){const{fold:e,as:t}=this.transform;return{type:"fold",fields:e,as:t}}}class FJ extends QH{constructor(e,t,n,r){super(e),this.fields=t,this.geojson=n,this.signal=r}clone(){return new FJ(null,Nz(this.fields),this.geojson,this.signal)}static parseAll(e,t){if(t.component.projection&&!t.component.projection.isFit)return e;let n=0;for(const r of[[uP,oP],[cP,lP]]){const i=r.map((e=>{const n=jV(t.encoding[e]);return vV(n)?n.field:xV(n)?{expr:`${n.datum}`}:CV(n)?{expr:`${n.value}`}:void 0}));(i[0]||i[1])&&(e=new FJ(e,i,null,t.getName("geojson_"+n++)))}if(t.channelHasField(pP)){const r=t.typedFieldDef(pP);r.type===rW&&(e=new FJ(e,null,r.field,t.getName("geojson_"+n++)))}return e}dependentFields(){var e;const t=(null!==(e=this.fields)&&void 0!==e?e:[]).filter(gz);return new Set([...this.geojson?[this.geojson]:[],...t])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${Mz(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class IJ extends QH{constructor(e,t,n,r){super(e),this.projection=t,this.fields=n,this.as=r}clone(){return new IJ(null,this.projection,Nz(this.fields),Nz(this.as))}static parseAll(e,t){if(!t.projectionName())return e;for(const n of[[uP,oP],[cP,lP]]){const r=n.map((e=>{const n=jV(t.encoding[e]);return vV(n)?n.field:xV(n)?{expr:`${n.datum}`}:CV(n)?{expr:`${n.value}`}:void 0})),i=n[0]===cP?"2":"";(r[0]||r[1])&&(e=new IJ(e,t.projectionName(),r,[t.getName("x"+i),t.getName("y"+i)]))}return e}dependentFields(){return new Set(this.fields.filter(gz))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${Mz(this.fields)} ${Mz(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class DJ extends QH{constructor(e,t){super(e),this.transform=t}clone(){return new DJ(null,Nz(this.transform))}dependentFields(){var e;return new Set([this.transform.impute,this.transform.key,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(e){const{start:t=0,stop:n,step:r}=e;return{signal:`sequence(${[t,n,...r?[r]:[]].join(",")})`}}static makeFromTransform(e,t){return new DJ(e,t)}static makeFromEncoding(e,t){const n=t.encoding,r=n.x,i=n.y;if(vV(r)&&vV(i)){const a=r.impute?r:i.impute?i:void 0;if(void 0===a)return;const s=r.impute?i:i.impute?r:void 0,{method:o,value:u,frame:l,keyvals:c}=a.impute,d=vG(t.mark,n);return new DJ(e,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:a.field,key:s.field},o?{method:o}:{}),void 0!==u?{value:u}:{}),l?{frame:l}:{}),void 0!==c?{keyvals:c}:{}),d.length?{groupby:d}:{}))}return null}hash(){return`Impute ${Mz(this.transform)}`}assemble(){const{impute:e,key:t,keyvals:n,method:r,groupby:i,value:a,frame:s=[null,null]}=this.transform,o=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:e,key:t},n?{keyvals:(u=n,void 0!==(null==u?void 0:u.stop)?this.processSequence(n):n)}:{}),{method:"value"}),i?{groupby:i}:{}),{value:r&&"value"!==r?null:a});var u;return r&&"value"!==r?[o,Object.assign({type:"window",as:[`imputed_${e}_value`],ops:[r],fields:[e],frame:s,ignorePeers:!1},i?{groupby:i}:{}),{type:"formula",expr:`datum.${e} === null ? datum.imputed_${e}_value : datum.${e}`,as:e}]:[o]}}class NJ extends QH{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=Nz(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:t.on,null!==(i=a[1])&&void 0!==i?i:t.loess]}clone(){return new NJ(null,Nz(this.transform))}dependentFields(){var e;return new Set([this.transform.loess,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${Mz(this.transform)}`}assemble(){const e=this.transform,{loess:t,on:n}=e,r=vz(e,["loess","on"]);return Object.assign({type:"loess",x:n,y:t},r)}}class $J extends QH{constructor(e,t,n){super(e),this.transform=t,this.secondary=n}clone(){return new $J(null,Nz(this.transform),this.secondary)}static make(e,t,n,r){const i=t.component.data.sources,{from:a}=n;let s=null;if(function(e){return"data"in e}(a)){let e=HJ(a.data,i);e||(e=new uQ(a.data),i.push(e));const n=t.getName(`lookup_${r}`);s=new JH(e,n,"lookup",t.component.data.outputNodeRefCounts),t.component.data.outputNodes[n]=s}else if(function(e){return"selection"in e}(a)){const e=a.selection;if(n=Object.assign({as:e},n),s=t.getSelectionComponent(Yz(e),e).materialized,!s)throw new Error(`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`)}return new $J(e,n,s.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?cz(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${Mz({transform:this.transform,secondary:this.secondary})}`}assemble(){let e;if(this.transform.from.fields)e=Object.assign({values:this.transform.from.fields},this.transform.as?{as:cz(this.transform.as)}:{});else{let t=this.transform.as;gz(t)||(vU('If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.'),t="_lookup"),e={as:[t]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e),this.transform.default?{default:this.transform.default}:{})}}class TJ extends QH{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=Nz(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"prob",null!==(i=a[1])&&void 0!==i?i:"value"]}clone(){return new TJ(null,Nz(this.transform))}dependentFields(){var e;return new Set([this.transform.quantile,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${Mz(this.transform)}`}assemble(){const e=this.transform,{quantile:t}=e,n=vz(e,["quantile"]);return Object.assign({type:"quantile",field:t},n)}}class OJ extends QH{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=Nz(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:t.on,null!==(i=a[1])&&void 0!==i?i:t.regression]}clone(){return new OJ(null,Nz(this.transform))}dependentFields(){var e;return new Set([this.transform.regression,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${Mz(this.transform)}`}assemble(){const e=this.transform,{regression:t,on:n}=e,r=vz(e,["regression","on"]);return Object.assign({type:"regression",x:n,y:t},r)}}class MJ extends QH{constructor(e,t){super(e),this.transform=t}clone(){return new MJ(null,Nz(this.transform))}addDimensions(e){var t;this.transform.groupby=jz((null!==(t=this.transform.groupby)&&void 0!==t?t:[]).concat(e),(e=>e))}producedFields(){}dependentFields(){var e;return new Set([this.transform.pivot,this.transform.value,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}hash(){return`PivotTransform ${Mz(this.transform)}`}assemble(){const{pivot:e,value:t,groupby:n,limit:r,op:i}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:e,value:t},void 0!==r?{limit:r}:{}),void 0!==i?{op:i}:{}),void 0!==n?{groupby:n}:{})}}class RJ extends QH{constructor(e,t){super(e),this.transform=t}clone(){return new RJ(null,Nz(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${Mz(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function BJ(e){let t=0;return function n(r,i){var a;if(r instanceof uQ&&!r.isGenerator&&!Kq(r.data)&&(e.push(i),i={name:null,source:i.name,transform:[]}),r instanceof xQ&&(r.parent instanceof uQ&&!i.source?(i.format=Object.assign(Object.assign({},null!==(a=i.format)&&void 0!==a?a:{}),{parse:r.assembleFormatParse()}),i.transform.push(...r.assembleTransforms(!0))):i.transform.push(...r.assembleTransforms())),r instanceof yQ){i.name||(i.name="data_"+t++),!i.source||i.transform.length>0?(e.push(i),r.data=i.name):r.data=i.source;for(const t of r.assemble())e.push(t)}else switch((r instanceof cQ||r instanceof dQ||r instanceof CJ||r instanceof HK||r instanceof hY||r instanceof IJ||r instanceof FJ||r instanceof mQ||r instanceof $J||r instanceof SQ||r instanceof kQ||r instanceof EJ||r instanceof AJ||r instanceof SJ||r instanceof NJ||r instanceof TJ||r instanceof OJ||r instanceof wQ||r instanceof RJ||r instanceof MJ)&&i.transform.push(r.assemble()),(r instanceof oQ||r instanceof ZH||r instanceof DJ||r instanceof _Q)&&i.transform.push(...r.assemble()),r instanceof JH&&(i.source&&0===i.transform.length?r.setSource(i.source):r.parent instanceof JH?r.setSource(i.name):(i.name||(i.name="data_"+t++),r.setSource(i.name),1===r.numChildren()&&(e.push(i),i={name:null,source:i.name,transform:[]}))),r.numChildren()){case 0:r instanceof JH&&(!i.source||i.transform.length>0)&&e.push(i);break;case 1:n(r.children[0],i);break;default:{i.name||(i.name="data_"+t++);let a=i.name;!i.source||i.transform.length>0?e.push(i):a=i.source;for(const e of r.children)n(e,{name:null,source:a,transform:[]});break}}}}function zJ(e){return"top"===e||"left"===e||OU(e)?"header":"footer"}function LJ(e,t){var n;const{facet:r,config:i,child:a,component:s}=e;if(e.channelHasField(t)){const o=r[t],u=gY("title",null,i,t);let l=RV(o,i,{allowDisabling:!0,includeDefault:void 0===u||!!u});a.component.layoutHeaders[t].title&&(l=iz(l)?l.join(", "):l,l+=" / "+a.component.layoutHeaders[t].title,a.component.layoutHeaders[t].title=null);const c=gY("labelOrient",o,i,t),d=sL((null!==(n=o.header)&&void 0!==n?n:{}).labels,i.header.labels,!0),h=Bz(["bottom","right"],c)?"footer":"header";s.layoutHeaders[t]={title:l,facetFieldDef:o,[h]:"facet"===t?[]:[PJ(e,t,d)]}}}function PJ(e,t,n){const r="row"===t?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(r)?e.child.getSizeSignalRef(r):void 0,axes:[]}}function jJ(e,t){var n;const{child:r}=e;if(r.component.axes[t]){const{layoutHeaders:i,resolve:a}=e.component;if(a.axis[t]=RY(a,t),"shared"===a.axis[t]){const a="x"===t?"column":"row",s=i[a];for(const i of r.component.axes[t]){const t=zJ(i.get("orient"));s[t]=null!==(n=s[t])&&void 0!==n?n:[PJ(e,a,!1)];const r=JK(i,"main",e.config,{header:!0});r&&s[t][0].axes.push(r),i.mainExtracted=!0}}}}function UJ(e){for(const t of e.children)t.parseLayoutSize()}function WJ(e,t){const n=TY(t),r=xj(n),i=e.component.resolve,a=e.component.layoutSize;let s;for(const t of e.children){const e=t.component.layoutSize.getWithExplicit(n),a=i.scale[r];if("independent"===a&&"step"===e.value){s=void 0;break}if(s){if("independent"===a&&s.value!==e.value){s=void 0;break}s=Hq(s,e,n,"")}else s=e}if(s){for(const r of e.children)e.renameSignal(r.getName(n),e.getName(t)),r.component.layoutSize.set(n,"merged",!1);a.setWithExplicit(t,s)}else a.setWithExplicit(t,{explicit:!1,value:void 0})}function VJ(e,t){const n="width"===t?"x":"y",r=e.config,i=e.getScaleComponent(n);if(i){const e=i.get("type"),n=i.get("range");if(xW(e)){const e=rq(r.view,t);return MU(n)||JG(e)?"step":e}return tq(r.view,t)}if(e.hasProjection||"arc"===e.mark)return tq(r.view,t);{const e=rq(r.view,t);return JG(e)?e.step:e}}function GJ(e,t,n){return DV(t,Object.assign({suffix:`by_${DV(e)}`},null!=n?n:{}))}class qJ extends _J{constructor(e,t,n,r){super(e,"facet",t,n,r,e.resolve),this.child=gZ(e.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(e.facet,r)}initFacet(e,t){return uV(e)?yG(e,((e,n,r)=>Bz([YL,QL],r)?void 0===n.field?(vU(nU(n,r)),e):(e[r]=UV(n,r,t),e):(vU(rU(r,"facet")),e)),{}):{facet:UV(e,"facet",t)}}channelHasField(e){return!!this.facet[e]}fieldDef(e){return this.facet[e]}parseData(){this.component.data=XJ(this),this.child.parseData()}parseLayoutSize(){UJ(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),function(e){for(const t of BP)LJ(e,t);jJ(e,"x"),jJ(e,"y")}(this)}assembleSelectionTopLevelSignals(e){return this.child.assembleSelectionTopLevelSignals(e)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(e){return this.child.assembleSelectionData(e)}getHeaderLayoutMixins(){var e,t,n;const r={};for(const i of BP)for(const a of vY){const s=this.component.layoutHeaders[i],o=s[a],{facetFieldDef:u}=s;if(u){const t=gY("titleOrient",u,this.config,i);if(Bz(["right","bottom"],t)){const n=pY(i,t);r.titleAnchor=null!==(e=r.titleAnchor)&&void 0!==e?e:{},r.titleAnchor[n]="end"}}if(null==o?void 0:o[0]){const e="row"===i?"height":"width",o="header"===a?"headerBand":"footerBand";"facet"===i||this.child.component.layoutSize.get(e)||(r[o]=null!==(t=r[o])&&void 0!==t?t:{},r[o][i]=.5),s.title&&(r.offset=null!==(n=r.offset)&&void 0!==n?n:{},r.offset["row"===i?"rowTitle":"columnTitle"]=10)}}return r}assembleDefaultLayout(){const{column:e,row:t}=this.facet,n=e?this.columnDistinctSignal():t?1:void 0;let r="all";return(t||"independent"!==this.component.resolve.scale.x)&&(e||"independent"!==this.component.resolve.scale.y)||(r="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),n?{columns:n}:{}),{bounds:"full",align:r})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof qJ))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroup(e){return this.parent&&this.parent instanceof qJ?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:DV(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(e)):super.assembleGroup(e)}getCardinalityAggregateForChild(){const e=[],t=[],n=[];if(this.child instanceof qJ){if(this.child.channelHasField("column")){const r=DV(this.child.facet.column);e.push(r),t.push("distinct"),n.push(`distinct_${r}`)}}else for(const r of mj){const i=this.child.component.scales[r];if(i&&!i.merged){const a=i.get("type"),s=i.get("range");if(xW(a)&&MU(s)){const i=JQ(ZQ(this.child,r));i?(e.push(i),t.push("distinct"),n.push(`distinct_${i}`)):vU(`Unknown field for ${r}. Cannot calculate view size.`)}}}return{fields:e,ops:t,as:n}}assembleFacet(){const{name:e,data:t}=this.component.data.facetRoot,{row:n,column:r}=this.facet,{fields:i,ops:a,as:s}=this.getCardinalityAggregateForChild(),o=[];for(const e of BP){const t=this.facet[e];if(t){o.push(DV(t));const{bin:u,sort:l}=t;if(Lj(u)&&o.push(DV(t,{binSuffix:"end"})),sV(l)){const{field:e,op:o=nV}=l,u=GJ(t,l);n&&r?(i.push(u),a.push("max"),s.push(u)):(i.push(e),a.push(o),s.push(u))}else if(iz(l)){const n=fY(t,e);i.push(n),a.push("max"),s.push(n)}}}const u=!!n&&!!r;return Object.assign({name:e,data:t,groupby:o},u||i.length>0?{aggregate:Object.assign(Object.assign({},u?{cross:u}:{}),i.length?{fields:i,ops:a,as:s}:{})}:{})}facetSortFields(e){const{facet:t}=this,n=t[e];return n?sV(n.sort)?[GJ(n,n.sort,{expr:"datum"})]:iz(n.sort)?[fY(n,e,{expr:"datum"})]:[DV(n,{expr:"datum"})]:[]}facetSortOrder(e){const{facet:t}=this,n=t[e];if(n){const{sort:e}=n;return[(sV(e)?e.order:!iz(e)&&e)||"ascending"]}return[]}assembleLabelTitle(){const{facet:e,config:t}=this;if(e.facet)return SY(e.facet,"facet",t);const n={row:["top","bottom"],column:["left","right"]};for(const r of yY)if(e[r]){const i=gY("labelOrient",e[r],t,r);if(Bz(n[r],i))return SY(e[r],r,t)}}assembleMarks(){const{child:e}=this,t=function(e){const t=[],n=BJ(t);for(const t of e.children)n(t,{source:e.name,name:null,transform:[]});return t}(this.component.data.facetRoot),n=e.assembleGroupEncodeEntry(!1),r=this.assembleLabelTitle()||e.assembleTitle(),i=e.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},r?{title:r}:{}),i?{style:i}:{}),{from:{facet:this.assembleFacet()},sort:{field:BP.map((e=>this.facetSortFields(e))).flat(),order:BP.map((e=>this.facetSortOrder(e))).flat()}}),t.length>0?{data:t}:{}),n?{encode:{update:n}}:{}),e.assembleGroup(function(e,t){if(e.component.selection&&qz(e.component.selection).length){const n=mz(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:VB("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return SX(t)}(this,[])))]}getMapping(){return this.facet}}function HJ(e,t){var n,r,i,a,s,o,u,l,c,d;for(const h of t){const t=h.data;if(!(e.name&&h.hasName()&&e.name!==h.dataName||(null===(n=e.format)||void 0===n?void 0:n.mesh)&&(null===(r=t.format)||void 0===r?void 0:r.feature)||((null===(i=e.format)||void 0===i?void 0:i.feature)||(null===(a=t.format)||void 0===a?void 0:a.feature))&&(null===(s=e.format)||void 0===s?void 0:s.feature)!==(null===(o=t.format)||void 0===o?void 0:o.feature)||((null===(u=e.format)||void 0===u?void 0:u.mesh)||(null===(l=t.format)||void 0===l?void 0:l.mesh))&&(null===(c=e.format)||void 0===c?void 0:c.mesh)!==(null===(d=t.format)||void 0===d?void 0:d.mesh)))if(Yq(e)&&Yq(t)){if(Dz(e.values,t.values))return h}else if(Kq(e)&&Kq(t)){if(e.url===t.url)return h}else if(Qq(e)&&e.name===h.dataName)return h}return null}function XJ(e){var t,n,r,i,a,s,o,u,l,c;let d=function(e,t){if(e.data||!e.parent){if(null===e.data){const e=new uQ({values:[]});return t.push(e),e}const n=HJ(e.data,t);if(n)return Jq(e.data)||(n.data.format=function(e,...t){for(const n of t)Pz(e,null!=n?n:{});return e}({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const n=new uQ(e.data);return t.push(n),n}}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}(e,e.component.data.sources);const{outputNodes:h,outputNodeRefCounts:f}=e.component.data,p=e.parent?e.parent.component.data.ancestorParse.clone():new Xq,g=e.data;Jq(g)?(Zq(g)?d=new dQ(d,g.sequence):tH(g)&&(d=new cQ(d,g.graticule)),p.parseNothing=!0):null===(null===(t=null==g?void 0:g.format)||void 0===t?void 0:t.parse)&&(p.parseNothing=!0),d=null!==(n=xQ.makeExplicit(d,e,p))&&void 0!==n?n:d,d=new wQ(d);const m=e.parent&&wJ(e.parent);(vJ(e)||bJ(e))&&m&&(d=null!==(r=oQ.makeFromEncoding(d,e))&&void 0!==r?r:d),e.transforms.length>0&&(d=function(e,t,n){var r,i;let a=0;for(const s of t.transforms){let o,u;if(gH(s))u=e=new hY(e,s),o="derived";else if(iH(s)){const i=bQ(s);u=e=null!==(r=xQ.makeWithAncestors(e,{},i,n))&&void 0!==r?r:e,e=new HK(e,t,s.filter)}else if(mH(s))u=e=oQ.makeFromTransform(e,s,t),o="number";else if(vH(s))o="date",void 0===n.getWithExplicit(s.field).value&&(e=new xQ(e,{[s.field]:o}),n.set(s.field,o,!1)),u=e=ZH.makeFromTransform(e,s);else if(bH(s))u=e=mQ.makeFromTransform(e,s),o="number",zX(t)&&(e=new wQ(e));else if(aH(s))u=e=$J.make(e,t,s,a++),o="derived";else if(hH(s))u=e=new SQ(e,s),o="number";else if(fH(s))u=e=new kQ(e,s),o="number";else if(xH(s))u=e=_Q.makeFromTransform(e,s),o="derived";else if(wH(s))u=e=new EJ(e,s),o="derived";else if(pH(s))u=e=new AJ(e,s),o="derived";else if(sH(s))u=e=new MJ(e,s),o="derived";else if(dH(s))e=new RJ(e,s);else if(yH(s))u=e=DJ.makeFromTransform(e,s),o="derived";else if(oH(s))u=e=new SJ(e,s),o="derived";else if(uH(s))u=e=new TJ(e,s),o="derived";else if(lH(s))u=e=new OJ(e,s),o="derived";else{if(!cH(s)){vU(`Ignoring an invalid transform: ${Oz(s)}.`);continue}u=e=new NJ(e,s),o="derived"}if(u&&void 0!==o)for(const e of null!==(i=u.producedFields())&&void 0!==i?i:[])n.set(e,o,!1)}return e}(d,e,p));const y=function(e){const t={};if(vJ(e)&&e.component.selection)for(const n of qz(e.component.selection)){const r=e.component.selection[n];for(const e of r.project.items)!e.channel&&aL(e.field)>1&&(t[e.field]="flatten")}return t}(e),v=function(e){const t={};function n(e){var n;HV(e)?t[e.field]="date":"quantitative"===e.type&&gz(n=e.aggregate)&&Bz(["min","max"],n)?t[e.field]="number":aL(e.field)>1?e.field in t||(t[e.field]="flatten"):AV(e)&&sV(e.sort)&&aL(e.sort.field)>1&&(e.sort.field in t||(t[e.sort.field]="flatten"))}if((vJ(e)||bJ(e))&&e.forEachFieldDef(((t,r)=>{if(SV(t))n(t);else{const i=QP(r),a=e.fieldDef(i);n(Object.assign(Object.assign({},t),{type:a.type}))}})),vJ(e)){const{mark:n,markDef:r,encoding:i}=e;if($L(n)&&!e.encoding.order){const e=i["horizontal"===r.orient?"y":"x"];vV(e)&&"quantitative"===e.type&&!(e.field in t)&&(t[e.field]="number")}}return t}(e);d=null!==(i=xQ.makeWithAncestors(d,{},Object.assign(Object.assign({},y),v),p))&&void 0!==i?i:d,vJ(e)&&(d=FJ.parseAll(d,e),d=IJ.parseAll(d,e)),(vJ(e)||bJ(e))&&(m||(d=null!==(a=oQ.makeFromEncoding(d,e))&&void 0!==a?a:d),d=null!==(s=ZH.makeFromEncoding(d,e))&&void 0!==s?s:d,d=hY.parseAllForSortIndex(d,e));const b=e.getName(rH),x=new JH(d,b,rH,f);if(h[b]=x,d=x,vJ(e)){const t=mQ.makeFromEncoding(d,e);t&&(d=t,zX(e)&&(d=new wQ(d))),d=null!==(o=DJ.makeFromEncoding(d,e))&&void 0!==o?o:d,d=null!==(u=_Q.makeFromEncoding(d,e))&&void 0!==u?u:d}vJ(e)&&(d=null!==(l=CJ.make(d,e))&&void 0!==l?l:d);const w=e.getName(nH),k=new JH(d,w,nH,f);h[w]=k,d=k,vJ(e)&&function(e,t){RX(e,(n=>{const r=n.name,i=e.getName(`lookup_${r}`);e.component.data.outputNodes[i]=n.materialized=new JH(new HK(t,e,{selection:r}),i,"lookup",e.component.data.outputNodeRefCounts)}))}(e,k);let _=null;if(bJ(e)){const t=e.getName("facet");d=null!==(c=function(e,t){const{row:n,column:r}=t;if(n&&r){let t=null;for(const i of[n,r])if(sV(i.sort)){const{field:n,op:r=nV}=i.sort;e=t=new kQ(e,{joinaggregate:[{op:r,field:n,as:GJ(i,i.sort,{forAs:!0})}],groupby:[DV(i)]})}return t}return null}(d,e.facet))&&void 0!==c?c:d,_=new yQ(d,e,t,k.getSource()),h[t]=_}return Object.assign(Object.assign({},e.component.data),{outputNodes:h,outputNodeRefCounts:f,raw:x,main:k,facetRoot:_,ancestorParse:p})}class KJ extends kJ{constructor(e,t,n,r){var i,a,s,o;super(e,"concat",t,n,r,e.resolve),"shared"!==(null===(a=null===(i=e.resolve)||void 0===i?void 0:i.axis)||void 0===a?void 0:a.x)&&"shared"!==(null===(o=null===(s=e.resolve)||void 0===s?void 0:s.axis)||void 0===o?void 0:o.y)||vU("Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415)."),this.children=this.getChildren(e).map(((e,t)=>gZ(e,this,this.getName("concat_"+t),void 0,r)))}parseData(){this.component.data=XJ(this);for(const e of this.children)e.parseData()}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of qz(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){for(const e of this.children)e.parseAxesAndHeaders()}getChildren(e){return YG(e)?e.vconcat:QG(e)?e.hconcat:e.concat}parseLayoutSize(){!function(e){UJ(e);const t=1===e.layout.columns?"width":"childWidth",n=void 0===e.layout.columns?"height":"childHeight";WJ(e,t),WJ(e,n)}(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(e){return this.children.reduce(((e,t)=>t.assembleSelectionTopLevelSignals(e)),e)}assembleSignals(){return this.children.forEach((e=>e.assembleSignals())),[]}assembleLayoutSignals(){const e=IY(this);for(const t of this.children)e.push(...t.assembleLayoutSignals());return e}assembleSelectionData(e){return this.children.reduce(((e,t)=>t.assembleSelectionData(e)),e)}assembleMarks(){return this.children.map((e=>{const t=e.assembleTitle(),n=e.assembleGroupStyle(),r=e.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:e.getName("group")},t?{title:t}:{}),n?{style:n}:{}),r?{encode:{update:r}}:{}),e.assembleGroup())}))}assembleDefaultLayout(){const e=this.layout.columns;return Object.assign(Object.assign({},null!=e?{columns:e}:{}),{bounds:"full",align:"each"})}}const YJ=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},pL),{labelExpr:1,encode:1}),QJ=qz(YJ);class JJ extends Uq{constructor(e={},t={},n=!1){super(),this.explicit=e,this.implicit=t,this.mainExtracted=n}clone(){return new JJ(Nz(this.explicit),Nz(this.implicit),this.mainExtracted)}hasAxisPart(e){return!("axis"!==e&&("grid"===e||"title"===e?!this.get(e):!1===(t=this.get(e))||null===t));var t}hasOrientSignalRef(){return OU(this.explicit.orient)}}const ZJ={bottom:"top",top:"bottom",left:"right",right:"left"};function eZ(e,t){if(!e)return t.map((e=>e.clone()));{if(e.length!==t.length)return;const n=e.length;for(let r=0;r<n;r++){const n=e[r],i=t[r];if(!!n!=!!i)return;if(n&&i){const t=n.getWithExplicit("orient"),a=i.getWithExplicit("orient");if(t.explicit&&a.explicit&&t.value!==a.value)return;e[r]=tZ(n,i)}}}return e}function tZ(e,t){for(const n of QJ){const r=Hq(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",((e,t)=>{switch(n){case"title":return cG(e,t);case"gridScale":return{explicit:e.explicit,value:sL(e.value,t.value)}}return qq(e,t,n,"axis")}));e.setWithExplicit(n,r)}return e}function nZ(e,t,n,r,i){if("disable"===t)return void 0!==n;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(OU(n.labelAngle)?n.labelAngle:uL(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===dY(r,i))return!0}return e===n[t]}const rZ=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function iZ(e,t){var n,r,i;let a=t.axis(e);const s=new JJ,o=jV(t.encoding[e]),{mark:u,config:l}=t,c=(null==a?void 0:a.orient)||(null===(n=l["x"===e?"axisX":"axisY"])||void 0===n?void 0:n.orient)||(null===(r=l.axis)||void 0===r?void 0:r.orient)||function(e){return"x"===e?"bottom":"left"}(e),d=t.getScaleComponent(e).get("type"),h=function(e,t,n,r){const i="band"===t?["axisDiscrete","axisBand"]:"point"===t?["axisDiscrete","axisPoint"]:t in mW?["axisQuantitative"]:"time"===t||"utc"===t?["axisTemporal"]:[],a="x"===e?"axisX":"axisY",s=OU(n)?"axisOrient":"axis"+Zz(n),o=[...i,...i.map((e=>a+e.substr(4)))],u=["axis",s,a];return{vlOnlyAxisConfig:iY(o,r,e,n),vgAxisConfig:iY(u,r,e,n),axisConfigStyle:aY([...u,...o],r)}}(e,d,c,t.config),f=void 0!==a?!a:sY("disable",l,null==a?void 0:a.style,h).configValue;if(s.set("disable",f,void 0!==a),f)return s;a=a||{};const p=function(e,t,n,r,i){const a=null==t?void 0:t.labelAngle;if(void 0!==a)return OU(a)?a:uL(a);{const{configValue:a}=sY("labelAngle",e.config,null==t?void 0:t.style,i);return void 0!==a?uL(a):n===ZL&&Bz([nW,eW],r.type)?270:void 0}}(t,a,e,o,h),g={fieldOrDatumDef:o,axis:a,channel:e,model:t,scaleType:d,orient:c,labelAngle:p,mark:u,config:l};for(const n of QJ){const r=n in oY?oY[n](g):mL(n)?a[n]:void 0,i=void 0!==r,o=nZ(r,n,a,t,e);if(i&&o)s.set(n,r,o);else{const{configValue:e,configFrom:u}=mL(n)&&"values"!==n?sY(n,t.config,a.style,h):{},l=void 0!==e;i&&!l?s.set(n,r,o):("vgAxisConfig"!==u||rZ.has(n)&&l||dL(e)||OU(e))&&s.set(n,e,!1)}}const m=null!==(i=a.encoding)&&void 0!==i?i:{},y=hL.reduce(((n,r)=>{var i;if(!s.hasAxisPart(r))return n;const a=OY(null!==(i=m[r])&&void 0!==i?i:{},t),o="labels"===r?function(e,t,n){var r;const{encoding:i,config:a}=e,s=null!==(r=jV(i[t]))&&void 0!==r?r:jV(i[ZP(t)]),o=e.axis(t)||{},{format:u,formatType:l}=o;return GW(l)?Object.assign({text:KW({fieldOrDatumDef:s,field:"datum.value",format:u,formatType:l,config:a})},n):n}(t,e,a):a;return void 0===o||Gz(o)||(n[r]={update:o}),n}),{});return Gz(y)||s.set("encode",y,!!a.encoding||void 0!==a.labelAngle),s}function aZ(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},VH(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),NH("x",e,{defaultPos:"mid"})),NH("y",e,{defaultPos:"mid"})),FH("size",e)),FH("angle",e)),function(e,t,n){return n?{shape:{value:n}}:FH("shape",e)}(e,0,t))}const sZ={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?Object.assign(Object.assign(Object.assign(Object.assign({},VH(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),RH("x",e,{defaultPos:"horizontal"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"vertical"!==n})),RH("y",e,{defaultPos:"vertical"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"horizontal"!==n})),FH("size",e,{vgChannel:"strokeWidth"})):{}}},oZ={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,r=n.orient,i="horizontal"===r?"width":"height",a="horizontal"===r?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},VH(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),NH("x",e,{defaultPos:"mid",vgChannel:"xc"})),NH("y",e,{defaultPos:"mid",vgChannel:"yc"})),FH("size",e,{defaultValue:uZ(e),vgChannel:i})),{[a]:ZV(rG("thickness",n,t))})}};function uZ(e){var t;const{config:n,markDef:r}=e,{orient:i}=r,a="horizontal"===i?"width":"height",s=e.getScaleComponent("horizontal"===i?"x":"y"),o=null!==(t=rG("size",r,n,{vgChannel:a}))&&void 0!==t?t:n.tick.bandSize;if(void 0!==o)return o;{const e=s?s.get("range"):void 0;return e&&MU(e)&&pz(e.step)?3*e.step/4:3*nq(n.view,a)/4}}const lZ={arc:{vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},VH(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),NH("x",e,{defaultPos:"mid"})),NH("y",e,{defaultPos:"mid"})),LH(e,"radius","arc")),LH(e,"theta","arc"))},area:{vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},VH(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),RH("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"horizontal"===e.markDef.orient})),RH("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"vertical"===e.markDef.orient})),qH(e))},bar:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},VH(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),LH(e,"x","bar")),LH(e,"y","bar"))},circle:{vgMark:"symbol",encodeEntry:e=>aZ(e,"circle")},geoshape:{vgMark:"shape",encodeEntry:e=>Object.assign({},VH(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},n&&vV(n)&&n.type===rW?{field:DV(n,{expr:"datum"})}:{})]}},image:{vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},VH(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),LH(e,"x","image")),LH(e,"y","image")),_H(e,"url"))},line:{vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},VH(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),NH("x",e,{defaultPos:"mid"})),NH("y",e,{defaultPos:"mid"})),FH("size",e,{vgChannel:"strokeWidth"})),qH(e))},point:{vgMark:"symbol",encodeEntry:e=>aZ(e)},rect:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},VH(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),LH(e,"x","rect")),LH(e,"y","rect"))},rule:sZ,square:{vgMark:"symbol",encodeEntry:e=>aZ(e,"square")},text:{vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},VH(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),NH("x",e,{defaultPos:"mid"})),NH("y",e,{defaultPos:"mid"})),_H(e)),FH("size",e,{vgChannel:"fontSize"})),FH("angle",e)),HH("align",function(e,t,n){if(void 0===rG("align",e,n))return"center"}(e.markDef,0,t))),HH("baseline",function(e,t,n){if(void 0===rG("baseline",e,n))return"middle"}(e.markDef,0,t))),NH("radius",e,{defaultPos:null,isMidPoint:!0})),NH("theta",e,{defaultPos:null,isMidPoint:!0}))}},tick:oZ,trail:{vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},VH(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),NH("x",e,{defaultPos:"mid"})),NH("y",e,{defaultPos:"mid"})),FH("size",e)),qH(e))}};const cZ="faceted_path_",dZ="stack_group_";function hZ(e,t={fromPrefix:""}){const{mark:n,markDef:r,config:i}=e,a=sL(r.clip,function(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return!!(t&&t.get("selectionExtent")||n&&n.get("selectionExtent"))||void 0}(e),function(e){const t=e.component.projection;return!(!t||t.isFit)||void 0}(e)),s=nG(r),o=e.encoding.key,u=function(e){const{encoding:t,stack:n,mark:r,markDef:i,config:a}=e,s=t.order;if(!(!iz(s)&&CV(s)&&Rz(s.value)||!s&&Rz(rG("order",i,a)))){if((iz(s)||vV(s))&&!n)return oG(s,{expr:"datum"});if($L(r)){const n="horizontal"===i.orient?"y":"x",r=t[n];if(vV(r)){const t=r.sort;return iz(t)?{field:DV(r,{prefix:n,suffix:"sort_index",expr:"datum"})}:sV(t)?{field:DV({aggregate:hG(e.encoding)?t.op:void 0,field:t.field},{expr:"datum"})}:aV(t)?{field:DV(e.fieldDef(t.encoding),{expr:"datum"}),order:t.order}:null===t?void 0:{field:DV(r,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}}}}(e),l=function(e){if(!e.component.selection)return null;const t=qz(e.component.selection).length;let n=t,r=e.parent;for(;r&&0===n;)n=qz(r.component.selection).length,r=r.parent;return n?{interactive:t>0}:null}(e),c=rG("aria",r,i),d=lZ[n].postEncodingTransform?lZ[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:lZ[n].vgMark},a?{clip:!0}:{}),s?{style:s}:{}),o?{key:o.field}:{}),u?{sort:u}:{}),l||{}),!1===c?{aria:c}:{}),{from:{data:t.fromPrefix+e.requestDataName(nH)},encode:{update:lZ[n].encodeEntry(e)}}),d?{transform:d}:{})]}class fZ extends _J{constructor(e,t,n,r={},i){var a,s;super(e,"unit",t,n,i,void 0,ZG(e)?e.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const o=ML(e.mark)?e.mark.type:e.mark;this.markDef=function(e,t,n,{graticule:r}){const i=ML(e)?Object.assign({},e):{type:e},a=rG("orient",i,n);if(i.orient=function(e,t,n){switch(e){case _L:case IL:case DL:case AL:case SL:case wL:return}const{x:r,y:i,x2:a,y2:s}=t;switch(e){case xL:if(vV(r)&&(Pj(r.bin)||vV(i)&&i.aggregate&&!r.aggregate))return"vertical";if(vV(i)&&(Pj(i.bin)||vV(r)&&r.aggregate&&!i.aggregate))return"horizontal";if(s||a){if(n)return n;if(!a&&(vV(r)&&r.type===ZU&&!Lj(r.bin)||kV(r)))return"horizontal";if(!s&&(vV(i)&&i.type===ZU&&!Lj(i.bin)||kV(i)))return"vertical"}case CL:if(a&&(!vV(r)||!Pj(r.bin))&&s&&(!vV(i)||!Pj(i.bin)))return;case bL:if(s)return vV(i)&&Pj(i.bin)?"horizontal":"vertical";if(a)return vV(r)&&Pj(r.bin)?"vertical":"horizontal";if(e===CL){if(r&&!i)return"vertical";if(i&&!r)return"horizontal"}case kL:case EL:{const t=wV(r),a=wV(i);if(t&&!a)return"tick"!==e?"horizontal":"vertical";if(!t&&a)return"tick"!==e?"vertical":"horizontal";if(t&&a){const t=r,a=i,s=t.type===tW,o=a.type===tW;return s&&!o?"tick"!==e?"vertical":"horizontal":!s&&o?"tick"!==e?"horizontal":"vertical":!t.aggregate&&a.aggregate?"tick"!==e?"vertical":"horizontal":t.aggregate&&!a.aggregate?"tick"!==e?"horizontal":"vertical":n||"vertical"}return n||void 0}}return"vertical"}(i.type,t,a),void 0!==a&&a!==i.orient&&vU(`Specified orient "${i.orient}" overridden with "${a}".`),"bar"===i.type&&i.orient){const e=rG("cornerRadiusEnd",i,n);if(void 0!==e){const n="horizontal"===i.orient&&t.x2||"vertical"===i.orient&&t.y2?["cornerRadius"]:zL[i.orient];for(const t of n)i[t]=e;void 0!==i.cornerRadiusEnd&&delete i.cornerRadiusEnd}}return void 0===rG("opacity",i,n)&&(i.opacity=function(e,t){if(Bz([_L,EL,IL,DL],e)&&!hG(t))return.7}(i.type,t)),void 0===i.filled&&(i.filled=!r&&function(e,t){const n=iG("filled",e,t),r=e.type;return sL(n,r!==_L&&r!==kL&&r!==CL)}(i,n)),void 0===rG("cursor",i,n)&&(i.cursor=function(e,t,n){return t.href||e.href||rG("href",e,n)?"pointer":e.cursor}(i,t,n)),i}(e.mark,null!==(a=e.encoding)&&void 0!==a?a:{},i,{graticule:e.data&&tH(e.data)});const u=this.encoding=pG(null!==(s=e.encoding)&&void 0!==s?s:{},this.markDef,i);this.size=function({encoding:e,size:t}){for(const n of mj){const r=ej(n);JG(t[r])&&wV(e[n])&&(delete t[r],vU(cU(r)))}return t}({encoding:u,size:ZG(e)?Object.assign(Object.assign(Object.assign({},r),e.width?{width:e.width}:{}),e.height?{height:e.height}:{}):r}),this.stack=xq(o,u),this.specifiedScales=this.initScales(o,u),this.specifiedAxes=this.initAxes(u),this.specifiedLegends=this.initLegend(u),this.specifiedProjection=e.projection,this.selection=e.selection}get hasProjection(){const{encoding:e}=this,t=this.mark===NL,n=e&&TP.some((t=>_V(e[t])));return t||n}scaleDomain(e){const t=this.specifiedScales[e];return t?t.domain:void 0}axis(e){return this.specifiedAxes[e]}legend(e){return this.specifiedLegends[e]}initScales(e,t){return $j.reduce(((e,n)=>{var r;const i=jV(t[n]);return i&&(e[n]=null!==(r=i.scale)&&void 0!==r?r:{}),e}),{})}initAxes(e){return mj.reduce(((t,n)=>{const r=e[n];if(_V(r)||n===ZL&&_V(e.x2)||n===eP&&_V(e.y2)){const e=_V(r)?r.axis:void 0;t[n]=e?Object.assign({},e):e}return t}),{})}initLegend(e){return Dj.reduce(((t,n)=>{const r=jV(e[n]);if(r&&function(e){switch(e){case dP:case hP:case fP:case gP:case pP:case yP:case xP:case wP:return!0;case vP:case bP:case mP:return!1}}(n)){const e=r.legend;t[n]=e?Object.assign({},e):e}return t}),{})}parseData(){this.component.data=XJ(this)}parseLayoutSize(){!function(e){const{size:t,component:n}=e;for(const r of mj){const i=ej(r);if(t[i]){const e=t[i];n.layoutSize.set(i,JG(e)?"step":e,!0)}else{const t=VJ(e,i);n.layoutSize.set(i,t,!1)}}}(this)}parseSelections(){this.component.selection=function(e,t){var n;const r={},i=e.config.selection;for(const a of qz(null!=t?t:{})){const s=Nz(t[a]),o=i[s.type],{fields:u,encodings:l}=o,c=vz(o,["fields","encodings"]);for(const e in c)"encodings"===e&&s.fields||"fields"===e&&s.encodings||("mark"===e&&(s[e]=Object.assign(Object.assign({},c[e]),s[e])),void 0!==s[e]&&!0!==s[e]||(s[e]=null!==(n=c[e])&&void 0!==n?n:s[e]));const d=Yz(a),h=r[d]=Object.assign(Object.assign({},s),{name:d,events:gz(s.on)?VB(s.on,"scope"):Nz(s.on)});wX(h,(n=>{n.has(h)&&n.parse&&n.parse(e,h,s,t[a])}))}return r}(this,this.selection)}parseMarkGroup(){var e;this.component.mark=Bz([kL,bL,FL],(e=this).mark)?function(e){const t=vG(e.mark,e.encoding),n=hZ(e,{fromPrefix:t.length>0?cZ:""});return t.length>0?[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:cZ+e.requestDataName(nH),data:e.requestDataName(nH),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:n}]:n}(e):Bz([xL],e.mark)?function(e){const t=LU.some((t=>rG(t,e.markDef,e.config)));if(e.stack&&!e.fieldDef("size")&&t){const[t]=hZ(e,{fromPrefix:dZ}),n=e.scaleName(e.stack.fieldChannel),r=(t={})=>e.vgField(e.stack.fieldChannel,t),i=(e,t)=>`${e}(${[r({prefix:"min",suffix:"start",expr:t}),r({prefix:"max",suffix:"start",expr:t}),r({prefix:"min",suffix:"end",expr:t}),r({prefix:"max",suffix:"end",expr:t})].map((e=>`scale('${n}',${e})`)).join(",")})`;let a,s;"x"===e.stack.fieldChannel?(a=Object.assign(Object.assign({},$z(t.encode.update,["y","yc","y2","height",...LU])),{x:{signal:i("min","datum")},x2:{signal:i("max","datum")},clip:{value:!0}}),s={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update=Object.assign(Object.assign({},Tz(t.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(a=Object.assign(Object.assign({},$z(t.encode.update,["x","xc","x2","width"])),{y:{signal:i("min","datum")},y2:{signal:i("max","datum")},clip:{value:!0}}),s={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update=Object.assign(Object.assign({},Tz(t.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const n of LU){const r=iG(n,e.markDef,e.config);t.encode.update[n]?(a[n]=t.encode.update[n],delete t.encode.update[n]):r&&(a[n]=ZV(r)),r&&(t.encode.update[n]={value:0})}const o=e.fieldDef(e.stack.groupbyChannel),u=DV(o)?[DV(o)]:[];return((null==o?void 0:o.bin)||(null==o?void 0:o.timeUnit))&&u.push(DV(o,{binSuffix:"end"})),a=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce(((n,r)=>{if(t.encode.update[r])return Object.assign(Object.assign({},n),{[r]:t.encode.update[r]});{const t=iG(r,e.markDef,e.config);return void 0!==t?Object.assign(Object.assign({},n),{[r]:ZV(t)}):n}}),a),a.stroke&&(a.strokeForeground={value:!0},a.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(nH),name:dZ+e.requestDataName(nH),groupby:u,aggregate:{fields:[r({suffix:"start"}),r({suffix:"start"}),r({suffix:"end"}),r({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:a},marks:[{type:"group",encode:{update:s},marks:[t]}]}]}return hZ(e)}(e):hZ(e)}parseAxesAndHeaders(){var e;this.component.axes=(e=this,mj.reduce(((t,n)=>(e.component.scales[n]&&(t[n]=[iZ(n,e)]),t)),{}))}assembleSelectionTopLevelSignals(e){return function(e,t){let n=!1;if(RX(e,((r,i)=>{const a=r.name,s=mz(a+$X);if(0===t.filter((e=>e.name===a)).length){const e="global"===r.resolve?"union":r.resolve,n="multi"===r.type?", true)":")";t.push({name:r.name,update:`${OX}(${s}, ${mz(e)}${n}`})}n=!0,i.topLevelSignals&&(t=i.topLevelSignals(e,r,t)),wX(r,(n=>{n.topLevelSignals&&(t=n.topLevelSignals(e,r,t))}))})),n){0===t.filter((e=>"unit"===e.name)).length&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})}return SX(t)}(this,e)}assembleSignals(){return[...ZK(this),...(e=this,t=[],RX(e,((n,r)=>{const i=n.name;let a=r.modifyExpr(e,n);t.push(...r.signals(e,n)),wX(n,(r=>{r.signals&&(t=r.signals(e,n,t)),r.modifyExpr&&(a=r.modifyExpr(e,n,a))})),t.push({name:i+"_modify",on:[{events:{signal:n.name+TX},update:`modify(${mz(n.name+$X)}, ${a})`}]})})),SX(t))];var e,t}assembleSelectionData(e){return function(e,t){const n=[...t];return RX(e,(t=>{const r={name:t.name+$X};if(t.init){const n=t.project.items.map((e=>{const{signals:t}=e;return vz(e,["signals"])})),i=t.init.map((e=>kX(e,!1)));r.values="interval"===t.type?[{unit:BX(e,{escape:!1}),fields:n,values:i}]:i.map((t=>({unit:BX(e,{escape:!1}),fields:n,values:t})))}n.filter((e=>e.name===t.name+$X)).length||n.push(r)})),n}(this,e)}assembleLayout(){return null}assembleLayoutSignals(){return IY(this)}assembleMarks(){var e;let t=null!==(e=this.component.mark)&&void 0!==e?e:[];return this.parent&&wJ(this.parent)||(t=_X(this,t)),t.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(e){return dG(this.encoding,e)}fieldDef(e){return PV(this.encoding[e])}typedFieldDef(e){const t=this.fieldDef(e);return SV(t)?t:null}}class pZ extends kJ{constructor(e,t,n,r,i){super(e,"layer",t,n,i,e.resolve,e.view);const a=Object.assign(Object.assign(Object.assign({},r),e.width?{width:e.width}:{}),e.height?{height:e.height}:{});this.children=e.layer.map(((e,t)=>{if(pq(e))return new pZ(e,this,this.getName("layer_"+t),a,i);if(LL(e))return new fZ(e,this,this.getName("layer_"+t),a,i);throw new Error(Vj(e))}))}parseData(){this.component.data=XJ(this);for(const e of this.children)e.parseData()}parseLayoutSize(){UJ(this),WJ(this,"width"),WJ(this,"height")}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of qz(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){!function(e){var t;const{axes:n,resolve:r}=e.component,i={top:0,bottom:0,right:0,left:0};for(const t of e.children){t.parseAxesAndHeaders();for(const i of qz(t.component.axes))r.axis[i]=RY(e.component.resolve,i),"shared"===r.axis[i]&&(n[i]=eZ(n[i],t.component.axes[i]),n[i]||(r.axis[i]="independent",delete n[i]))}for(const a of mj){for(const s of e.children)if(s.component.axes[a]){if("independent"===r.axis[a]){n[a]=(null!==(t=n[a])&&void 0!==t?t:[]).concat(s.component.axes[a]);for(const e of s.component.axes[a]){const{value:t,explicit:n}=e.getWithExplicit("orient");if(!OU(t)){if(i[t]>0&&!n){const n=ZJ[t];i[t]>i[n]&&e.set("orient",n,!1)}i[t]++}}}delete s.component.axes[a]}if("independent"===r.axis[a]&&n[a]&&n[a].length>1)for(const e of n[a])e.get("grid")&&!e.explicit.grid&&(e.implicit.grid=!1)}}(this)}assembleSelectionTopLevelSignals(e){return this.children.reduce(((e,t)=>t.assembleSelectionTopLevelSignals(e)),e)}assembleSignals(){return this.children.reduce(((e,t)=>e.concat(t.assembleSignals())),ZK(this))}assembleLayoutSignals(){return this.children.reduce(((e,t)=>e.concat(t.assembleLayoutSignals())),IY(this))}assembleSelectionData(e){return this.children.reduce(((e,t)=>t.assembleSelectionData(e)),e)}assembleTitle(){let e=super.assembleTitle();if(e)return e;for(const t of this.children)if(e=t.assembleTitle(),e)return e}assembleLayout(){return null}assembleMarks(){return function(e,t){for(const n of e.children)vJ(n)&&(t=_X(n,t));return t}(this,this.children.flatMap((e=>e.assembleMarks())))}assembleLegends(){return this.children.reduce(((e,t)=>e.concat(t.assembleLegends())),ZY(this))}}function gZ(e,t,n,r,i){if(cV(e))return new qJ(e,t,n,i);if(pq(e))return new pZ(e,t,n,r,i);if(LL(e))return new fZ(e,t,n,r,i);if(function(e){return YG(e)||QG(e)||KG(e)}(e))return new KJ(e,t,n,i);throw new Error(Vj(e))}function mZ(e,t={}){var n;t.logger&&(n=t.logger,yU=n),t.fieldTitle&&MV(t.fieldTitle);try{const n=lq(oz(t.config,e.config)),r=Bq(e,n),i=gZ(r,null,"",void 0,n);i.parse(),function(e,t){lQ(e.sources);let n=0,r=0;for(let r=0;r<5&&UQ(e,t);r++)n++;e.sources.map(DQ);for(let n=0;n<5&&UQ(e,t);n++)r++;lQ(e.sources),5===Math.max(n,r)&&vU("Maximum optimization runs(5) reached.")}(i.component.data,i);const a=function(e,t,n={},r){const i=e.config?function(e){e=Nz(e);for(const t of dq)delete e[t];if(e.axis)for(const t in e.axis)dL(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of jG)delete e.legend[t];if(e.mark){for(const t of BL)delete e.mark[t];e.mark.tooltip&&az(e.mark.tooltip)&&delete e.mark.tooltip}for(const t of cq){for(const n of BL)delete e[t][n];const n=hq[t];if(n)for(const r of n)delete e[t][r];fq(e,t)}for(const t of qz(LG))delete e[t];!function(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:r}=QV(e.title);Gz(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t)),Gz(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n)),Gz(r)?delete e.title:e.title=r}(e);for(const t in e)az(e[t])&&Gz(e[t])&&delete e[t];return Gz(e)?void 0:e}(e.config):void 0,a=[].concat(e.assembleSelectionData([]),function(e,t){var n,r;const i=[],a=BJ(i);let s=0;for(const t of e.sources){t.hasName()||(t.dataName="source_"+s++);const e=t.assemble();a(t,e)}for(const e of i)0===e.transform.length&&delete e.transform;let o=0;for(const[e,t]of i.entries())0!==(null!==(n=t.transform)&&void 0!==n?n:[]).length||t.source||i.splice(o++,0,i.splice(e,1)[0]);for(const t of i)for(const n of null!==(r=t.transform)&&void 0!==r?r:[])"lookup"===n.type&&(n.from=e.outputNodes[n.from].getSource());for(const e of i)e.name in t&&(e.values=t[e.name]);return i}(e.component.data,n)),s=e.assembleProjections(),o=e.assembleTitle(),u=e.assembleGroupStyle(),l=e.assembleGroupEncodeEntry(!0);let c=e.assembleLayoutSignals();return c=c.filter((e=>"width"!==e.name&&"height"!==e.name||void 0===e.value||(t[e.name]=+e.value,!1))),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),t),o?{title:o}:{}),u?{style:u}:{}),l?{encode:{update:l}}:{}),{data:a}),s.length>0?{projections:s}:{}),e.assembleGroup([...c,...e.assembleSelectionTopLevelSignals([])])),i?{config:i}:{}),r?{usermeta:r}:{})}(i,function(e,t,n,r){const i=r.component.layoutSize.get("width"),a=r.component.layoutSize.get("height");if(void 0===t?(t={type:"pad"},r.hasAxisOrientSignalRef()&&(t.resize=!0)):gz(t)&&(t={type:t}),i&&a&&("fit"===(s=t.type)||"fit-x"===s||"fit-y"===s))if("step"===i&&"step"===a)vU(Hj()),t.type="pad";else if("step"===i||"step"===a){const e="step"===i?"width":"height";vU(Hj(xj(e)));const n="width"===e?"height":"width";t.type=function(e){return e?`fit-${xj(e)}`:"fit"}(n)}var s;return Object.assign(Object.assign(Object.assign({},1===qz(t).length&&t.type?"pad"===t.type?{}:{autosize:t.type}:{autosize:t}),jq(n)),jq(e))}(e,r.autosize,n,i),e.datasets,e.usermeta);return{spec:a,normalized:r}}finally{t.logger&&(yU=gU),t.fieldTitle&&MV(TV)}}const yZ=new class extends gq{mapUnit(e,{config:t}){if(e.encoding){const{encoding:n,transform:r}=e,{bins:i,timeUnits:a,aggregate:s,groupby:o,encoding:u}=fG(n,t),l=[...r||[],...i,...a,...0===s.length?[]:[{aggregate:s,groupby:o}]];return Object.assign(Object.assign(Object.assign({},e),l.length>0?{transform:l}:{}),{encoding:u})}return e}};function vZ(e,t){return yZ.map(e,{config:t})}const bZ="4.13.1",xZ=function(e){const[t,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}},wZ="#fff",kZ={background:"#333",title:{color:wZ,subtitleColor:wZ},style:{"guide-label":{fill:wZ},"guide-title":{fill:wZ}},axis:{domainColor:wZ,gridColor:"#888",tickColor:wZ}},_Z="#4572a7",SZ={background:"#fff",arc:{fill:_Z},area:{fill:_Z},line:{stroke:_Z,strokeWidth:2},path:{stroke:_Z},rect:{fill:_Z},shape:{stroke:_Z},symbol:{fill:_Z,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},CZ="#30a2da",AZ="#cbcbcb",EZ="#f0f0f0",FZ="#333",IZ={arc:{fill:CZ},area:{fill:CZ},axis:{domainColor:AZ,grid:!0,gridColor:AZ,gridWidth:1,labelColor:"#999",labelFontSize:10,titleColor:"#333",tickColor:AZ,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:EZ,group:{fill:EZ},legend:{labelColor:FZ,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:FZ,titleFontSize:14,titlePadding:10},line:{stroke:CZ,strokeWidth:2},path:{stroke:CZ,strokeWidth:.5},rect:{fill:CZ},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:CZ},bar:{binSpacing:2,fill:CZ,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},DZ="#000",NZ={group:{fill:"#e5e5e5"},arc:{fill:DZ},area:{fill:DZ},line:{stroke:DZ},path:{stroke:DZ},rect:{fill:DZ},shape:{stroke:DZ},symbol:{fill:DZ,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},$Z="Benton Gothic, sans-serif",TZ="#82c6df",OZ="Benton Gothic Bold, sans-serif",MZ="normal",RZ={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},BZ={background:"#ffffff",title:{anchor:"start",color:"#000000",font:OZ,fontSize:22,fontWeight:"normal"},arc:{fill:TZ},area:{fill:TZ},line:{stroke:TZ,strokeWidth:2},path:{stroke:TZ},rect:{fill:TZ},shape:{stroke:TZ},symbol:{fill:TZ,size:30},axis:{labelFont:$Z,labelFontSize:11.5,labelFontWeight:"normal",titleFont:OZ,titleFontSize:13,titleFontWeight:MZ},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:$Z,labelFontSize:11.5,symbolType:"square",titleFont:OZ,titleFontSize:13,titleFontWeight:MZ},range:{category:RZ["category-6"],diverging:RZ["fireandice-6"],heatmap:RZ["fire-7"],ordinal:RZ["fire-7"],ramp:RZ["fire-7"]}},zZ="#ab5787",LZ="#979797",PZ={background:"#f9f9f9",arc:{fill:zZ},area:{fill:zZ},line:{stroke:zZ},path:{stroke:zZ},rect:{fill:zZ},shape:{stroke:zZ},symbol:{fill:zZ,size:30},axis:{domainColor:LZ,domainWidth:.5,gridWidth:.2,labelColor:LZ,tickColor:LZ,tickWidth:.2,titleColor:LZ},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},jZ="#3e5c69",UZ={background:"#fff",arc:{fill:jZ},area:{fill:jZ},line:{stroke:jZ},path:{stroke:jZ},rect:{fill:jZ},shape:{stroke:jZ},symbol:{fill:jZ},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},WZ="#1696d2",VZ="#000000",GZ="Lato",qZ="Lato",HZ={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},XZ={background:"#FFFFFF",title:{anchor:"start",fontSize:18,font:GZ},axisX:{domain:!0,domainColor:VZ,domainWidth:1,grid:!1,labelFontSize:12,labelFont:qZ,labelAngle:0,tickColor:VZ,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:GZ},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:"#DEDDDD",gridWidth:1,labelFontSize:12,labelFont:qZ,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:GZ,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:qZ,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:GZ,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:HZ["six-groups-cat-1"],diverging:HZ["diverging-colors"],heatmap:HZ["diverging-colors"],ordinal:HZ["six-groups-seq"],ramp:HZ["shades-blue"]},area:{fill:WZ},rect:{fill:WZ},line:{color:WZ,stroke:WZ,strokeWidth:5},trail:{color:WZ,stroke:WZ,strokeWidth:0,size:1},path:{stroke:WZ,strokeWidth:.5},point:{filled:!0},text:{font:"Lato",color:WZ,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:WZ,stroke:null}},arc:{fill:WZ},shape:{stroke:WZ},symbol:{fill:WZ,size:30}},KZ="#3366CC",YZ="#ccc",QZ="Arial, sans-serif",JZ={arc:{fill:KZ},area:{fill:KZ},path:{stroke:KZ},rect:{fill:KZ},shape:{stroke:KZ},symbol:{stroke:KZ},circle:{fill:KZ},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:QZ,fontSize:12},"guide-title":{font:QZ,fontSize:12},"group-title":{font:QZ,fontSize:12}},title:{font:QZ,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:YZ,tickColor:YZ,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},ZZ="2.10.0";const e0="vg-tooltip-element",t0={offsetX:10,offsetY:10,id:e0,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")},maxDepth:2};function n0(e,t){return JSON.stringify(e,function(e){const t=[];return function(n,r){if("object"!=typeof r||null===r)return r;const i=t.indexOf(this)+1;return t.length=i,t.length>e?"[Object]":t.indexOf(r)>=0?"[Circular]":(t.push(r),r)}}(t))}class r0{constructor(e){this.options=Object.assign(Object.assign({},t0),e);const t=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const e=document.createElement("style");e.setAttribute("id",this.options.styleId),e.innerHTML=function(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return"#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black; }\n  #vg-tooltip-element.visible {\n    visibility: visible; }\n  #vg-tooltip-element h2 {\n    margin-top: 0;\n    margin-bottom: 10px;\n    font-size: 13px; }\n  #vg-tooltip-element img {\n    max-width: 200px;\n    max-height: 200px; }\n  #vg-tooltip-element table {\n    border-spacing: 0; }\n    #vg-tooltip-element table tr {\n      border: none; }\n      #vg-tooltip-element table tr td {\n        overflow: hidden;\n        text-overflow: ellipsis;\n        padding-top: 2px;\n        padding-bottom: 2px; }\n        #vg-tooltip-element table tr td.key {\n          color: #808080;\n          max-width: 150px;\n          text-align: right;\n          padding-right: 4px; }\n        #vg-tooltip-element table tr td.value {\n          display: block;\n          max-width: 300px;\n          max-height: 7em;\n          text-align: left; }\n  #vg-tooltip-element.dark-theme {\n    background-color: rgba(32, 32, 32, 0.9);\n    border: 1px solid #f5f5f5;\n    color: white; }\n    #vg-tooltip-element.dark-theme td.key {\n      color: #bfbfbf; }\n".toString().replace(e0,e)}(t);const n=document.head;n.childNodes.length>0?n.insertBefore(e,n.childNodes[0]):n.appendChild(e)}}tooltipHandler(e,t,n,r){if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el)),(null!=document.fullscreenElement?document.fullscreenElement:document.body).appendChild(this.el),null==r||""===r)return void this.el.classList.remove("visible",`${this.options.theme}-theme`);this.el.innerHTML=function(e,t,n){if(ke(e))return`[${e.map((e=>t(vt(e)?e:n0(e,n)))).join(", ")}]`;if(_e(e)){let r="";const i=e,{title:a,image:s}=i,o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(i,["title","image"]);a&&(r+=`<h2>${t(a)}</h2>`),s&&(r+=`<img src="${t(s)}">`);const u=Object.keys(o);if(u.length>0){r+="<table>";for(const e of u){let i=o[e];void 0!==i&&(_e(i)&&(i=n0(i,n)),r+=`<tr><td class="key">${t(e)}:</td><td class="value">${t(i)}</td></tr>`)}r+="</table>"}return r||"{}"}return t(e)}(r,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:i,y:a}=function(e,t,n,r){let i=e.clientX+n;i+t.width>window.innerWidth&&(i=+e.clientX-n-t.width);let a=e.clientY+r;return a+t.height>window.innerHeight&&(a=+e.clientY-r-t.height),{x:i,y:a}}(t,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${a}px; left: ${i}px`)}}function i0(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}u((r=r.apply(e,t||[])).next())}))}var a0;function s0(e,...t){for(const n of t)o0(e,n);return e}function o0(e,t){for(const n of Object.keys(t))Ae(e,n,t[n],!0)}String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});const u0=y;let l0=v;const c0="undefined"!=typeof window?window:void 0;void 0===l0&&(null===(a0=null==c0?void 0:c0.vl)||void 0===a0?void 0:a0.compile)&&(l0=c0.vl);const d0={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},h0={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},f0={vega:"Vega","vega-lite":"Vega-Lite"},p0={vega:u0.version,"vega-lite":l0?l0.version:"not available"},g0={vega:e=>e,"vega-lite":(e,t)=>l0.compile(e,{config:t}).spec};function m0(e,t,n,r){const i=`<html><head>${t}</head><body><pre><code class="json">`,a=`</code></pre>${n}</body></html>`,s=window.open("");s.document.write(i+e+a),s.document.title=`${f0[r]} JSON Source`}function y0(e,t){var n;if(e.$schema){const r=xZ(e.$schema);t&&t!==r.library&&console.warn(`The given visualization spec is written in ${f0[r.library]}, but mode argument sets ${null!==(n=f0[t])&&void 0!==n?n:t}.`);const i=r.library;return(0,Z.satisfies)(p0[i],`^${r.version.slice(1)}`)||console.warn(`The input spec uses ${f0[i]} ${r.version}, but the current version of ${f0[i]} is v${p0[i]}.`),i}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":null!=t?t:"vega"}function v0(e){return(t=e)&&"load"in t?e:u0.loader(e);var t}function b0(e){var t;return null!==(t=e.usermeta&&e.usermeta.embedOptions)&&void 0!==t?t:{}}function x0(e,t){var n;return i0(this,void 0,void 0,(function*(){const r=vt(e.config)?JSON.parse(yield t.load(e.config)):null!==(n=e.config)&&void 0!==n?n:{},i=vt(e.patch)?JSON.parse(yield t.load(e.patch)):e.patch;return Object.assign(Object.assign(Object.assign({},e),i?{patch:i}:{}),r?{config:r}:{})}))}const w0=function(e,t,n={}){var r,i,a;return i0(this,void 0,void 0,(function*(){let s,o;vt(t)?(o=v0(n.loader),s=JSON.parse(yield o.load(t))):s=t;const u=b0(s).loader;o&&!u||(o=v0(null!==(r=n.loader)&&void 0!==r?r:u));const l=yield x0(b0(s),o),c=yield x0(n,o),d=Object.assign(Object.assign({},s0(c,l)),{config:Ce(null!==(i=c.config)&&void 0!==i?i:{},null!==(a=l.config)&&void 0!==a?a:{})});return yield function(e,t,n={},r){var i,a,s,o,u,l;return i0(this,void 0,void 0,(function*(){const c=n.theme?Ce(b[n.theme],null!==(i=n.config)&&void 0!==i?i:{}):n.config,d=ft(n.actions)?n.actions:s0({},d0,null!==(a=n.actions)&&void 0!==a?a:{}),h=Object.assign(Object.assign({},h0),n.i18n),f=null!==(s=n.renderer)&&void 0!==s?s:"canvas",p=null!==(o=n.logLevel)&&void 0!==o?o:u0.Warn,g=null!==(u=n.downloadFileName)&&void 0!==u?u:"visualization",m="string"==typeof e?document.querySelector(e):e;if(!m)throw new Error(`${e} does not exist`);if(!1!==n.defaultStyle){const e="vega-embed-style",{root:t,rootContainer:r}=function(e){var t;const n=e.getRootNode?e.getRootNode():document;return n instanceof ShadowRoot?{root:n,rootContainer:n}:{root:document,rootContainer:null!==(t=document.head)&&void 0!==t?t:document.body}}(m);if(!t.getElementById(e)){const t=document.createElement("style");t.id=e,t.innerText=void 0===n.defaultStyle||!0===n.defaultStyle?'.vega-embed {\n  position: relative;\n  display: inline-block;\n  box-sizing: border-box; }\n  .vega-embed.has-actions {\n    padding-right: 38px; }\n  .vega-embed details:not([open]) > :not(summary) {\n    display: none !important; }\n  .vega-embed summary {\n    list-style: none;\n    position: absolute;\n    top: 0;\n    right: 0;\n    padding: 6px;\n    z-index: 1000;\n    background: white;\n    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n    color: #1b1e23;\n    border: 1px solid #aaa;\n    border-radius: 999px;\n    opacity: 0.2;\n    transition: opacity 0.4s ease-in;\n    outline: none;\n    cursor: pointer;\n    line-height: 0px; }\n    .vega-embed summary::-webkit-details-marker {\n      display: none; }\n    .vega-embed summary:active {\n      box-shadow: #aaa 0px 0px 0px 1px inset; }\n    .vega-embed summary svg {\n      width: 14px;\n      height: 14px; }\n  .vega-embed details[open] summary {\n    opacity: 0.7; }\n  .vega-embed:hover summary,\n  .vega-embed:focus summary {\n    opacity: 1 !important;\n    transition: opacity 0.2s ease; }\n  .vega-embed .vega-actions {\n    position: absolute;\n    z-index: 1001;\n    top: 35px;\n    right: -9px;\n    display: flex;\n    flex-direction: column;\n    padding-bottom: 8px;\n    padding-top: 8px;\n    border-radius: 4px;\n    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n    border: 1px solid #d9d9d9;\n    background: white;\n    animation-duration: 0.15s;\n    animation-name: scale-in;\n    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);\n    text-align: left; }\n    .vega-embed .vega-actions a {\n      padding: 8px 16px;\n      font-family: sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n      white-space: nowrap;\n      color: #434a56;\n      text-decoration: none; }\n      .vega-embed .vega-actions a:hover {\n        background-color: #f7f7f9;\n        color: black; }\n    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {\n      content: "";\n      display: inline-block;\n      position: absolute; }\n    .vega-embed .vega-actions::before {\n      left: auto;\n      right: 14px;\n      top: -16px;\n      border: 8px solid #0000;\n      border-bottom-color: #d9d9d9; }\n    .vega-embed .vega-actions::after {\n      left: auto;\n      right: 15px;\n      top: -14px;\n      border: 7px solid #0000;\n      border-bottom-color: #fff; }\n  .vega-embed .chart-wrapper {\n    width: 100%;\n    height: 100%; }\n\n.vega-embed-wrapper {\n  max-width: 100%;\n  overflow: auto;\n  padding-right: 14px; }\n\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.6); }\n  to {\n    opacity: 1;\n    transform: scale(1); } }\n'.toString():n.defaultStyle,r.appendChild(t)}}const y=y0(t,n.mode);let v=g0[y](t,c);if("vega-lite"===y&&v.$schema){const e=xZ(v.$schema);(0,Z.satisfies)(p0.vega,`^${e.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${e.version}, but current version is v${p0.vega}.`)}m.classList.add("vega-embed"),d&&m.classList.add("has-actions"),m.innerHTML="";let x=m;if(d){const e=document.createElement("div");e.classList.add("chart-wrapper"),m.appendChild(e),x=e}const w=n.patch;w&&(v=w instanceof Function?w(v):z(v,w,!0,!1).newDocument),n.formatLocale&&u0.formatLocale(n.formatLocale),n.timeFormatLocale&&u0.timeFormatLocale(n.timeFormatLocale);const{ast:k}=n,_=u0.parse(v,"vega-lite"===y?{}:c,{ast:k}),S=new(n.viewClass||u0.View)(_,Object.assign({loader:r,logLevel:p,renderer:f},k?{expr:u0.expressionInterpreter}:{}));if(!1!==n.tooltip){let e;e="function"==typeof n.tooltip?n.tooltip:new r0(!0===n.tooltip?{}:n.tooltip).call,S.tooltip(e)}let C,{hover:A}=n;if(void 0===A&&(A="vega"===y),A){const{hoverSet:e,updateSet:t}="boolean"==typeof A?{}:A;S.hover(e,t)}if(n&&(null!=n.width&&S.width(n.width),null!=n.height&&S.height(n.height),null!=n.padding&&S.padding(n.padding)),yield S.initialize(x,n.bind).runAsync(),!1!==d){let e=m;if(!1!==n.defaultStyle){const t=document.createElement("details");t.title=h.CLICK_TO_VIEW_ACTIONS,m.append(t),e=t;const n=document.createElement("summary");n.innerHTML='\n<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">\n  <circle r="2" cy="8" cx="2"></circle>\n  <circle r="2" cy="8" cx="8"></circle>\n  <circle r="2" cy="8" cx="14"></circle>\n</svg>',t.append(n),C=e=>{t.contains(e.target)||t.removeAttribute("open")},document.addEventListener("click",C)}const r=document.createElement("div");if(e.append(r),r.classList.add("vega-actions"),!0===d||!1!==d.export)for(const e of["svg","png"])if(!0===d||!0===d.export||d.export[e]){const t=h[`${e.toUpperCase()}_ACTION`],i=document.createElement("a");i.text=t,i.href="#",i.target="_blank",i.download=`${g}.${e}`,i.addEventListener("mousedown",(function(t){return i0(this,void 0,void 0,(function*(){t.preventDefault();const r=yield S.toImageURL(e,n.scaleFactor);this.href=r}))})),r.append(i)}if(!0===d||!1!==d.source){const e=document.createElement("a");e.text=h.SOURCE_ACTION,e.href="#",e.addEventListener("click",(function(e){var r,i;m0(J()(t),null!==(r=n.sourceHeader)&&void 0!==r?r:"",null!==(i=n.sourceFooter)&&void 0!==i?i:"",y),e.preventDefault()})),r.append(e)}if("vega-lite"===y&&(!0===d||!1!==d.compiled)){const e=document.createElement("a");e.text=h.COMPILED_ACTION,e.href="#",e.addEventListener("click",(function(e){var t,r;m0(J()(v),null!==(t=n.sourceHeader)&&void 0!==t?t:"",null!==(r=n.sourceFooter)&&void 0!==r?r:"","vega"),e.preventDefault()})),r.append(e)}if(!0===d||!1!==d.editor){const e=null!==(l=n.editorUrl)&&void 0!==l?l:"https://vega.github.io/editor/",i=document.createElement("a");i.text=h.EDITOR_ACTION,i.href="#",i.addEventListener("click",(function(n){!function(e,t,n){const r=e.open(t),{origin:i}=new URL(t);let a=40;e.addEventListener("message",(function t(n){n.source===r&&(a=0,e.removeEventListener("message",t,!1))}),!1),setTimeout((function e(){a<=0||(r.postMessage(n,i),setTimeout(e,250),a-=1)}),250)}(window,e,{config:c,mode:y,renderer:f,spec:J()(t)}),n.preventDefault()})),r.append(i)}}return{view:S,spec:t,vgSpec:v,finalize:function(){C&&document.removeEventListener("click",C),S.finalize()}}}))}(e,s,d,o)}))}},32859:e=>{const t="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,n="undefined"!=typeof AbortController?AbortController:Object.assign(class{constructor(){this.signal=new n.AbortSignal}abort(){this.signal.aborted=!0}},{AbortSignal:class{constructor(){this.aborted=!1}}}),r=new Set,i=(e,t)=>{const n=`LRU_CACHE_OPTION_${e}`;s(n)&&o(n,`${e} option`,`options.${t}`,h)},a=(e,t)=>{const n=`LRU_CACHE_METHOD_${e}`;if(s(n)){const{prototype:r}=h,{get:i}=Object.getOwnPropertyDescriptor(r,e);o(n,`${e} method`,`cache.${t}()`,i)}},s=e=>"object"==typeof process&&process&&!r.has(e),o=(e,t,n,i)=>{r.add(e);const a=`The ${t} is deprecated. Please use ${n} instead.`;process.emitWarning(a,"DeprecationWarning",e,i)},u=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),l=e=>u(e)?e<=Math.pow(2,8)?Uint8Array:e<=Math.pow(2,16)?Uint16Array:e<=Math.pow(2,32)?Uint32Array:e<=Number.MAX_SAFE_INTEGER?c:null:null;class c extends Array{constructor(e){super(e),this.fill(0)}}class d{constructor(e){const t=e?l(e):Array;this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}}class h{constructor(e={}){const{max:t=0,ttl:n,ttlResolution:a=1,ttlAutopurge:o,updateAgeOnGet:c,allowStale:f,dispose:p,disposeAfter:g,noDisposeOnSet:m,noUpdateTTL:y,maxSize:v=0,sizeCalculation:b,fetchMethod:x}=e,{length:w,maxAge:k,stale:_}=e instanceof h?{}:e;if(0!==t&&!u(t))throw new TypeError("max option must be a nonnegative integer");const S=t?l(t):Array;if(!S)throw new Error("invalid max value: "+t);if(this.max=t,this.maxSize=v,this.sizeCalculation=b||w,this.sizeCalculation){if(!this.maxSize)throw new TypeError("cannot set sizeCalculation without setting maxSize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(this.fetchMethod=x||null,this.fetchMethod&&"function"!=typeof this.fetchMethod)throw new TypeError("fetchMethod must be a function if specified");if(this.keyMap=new Map,this.keyList=new Array(t).fill(null),this.valList=new Array(t).fill(null),this.next=new S(t),this.prev=new S(t),this.head=0,this.tail=0,this.free=new d(t),this.initialFill=1,this.size=0,"function"==typeof p&&(this.dispose=p),"function"==typeof g?(this.disposeAfter=g,this.disposed=[]):(this.disposeAfter=null,this.disposed=null),this.noDisposeOnSet=!!m,this.noUpdateTTL=!!y,0!==this.maxSize){if(!u(this.maxSize))throw new TypeError("maxSize must be a positive integer if specified");this.initializeSizeTracking()}if(this.allowStale=!!f||!!_,this.updateAgeOnGet=!!c,this.ttlResolution=u(a)||0===a?a:1,this.ttlAutopurge=!!o,this.ttl=n||k||0,this.ttl){if(!u(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.initializeTTLTracking()}if(0===this.max&&0===this.ttl&&0===this.maxSize)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.max&&!this.maxSize){const e="LRU_CACHE_UNBOUNDED";if(s(e)){r.add(e);const t="TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.";process.emitWarning(t,"UnboundedCacheWarning",e,h)}}_&&i("stale","allowStale"),k&&i("maxAge","ttl"),w&&i("length","sizeCalculation")}getRemainingTTL(e){return this.has(e)?1/0:0}initializeTTLTracking(){this.ttls=new c(this.max),this.starts=new c(this.max),this.setItemTTL=(e,n)=>{if(this.starts[e]=0!==n?t.now():0,this.ttls[e]=n,0!==n&&this.ttlAutopurge){const t=setTimeout((()=>{this.isStale(e)&&this.delete(this.keyList[e])}),n+1);t.unref&&t.unref()}},this.updateItemAge=e=>{this.starts[e]=0!==this.ttls[e]?t.now():0};let e=0;const n=()=>{const n=t.now();if(this.ttlResolution>0){e=n;const t=setTimeout((()=>e=0),this.ttlResolution);t.unref&&t.unref()}return n};this.getRemainingTTL=t=>{const r=this.keyMap.get(t);return void 0===r?0:0===this.ttls[r]||0===this.starts[r]?1/0:this.starts[r]+this.ttls[r]-(e||n())},this.isStale=t=>0!==this.ttls[t]&&0!==this.starts[t]&&(e||n())-this.starts[t]>this.ttls[t]}updateItemAge(e){}setItemTTL(e,t){}isStale(e){return!1}initializeSizeTracking(){this.calculatedSize=0,this.sizes=new c(this.max),this.removeItemSize=e=>this.calculatedSize-=this.sizes[e],this.requireSize=(e,t,n,r)=>{if(!u(n)){if(!r)throw new TypeError("invalid size value (must be positive integer)");if("function"!=typeof r)throw new TypeError("sizeCalculation must be a function");if(n=r(t,e),!u(n))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return n},this.addItemSize=(e,t,n,r)=>{this.sizes[e]=r;const i=this.maxSize-this.sizes[e];for(;this.calculatedSize>i;)this.evict();this.calculatedSize+=this.sizes[e]},this.delete=e=>{if(0!==this.size){const t=this.keyMap.get(e);void 0!==t&&(this.calculatedSize-=this.sizes[t])}return h.prototype.delete.call(this,e)}}removeItemSize(e){}addItemSize(e,t,n,r){}requireSize(e,t,n,r){if(n||r)throw new TypeError("cannot set size without setting maxSize on cache")}*indexes({allowStale:e=this.allowStale}={}){if(this.size)for(let t=this.tail;this.isValidIndex(t)&&(!e&&this.isStale(t)||(yield t),t!==this.head);)t=this.prev[t]}*rindexes({allowStale:e=this.allowStale}={}){if(this.size)for(let t=this.head;this.isValidIndex(t)&&(!e&&this.isStale(t)||(yield t),t!==this.tail);)t=this.next[t]}isValidIndex(e){return this.keyMap.get(this.keyList[e])===e}*entries(){for(const e of this.indexes())yield[this.keyList[e],this.valList[e]]}*rentries(){for(const e of this.rindexes())yield[this.keyList[e],this.valList[e]]}*keys(){for(const e of this.indexes())yield this.keyList[e]}*rkeys(){for(const e of this.rindexes())yield this.keyList[e]}*values(){for(const e of this.indexes())yield this.valList[e]}*rvalues(){for(const e of this.rindexes())yield this.valList[e]}[Symbol.iterator](){return this.entries()}find(e,t={}){for(const n of this.indexes())if(e(this.valList[n],this.keyList[n],this))return this.get(this.keyList[n],t)}forEach(e,t=this){for(const n of this.indexes())e.call(t,this.valList[n],this.keyList[n],this)}rforEach(e,t=this){for(const n of this.rindexes())e.call(t,this.valList[n],this.keyList[n],this)}get prune(){return a("prune","purgeStale"),this.purgeStale}purgeStale(){let e=!1;for(const t of this.rindexes({allowStale:!0}))this.isStale(t)&&(this.delete(this.keyList[t]),e=!0);return e}dump(){const e=[];for(const t of this.indexes()){const n=this.keyList[t],r={value:this.valList[t]};this.ttls&&(r.ttl=this.ttls[t]),this.sizes&&(r.size=this.sizes[t]),e.unshift([n,r])}return e}load(e){this.clear();for(const[t,n]of e)this.set(t,n.value,n)}dispose(e,t,n){}set(e,t,{ttl:n=this.ttl,noDisposeOnSet:r=this.noDisposeOnSet,size:i=0,sizeCalculation:a=this.sizeCalculation,noUpdateTTL:s=this.noUpdateTTL}={}){i=this.requireSize(e,t,i,a);let o=0===this.size?void 0:this.keyMap.get(e);if(void 0===o)o=this.newIndex(),this.keyList[o]=e,this.valList[o]=t,this.keyMap.set(e,o),this.next[this.tail]=o,this.prev[o]=this.tail,this.tail=o,this.size++,this.addItemSize(o,t,e,i),s=!1;else{const n=this.valList[o];t!==n&&(this.isBackgroundFetch(n)?n.__abortController.abort():r||(this.dispose(n,e,"set"),this.disposeAfter&&this.disposed.push([n,e,"set"])),this.removeItemSize(o),this.valList[o]=t,this.addItemSize(o,t,e,i)),this.moveToTail(o)}if(0===n||0!==this.ttl||this.ttls||this.initializeTTLTracking(),s||this.setItemTTL(o,n),this.disposeAfter)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return this}newIndex(){return 0===this.size?this.tail:this.size===this.max?this.evict():0!==this.free.length?this.free.pop():this.initialFill++}pop(){if(this.size){const e=this.valList[this.head];return this.evict(),e}}evict(){const e=this.head,t=this.keyList[e],n=this.valList[e];return this.isBackgroundFetch(n)?n.__abortController.abort():(this.dispose(n,t,"evict"),this.disposeAfter&&this.disposed.push([n,t,"evict"])),this.removeItemSize(e),this.head=this.next[e],this.keyMap.delete(t),this.size--,e}has(e){return this.keyMap.has(e)&&!this.isStale(this.keyMap.get(e))}peek(e,{allowStale:t=this.allowStale}={}){const n=this.keyMap.get(e);if(void 0!==n&&(t||!this.isStale(n)))return this.valList[n]}backgroundFetch(e,t,r){const i=void 0===t?void 0:this.valList[t];if(this.isBackgroundFetch(i))return i;const a=new n,s={signal:a.signal,options:r},o=Promise.resolve(this.fetchMethod(e,i,s)).then((t=>(a.signal.aborted||this.set(e,t,s.options),t)));return o.__abortController=a,o.__staleWhileFetching=i,void 0===t?(this.set(e,o,s.options),t=this.keyMap.get(e)):this.valList[t]=o,o}isBackgroundFetch(e){return e&&"object"==typeof e&&"function"==typeof e.then&&Object.prototype.hasOwnProperty.call(e,"__staleWhileFetching")}async fetch(e,{allowStale:t=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,ttl:r=this.ttl,noDisposeOnSet:i=this.noDisposeOnSet,size:a=0,sizeCalculation:s=this.sizeCalculation,noUpdateTTL:o=this.noUpdateTTL}={}){if(!this.fetchMethod)return this.get(e,{allowStale:t,updateAgeOnGet:n});const u={allowStale:t,updateAgeOnGet:n,ttl:r,noDisposeOnSet:i,size:a,sizeCalculation:s,noUpdateTTL:o};let l=this.keyMap.get(e);if(void 0===l)return this.backgroundFetch(e,l,u);{const r=this.valList[l];if(this.isBackgroundFetch(r))return t&&void 0!==r.__staleWhileFetching?r.__staleWhileFetching:r;if(!this.isStale(l))return this.moveToTail(l),n&&this.updateItemAge(l),r;const i=this.backgroundFetch(e,l,u);return t&&void 0!==i.__staleWhileFetching?i.__staleWhileFetching:i}}get(e,{allowStale:t=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet}={}){const r=this.keyMap.get(e);if(void 0!==r){const i=this.valList[r],a=this.isBackgroundFetch(i);if(this.isStale(r))return a?t?i.__staleWhileFetching:void 0:(this.delete(e),t?i:void 0);if(a)return;return this.moveToTail(r),n&&this.updateItemAge(r),i}}connect(e,t){this.prev[t]=e,this.next[e]=t}moveToTail(e){e!==this.tail&&(e===this.head?this.head=this.next[e]:this.connect(this.prev[e],this.next[e]),this.connect(this.tail,e),this.tail=e)}get del(){return a("del","delete"),this.delete}delete(e){let t=!1;if(0!==this.size){const n=this.keyMap.get(e);if(void 0!==n)if(t=!0,1===this.size)this.clear();else{this.removeItemSize(n);const t=this.valList[n];this.isBackgroundFetch(t)?t.__abortController.abort():(this.dispose(t,e,"delete"),this.disposeAfter&&this.disposed.push([t,e,"delete"])),this.keyMap.delete(e),this.keyList[n]=null,this.valList[n]=null,n===this.tail?this.tail=this.prev[n]:n===this.head?this.head=this.next[n]:(this.next[this.prev[n]]=this.next[n],this.prev[this.next[n]]=this.prev[n]),this.size--,this.free.push(n)}}if(this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return t}clear(){for(const e of this.rindexes({allowStale:!0})){const t=this.valList[e];if(this.isBackgroundFetch(t))t.__abortController.abort();else{const n=this.keyList[e];this.dispose(t,n,"delete"),this.disposeAfter&&this.disposed.push([t,n,"delete"])}}if(this.keyMap.clear(),this.valList.fill(null),this.keyList.fill(null),this.ttls&&(this.ttls.fill(0),this.starts.fill(0)),this.sizes&&this.sizes.fill(0),this.head=0,this.tail=0,this.initialFill=1,this.free.length=0,this.calculatedSize=0,this.size=0,this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift())}get reset(){return a("reset","clear"),this.clear}get length(){return((e,t)=>{const n="LRU_CACHE_PROPERTY_length";if(s(n)){const{prototype:t}=h,{get:r}=Object.getOwnPropertyDescriptor(t,e);o(n,"length property","cache.size",r)}})("length"),this.size}}e.exports=h},74890:(e,t,n)=>{const r=Symbol("SemVer ANY");class i{static get ANY(){return r}constructor(e,t){if(t=a(t),e instanceof i){if(e.loose===!!t.loose)return e;e=e.value}l("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===r?this.value="":this.value=this.operator+this.semver.version,l("comp",this)}parse(e){const t=this.options.loose?s[o.COMPARATORLOOSE]:s[o.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new c(n[2],this.options.loose):this.semver=r}toString(){return this.value}test(e){if(l("Comparator.test",e,this.options.loose),this.semver===r||e===r)return!0;if("string"==typeof e)try{e=new c(e,this.options)}catch(e){return!1}return u(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof i))throw new TypeError("a Comparator is required");if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return""===this.value||new d(e.value,t).test(this.value);if(""===e.operator)return""===e.value||new d(this.value,t).test(e.semver);const n=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),r=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),a=this.semver.version===e.semver.version,s=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),o=u(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),l=u(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return n||r||a&&s||o||l}}e.exports=i;const a=n(14167),{re:s,t:o}=n(46152),u=n(11427),l=n(34272),c=n(57800),d=n(21540)},21540:(e,t,n)=>{class r{constructor(e,t){if(t=a(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof s)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split("||").map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!p(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&g(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map((e=>e.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(e){e=e.trim();const t=`parseRange:${Object.keys(this.options).join(",")}:${e}`,n=i.get(t);if(n)return n;const r=this.options.loose,a=r?l[c.HYPHENRANGELOOSE]:l[c.HYPHENRANGE];e=e.replace(a,E(this.options.includePrerelease)),o("hyphen replace",e),e=e.replace(l[c.COMPARATORTRIM],d),o("comparator trim",e);let u=(e=(e=(e=e.replace(l[c.TILDETRIM],h)).replace(l[c.CARETTRIM],f)).split(/\s+/).join(" ")).split(" ").map((e=>y(e,this.options))).join(" ").split(/\s+/).map((e=>A(e,this.options)));r&&(u=u.filter((e=>(o("loose invalid filter",e,this.options),!!e.match(l[c.COMPARATORLOOSE]))))),o("range list",u);const g=new Map,m=u.map((e=>new s(e,this.options)));for(const e of m){if(p(e))return[e];g.set(e.value,e)}g.size>1&&g.has("")&&g.delete("");const v=[...g.values()];return i.set(t,v),v}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some((n=>m(n,t)&&e.set.some((e=>m(e,t)&&n.every((n=>e.every((e=>n.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(F(this.set[t],e,this.options))return!0;return!1}}e.exports=r;const i=new(n(32859))({max:1e3}),a=n(14167),s=n(74890),o=n(34272),u=n(57800),{re:l,t:c,comparatorTrimReplace:d,tildeTrimReplace:h,caretTrimReplace:f}=n(46152),p=e=>"<0.0.0-0"===e.value,g=e=>""===e.value,m=(e,t)=>{let n=!0;const r=e.slice();let i=r.pop();for(;n&&r.length;)n=r.every((e=>i.intersects(e,t))),i=r.pop();return n},y=(e,t)=>(o("comp",e,t),e=w(e,t),o("caret",e),e=b(e,t),o("tildes",e),e=_(e,t),o("xrange",e),e=C(e,t),o("stars",e),e),v=e=>!e||"x"===e.toLowerCase()||"*"===e,b=(e,t)=>e.trim().split(/\s+/).map((e=>x(e,t))).join(" "),x=(e,t)=>{const n=t.loose?l[c.TILDELOOSE]:l[c.TILDE];return e.replace(n,((t,n,r,i,a)=>{let s;return o("tilde",e,t,n,r,i,a),v(n)?s="":v(r)?s=`>=${n}.0.0 <${+n+1}.0.0-0`:v(i)?s=`>=${n}.${r}.0 <${n}.${+r+1}.0-0`:a?(o("replaceTilde pr",a),s=`>=${n}.${r}.${i}-${a} <${n}.${+r+1}.0-0`):s=`>=${n}.${r}.${i} <${n}.${+r+1}.0-0`,o("tilde return",s),s}))},w=(e,t)=>e.trim().split(/\s+/).map((e=>k(e,t))).join(" "),k=(e,t)=>{o("caret",e,t);const n=t.loose?l[c.CARETLOOSE]:l[c.CARET],r=t.includePrerelease?"-0":"";return e.replace(n,((t,n,i,a,s)=>{let u;return o("caret",e,t,n,i,a,s),v(n)?u="":v(i)?u=`>=${n}.0.0${r} <${+n+1}.0.0-0`:v(a)?u="0"===n?`>=${n}.${i}.0${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.0${r} <${+n+1}.0.0-0`:s?(o("replaceCaret pr",s),u="0"===n?"0"===i?`>=${n}.${i}.${a}-${s} <${n}.${i}.${+a+1}-0`:`>=${n}.${i}.${a}-${s} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${a}-${s} <${+n+1}.0.0-0`):(o("no pr"),u="0"===n?"0"===i?`>=${n}.${i}.${a}${r} <${n}.${i}.${+a+1}-0`:`>=${n}.${i}.${a}${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${a} <${+n+1}.0.0-0`),o("caret return",u),u}))},_=(e,t)=>(o("replaceXRanges",e,t),e.split(/\s+/).map((e=>S(e,t))).join(" ")),S=(e,t)=>{e=e.trim();const n=t.loose?l[c.XRANGELOOSE]:l[c.XRANGE];return e.replace(n,((n,r,i,a,s,u)=>{o("xRange",e,n,r,i,a,s,u);const l=v(i),c=l||v(a),d=c||v(s),h=d;return"="===r&&h&&(r=""),u=t.includePrerelease?"-0":"",l?n=">"===r||"<"===r?"<0.0.0-0":"*":r&&h?(c&&(a=0),s=0,">"===r?(r=">=",c?(i=+i+1,a=0,s=0):(a=+a+1,s=0)):"<="===r&&(r="<",c?i=+i+1:a=+a+1),"<"===r&&(u="-0"),n=`${r+i}.${a}.${s}${u}`):c?n=`>=${i}.0.0${u} <${+i+1}.0.0-0`:d&&(n=`>=${i}.${a}.0${u} <${i}.${+a+1}.0-0`),o("xRange return",n),n}))},C=(e,t)=>(o("replaceStars",e,t),e.trim().replace(l[c.STAR],"")),A=(e,t)=>(o("replaceGTE0",e,t),e.trim().replace(l[t.includePrerelease?c.GTE0PRE:c.GTE0],"")),E=e=>(t,n,r,i,a,s,o,u,l,c,d,h,f)=>`${n=v(r)?"":v(i)?`>=${r}.0.0${e?"-0":""}`:v(a)?`>=${r}.${i}.0${e?"-0":""}`:s?`>=${n}`:`>=${n}${e?"-0":""}`} ${u=v(l)?"":v(c)?`<${+l+1}.0.0-0`:v(d)?`<${l}.${+c+1}.0-0`:h?`<=${l}.${c}.${d}-${h}`:e?`<${l}.${c}.${+d+1}-0`:`<=${u}`}`.trim(),F=(e,t,n)=>{for(let n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let n=0;n<e.length;n++)if(o(e[n].semver),e[n].semver!==s.ANY&&e[n].semver.prerelease.length>0){const r=e[n].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0}},57800:(e,t,n)=>{const r=n(34272),{MAX_LENGTH:i,MAX_SAFE_INTEGER:a}=n(41266),{re:s,t:o}=n(46152),u=n(14167),{compareIdentifiers:l}=n(24126);class c{constructor(e,t){if(t=u(t),e instanceof c){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid Version: ${e}`);if(e.length>i)throw new TypeError(`version is longer than ${i} characters`);r("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?s[o.LOOSE]:s[o.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>a||this.major<0)throw new TypeError("Invalid major version");if(this.minor>a||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>a||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<a)return t}return e})):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(r("SemVer.compare",this.version,this.options,e),!(e instanceof c)){if("string"==typeof e&&e===this.version)return 0;e=new c(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof c||(e=new c(e,this.options)),l(this.major,e.major)||l(this.minor,e.minor)||l(this.patch,e.patch)}comparePre(e){if(e instanceof c||(e=new c(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],i=e.prerelease[t];if(r("prerelease compare",t,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return l(n,i)}while(++t)}compareBuild(e){e instanceof c||(e=new c(e,this.options));let t=0;do{const n=this.build[t],i=e.build[t];if(r("prerelease compare",t,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return l(n,i)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;for(;--e>=0;)"number"==typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}e.exports=c},33974:(e,t,n)=>{const r=n(50155);e.exports=(e,t)=>{const n=r(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null}},11427:(e,t,n)=>{const r=n(63641),i=n(97351),a=n(3365),s=n(14457),o=n(2687),u=n(6039);e.exports=(e,t,n,l)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return r(e,n,l);case"!=":return i(e,n,l);case">":return a(e,n,l);case">=":return s(e,n,l);case"<":return o(e,n,l);case"<=":return u(e,n,l);default:throw new TypeError(`Invalid operator: ${t}`)}}},6751:(e,t,n)=>{const r=n(57800),i=n(50155),{re:a,t:s}=n(46152);e.exports=(e,t)=>{if(e instanceof r)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let n=null;if((t=t||{}).rtl){let t;for(;(t=a[s.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)n&&t.index+t[0].length===n.index+n[0].length||(n=t),a[s.COERCERTL].lastIndex=t.index+t[1].length+t[2].length;a[s.COERCERTL].lastIndex=-1}else n=e.match(a[s.COERCE]);return null===n?null:i(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,t)}},72995:(e,t,n)=>{const r=n(57800);e.exports=(e,t,n)=>{const i=new r(e,n),a=new r(t,n);return i.compare(a)||i.compareBuild(a)}},71844:(e,t,n)=>{const r=n(36004);e.exports=(e,t)=>r(e,t,!0)},36004:(e,t,n)=>{const r=n(57800);e.exports=(e,t,n)=>new r(e,n).compare(new r(t,n))},42513:(e,t,n)=>{const r=n(50155),i=n(63641);e.exports=(e,t)=>{if(i(e,t))return null;{const n=r(e),i=r(t),a=n.prerelease.length||i.prerelease.length,s=a?"pre":"",o=a?"prerelease":"";for(const e in n)if(("major"===e||"minor"===e||"patch"===e)&&n[e]!==i[e])return s+e;return o}}},63641:(e,t,n)=>{const r=n(36004);e.exports=(e,t,n)=>0===r(e,t,n)},3365:(e,t,n)=>{const r=n(36004);e.exports=(e,t,n)=>r(e,t,n)>0},14457:(e,t,n)=>{const r=n(36004);e.exports=(e,t,n)=>r(e,t,n)>=0},23866:(e,t,n)=>{const r=n(57800);e.exports=(e,t,n,i)=>{"string"==typeof n&&(i=n,n=void 0);try{return new r(e,n).inc(t,i).version}catch(e){return null}}},2687:(e,t,n)=>{const r=n(36004);e.exports=(e,t,n)=>r(e,t,n)<0},6039:(e,t,n)=>{const r=n(36004);e.exports=(e,t,n)=>r(e,t,n)<=0},52439:(e,t,n)=>{const r=n(57800);e.exports=(e,t)=>new r(e,t).major},83332:(e,t,n)=>{const r=n(57800);e.exports=(e,t)=>new r(e,t).minor},97351:(e,t,n)=>{const r=n(36004);e.exports=(e,t,n)=>0!==r(e,t,n)},50155:(e,t,n)=>{const{MAX_LENGTH:r}=n(41266),{re:i,t:a}=n(46152),s=n(57800),o=n(14167);e.exports=(e,t)=>{if(t=o(t),e instanceof s)return e;if("string"!=typeof e)return null;if(e.length>r)return null;if(!(t.loose?i[a.LOOSE]:i[a.FULL]).test(e))return null;try{return new s(e,t)}catch(e){return null}}},98425:(e,t,n)=>{const r=n(57800);e.exports=(e,t)=>new r(e,t).patch},51298:(e,t,n)=>{const r=n(50155);e.exports=(e,t)=>{const n=r(e,t);return n&&n.prerelease.length?n.prerelease:null}},22737:(e,t,n)=>{const r=n(36004);e.exports=(e,t,n)=>r(t,e,n)},81761:(e,t,n)=>{const r=n(72995);e.exports=(e,t)=>e.sort(((e,n)=>r(n,e,t)))},70826:(e,t,n)=>{const r=n(21540);e.exports=(e,t,n)=>{try{t=new r(t,n)}catch(e){return!1}return t.test(e)}},45626:(e,t,n)=>{const r=n(72995);e.exports=(e,t)=>e.sort(((e,n)=>r(e,n,t)))},56798:(e,t,n)=>{const r=n(50155);e.exports=(e,t)=>{const n=r(e,t);return n?n.version:null}},52543:(e,t,n)=>{const r=n(46152);e.exports={re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:n(41266).SEMVER_SPEC_VERSION,SemVer:n(57800),compareIdentifiers:n(24126).compareIdentifiers,rcompareIdentifiers:n(24126).rcompareIdentifiers,parse:n(50155),valid:n(56798),clean:n(33974),inc:n(23866),diff:n(42513),major:n(52439),minor:n(83332),patch:n(98425),prerelease:n(51298),compare:n(36004),rcompare:n(22737),compareLoose:n(71844),compareBuild:n(72995),sort:n(45626),rsort:n(81761),gt:n(3365),lt:n(2687),eq:n(63641),neq:n(97351),gte:n(14457),lte:n(6039),cmp:n(11427),coerce:n(6751),Comparator:n(74890),Range:n(21540),satisfies:n(70826),toComparators:n(70434),maxSatisfying:n(94600),minSatisfying:n(50142),minVersion:n(10734),validRange:n(12617),outside:n(42416),gtr:n(9903),ltr:n(71611),intersects:n(91413),simplifyRange:n(39901),subset:n(52792)}},41266:e=>{const t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:t,MAX_SAFE_COMPONENT_LENGTH:16}},34272:e=>{const t="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=t},24126:e=>{const t=/^[0-9]+$/,n=(e,n)=>{const r=t.test(e),i=t.test(n);return r&&i&&(e=+e,n=+n),e===n?0:r&&!i?-1:i&&!r?1:e<n?-1:1};e.exports={compareIdentifiers:n,rcompareIdentifiers:(e,t)=>n(t,e)}},14167:e=>{const t=["includePrerelease","loose","rtl"];e.exports=e=>e?"object"!=typeof e?{loose:!0}:t.filter((t=>e[t])).reduce(((e,t)=>(e[t]=!0,e)),{}):{}},46152:(e,t,n)=>{const{MAX_SAFE_COMPONENT_LENGTH:r}=n(41266),i=n(34272),a=(t=e.exports={}).re=[],s=t.src=[],o=t.t={};let u=0;const l=(e,t,n)=>{const r=u++;i(e,r,t),o[e]=r,s[r]=t,a[r]=new RegExp(t,n?"g":void 0)};l("NUMERICIDENTIFIER","0|[1-9]\\d*"),l("NUMERICIDENTIFIERLOOSE","[0-9]+"),l("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),l("MAINVERSION",`(${s[o.NUMERICIDENTIFIER]})\\.(${s[o.NUMERICIDENTIFIER]})\\.(${s[o.NUMERICIDENTIFIER]})`),l("MAINVERSIONLOOSE",`(${s[o.NUMERICIDENTIFIERLOOSE]})\\.(${s[o.NUMERICIDENTIFIERLOOSE]})\\.(${s[o.NUMERICIDENTIFIERLOOSE]})`),l("PRERELEASEIDENTIFIER",`(?:${s[o.NUMERICIDENTIFIER]}|${s[o.NONNUMERICIDENTIFIER]})`),l("PRERELEASEIDENTIFIERLOOSE",`(?:${s[o.NUMERICIDENTIFIERLOOSE]}|${s[o.NONNUMERICIDENTIFIER]})`),l("PRERELEASE",`(?:-(${s[o.PRERELEASEIDENTIFIER]}(?:\\.${s[o.PRERELEASEIDENTIFIER]})*))`),l("PRERELEASELOOSE",`(?:-?(${s[o.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${s[o.PRERELEASEIDENTIFIERLOOSE]})*))`),l("BUILDIDENTIFIER","[0-9A-Za-z-]+"),l("BUILD",`(?:\\+(${s[o.BUILDIDENTIFIER]}(?:\\.${s[o.BUILDIDENTIFIER]})*))`),l("FULLPLAIN",`v?${s[o.MAINVERSION]}${s[o.PRERELEASE]}?${s[o.BUILD]}?`),l("FULL",`^${s[o.FULLPLAIN]}$`),l("LOOSEPLAIN",`[v=\\s]*${s[o.MAINVERSIONLOOSE]}${s[o.PRERELEASELOOSE]}?${s[o.BUILD]}?`),l("LOOSE",`^${s[o.LOOSEPLAIN]}$`),l("GTLT","((?:<|>)?=?)"),l("XRANGEIDENTIFIERLOOSE",`${s[o.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),l("XRANGEIDENTIFIER",`${s[o.NUMERICIDENTIFIER]}|x|X|\\*`),l("XRANGEPLAIN",`[v=\\s]*(${s[o.XRANGEIDENTIFIER]})(?:\\.(${s[o.XRANGEIDENTIFIER]})(?:\\.(${s[o.XRANGEIDENTIFIER]})(?:${s[o.PRERELEASE]})?${s[o.BUILD]}?)?)?`),l("XRANGEPLAINLOOSE",`[v=\\s]*(${s[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${s[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${s[o.XRANGEIDENTIFIERLOOSE]})(?:${s[o.PRERELEASELOOSE]})?${s[o.BUILD]}?)?)?`),l("XRANGE",`^${s[o.GTLT]}\\s*${s[o.XRANGEPLAIN]}$`),l("XRANGELOOSE",`^${s[o.GTLT]}\\s*${s[o.XRANGEPLAINLOOSE]}$`),l("COERCE",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?(?:$|[^\\d])`),l("COERCERTL",s[o.COERCE],!0),l("LONETILDE","(?:~>?)"),l("TILDETRIM",`(\\s*)${s[o.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",l("TILDE",`^${s[o.LONETILDE]}${s[o.XRANGEPLAIN]}$`),l("TILDELOOSE",`^${s[o.LONETILDE]}${s[o.XRANGEPLAINLOOSE]}$`),l("LONECARET","(?:\\^)"),l("CARETTRIM",`(\\s*)${s[o.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",l("CARET",`^${s[o.LONECARET]}${s[o.XRANGEPLAIN]}$`),l("CARETLOOSE",`^${s[o.LONECARET]}${s[o.XRANGEPLAINLOOSE]}$`),l("COMPARATORLOOSE",`^${s[o.GTLT]}\\s*(${s[o.LOOSEPLAIN]})$|^$`),l("COMPARATOR",`^${s[o.GTLT]}\\s*(${s[o.FULLPLAIN]})$|^$`),l("COMPARATORTRIM",`(\\s*)${s[o.GTLT]}\\s*(${s[o.LOOSEPLAIN]}|${s[o.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",l("HYPHENRANGE",`^\\s*(${s[o.XRANGEPLAIN]})\\s+-\\s+(${s[o.XRANGEPLAIN]})\\s*$`),l("HYPHENRANGELOOSE",`^\\s*(${s[o.XRANGEPLAINLOOSE]})\\s+-\\s+(${s[o.XRANGEPLAINLOOSE]})\\s*$`),l("STAR","(<|>)?=?\\s*\\*"),l("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),l("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},9903:(e,t,n)=>{const r=n(42416);e.exports=(e,t,n)=>r(e,t,">",n)},91413:(e,t,n)=>{const r=n(21540);e.exports=(e,t,n)=>(e=new r(e,n),t=new r(t,n),e.intersects(t))},71611:(e,t,n)=>{const r=n(42416);e.exports=(e,t,n)=>r(e,t,"<",n)},94600:(e,t,n)=>{const r=n(57800),i=n(21540);e.exports=(e,t,n)=>{let a=null,s=null,o=null;try{o=new i(t,n)}catch(e){return null}return e.forEach((e=>{o.test(e)&&(a&&-1!==s.compare(e)||(a=e,s=new r(a,n)))})),a}},50142:(e,t,n)=>{const r=n(57800),i=n(21540);e.exports=(e,t,n)=>{let a=null,s=null,o=null;try{o=new i(t,n)}catch(e){return null}return e.forEach((e=>{o.test(e)&&(a&&1!==s.compare(e)||(a=e,s=new r(a,n)))})),a}},10734:(e,t,n)=>{const r=n(57800),i=n(21540),a=n(3365);e.exports=(e,t)=>{e=new i(e,t);let n=new r("0.0.0");if(e.test(n))return n;if(n=new r("0.0.0-0"),e.test(n))return n;n=null;for(let t=0;t<e.set.length;++t){const i=e.set[t];let s=null;i.forEach((e=>{const t=new r(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":s&&!a(t,s)||(s=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!s||n&&!a(n,s)||(n=s)}return n&&e.test(n)?n:null}},42416:(e,t,n)=>{const r=n(57800),i=n(74890),{ANY:a}=i,s=n(21540),o=n(70826),u=n(3365),l=n(2687),c=n(6039),d=n(14457);e.exports=(e,t,n,h)=>{let f,p,g,m,y;switch(e=new r(e,h),t=new s(t,h),n){case">":f=u,p=c,g=l,m=">",y=">=";break;case"<":f=l,p=d,g=u,m="<",y="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(o(e,t,h))return!1;for(let n=0;n<t.set.length;++n){const r=t.set[n];let s=null,o=null;if(r.forEach((e=>{e.semver===a&&(e=new i(">=0.0.0")),s=s||e,o=o||e,f(e.semver,s.semver,h)?s=e:g(e.semver,o.semver,h)&&(o=e)})),s.operator===m||s.operator===y)return!1;if((!o.operator||o.operator===m)&&p(e,o.semver))return!1;if(o.operator===y&&g(e,o.semver))return!1}return!0}},39901:(e,t,n)=>{const r=n(70826),i=n(36004);e.exports=(e,t,n)=>{const a=[];let s=null,o=null;const u=e.sort(((e,t)=>i(e,t,n)));for(const e of u)r(e,t,n)?(o=e,s||(s=e)):(o&&a.push([s,o]),o=null,s=null);s&&a.push([s,null]);const l=[];for(const[e,t]of a)e===t?l.push(e):t||e!==u[0]?t?e===u[0]?l.push(`<=${t}`):l.push(`${e} - ${t}`):l.push(`>=${e}`):l.push("*");const c=l.join(" || "),d="string"==typeof t.raw?t.raw:String(t);return c.length<d.length?c:t}},52792:(e,t,n)=>{const r=n(21540),i=n(74890),{ANY:a}=i,s=n(70826),o=n(36004),u=(e,t,n)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===a){if(1===t.length&&t[0].semver===a)return!0;e=n.includePrerelease?[new i(">=0.0.0-0")]:[new i(">=0.0.0")]}if(1===t.length&&t[0].semver===a){if(n.includePrerelease)return!0;t=[new i(">=0.0.0")]}const r=new Set;let u,d,h,f,p,g,m;for(const t of e)">"===t.operator||">="===t.operator?u=l(u,t,n):"<"===t.operator||"<="===t.operator?d=c(d,t,n):r.add(t.semver);if(r.size>1)return null;if(u&&d){if(h=o(u.semver,d.semver,n),h>0)return null;if(0===h&&(">="!==u.operator||"<="!==d.operator))return null}for(const e of r){if(u&&!s(e,String(u),n))return null;if(d&&!s(e,String(d),n))return null;for(const r of t)if(!s(e,String(r),n))return!1;return!0}let y=!(!d||n.includePrerelease||!d.semver.prerelease.length)&&d.semver,v=!(!u||n.includePrerelease||!u.semver.prerelease.length)&&u.semver;y&&1===y.prerelease.length&&"<"===d.operator&&0===y.prerelease[0]&&(y=!1);for(const e of t){if(m=m||">"===e.operator||">="===e.operator,g=g||"<"===e.operator||"<="===e.operator,u)if(v&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===v.major&&e.semver.minor===v.minor&&e.semver.patch===v.patch&&(v=!1),">"===e.operator||">="===e.operator){if(f=l(u,e,n),f===e&&f!==u)return!1}else if(">="===u.operator&&!s(u.semver,String(e),n))return!1;if(d)if(y&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===y.major&&e.semver.minor===y.minor&&e.semver.patch===y.patch&&(y=!1),"<"===e.operator||"<="===e.operator){if(p=c(d,e,n),p===e&&p!==d)return!1}else if("<="===d.operator&&!s(d.semver,String(e),n))return!1;if(!e.operator&&(d||u)&&0!==h)return!1}return!(u&&g&&!d&&0!==h||d&&m&&!u&&0!==h||v||y)},l=(e,t,n)=>{if(!e)return t;const r=o(e.semver,t.semver,n);return r>0?e:r<0||">"===t.operator&&">="===e.operator?t:e},c=(e,t,n)=>{if(!e)return t;const r=o(e.semver,t.semver,n);return r<0?e:r>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,n={})=>{if(e===t)return!0;e=new r(e,n),t=new r(t,n);let i=!1;e:for(const r of e.set){for(const e of t.set){const t=u(r,e,n);if(i=i||null!==t,t)continue e}if(i)return!1}return!0}},70434:(e,t,n)=>{const r=n(21540);e.exports=(e,t)=>new r(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")))},12617:(e,t,n)=>{const r=n(21540);e.exports=(e,t)=>{try{return new r(e,t).range||"*"}catch(e){return null}}},50914:()=>{},75410:()=>{},48628:()=>{},55778:()=>{},31601:()=>{},67792:()=>{},34977:()=>{},75042:()=>{},21801:e=>{"use strict";var t=/("(?:[^\\"]|\\.)*")|[:,]/g;e.exports=function(e,n){var r,i,a;return n=n||{},r=JSON.stringify([1],void 0,void 0===n.indent?2:n.indent).slice(2,-3),i=""===r?1/0:void 0===n.maxLength?80:n.maxLength,a=n.replacer,function e(n,s,o){var u,l,c,d,h,f,p,g,m,y,v,b;if(n&&"function"==typeof n.toJSON&&(n=n.toJSON()),void 0===(v=JSON.stringify(n,a)))return v;if(p=i-s.length-o,v.length<=p&&(m=v.replace(t,(function(e,t){return t||e+" "}))).length<=p)return m;if(null!=a&&(n=JSON.parse(v),a=void 0),"object"==typeof n&&null!==n){if(g=s+r,c=[],l=0,Array.isArray(n))for(y="[",u="]",p=n.length;l<p;l++)c.push(e(n[l],g,l===p-1?0:1)||"null");else for(y="{",u="}",p=(f=Object.keys(n)).length;l<p;l++)d=f[l],h=JSON.stringify(d)+": ",void 0!==(b=e(n[d],g,h.length+(l===p-1?0:1)))&&c.push(h+b);if(c.length>0)return[y,r+c.join(",\n"+g),u].join("\n"+s)}return v}(e,"",0)}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}n.amdD=function(){throw new Error("define cannot be used indirect")},n.amdO={},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n.p="/",(()=>{"use strict";if(n(87931),n(95654),n(67182),n.g._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");function e(e,t,n){e[t]||Object.defineProperty(e,t,{writable:!0,configurable:!0,value:n})}n.g._babelPolyfill=!0,e(String.prototype,"padLeft","".padStart),e(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach((function(t){[][t]&&e(Array,t,Function.call.bind([][t]))}))})(),(()=>{"use strict";var e={};n.r(e),n.d(e,{addImpl:()=>Cl,bincountImpl:()=>yc,bincountReduceImpl:()=>vc,ceilImpl:()=>wc,concatImpl:()=>Ec,equalImpl:()=>cd,expImpl:()=>wd,expm1Impl:()=>Ad,floorImpl:()=>Wd,gatherNdImpl:()=>Qd,gatherV2Impl:()=>Zd,greaterEqualImpl:()=>ih,greaterImpl:()=>th,lessEqualImpl:()=>yh,lessImpl:()=>ph,linSpaceImpl:()=>xh,logImpl:()=>kh,maxImpl:()=>Bh,maximumImpl:()=>Ph,minimumImpl:()=>Yh,multiplyImpl:()=>nd,negImpl:()=>uf,notEqualImpl:()=>mf,prodImpl:()=>If,rangeImpl:()=>Nf,rsqrtImpl:()=>Wf,sigmoidImpl:()=>hl,simpleAbsImpl:()=>Ol,sliceImpl:()=>fc,sparseFillEmptyRowsImpl:()=>lp,sparseReshapeImpl:()=>dp,sparseSegmentReductionImpl:()=>fp,sqrtImpl:()=>vp,squaredDifferenceImpl:()=>kp,stridedSliceImpl:()=>Ep,stringNGramsImpl:()=>Dp,stringSplitImpl:()=>Tp,stringToHashBucketFastImpl:()=>Mp,subImpl:()=>$d,tileImpl:()=>jp,topKImpl:()=>Gp,transposeImpl:()=>jl,uniqueImpl:()=>Jp});var t,r=n(67294),i=n(73935);function a(){return a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(t||(t={}));var s="beforeunload";function o(e){e.preventDefault(),e.returnValue=""}function u(){var e=[];return{get length(){return e.length},push:function(t){return e.push(t),function(){e=e.filter((function(e){return e!==t}))}},call:function(t){e.forEach((function(e){return e&&e(t)}))}}}function l(e){var t={};if(e){var n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));var r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}const c=(0,r.createContext)(null),d=(0,r.createContext)(null),h=(0,r.createContext)({outlet:null,matches:[]});function f(e,t){if(!e)throw new Error(t)}function p(e,t,n){void 0===n&&(n="/");let r=w(("string"==typeof t?l(t):t).pathname||"/",n);if(null==r)return null;let i=g(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){return e.length===t.length&&e.slice(0,-1).every(((e,n)=>e===t[n]))?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(i);let a=null;for(let e=0;null==a&&e<i.length;++e)a=b(i[e],r);return a}function g(e,t,n,r){return void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r=""),e.forEach(((e,i)=>{let a={relativePath:e.path||"",caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};a.relativePath.startsWith("/")&&(a.relativePath.startsWith(r)||f(!1),a.relativePath=a.relativePath.slice(r.length));let s=k([r,a.relativePath]),o=n.concat(a);e.children&&e.children.length>0&&(!0===e.index&&f(!1),g(e.children,t,o,s)),(null!=e.path||e.index)&&t.push({path:s,score:v(s,e.index),routesMeta:o})})),t}const m=/^:\w+$/,y=e=>"*"===e;function v(e,t){let n=e.split("/"),r=n.length;return n.some(y)&&(r+=-2),t&&(r+=2),n.filter((e=>!y(e))).reduce(((e,t)=>e+(m.test(t)?3:""===t?1:10)),r)}function b(e,t){let{routesMeta:n}=e,r={},i="/",a=[];for(let e=0;e<n.length;++e){let s=n[e],o=e===n.length-1,u="/"===i?t:t.slice(i.length)||"/",l=x({path:s.relativePath,caseSensitive:s.caseSensitive,end:o},u);if(!l)return null;Object.assign(r,l.params);let c=s.route;a.push({params:r,pathname:k([i,l.pathname]),pathnameBase:_(k([i,l.pathnameBase])),route:c}),"/"!==l.pathnameBase&&(i=k([i,l.pathnameBase]))}return a}function x(e,t){"string"==typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);let r=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/:(\w+)/g,((e,t)=>(r.push(t),"([^\\/]+)")));return e.endsWith("*")?(r.push("*"),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):i+=n?"\\/*$":"(?:(?=[.~-]|%[0-9A-F]{2})|\\b|\\/|$)",[new RegExp(i,t?void 0:"i"),r]}(e.path,e.caseSensitive,e.end),i=t.match(n);if(!i)return null;let a=i[0],s=a.replace(/(.)\/+$/,"$1"),o=i.slice(1);return{params:r.reduce(((e,t,n)=>{if("*"===t){let e=o[n]||"";s=a.slice(0,a.length-e.length).replace(/(.)\/+$/,"$1")}return e[t]=function(e,t){try{return decodeURIComponent(e)}catch(t){return e}}(o[n]||""),e}),{}),pathname:a,pathnameBase:s,pattern:e}}function w(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=e.charAt(t.length);return n&&"/"!==n?null:e.slice(t.length)||"/"}const k=e=>e.join("/").replace(/\/\/+/g,"/"),_=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/");function S(){return null!=(0,r.useContext)(d)}function C(e){f(!1)}function A(e){let{basename:n="/",children:i=null,location:a,navigationType:s=t.Pop,navigator:o,static:u=!1}=e;S()&&f(!1);let h=_(n),p=(0,r.useMemo)((()=>({basename:h,navigator:o,static:u})),[h,o,u]);"string"==typeof a&&(a=l(a));let{pathname:g="/",search:m="",hash:y="",state:v=null,key:b="default"}=a,x=(0,r.useMemo)((()=>{let e=w(g,h);return null==e?null:{pathname:e,search:m,hash:y,state:v,key:b}}),[h,g,m,y,v,b]);return null==x?null:(0,r.createElement)(c.Provider,{value:p},(0,r.createElement)(d.Provider,{children:i,value:{location:x,navigationType:s}}))}function E(e){let{children:t,location:n}=e;return function(e,t){S()||f(!1);let{matches:n}=(0,r.useContext)(h),i=n[n.length-1],a=i?i.params:{},s=(i&&i.pathname,i?i.pathnameBase:"/");i&&i.route;let o,u=(S()||f(!1),(0,r.useContext)(d).location);if(t){var c;let e="string"==typeof t?l(t):t;"/"===s||(null==(c=e.pathname)?void 0:c.startsWith(s))||f(!1),o=e}else o=u;let g=o.pathname||"/",m=p(e,{pathname:"/"===s?g:g.slice(s.length)||"/"});return function(e,t){return void 0===t&&(t=[]),null==e?null:e.reduceRight(((n,i,a)=>(0,r.createElement)(h.Provider,{children:void 0!==i.route.element?i.route.element:n,value:{outlet:n,matches:t.concat(e.slice(0,a+1))}})),null)}(m&&m.map((e=>Object.assign({},e,{params:Object.assign({},a,e.params),pathname:k([s,e.pathname]),pathnameBase:"/"===e.pathnameBase?s:k([s,e.pathnameBase])}))),n)}(F(t),n)}function F(e){let t=[];return r.Children.forEach(e,(e=>{if(!(0,r.isValidElement)(e))return;if(e.type===r.Fragment)return void t.push.apply(t,F(e.props.children));e.type!==C&&f(!1);let n={caseSensitive:e.props.caseSensitive,element:e.props.element,index:e.props.index,path:e.props.path};e.props.children&&(n.children=F(e.props.children)),t.push(n)})),t}function I(e){let{basename:n,children:i,window:c}=e,d=(0,r.useRef)();null==d.current&&(d.current=function(e){void 0===e&&(e={});var n=e.window,r=void 0===n?document.defaultView:n,i=r.history;function c(){var e=r.location,t=e.pathname,n=e.search,a=e.hash,s=i.state||{};return[s.idx,{pathname:t,search:n,hash:a,state:s.usr||null,key:s.key||"default"}]}var d=null;r.addEventListener("popstate",(function(){if(d)y.call(d),d=null;else{var e=t.Pop,n=c(),r=n[0],i=n[1];if(y.length){if(null!=r){var a=p-r;a&&(d={action:e,location:i,retry:function(){_(-1*a)}},_(a))}}else k(e)}}));var h=t.Pop,f=c(),p=f[0],g=f[1],m=u(),y=u();function v(e){return"string"==typeof e?e:function(e){var t=e.pathname,n=void 0===t?"/":t,r=e.search,i=void 0===r?"":r,a=e.hash,s=void 0===a?"":a;return i&&"?"!==i&&(n+="?"===i.charAt(0)?i:"?"+i),s&&"#"!==s&&(n+="#"===s.charAt(0)?s:"#"+s),n}(e)}function b(e,t){return void 0===t&&(t=null),a({pathname:g.pathname,hash:"",search:""},"string"==typeof e?l(e):e,{state:t,key:Math.random().toString(36).substr(2,8)})}function x(e,t){return[{usr:e.state,key:e.key,idx:t},v(e)]}function w(e,t,n){return!y.length||(y.call({action:e,location:t,retry:n}),!1)}function k(e){h=e;var t=c();p=t[0],g=t[1],m.call({action:h,location:g})}function _(e){i.go(e)}null==p&&(p=0,i.replaceState(a({},i.state,{idx:p}),""));var S={get action(){return h},get location(){return g},createHref:v,push:function e(n,a){var s=t.Push,o=b(n,a);if(w(s,o,(function(){e(n,a)}))){var u=x(o,p+1),l=u[0],c=u[1];try{i.pushState(l,"",c)}catch(e){r.location.assign(c)}k(s)}},replace:function e(n,r){var a=t.Replace,s=b(n,r);if(w(a,s,(function(){e(n,r)}))){var o=x(s,p),u=o[0],l=o[1];i.replaceState(u,"",l),k(a)}},go:_,back:function(){_(-1)},forward:function(){_(1)},listen:function(e){return m.push(e)},block:function(e){var t=y.push(e);return 1===y.length&&r.addEventListener(s,o),function(){t(),y.length||r.removeEventListener(s,o)}}};return S}({window:c}));let h=d.current,[f,p]=(0,r.useState)({action:h.action,location:h.location});return(0,r.useLayoutEffect)((()=>h.listen(p)),[h]),(0,r.createElement)(A,{basename:n,children:i,location:f.location,navigationType:f.action,navigator:h})}var D=n(93792),N=n(29121),$=n(62271),T=n(24841),O=n(71901);const M={kernelName:N.SY,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,T.d)(e,(0,O.N)((0,$.p)(n,"float32"),-1))}}};var R=n(41274),B=n(17370),z=n(99494),L=n(13261),P=n(50248),j=n(70827);const U={kernelName:N.VG,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=(0,P.h)((0,$.p)(n,"float32")),r=(0,L._)((0,j.l)((0,z.i)(1),t));return(0,B.W)((0,R.h)(e,r))}}}},W={kernelName:N.Sp,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=(0,L._)((0,j.l)((0,P.h)((0,$.p)(n,"float32")),1));return(0,R.h)(e,t)}}}};var V=n(72200),G=n(4968),q=n(15475);const H={kernelName:N.mm,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=V.assertAndGetBroadcastShape(n.shape,r.shape);return{a:()=>{let t=e;const r=V.getReductionAxes(n.shape,i);return r.length>0&&(t=(0,q.S)(t,r)),(0,G.X)(t,n.shape)},b:()=>{let t=e;const n=V.getReductionAxes(r.shape,i);return n.length>0&&(t=(0,q.S)(t,n)),(0,G.X)(t,r.shape)}}}},X={kernelName:N.Xz,saveAllInputs:!0,gradFunc:(e,t)=>{const n={};return t.forEach(((t,r)=>{n[r]=()=>e.clone()})),n}};var K=n(29999);const Y={kernelName:N.sJ,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,K.P)(n)}}},Q={kernelName:N.aJ,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,K.P)(n)}}},J={kernelName:N.M2,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,R.h)(e,(0,L._)((0,j.l)((0,z.i)(1),(0,P.h)((0,$.p)(n,"float32")))))}}};var Z=n(56407);const ee={kernelName:N.qw,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=(0,L._)((0,Z.I)((0,z.i)(1),(0,P.h)((0,$.p)(n,"float32"))));return(0,R.h)(e,t)}}}},te={kernelName:N.QC,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=(0,V.assertAndGetBroadcastShape)(n.shape,r.shape);return{a:()=>{const t=(0,Z.I)((0,P.h)(n),(0,P.h)(r));let a=(0,T.d)(e,(0,R.h)(r,t));const s=(0,V.getReductionAxes)(n.shape,i);return s.length>0&&(a=(0,q.S)(a,s)),(0,G.X)(a,n.shape)},b:()=>{const t=(0,Z.I)((0,P.h)(n),(0,P.h)(r));let a=(0,B.W)((0,T.d)(e,(0,R.h)(n,t)));const s=(0,V.getReductionAxes)(r.shape,i);return s.length>0&&(a=(0,q.S)(a,s)),(0,G.X)(a,r.shape)}}}},ne={kernelName:N.jM,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,R.h)(e,(0,Z.I)((0,P.h)((0,$.p)(n,"float32")),1))}}},re={kernelName:N.Oy,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,R.h)(e,(0,j.l)((0,z.i)(1),(0,P.h)((0,$.p)(n,"float32"))))}}};var ie=n(97097),ae=n(43740),se=n(20569),oe=n(2582),ue=n(2668);const le=(0,ue.op)({avgPool3dGrad_:function(e,t,n,r,i,a){const s=(0,ae._1)(e,"dy","avgPool3dGrad"),o=(0,ae._1)(t,"input","avgPool3dGrad");let u=s,l=o,c=!1;4===o.rank&&(c=!0,u=(0,G.X)(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),l=(0,G.X)(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),se.hu(5===u.rank,(()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`)),se.hu(5===l.rank,(()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${l.rank}.`)),(0,oe.m)("avgPool3dGrad",i,a);const d={dy:u,input:l},h={filterSize:n,strides:r,pad:i,dimRoundingMode:a},f=ie.BV.runKernel(N.IM,d,h);return c?(0,G.X)(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}}),ce={kernelName:N._k,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:i,strides:a,pad:s,dimRoundingMode:o}=n;return{x:()=>le(e,r,i,a,s,o)}}},de=(0,ue.op)({avgPoolGrad_:function(e,t,n,r,i){const a=(0,ae._1)(e,"dy","avgPoolGrad"),s=(0,ae._1)(t,"input","avgPoolGrad");se.hu(s.rank===a.rank,(()=>`Rank of input (${s.rank}) does not match rank of dy (${a.rank})`));let o=s,u=a,l=!1;3===s.rank&&(l=!0,o=(0,G.X)(s,[1,s.shape[0],s.shape[1],s.shape[2]]),u=(0,G.X)(a,[1,a.shape[0],a.shape[1],a.shape[2]])),se.hu(4===u.rank,(()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`)),se.hu(4===o.rank,(()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${o.rank}.`));const c={dy:u,input:o},d={filterSize:n,strides:r,pad:i},h=ie.BV.runKernel(N.RO,c,d);return l?(0,G.X)(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),he={kernelName:N.Jh,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:i,strides:a,pad:s}=n;return{x:()=>de(e,r,i,a,s)}}};var fe=n(28687);const pe={kernelName:N.XL,inputsToSave:["a","b"],gradFunc:(e,t,n)=>{const[r,i]=t,{transposeA:a,transposeB:s}=n;return a||s?!a&&s?{a:()=>(0,fe.O)(e,i,!1,!1),b:()=>(0,fe.O)(e,r,!0,!1)}:a&&!s?{a:()=>(0,fe.O)(i,e,!1,!0),b:()=>(0,fe.O)(r,e,!1,!1)}:{a:()=>(0,fe.O)(i,e,!0,!0),b:()=>(0,fe.O)(e,r,!0,!0)}:{a:()=>(0,fe.O)(e,i,!1,!0),b:()=>(0,fe.O)(r,e,!0,!1)}}};var ge=n(27918);const me={kernelName:N.zw,gradFunc:(e,t,n)=>{const{blockShape:r,crops:i}=n;return{x:()=>(0,ge.f)(e,r,i)}}},ye={kernelName:N.Ly,gradFunc:(e,t,n)=>{const r=n,i=r.inputShape,a=r.shape,s=Array.from(a);for(let e=i.length-1;e>=0;e--)if(i[e]===a[e])s[e]=1;else if(1!==i[e])throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${a}].`);const o=[];for(let e=0;e<s.length;e++)s[e]>1&&o.push(e);return{x:()=>(0,q.S)(e,o,!0)}}},ve={kernelName:N.RF,gradFunc:e=>({x:()=>e.clone()})},be={kernelName:N.gJ,gradFunc:e=>({x:()=>(0,K.P)(e)})};var xe=n(17630),we=n(50624),ke=n(2856),_e=n(95912);const Se={kernelName:N.xn,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{clipValueMin:i,clipValueMax:a}=n;return{x:()=>(0,_e.a)((0,ke.H)((0,xe.b)(r,i),(0,we.z)(r,a)),e,(0,K.P)(e))}}},Ce={kernelName:N.yj,inputsToSave:["x"],gradFunc:M.gradFunc};var Ae=n(28644);const Ee={kernelName:N.Eh,saveAllInputs:!0,gradFunc:(e,t,n)=>{const r=t.map((e=>e.shape)),{axis:i}=n,a=(0,se.EC)(i,t[0].shape)[0],s=r.map((e=>e[a]));return(0,Ae.V)(e,s,a).map((e=>()=>e))}};var Fe=n(36013),Ie=n(39832);const De={kernelName:N.mh,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,i]=t,{dilations:a,strides:s,pad:o,dataFormat:u}=n;return se.hu(oe.I0(a),(()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${a}'`)),{x:()=>(0,Ie._)(r.shape,e,i,s,o,u),filter:()=>(0,Fe.p)(r,e,i.shape,s,o,u)}}};var Ne=n(64794);const $e={kernelName:N.wm,inputsToSave:["dy","filter"],gradFunc:(e,t,n)=>{const[r,i]=t,{strides:a,pad:s,dataFormat:o,dimRoundingMode:u}=n;return{dy:()=>(0,Ne.T)(e,i,a,s,o,1,u),filter:()=>(0,Fe.p)(e,r,i.shape,a,s,o,u)}}},Te=(0,ue.op)({conv3DBackpropFilter_:function(e,t,n,r,i){let a=e;4===e.rank&&(a=(0,G.X)(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));let s=t;4===s.rank&&(s=(0,G.X)(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),se.hu(5===a.rank,(()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${a.shape}.`)),se.hu(5===s.rank,(()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${s.shape}.`)),se.hu(5===n.length,(()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`)),se.hu(a.shape[4]===n[3],(()=>`Error in conv3dDerFilter: depth of input ${a.shape[4]}) must match input depth in filter (${n[3]}.`)),se.hu(s.shape[4]===n[4],(()=>`Error in conv3dDerFilter: depth of dy (${s.shape[4]}) must match output depth for filter (${n[4]}).`));const o={x:a,dy:s},u={strides:r,pad:i,filterShape:n};return ie.BV.runKernel(N.o2,o,u)}});var Oe=n(97594);const Me={kernelName:N.x1,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:i,pad:a}=n;se.hu((0,oe.I0)(r),(()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`));const[s,o]=t;return{x:()=>(0,Oe._)(s.shape,e,o,i,a),filter:()=>Te(s,e,o.shape,i,a)}}};var Re=n(99331);const Be={kernelName:N.mc,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,T.d)((0,B.W)((0,Re.O)((0,$.p)(n,"float32"))),e)}}};var ze=n(83254);const Le={kernelName:N.TR,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,T.d)((0,ze.R)((0,$.p)(n,"float32")),e)}}};var Pe=n(83591),je=n(37405),Ue=n(89065);const We={kernelName:N.iH,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:i,exclusive:a,reverse:s}=n;return{x:()=>{const t=(0,Pe.Q3)([i],r.rank);let n=(0,je.z)(e,i,a,!s);return null!=t&&(n=(0,Ue.p)(n,t)),n}}}};var Ve=n(88098),Ge=n(54375);const qe={kernelName:N.ci,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:i,pad:a,dimRoundingMode:s}=n,o=null==r?[1,1]:r;se.hu(oe.I0(o),(()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`));const[u,l]=t;return se.hu(4===u.rank,(()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`)),se.hu(4===l.rank,(()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${l.rank}.`)),se.hu(u.shape[3]===l.shape[2],(()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`)),se.hu(oe.jT(i,o),(()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${i} and dilations '${o}'.`)),oe.m("depthwiseConv2d",a,s),{x:()=>(0,Ge.v)(u.shape,e,l,i,a,o,s),filter:()=>(0,Ve.z)(u,e,l.shape,i,a,o,s)}}},He={kernelName:N.p4,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,i]=t,a={x:r,filter:i,dy:e},s={x:r,filter:i,dy:e};return{x:()=>ie.BV.runKernel(N.ek,a,n),filter:()=>ie.BV.runKernel(N.Vn,s,n)}}},Xe={kernelName:N.SX,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t,r={dy:e,y:n};return{x:()=>ie.BV.runKernel(N.HE,r)}}};var Ke=n(44842);const Ye={kernelName:N.Om,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=(0,T.d)((0,Ke.Q)((0,B.W)((0,P.h)(n))),2/Math.sqrt(Math.PI));return{x:()=>(0,T.d)(e,r)}}},Qe={kernelName:N.NE,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,T.d)(e,n)}}},Je={kernelName:N.YF,inputsToSave:["input"],gradFunc:(e,t)=>{const[n]=t;return{input:()=>(0,G.X)(e,n.shape)}}},Ze={kernelName:N.Y0,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,T.d)(e,(0,Ke.Q)(n))}}},et={kernelName:N.OR,gradFunc:e=>({x:()=>(0,K.P)(e)})},tt={kernelName:N.je,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=(0,V.assertAndGetBroadcastShape)(n.shape,r.shape);return{a:()=>{const t=(0,R.h)(e,(0,$.p)(r,"float32")),a=(0,V.getReductionAxes)(n.shape,i);return a.length>0?(0,G.X)((0,q.S)(t,a),n.shape):t},b:()=>{let t=(0,T.d)(e,(0,$.p)(n,"float32"));const a=(0,V.getReductionAxes)(r.shape,i);a.length>0&&(t=(0,G.X)((0,q.S)(t,a),r.shape));const s=(0,P.h)(r);return(0,B.W)((0,R.h)(t,(0,$.p)(s,"float32")))}}}};var nt=n(32634),rt=n(47501);const it={kernelName:N.sH,inputsToSave:["x","mean","variance","scale"],gradFunc:(e,t,n)=>{const{varianceEpsilon:r}=n,[i,a,s,o]=t,u=null==o?(0,z.i)(1):o,l=(0,V.getReductionAxes)(a.shape,i.shape),c=[];if(1===a.rank){for(let e=0;e<i.shape.length-1;++e)c.push(i.shape[e]);c.push(1)}const d=(0,j.l)(i,a),h=(0,T.d)(e,u),f=(0,nt.b)((0,Z.I)(s,(0,z.i)(r))),p=(0,T.d)((0,T.d)((0,T.d)(f,f),f),(0,z.i)(-.5));return{x:()=>1===a.rank?(0,G.X)((0,T.d)((0,T.d)(e,(0,rt.G)((0,G.X)(f,[1,1,1,a.shape[0]]),c)),u),i.shape):(0,G.X)((0,T.d)((0,T.d)(e,f),u),i.shape),mean:()=>{let e=(0,T.d)((0,T.d)(f,(0,z.i)(-1)),h);return 1===a.rank&&(e=(0,q.S)(e,l)),(0,G.X)(e,a.shape)},variance:()=>{let e=(0,T.d)((0,T.d)(p,d),h);return 1===a.rank&&(e=(0,q.S)(e,l)),(0,G.X)(e,a.shape)},scale:()=>{const t=(0,T.d)(d,f);let n=(0,T.d)(e,t);return 1===a.rank&&(n=(0,q.S)(n,l)),(0,G.X)(n,a.shape)},offset:()=>{let t=e;return 1===a.rank&&(t=(0,q.S)(t,l)),(0,G.X)(t,a.shape)}}}};var at=n(98749);const st={kernelName:N.qi,inputsToSave:["x","indices"],gradFunc:(e,t,n)=>{const[r,i]=t,{axis:a}=n,s=(0,se.EC)(a,r.shape)[0];return{x:()=>{const t=r.shape,n=i.size,o=t.slice(0,s),u=o.length,l=t.slice(a,t.length).slice(1),c=l.length,d=ot(0,u),h=ot(u+1,u+1+c),f=ut([o,[n],l]),p=(0,G.X)(e,f),g=(0,G.X)(i,[n]),m=ut([[u],d,h]),y=(0,Ue.p)(p,m);let v=(0,at.p)(y,g,r.shape[s]);const b=(0,Pe.LJ)(m);return v=(0,Ue.p)(v,b),v},indices:()=>i}}};function ot(e,t){const n=[];for(let r=e;r<t;++r)n.push(r);return n}function ut(e){const t=[];for(let n=0;n<e.length;++n)for(let r=0;r<e[n].length;++r)t.push(e[n][r]);return t}const lt={kernelName:N.Ac,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>(0,K.P)(n),b:()=>(0,K.P)(r)}}},ct={kernelName:N.iJ,gradFunc:e=>({x:()=>(0,$.p)(e,"float32")})},dt={kernelName:N.av,gradFunc:e=>({x:()=>(0,K.P)(e)})},ht={kernelName:N.iW,gradFunc:e=>({x:()=>(0,K.P)(e)})},ft={kernelName:N.r7,gradFunc:e=>({x:()=>(0,K.P)(e)})};var pt=n(20636);const gt={kernelName:N.J$,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{alpha:i}=n,a=(0,pt.p)(r,0);return{x:()=>(0,_e.a)(a,e,(0,T.d)(e,i))}}},mt={kernelName:N.kU,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,R.h)(e,(0,Z.I)(n,1))}}},yt={kernelName:N.Zb,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,R.h)(e,(0,$.p)(n,"float32"))}}},vt={kernelName:N.qC,inputsToSave:[],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{axis:i}=n;return{logits:()=>{const t=(0,Ke.Q)(r);return(0,j.l)(e,(0,T.d)((0,q.S)(e,i,!0),t))}}}},bt=(0,ue.op)({localResponseNormalizationBackprop_:function(e,t,n,r=5,i=1,a=1,s=.5){const o={x:e,y:t,dy:n},u={depthRadius:r,bias:i,alpha:a,beta:s};return ie.BV.runKernel(N.Hh,o,u)}}),xt={kernelName:N.eZ,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,i]=t,{depthRadius:a,bias:s,alpha:o,beta:u}=n;return{x:()=>bt(r,i,e,a,s,o,u)}}};var wt=n(26477);function kt(e,t,n,r){return t.rank<n.rank&&(t=(0,G.X)(t,Pe.rv(t.shape,r))),e.rank<n.rank&&(e=(0,G.X)(e,Pe.rv(e.shape,r))),{x:()=>(0,T.d)(e,(0,$.p)((0,wt.D)(n,t),e.dtype))}}const _t={kernelName:N.Yo,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{reductionIndices:i}=r,a=t[0],s=kt(e,t[1],a,se.EC(i,a.shape));return{x:()=>s.x()}}};var St=n(86573);const Ct={kernelName:N.BM,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>(0,T.d)(e,(0,$.p)((0,xe.b)(n,r),"float32")),b:()=>(0,T.d)(e,(0,$.p)((0,St.d)(n,r),"float32"))}}},At=(0,ue.op)({maxPool3dGrad_:function(e,t,n,r,i,a,s){const o=(0,ae._1)(e,"dy","maxPool3dGrad"),u=(0,ae._1)(t,"input","maxPool3dGrad"),l=(0,ae._1)(n,"output","maxPool3dGrad");let c=o,d=u,h=l,f=!1;4===u.rank&&(f=!0,c=(0,G.X)(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),d=(0,G.X)(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=(0,G.X)(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),se.hu(5===c.rank,(()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`)),se.hu(5===d.rank,(()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`)),se.hu(5===h.rank,(()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${h.rank}.`)),(0,oe.m)("maxPool3dGrad",a,s);const p={dy:c,input:d,output:h},g={filterSize:r,strides:i,pad:a,dimRoundingMode:s},m=ie.BV.runKernel(N.OU,p,g);return f?(0,G.X)(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}}),Et={kernelName:N.OA,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,i]=t,{filterSize:a,strides:s,pad:o,dimRoundingMode:u}=n;return{x:()=>At(e,r,i,a,s,o,u)}}},Ft=(0,ue.op)({maxPoolGrad_:function(e,t,n,r,i,a,s){const o=(0,ae._1)(e,"dy","maxPoolGrad"),u=(0,ae._1)(t,"input","maxPoolGrad"),l=(0,ae._1)(n,"output","maxPoolGrad");se.hu(u.rank===o.rank,(()=>`Rank of input (${u.rank}) does not match rank of dy (${o.rank})`)),se.hu(4===o.rank,(()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${o.rank}.`)),se.hu(4===u.rank,(()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`)),oe.m("maxPoolGrad",a,s);const c={dy:o,input:u,output:l},d={filterSize:r,strides:i,pad:a,dimRoundingMode:s};return ie.BV.runKernel(N.OV,c,d)}}),It={kernelName:N.mT,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,i]=t,{filterSize:a,strides:s,pad:o}=n;return{x:()=>Ft(e,r,i,a,s,o)}}};var Dt=n(44917);const Nt={kernelName:N.q2,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:i}=n,a=se.EC(i,r.shape),s=(0,Pe.kz)(r.shape,a)[1],o=se.NA(s);return{x:()=>{const t=r.shape.slice();a.forEach((e=>{t[e]=1}));const n=(0,G.X)(e,t);return(0,R.h)((0,T.d)(n,(0,Dt.i)(r.shape,"float32")),o)}}}},$t={kernelName:N.c1,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{axis:i}=r,[a,s]=t,o=kt(e,s,a,se.EC(i,a.shape));return{x:()=>o.x()}}},Tt={kernelName:N.q8,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>(0,T.d)(e,(0,$.p)((0,we.z)(n,r),"float32")),b:()=>(0,T.d)(e,(0,$.p)((0,pt.p)(n,r),"float32"))}}};var Ot=n(22676);const Mt={kernelName:N.jQ,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:i}=n,a=i.map((e=>e[0]));return{x:()=>(0,Ot.t)(e,a,r.shape)}}};var Rt=n(26943);const Bt={kernelName:N.Vb,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=(0,V.assertAndGetBroadcastShape)(n.shape,r.shape);return{a:()=>{const t=(0,V.getReductionAxes)(n.shape,i);return t.length>0?(0,G.X)((0,q.S)(e,t),n.shape):e},b:()=>{const t=(0,T.d)(e,(0,B.W)((0,Rt.G)((0,R.h)(n,r)))),a=(0,V.getReductionAxes)(r.shape,i);return a.length>0?(0,G.X)((0,q.S)(t,a),r.shape):t}}}},zt={kernelName:N.wY,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=(0,V.assertAndGetBroadcastShape)(n.shape,r.shape);return{a:()=>{const t=(0,T.d)(e,(0,$.p)(r,"float32")),a=(0,V.getReductionAxes)(n.shape,i);return a.length>0?(0,G.X)((0,q.S)(t,a),n.shape):t},b:()=>{const t=(0,T.d)(e,(0,$.p)(n,"float32")),a=(0,V.getReductionAxes)(r.shape,i);return a.length>0?(0,G.X)((0,q.S)(t,a),r.shape):t}}}},Lt={kernelName:N.ku,gradFunc:e=>({x:()=>(0,B.W)(e)})};var Pt=n(59640);const jt={kernelName:N.we,inputsToSave:["indices"],gradFunc:(e,t)=>{const n=t[0];return{indices:()=>(0,Pt.l)(n.shape,"float32")}}},Ut={kernelName:N.qW,gradFunc:e=>({x:()=>(0,K.P)(e)})};var Wt=n(24136);const Vt={kernelName:N.Qi,saveAllInputs:!0,gradFunc:(e,t,n)=>{const{axis:r}=n;return(0,Wt.H)(e,r).map((e=>()=>e))}},Gt={kernelName:N.ly,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:i}=n,a=i.map((e=>e[0]));return{x:()=>(0,Ot.t)(e,a,r.shape)}}};var qt=n(82597),Ht=n(33453);const Xt={kernelName:N.pe,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(e,t)=>{const[n,r,i]=t,a=n,s=r,o=V.assertAndGetBroadcastShape(a.shape,s.shape);return{a:()=>{const t=(0,$.p)(s,"float32");let n=(0,T.d)(e,(0,T.d)(t,(0,Ht.s)(a,(0,j.l)(t,(0,z.i)(1)))));const r=V.getReductionAxes(a.shape,o);return r.length>0&&(n=(0,q.S)(n,r)),(0,G.X)(n,a.shape)},b:()=>{const t=(0,pt.p)(a,0),n=(0,_e.a)(t,(0,qt.c)(a),(0,K.P)(a));let r=(0,T.d)(e,(0,T.d)(i,n));const u=V.getReductionAxes(s.shape,o);return u.length>0&&(r=(0,q.S)(r,u)),(0,G.X)(r,s.shape)}}}},Kt={kernelName:N.o0,inputsToSave:["x","alpha"],gradFunc:(e,t)=>{const[n,r]=t,i=(0,pt.p)(n,0);return{x:()=>(0,_e.a)(i,e,(0,T.d)(e,r)),alpha:()=>{let t=(0,_e.a)(i,(0,K.P)(e),(0,T.d)(e,n));const a=(0,V.getReductionAxes)(r.shape,e.shape);return a.length>0&&(t=(0,q.S)(t,a)),(0,G.X)(t,r.shape)}}}},Yt={kernelName:N.oH,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=V.assertAndGetBroadcastShape(n.shape,r.shape);return{a:()=>{const t=(0,R.h)(e,(0,$.p)(r,"float32")),a=V.getReductionAxes(n.shape,i);return a.length>0?(0,G.X)((0,q.S)(t,a),n.shape):t},b:()=>{let t=(0,T.d)(e,(0,$.p)(n,"float32"));const a=V.getReductionAxes(r.shape,i);a.length>0&&(t=(0,G.X)((0,q.S)(t,a),r.shape));const s=(0,P.h)(r);return(0,B.W)((0,R.h)(t,(0,$.p)(s,"float32")))}}}},Qt={kernelName:N.$H,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,R.h)(e,(0,B.W)((0,P.h)(n)))}}},Jt={kernelName:N.Sb,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=(0,T.d)((0,we.z)(n,6),(0,O.N)(n));return{x:()=>(0,T.d)(e,(0,$.p)(r,"float32"))}}},Zt={kernelName:N.qk,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,T.d)(e,(0,$.p)((0,O.N)(n),"float32"))}}},en={kernelName:N.HZ,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,G.X)(e,n.shape)}}},tn={kernelName:N._Y,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,i={dy:e,images:r};return{images:()=>ie.BV.runKernel(N.zb,i,n)}}},nn={kernelName:N.dp,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,i={dy:e,images:r};return{images:()=>ie.BV.runKernel(N.Hm,i,n)}}};var rn=n(57486);const an={kernelName:N.mK,gradFunc:(e,t,n)=>{const{dims:r}=n,i=(0,se.EC)(r,e.shape);return{x:()=>(0,rn.G)(e,i)}}},sn={kernelName:N.e0,gradFunc:e=>({x:()=>(0,K.P)(e)})},on={kernelName:N.bV,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,B.W)((0,R.h)(e,(0,T.d)((0,Ht.s)(n,1.5),2)))}}};var un=n(38651);const ln={kernelName:N.Ph,inputsToSave:["condition"],gradFunc:(e,t)=>{const[n]=t;return{condition:()=>(0,$.p)((0,K.P)(n),"float32"),t:()=>(0,T.d)(e,(0,$.p)(n,e.dtype)),e:()=>(0,T.d)(e,(0,$.p)((0,un.h)(n),e.dtype))}}};var cn=n(43179);const dn={kernelName:N.oF,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=(0,pt.p)(n,(0,z.i)(0)),r=(0,z.i)(cn.y),i=(0,z.i)(cn.$),a=(0,T.d)(e,i),s=(0,T.d)((0,T.d)(e,r),(0,Ke.Q)((0,$.p)(n,"float32")));return(0,_e.a)(t,a,s)}}}},hn={kernelName:N.a5,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,T.d)(e,(0,T.d)(n,(0,j.l)((0,z.i)(1),n)))}}},fn={kernelName:N.i5,gradFunc:e=>({x:()=>(0,K.P)(e)})};var pn=n(70173);const gn={kernelName:N.RQ,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,T.d)((0,pn.m)((0,$.p)(n,"float32")),e)}}};var mn=n(2699);const yn={kernelName:N.w3,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,T.d)((0,mn.f)((0,$.p)(n,"float32")),e)}}};var vn=n(39682),bn=n(37650);const xn={kernelName:N.p2,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{begin:i,size:a}=n,s=r.shape,[o,u]=(0,bn.parseSliceParams)(r,i,a),l=[];for(let t=0;t<e.rank;t++)l.push([o[t],s[t]-o[t]-u[t]]);return{x:()=>(0,vn.v)(e,l)}}},wn={kernelName:N.Gc,outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{dim:i}=n,a=(0,T.d)(e,r);return{logits:()=>(0,j.l)(a,(0,T.d)((0,q.S)(a,[i],!0),r))}}};var kn=n(30625);const _n={kernelName:N.MR,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,T.d)(e,(0,kn.X)(n))}}};var Sn=n(28441);const Cn={kernelName:N.TQ,gradFunc:(e,t,n)=>{const{blockShape:r,paddings:i}=n;return{x:()=>(0,Sn.E)(e,r,i)}}};var An=n(46884);const En={kernelName:N.L8,gradFunc:(e,t,n)=>{const{axis:r}=n;return{x:()=>(0,An.z)(e,r)}}},Fn={kernelName:N.FK,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,R.h)(e,(0,T.d)((0,L._)((0,$.p)(n,"float32")),2))}}},In={kernelName:N.bK,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,T.d)(e,(0,T.d)((0,$.p)(n,"float32"),2))}}},Dn={kernelName:N._t,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=(0,z.i)(2);return{a:()=>(0,T.d)(e,(0,T.d)(i,(0,j.l)(n,r))),b:()=>(0,T.d)(e,(0,T.d)(i,(0,j.l)(r,n)))}}},Nn={kernelName:N.h8,gradFunc:e=>({x:()=>(0,K.P)(e)})},$n={kernelName:N.Tr,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=V.assertAndGetBroadcastShape(n.shape,r.shape);return{a:()=>{let t=e;const r=V.getReductionAxes(n.shape,i);return r.length>0&&(t=(0,q.S)(t,r)),(0,G.X)(t,n.shape)},b:()=>{let t=e;const n=V.getReductionAxes(r.shape,i);return n.length>0&&(t=(0,q.S)(t,n)),(0,G.X)((0,B.W)(t),r.shape)}}}},Tn={kernelName:N.GB,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,i=r.shape.slice(),{axis:a}=n;(0,se.EC)(a,r.shape).forEach((e=>{i[e]=1}));const s=(0,G.X)(e,i),o=(0,T.d)(s,(0,Dt.i)(r.shape,"float32"));return{x:()=>o}}},On={kernelName:N.sE,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,R.h)(e,(0,P.h)((0,pn.m)(n)))}}},Mn={kernelName:N.MI,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>(0,T.d)((0,j.l)((0,z.i)(1),(0,P.h)(n)),e)}}},Rn={kernelName:N.n9,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{reps:i}=n;return{x:()=>{let t=(0,K.P)(r);if(1===r.rank)for(let n=0;n<i[0];++n)t=(0,Z.I)(t,(0,Ot.t)(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(let n=0;n<i[0];++n)for(let a=0;a<i[1];++a)t=(0,Z.I)(t,(0,Ot.t)(e,[n*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(let n=0;n<i[0];++n)for(let a=0;a<i[1];++a)for(let s=0;s<i[2];++s)t=(0,Z.I)(t,(0,Ot.t)(e,[n*r.shape[0],a*r.shape[1],s*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);for(let n=0;n<i[0];++n)for(let a=0;a<i[1];++a)for(let s=0;s<i[2];++s)for(let o=0;o<i[3];++o)t=(0,Z.I)(t,(0,Ot.t)(e,[n*r.shape[0],a*r.shape[1],s*r.shape[2],o*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},Bn={kernelName:N.G3,gradFunc:(e,t,n)=>{const r=n,{perm:i}=r,a=Pe.LJ(i);return{x:()=>(0,Ue.p)(e,a)}}};var zn=n(82991);const Ln={kernelName:N.To,gradFunc:(e,t,n)=>{const r=n,{axis:i}=r;return{value:()=>(0,zn.k)(e,i)}}};var Pn=n(81300),jn=n(24926),Un=n(80632);const Wn={kernelName:N.Qv,inputsToSave:["segmentIds"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>function(e,t){const n=(0,Un.g)(t,(0,K.P)(t)),r=(0,jn.I)(e,n);let i=(0,xe.b)(t,(0,z.i)(0,"int32"));const a=r.rank-i.rank;for(let e=0;e<a;++e)i=(0,Pn.d)(i,e+1);i=(0,ke.H)(i,(0,Dt.i)(r.shape,"bool"));const s=(0,K.P)(r);return(0,_e.a)(i,r,s)}(e,n)}}},Vn={kernelName:N.Ru,gradFunc:e=>({x:()=>(0,K.P)(e)})};var Gn=n(26151);const qn=[M,U,W,H,X,Y,Q,J,ee,te,ne,re,ce,he,pe,me,ye,ve,be,Se,Ce,Ee,$e,De,Me,Be,Le,We,qe,He,Yt,Xe,Ye,Qe,Je,Ze,tt,et,it,st,lt,ct,dt,ht,ft,gt,mt,yt,vt,xt,_t,_t,Ct,Et,It,Nt,$t,Tt,Mt,Bt,zt,Lt,jt,Ut,Vt,Gt,Gt,Xt,Kt,Qt,Jt,Zt,en,tn,nn,an,sn,on,ln,dn,hn,fn,gn,yn,xn,wn,_n,Cn,Cn,En,En,Fn,Dn,In,Nn,$n,Tn,On,Mn,Rn,Bn,Ln,Wn,Vn];for(const e of qn)(0,Gn.Li)(e);let Hn;function Xn(){return null==Hn&&(Hn=(0,D.backend)().epsilon()),Hn}n(6789);class Kn extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Kn.prototype)}}class Yn extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Yn.prototype)}}class Qn extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Qn.prototype)}}class Jn extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Jn.prototype)}}class Zn extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Zn.prototype)}}function er(e,t){if(Array.isArray(e)){let n=[];for(let r=0;r<t;r++)n=n.concat(e);return n}{const n=new Array(t);return n.fill(e),n}}function tr(e,t){if(!e)throw new Zn(t)}function nr(e,t){let n=0;for(const r of e)r===t&&n++;return n}function rr(e){return 1===e.length?e[0]:e}function ir(e){return Array.isArray(e)?e:[e]}function ar(e){const t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function sr(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,((e,t)=>t.toUpperCase()))}Error;let or={};function ur(e){if(null==e)return null;const t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function lr(e){if(null!=e&&"object"==typeof e)if(Array.isArray(e))e.forEach((e=>lr(e)));else{const t=Object.keys(e);for(const n of t){const t=e[n];null!=t&&"object"==typeof t&&(Array.isArray(t)||"ndarray"!==t.type||"number"!=typeof t.value?lr(t):e[n]=t.value)}}}function cr(e,t={},n={},r="object",i=!1){if("string"==typeof e){const i=e;let a;if(i in n)a=n[i];else if(i in or)a=or[i];else if(a=t[i],null==a)throw new Qn(`Unknown ${r}: ${e}. This may be due to one of the following reasons:\n1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return a}{const a=e;if(null==a.className||null==a.config)throw new Qn(`${r}: Improper config format: ${JSON.stringify(a)}.\n'className' and 'config' must set.`);const s=a.className;let o,u;if(s in n?[o,u]=n[s]:s in or?[o,u]=or.className:s in t&&([o,u]=t[s]),null==o)throw new Qn(`Unknown ${r}: ${s}. This may be due to one of the following reasons:\n1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(null!=u){const e={};for(const t of Object.keys(or))e[t]=or[t];for(const t of Object.keys(n))e[t]=n[t];a.config.customObjects=e;const t=Object.assign({},or);for(const e of Object.keys(n))or[e]=n[e];lr(a.config);const r=u(o,a.config,n,i);return or=Object.assign({},t),r}{const e=Object.assign({},or);for(const e of Object.keys(n))or[e]=n[e];const t=new o(a.config);return or=Object.assign({},e),t}}}function dr(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function hr(e){if(null==e)return e;const t=[];for(const n of e)-1===t.indexOf(n)&&t.push(n);return t}function fr(e){if(null==e)throw new Qn(`Invalid value in obj: ${JSON.stringify(e)}`);for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}function pr(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new Qn(`${n} is not a valid ${t}.  Valid values are ${e} or null/undefined.`)}function gr(e,t,n=0,r=1/0){return tr(n>=0),tr(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((e=>typeof e===t))}function mr(e,t){Array.isArray(e)?(D.util.assert(e.length>0,(()=>`${t} is unexpectedly an empty array.`)),e.forEach(((e,n)=>mr(e,`element ${n+1} of ${t}`)))):D.util.assert(Number.isInteger(e)&&e>0,(()=>`Expected ${t} to be a positive integer, but got ${yr(e)}.`))}function yr(e){return null===e?"null":Array.isArray(e)?"["+e.map((e=>yr(e))).join(",")+"]":"string"==typeof e?`"${e}"`:`${e}`}function vr(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}function br(e,t){return(0,D.tidy)((()=>D.sqrt(D.sum(D.mul(e,e),t,!0))))}class xr extends D.serialization.Serializable{getConfig(){return{}}}class wr extends xr{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return(0,D.tidy)((()=>{const t=br(e,this.axis),n=D.clipByValue(t,0,this.maxValue);return D.mul(e,D.div(n,D.add(Xn(),t)))}))}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}wr.className="MaxNorm",D.serialization.registerClass(wr);class kr extends xr{constructor(e){super(),this.defaultAxis=0,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return(0,D.tidy)((()=>D.div(e,D.add(Xn(),br(e,this.axis)))))}getConfig(){return{axis:this.axis}}}kr.className="UnitNorm",D.serialization.registerClass(kr);class _r extends xr{apply(e){return D.relu(e)}}_r.className="NonNeg",D.serialization.registerClass(_r);class Sr extends xr{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=null!=e.minValue?e.minValue:this.defaultMinValue,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.rate=null!=e.rate?e.rate:this.defaultRate,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return(0,D.tidy)((()=>{const t=br(e,this.axis),n=D.add(D.mul(this.rate,D.clipByValue(t,this.minValue,this.maxValue)),D.mul(1-this.rate,t));return D.mul(e,D.div(n,D.add(Xn(),t)))}))}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}Sr.className="MinMaxNorm",D.serialization.registerClass(Sr);const Cr={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Ar(e){return ur(e)}function Er(e,t={}){return cr(e,D.serialization.SerializationMap.getMap().classNameMap,t,"constraint")}function Fr(e){return null==e?null:"string"==typeof e?Er({className:e in Cr?Cr[e]:e,config:{}}):e instanceof xr?e:Er(e)}const Ir=["channelsFirst","channelsLast"],Dr=["nearest","bilinear"],Nr=["valid","same","causal"],$r=["max","avg"],Tr=["sum","mul","concat","ave"],Or=new Map;function Mr(e){pr(Ir,"DataFormat",e)}function Rr(e){pr(Nr,"PaddingMode",e)}function Br(e){pr($r,"PoolMode",e)}const zr=[];function Lr(e,t){zr.push(e);try{const e=t();return zr.pop(),e}catch(e){throw zr.pop(),e}}function Pr(e){if(!Wr(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===zr.length?"":zr.join("/")+"/")+e}function jr(e){if(!Wr(e))throw new Error("Not a valid tensor name: '"+e+"'");Or.has(e)||Or.set(e,0);const t=Or.get(e);if(Or.set(e,Or.get(e)+1),t>0){const n=`${e}_${t}`;return Or.set(n,1),n}return e}const Ur=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function Wr(e){return!!e.match(Ur)}function Vr(e,t,n){null==t&&(t=0),null==n&&(n=e.length);let r=1;for(let i=t;i<n;++i)r*=e[i];return r}function Gr(e){if(0===e.length)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let n=0;n<e.length;n++){const r=e[n];r<t&&(t=r)}return t}function qr(e){if(0===e.length)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const r=e[n];r>t&&(t=r)}return t}function Hr(e,t){if(t<e)throw new Qn(`end (${t}) < begin (${e}) is forbidden.`);const n=[];for(let r=e;r<t;++r)n.push(r);return n}function Xr(e,t){return D.cast(e,t)}function Kr(e,t=-1){const n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),D.reshape(e,n)}function Yr(e,t,n){return(0,D.tidy)((()=>{switch(e.rank){case 1:return D.slice1d(e,t,n);case 2:return D.slice2d(e,[t,0],[n,e.shape[1]]);case 3:return D.slice3d(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return D.slice4d(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return D.slice(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return D.slice(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new Qn(`sliceAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}}))}function Qr(e,t,n){return(0,D.tidy)((()=>{switch(e.rank){case 1:return D.slice1d(e,t,n);case 2:return D.slice2d(e,[0,t],[e.shape[0],n]);case 3:return D.slice3d(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return D.slice4d(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new Qn(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}}))}function Jr(e,t,n,r){return(0,D.tidy)((()=>{switch(e.rank){case 1:return D.slice1d(e,t,n);case 2:switch(r){case 1:return Yr(e,t,n);case 2:return Qr(e,t,n);default:throw new Qn(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return Yr(e,t,n);case 2:return D.slice3d(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return Qr(e,t,n);default:throw new Qn(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return Yr(e,t,n);case 2:return D.slice4d(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return D.slice4d(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return Qr(e,t,n);default:throw new Qn(`The axis is not within the rank of the tensor ${r}`)}default:throw new Qn(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}}))}function Zr(e,t=-1){let n;return t<0&&(n=e[0].rank,t=0!==n?n:0),t===e[0].rank&&(t=-1),D.concat(e,t)}function ei(e,t){switch(e.rank){case 1:return D.concat1d([e,t]);case 2:return D.concat2d([e,t],0);case 3:return D.concat3d([e,t],0);case 4:return D.concat4d([e,t],0);default:throw new Qn(`concatAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}}function ti(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new Qn(`The length of input n (${t.length}) does not match the number of dimensions in input x (${e.rank})`);return D.tile(e,t)}function ni(e,t=0,n=1,r,i){return D.randomNormal(e,t,n,r,i)}function ri(e,t,n,r){if(e.rank<2||t.rank<2)throw new Jn(`dot requires both inputs to be rank >= 2 but got x shape = ${e.shape} and y shape = ${t.shape}`);if(t.rank>=3&&e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new Jn(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${e.shape} and  y shape = ${t.shape}`);if(2===e.rank&&2===t.rank){const i=!1,a=!1;return D.fused.matMul({a:e,b:t,transposeA:i,transposeB:a,bias:r?si(e.rank,r,"channelsLast"):null,activation:n})}{const i=e.shape.slice(),a=i.pop();e=D.reshape(e,[-1,a]);const s=t.shape.slice(),o=s.pop(),u=s.pop(),l=[...s,o],c=Array.from({length:t.rank},((e,n)=>0===n?t.rank-2:n<=t.rank-2?n-1:n));t=D.reshape(D.transpose(t,c),[u,-1]);const d=[...i,...l],h=!1,f=!1;return D.reshape(D.fused.matMul({a:e,b:t,transposeA:h,transposeB:f,bias:r?si(e.rank,r,"channelsLast"):null,activation:n}),d)}}function ii(e,t,n){return(0,D.tidy)((()=>(t=Array.isArray(t)?(0,D.tensor1d)(t,"int32"):D.cast(t,"int32"),D.gather(e,t,n))))}function ai(e){return D.mul(e,e)}function si(e,t,n){const r=t.shape;if(1!==t.rank&&t.rank!==e)throw new Qn(`Unexpected bias dimensions: ${t.rank}; expected it to be 1 or ${e}`);if(5===e){if("channelsFirst"===n)return 1===r.length?D.reshape(t,[1,r[0],1,1,1]):D.reshape(t,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?D.reshape(t,[1,1,1,1,r[0]]):D.reshape(t,[1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?D.reshape(t,[1,r[0],1,1]):D.reshape(t,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?D.reshape(t,[1,1,1,r[0]]):D.reshape(t,[1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?D.reshape(t,[1,r[0],1]):D.reshape(t,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?D.reshape(t,[1,1,r[0]]):D.reshape(t,[1].concat(r))}else if(e<3)return t;throw new Qn(`Unsupported input rank by biasAdd: ${t.rank}`)}function oi(e,t,n){return(0,D.tidy)((()=>(null==n&&(n="channelsLast"),Mr(n),D.add(e,si(e.rank,t,n)))))}function ui(e,t,n,r){return(0,D.tidy)((()=>D.dropout(e,t,n,r)))}function li(e,t,n=!1){return n?e():t()}const ci=["fanIn","fanOut","fanAvg"],di=["normal","uniform","truncatedNormal"];class hi extends D.serialization.Serializable{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class fi extends hi{apply(e,t){return(0,D.zeros)(e,t)}}fi.className="Zeros",D.serialization.registerClass(fi);class pi extends hi{apply(e,t){return(0,D.ones)(e,t)}}pi.className="Ones",D.serialization.registerClass(pi);class gi extends hi{constructor(e){if(super(),"object"!=typeof e)throw new Qn(`Expected argument of type ConstantConfig but got ${e}`);if(void 0===e.value)throw new Qn(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return(0,D.tidy)((()=>(0,D.mul)((0,D.scalar)(this.value),(0,D.ones)(e,t))))}getConfig(){return{value:this.value}}}gi.className="Constant",D.serialization.registerClass(gi);class mi extends hi{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return(0,D.randomUniform)(e,this.minval,this.maxval,t)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}mi.className="RandomUniform",D.serialization.registerClass(mi);class yi extends hi{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new Jn(`randomNormal does not support dType ${t}.`);return ni(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}yi.className="RandomNormal",D.serialization.registerClass(yi);class vi extends hi{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new Jn(`truncatedNormal does not support dType ${t}.`);return(0,D.truncatedNormal)(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}vi.className="TruncatedNormal",D.serialization.registerClass(vi);class bi extends hi{constructor(e){super(),this.gain=null!=e.gain?e.gain:1}apply(e,t){return(0,D.tidy)((()=>{if(2!==e.length||e[0]!==e[1])throw new Qn("Identity matrix initializer can only be used for 2D square matrices.");return(0,D.mul)(this.gain,(0,D.eye)(e[0]))}))}getConfig(){return{gain:this.gain}}}bi.className="Identity",D.serialization.registerClass(bi);class xi extends hi{constructor(e){if(super(),e.scale<0)throw new Qn(`scale must be a positive float. Got: ${e.scale}`);var t;this.scale=null==e.scale?1:e.scale,this.mode=null==e.mode?"fanIn":e.mode,t=this.mode,pr(ci,"FanMode",t),this.distribution=null==e.distribution?"normal":e.distribution,function(e){pr(di,"Distribution",e)}(this.distribution),this.seed=e.seed}apply(e,t){const n=function(e,t="channelsLast"){let n,r;if(Mr(t),2===e.length)n=e[0],r=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===t){const t=Vr(e,2);n=e[1]*t,r=e[0]*t}else if("channelsLast"===t){const t=Vr(e,0,e.length-2);n=e[e.length-2]*t,r=e[e.length-1]*t}}else{const t=Vr(e);n=Math.sqrt(t),r=Math.sqrt(t)}return[n,r]}(e),r=n[0],i=n[1];let a=this.scale;if("fanIn"===this.mode?a/=Math.max(1,r):"fanOut"===this.mode?a/=Math.max(1,i):a/=Math.max(1,(r+i)/2),"normal"===this.distribution){const n=Math.sqrt(a);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new Jn(`${this.getClassName()} does not support dType ${t}.`);return(0,D.truncatedNormal)(e,0,n,t,this.seed)}{const n=Math.sqrt(3*a);return(0,D.randomUniform)(e,-n,n,t)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}xi.className="VarianceScaling",D.serialization.registerClass(xi);class wi extends xi{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return xi.className}}wi.className="GlorotUniform",D.serialization.registerClass(wi);class ki extends xi{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return xi.className}}ki.className="GlorotNormal",D.serialization.registerClass(ki);class _i extends xi{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return xi.className}}_i.className="HeNormal",D.serialization.registerClass(_i);class Si extends xi{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return xi.className}}Si.className="HeUniform",D.serialization.registerClass(Si);class Ci extends xi{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return xi.className}}Ci.className="LeCunNormal",D.serialization.registerClass(Ci);class Ai extends xi{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return xi.className}}Ai.className="LeCunNormal",D.serialization.registerClass(Ai);class Ei extends hi{constructor(e){if(super(),this.DEFAULT_GAIN=1,this.gain=null==e.gain?this.DEFAULT_GAIN:e.gain,this.seed=e.seed,null!=this.seed)throw new Jn("Random seed is not implemented for Orthogonal Initializer yet.")}apply(e,t){return(0,D.tidy)((()=>{if(e.length<2)throw new Jn("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${e[0]*e[1]}) elements: Slowness may result.`);const t=ni(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32");let n=D.linalg.gramSchmidt(t);return e[0]>e[1]&&(n=(0,D.transpose)(n)),(0,D.mul)(this.gain,n)}))}getConfig(){return{gain:this.gain,seed:this.seed}}}Ei.className="Orthogonal",D.serialization.registerClass(Ei);const Fi={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Ii(e,t={}){return cr(e,D.serialization.SerializationMap.getMap().classNameMap,t,"initializer")}function Di(e){return ur(e)}function Ni(e){if("string"==typeof e){const t=e in Fi?Fi[e]:e;if("GlorotNormal"===t)return new ki;if("GlorotUniform"===t)return new wi;if("HeNormal"===t)return new _i;if("HeUniform"===t)return new Si;if("LeCunNormal"===t)return new Ci;if("LeCunUniform"===t)return new Ai;{const e={};return e.className=t,e.config={},Ii(e)}}return e instanceof hi?e:Ii(e)}let $i=0;function Ti(){return $i++}const Oi={};function Mi(e=""){return e in Oi||(Oi[e]=0),Oi[e]+=1,e+Oi[e].toString()}function Ri(e){return Array.isArray(e)&&Array.isArray(e[0])}function Bi(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function zi(e){let t;if(Array.isArray(e)){if(1!==e.length)throw new Qn(`Expected Tensor length to be 1; got ${e.length}`);t=e[0]}else t=e;return t}function Li(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return(e=e)[0];throw new Qn(`Expected exactly 1 Shape; got ${e.length}`)}return e}function Pi(e){let t=0;for(const n of e)0===n.shape.length?t+=1:t+=n.shape.reduce(((e,t)=>e*t));return t}class ji{constructor(e,t="float32",n="Variable",r=!0,i=null){this.dtype=null==t?"float32":t,this.shape=e.shape,this.id=Ti(),n=null==n?"Variable":n,this.originalName=Pr(n),this.name=jr(this.originalName),this.trainable_=r,this.constraint=i,this.val=D.variable(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function Ui(e){return e.map((e=>e.read()))}function Wi(e){e.forEach((e=>{e[0].write(e[1])}))}class Vi{constructor(e){this.dtype=e.dtype,this.shape=e.shape,null!=e.shape?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Gi{constructor(e,t,n,r,i,a,s){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=r,this.callArgs=i,this.outputTensorIndex=s,this.id=Ti(),null!=a&&(this.originalName=Pr(a),this.name=jr(this.originalName)),this.rank=t.length}}let qi=0;class Hi{constructor(e,t){this.callArgs=t,this.id=qi++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const t of e.inboundLayers)null!=t&&t.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)null!=t?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let Xi=0;class Ki extends D.serialization.Serializable{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=Xi++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const e=this.getClassName();t=ar(e)+"_"+Mi(e)}if(this.name=t,this.trainable_=null==e.trainable||e.trainable,null!=e.inputShape||null!=e.batchInputShape){let t;if(null!=e.batchInputShape)t=e.batchInputShape;else if(null!=e.inputShape){let n=null;null!=e.batchSize&&(n=e.batchSize),t=[n].concat(e.inputShape)}this.batchInputShape=t;let n=e.dtype;null==n&&(n=e.inputDType),null==n&&(n="float32"),this.dtype=n}null!=e.weights?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(0===this.inboundNodes.length)throw new Yn(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new Qn(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return rr(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return rr(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Kn(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(0===this.inboundNodes.length)throw new Kn(`Layer ${this.name} is not connected, no input to return.`);return rr(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(0===this.inboundNodes.length)throw new Kn(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Kn(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return rr(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map((e=>e()))}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach((t=>t.trainable=e)),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter((e=>e.trainable)):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter((e=>!e.trainable)).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){if(e=ir(e),null==this.inputSpec||0===this.inputSpec.length)return;const t=ir(this.inputSpec);if(e.length!==t.length)throw new Qn(`Layer ${this.name} expects ${t.length} inputs, but it received ${e.length} input tensors. Input received: ${e}`);for(let n=0;n<e.length;n++){const r=e[n],i=t[n];if(null==i)continue;const a=r.rank;if(null!=i.ndim&&a!==i.ndim)throw new Qn(`Input ${n} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${a}`);if(null!=i.maxNDim&&a>i.maxNDim)throw new Qn(`Input ${n} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${a}`);if(null!=i.minNDim&&a<i.minNDim)throw new Qn(`Input ${n} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${a}.`);if(null!=i.dtype&&r.dtype!==i.dtype)throw new Qn(`Input ${n} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${r.dtype}.`);if(i.axes){const e=r.shape;for(const t in i.axes){const r=Number(t),a=i.axes[t],s=r>=0?e[r]:e[e.length+r];if(null!=a&&-1===[a,null].indexOf(s))throw new Qn(`Input ${n} is incompatible with layer ${this.name}: expected axis ${r} of input shape to have value ${a} but got shape ${e}.`)}}if(null!=i.shape)for(let e=0;e<i.shape.length;++e){const t=i.shape[e],a=r.shape[e];if(null!=t&&null!=a&&t!==a)throw new Qn(`Input ${n} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${r.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){null!=this._callHook&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const n=ir(e);let r=!0;for(const e of n)if(!(e instanceof Gi)){r=!1;break}let i=!0;for(const e of n)if(e instanceof Gi){i=!1;break}if(r===i)throw new Qn("Arguments to apply() must be all SymbolicTensors or all Tensors");return Lr(this.name,(()=>{if(!this.built){this.assertInputCompatibility(e);const t=[];for(const n of ir(e))t.push(n.shape);this.build(rr(t)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),null===this._refCount&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let r=this.call(e,t);const i=ir(r),a=[];for(let e of i)-1!==n.indexOf(e)&&(e=e.clone()),a.push(e);if(r=rr(a),null!=this.activityRegularizer)throw new Jn("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return r}{const n=function(e){e=ir(e);const t=[];for(const n of e)t.push(n.shape);return rr(t)}(e),r=this.computeOutputShape(n);let i;const a="float32";if(this.warnOnIncompatibleInputShape(Array.isArray(e)?n[0]:n),i=null!=r&&r.length>0&&Array.isArray(r[0])?r.map(((n,r)=>new Gi(a,n,this,ir(e),t,this.name,r))):new Gi(a,r,this,ir(e),t,this.name),this.addInboundNode(e,i,null,null,n,r,t),this._refCount++,null!=this.activityRegularizer)throw new Jn("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}}))}warnOnIncompatibleInputShape(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach(((n,r)=>{null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new Kn(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const n=JSON.stringify(t.outputShapes);-1===e.indexOf(n)&&e.push(n)}if(1===e.length){const e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&1===e.length?e[0]:e}throw new Kn(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Yn(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Pi(this.weights)}build(e){this.built=!0}getWeights(e=!1){return Ui(e?this.trainableWeights:this.weights)}setWeights(e){(0,D.tidy)((()=>{const t=this.weights;if(t.length!==e.length)throw new Qn(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(0===t.length)return;const n=[],r=Ui(t);for(let i=0;i<r.length;++i){const a=r[i],s=t[i],o=e[i];if(!D.util.arraysEqual(a.shape,o.shape))throw new Qn(`Layer weight shape ${a.shape} not compatible with provided weight shape ${o.shape}`);n.push([s,o])}Wi(n)}))}addWeight(e,t,n,r,i,a,s,o){if(-1!==this._addedWeightNames.indexOf(e))throw new Qn(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=o?o():Ni("zeros"));const u=r.apply(t,n),l=new ji(u,n,e,a,s);return u.dispose(),null!=i&&this.addLoss((()=>i.apply(l.read()))),null==a&&(a=!0),a?this._trainableWeights.push(l):this._nonTrainableWeights.push(l),l}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){null==e||Array.isArray(e)&&0===e.length||(e=ir(e),void 0!==this._losses&&null!==this._losses&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);t.forEach((e=>{if(null!=e)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)}))}return null}return t}addInboundNode(e,t,n,r,i,a,s=null){const o=ir(e);t=ir(t),n=ir(n),r=ir(r),i=Bi(i),a=Bi(a);const u=[],l=[],c=[];for(const e of o)u.push(e.sourceLayer),l.push(e.nodeIndex),c.push(e.tensorIndex);new Hi({outboundLayer:this,inboundLayers:u,nodeIndices:l,tensorIndices:c,inputTensors:o,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:i,outputShapes:a},s);for(let e=0;e<t.length;e++)t[e].sourceLayer=this,t[e].nodeIndex=this.inboundNodes.length-1,t[e].tensorIndex=e}getConfig(){const e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach((e=>e.dispose())),this.weights.length}assertNotDisposed(){if(0===this._refCount)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(null===this._refCount)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return 0==--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function Yi(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];{const e=t.inboundNodes[n];if(0===e.inboundLayers.length)return e.inputTensors;{const t=[];for(let n=0;n<e.inboundLayers.length;n++){const r=Yi(e.inputTensors[n],e.inboundLayers[n],e.nodeIndices[n]);for(const e of r)-1===t.indexOf(e)&&t.push(e)}return t}}}class Qi extends Ki{constructor(e){if(super({dtype:e.dtype,name:null!=e.name?e.name:Mi("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new Qn("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(null==t){if(null==e.inputShape)throw new Qn("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new Qn("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const n=e.dtype||"float32";this.batchInputShape=t,this.dtype=n,this.inputSpec=[{shape:t}];const r=new Gi(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new Hi({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new Qn(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}async function Ji(e){if(null==e)return;const t=[],n=[],r=[];for(const i in e){const a=e[i];if("number"!=typeof a){const e=a;t.push(e.data()),n.push(i),r.push(e)}}if(t.length>0){const i=await Promise.all(t);for(let t=0;t<i.length;++t)e[n[t]]=i[t][0];(0,D.dispose)(r)}}function Zi(e){if(null!=e)for(const t in e){const n=e[t];"number"!=typeof n&&n.dispose()}}var ea;Qi.className="InputLayer",D.serialization.registerClass(Qi),function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(ea||(ea={}));class ta{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class na{constructor(e,t=10){null==e&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochBegin(e,t)}async onEpochEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochEnd(e,t)}async onBatchBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchBegin(e,t)}async onBatchEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchEnd(e,t)}async onTrainBegin(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class ra extends ta{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){null==t&&(t={});const n=null==t.size?0:t.size;this.seen+=n;for(const e in t){const r=t[e];if("number"==typeof r)this.totals.hasOwnProperty(e)||(this.totals[e]=0),this.totals[e]=this.totals[e]+r*n;else{let t;e in this.totals?t=this.totals[e]:this.totals[e]=0;const i=(0,D.tidy)((()=>(0,D.add)(this.totals[e],(0,D.mul)(r,n))));this.totals[e]=i,null!=t&&t.dispose()}}}async onEpochEnd(e,t){if(null!=t)for(const e of this.params.metrics)null!=this.totals[e]&&("number"==typeof this.totals[e]?t[e]=this.totals[e]/this.seen:(0,D.tidy)((()=>{const n=(0,D.mul)((0,D.div)(1,this.seen),this.totals[e]);t[e]=n,this.totals[e].dispose(),(0,D.keep)(t[e])})))}}class ia extends ta{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){null==t&&(t={}),this.epoch.push(e);for(const e in t)null==this.history[e]&&(this.history[e]=[]),this.history[e].push(t[e])}async syncData(){const e=[],t=[],n=[];for(const r in this.history){const i=this.history[r];for(let a=0;a<i.length;++a)if("number"!=typeof i[a]){const s=i[a];e.push(s.data()),t.push(r),n.push(a)}}const r=await Promise.all(e);for(let e=0;e<r.length;++e)this.history[t[e]][n[e]].dispose(),this.history[t[e]][n[e]]=r[e][0]}}class aa extends ta{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||D.nextFrame,this.yieldEvery=t||"auto","auto"===this.yieldEvery&&(this.yieldEvery=125),"never"===this.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");D.util.isNumber(this.yieldEvery)&&(this.maybeWait=function(e,t,n){let r,i=null!=n?n():D.util.now();return(...a)=>{const s=null!=n?n():D.util.now();return s-i<t||(i=s,r=e(...a)),r}}(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,n){const r=[];null!=this.yield&&(await Ji(n),r.push(this.yield(e,t,n))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,null!=this.epochBegin&&(await Ji(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const n=[];null!=this.epochEnd&&(await Ji(t),n.push(this.epochEnd(e,t))),"epoch"===this.yieldEvery&&n.push(this.nextFrameFunc()),await Promise.all(n)}async onBatchBegin(e,t){null!=this.batchBegin&&(await Ji(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const n=[];null!=this.batchEnd&&(await Ji(t),n.push(this.batchEnd(e,t))),"batch"===this.yieldEvery?n.push(this.nextFrameFunc()):D.util.isNumber(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(n)}async onTrainBegin(e){null!=this.trainBegin&&(await Ji(e),await this.trainBegin(e))}async onTrainEnd(e){null!=this.trainEnd&&(await Ji(e),await this.trainEnd(e))}}function sa(e,t){return null==e&&(e={}),e instanceof ta?[e]:Array.isArray(e)&&e[0]instanceof ta?e:ir(e).map((e=>new aa(e,t)))}class oa{constructor(){}static registerCallbackConstructor(e,t){D.util.assert(e>=0&&Number.isInteger(e),(()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`)),oa.checkForDuplicate(t),null==oa.constructors[e]&&(oa.constructors[e]=[]),oa.constructors[e].push(t)}static checkForDuplicate(e){for(const t in oa.constructors)oa.constructors[+t].forEach((t=>{if(t===e)throw new Qn("Duplicate callback constructor.")}))}static clear(){oa.constructors={}}static createCallbacks(e){const t=[];for(const n in oa.constructors){const r=+n;e>=r&&t.push(...oa.constructors[r])}return t.map((e=>new e))}}function ua(e,t,n,r,i,a,s,o,u){const l=new ia,c=[new ra,...oa.createCallbacks(t)];null!=e&&c.push(...e),c.push(l);const d=new na(c);return d.setParams({epochs:n,initialEpoch:r,samples:i,steps:a,batchSize:s,verbose:t,doValidation:o,metrics:u}),{callbackList:d,history:l}}function la(e,t={},n=!1){return cr(e,D.serialization.SerializationMap.getMap().classNameMap,t,"layer",n)}function ca(e,t){return(0,D.tidy)((()=>{"float32"!==e.dtype&&(e=D.cast(e,"float32"));const n=D.sum(ai(e),t,!0),r=D.fill(n.shape,Xn()),i=D.sqrt(D.maximum(n,r));return D.div(e,i)}))}function da(e,t){return(0,D.tidy)((()=>D.mean(ai(D.sub(t,e)),-1)))}function ha(e,t){return(0,D.tidy)((()=>D.mean(D.abs(D.sub(t,e)),-1)))}function fa(e,t){return(0,D.tidy)((()=>{const n=D.sub(e,t),r=D.clipByValue(D.abs(e),Xn(),Number.MAX_VALUE),i=D.abs(D.div(n,r));return D.mul(100,D.mean(i,-1))}))}function pa(e,t,n=!1){return(0,D.tidy)((()=>{if(n)t=D.softmax(t);else{const e=D.sum(t,t.shape.length-1,!0);t=D.div(t,e)}return t=D.clipByValue(t,Xn(),1-Xn()),D.neg(D.sum(D.mul(D.cast(e,"float32"),D.log(t)),t.shape.length-1))}))}function ga(e,t,n=!1){return(0,D.tidy)((()=>{const r=D.cast(D.floor(function(e){const t=[Vr(e.shape)];return D.reshape(e,t)}(e)),"int32"),i=(t=D.clipByValue(t,Xn(),1-Xn())).shape;return pa(D.reshape(D.oneHot(r,i[i.length-1]),i),t,n)}))}function ma(e,t){return(0,D.tidy)((()=>{let n;return n=D.clipByValue(t,Xn(),1-Xn()),n=D.log(D.div(n,D.sub(1,n))),D.mean(function(e,t){if(!D.util.arraysEqual(e.shape,t.shape))throw new Qn(`logits and labels must have the same shape, but got shapes ${JSON.stringify(e.shape)} and ${JSON.stringify(t.shape)}`);return(0,D.tidy)((()=>{const n=D.relu(t),r=D.neg(D.abs(t));return D.add(D.sub(n,D.mul(t,e)),D.log1p(D.exp(r)))}))}(e,n),-1)}))}function ya(e,t){return(0,D.tidy)((()=>{const n=ca(e,-1),r=ca(t,-1),i=D.mul(n,r);return D.neg(D.sum(i,-1))}))}oa.constructors={};const va={meanSquaredError:da,meanAbsoluteError:ha,meanAbsolutePercentageError:fa,meanSquaredLogarithmicError:function(e,t){return(0,D.tidy)((()=>{const n=D.clipByValue(t,Xn(),Number.MAX_VALUE),r=D.log(D.add(1,n)),i=D.clipByValue(e,Xn(),Number.MAX_VALUE),a=D.log(D.add(1,i));return D.mean(ai(D.sub(r,a)),-1)}))},squaredHinge:function(e,t){return(0,D.tidy)((()=>{const n=D.maximum(0,D.sub(1,D.mul(e,t)));return D.mean(ai(n),-1)}))},hinge:function(e,t){return(0,D.tidy)((()=>{const n=D.maximum(0,D.sub(1,D.mul(e,t)));return D.mean(n,-1)}))},categoricalHinge:function(e,t){return(0,D.tidy)((()=>{const n=D.sum(D.mul(e,t),-1),r=D.max(D.mul(D.sub(1,e),t),-1);return D.maximum(0,D.add(1,D.sub(r,n)))}))},logcosh:function(e,t){return(0,D.tidy)((()=>{const n=Math.log(2),r=D.sub(t,e),i=D.sub(D.add(r,D.softplus(D.mul(-2,r))),n);return D.mean(i,-1)}))},categoricalCrossentropy:pa,sparseCategoricalCrossentropy:ga,binaryCrossentropy:ma,kullbackLeiblerDivergence:function(e,t){return(0,D.tidy)((()=>{const n=D.clipByValue(e,Xn(),1),r=D.clipByValue(t,Xn(),1);return D.sum(D.mul(e,D.log(D.div(n,r))),-1)}))},poisson:function(e,t){return(0,D.tidy)((()=>{const n=D.log(D.add(Xn(),t));return D.mean(D.sub(t,D.mul(e,n)),-1)}))},cosineProximity:ya};function ba(e){if("string"==typeof e){if(e in va)return va[e];let t=`Unknown loss ${e}`;throw e.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${e}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new Qn(t)}return e}function xa(e,t){return(0,D.tidy)((()=>{const n=D.mul(.5,D.onesLike(t)),r=Xr(D.greater(t,n),e.dtype);return D.mean(D.equal(e,r),-1)}))}function wa(e,t){return(0,D.tidy)((()=>Xr(D.equal(D.argMax(e,-1),D.argMax(t,-1)),"float32")))}function ka(e,t){return ma(e,t)}function _a(e,t){return e.rank===t.rank&&(e=D.squeeze(e,[e.rank-1])),(t=D.argMax(t,-1)).dtype!==e.dtype&&(t=D.cast(t,e.dtype)),D.cast(D.equal(e,t),"float32")}const Sa=pa,Ca=ga,Aa={binaryAccuracy:xa,categoricalAccuracy:wa,precision:function(e,t){return(0,D.tidy)((()=>{const n=function(e,t){return(0,D.tidy)((()=>D.cast(D.sum(D.logicalAnd(D.equal(e,1),D.equal(t,1))),"float32")))}(e,t),r=function(e,t){return(0,D.tidy)((()=>D.cast(D.sum(D.logicalAnd(D.equal(e,0),D.equal(t,1))),"float32")))}(e,t),i=D.add(n,r);return D.cast(D.where(D.greater(i,0),D.div(n,i),0),"float32")}))},categoricalCrossentropy:Sa,sparseCategoricalCrossentropy:Ca,mse:da,MSE:da,mae:ha,MAE:ha,mape:fa,MAPE:fa,cosine:ya};function Ea(e){if("string"==typeof e&&e in Aa)return Aa[e];if("string"!=typeof e&&null!=e)return e;throw new Qn(`Unknown metric ${e}`)}function Fa(e){if(tr(null!==e,`Unknown LossOrMetricFn ${e}`),"string"==typeof e)return e;{let t;for(const n of Object.keys(va))if(va[n]===e){t=n;break}if(void 0!==t)return t;for(const n of Object.keys(Aa))if(Aa[n]===e){t=n;break}return void 0!==t?t:e.name}}function Ia(e,t,n=!1){if(null==e||"object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype||!Da(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const n=JSON.stringify(e);n.length>1048576&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${n.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function Da(e){if(null===e)return!0;if("object"==typeof e){if(Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);for(const n of t){if("string"!=typeof n)return!1;if(!Da(e[n]))return!1}return!0}if(Array.isArray(e)){for(const t of e)if(!Da(t))return!1;return!0}return!1}{const t=typeof e;return"string"===t||"number"===t||"boolean"===t}}function Na(e,t,n=console.log){let r="";for(let n=0;n<e.length;++n)n>0&&(r=r.slice(0,r.length-1)+" "),r+=e[n],r=r.slice(0,t[n]),r+=" ".repeat(t[n]-r.length);n(r)}function $a(e,t,n){let r,i;try{i=e.inboundNodes.map((e=>JSON.stringify(e.inputShapes))).join(",")}catch(e){i="multiple"}try{r=JSON.stringify(e.outputShape)}catch(e){r="multiple"}Na([`${e.name} (${e.getClassName()})`,i,r,e.countParams().toString()],t,n)}function Ta(e,t,n,r){let i,a;try{a=e.inboundNodes.map((e=>JSON.stringify(e.inputShapes))).join(",")}catch(e){a="multiple"}try{i=JSON.stringify(e.outputShape)}catch(e){i="multiple"}const s=[];for(const t of e.inboundNodes)if(!(null!=n&&n.length>0&&-1===n.indexOf(t)))for(let e=0;e<t.inboundLayers.length;++e){const n=t.inboundLayers[e].name,r=t.nodeIndices[e],i=t.tensorIndices[e];s.push(`${n}[${r}][${i}]`)}const o=e.name,u=e.getClassName(),l=0===s.length?"":s[0];Na([`${o} (${u})`,a,i,e.countParams().toString(),l],t,r);for(let e=1;e<s.length;++e)Na(["","","","",s[e]],t,r)}function Oa(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}function Ma(e,t){if(null===e)return null;if("string"==typeof e)return sr(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){const n=[],r=e.length;for(let i=0;i<r;++i){const r=e[i];Oa(t,i,r)?n.push(r):n.push(Ma(r,t))}return n}{const t={};for(const n of Object.keys(e)){const r=e[n];if("name"===n&&"string"==typeof r)t[n]=r;else{const e=sr(n);t[e]=Ma(r,e)}}return t}}function Ra(e,t){if(null==e)return null;if("string"==typeof e)return ar(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){const n=[],r=e.length;for(let i=0;i<r;++i){const r=e[i];Oa(t,i,r)?n.push(r):n.push(Ra(r,t))}return n}{const t={};for(const n of Object.keys(e)){const r=e[n];t[ar(n)]="name"!==n&&"className"!==n||"string"!=typeof r?Ra(r,n):r}return t}}class Ba{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof Ba)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(null==e)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,n){if(null!=this.id2Value[e.id])throw new Qn(`Duplicate key: name=${e.name}, id=${e.id}`);return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return(0,D.cast)(t,e.dtype)}catch(n){throw new Qn(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${e.name}' (${e.dtype}).`)}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return null!=this.id2Value[e.id]}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Gi){if(null==this.id2Value[e.id])throw new Qn(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}{const t=this.name2Id[e];if(null==t)throw new Qn(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof Gi){if(null==this.id2Value[e.id])throw new Qn(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}{const t=this.name2Id[e];if(null==t)throw new Qn(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){null!=this.id2Mask&&(0,D.dispose)(this.id2Mask)}}const za={},La={};function Pa(e,t,n,r){const i=null!=n&&n.training,a=Array.isArray(e),s=a?e:[e],o=s.map((e=>e.name)),u=[],l=t.names();for(const e of o)-1!==l.indexOf(e)?u.push(t.getValue(e)):u.push(null);null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);const c=o.join(",")+"|"+t.names().join(",");let d,h;if(null==za[c]){const e=function(e,t){D.util.assert(null!=e&&e.length>0,(()=>"Expected at least one fetch, got none"));let n=[],r={};if(1===e.length){const i=Ua(e[0],t);n=i.sorted,r=i.recipientMap}else{const i=new Set;for(const a of e){const{sorted:e,recipientMap:s}=Ua(a,t);for(const t of e)i.has(t.name)||(n.push(t),i.add(t.name));for(const e in s)null==r[e]&&(r[e]=new Set),s[e].forEach((t=>r[e].add(t)))}}return{sorted:n,recipientCounts:ja(r)}}(s,t);d=e.sorted,h=e.recipientCounts,za[c]=d,La[c]=h}d=za[c],h={},i||Object.assign(h,La[c]);const f=new Ba(t);for(let e=0;e<d.length;++e){if(null!=r){const e=(0,D.memory)().numTensors;e>r.maxNumTensors&&(r.maxNumTensors=e),e<r.minNumTensors&&(r.minNumTensors=e)}const a=d[e],s=a.sourceLayer;if(s instanceof Qi)continue;const l=[],c=[],p=[];let g=!1;for(const e of a.inputs){const n=f.getValue(e),r=f.getMask(e);l.push(n),c.push(r),null!=r&&(g=!0),i||(h[e.name]--,0!==h[e.name]||t.hasKey(e)||-1!==o.indexOf(e.name)||n.isDisposed||!0===e.sourceLayer.stateful||p.push(n))}g&&((n=n||{}).mask=c[0]);const m=ir(s.apply(l,n));let y=null;s.supportsMasking&&(y=s.computeMask(l,c));const v=Wa(a),b=Array.isArray(v)?v:[v];for(let e=0;e<b.length;++e){f.hasKey(b[e])||f.add(b[e],m[e],Array.isArray(y)?y[0]:y);const t=o.indexOf(b[e].name);-1!==t&&(u[t]=m[e])}i||(0,D.dispose)(p)}return f.disposeMasks(),a?u:u[0]}function ja(e){const t={};for(const n in e)t[n]=e[n].size;return t}function Ua(e,t){const n=new Set,r=[],i={};for(const e of t.names())n.add(e);const a=[],s=[];for(a.push(e);a.length>0;){const e=a[a.length-1];if(n.has(e.name)){a.pop();continue}const t=s[s.length-1]===a.length-1;if(0===e.inputs.length||t)a.pop(),r.push(e),n.add(e.name),t&&s.pop();else{s.push(a.length-1);for(const t of e.inputs)null==i[t.name]&&(i[t.name]=new Set),i[t.name].add(e.name),n.has(t.name)||a.push(t)}}return{sorted:r,recipientMap:i}}function Wa(e){let t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{let n=null;for(let t=0;t<e.sourceLayer.inboundNodes.length;++t)for(const r of e.sourceLayer.inboundNodes[t].outputTensors)if(r.id===e.id){n=t;break}t=e.sourceLayer.getOutputAt(n)}return t}class Va extends Ki{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,null==this.name){const e=this.getClassName().toLowerCase();this.name=Mi(e)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],hr(this.inputs).length!==this.inputs.length)throw new Qn(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map((e=>e.name))}`);hr(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map((e=>e.name))}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const e of this.outputs){const t=e.sourceLayer,n=e.nodeIndex,r=e.tensorIndex;this.outputLayers.push(t),this.outputLayersNodeIndices.push(n),this.outputLayersTensorIndices.push(r)}for(const e of this.inputs){const t=e.sourceLayer,n=e.nodeIndex,r=e.tensorIndex;tr(0===n,"input layer has >1 nodes"),tr(0===r,"input layer has >1 tensors"),this.inputLayers.push(t),this.inputLayersNodeIndices.push(n),this.inputLayersTensorIndices.push(r)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let t=0;t<this.inputLayers.length;t++){const n=this.inputLayers[t];if(!(n instanceof Qi))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${t} (0-based) originates from layer type ${n.getClassName()}.`);this.inputNames.push(n.name),this.feedInputShapes.push(n.batchInputShape),this.feedInputNames.push(n.name)}for(const e of this.outputLayers)this.outputNames.push(e.name);this.internalInputShapes=this.inputs.map((e=>e.shape)),this.internalOutputShapes=this.outputs.map((e=>e.shape));const t={},n={},r={},i={},a={},s=[],o=(e,t,n,r,i,u)=>{null!=r&&null!=i&&null!=u||(r=e.sourceLayer,i=e.nodeIndex,u=e.tensorIndex);const l=r.inboundNodes[i];if(-1!==n.indexOf(l))throw new Yn(`The tensor ${e.name} at layer "${r.name}" is part of a cycle.`);if(-1!==t.indexOf(l))return;this.containerNodes.add(Va.nodeKey(r,i)),r.id in a||(a[r.id]=Object.keys(a).length),-1===n.indexOf(l)&&n.push(l);const c=l.inboundLayers.length;for(let e=0;e<c;e++){const r=l.inputTensors[e],i=l.inboundLayers[e],a=l.nodeIndices[e],s=l.tensorIndices[e];o(r,t,n,i,a,s)}for(t.push(l);n.indexOf(l)>=0;)n.splice(n.indexOf(l),1);s.push(l)},u=[],l=[];for(const e of this.outputs)o(e,u,l);const c=s.slice().reverse();for(const e of c){n[e.id]=e,e.id in t||(t[e.id]=0);let a=t[e.id];const s=null==r[e.outboundLayer.id]?0:r[e.outboundLayer.id];a=Math.max(a,s),r[e.outboundLayer.id]=a,i[e.outboundLayer.id]=e.outboundLayer,t[e.id]=a;for(let r=0;r<e.inboundLayers.length;r++){const i=e.inboundLayers[r],s=e.nodeIndices[r],o=i.inboundNodes[s],u=null==t[o.id]?0:t[o.id];t[o.id]=Math.max(a+1,u),n[o.id]=o}}const d={};for(const e in t){const r=t[e];r in d||(d[r]=[]),d[r].push(n[e])}const h={};for(const e in r){const t=r[e];t in h||(h[t]=[]),h[t].push(i[e])}let f=Object.keys(h).map((e=>parseInt(e,10))).sort(dr);this.layers=[];for(const e of f){const t=h[e];t.sort(((e,t)=>{const n=a[e.id],r=a[t.id];return n<r?-1:n>r?1:0}));for(const e of t)e instanceof Va&&this.internalContainerRefs.push(e),this.layers.push(e)}this.layersByDepth=h,f=Object.keys(d).map((e=>parseInt(e,10))).sort(dr);const p=this.inputs.slice(),g=[];for(const e of f)for(const t of d[e]){const e=t.outboundLayer;if(null!=e){for(const n of t.inputTensors)if(-1===p.indexOf(n))throw new Yn(`Graph disconnected: cannot obtain value for tensor ${n} at layer "${e.name}". The following previous layers were accessed without issue: ${g}`);for(const e of t.outputTensors)p.push(e);g.push(e.name)}}this.nodesByDepth=d;const m=this.layers.map((e=>e.name));for(const e of m){const t=m.filter((t=>t===e)).length;if(1!==t)throw new Yn(`The name "${e}" is used ${t} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(m))}this.outboundNodes=[],this.inboundNodes=[],new Hi({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map((e=>null)),outputMasks:this.outputs.map((e=>null)),inputShapes:this.inputs.map((e=>e.shape)),outputShapes:this.outputs.map((e=>e.shape))}),this.built=!0,this._refCount=1}assertNotDisposed(){if(0===this._refCount)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach((t=>{t._trainableWeights.forEach((t=>t.trainable=e))})),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new Qn("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.layers)t.push(...e.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const n={};let r=0;for(const e of this.layers)for(const t of e.weights){if(null!=n[t.originalName])throw new Qn(`Duplicate weight name: ${t.originalName}`);n[t.originalName]=t,r++}const i=[];for(const r in e){let a=r;if(null==n[r]){const e=r.split("/");a=e.slice(0,-2).concat([e[e.length-1]]).join("/")}if(null!=n[a])i.push([n[a],e[r]]);else if(t)throw new Qn(`Provided weight data has no target variable: ${r}`);delete n[a]}if(t){const e=[];for(const t in n)e.push(t);if(e.length>0)throw new Qn(`${e.length} of ${r} weights are not set: ${e}`)}Wi(i)}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers 3.15.0",t.backend="TensorFlow.js",t}toJSON(e,t=!0){const n=Ra(this.updatedConfig());return t?JSON.stringify(n):n}call(e,t){return(0,D.tidy)((()=>{e=ir(e);const n=new Ba;for(let t=0;t<this.inputs.length;++t)n.add(this.inputs[t],e[t]);return Pa(this.outputs,n,t)}))}computeMask(e,t){return(0,D.tidy)((()=>{let n;return e=ir(e),n=null==t?er(null,e.length):ir(t),this.runInternalGraph(e,n)[1]}))}computeOutputShape(e){const t=Bi(e);if(t.length!==this.inputLayers.length)throw new Qn(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const n={};for(let e=0;e<t.length;e++){const r=this.inputLayers[e],i=t[e];n[r.name+"_0_0"]=i}const r=Object.keys(this.nodesByDepth).map((e=>parseInt(e,10))).sort(dr);if(r.length>1)for(const e of r){const t=this.nodesByDepth[e];for(const e of t){const t=e.outboundLayer;if(-1!==this.inputLayers.map((e=>e.id)).indexOf(t.id))continue;const r=[];for(let t=0;t<e.inboundLayers.length;t++){const i=e.inboundLayers[t],a=e.nodeIndices[t],s=e.tensorIndices[t],o=n[`${i.name}_${a}_${s}`];r.push(o)}const i=Bi(t.computeOutputShape(rr(r))),a=t.inboundNodes.indexOf(e);for(let e=0;e<i.length;e++)n[`${t.name}_${a}_${e}`]=i[e]}}const i=[],a=[];for(let e=0;e<this.outputLayers.length;e++){const t=this.outputLayers[e],n=this.outputLayersNodeIndices[e],r=this.outputLayersTensorIndices[e],i=`${t.name}_${n}_${r}`;a.push(i)}for(let e=0;e<a.length;e++){const t=a[e];tr(t in n),i.push(n[t])}return rr(i)}runInternalGraph(e,t){null==t&&(t=er(null,e.length));const n={};for(let r=0;r<this.inputs.length;++r){const i=this.inputs[r],a=e[r],s=t[r];n[i.id]=[a,s]}const r=Object.keys(this.nodesByDepth).map((e=>parseInt(e,10))).sort(dr);for(const e of r){const t=this.nodesByDepth[e];for(const e of t){const t=e.outboundLayer,r=e.inputTensors,i=e.outputTensors,a=new Array;for(const e of r)e.id in n&&a.push(n[e.id]);if(a.length===r.length){let r,s,o,u,l={};if(null!=e.callArgs&&(l=e.callArgs),1===a.length){const[e,n]=a[0];null==l.mask&&(l.mask=n),o=ir(t.call(e,l)),u=ir(t.computeMask(e,n)),r=[e],s=[n]}else r=a.map((e=>e[0])),s=a.map((e=>e[1])),null==l.mask&&(l.mask=s),o=ir(t.call(r,l)),u=ir(t.computeMask(r,s));if(t.activityRegularizer)throw new Jn("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let e=0;e<i.length;++e){const t=i[e],r=o[e],a=u[e];n[t.id]=[r,a]}}}}const i=[],a=[],s=[];for(const e of this.outputs){tr(e.id in n,`Could not compute output ${e.name} : ${e.id}`);const[t,r]=n[e.id];s.push(t.shape),i.push(t),a.push(r)}return[i,a,s]}buildNodeConversionMap(e){const t={};let n;for(const e of this.layers){n=e instanceof Va?1:0;for(let r=0;r<e.inboundNodes.length;r++){const i=Va.nodeKey(e,r);this.containerNodes.has(i)&&(t[i]=n,n+=1)}}return t}getLayer(e,t){if(null!=t){if(this.layers.length<=t)throw new Qn(`Was asked to retrieve layer at index ${t}, but model only has ${this.layers.length} layer(s).`);return this.layers[t]}if(null==e)throw new Qn("Provide either a layer name or layer index");for(const t of this.layers)if(t.name===e)return t;throw new Qn(`No such layer: ${e}`)}calculateLosses(){return(0,D.tidy)((()=>{const e=[];for(const t of this.layers)for(let n=0;n<t.inboundNodes.length;++n){const r=Va.nodeKey(t,n);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e}))}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),n=[];for(const e of this.layers){const r=e.getClassName(),i=e.getConfig(),a=[];for(let n=0;n<e.inboundNodes.length;n++){const r=e.inboundNodes[n],i=Va.nodeKey(e,n);let s={};if(this.containerNodes.has(i)){if(r.callArgs)try{JSON.stringify(r.callArgs),s=r.callArgs}catch(t){console.warn(`Layer ${e.name} was passed non-serializable keyword arguments: ${r.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),s={}}if(r.inboundLayers.length>0){const e=[];for(let n=0;n<r.inboundLayers.length;n++){const i=r.inboundLayers[n],a=r.nodeIndices[n],o=r.tensorIndices[n];let u=t[Va.nodeKey(i,a)];null==u&&(u=0),e.push([i.name,u,o,s])}a.push(e)}}}const s={};s.name=e.name,s.className=r,s.config=i,s.inboundNodes=a,n.push(s)}e.layers=n;const r=[];for(let e=0;e<this.inputLayers.length;e++){const n=this.inputLayers[e],i=this.inputLayersNodeIndices[e],a=Va.nodeKey(n,i);if(!this.containerNodes.has(a))continue;let s=t[a];null==s&&(s=0);const o=this.inputLayersTensorIndices[e];r.push([n.name,s,o])}e.inputLayers=r;const i=[];for(let e=0;e<this.outputLayers.length;e++){const n=this.outputLayers[e],r=this.outputLayersNodeIndices[e],a=Va.nodeKey(n,r);if(!this.containerNodes.has(a))continue;let s=t[a];null==s&&(s=0);const o=this.outputLayersTensorIndices[e];i.push([n.name,s,o])}return e.outputLayers=i,e}static fromConfig(e,t,n={},r=!1){const i={},a={};function s(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function o(e,t){const n=[];let r;for(const a of t){const o=a[0],u=a[1],l=a[2];if(r=null==a[3]?{}:a[3],!(o in i))return void s(e,t);const c=i[o];if(c.inboundNodes.length<=u)return void s(e,t);const d=c.inboundNodes[u];n.push(d.outputTensors[l])}n.length>0&&e.apply(rr(n),r)}function u(e){const n=e.name,a=la(e,null!=t.customObjects?t.customObjects:{});a.setFastWeightInitDuringBuild(r),i[n]=a,e.inboundNodes.forEach((e=>{if(!(e instanceof Array))throw new Qn(`Corrupted configuration, expected array for nodeData: ${e}`);s(a,e)}))}const l=t.name,c=t.layers;for(const e of c)u(e);for(;!fr(a);)for(const e of c){const t=i[e.name];if(t.name in a){const e=a[t.name];delete a[t.name];for(const n of e)o(t,n)}}const d=[],h=[],f=t.inputLayers;for(const e of f){const t=e[0],n=e[1],r=e[2];tr(t in i);const a=i[t].inboundNodes[n].outputTensors;d.push(a[r])}const p=t.outputLayers;for(const e of p){const t=e[0],n=e[1],r=e[2];tr(t in i);const a=i[t].inboundNodes[n].outputTensors;h.push(a[r])}return new e({inputs:d,outputs:h,name:l})}get stateful(){if(this._stateful)throw new Qn("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){(0,D.tidy)((()=>{this.layers.forEach((e=>{e.stateful&&e.resetStates()}))}))}}function Ga(e,t){return function(e,t,n){const r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((e=>null));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"==typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error(`Provided ${n} is an array of ${e.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return e}if("object"==typeof e&&Object.keys(e).length>0&&"object"==typeof e[Object.keys(e)[0]]){const n=[];return t.forEach((t=>{t in e?n.push(e[t]):n.push(null)})),n}throw new Error(`The model has multiple (${r}) outputs, so ${n} must be either an array with ${r} elements or an object with ${t} keys. Provided ${n} not understood: ${JSON.stringify(e)}`)}(e,t,"classWeight")}async function qa(e,t,n,r){if(null!=t||null!=r)throw new Error("Support sampleWeight is not implemented yet");if(null!=n){const t=(0,D.tidy)((()=>{if(1===e.shape.length)return(0,D.clone)(e);if(2===e.shape.length){if(e.shape[1]>1){const t=1;return(0,D.argMax)(e,t)}if(1===e.shape[1])return(0,D.reshape)(e,[e.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${e.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}throw new Error(`Unexpected rank of target (y) tensor (${e.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)})),r=Array.from(await t.data());(0,D.dispose)(t);const i=[];return r.forEach((e=>{if(null==n[e])throw new Error(`classWeight must contain all classes in the training data. The class ${e} exists in the data but not in classWeight`);i.push(n[e])})),(0,D.tensor1d)(i,"float32")}return null}function Ha(e,t){return(0,D.mul)(e,t)}function Xa(e,t){let n,r;const i=t;n=i.xs,r=i.ys,D.util.assert(null!=n&&null!=r,(()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${t}`));const a=Ka("input",e.inputNames,n),s=Ka("output",e.outputNames,r),o=a[0].shape[0];D.util.assert(a.length===e.inputs.length,(()=>`LayersModel has ${e.inputs.length} inputs, but the dataset provides ${a.length} inputs.  (Expected input keys: ${JSON.stringify(e.inputNames)})`)),D.util.assert(s.length===e.outputs.length,(()=>`LayersModel has ${e.outputs.length} outputs, but the dataset provides ${s.length} outputs.  (Expected output keys: ${JSON.stringify(e.outputNames)})`));for(let t=0;t<a.length;t++)D.util.assert(a[t].shape[0]===o,(()=>`Batch size mismatch: input ${e.inputNames[t]} has ${a[t].shape[0]}; expected  ${o} based on input ${e.inputNames[0]}.`));for(let t=0;t<s.length;t++)D.util.assert(s[t].shape[0]===o,(()=>`Batch size mismatch: output ${e.outputNames[t]} has ${s[t].shape[0]}; expected  ${o} based on input ${e.inputNames[0]}.`));return{xs:a,ys:s}}function Ka(e,t,n){if(n instanceof D.Tensor)return[n];if(Array.isArray(n))return D.util.assert(n.length===t.length,(()=>`Received an array of ${n.length} Tensors, but expected ${t.length} to match the ${e} keys ${t}.`)),n;{const r=[];for(const i of t){if(null==n[i])throw new Qn(`The feature data generated by the dataset lacks the required ${e} key '${i}'.`);r.push(n[i])}return r}}function Ya(e){return"function"==typeof e.iterator}function Qa(e){D.util.assert(e>0&&Number.isInteger(e),(()=>`batchSize is required to be a positive integer, but got ${e}`))}function Ja(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((e=>Yr(e,t,n-t))):Yr(e,t,n-t)}function Za(e,t){return D.tidy((()=>null==e?null:Array.isArray(e)?e.map((e=>Za(e,t))):ii(e,"int32"===t.dtype?t:D.cast(t,"int32"))))}function es(e,t){const n=[];let r=0,i=null;for(;r<e;)i=r+t,i>=e&&(i=e),n.push([r,i]),r=i;return n}function ts(e){const t=[];e instanceof D.Tensor&&(e=[e]);for(let n=0;n<e.length;++n){const r=e[n];if(1===r.rank)t.push(Kr(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function ns(e,t){if(null==e)return;const n=[];if(t instanceof D.Tensor)n.push(t.id);else if(Array.isArray(t))t.forEach((e=>n.push(e.id)));else if(null!=t)for(const e in t){const r=t[e];n.push(r.id)}const r=[];if(e instanceof D.Tensor)-1===n.indexOf(e.id)&&r.push(e);else if(Array.isArray(e))e.forEach((e=>{-1===n.indexOf(e.id)&&r.push(e)}));else if(null!=e)for(const t in e){const i=e[t];-1===n.indexOf(i.id)&&r.push(i)}r.forEach((e=>{e.isDisposed||e.dispose()}))}function rs(e){return Array.isArray(e)}function is(e){return!function(e){return e instanceof D.Tensor}(e)&&!rs(e)}function as(e,t,n,r=!0,i=""){if(null==t||0===t.length){if(null!=e){let t=!1;if(rs(e)&&e.length>0)t=!0;else if(is(e)){for(const n in e)if(e.hasOwnProperty(n)){t=!0;break}}else t=!0;if(t)throw new Qn(`Error when checking model ${i} expected no data, but got ${e}`)}return[]}if(null==e)return t.map((e=>null));let a;if(is(e)){e=e,a=[];for(const n of t){if(null==e[n])throw new Qn(`No data provided for "${n}". Need data for each key in: ${t}`);a.push(e[n])}}else if(rs(e)){if((e=e).length!==t.length)throw new Qn(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): ${e}`);a=e}else{if(e=e,t.length>1)throw new Qn(`The model ${i} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${e.shape}`);a=[e]}if(a=ts(a),null!=n)for(let e=0;e<t.length;++e){if(null==n[e])continue;const s=a[e];if(s.shape.length!==n[e].length)throw new Qn(`Error when checking ${i}: expected ${t[e]} to have ${n[e].length} dimension(s). but got array with shape ${s.shape}`);for(let t=0;t<n[e].length;++t){if(0===t&&!r)continue;const a=s.shape[t],o=n[e][t];if(null!=o&&o>=0&&a!==o)throw new Qn(`${i} expected a batch of elements where each example has shape [${n[e].slice(1,n[e].length)}] (i.e.,tensor shape [*,${n[e].slice(1,n[e].length)}]) but the ${i} received an input with ${s.shape[0]} examples, each with shape [${s.shape.slice(1,s.shape.length)}] (tensor shape [${s.shape}])`)}}return a}function ss(e,t,n,r=!0,i=""){let a;if(Array.isArray(e)){if(e.length!==t.length)throw new Qn(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${e.length} Tensors(s).`);a=e}else{if(t.length>1)throw new Qn(`The model expects ${t.length} ${i} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(e.shape)}.`);a=[e]}if(null!=n)for(let e=0;e<t.length;++e){if(null==n[e])continue;const s=a[e];if(s.shape.length!==n[e].length)throw new Qn(`Error when checking ${i}: expected ${t[e]} to have ${n[e].length} dimension(s), but got array with shape ${JSON.stringify(s.shape)}`);for(let a=0;a<n[e].length;++a){if(0===a&&!r)continue;const o=s.shape[a],u=n[e][a];if(null!=u&&u!==o)throw new Qn(`Error when checking ${i}: expected ${t[e]} to have shape ${JSON.stringify(n[e])} but got array with shape ${JSON.stringify(s.shape)}.`)}}}class os extends Va{constructor(e){super(e),this.isTraining=!1}summary(e,t,n=console.log){if(!this.built)throw new Qn("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");!function(e,t,n,r=console.log){const i=function(e){let t=!0;const n=[],r=[];for(const t in e.nodesByDepth)n.push(e.nodesByDepth[t]);for(const e of n){if(e.length>1||1===e.length&&e[0].inboundLayers.length>1){t=!1;break}r.push(...e)}if(t)for(const n of e.layers){let e=!1;for(const i of n.inboundNodes)if(-1!==r.indexOf(i)){if(e){t=!1;break}e=!0}if(!t)break}return t}(e),a=["Layer (type)","Input Shape","Output shape","Param #"];let s;if(i?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map((e=>Math.floor(t*e)))),!i){a.push("Receives inputs"),s=[];for(const t in e.nodesByDepth)s.push(...e.nodesByDepth[t])}r("_".repeat(t)),Na(a,n,r),r("=".repeat(t));const o=e.layers;for(let e=0;e<o.length;++e)i?$a(o[e],n,r):Ta(o[e],n,s,r),r((e===o.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();const u=function(e){let t;return t=null!=e.collectedTrainableWeights?Pi(e.collectedTrainableWeights):Pi(e.trainableWeights),t}(e),l=Pi(e.nonTrainableWeights);r(`Total params: ${u+l}`),r(`Trainable params: ${u}`),r(`Non-trainable params: ${l}`),r("_".repeat(t))}(this,e,t,n)}compile(e){if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer_=function(e){const t={Adagrad:()=>D.train.adagrad(.01),Adadelta:()=>D.train.adadelta(1,.95,Xn()),Adam:()=>D.train.adam(.001,.9,.999,Xn()),Adamax:()=>D.train.adamax(.002,.9,.999,Xn(),0),RMSProp:()=>D.train.rmsprop(.001,.9,0,Xn()),SGD:()=>D.train.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new Qn(`Unknown Optimizer ${e}`)}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof D.Optimizer))throw new Qn("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new Qn(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);const n=e.loss;t=n.map((e=>ba(e)))}else{const n=ba(e.loss);this.outputs.forEach((e=>{t.push(n)}))}else{e.loss=e.loss;for(const t in e.loss)if(-1===this.outputNames.indexOf(t))throw new Qn(`Unknown entry in loss dictionary: "${t}". Only expected the following keys: ${this.outputNames}`);for(const n of this.outputNames)null==e.loss[n]&&console.warn(`Output "${n}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${n} during training`),t.push(ba(e.loss[n]))}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let e=0;e<this.outputs.length;++e){const t=this.internalOutputShapes[e],n=this.outputNames[e];this.feedOutputNames.push(n),this.feedOutputShapes.push(t),this.feedLossFns.push(this.lossFunctions[e])}const n=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Lr("loss",(()=>{for(let e=0;e<this.outputs.length;++e){if(-1!==n.indexOf(e))continue;const t=this.lossFunctions[e];this.outputs.length>1&&(this.metricsTensors.push([t,e]),this.metricsNames.push(this.outputNames[e]+"_loss"))}}));const r=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((e=>[]));let n;if("string"==typeof e||"function"==typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!=typeof e)throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${e}`);n=e}if(Array.isArray(n))return t.map((e=>n));{const e=[];for(const r of t){let t=n.hasOwnProperty(r)?n[r]:[];Array.isArray(t)||(t=[t]),e.push(t)}return e}}(e.metrics,this.outputNames),i=(e,t,n)=>{this.outputNames.length>1&&(t=this.outputNames[e]+"_"+t),this.metricsNames.push(t),this.metricsTensors.push([n,e])};Lr("metric",(()=>{for(let e=0;e<this.outputs.length;++e)-1===n.indexOf(e)&&(t=>{let n,r,a;for(const s of t){if("string"==typeof s&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(s)){const t=this.internalOutputShapes[e];let i;1===t[t.length-1]||this.lossFunctions[e]===ma?-1!==["accuracy","acc"].indexOf(s)?r=xa:-1!==["crossentropy","ce"].indexOf(s)&&(r=ka):this.lossFunctions[e]===ga?-1!==["accuracy","acc"].indexOf(s)?r=_a:-1!==["crossentropy","ce"].indexOf(s)&&(r=Ca):-1!==["accuracy","acc"].indexOf(s)?r=wa:-1!==["crossentropy","ce"].indexOf(s)&&(r=Sa),-1!==["accuracy","acc"].indexOf(s)?i="acc":-1!==["crossentropy","ce"].indexOf(s)&&(i="ce"),a=r,n=""+i}else{const e=Ea(s);a=e,n=""+Fa(s)}let t;Lr(n,(()=>{t=a})),i(e,n,t)}})(r[e])})),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,n={}){const r=null==n.batchSize?32:n.batchSize;Qa(r);const i=this.standardizeUserDataXY(e,t,!0,r);try{const a=i[0].concat(i[1]);this.makeTestFunction();const s=this.testFunction;return rr(this.testLoop(s,a,r,n.verbose,n.steps))}finally{ns(i[0],e),ns(i[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),async function(e,t,n){const r=null!=(n=n||{}).batches,i=e.testFunction;let a=[];if(n.verbose>0)throw new Jn("Verbose mode is not implemented yet.");D.util.assert(!r||n.batches>0&&Number.isInteger(n.batches),(()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`));const s="function"==typeof t.next?t:await t.iterator();let o=0,u=0;for(;!r||u<n.batches;){const t=await s.next();if(a=D.tidy((()=>{if(t.value){const{xs:n,ys:r}=Xa(e,t.value),s=n.concat(r),l=D.tidy((()=>i(s)));if(D.dispose(s),0===u)for(let e=0;e<l.length;++e)a.push((0,D.scalar)(0));const c=s[0].shape[0];for(let e=0;e<l.length;++e){const t=l[e],n=a[e];a[e]=D.tidy((()=>D.add(a[e],D.mul(c,t)))),u>0&&D.dispose(n)}D.dispose(l),o+=c,++u}return a})),t.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let e=0;e<a.length;++e){const t=a[e];a[e]=D.div(a[e],o),D.dispose(t)}return rr(a)}(this,e,t)}checkNumSamples(e,t,n,r="steps"){let i;if(null!=n){if(i=null,null!=t)throw new Qn(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else{if(null==e)throw new Qn(`Either the input data should have a defined shape, or ${r} shoud be specified.`);i=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return i}execute(e,t){if(Array.isArray(t)&&0===t.length)throw new Qn("`outputs` is an empty Array, which is not allowed.");const n=Array.isArray(t),r=n?t:[t],i=this.retrieveSymbolicTensors(r),a=new Ba;if(e instanceof D.Tensor&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new Qn(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let t=0;t<this.inputs.length;++t)a.add(this.inputs[t],e[t])}else for(const t of this.inputs){const n=e[t.name];if(null==n)throw new Qn(`No value is provided for the model's input ${t.name}`);a.add(t,n)}const s=Pa(i,a);return n?s:s[0]}retrieveSymbolicTensors(e){const t=er(null,e.length);let n=e.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],a=i.map((e=>e.name));for(let r=0;r<e.length;++r){const s=a.indexOf(e[r]);if(-1!==s&&(t[r]=i[s],n--),0===n)break}if(0===n)break}if(n>0){const n=[];throw t.forEach(((t,r)=>{null==t&&n.push(e[r])})),new Qn(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(n)}`)}return t}predictLoop(e,t=32,n=!1){return D.tidy((()=>{const r=this.checkNumSamples(e);if(n)throw new Jn("Verbose predictLoop() is not implemented yet.");const i=es(r,t),a=this.outputs.map((e=>[]));for(let t=0;t<i.length;++t)D.tidy((()=>{const n=i[t][0],r=i[t][1],a=Ja(e,n,r),s=[];if(Array.isArray(a))for(let e=0;e<a.length;++e)s.push({key:this.inputs[e],value:a[e]});else s.push({key:this.inputs[0],value:a});const o=new Ba(s);return Pa(this.outputs,o)})).forEach(((e,t)=>a[t].push(e)));return rr(a.map((e=>D.concat(e,0))))}))}predict(e,t={}){const n=ts(e);ss(n,this.inputNames,this.feedInputShapes,!1);try{const r=null==t.batchSize?32:t.batchSize;return Qa(r),this.predictLoop(n,r)}finally{ns(n,e)}}predictOnBatch(e){ss(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,n=!0,r){if(null==this.optimizer_)throw new Yn("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let e=0;e<this.feedOutputShapes.length;++e){const t=this.feedOutputShapes[e];this.feedLossFns[e]===ga?i.push(t.slice(0,t.length-1).concat([1])):i.push(t)}if(function(e,t,n){const r=hr(e.map((e=>e.shape[0])));r.sort();const i=hr(t.map((e=>e.shape[0])));if(i.sort(),r.length>1)throw new Qn(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map((e=>e.shape)))}`);if(i.length>1)throw new Qn(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map((e=>e.shape)))}`);if(r.length>0&&i.length>0&&!D.util.arraysEqual(r,i))throw new Qn(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${i[0]} target sample(s).`)}(e=as(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=as(t,this.feedOutputNames,i,!1,"target")),function(e,t,n){const r=[da,ma,pa];for(let i=0;i<e.length;++i){const a=e[i],s=t[i],o=n[i];if(null!=s){if(s===pa&&1===a.shape[a.shape.length-1])throw new Qn(`You are passing a target array of shape ${a.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(-1!==r.indexOf(s)){const e=a.shape.slice(1),t=o.slice(1);for(let n=0;n<e.length;++n){const r=e[n],i=t[n];if(null!=i&&r!==i)throw new Qn(`A target Tensor with shape ${a.shape} was passed for an output of shape ${o}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=r&&r>0&&e[0].shape[0]%r!=0)throw new Qn(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,n,r,i=!0,a){const[s,o]=this.standardizeUserDataXY(e,t,i,a);if(null!=n)throw new Error("sample weight is not supported yet.");let u=null;if(null!=r){const e=Ga(r,this.outputNames);u=[];for(let t=0;t<e.length;++t)u.push(await qa(o[t],null,e[t]))}return[s,o,u]}testLoop(e,t,n,r=0,i){return D.tidy((()=>{const a=this.checkNumSamples(t,n,i,"steps"),s=[];if(r>0)throw new Jn("Verbose mode is not implemented yet.");if(null!=i)throw new Jn("steps mode in testLoop() is not implemented yet");{const r=es(a,n),i=(0,D.tensor1d)(Hr(0,a));for(let n=0;n<r.length;++n){const a=r[n][0],o=r[n][1],u=Yr(i,a,o-a),l=Za(t,u),c=e(l);if(0===n)for(let e=0;e<c.length;++e)s.push((0,D.scalar)(0));for(let e=0;e<c.length;++e){const t=c[e];s[e]=D.add(s[e],D.mul(o-a,t))}}for(let e=0;e<s.length;++e)s[e]=D.div(s[e],a)}return s}))}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let n=0;n<e.length;++n){const r=e[n];let i=r;nr(e,r)>1&&(i+=`_${nr(e.slice(0,n),r)}`),t.push(i)}return t}makeTrainFunction(){return e=>{const t=[],n=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+2*this.outputs.length),a=[],s=this.collectedTrainableWeights.map((e=>e.read()));return[this.optimizer_.minimize((()=>{const e=[];for(let t=0;t<this.inputs.length;++t)e.push({key:this.inputs[t],value:n[t]});const s=new Ba(e),o=Pa(this.outputs,s,{training:!0});let u;for(let e=0;e<this.lossFunctions.length;++e){let n=(0,this.lossFunctions[e])(r[e],o[e]);null!=i[e]&&(n=Ha(n,i[e]));const a=D.mean(n);t.push(a),u=0===e?n:D.add(u,n)}for(let e=0;e<this.metricsTensors.length;++e){let n;if(this.outputs.length>1&&e<this.outputs.length)n=t[e];else{const t=this.metricsTensors[e][0],i=this.metricsTensors[e][1];n=D.mean(t(r[i],o[i]))}D.keep(n),a.push(n)}return u=D.mean(u),this.calculateLosses().forEach((e=>{u=D.add(u,e)})),u}),!0,s)].concat(a)}}makeTestFunction(){this.testFunction=e=>D.tidy((()=>{const t=[];let n;const r=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=[];for(let e=0;e<this.inputs.length;++e)a.push({key:this.inputs[e],value:r[e]});const s=new Ba(a),o=Pa(this.outputs,s);for(let e=0;e<this.lossFunctions.length;++e){const r=this.lossFunctions[e],a=D.mean(r(i[e],o[e]));n=0===e?a:D.add(n,a),t.push(n)}for(let e=0;e<this.metricsTensors.length;++e){const n=this.metricsTensors[e][0],r=this.metricsTensors[e][1],a=D.mean(n(i[r],o[r]));t.push(a)}return t}))}async fit(e,t,n={}){return async function(e,t,n,r={}){if(e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");let i,a,s,o,u,l,c,d,h;e.isTraining=!0;try{const f=null==r.batchSize?32:r.batchSize;Qa(f);const p=!1,g=await e.standardizeUserData(t,n,r.sampleWeight,r.classWeight,p,f);i=g[0],a=g[1],h=g[2];let m,y=!1;if(null!=r.validationData&&r.validationData.length>0){if(y=!0,2!==r.validationData.length)throw 3===r.validationData.length?new Jn("validationData including sample weights is not supported yet."):new Qn(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);u=r.validationData[0],l=r.validationData[1];const t=!0,n=await e.standardizeUserData(u,l,null,null,t,f);c=n[0],d=n[1],m=c.concat(d)}else if(null!=r.validationSplit&&r.validationSplit>0&&r.validationSplit<1){y=!0;const e=Math.floor(i[0].shape[0]*(1-r.validationSplit)),t=i[0].shape[0];c=Ja(i,e,t),s=i,i=Ja(i,0,e),d=Ja(a,e,t),o=a,a=Ja(a,0,e),m=c.concat(d)}else null!=r.validationSteps&&(y=!0);const v=i.concat(a).concat(h);e.checkTrainableWeightsConsistency();const b=e.makeTrainFunction(),x=e.getDedupedMetricsNames();let w,k;y?(e.makeTestFunction(),w=e.testFunction,k=x.slice().concat(x.map((e=>"val_"+e)))):(w=null,m=[],k=x.slice());const _=sa(r.callbacks,r.yieldEvery),S=await async function(e,t,n,r,i,a,s,o,u,l,c,d,h,f,p){null==i&&(i=32),null==a&&(a=1),null==c&&(c=!0),null==h&&(h=0);let g=!1;null!=u&&null!=l&&(g=!0);const m=e.checkNumSamples(n,i,f,"steps_per_epoch");let y;null!=m&&(y=Hr(0,m)),null==s&&(s=1);const{callbackList:v,history:b}=ua(o,s,a,h,m,f,i,g,d);v.setModel(e),e.history=b,await v.onTrainBegin(),e.stopTraining_=!1;for(let s=h;s<a;++s){await v.onEpochBegin(s);const a={};{if("batch"===c)throw new Jn("batch shuffling is not implemneted yet");c&&D.util.shuffle(y);const s=(0,D.tensor1d)(y),o=es(m,i);for(let c=0;c<o.length;++c){const d={};if(await v.onBatchBegin(c,d),D.tidy((()=>{const h=o[c][0],f=o[c][1],p=Yr(s,h,f-h);d.batch=c,d.size=f-h;const m=Za(n,p),y=t(m);for(let e=0;e<r.length;++e){const t=r[e],n=y[e];d[t]=n,D.keep(n)}if(c===o.length-1&&g){const t=e.testLoop(u,l,i);for(let e=0;e<r.length;++e){const n=r[e],i=t[e];D.keep(i),a["val_"+n]=i}}})),await v.onBatchEnd(c,d),Zi(d),e.stopTraining_)break}s.dispose()}if(await v.onEpochEnd(s,a),e.stopTraining_)break}return await v.onTrainEnd(),await e.history.syncData(),e.history}(e,b,v,x,f,r.epochs,r.verbose,_,w,m,r.shuffle,k,r.initialEpoch,null);return S}finally{e.isTraining=!1,ns(i,t),ns(a,n),ns(s,t),ns(o,n),ns(c,u),ns(d,l),null!=h&&D.dispose(h)}}(this,e,t,n)}async fitDataset(e,t){return async function(e,t,n){const r=null!=n.batchesPerEpoch;if(D.util.assert(null!=e.optimizer,(()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig).")),D.util.assert(null!=n,(()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call.")),D.util.assert(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),(()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`)),D.util.assert(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),(()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`)),D.util.assert(null==n.validationSplit,(()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead.")),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;try{const i=null!=n.validationData;let a,s;if(i)if(Ya(n.validationData))D.util.assert(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),(()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`));else{const e=function(e){if(3===e.length)throw new Jn("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}(n.validationData);a=e.xs,s=e.ys}const o=e.makeTrainFunction(),u=e.getDedupedMetricsNames();let l;l=i?u.slice().concat(u.map((e=>"val_"+e))):u.slice();const c=sa(n.callbacks,n.yieldEvery),d=null==n.verbose?1:n.verbose,{callbackList:h,history:f}=ua(c,d,n.epochs,null,null,function(e,t){let n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}(t,n),null,i,l);h.setModel(e),e.history=f,await h.onTrainBegin(),e.stopTraining_=!1;let p=null==n.initialEpoch?0:n.initialEpoch,g=await t.iterator();for(;p<n.epochs;){const l={};await h.onEpochBegin(p);let c=0,d=0;for(r||(g=await t.iterator());!r||c<n.batchesPerEpoch;){const t=await g.next();if(r&&t.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${c} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, `+n.batchesPerEpoch*n.epochs+" batches). You may need to use the repeat() function when building your dataset.");break}if(null!=t.value){const{xs:r,ys:i}=Xa(e,t.value),a={};a.batch=d,a.size=r[0].shape[0],await h.onBatchBegin(d,a);const s=[];if(null!=n.classWeight){const t=Ga(n.classWeight,e.outputNames);for(let e=0;e<t.length;++e)s.push(await qa(i[e],null,t[e]))}const l=r.concat(i).concat(s),f=o(l);D.dispose(l);for(let e=0;e<u.length;++e){const t=u[e],n=f[e];a[t]=n,D.keep(n)}await h.onBatchEnd(d,a),Zi(a),d++,c++}if(r?c>=n.batchesPerEpoch:t.done){if(i){let t;t=Ya(n.validationData)?ir(await e.evaluateDataset(n.validationData,{batches:n.validationBatches})):ir(e.evaluate(a,s,{batchSize:null==n.validationBatchSize?32:n.validationBatchSize,verbose:0}));for(let n=0;n<e.metricsNames.length;++n)l[`val_${e.metricsNames[n]}`]=t[n]}break}if(e.stopTraining_)break}if(await h.onEpochEnd(p,l),p++,e.stopTraining_)break}return await h.onTrainEnd(),await e.history.syncData(),e.history}finally{e.isTraining=!1}}(this,e,t)}async trainOnBatch(e,t){const n=await this.standardizeUserData(e,t),r=n[0],i=n[1],a=this.makeTrainFunction()(r.concat(i)),s=[];for(const e of a){const t=await e.data();s.push(t[0])}return D.dispose(a),ns(n[0],e),ns(n[1],t),rr(s)}getNamedWeights(e){const t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,i=this.getWeights(n);for(let e=0;e<r.length;++e)n&&!r[e].trainable||t.push({name:r[e].originalName,tensor:i[e]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){const t=D.memory().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-D.memory().numTensors}return e}getLossIdentifiers(){let e;if("string"==typeof this.loss)e=ar(this.loss);else if(Array.isArray(this.loss)){for(const e of this.loss)if("string"!=typeof e)throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map((e=>ar(e)))}else{const t=Object.keys(this.loss);e={};const n=this.loss;for(const r of t){if("string"!=typeof n[r])throw new Error("Serialization of non-string loss is not supported.");e[r]=ar(n[r])}}return e}getMetricIdentifiers(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[ar(Fa(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((e=>ar(Fa(e))));{const e={};for(const t in this.metrics)e[t]=ar(Fa(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");const t=la(Ma(e.optimizer_config));let n,r;if("string"==typeof e.loss)n=sr(e.loss);else if(Array.isArray(e.loss))n=e.loss.map((e=>sr(e)));else if(null!=e.loss){n={};for(const t in e.loss)n[t]=sr(e.loss[t])}if(Array.isArray(e.metrics))r=e.metrics.map((e=>sr(e)));else if(null!=e.metrics){r={};for(const t in e.metrics)r[t]=sr(e.metrics[t])}this.compile({loss:n,metrics:r,optimizer:t})}async save(e,t){if("string"==typeof e){const t=D.io.getSaveHandlers(e);if(0===t.length)throw new Qn(`Cannot find any save handlers for URL '${e}'`);if(t.length>1)throw new Qn(`Found more than one (${t.length}) save handlers for URL '${e}'`);e=t[0]}if(null==e.save)throw new Qn("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const n=await D.io.encodeWeights(this.getNamedWeights(t)),r={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v3.15.0",convertedBy:null};if(null!=t&&t.includeOptimizer&&null!=this.optimizer){r.trainingConfig=this.getTrainingConfig();const e="optimizer",{data:t,specs:i}=await D.io.encodeWeights(await this.optimizer.getWeights(),e);n.specs.push(...i),n.data=D.io.concatenateArrayBuffers([n.data,t])}if(null!=this.userDefinedMetadata){const e=!0;Ia(this.userDefinedMetadata,this.name,e),r.userDefinedMetadata=this.userDefinedMetadata}return r.weightData=n.data,r.weightSpecs=n.specs,e.save(r)}setUserDefinedMetadata(e){Ia(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}os.className="Model",D.serialization.registerClass(os);class us extends os{}us.className="Functional",D.serialization.registerClass(us);class ls extends os{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=null!=e.name?e.name:Mi("sequential_"),null!=e.layers)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some((e=>e<0)))throw new Qn(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof ls||e instanceof os;let n;if(t){if(n=e,1!==n.outputs.length)throw new Qn("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new Qn("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new Qn("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const t=function(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new Qn("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));let n=e.dtype;return null==n&&(n="float32"),new Qi({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(t)}if(t)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==e.inboundNodes.length)throw new Qn(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(1!==e.inboundNodes[0].outputTensors.length)throw new Qn("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=Yi(this.outputs[0])}this.inboundNodes=[],new Hi({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:er(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((e=>e.shape)),outputShapes:this.outputs[0].shape})}else{const t=e.apply(this.outputs[0]);if(Array.isArray(t))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[t],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return null==this.model&&this.build(),this.model.call(e,t)}build(e){if(Li(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new os({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,n=console.log){this.built||this.build(),super.summary(e,t,n)}setWeights(e){null==this.model&&this.build(),this.model.setWeights(e)}evaluate(e,t,n={}){if(!this.built)throw new Yn("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}async evaluateDataset(e,t){if(!this.built)throw new Yn("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return null==this.model&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return null==this.model?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,n={}){if(!this.built)throw new Yn("The model needs to be compiled before being used.");return this.model.fit(e,t,n)}async fitDataset(e,t){if(!this.built)throw new Yn("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,n={},r=!1){let i,a={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new Qn("Legacy serialization format not supported yet.");i=t}else D.util.assert(null!=t.layers,(()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field.")),i=t.layers,delete t.layers,a=t;const s=new e(a);if(!(s instanceof ls))throw new Jn(`Sequential.fromConfig called on non-Sequential input: ${s}`);for(const e of i){const t=la(e,void 0,r);r&&t.setFastWeightInitDuringBuild(!0),s.add(t)}return s}set stopTraining(e){if(null==this.model)throw new Qn("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(null==this.model)throw new Qn("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const n={};n.className=t.getClassName(),n.config=t.getConfig(),e.push(n)}return{name:this.name,layers:e}}}ls.className="Sequential",D.serialization.registerClass(ls);class cs extends D.serialization.Serializable{getConfig(){return{}}}class ds extends cs{apply(e,t=1){return function(e,t=1){if(1!==t)throw new Jn(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return D.elu(e)}(e,t)}}ds.className="elu",D.serialization.registerClass(ds);class hs extends cs{apply(e){return D.selu(e)}}hs.className="selu",D.serialization.registerClass(hs);class fs extends cs{apply(e){return D.relu(e)}}fs.className="relu",D.serialization.registerClass(fs);class ps extends cs{apply(e){return(0,D.tidy)((()=>D.minimum(6,D.relu(e))))}}ps.className="relu6",D.serialization.registerClass(ps);class gs extends cs{apply(e){return e}}gs.className="linear",D.serialization.registerClass(gs);class ms extends cs{apply(e){return D.sigmoid(e)}}ms.className="sigmoid",D.serialization.registerClass(ms);class ys extends cs{apply(e){return function(e){return(0,D.tidy)((()=>{const t=D.add(.5,D.mul(.2,e));return D.clipByValue(t,0,1)}))}(e)}}ys.className="hardSigmoid",D.serialization.registerClass(ys);class vs extends cs{apply(e){return D.softplus(e)}}vs.className="softplus",D.serialization.registerClass(vs);class bs extends cs{apply(e){return function(e){return(0,D.tidy)((()=>D.div(e,D.add(D.abs(e),1))))}(e)}}bs.className="softsign",D.serialization.registerClass(bs);class xs extends cs{apply(e){return D.tanh(e)}}xs.className="tanh",D.serialization.registerClass(xs);class ws extends cs{apply(e,t=-1){return D.softmax(e,t)}}ws.className="softmax",D.serialization.registerClass(ws);class ks extends cs{apply(e,t=-1){return D.logSoftmax(e,t)}}ks.className="logSoftmax",D.serialization.registerClass(ks);class _s extends cs{apply(e,t=1){return(0,D.tidy)((()=>D.mul(D.sigmoid(D.mul(e,t)),e)))}}_s.className="swish",D.serialization.registerClass(_s);class Ss extends cs{apply(e){return(0,D.tidy)((()=>D.mul(e,D.tanh(D.softplus(e)))))}}function Cs(e){return e.getClassName()}function As(e,t={}){return cr(e,D.serialization.SerializationMap.getMap().classNameMap,t,"activation")}function Es(e){if(null==e){return As({className:"linear",config:{}})}if("string"==typeof e){const t={};return t.className=e,t.config={},As(t)}return e instanceof cs?e:As(e)}Ss.className="mish",D.serialization.registerClass(Ss);class Fs extends D.serialization.Serializable{}class Is extends Fs{constructor(e){super(),function(e){if(null!=e&&"object"!=typeof e)throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${e}`)}(e),this.l1=null==e||null==e.l1?.01:e.l1,this.l2=null==e||null==e.l2?.01:e.l2,this.hasL1=0!==this.l1,this.hasL2=0!==this.l2}apply(e){return(0,D.tidy)((()=>{let t=(0,D.zeros)([1]);return this.hasL1&&(t=(0,D.add)(t,(0,D.sum)(D.mul(this.l1,(0,D.abs)(e))))),this.hasL2&&(t=(0,D.add)(t,(0,D.sum)(D.mul(this.l2,ai(e))))),D.reshape(t,[])}))}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}Is.className="L1L2",D.serialization.registerClass(Is);const Ds={l1l2:"L1L2"};function Ns(e){return ur(e)}function $s(e,t={}){return cr(e,D.serialization.SerializationMap.getMap().classNameMap,t,"regularizer")}function Ts(e){return null==e?null:"string"==typeof e?$s({className:e in Ds?Ds[e]:e,config:{}}):e instanceof Fs?e:$s(e)}class Os extends Ki{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,null!=e&&(this.maxValue=e.maxValue)}call(e,t){e=zi(e);let n=(0,D.relu)(e);return null!=this.maxValue&&(n=(0,D.clipByValue)(n,0,this.maxValue)),n}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}Os.className="ReLU",D.serialization.registerClass(Os);class Ms extends Ki{constructor(e){super(null==e?{}:e),this.DEFAULT_ALPHA=.3,null==e&&(e={}),this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=zi(e);return(0,D.leakyRelu)(n,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}Ms.className="LeakyReLU",D.serialization.registerClass(Ms);class Rs extends Ki{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Ni(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Ts(e.alphaRegularizer),this.alphaConstraint=Fr(e.alphaConstraint),null==e.sharedAxes)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else{if("number"!=typeof e.sharedAxes)throw new Qn(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`);this.sharedAxes=[e.sharedAxes]}}build(e){const t=(e=Li(e)).slice(1);if(null!=this.sharedAxes)for(const e of this.sharedAxes)t[e-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const n={};if(null!=this.sharedAxes)for(let t=1;t<e.length;++t)n[t]=e[t];this.inputSpec=[new Vi({ndim:e.length,axes:n})],this.built=!0}call(e,t){return e=zi(e),(0,D.prelu)(e,this.alpha.read())}getConfig(){const e={alphaInitializer:Di(this.alphaInitializer),alphaRegularizer:Ns(this.alphaRegularizer),alphaConstraint:Ar(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}Rs.className="PReLU",D.serialization.registerClass(Rs);class Bs extends Ki{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==this.DEFAULT_ALPHA)throw new Jn(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=zi(e);return(0,D.elu)(n)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}Bs.className="ELU",D.serialization.registerClass(Bs);class zs extends Ki{constructor(e){super(null==e?{}:e),this.DEFAULT_THETA=1,null==e&&(e={}),this.theta=null==e.theta?this.DEFAULT_THETA:e.theta}call(e,t){const n=zi(e);return(0,D.mul)(n,(0,D.cast)((0,D.greater)(n,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}zs.className="ThresholdedReLU",D.serialization.registerClass(zs);class Ls extends Ki{constructor(e){super(null==e?{}:e),this.DEFAULT_AXIS=1,null==e&&(e={}),this.softmax=(new ws).apply,this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis}call(e,t){const n=zi(e);return this.softmax(n,this.axis)}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function Ps(e,t,n){if("number"==typeof e)return er(e,t);if(e.length!==t)throw new Qn(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${e.length} elements.`);for(let i=0;i<t;++i){const a=e[i];if((r=a)!==parseInt(r.toString(),10))throw new Qn(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(e)} including a non-integer number ${a}`)}return e;var r}function js(e,t,n,r,i=1){if(null==e)return e;let a;return a="same"===n?e:e-(t+(t-1)*(i-1))+1,Math.floor((a+r-1)/r)}function Us(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+qr([n-t,0]);else{if("same"!==r)throw new Qn(`Unsupport padding mode: ${r}.`);e*=t}return e}function Ws(e,t){return(0,D.tidy)((()=>(Mr(t),"channelsFirst"===t?D.transpose(e,[0,2,3,1]):e)))}function Vs(e,t){return(0,D.tidy)((()=>(Mr(t),"channelsFirst"===t?D.transpose(e,[0,2,3,4,1]):e)))}function Gs(e,t,n,r=[1,1],i="valid",a,s,o=null){return(0,D.tidy)((()=>{if(null==a&&(a="channelsLast"),Mr(a),3!==e.rank&&4!==e.rank)throw new Qn(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${e.rank}.`);if(3!==t.rank&&4!==t.rank)throw new Qn(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${e.rank}.`);let u=Ws(e,a);if("causal"===i)throw new Jn("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=D.fused.conv2d({x:u,filter:t,strides:r,pad:"same"===i?"same":"valid",dilations:s,dataFormat:"NHWC",bias:n,activation:o}),"channelsFirst"===a&&(u=D.transpose(u,[0,3,1,2])),u}))}Ls.className="Softmax",D.serialization.registerClass(Ls);class qs extends Ki{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",qs.verifyArgs(t),this.rank=e,mr(this.rank,"rank"),1!==this.rank&&2!==this.rank&&3!==this.rank)throw new Jn(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Ps(t.kernelSize,e,"kernelSize"),this.strides=Ps(null==t.strides?1:t.strides,e,"strides"),this.padding=null==t.padding?"valid":t.padding,Rr(this.padding),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,Mr(this.dataFormat),this.activation=Es(t.activation),this.useBias=null==t.useBias||t.useBias,this.biasInitializer=Ni(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Fr(t.biasConstraint),this.biasRegularizer=Ts(t.biasRegularizer),this.activityRegularizer=Ts(t.activityRegularizer),this.dilationRate=Ps(null==t.dilationRate?1:t.dilationRate,e,"dilationRate"),1===this.rank&&Array.isArray(this.dilationRate)&&1!==this.dilationRate.length)throw new Qn(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(2===this.rank){if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate];else if(2!==this.dilationRate.length)throw new Qn(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(3===this.rank)if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(3!==this.dilationRate.length)throw new Qn(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}static verifyArgs(e){if(tr("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!=typeof e.kernelSize&&!gr(e.kernelSize,"number",1,3))throw new Qn(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Cs(this.activation),useBias:this.useBias,biasInitializer:Di(this.biasInitializer),biasRegularizer:Ns(this.biasRegularizer),activityRegularizer:Ns(this.activityRegularizer),biasConstraint:Ar(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class Hs extends qs{constructor(e,t){super(e,t),this.kernel=null,Hs.verifyArgs(t),this.filters=t.filters,mr(this.filters,"filters"),this.kernelInitializer=Ni(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Fr(t.kernelConstraint),this.kernelRegularizer=Ts(t.kernelRegularizer)}build(e){e=Li(e);const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new Qn(`The channel dimension of the input should be defined. Found ${e[t]}`);const n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:n}}],this.built=!0}call(e,t){return(0,D.tidy)((()=>{let t;e=zi(e);const n=null==this.bias?null:this.bias.read(),r=vr(this.activation.getClassName());if(null!=r&&2===this.rank)t=Gs(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate,r);else{if(1===this.rank)t=function(e,t,n,r=1,i="valid",a,s=1){return(0,D.tidy)((()=>{if(null==a&&(a="channelsLast"),Mr(a),3!==e.shape.length)throw new Qn(`The input of a conv1dWithBias operation should be 3, but is ${e.shape.length} instead.`);if(3!==t.shape.length)throw new Qn(`The kernel for a conv1dWithBias operation should be 3, but is ${t.shape.length} instead`);if(null!=n&&1!==n.shape.length)throw new Qn(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if("channelsFirst"===a&&(e=D.transpose(e,[0,2,1])),"causal"===i)throw new Jn("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let o=D.conv1d(e,t,r,"same"===i?"same":"valid","NWC",s);return null!=n&&(o=oi(o,n)),o}))}(e,this.kernel.read(),n,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(2===this.rank)t=Gs(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate);else{if(3!==this.rank)throw new Jn("convolutions greater than 3D are not implemented yet.");t=function(e,t,n,r=[1,1,1],i="valid",a,s){return(0,D.tidy)((()=>{if(null==a&&(a="channelsLast"),Mr(a),4!==e.rank&&5!==e.rank)throw new Qn(`conv3dWithBias expects input to be of rank 4 or 5, but received ${e.rank}.`);if(4!==t.rank&&5!==t.rank)throw new Qn(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${e.rank}.`);let o=Vs(e,a);if("causal"===i)throw new Jn("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return o=D.conv3d(o,t,r,"same"===i?"same":"valid","NDHWC",s),null!=n&&(o=oi(o,n)),"channelsFirst"===a&&(o=D.transpose(o,[0,4,1,2,3])),o}))}(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate)}null!=this.activation&&(t=this.activation.apply(t))}return t}))}computeOutputShape(e){e=Li(e);const t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2);for(let e=0;e<n.length;++e){const r=js(n[e],this.kernelSize[e],this.padding,this.strides[e],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[e]);t.push(r)}let r=[e[0]];return"channelsLast"===this.dataFormat?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:Di(this.kernelInitializer),kernelRegularizer:Ns(this.kernelRegularizer),kernelConstraint:Ar(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||"number"!=typeof e.filters||e.filters<1)throw new Qn(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Xs extends Hs{constructor(e){super(2,e),Xs.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&!gr(e.kernelSize,"number",1,2))throw new Qn(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Xs.className="Conv2D",D.serialization.registerClass(Xs);class Ks extends Hs{constructor(e){super(3,e),Ks.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new Qn(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}Ks.className="Conv3D",D.serialization.registerClass(Ks);class Ys extends Xs{constructor(e){if(super(e),this.inputSpec=[new Vi({ndim:4})],"same"!==this.padding&&"valid"!==this.padding)throw new Qn(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(4!==(e=Li(e)).length)throw new Qn("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new Qn("The channel dimension of the inputs should be defined. Found `None`.");const n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Vi({ndim:4,axes:{[t]:n}})],this.built=!0}call(e,t){return D.tidy((()=>{let t=zi(e);if(4!==t.shape.length)throw new Qn(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${t.shape.length}`);const n=t.shape,r=n[0];let i,a;"channelsFirst"===this.dataFormat?(i=2,a=3):(i=1,a=2);const s=n[i],o=n[a],u=this.kernelSize[0],l=this.kernelSize[1],c=this.strides[0],d=this.strides[1],h=[r,Us(s,c,u,this.padding),Us(o,d,l,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(t=D.transpose(t,[0,2,3,1]));let f=D.conv2dTranspose(t,this.kernel.read(),h,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(f=D.transpose(f,[0,3,1,2])),null!=this.bias&&(f=oi(f,this.bias.read(),this.dataFormat)),null!=this.activation&&(f=this.activation.apply(f)),f}))}computeOutputShape(e){const t=(e=Li(e)).slice();let n,r,i;"channelsFirst"===this.dataFormat?(n=1,r=2,i=3):(n=3,r=1,i=2);const a=this.kernelSize[0],s=this.kernelSize[1],o=this.strides[0],u=this.strides[1];return t[n]=this.filters,t[r]=Us(t[r],o,a,this.padding),t[i]=Us(t[i],u,s,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}Ys.className="Conv2DTranspose",D.serialization.registerClass(Ys);class Qs extends Ks{constructor(e){if(super(e),this.inputSpec=[new Vi({ndim:5})],"same"!==this.padding&&"valid"!==this.padding)throw new Qn(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(5!==(e=Li(e)).length)throw new Qn("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new Qn("The channel dimension of the inputs should be defined. Found `None`.");const n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Vi({ndim:5,axes:{[t]:n}})],this.built=!0}call(e,t){return D.tidy((()=>{let t=zi(e);if(5!==t.shape.length)throw new Qn(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${t.shape.length}`);const n=t.shape,r=n[0];let i,a,s;"channelsFirst"===this.dataFormat?(s=2,i=3,a=4):(s=1,i=2,a=3);const o=n[s],u=n[i],l=n[a],c=this.kernelSize[0],d=this.kernelSize[1],h=this.kernelSize[2],f=this.strides[0],p=this.strides[1],g=this.strides[2],m=[r,Us(o,f,c,this.padding),Us(u,p,d,this.padding),Us(l,g,h,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(t=D.transpose(t,[0,2,3,4,1]));let y=D.conv3dTranspose(t,this.kernel.read(),m,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(y=D.transpose(y,[0,4,1,2,3])),null!==this.bias&&(y=oi(y,this.bias.read(),this.dataFormat)),null!==this.activation&&(y=this.activation.apply(y)),y}))}computeOutputShape(e){const t=(e=Li(e)).slice();let n,r,i,a;"channelsFirst"===this.dataFormat?(n=1,r=2,i=3,a=4):(n=4,r=1,i=2,a=3);const s=this.kernelSize[0],o=this.kernelSize[1],u=this.kernelSize[2],l=this.strides[0],c=this.strides[1],d=this.strides[2];return t[n]=this.filters,t[r]=Us(t[r],l,s,this.padding),t[i]=Us(t[i],c,o,this.padding),t[a]=Us(t[a],d,u,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}Qs.className="Conv3DTranspose",D.serialization.registerClass(Qs);class Js extends Hs{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,null==t.filters)throw new Qn("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=t.kernelInitializer||null!=t.kernelRegularizer||null!=t.kernelConstraint)throw new Qn("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=t.padding&&"same"!==t.padding&&"valid"!==t.padding)throw new Qn(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,this.depthwiseInitializer=Ni(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Ts(t.depthwiseRegularizer),this.depthwiseConstraint=Fr(t.depthwiseConstraint),this.pointwiseInitializer=Ni(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Ts(t.pointwiseRegularizer),this.pointwiseConstraint=Fr(t.pointwiseConstraint)}build(e){if((e=Li(e)).length<this.rank+2)throw new Qn(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new Qn(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),i=[];for(let e=0;e<this.rank;++e)i.push(1);i.push(n*this.depthMultiplier,this.filters);const a=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,a,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,a,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,a,this.biasConstraint):this.bias=null,this.inputSpec=[new Vi({ndim:this.rank+2,axes:{[t]:n}})],this.built=!0}call(e,t){return(0,D.tidy)((()=>{let t;if(e=zi(e),1===this.rank)throw new Jn("1D separable convolution is not implemented yet.");return 2===this.rank&&("channelsFirst"===this.dataFormat&&(e=D.transpose(e,[0,2,3,1])),t=D.separableConv2d(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(t=oi(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),"channelsFirst"===this.dataFormat&&(t=D.transpose(t,[0,3,1,2])),t}))}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Di(this.depthwiseInitializer),e.pointwiseInitializer=Di(this.pointwiseInitializer),e.depthwiseRegularizer=Ns(this.depthwiseRegularizer),e.pointwiseRegularizer=Ns(this.pointwiseRegularizer),e.depthwiseConstraint=Ar(this.depthwiseConstraint),e.pointwiseConstraint=Ar(this.pointwiseConstraint),e}}Js.className="SeparableConv";class Zs extends Js{constructor(e){super(2,e)}}Zs.className="SeparableConv2D",D.serialization.registerClass(Zs);class eo extends Hs{constructor(e){super(1,e),eo.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if("number"!=typeof e.kernelSize&&!gr(e.kernelSize,"number",1,1))throw new Qn(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}eo.className="Conv1D",D.serialization.registerClass(eo);class to extends Ki{constructor(e){super(e),"number"==typeof e.cropping?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return(0,D.tidy)((()=>{if(e=zi(e),"channelsLast"===this.dataFormat){const t=Jr(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Jr(t,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}{const t=Jr(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Jr(t,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}}))}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}to.className="Cropping2D",D.serialization.registerClass(to);class no extends Ki{constructor(e){var t;super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=null==e.size?this.DEFAULT_SIZE:e.size,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Mr(this.dataFormat),this.interpolation=null==e.interpolation?"nearest":e.interpolation,t=this.interpolation,pr(Dr,"InterpolationFormat",t)}computeOutputShape(e){if("channelsFirst"===this.dataFormat){const t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}{const t=null==e[1]?null:this.size[0]*e[1],n=null==e[2]?null:this.size[1]*e[2];return[e[0],t,n,e[3]]}}call(e,t){return D.tidy((()=>{let t=zi(e);const n=t.shape;if("channelsFirst"===this.dataFormat){t=D.transpose(t,[0,2,3,1]);const e=this.size[0]*n[2],r=this.size[1]*n[3],i="nearest"===this.interpolation?D.image.resizeNearestNeighbor(t,[e,r]):D.image.resizeBilinear(t,[e,r]);return D.transpose(i,[0,3,1,2])}{const e=this.size[0]*n[1],r=this.size[1]*n[2];return"nearest"===this.interpolation?D.image.resizeNearestNeighbor(t,[e,r]):D.image.resizeBilinear(t,[e,r])}}))}getConfig(){const e={size:this.size,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}no.className="UpSampling2D",D.serialization.registerClass(no);class ro extends qs{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,this.depthwiseInitializer=Ni(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Fr(e.depthwiseConstraint),this.depthwiseRegularizer=Ts(e.depthwiseRegularizer)}build(e){if((e=Li(e)).length<4)throw new Qn(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new Qn(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return(0,D.tidy)((()=>{let t=function(e,t,n=[1,1],r="valid",i,a){return(0,D.tidy)((()=>{null==i&&(i="channelsLast"),Mr(i);let s=Ws(e,i);if(4!==e.rank)throw new Qn(`Input for depthwiseConv2d is required to be 4-D, but is instead ${e.rank}-D`);if(4!==t.rank)throw new Qn(`depthwiseKernel is required to be 4-D, but is instead ${t.rank}-D`);return s=D.depthwiseConv2d(s,t,n,"same"===r?"same":"valid","NHWC",a),"channelsFirst"===i&&(s=D.transpose(s,[0,3,1,2])),s}))}(e=zi(e),this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(t=oi(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),t}))}computeOutputShape(e){e=Li(e);const t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=js(t,this.kernelSize[0],this.padding,this.strides[0]),a=js(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,i,a]:[e[0],i,a,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Di(this.depthwiseInitializer),e.depthwiseRegularizer=Ns(this.depthwiseRegularizer),e.depthwiseConstraint=Ar(this.depthwiseRegularizer),e}}function io(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new Qn("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function i(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=i(t),constants:n=i(n)}}function ao(e,t,n,r=!1,i,a,s=!1,o=!1){return D.tidy((()=>{const u=t.shape.length;if(u<3)throw new Qn(`Input should be at least 3D, but is ${u}D.`);const l=[1,0].concat(Hr(2,u));if(t=D.transpose(t,l),null!=a)throw new Jn("The rnn() functoin of the deeplearn.js backend does not support constants yet.");s&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=i&&((i=D.cast(D.cast(i,"bool"),"float32")).rank===u-1&&(i=D.expandDims(i,-1)),i=D.transpose(i,l)),r&&(t=D.reverse(t,0),null!=i&&(i=D.reverse(i,0)));const c=[];let d,h=n;const f=t.shape[0],p=D.unstack(t);let g,m;null!=i&&(g=D.unstack(i));for(let t=0;t<f;++t){const n=p[t],r=D.tidy((()=>e(n,h)));if(null==i)d=r[0],h=r[1];else{const e=D.tidy((()=>{const e=g[t],n=D.sub(D.onesLike(e),e);return{output:D.add(D.mul(r[0],e),D.mul(h[0],n)),newStates:h.map(((t,i)=>D.add(D.mul(r[1][i],e),D.mul(t,n))))}}));d=e.output,h=e.newStates}o&&c.push(d)}if(o){const e=1;m=D.stack(c,e)}return[d,m,h]}))}ro.className="DepthwiseConv2D",D.serialization.registerClass(ro);class so extends Ki{constructor(e){let t;if(super(e),null==e.cell)throw new Qn("cell property is missing for the constructor of RNN.");if(t=Array.isArray(e.cell)?new go({cells:e.cell}):e.cell,null==t.stateSize)throw new Qn("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=null!=e.returnSequences&&e.returnSequences,this.returnState=null!=e.returnState&&e.returnState,this.goBackwards=null!=e.goBackwards&&e.goBackwards,this._stateful=null!=e.stateful&&e.stateful,this.unroll=null!=e.unroll&&e.unroll,this.supportsMasking=!0,this.inputSpec=[new Vi({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){return null==this.states_?Hr(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((e=>null)):this.states_}setStates(e){this.states_=e}computeOutputShape(e){Ri(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const n=t[0];let r;if(r=this.returnSequences?[e[0],e[1],n]:[e[0],n],this.returnState){const n=[];for(const r of t)n.push([e[0],r]);return[r].concat(n)}return r}computeMask(e,t){return D.tidy((()=>{Array.isArray(t)&&(t=t[0]);const e=this.returnSequences?t:null;if(this.returnState){const t=this.states.map((e=>null));return[e].concat(t)}return e}))}get states(){if(null==this.states_){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let n=0;n<e;++n)t.push(null);return t}return this.states_}set states(e){this.states_=e}build(e){if(null!=this.numConstants)throw new Jn("Constants support is not implemented in RNN yet.");Ri(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new Vi({shape:[t,null,...n]});const r=[e[0]].concat(e.slice(2));let i;if(this.cell.build(r),i=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!D.util.arraysEqual(this.stateSpec.map((e=>e.shape[e.shape.length-1])),i))throw new Qn(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map((e=>new Vi({shape:[null,e]})));this.stateful&&this.resetStates()}resetStates(e,t=!1){(0,D.tidy)((()=>{if(!this.stateful)throw new Kn("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape[0];if(null==n)throw new Qn("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.states_)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((e=>D.zeros([n,e]))):this.states_=[D.zeros([n,this.cell.stateSize])];else if(null==e)D.dispose(this.states_),null!=this.keptStates&&(D.dispose(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((e=>D.zeros([n,e]))):this.states_[0]=D.zeros([n,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new Qn(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);!0===t?this.keptStates.push(this.states_.slice()):D.dispose(this.states_);for(let t=0;t<this.states_.length;++t){const r=e[t],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[t]:this.cell.stateSize,a=[n,i];if(!D.util.arraysEqual(r.shape,a))throw new Qn(`State ${t} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${r.shape}`);this.states_[t]=r}}this.states_=this.states_.map((e=>D.keep(e.clone())))}))}apply(e,t){let n=null==t?null:t.initialState,r=null==t?null:t.constants;null==t&&(t={});const i=io(e,n,r,this.numConstants);e=i.inputs,n=i.initialState,r=i.constants;let a=[],s=[];if(null!=n){t.initialState=n,a=a.concat(n),this.stateSpec=[];for(const e of n)this.stateSpec.push(new Vi({shape:e.shape}));s=s.concat(this.stateSpec)}if(null!=r&&(t.constants=r,a=a.concat(r),this.numConstants=r.length),a[0]instanceof Gi){const n=[e].concat(a),r=this.inputSpec.concat(s),i=this.inputSpec;this.inputSpec=r;const o=super.apply(n,t);return this.inputSpec=i,o}return super.apply(e,t)}call(e,t){return(0,D.tidy)((()=>{const n=null==t?null:t.mask,r=null==t?null:t.training;let i=null==t?null:t.initialState;e=zi(e),null==i&&(i=this.stateful?this.states_:this.getInitialState(e));const a=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==a)throw new Qn(`RNN Layer has ${a} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const s={training:r},o=ao(((e,t)=>{const n=this.cell.call([e].concat(t),s);return[n[0],n.slice(1)]}),e,i,this.goBackwards,n,null,this.unroll,this.returnSequences),u=o[0],l=o[1],c=o[2];this.stateful&&this.resetStates(c,r);const d=this.returnSequences?l:u;return this.returnState?[d].concat(c):d}))}getInitialState(e){return(0,D.tidy)((()=>{let t=D.zeros(e.shape);return t=D.sum(t,[1,2]),t=Kr(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map((e=>e>1?ti(t,[1,e]):t)):this.cell.stateSize>1?[ti(t,[1,this.cell.stateSize])]:[t]}))}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);const n=this.cell.getConfig();return this.getClassName()===so.className&&(t.cell={className:this.cell.getClassName(),config:n}),Object.assign({},n,e,t)}static fromConfig(e,t,n={}){const r=la(t.cell,n);return new e(Object.assign(t,{cell:r}))}}so.className="RNN",D.serialization.registerClass(so);class oo extends Ki{}class uo extends oo{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,mr(this.units,"units"),this.activation=Es(null==e.activation?this.DEFAULT_ACTIVATION:e.activation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=Ni(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ni(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ni(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Ts(e.kernelRegularizer),this.recurrentRegularizer=Ts(e.recurrentRegularizer),this.biasRegularizer=Ts(e.biasRegularizer),this.kernelConstraint=Fr(e.kernelConstraint),this.recurrentConstraint=Fr(e.recurrentConstraint),this.biasConstraint=Fr(e.biasConstraint),this.dropout=Gr([1,qr([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=Gr([1,qr([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Li(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return(0,D.tidy)((()=>{if(2!==(e=e).length)throw new Qn(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let n=e[1];e=e[0];const r=null!=t.training&&t.training;let i;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=mo({ones:()=>D.onesLike(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=mo({ones:()=>D.onesLike(n),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));const a=this.dropoutMask,s=this.recurrentDropoutMask;i=ri(null!=a?D.mul(e,a):e,this.kernel.read()),null!=this.bias&&(i=oi(i,this.bias.read())),null!=s&&(n=D.mul(n,s));let o=D.add(i,ri(n,this.recurrentKernel.read()));return null!=this.activation&&(o=this.activation.apply(o)),[o,o]}))}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Cs(this.activation),useBias:this.useBias,kernelInitializer:Di(this.kernelInitializer),recurrentInitializer:Di(this.recurrentInitializer),biasInitializer:Di(this.biasInitializer),kernelRegularizer:Ns(this.kernelRegularizer),recurrentRegularizer:Ns(this.recurrentRegularizer),biasRegularizer:Ns(this.biasRegularizer),activityRegularizer:Ns(this.activityRegularizer),kernelConstraint:Ar(this.kernelConstraint),recurrentConstraint:Ar(this.recurrentConstraint),biasConstraint:Ar(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,t)}}uo.className="SimpleRNNCell",D.serialization.registerClass(uo);class lo extends so{constructor(e){e.cell=new uo(e),super(e)}call(e,t){return(0,D.tidy)((()=>{null!=this.cell.dropoutMask&&(D.dispose(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(D.dispose(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,r=null==t?null:t.training,i=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:i})}))}static fromConfig(e,t){return new e(t)}}lo.className="SimpleRNN",D.serialization.registerClass(lo);class co extends oo{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new Qn("GRUCell does not support reset_after parameter set to true.");this.units=e.units,mr(this.units,"units"),this.activation=Es(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Es(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=Ni(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ni(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ni(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Ts(e.kernelRegularizer),this.recurrentRegularizer=Ts(e.recurrentRegularizer),this.biasRegularizer=Ts(e.biasRegularizer),this.kernelConstraint=Fr(e.kernelConstraint),this.recurrentConstraint=Fr(e.recurrentConstraint),this.biasConstraint=Fr(e.biasConstraint),this.dropout=Gr([1,qr([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=Gr([1,qr([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){const t=(e=Li(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return(0,D.tidy)((()=>{if(2!==(e=e).length)throw new Qn(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const n=null!=t.training&&t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=mo({ones:()=>D.onesLike(e),rate:this.dropout,training:n,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=mo({ones:()=>D.onesLike(r),rate:this.recurrentDropout,training:n,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,a=this.recurrentDropoutMask;let s,o,u;0<this.dropout&&this.dropout<1&&(e=D.mul(e,i[0]));let l=ri(e,this.kernel.read());this.useBias&&(l=oi(l,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=D.mul(r,a[0]));const c=this.recurrentKernel.read(),[d,h]=D.split(c,[2*this.units,this.units],c.rank-1),f=ri(r,d),[p,g,m]=D.split(l,3,l.rank-1),[y,v]=D.split(f,2,f.rank-1);s=this.recurrentActivation.apply(D.add(p,y)),o=this.recurrentActivation.apply(D.add(g,v));const b=ri(D.mul(o,r),h);u=this.activation.apply(D.add(m,b));const x=D.add(D.mul(s,r),D.mul(D.add(1,D.neg(s)),u));return[x,x]}))}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Cs(this.activation),recurrentActivation:Cs(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Di(this.kernelInitializer),recurrentInitializer:Di(this.recurrentInitializer),biasInitializer:Di(this.biasInitializer),kernelRegularizer:Ns(this.kernelRegularizer),recurrentRegularizer:Ns(this.recurrentRegularizer),biasRegularizer:Ns(this.biasRegularizer),activityRegularizer:Ns(this.activityRegularizer),kernelConstraint:Ar(this.kernelConstraint),recurrentConstraint:Ar(this.recurrentConstraint),biasConstraint:Ar(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,t)}}co.className="GRUCell",D.serialization.registerClass(co);class ho extends so{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new co(e),super(e)}call(e,t){return(0,D.tidy)((()=>{null!=this.cell.dropoutMask&&(D.dispose(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(D.dispose(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,r=null==t?null:t.training,i=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:i})}))}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}ho.className="GRU",D.serialization.registerClass(ho);class fo extends oo{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,mr(this.units,"units"),this.activation=Es(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Es(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=Ni(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ni(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ni(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Ts(e.kernelRegularizer),this.recurrentRegularizer=Ts(e.recurrentRegularizer),this.biasRegularizer=Ts(e.biasRegularizer),this.kernelConstraint=Fr(e.kernelConstraint),this.recurrentConstraint=Fr(e.recurrentConstraint),this.biasConstraint=Fr(e.biasConstraint),this.dropout=Gr([1,qr([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=Gr([1,qr([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;const n=(e=Li(e))[e.length-1];let r;if(this.kernel=this.addWeight("kernel",[n,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){const e=this.biasInitializer,n=this.units;r=new((t=class extends hi{apply(t,r){const i=e.apply([n]),a=(new pi).apply([n]),s=e.apply([2*n]);return ei(ei(i,a),s)}}).className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return(0,D.tidy)((()=>{const n=null!=t.training&&t.training;if(3!==(e=e).length)throw new Qn(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=mo({ones:()=>D.onesLike(e),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=mo({ones:()=>D.onesLike(r),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const a=this.dropoutMask,s=this.recurrentDropoutMask;let o,u,l,c;0<this.dropout&&this.dropout<1&&(e=D.mul(e,a[0]));let d=ri(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=D.mul(r,s[0])),d=D.add(d,ri(r,this.recurrentKernel.read())),this.useBias&&(d=oi(d,this.bias.read()));const[h,f,p,g]=D.split(d,4,d.rank-1);o=this.recurrentActivation.apply(h),u=this.recurrentActivation.apply(f),l=D.add(D.mul(u,i),D.mul(o,this.activation.apply(p))),c=this.recurrentActivation.apply(g);const m=D.mul(c,this.activation.apply(l));return[m,m,l]}))}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Cs(this.activation),recurrentActivation:Cs(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Di(this.kernelInitializer),recurrentInitializer:Di(this.recurrentInitializer),biasInitializer:Di(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Ns(this.kernelRegularizer),recurrentRegularizer:Ns(this.recurrentRegularizer),biasRegularizer:Ns(this.biasRegularizer),activityRegularizer:Ns(this.activityRegularizer),kernelConstraint:Ar(this.kernelConstraint),recurrentConstraint:Ar(this.recurrentConstraint),biasConstraint:Ar(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,t)}}fo.className="LSTMCell",D.serialization.registerClass(fo);class po extends so{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new fo(e),super(e)}call(e,t){return(0,D.tidy)((()=>{null!=this.cell.dropoutMask&&(D.dispose(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(D.dispose(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,r=null==t?null:t.training,i=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:i})}))}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}po.className="LSTM",D.serialization.registerClass(po);class go extends oo{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return(0,D.tidy)((()=>{let n=(e=e).slice(1);const r=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?r.push(n.splice(0,e.stateSize.length)):r.push(n.splice(0,1));r.reverse();const i=[];let a;for(let s=0;s<this.cells.length;++s){const o=this.cells[s];n=r[s],a=0===s?[e[0]].concat(n):[a[0]].concat(n),a=o.call(a,t),i.push(a.slice(1))}n=[];for(const e of i.slice().reverse())n.push(...e);return[a[0]].concat(n)}))}build(e){let t;Ri(e)&&(e=e[0]),e=e,this.cells.forEach(((n,r)=>{Lr(`RNNCell_${r}`,(()=>{n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0}getConfig(){const e=super.getConfig(),t={cells:this.cells.map((e=>({className:e.getClassName(),config:e.getConfig()})))};return Object.assign({},e,t)}static fromConfig(e,t,n={}){const r=[];for(const e of t.cells)r.push(la(e,n));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return Ui(e)}setWeights(e){const t=[];for(const n of this.cells){const r=n.weights.length,i=e.splice(r);for(let e=0;e<n.weights.length;++e)t.push([n.weights[e],i[e]])}Wi(t)}}function mo(e){const{ones:t,rate:n,training:r=!1,count:i=1,dropoutFunc:a}=e,s=()=>null!=a?a(t(),n):ui(t(),n),o=()=>li(s,t,r);return!i||i<=1?D.keep(o().clone()):Array(i).fill(void 0).map(o).map((e=>D.keep(e.clone())))}go.className="StackedRNNCells",D.serialization.registerClass(go);var yo,vo;class bo extends so{constructor(e){if(e.unroll)throw new Jn("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Jn("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Vi({ndim:5})]}call(e,t){return D.tidy((()=>{if(null!=this.cell.dropoutMask&&(D.dispose(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(D.dispose(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new Qn("ConvRNN2D cell does not support constants");const n=null==t?null:t.mask,r=null==t?null:t.training,i=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:i})}))}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return D.tidy((()=>{const{stateSize:t}=this.cell,n=e.shape,r=this.computeSingleOutputShape(n),i=[r[0],...r.slice(2)],a=D.zeros(i);return Array.isArray(t)?Array(t.length).fill(a):[a]}))}resetStates(e,t=!1){D.tidy((()=>{if(!this.stateful)throw new Kn("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape,r=this.computeSingleOutputShape(n),i=[r[0],...r.slice(2)];if(null==n[0])throw new Qn("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.getStates())Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>D.zeros(i))):this.states_=[D.zeros(i)];else if(null==e)D.dispose(this.states_),null!=this.keptStates&&(D.dispose(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>D.zeros(i))):this.states_[0]=D.zeros(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new Qn(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):D.dispose(this.states_);for(let t=0;t<this.states_.length;++t){const n=e[t],r=i;if(!D.util.arraysEqual(n.shape,r))throw new Qn(`State ${t} is incompatible with layer ${this.name}: expected shape=${r}, received shape=${n.shape}`);this.states_[t]=n}}this.states_=this.states_.map((e=>D.keep(e.clone())))}))}computeSingleOutputShape(e){const{dataFormat:t,filters:n,kernelSize:r,padding:i,strides:a,dilationRate:s}=this.cell,o="channelsFirst"===t,u=e[o?3:2],l=e[o?4:3],c=js(u,r[0],i,a[0],s[0]),d=js(l,r[1],i,a[1],s[1]);return[...e.slice(0,2),...o?[n,c,d]:[c,d,n]]}}bo.className="ConvRNN2D";class xo extends fo{constructor(e){const{filters:t,kernelSize:n,strides:r,padding:i,dataFormat:a,dilationRate:s}=e;super(Object.assign({},e,{units:t})),this.filters=t,mr(this.filters,"filters"),this.kernelSize=Ps(n,2,"kernelSize"),this.kernelSize.forEach((e=>mr(e,"kernelSize"))),this.strides=Ps(r||1,2,"strides"),this.strides.forEach((e=>mr(e,"strides"))),this.padding=i||"valid",Rr(this.padding),this.dataFormat=a||"channelsLast",Mr(this.dataFormat),this.dilationRate=Ps(s||1,2,"dilationRate"),this.dilationRate.forEach((e=>mr(e,"dilationRate")))}build(e){var t;e=Li(e);const n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new Qn(`The channel dimension of the input should be defined. Found ${e[n]}`);const r=e[n],i=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let e;if(this.unitForgetBias){const n=this.biasInitializer,r=this.filters;e=new((t=class extends hi{apply(e,t){return Zr([n.apply([r]),D.ones([r]),n.apply([2*r])])}}).className="CustomInit",t)}else e=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,e,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return D.tidy((()=>{if(3!==e.length)throw new Qn(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const n=t.training||!1,r=e[0],i=e[1],a=e[2];0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=mo({ones:()=>D.onesLike(r),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,o=(e,t,n)=>t&&t[n]?D.mul(t[n],e):e;let u=o(r,s,0),l=o(r,s,1),c=o(r,s,2),d=o(r,s,3);0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=mo({ones:()=>D.onesLike(i),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const h=this.recurrentDropoutMask;let f=o(i,h,0),p=o(i,h,1),g=o(i,h,2),m=o(i,h,3);const[y,v,b,x]=D.split(this.kernel.read(),4,3),[w,k,_,S]=this.useBias?D.split(this.bias.read(),4):[null,null,null,null];u=this.inputConv(u,y,w,this.padding),l=this.inputConv(l,v,k,this.padding),c=this.inputConv(c,b,_,this.padding),d=this.inputConv(d,x,S,this.padding);const[C,A,E,F]=D.split(this.recurrentKernel.read(),4,3);f=this.recurrentConv(f,C),p=this.recurrentConv(p,A),g=this.recurrentConv(g,E),m=this.recurrentConv(m,F);const I=this.recurrentActivation.apply(D.add(u,f)),N=this.recurrentActivation.apply(D.add(l,p)),$=D.add(D.mul(N,a),D.mul(I,this.activation.apply(D.add(c,g)))),T=D.mul(this.recurrentActivation.apply(D.add(d,m)),this.activation.apply($));return[T,T,$]}))}getConfig(){const e=super.getConfig(),{units:t}=e,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},n,r)}inputConv(e,t,n,r){const i=D.conv2d(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?oi(i,n,this.dataFormat):i}recurrentConv(e,t){return D.conv2d(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}xo.className="ConvLSTM2DCell",D.serialization.registerClass(xo);class wo extends bo{constructor(e){const t=new xo(e);super(Object.assign({},e,{cell:t}))}static fromConfig(e,t){return new e(t)}}wo.className="ConvLSTM2D",D.serialization.registerClass(wo);class ko extends Ki{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(null==this.noiseShape)return this.noiseShape;const t=e.shape,n=[];for(let e=0;e<this.noiseShape.length;++e)n.push(null==this.noiseShape[e]?t[e]:this.noiseShape[e]);return n}call(e,t){return(0,D.tidy)((()=>{this.invokeCallHook(e,t);const n=zi(e);if(0<this.rate&&this.rate<1){const e=null!=t.training&&t.training,r=this.getNoiseShape(n);return li((()=>ui(n,this.rate,r,this.seed)),(()=>n),e)}return e}))}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}ko.className="Dropout",D.serialization.registerClass(ko);class _o extends ko{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}_o.className="SpatialDropout1D",D.serialization.registerClass(_o);class So extends Ki{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){let t=null;null!=e.batchSize&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,mr(this.units,"units"),this.activation=Es(e.activation),null!=e.useBias&&(this.useBias=e.useBias),this.kernelInitializer=Ni(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Ni(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Fr(e.kernelConstraint),this.biasConstraint=Fr(e.biasConstraint),this.kernelRegularizer=Ts(e.kernelRegularizer),this.biasRegularizer=Ts(e.biasRegularizer),this.activityRegularizer=Ts(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){const t=(e=Li(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){const t=(e=Li(e)).slice();return t[t.length-1]=this.units,t}call(e,t){return(0,D.tidy)((()=>{this.invokeCallHook(e,t);const n=zi(e),r=vr(this.activation.getClassName());let i;return null!=r?i=ri(n,this.kernel.read(),r,this.bias?this.bias.read():null):(i=ri(n,this.kernel.read()),null!=this.bias&&(i=oi(i,this.bias.read())),null!=this.activation&&(i=this.activation.apply(i))),i}))}getConfig(){const e={units:this.units,activation:Cs(this.activation),useBias:this.useBias,kernelInitializer:Di(this.kernelInitializer),biasInitializer:Di(this.biasInitializer),kernelRegularizer:Ns(this.kernelRegularizer),biasRegularizer:Ns(this.biasRegularizer),activityRegularizer:Ns(this.activityRegularizer),kernelConstraint:Ar(this.kernelConstraint),biasConstraint:Ar(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}So.className="Dense",D.serialization.registerClass(So);class Co extends Ki{constructor(e){super(e=e||{}),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Li(e);for(const t of e.slice(1))if(null==t)throw new Qn(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Vr(e,1)]}call(e,t){return(0,D.tidy)((()=>{this.invokeCallHook(e,t);let n=zi(e);if("channelsFirst"===this.dataFormat&&n.rank>1){const e=[0];for(let t=2;t<n.rank;++t)e.push(t);e.push(1),n=(0,D.transpose)(n,e)}return function(e){if(e.rank<=1)throw new Qn(`batchFlatten requires a minimum rank of 2. Got rank: ${e.rank}.`);const t=[e.shape[0],Vr(e.shape,1)];return D.reshape(e,t)}(n)}))}getConfig(){const e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}Co.className="Flatten",D.serialization.registerClass(Co);class Ao extends Ki{constructor(e){super(e),this.supportsMasking=!0,this.activation=Es(e.activation)}call(e,t){return(0,D.tidy)((()=>{this.invokeCallHook(e,t);const n=zi(e);return this.activation.apply(n)}))}getConfig(){const e={activation:Cs(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}Ao.className="Activation",D.serialization.registerClass(Ao);class Eo extends Ki{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return(0,D.tidy)((()=>{return e=zi(e),t=e,n=this.n,(0,D.tidy)((()=>{if(2!==t.shape.length)throw new Qn(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);return ti(Kr(t,1),[1,n,1])}));var t,n}))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}Eo.className="RepeatVector",D.serialization.registerClass(Eo);class Fo extends Ki{constructor(e){super(e),this.targetShape=e.targetShape;for(let e=0;e<this.targetShape.length;++e)this.isUnknown(this.targetShape[e])&&(this.targetShape[e]=null)}isUnknown(e){return e<0||null==e}fixUnknownDimension(e,t){const n="Total size of new array must be unchanged.",r=t.slice();let i=1,a=null;for(let e=0;e<r.length;++e){const t=r[e];if(this.isUnknown(t)){if(null!==a)throw new Qn("Can only specifiy one unknown dimension.");a=e}else i*=t}const s=Vr(e);if(null!==a){if(0===i||s%i!=0)throw new Qn(n);r[a]=s/i}else if(s!==i)throw new Qn(n);return r}computeOutputShape(e){let t=!1;for(let n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return(0,D.tidy)((()=>{this.invokeCallHook(e,t);const n=zi(e),r=n.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return(0,D.reshape)(n,i)}))}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}Fo.className="Reshape",D.serialization.registerClass(Fo);class Io extends Ki{constructor(e){if(super(e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=Hr(1,e.dims.length+1);if(!D.util.arraysEqual(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Vi({ndim:this.dims.length+1})]}computeOutputShape(e){const t=(e=Li(e)).slice();return this.dims.forEach(((n,r)=>{t[r+1]=e[n]})),t}call(e,t){return(0,D.transpose)(zi(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}Io.className="Permute",D.serialization.registerClass(Io);class Do extends Ki{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,this.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const n=zi(e);return(0,D.any)((0,D.notEqual)(n,this.maskValue),-1)}call(e,t){return(0,D.tidy)((()=>{this.invokeCallHook(e,t);const n=zi(e),r=(0,D.any)((0,D.notEqual)(n,this.maskValue),-1,!0);return(0,D.mul)(n,(0,D.cast)(r,n.dtype))}))}}Do.className="Masking",D.serialization.registerClass(Do);class No extends Ki{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){let t=null;null!=e.batchSize&&(t=e.batchSize),null==e.inputLength?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(ir(e.inputLength))}this.inputDim=e.inputDim,mr(this.inputDim,"inputDim"),this.outputDim=e.outputDim,mr(this.outputDim,"outputDim"),this.embeddingsInitializer=Ni(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Ts(e.embeddingsRegularizer),this.activityRegularizer=Ts(e.activityRegularizer),this.embeddingsConstraint=Fr(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return(0,D.tidy)((()=>this.maskZero?(e=zi(e),(0,D.notEqual)(e,(0,D.zerosLike)(e))):null))}computeOutputShape(e){if(e=Li(e),null==this.inputLength)return[...e,this.outputDim];const t=ir(this.inputLength);if(t.length!==e.length-1)throw new Qn(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let n=0;for(let r=0;r<t.length;++r){const i=t[r],a=e[r+1];if(null!=i&&null!=a&&i!==a)throw new Qn(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);null==i&&(t[n]=a),n++}}return[e[0],...t,this.outputDim]}call(e,t){return(0,D.tidy)((()=>{this.invokeCallHook(e,t);let n=zi(e);"int32"!==n.dtype&&(n=Xr(n,"int32"));const r=ii(this.embeddings.read(),(0,D.reshape)(n,[n.size]));return(0,D.reshape)(r,Li(this.computeOutputShape(n.shape)))}))}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Di(this.embeddingsInitializer),embeddingsRegularizer:Ns(this.embeddingsRegularizer),activityRegularizer:Ns(this.activityRegularizer),embeddingsConstraint:Ar(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}No.className="Embedding",D.serialization.registerClass(No);class $o extends Ki{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new Jn}computeElementwiseOpOutputShape(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;const n=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const i=e[e.length-t.length+r],a=t[r];if(null==i||null==a||i<0||a<0)n.push(null);else if(1===i)n.push(a);else if(1===a)n.push(i);else{if(i!==a)throw new Qn("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(i)}}return n}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Li(e)]),(e=e).length<2)throw new Qn(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const n of e)null!=n&&null!==n[0]&&t.push(n[0]);if(t=hr(t),t.length>1)throw new Qn(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let n=null==e[0]?null:e[0].slice(1);for(let t=1;t<e.length;++t){const r=null==e[t]?null:e[t].slice(1);n=this.computeElementwiseOpOutputShape(n,r)}const r=e.map((e=>e.length));-1===e.indexOf(null)&&1===hr(r).length?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return(0,D.tidy)((()=>{if(e=e,this.reshapeRequired){const t=[],n=e.map((e=>e.rank));if(-1===n.indexOf(null)){const r=qr(n);for(let n of e){const e=n.rank;for(let t=0;t<r-e;++t)n=Kr(n,1);t.push(n)}return this.mergeFunction(t)}{let n=!1;for(const r of e){const e=r.rank;if(null==e){const e=r.shape,i=e[0],a=e.slice(1).concat([i]);let s=D.reshape(r,[i].concat(Vr(e.slice(1))));s=D.transpose(s,[1,0]),s=D.reshape(s,a),t.push(s),n=!0}else if(e>1){const i=Hr(1,e).concat([0]);t.push(D.transpose(r,i)),n=!0}else t.push(r)}let r=this.mergeFunction(t);const i=r.rank;if(n)if(null==i){const e=r.shape,t=e[e.length-1],n=[t].concat(e.slice(0,e.length-1));r=D.reshape(D.transpose(D.reshape(r,[-1,t]),[1,0]),n)}else if(i>1){const e=[i-1].concat(Hr(0,i-1));r=D.transpose(r,e)}return r}}return this.mergeFunction(e)}))}computeOutputShape(e){let t;t=null==(e=e)[0]?null:e[0].slice(1);for(let n=1;n<e.length;++n){const r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}let n=[];for(const t of e)null!=t&&null!==t[0]&&n.push(t[0]);return n=hr(n),t=1===n.length?n.concat(t):[null].concat(t),t}computeMask(e,t){return D.tidy((()=>{if(null==t)return null;if(!Array.isArray(t))throw new Qn("`mask` should be an Array");if(!Array.isArray(e))throw new Qn("`inputs` should be an Array");if(t.length!==e.length)throw new Qn(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every((e=>null==e)))return null;let n=(t=t.map((e=>null==e?e:D.expandDims(e,0))))[0];for(let e=1;e<t.length-1;++e)n=D.logicalAnd(n,t[e]);return n}))}}class To extends $o{constructor(e){super(e)}mergeFunction(e){return(0,D.tidy)((()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=D.add(t,e[n]);return t}))}}To.className="Add",D.serialization.registerClass(To);class Oo extends $o{constructor(e){super(e)}mergeFunction(e){return(0,D.tidy)((()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=D.mul(t,e[n]);return t}))}}Oo.className="Multiply",D.serialization.registerClass(Oo);class Mo extends $o{constructor(e){super(e)}mergeFunction(e){return(0,D.tidy)((()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=D.add(t,e[n]);return D.mul(1/e.length,t)}))}}Mo.className="Average",D.serialization.registerClass(Mo);class Ro extends $o{constructor(e){super(e)}mergeFunction(e){return(0,D.tidy)((()=>{let t=e[0];for(let n=1;n<e.length;++n)t=D.maximum(t,e[n]);return t}))}}Ro.className="Maximum",D.serialization.registerClass(Ro);class Bo extends $o{constructor(e){super(e)}mergeFunction(e){return(0,D.tidy)((()=>{let t=e[0];for(let n=1;n<e.length;++n)t=D.minimum(t,e[n]);return t}))}}Bo.className="Minimum",D.serialization.registerClass(Bo);class zo extends $o{constructor(e){super(e),this.DEFAULT_AXIS=-1,null==e&&(e={}),this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new Qn("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const n of e)if(null!=n){t=!1;break}if(t)return;const n=[];for(let t=0;t<e.length;++t){const r=e[t].slice();r.splice(this.axis,1);let i=!1;for(const e of n)if(D.util.arraysEqual(e,r)){i=!0;break}i||n.push(r)}if(n.length>1)throw new Qn("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return(0,D.tidy)((()=>Zr(e,this.axis)))}computeOutputShape(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new Qn("A `Concatenate` layer should be called on a list of inputs.");const t=e,n=t[0].slice(),r=this.axis<0?n.length+this.axis:this.axis;for(const e of t.slice(1)){if(null==n[r]||null==e[r]){n[r]=null;break}n[r]+=e[r]}return n}computeMask(e,t){if(null==t)return null;if(!Array.isArray(t))throw new Qn("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new Qn("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new Qn(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return D.tidy((()=>{let n=!0;if(t.forEach((e=>{null==e||(n=!1)})),n)return null;const r=[];for(let n=0;n<e.length;++n)null==t[n]?r.push(D.cast(D.onesLike(e[n]),"bool")):t[n].rank<e[n].rank?r.push(D.expandDims(t[n],-1)):r.push(t[n]);const i=D.concat(r,this.axis);return D.all(i,-1,!1)}))}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function Lo(e,t){for(;e<0;)e+=t;return e}zo.className="Concatenate",D.serialization.registerClass(zo);class Po extends $o{constructor(e){super(e),this.axes=e.axes,this.normalize=null!=e.normalize&&e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){D.util.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const t=e[0],n=e[1];if(t.length>3||n.length>3)throw new Jn("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new Qn(`Dimension incompatibility: ${t[r[0]]} !== ${n[r[1]]}`)}mergeFunction(e){if(2!==e.length)throw new Qn(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map(((t,n)=>Lo(t,e[n].shape.length))):[Lo(this.axes,n.shape.length),Lo(this.axes,r.shape.length)],this.normalize&&(n=ca(n,t[0]),r=ca(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new Jn("batchDot is not implemented for tensors of 4D or higher rank yet");if(D.util.assert(e.shape.length>=2,(()=>`batchDot requires the rank of x to be >= 2, but got ${e.shape.length}`)),D.util.assert(e.shape.length>=2,(()=>`batchDot requires the rank of y to be >= 2, but got ${t.shape.length}`)),"number"==typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new Jn("batchDot is not implemented for complex64-type Tensors yet.");const r=e.shape.length,i=t.shape.length;null==n&&(n=[r-1,i-2]);const a=n;return D.tidy((()=>{let n,s;if(r>i){n=r-i;const e=[];for(let t=0;t<n;++t)e.push(1);t=D.reshape(t,t.shape.concat(e))}else if(i>r){n=i-r;const t=[];for(let e=0;e<n;++e)t.push(1);e=D.reshape(e,e.shape.concat(t))}else n=0;if(2===e.shape.length&&2===t.shape.length)s=a[0]===a[1]?D.sum(D.mul(e,t),a[0]):D.sum(D.mul(D.transpose(e,[1,0]),t),a[1]);else{const n=a[0]!==e.shape.length-1,r=a[1]===t.shape.length-1;s=D.matMul(e,t,n,r)}if(n>0){let e;e=r>i?r+i-3:r-1;const t=[];for(let r=e;r<e+n;++r)t.push(r);s=D.squeeze(s,t)}return 1===s.shape.length&&(s=D.expandDims(s,1)),s}))}(n,r,t)}interpretAxes(e,t){let n;return n=Array.isArray(this.axes)?this.axes:[Lo(this.axes,e.length),Lo(this.axes,t.length)],n}computeOutputShape(e){D.util.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new Jn("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);const i=t.concat(n);return 1===i.length&&i.push(1),i}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}Po.className="Dot",D.serialization.registerClass(Po);class jo extends Ki{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return(0,D.tidy)((()=>{this.invokeCallHook(e,t);const n=zi(e);return li((()=>(0,D.add)(ni(n.shape,0,this.stddev),n)),(()=>n),t.training||!1)}))}}jo.className="GaussianNoise",D.serialization.registerClass(jo);class Uo extends Ki{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return(0,D.tidy)((()=>{this.invokeCallHook(e,t);const n=zi(e);return this.rate>0&&this.rate<1?li((()=>{const e=Math.sqrt(this.rate/(1-this.rate));return(0,D.mul)(n,ni(n.shape,1,e))}),(()=>n),t.training||!1):n}))}}Uo.className="GaussianDropout",D.serialization.registerClass(Uo);class Wo extends Ki{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||zi(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return(0,D.tidy)((()=>{if(this.rate<1&&this.rate>0){const n=this._getNoiseShape(e);return li((()=>{const t=zi(e),r=-1.7580993408473766;let i=(0,D.greaterEqual)((0,D.randomUniform)(n),this.rate);i=Xr(i,"float32");const a=((1-this.rate)*(1+this.rate*r**2))**-.5,s=-a*r*this.rate,o=(0,D.add)((0,D.mul)(t,i),(0,D.mul)((0,D.add)(i,-1),r));return(0,D.add)((0,D.mul)(o,a),s)}),(()=>zi(e)),t.training||!1)}return e}))}}function Vo(e,t,n,r,i,a=.001){let s;if(2===e.rank)s=D.batchNorm2d(e,t,n,r,i,a);else if(3===e.rank)s=D.batchNorm3d(e,t,n,r,i,a);else{if(4!==e.rank)throw new Jn(`batchNormalization is not implemented for array of rank ${e.rank} yet`);s=D.batchNorm4d(e,t,n,r,i,a)}return s}Wo.className="AlphaDropout",D.serialization.registerClass(Wo);class Go extends Ki{constructor(e){null==e&&(e={}),super(e),this.supportsMasking=!0,this.axis=null==e.axis?-1:e.axis,this.momentum=null==e.momentum?.99:e.momentum,this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=Ni(e.betaInitializer||"zeros"),this.gammaInitializer=Ni(e.gammaInitializer||"ones"),this.movingMeanInitializer=Ni(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Ni(e.movingVarianceInitializer||"ones"),this.betaConstraint=Fr(e.betaConstraint),this.gammaConstraint=Fr(e.gammaConstraint),this.betaRegularizer=Ts(e.betaRegularizer),this.gammaRegularizer=Ts(e.gammaRegularizer)}build(e){e=Li(e);const t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new Qn(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Vi({ndim:e.length,axes:{[t]:n}})];const r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return(0,D.tidy)((()=>{const n=null!=t.training&&t.training,r=zi(e),i=r.shape,a=i.length,s=Hr(0,a),o=this.axis>=0?this.axis:this.axis+a;s.splice(o,1);const u=er(1,a);u[o]=i[o];const l=s.slice();l.sort();const c=!D.util.arraysEqual(l,Hr(0,a).slice(0,a-1));if(!n)return(()=>{if(c){const e=(0,D.reshape)(this.movingMean.read(),u),t=(0,D.reshape)(this.movingVariance.read(),u),n=this.center?(0,D.reshape)(this.beta.read(),u):null,i=this.scale?(0,D.reshape)(this.gamma.read(),u):null;return Vo(r,e,t,n,i,this.epsilon)}return Vo(r,this.movingMean.read(),this.movingVariance.read(),null==this.beta?null:this.beta.read(),null==this.gamma?null:this.gamma.read(),this.epsilon)})();const[d,h,f]=function(e,t,n,r,i=.001){return D.util.arraysEqual(r.slice().sort(),Hr(0,e.rank-1))?function(e,t,n,r,i=.001){return(0,D.tidy)((()=>{const a=D.moments(e,r),s=a.mean,o=a.variance;return[Vo(e,s,o,n,t,i),s,o]}))}(e,t,n,r,i):function(e,t,n,r,i=.001){return(0,D.tidy)((()=>{const a=D.moments(e,r),s=a.mean,o=a.variance,u=[];for(const t of Hr(0,e.rank))-1!==r.indexOf(t)?u.push(1):u.push(e.shape[t]);const l=(0,D.reshape)(s,u),c=(0,D.reshape)(o,u),d=null==t?null:(0,D.reshape)(t,u),h=null==n?null:(0,D.reshape)(n,u);return[Vo(e,l,c,h,d,i),s,o]}))}(e,t,n,r,i)}(r,this.gamma.read(),this.beta.read(),s,this.epsilon),p=(e,t,n)=>{D.tidy((()=>{const r=1-n,i=e.read(),a=D.mul(D.sub(i,t),r);e.write(D.sub(i,a))}))};return(()=>{p(this.movingMean,h,this.momentum),p(this.movingVariance,f,this.momentum)})(),d}))}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Di(this.betaInitializer),gammaInitializer:Di(this.gammaInitializer),movingMeanInitializer:Di(this.movingMeanInitializer),movingVarianceInitializer:Di(this.movingVarianceInitializer),betaRegularizer:Ns(this.betaRegularizer),gammaRegularizer:Ns(this.gammaRegularizer),betaConstraint:Ar(this.betaConstraint),gammaConstraint:Ar(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}Go.className="BatchNormalization",D.serialization.registerClass(Go);class qo extends Ki{constructor(e){if(null==e&&(e={}),super(e),this.axis=null==e.axis?-1:e.axis,"number"==typeof this.axis){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else{if(!Array.isArray(this.axis))throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);for(const e of this.axis)if(!Number.isInteger(e))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=Ni(e.betaInitializer||"zeros"),this.gammaInitializer=Ni(e.gammaInitializer||"ones"),this.betaRegularizer=Ts(e.betaRegularizer),this.gammaRegularizer=Ts(e.gammaRegularizer),this.supportsMasking=!0}build(e){const t=(e=Li(e)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(let e=0;e<this.axis.length;++e)this.axis[e]<0&&(this.axis[e]+=t);for(const e of this.axis)if(e<0||e>=t)throw new Error(`Invalid axis: ${e}`);if(this.axis.length!==hr(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const n=this.axis.map((t=>e[t]));this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,!0):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,!0):this.beta=null,this.built=!0}call(e,t){const n=zi(e),r=n.shape,i=r.length;return(0,D.tidy)((()=>{let{mean:e,variance:t}=(0,D.moments)(n,this.axis,!0);const a=er(1,i);for(const e of this.axis)a[e]=r[e];const s=e=>null!=e&&e.shape.length!==i?D.reshape(e,a):e;let o=s(this.gamma.read()),u=s(this.beta.read());const l=[],c=[];for(let e=0;e<i;++e)-1!==this.axis.indexOf(e)?(l.push(r[e]),c.push(1)):(l.push(1),c.push(r[e]));return e=D.tile(e,l),t=D.tile(t,l),o=D.tile(o,c),u=D.tile(u,c),Vo(n,e,t,u,o,this.epsilon)}))}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Di(this.betaInitializer),gammaInitializer:Di(this.gammaInitializer),betaRegularizer:Ns(this.betaRegularizer),gammaRegularizer:Ns(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}qo.className="LayerNormalization",D.serialization.registerClass(qo);class Ho extends Ki{constructor(e){if(null==e&&(e={}),super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)this.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new Qn(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,n;if("number"==typeof e.padding[0])t=[e.padding[0],e.padding[0]],n=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new Qn(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],2!==e.padding[1].length)throw new Qn(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);n=e.padding[1]}this.padding=[t,n]}this.inputSpec=[new Vi({ndim:4})]}computeOutputShape(e){let t,n;return e=Li(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}call(e,t){return(0,D.tidy)((()=>{return t=zi(e),n=this.padding,r=this.dataFormat,(0,D.tidy)((()=>{if(4!==t.rank)throw new Qn(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(null==n&&(n=[[1,1],[1,1]]),2!==n.length||2!==n[0].length||2!==n[1].length)throw new Qn("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==r&&(r="channelsLast"),"channelsLast"!==r&&"channelsFirst"!==r)throw new Qn(`Unknown data format: ${r}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let e;return e="channelsFirst"===r?[[0,0],[0,0],n[0],n[1]]:[[0,0],n[0],n[1],[0,0]],D.pad(t,e)}));var t,n,r}))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}function Xo(e,t,n,r,i,a){return(0,D.tidy)((()=>{let s;Mr(i),Br(a),Rr(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==i&&(i="channelsLast"),null==a&&(a="max"),e=Ws(e,i);const o="same"===r?"same":"valid";return s="max"===a?D.maxPool(e,t,n,o):D.avgPool(e,t,n,o),"channelsFirst"===i&&(s=D.transpose(s,[0,3,1,2])),s}))}function Ko(e,t,n,r,i,a){return(0,D.tidy)((()=>{let s;Mr(i),Br(a),Rr(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==i&&(i="channelsLast"),null==a&&(a="max"),e=Vs(e,i);const o="same"===r?"same":"valid";return s="max"===a?D.maxPool3d(e,t,n,o):D.avgPool3d(e,t,n,o),"channelsFirst"===i&&(s=D.transpose(s,[0,4,1,2,3])),s}))}Ho.className="ZeroPadding2D",D.serialization.registerClass(Ho);class Yo extends Ki{constructor(e){if(null==e.poolSize&&(e.poolSize=2),super(e),"number"==typeof e.poolSize)this.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new Qn(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);this.poolSize=e.poolSize}if(mr(this.poolSize,"poolSize"),null==e.strides)this.strides=this.poolSize;else if("number"==typeof e.strides)this.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new Qn(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);this.strides=e.strides}mr(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,Rr(this.padding),this.inputSpec=[new Vi({ndim:3})]}computeOutputShape(e){const t=js((e=Li(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return(0,D.tidy)((()=>{this.invokeCallHook(e,t),e=Kr(zi(e),2);const n=this.poolingFunction(zi(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return D.squeeze(n,[2])}))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class Qo extends Yo{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return Mr(i),Rr(r),Xo(e,t,n,r,i,"max")}}Qo.className="MaxPooling1D",D.serialization.registerClass(Qo);class Jo extends Yo{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return Mr(i),Rr(r),Xo(e,t,n,r,i,"avg")}}Jo.className="AveragePooling1D",D.serialization.registerClass(Jo);class Zo extends Ki{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new Qn(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];mr(this.poolSize,"poolSize"),mr(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Mr(this.dataFormat),Rr(this.padding),this.inputSpec=[new Vi({ndim:4})]}computeOutputShape(e){e=Li(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=js(t,this.poolSize[0],this.padding,this.strides[0]),n=js(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}call(e,t){return(0,D.tidy)((()=>(this.invokeCallHook(e,t),this.poolingFunction(zi(e),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class eu extends Zo{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return Mr(i),Rr(r),Xo(e,t,n,r,i,"max")}}eu.className="MaxPooling2D",D.serialization.registerClass(eu);class tu extends Zo{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return Mr(i),Rr(r),Xo(e,t,n,r,i,"avg")}}tu.className="AveragePooling2D",D.serialization.registerClass(tu);class nu extends Ki{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new Qn(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];mr(this.poolSize,"poolSize"),mr(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Mr(this.dataFormat),Rr(this.padding),this.inputSpec=[new Vi({ndim:5})]}computeOutputShape(e){e=Li(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=js(t,this.poolSize[0],this.padding,this.strides[0]),n=js(n,this.poolSize[1],this.padding,this.strides[1]),r=js(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}call(e,t){return(0,D.tidy)((()=>(this.invokeCallHook(e,t),this.poolingFunction(zi(e),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class ru extends nu{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return Mr(i),Rr(r),Ko(e,t,n,r,i,"max")}}ru.className="MaxPooling3D",D.serialization.registerClass(ru);class iu extends nu{constructor(e){super(e)}poolingFunction(e,t,n,r,i){return Mr(i),Rr(r),Ko(e,t,n,r,i,"avg")}}iu.className="AveragePooling3D",D.serialization.registerClass(iu);class au extends Ki{constructor(e){super(e),this.inputSpec=[new Vi({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new Jn}}class su extends au{constructor(e){super(e||{})}call(e,t){return(0,D.tidy)((()=>{const t=zi(e);return D.mean(t,1)}))}}su.className="GlobalAveragePooling1D",D.serialization.registerClass(su);class ou extends au{constructor(e){super(e||{})}call(e,t){return(0,D.tidy)((()=>{const t=zi(e);return D.max(t,1)}))}}ou.className="GlobalMaxPooling1D",D.serialization.registerClass(ou);class uu extends Ki{constructor(e){super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Mr(this.dataFormat),this.inputSpec=[new Vi({ndim:4})]}computeOutputShape(e){return e=e,"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new Jn}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class lu extends uu{call(e,t){return(0,D.tidy)((()=>{const t=zi(e);return"channelsLast"===this.dataFormat?D.mean(t,[1,2]):D.mean(t,[2,3])}))}}lu.className="GlobalAveragePooling2D",D.serialization.registerClass(lu);class cu extends uu{call(e,t){return(0,D.tidy)((()=>{const t=zi(e);return"channelsLast"===this.dataFormat?D.max(t,[1,2]):D.max(t,[2,3])}))}}cu.className="GlobalMaxPooling2D",D.serialization.registerClass(cu);class du extends Ki{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return null!=this.layer&&this.layer.trainable}set trainable(e){null!=this.layer&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,n={}){const r=la(t.layer,n);delete t.layer;const i={layer:r};return Object.assign(i,t),new e(i)}}class hu extends du{constructor(e){super(e),this.supportsMasking=!0}build(e){if((e=Li(e)).length<3)throw new Qn(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){const t=[(e=Li(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}call(e,t){return(0,D.tidy)((()=>ao(((e,n)=>[zi(this.layer.call(e,t)),[]]),e=zi(e),[],!1,null,null,!1,!0)[1]))}}hu.className="TimeDistributed",D.serialization.registerClass(hu);class fu extends du{constructor(e){super(e);const t=e.layer.getConfig(),n={};n.className=e.layer.getClassName(),n.config=t,this.forwardLayer=la(n),t.goBackwards=!0!==t.goBackwards;const r={};var i;if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=la(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,i=this.mergeMode,pr(Tr,"BidirectionalMergeMode",i),e.weights)throw new Jn("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}computeOutputShape(e){let t,n,r,i=this.forwardLayer.computeOutputShape(e);return Array.isArray(i)&&Array.isArray(i[0])||(i=[i]),i=i,this.returnState?(r=i.slice(1),t=i[0]):t=i[0],t=t,"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):rr(n)}apply(e,t){let n=null==t?null:t.initialState,r=null==t?null:t.constants;null==t&&(t={});const i=io(e,n,r,this.numConstants);if(e=i.inputs,n=i.initialState,r=i.constants,Array.isArray(e)&&(n=e.slice(1),e=e[0]),(null==n||0===n.length)&&null==r)return super.apply(e,t);const a=[],s=[];if(null!=n){const e=n.length;if(e%2>0)throw new Qn("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=n,a.push(...n);const r=n.map((e=>new Vi({shape:e.shape})));this.forwardLayer.stateSpec=r.slice(0,e/2),this.backwardLayer.stateSpec=r.slice(e/2),s.push(...r)}if(null!=r)throw new Jn("Support for constants in Bidirectional layers is not implemented yet.");const o=a[0]instanceof Gi;for(const e of a)if(e instanceof Gi!==o)throw new Qn("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(o){const n=[e].concat(a),r=this.inputSpec.concat(s),i=this.inputSpec;this.inputSpec=r;const o=super.apply(n,t);return this.inputSpec=i,o}return super.apply(e,t)}call(e,t){return(0,D.tidy)((()=>{const n=t.initialState;let r,i,a,s;if(null==n)r=this.forwardLayer.call(e,t),i=this.backwardLayer.call(e,t);else{const a=n.slice(0,n.length/2),s=n.slice(n.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:a})),i=this.backwardLayer.call(e,Object.assign(t,{initialState:s}))}return this.returnState&&(Array.isArray(r)&&(a=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=D.reverse(i,1)),"concat"===this.mergeMode?s=Zr([r,i]):"sum"===this.mergeMode?s=D.add(r,i):"ave"===this.mergeMode?s=D.mul(.5,D.add(r,i)):"mul"===this.mergeMode?s=D.mul(r,i):null==this.mergeMode&&(s=[r,i]),this.returnState?null==this.mergeMode?s.concat(a):[s].concat(a):s}))}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Lr(this.forwardLayer.name,(()=>{this.forwardLayer.build(e)})),Lr(this.backwardLayer.name,(()=>{this.backwardLayer.build(e)})),this.built=!0}computeMask(e,t){let n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){const e=this.forwardLayer.states.map((e=>null));return Array.isArray(n)?n.concat(e).concat(e):[n].concat(e).concat(e)}return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const n=la(t.layer);if(delete t.layer,null!=t.numConstants)throw new Jn("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=n,new e(r)}}function pu(e){return new So(e)}fu.className="Bidirectional",D.serialization.registerClass(fu),(0,D.env)().registerFlag("KEEP_INTERMEDIATE_TENSORS",(()=>!1),(e=>{e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(yo||(yo={})),function(e){let t;!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(t=e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(vo||(vo={}));var gu,mu,yu=n(36377);function vu(e,t,n=new Map,r=new Set){if(null==e)return null;if("function"==typeof Blob&&e instanceof Blob)return e.slice();if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);const i=t(e);if(i.recurse&&null!==i.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(i.recurse){if(ku(e)){const i=Array.isArray(e)?[]:{};r.add(e);for(const a in e){const s=vu(e[a],t,n,r);i[a]=s}return r.delete(e),e.__proto__&&(i.__proto__=e.__proto__),i}throw new Error(`Can't recurse into non-iterable type: ${e}`)}return n.set(e,i.value),i.value}function bu(e,t=wu){return xu(e,t)}function xu(e,t,n=new Set){const r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");const i=t(e);if(i.recurse&&null!==i.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(i.recurse){if(ku(r)){const i=Array.isArray(r)?[]:{};n.add(r);for(const a in r){const r=xu(e.map((e=>e[a])),t,n);i[a]=r}return n.delete(r),i}throw new Error(`Can't recurse into non-iterable type: ${r}`)}return i.value}function wu(e){return null===e?null:ku(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function ku(e){let t=!1;if(D.env().get("IS_BROWSER"))t=e instanceof TextDecoder;else{const{StringDecoder:r}=n(34977);t=e instanceof r}return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"==typeof e&&!(e instanceof D.Tensor)&&!(e instanceof Promise)&&!t)}function _u(e){return vu(e,Su)}function Su(e){return e instanceof D.Tensor?{value:e.clone(),recurse:!1}:ku(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}class Cu{constructor(e){if(this.capacity=e,this.begin=0,this.end=0,null==e)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}wrap(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}get(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}set(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}length(){let e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}isFull(){return this.length()===this.capacity}isEmpty(){return 0===this.length()}push(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}pushAll(e){for(const t of e)this.push(t)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const e=this.get(this.end);return this.set(this.end,void 0),e}unshift(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}shuffleExcise(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}class Au extends Cu{constructor(){super(Au.INITIAL_CAPACITY)}isFull(){return!1}push(e){super.isFull()&&this.expand(),super.push(e)}unshift(e){super.isFull()&&this.expand(),super.unshift(e)}expand(){const e=2*this.capacity,t=new Array(e),n=this.length();for(let e=0;e<n;e++)t[e]=this.get(this.wrap(this.begin+e));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}Au.INITIAL_CAPACITY=32;class Eu{async toArray(){const e=[];let t=await this.next();for(;!t.done;)e.push(t.value),t=await this.next();return e}async toArrayForTest(){const e=this.prefetch(100),t=[];let n=await e.next();for(;!n.done;)t.push(n.value),n=await e.next();return t}async resolveFully(){let e=await this.next();for(;!e.done;)e=await this.next()}async resolveWhile(e){let t=await this.next(),n=e(t.value);for(;!t.done&&n;)t=await this.next(),n=e(t.value)}handleErrors(e){return new Ru(this,e)}filter(e){return new Ou(this,e)}map(e){return new Mu(this,e)}mapAsync(e){return new Bu(this,e)}serialMapAsync(e){return new Bu(this,e).serial()}flatmap(e){return new Lu(this,e)}async forEachAsync(e){return this.map(e).resolveFully()}async serialForEach(e){return this.serialMapAsync(e).resolveWhile((e=>!0===e))}rowMajorBatch(e,t=!0){return new Tu(this,e,t)}columnMajorBatch(e,t=!0,n=wu){return this.rowMajorBatch(e,t).map((e=>bu(e,n)))}concatenate(e,t){return new Pu(new Fu([this,e]),t)}take(e){return e<0||null==e?this:new $u(this,e)}skip(e){return e<0||null==e?this:new Nu(this,e)}prefetch(e){return new ju(this,e)}shuffle(e,t){return new Uu(this,e,t)}serial(){return new Du(this)}}class Fu extends Eu{constructor(e){super(),this.items=e,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const e=this.items[this.trav];return this.trav++,{value:_u(e),done:!1}}}class Iu extends Eu{constructor(e){super(),this.nextFn=e}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(e){throw e.message=`Error thrown while iterating through a dataset: ${e.message}`,e}}}class Du extends Eu{constructor(e){super(),this.upstream=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Serial`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){return this.upstream.next()}}class Nu extends Eu{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Skip`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){const e=await this.upstream.next();if(e.done)return e;D.dispose(e.value)}return this.upstream.next()}}class $u extends Eu{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0}summary(){return`${this.upstream.summary()} -> Take`}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class Tu extends Eu{constructor(e,t,n=!0){super(),this.upstream=e,this.batchSize=t,this.enableSmallLastBatch=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> RowMajorBatch`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){const e=[];for(;e.length<this.batchSize;){const t=await this.upstream.next();if(t.done)return this.enableSmallLastBatch&&e.length>0?{value:e,done:!1}:{value:null,done:!0};e.push(t.value)}return{value:e,done:!1}}}class Ou extends Eu{constructor(e,t){super(),this.upstream=e,this.predicate=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Filter`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;;){const e=await this.upstream.next();if(e.done||this.predicate(e.value))return e;D.dispose(e.value)}}}class Mu extends Eu{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> Map`}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=D.tensor_util.getTensorsInContainer(e.value),n=this.transform(e.value),r=D.tensor_util.getTensorsInContainer(n);for(const e of t)D.tensor_util.isTensorInList(e,r)||e.dispose();return{value:n,done:!1}}}class Ru extends Eu{constructor(e,t){super(),this.upstream=e,this.handler=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> handleErrors`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(e){if(!this.handler(e))return{value:null,done:!0}}}}class Bu extends Eu{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> AsyncMap`}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=D.tensor_util.getTensorsInContainer(e.value),n=await this.transform(e.value),r=D.tensor_util.getTensorsInContainer(n);for(const e of t)D.tensor_util.isTensorInList(e,r)||e.dispose();return{value:n,done:!1}}}class zu extends Eu{constructor(){super(),this.outputQueue=new Au,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;0===this.outputQueue.length();)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class Lu extends zu{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> Flatmap`}async pump(){const e=await this.upstream.next();if(e.done)return!1;const t=D.tensor_util.getTensorsInContainer(e.value),n=this.transform(e.value),r=D.tensor_util.getTensorsInContainer(n);this.outputQueue.pushAll(n);for(const e of t)D.tensor_util.isTensorInList(e,r)||e.dispose();return!0}}class Pu extends Eu{constructor(e,t){super(),this.baseErrorHandler=t,this.lastRead=null,this.iterator=null,this.moreIterators=e}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(e){if(await e,null==this.iterator){const e=await this.moreIterators.next();if(e.done)return{value:null,done:!0};this.iterator=e.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const t=await this.iterator.next();return t.done?(this.iterator=null,this.readFromChain(e)):t}}(mu=gu||(gu={}))[mu.FAIL=0]="FAIL",mu[mu.SHORTEST=1]="SHORTEST",mu[mu.LONGEST=2]="LONGEST";class ju extends Eu{constructor(e,t){super(),this.upstream=e,this.bufferSize=t,this.buffer=new Cu(t)}summary(){return`${this.upstream.summary()} -> Prefetch`}refill(){for(;!this.buffer.isFull();){const e=this.upstream.next();this.buffer.push(e)}}next(){return this.refill(),this.buffer.shift()}}class Uu extends ju{constructor(e,t,n){super(e,t),this.upstream=e,this.windowSize=t,this.upstreamExhausted=!1,this.random=yu.alea(n||D.util.now().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}randomInt(e){return Math.floor(this.random()*e)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){const e=this.chooseIndex(),t=await this.buffer.shuffleExcise(e);if(!t.done)return this.refill(),t;this.upstreamExhausted=!0}return{value:null,done:!0}}}class Wu{constructor(){this.size=null}batch(e,t=!0){const n=this;let r;return D.util.assert(e>0,(()=>`batchSize needs to be positive, but it is\n      ${e}`)),r=this.size===1/0||null==this.size?this.size:t?Math.ceil(this.size/e):Math.floor(this.size/e),Vu((async()=>(await n.iterator()).columnMajorBatch(e,t,Gu)),r)}concatenate(e){const t=this;let n;return n=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,Vu((async()=>(await t.iterator()).concatenate(await e.iterator())),n)}filter(e){const t=this;let n;return n=this.size===1/0?1/0:null,Vu((async()=>(await t.iterator()).filter((t=>D.tidy((()=>e(t)))))),n)}async forEachAsync(e){return(await this.iterator()).forEachAsync(e)}map(e){const t=this;return Vu((async()=>(await t.iterator()).map((t=>D.tidy((()=>e(t)))))),this.size)}mapAsync(e){const t=this;return Vu((async()=>(await t.iterator()).mapAsync(e)),this.size)}prefetch(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const t=this;return Vu((async()=>(await t.iterator()).prefetch(e)),this.size)}repeat(e){const t=this;let n;return n=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,Vu((async()=>{return n=(i=async()=>({value:await t.iterator(),done:!1}),new Iu(i)).take(e),new Pu(n,r);var n,r,i}),n)}skip(e){const t=this;let n;return n=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,Vu((async()=>(await t.iterator()).skip(e)),n)}shuffle(e,t,n=!0){if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);const r=this,i=yu.alea(t||D.util.now().toString());return Vu((async()=>{let t=i.int32();return n&&(t+=i.int32()),(await r.iterator()).shuffle(e,t.toString())}),this.size)}take(e){const t=this;let n;return n=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,Vu((async()=>(await t.iterator()).take(e)),n)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}function Vu(e,t=null){return new class extends Wu{constructor(){super(...arguments),this.size=t}async iterator(){return e()}}}function Gu(e){if(null===e)return null;return null==(t=e[0])||null===(n=t)||"object"!=typeof n&&"function"!=typeof n||Array.isArray(t)||"object"==typeof t&&t instanceof D.Tensor||D.util.isTypedArray(t)?{value:function(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof D.Tensor?D.stack(e):D.tensor(e)}(e),recurse:!1}:{value:null,recurse:!0};var t,n}function qu(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>{null!=e&&D.util.assert("complex64"!==e.dtype,(()=>`${t} does not support complex64 tensors in the CPU backend.`))}))}Wu.MAX_BUFFER_SIZE=1e4,Symbol("out"),Symbol("field"),Symbol("quote"),Symbol("quoteafterquote"),Symbol("quoteinquote");const Hu=D.kernel_impls.whereImpl;class Xu extends D.KernelBackend{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new D.DataStorage(this,(0,D.engine)())}nextDataId(){return Xu.nextDataId++}write(e,t,n){this.firstUse&&(this.firstUse=!1,(0,D.env)().get("IS_NODE")&&D.backend_util.warn("\n============================\nHi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&D.util.isString(n[0])){const i=n.map((e=>D.util.encodeString(e)));r=this.write(i,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){this.data.get(e).refCount++}decRef(e){this.data.has(e)&&this.data.get(e).refCount--}move(e,t,n,r,i){this.data.set(e,{values:t,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:n}=this.data.get(e);if("complex64"===t){const e=this.readSync(n.real.dataId),t=this.readSync(n.imag.dataId);return D.backend_util.mergeRealAndImagArrays(e,t)}return this.data.get(e).values}bufferSync(e){const t=this.readSync(e.dataId);let n=t;if("string"===e.dtype)try{n=t.map((e=>D.util.decodeString(e)))}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return(0,D.buffer)(e.shape,e.dtype,n)}makeOutput(e,t,n){const r=this.write(e,t,n);return(0,D.engine)().makeTensorFromDataId(r,t,n,this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:n}=this.data.get(e);null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=D.util.now();return e(),{kernelMs:D.util.now()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){qu([e],"where");const t=this.readSync(e.dataId);return Hu(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}function Ku(e,t,n){return({inputs:r,attrs:i,backend:a})=>{const{x:s}=r;if(qu(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const o=a,u=o.data.get(s.dataId).values,l=D.util.sizeFromShape(s.shape),c=n||s.dtype,d=D.util.getArrayFromDType(c,l);for(let e=0;e<l;++e)d[e]=t(u[e],i);return o.makeTensorInfo(s.shape,c,d)}}function Yu(e,t,n){return({inputs:r,attrs:i,backend:a})=>{const{x:s}=r;if(qu(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const o=a,u=o.data.get(s.dataId).values,l=n||s.dtype,c=t(u,l,i);return o.makeTensorInfo(s.shape,l,c)}}Xu.nextDataId=0,(0,D.registerBackend)("cpu",(()=>new Xu),1);const Qu=Ku(D.Elu,(e=>e>=0?e:Math.exp(e)-1)),Ju={kernelName:D.Elu,backendName:"cpu",kernelFunc:Qu};function Zu(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const el={kernelName:D.Identity,backendName:"cpu",kernelFunc:Zu};function tl(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{alpha:a}=r;qu([i],"leakyRelu");const s=D.util.sizeFromShape(i.shape),o=n.data.get(i.dataId).values,u=D.util.getTypedArrayFromDType("float32",s);for(let e=0;e<o.length;e++)u[e]=o[e]<0?a*o[e]:o[e];return n.makeTensorInfo(i.shape,"float32",u)}const nl={kernelName:D.LeakyRelu,backendName:"cpu",kernelFunc:tl};function rl(e){return(t,n,r,i,a)=>{const s=D.backend_util.assertAndGetBroadcastShape(t,n),o=s.length,u=D.util.computeStrides(s),l=D.util.sizeFromShape(s),c=D.util.getTypedArrayFromDType(a,l),d=t.length,h=n.length,f=D.util.computeStrides(t),p=D.util.computeStrides(n),g=D.backend_util.getBroadcastDims(t,s),m=D.backend_util.getBroadcastDims(n,s);if(g.length+m.length===0)for(let t=0;t<c.length;++t)c[t]=e(r[t%r.length],i[t%i.length]);else for(let t=0;t<c.length;++t){const n=D.util.indexToLoc(t,o,u),a=n.slice(-d);g.forEach((e=>a[e]=0));const s=D.util.locToIndex(a,d,f),l=n.slice(-h);m.forEach((e=>l[e]=0));const y=D.util.locToIndex(l,h,p);c[t]=e(r[s],i[y])}return[c,s]}}const il=rl(((e,t)=>e<0?t*e:e));function al(e){const{inputs:t,backend:n}=e,{x:r,alpha:i}=t;qu([r,i],"prelu");const a=n.data.get(r.dataId).values,s=n.data.get(i.dataId).values,[o,u]=il(r.shape,i.shape,a,s,"float32");return n.makeTensorInfo(u,"float32",o)}const sl={kernelName:D.Prelu,backendName:"cpu",kernelFunc:al},ol=Ku(D.Relu,(e=>Math.max(0,e))),ul={kernelName:D.Relu,backendName:"cpu",kernelFunc:ol},ll=Ku(D.Relu6,(e=>Math.min(Math.max(0,e),6))),cl={kernelName:D.Relu6,backendName:"cpu",kernelFunc:ll};function dl(e){return(t,n,r)=>{const i=D.util.getTypedArrayFromDType(n,t.length);for(let n=0;n<t.length;++n)i[n]=e(t[n],r);return i}}const hl=dl((e=>1/(1+Math.exp(-e)))),fl=Ku(D.Sigmoid,(e=>1/(1+Math.exp(-e)))),pl={kernelName:D.Sigmoid,backendName:"cpu",kernelFunc:fl};function gl(e,t,n,r,i){if("linear"===n)return Zu({inputs:{x:t},backend:e});if("relu"===n)return ol({inputs:{x:t},backend:e});if("elu"===n)return Qu({inputs:{x:t},backend:e});if("relu6"===n)return ll({inputs:{x:t},backend:e});if("prelu"===n)return al({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return tl({inputs:{x:t},backend:e,attrs:{alpha:i}});if("sigmoid"===n)return fl({inputs:{x:t},backend:e});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}function ml(e){const{inputs:t,backend:n}=e,{real:r,imag:i}=t,a=n.data.get(r.dataId).values,s=n.data.get(i.dataId).values,o=n.makeTensorInfo(r.shape,"complex64");return n.data.get(o.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",a),imag:n.makeTensorInfo(i.shape,"float32",s)},o}const yl={kernelName:D.Complex,backendName:"cpu",kernelFunc:ml};function vl(e,t,n="float32"){if("complex64"===n)return ml({inputs:{real:vl(e,t,"float32"),imag:vl(e,t,"float32")},backend:e});const r=D.util.makeZerosTypedArray(D.util.sizeFromShape(t),n);return e.makeTensorInfo(t,n,r)}function bl(e){const{inputs:t,backend:n}=e,{input:r}=t,i=n.data.get(r.dataId).complexTensorInfos.real,a=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,a)}const xl={kernelName:D.Real,backendName:"cpu",kernelFunc:bl};function wl(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dtype:a}=r;if("complex64"===a){if("complex64"===i.dtype)return Zu({inputs:{x:i},backend:n});const e=vl(n,i.shape,i.dtype),t=wl({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),r=ml({inputs:{real:t,imag:e},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),r}if("complex64"===i.dtype){const e=bl({inputs:{input:i},backend:n}),t=wl({inputs:{x:e},backend:n,attrs:{dtype:a}});return n.disposeIntermediateTensorInfo(e),t}if(!D.util.hasEncodingLoss(i.dtype,a)){const e=Zu({inputs:{x:i},backend:n});return{dataId:e.dataId,shape:e.shape,dtype:a}}if("int32"===a){const e=n.data.get(i.dataId).values,t=Int32Array.from(e);return n.makeTensorInfo(i.shape,"int32",t)}if("bool"===a){const e=n.data.get(i.dataId).values,t=D.util.toTypedArray([0],i.dtype),[r,a]=rl(((e,t)=>e!==t?1:0))(i.shape,[],e,t,"bool");return n.makeTensorInfo(a,"bool",r)}throw new Error(`Error in Cast: failed to cast ${i.dtype} to ${a}`)}const kl={kernelName:D.Cast,backendName:"cpu",kernelFunc:wl};function _l(e,t,n,r){return null==n?({inputs:n,backend:i})=>{const{a,b:s}=n,o=i;qu([a,s],e);const u=o.data.get(a.dataId).values,l=o.data.get(s.dataId).values,c="string"===a.dtype?D.backend_util.fromUint8ToStringArray(u):u,d="string"===a.dtype?D.backend_util.fromUint8ToStringArray(l):l,h=r||a.dtype,[f,p]=t(a.shape,s.shape,c,d,h);return o.makeTensorInfo(p,h,f)}:({inputs:e,backend:i})=>{const{a,b:s}=e,o=i;if("complex64"===a.dtype||"complex64"===s.dtype){const e=wl({inputs:{x:a},backend:o,attrs:{dtype:"complex64"}}),t=o.data.get(e.dataId),r=t.complexTensorInfos.real,i=t.complexTensorInfos.imag,u=o.data.get(r.dataId).values,l=o.data.get(i.dataId).values,c=wl({inputs:{x:s},backend:o,attrs:{dtype:"complex64"}}),d=o.data.get(c.dataId),h=d.complexTensorInfos.real,f=d.complexTensorInfos.imag,p=o.data.get(h.dataId).values,g=o.data.get(f.dataId).values,[m,y,v]=n(a.shape,s.shape,u,l,p,g),b=o.makeTensorInfo(v,"float32",m),x=o.makeTensorInfo(v,"float32",y),w=ml({inputs:{real:b,imag:x},backend:o});return o.disposeIntermediateTensorInfo(e),o.disposeIntermediateTensorInfo(c),o.disposeIntermediateTensorInfo(b),o.disposeIntermediateTensorInfo(x),w}{const e=o.data.get(a.dataId).values,n=o.data.get(s.dataId).values,i=r||a.dtype,[u,l]=t(a.shape,s.shape,e,n,i);return o.makeTensorInfo(l,i,u)}}}function Sl(e){return(t,n,r,i,a,s)=>{const o=D.backend_util.assertAndGetBroadcastShape(t,n),u=D.util.sizeFromShape(o),l=o.length,c=D.util.computeStrides(o),d=D.util.getTypedArrayFromDType("float32",u),h=D.util.getTypedArrayFromDType("float32",u),f=D.backend_util.getBroadcastDims(t,o),p=D.backend_util.getBroadcastDims(n,o),g=D.backend_util.mergeRealAndImagArrays(r,i),m=D.backend_util.mergeRealAndImagArrays(a,s),y=t.length,v=D.util.computeStrides(t),b=n.length,x=D.util.computeStrides(n);if(f.length+p.length===0)for(let t=0;t<d.length;t++){const n=t%g.length,r=t%m.length,i=e(g[2*n],g[2*n+1],m[2*r],m[2*r+1]);d[t]=i.real,h[t]=i.imag}else for(let t=0;t<d.length;t++){const n=D.util.indexToLoc(t,l,c),r=n.slice(-y);f.forEach((e=>r[e]=0));const i=D.util.locToIndex(r,y,v),a=n.slice(-b);p.forEach((e=>a[e]=0));const s=D.util.locToIndex(a,b,x),o=e(g[2*i],g[2*i+1],m[2*s],m[2*s+1]);d[t]=o.real,h[t]=o.imag}return[d,h,o]}}const Cl=rl(((e,t)=>e+t)),Al=Sl(((e,t,n,r)=>({real:e+n,imag:t+r}))),El=_l(D.Add,Cl,Al),Fl={kernelName:D.Add,backendName:"cpu",kernelFunc:El};function Il(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{shape:a}=r,s=D.util.sizeFromShape(i.shape),o=D.util.inferFromImplicitShape(a,s),u=D.util.sizeFromShape(o);D.util.assert(s===u,(()=>`The new shape (${o}) has ${u} elements and the old shape (${i.shape}) has ${s} elements. The new shape and old shape must have the same number of elements.`)),n.incRef(i.dataId);const l=n.data.get(i.dataId);if(null!=l.complexTensorInfos){const e=l.complexTensorInfos.real,t=l.complexTensorInfos.imag;e.shape=o,t.shape=o}return{dataId:i.dataId,shape:o,dtype:i.dtype}}const Dl={kernelName:D.Reshape,backendName:"cpu",kernelFunc:Il};function Nl(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:a}=t,{transposeA:s,transposeB:o}=r;qu([i,a],"matMul");const u=i.shape.length,l=a.shape.length,c=s?i.shape[u-2]:i.shape[u-1],d=o?a.shape[l-1]:a.shape[l-2],h=s?i.shape[u-1]:i.shape[u-2],f=o?a.shape[l-2]:a.shape[l-1],p=i.shape.slice(0,-2),g=a.shape.slice(0,-2),m=D.util.sizeFromShape(p),y=D.util.sizeFromShape(g),v=D.broadcast_util.assertAndGetBroadcastShape(i.shape.slice(0,-2),a.shape.slice(0,-2)).concat([h,f]);D.util.assert(c===d,(()=>`Error in matMul: inner shapes (${c}) and (${d}) of Tensors with shapes ${i.shape} and ${a.shape} and transposeA=${s} and transposeB=${o} must match.`));const b=o?[y,f,d]:[y,d,f],x=Il({inputs:{x:i},backend:n,attrs:{shape:s?[m,c,h]:[m,h,c]}}),w=Il({inputs:{x:a},backend:n,attrs:{shape:b}}),k=s?x.shape[1]:x.shape[2],_=s?x.shape[2]:x.shape[1],S=o?w.shape[1]:w.shape[2],C=Math.max(m,y),A=n.data.get(x.dataId).values,E=n.data.get(w.dataId).values,F=D.util.computeStrides(x.shape),I=D.util.computeStrides(w.shape),[N,$,T]=s?[F[0],1,F[1]]:[F[0],F[1],1],[O,M,R]=o?[1,I[1],I[0]]:[I[1],1,I[0]],B=_*S,z=(0,D.buffer)([C,_,S],x.dtype),L=z.values,P=n.blockSize;for(let e=0;e<C;e++)for(let t=0;t<_;t+=P)for(let n=0;n<S;n+=P)for(let r=0;r<k;r+=P){const i=Math.min(t+P,_),a=Math.min(n+P,S),s=Math.min(r+P,k);for(let o=t;o<i;o++)for(let t=n;t<a;t++){let n=0;for(let i=r;i<s;i++){const r=Math.min(e,m-1)*N,a=Math.min(e,y-1)*R;n+=A[r+o*$+i*T]*E[i*O+t*M+a]}L[e*B+(o*S+t)]+=n}}return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(w),n.makeTensorInfo(v,z.dtype,z.values)}const $l={kernelName:D.BatchMatMul,backendName:"cpu",kernelFunc:Nl},Tl={kernelName:D._FusedMatMul,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:a,bias:s,preluActivationWeights:o}=t,{transposeA:u,transposeB:l,activation:c,leakyreluAlpha:d}=r;let h,f,p;const g=[];h=Nl({inputs:{a:i,b:a},attrs:{transposeA:u,transposeB:l},backend:n}),s&&(f=El({inputs:{a:h,b:s},backend:n}),g.push(h),h=f),c&&(p=gl(n,h,c,o,d),g.push(h),h=p);for(const e of g)n.disposeIntermediateTensorInfo(e);return h}};function Ol(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}const Ml={kernelName:D.Abs,backendName:"cpu",kernelFunc:e=>{const{x:t}=e.inputs,n=e.backend;qu(t,"abs");let r=new Float32Array(D.util.sizeFromShape(t.shape));return r=Ol(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,t.dtype)}},Rl=Ku(D.Acos,(e=>Math.acos(e))),Bl={kernelName:D.Acos,backendName:"cpu",kernelFunc:Rl},zl=Ku(D.Acosh,(e=>Math.acosh(e))),Ll={kernelName:D.Acosh,backendName:"cpu",kernelFunc:zl},Pl={kernelName:D.AddN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,r=t;qu(t,"addN");const i=r.map((e=>n.data.get(e.dataId).values)),a=(0,D.buffer)(r[0].shape,r[0].dtype),s=a.values;for(let e=0;e<r.length;e++){const t=i[e];for(let e=0;e<s.length;e++)s[e]+=t[e]}return n.makeTensorInfo(a.shape,a.dtype,a.values)}};function jl(e,t,n,r,i){const a=t.length,s=D.util.sizeFromShape(t),o=D.util.computeStrides(t),u=D.util.computeStrides(i),l=D.util.getTypedArrayFromDType(n,D.util.sizeFromShape(i));for(let t=0;t<s;++t){const n=D.util.indexToLoc(t,a,o),i=new Array(n.length);for(let e=0;e<i.length;e++)i[e]=n[r[e]];l[D.util.locToIndex(i,a,u)]=e[t]}return l}function Ul(e){const{inputs:t,attrs:n,backend:r}=e,{x:i}=t,{perm:a}=n;qu(i,"transpose");const s=i.shape.length,o=new Array(s);for(let e=0;e<o.length;e++)o[e]=i.shape[a[e]];const u=jl(r.data.get(i.dataId).values,i.shape,i.dtype,a,o);return{dataId:r.write(u,o,i.dtype),shape:o,dtype:i.dtype}}const Wl={kernelName:D.Transpose,backendName:"cpu",kernelFunc:Ul},Vl={kernelName:D.All,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:s}=r;qu(i,"all");const o=D.util.parseAxisParam(a,i.shape);let u=o;const l=D.backend_util.getAxesPermutation(u,i.shape.length);let c=i;null!=l&&(c=Ul({inputs:{x:i},backend:n,attrs:{perm:l}}),u=D.backend_util.getInnerMostAxes(u.length,i.shape.length)),D.backend_util.assertAxesAreInnerMostDims("all",u,c.shape.length);const[d,h]=D.backend_util.computeOutAndReduceShapes(c.shape,u),f=D.util.sizeFromShape(h),p=D.util.makeZerosTypedArray(D.util.sizeFromShape(d),c.dtype),g=n.data.get(c.dataId).values;for(let e=0;e<p.length;++e){const t=e*f;let n=g[t];for(let e=0;e<f;++e){const r=g[t+e];n=n&&r}p[e]=n}null!=l&&n.disposeIntermediateTensorInfo(c);const m=n.makeTensorInfo(d,c.dtype,p);if(s){const e=Il({inputs:{x:m},backend:n,attrs:{shape:D.backend_util.expandShapeToKeepDim(d,o)}});return n.disposeIntermediateTensorInfo(m),e}return m}},Gl={kernelName:D.Any,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:s}=r;qu(i,"any");const o=D.util.parseAxisParam(a,i.shape);let u=o;const l=D.backend_util.getAxesPermutation(u,i.shape.length);let c=i;null!=l&&(c=Ul({inputs:{x:i},backend:n,attrs:{perm:l}}),u=D.backend_util.getInnerMostAxes(u.length,i.shape.length)),D.backend_util.assertAxesAreInnerMostDims("any",u,c.shape.length);const[d,h]=D.backend_util.computeOutAndReduceShapes(c.shape,u),f=D.util.sizeFromShape(h),p=D.util.makeZerosTypedArray(D.util.sizeFromShape(d),c.dtype),g=n.data.get(c.dataId).values;for(let e=0;e<p.length;++e){const t=e*f;let n=g[t];for(let e=0;e<f;++e){const r=g[t+e];n=n||r}p[e]=n}null!=l&&n.disposeIntermediateTensorInfo(c);const m=n.makeTensorInfo(d,c.dtype,p);if(s){const e=Il({inputs:{x:m},backend:n,attrs:{shape:D.backend_util.expandShapeToKeepDim(d,o)}});return n.disposeIntermediateTensorInfo(m),e}return m}},ql={kernelName:D.ArgMax,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a}=r;qu(i,"argMax");let s=D.util.parseAxisParam(a,i.shape);const o=D.backend_util.getAxesPermutation(s,i.shape.length);let u=i;const l=[];null!=o&&(u=Ul({inputs:{x:i},backend:n,attrs:{perm:o}}),l.push(u),s=D.backend_util.getInnerMostAxes(s.length,u.shape.length)),s=[s[0]],D.backend_util.assertAxesAreInnerMostDims("argMax",s,u.shape.length);const[c,d]=D.backend_util.computeOutAndReduceShapes(u.shape,s),h=D.util.sizeFromShape(c),f=D.util.makeZerosTypedArray(h,"int32"),p=D.util.sizeFromShape(d),g=n.data.get(u.dataId).values;for(let e=0;e<f.length;++e){const t=e*p;let n=g[t],r=0;for(let e=0;e<p;++e){const i=g[t+e];i>n&&(n=i,r=e)}f[e]=r}return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(c,"int32",f)}},Hl={kernelName:D.ArgMin,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a}=r;qu(i,"argMin");let s=D.util.parseAxisParam(a,i.shape);const o=D.backend_util.getAxesPermutation(s,i.shape.length);let u=i;const l=[];null!=o&&(u=Ul({inputs:{x:i},backend:n,attrs:{perm:o}}),l.push(u),s=D.backend_util.getInnerMostAxes(s.length,u.shape.length)),s=[s[0]],D.backend_util.assertAxesAreInnerMostDims("argMin",s,u.shape.length);const[c,d]=D.backend_util.computeOutAndReduceShapes(u.shape,s),h=D.util.sizeFromShape(c),f=D.util.makeZerosTypedArray(h,"int32"),p=D.util.sizeFromShape(d),g=n.data.get(u.dataId).values;for(let e=0;e<f.length;++e){const t=e*p;let n=g[t],r=0;for(let e=0;e<p;++e){const i=g[t+e];i<n&&(n=i,r=e)}f[e]=r}return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(c,"int32",f)}},Xl=Ku(D.Asin,(e=>Math.asin(e))),Kl={kernelName:D.Asin,backendName:"cpu",kernelFunc:Xl},Yl=Ku(D.Asinh,(e=>Math.asinh(e))),Ql={kernelName:D.Asinh,backendName:"cpu",kernelFunc:Yl},Jl=Ku(D.Atan,(e=>Math.atan(e))),Zl={kernelName:D.Atan,backendName:"cpu",kernelFunc:Jl},ec=rl(((e,t)=>Math.atan2(e,t))),tc=_l(D.Atan2,ec),nc={kernelName:D.Atan2,backendName:"cpu",kernelFunc:tc},rc=Ku(D.Atanh,(e=>Math.atanh(e))),ic={kernelName:D.Atanh,backendName:"cpu",kernelFunc:rc};function ac(e,t,n,r,i,a){const s=i.strideHeight,o=i.strideWidth,u=i.dilationHeight,l=i.dilationWidth,c=i.effectiveFilterHeight,d=i.effectiveFilterWidth,h=i.padInfo.top,f=i.padInfo.left,p="max"===a?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=(0,D.buffer)(i.outShape,n),m=g.values,y=i.outShape[1]*i.outShape[2]*i.outShape[3],v=i.outShape[2]*i.outShape[3],b=i.outShape[3];for(let t=0;t<i.batchSize;++t){const n=t*y,g=t*r[0];for(let t=0;t<i.inChannels;++t)for(let y=0;y<i.outHeight;++y){const x=y*s-h,w=Math.max(0,x),k=Math.min(i.inHeight,c+x),_=n+y*v;for(let n=0;n<i.outWidth;++n){const s=n*o-f,c=Math.max(0,s),h=Math.min(i.inWidth,d+s);let y=p,v=0,x=0;for(let n=w;n<k;n+=u){const i=g+n*r[1];for(let n=c;n<h;n+=l){const s=e[i+n*r[2]+t];"max"===a&&s>y?y=s:"avg"===a&&(v+=s,x++)}if(isNaN(y))break}m[_+n*b+t]="avg"===a?v/x:y}}}return g}function sc(e,t,n,r,i=!1,a=!1){const s=(0,D.buffer)(r.outShape,"int32"),o=r.strideHeight,u=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterHeight,h=r.effectiveFilterWidth,f=r.padInfo.top,p=r.padInfo.left,g=(0,D.buffer)(t,n,e);for(let e=0;e<r.batchSize;++e)for(let t=0;t<r.inChannels;++t)for(let n=0;n<r.outHeight;++n){const m=n*o-f;let y=m;for(;y<0;)y+=l;const v=Math.min(r.inHeight,d+m);for(let o=0;o<r.outWidth;++o){const d=o*u-p;let f=d;for(;f<0;)f+=c;const b=Math.min(r.inWidth,h+d);let x=Number.NEGATIVE_INFINITY,w=-1;for(let n=y;n<v;n+=l){const s=n-m;for(let o=f;o<b;o+=c){const u=o-d,l=g.get(e,n,o,t);l>x&&(x=l,w=i?a?((e*r.inHeight+n)*r.inWidth+o)*r.inChannels+t:(n*r.inWidth+o)*r.inChannels+t:s*h+u)}}s.set(w,e,n,o,t)}}return s}function oc(e,t,n,r,i,a){const s=i.strideDepth,o=i.strideHeight,u=i.strideWidth,l=i.dilationDepth,c=i.dilationHeight,d=i.dilationWidth,h=i.effectiveFilterDepth,f=i.effectiveFilterHeight,p=i.effectiveFilterWidth,g=i.padInfo.front,m=i.padInfo.top,y=i.padInfo.left,v="max"===a?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=(0,D.buffer)(i.outShape,n),x=b.values,w=i.outShape[1]*i.outShape[2]*i.outShape[3]*i.outShape[4],k=i.outShape[2]*i.outShape[3]*i.outShape[4],_=i.outShape[3]*i.outShape[4],S=i.outShape[4];for(let t=0;t<i.batchSize;++t){const n=t*w,b=t*r[0];for(let t=0;t<i.inChannels;++t)for(let w=0;w<i.outDepth;++w){const C=w*s-g;let A=C;for(;A<0;)A+=l;const E=Math.min(i.inDepth,h+C),F=n+w*k;for(let n=0;n<i.outHeight;++n){const s=n*o-m;let h=s;for(;h<0;)h+=c;const g=Math.min(i.inHeight,f+s),w=F+n*_;for(let n=0;n<i.outWidth;++n){const s=n*u-y;let o=s;for(;o<0;)o+=d;const f=Math.min(i.inWidth,p+s),m=w+n*S;let k=v,_=0,C=0;for(let n=A;n<E;n+=l){const i=b+n*r[1];for(let n=h;n<g;n+=c){const s=i+n*r[2];for(let n=o;n<f;n+=d){const i=e[s+n*r[3]+t];if("max"===a&&i>k?k=i:"avg"===a&&(_+=i,C++),isNaN(k))break}if(isNaN(k))break}if(isNaN(k))break}x[m+t]="avg"===a?_/C:k}}}}return b}const uc={kernelName:D.AvgPool,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;qu(i,"avgPool");const{filterSize:a,strides:s,pad:o,dimRoundingMode:u}=r;D.util.assert(D.backend_util.eitherStridesOrDilationsAreOne(s,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '1'`));const l=D.backend_util.computePool2DInfo(i.shape,a,s,1,o,u);let c;if(1===l.filterWidth&&1===l.filterHeight&&D.util.arraysEqual(l.inShape,l.outShape))c=Zu({inputs:{x:i},backend:n});else{const e=n.data.get(i.dataId).values,t=D.util.computeStrides(i.shape),r=ac(e,i.shape,i.dtype,t,l,"avg");c=n.makeTensorInfo(l.outShape,i.dtype,r.values)}return c}},lc={kernelName:D.AvgPool3D,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:a,strides:s,pad:o,dimRoundingMode:u,dataFormat:l}=r;qu(i,"avgPool3d");const c=D.backend_util.computePool3DInfo(i.shape,a,s,1,o,u,l),d=oc(n.data.get(i.dataId).values,i.shape,i.dtype,D.util.computeStrides(i.shape),c,"avg");return n.makeTensorInfo(d.shape,"float32",d.values)}},cc={kernelName:D.AvgPool3DGrad,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a}=t,{filterSize:s,strides:o,pad:u,dimRoundingMode:l}=r;qu([i,a],"avgPool3DGrad");const c=D.backend_util.computePool3DInfo(a.shape,s,o,1,u,l),d=c.strideDepth,h=c.strideHeight,f=c.strideWidth,p=c.filterDepth,g=c.filterHeight,m=c.filterWidth,y=c.dilationDepth,v=c.dilationHeight,b=c.dilationWidth,x=c.effectiveFilterDepth,w=c.effectiveFilterHeight,k=c.effectiveFilterWidth,_=x-1-c.padInfo.front,S=k-1-c.padInfo.left,C=w-1-c.padInfo.top,A=(0,D.buffer)(a.shape,"float32"),E=1/(p*g*m),F=n.bufferSync(i);for(let e=0;e<c.batchSize;++e)for(let t=0;t<c.inChannels;++t)for(let n=0;n<c.inDepth;++n)for(let r=0;r<c.inHeight;++r)for(let i=0;i<c.inWidth;++i){const a=n-_,s=r-C,o=i-S;let u=0;for(let n=0;n<x;n+=y){const r=(a+n)/d;if(!(r<0||r>=c.outDepth||Math.floor(r)!==r))for(let n=0;n<w;n+=v){const i=(s+n)/h;if(!(i<0||i>=c.outHeight||Math.floor(i)!==i))for(let n=0;n<k;n+=b){const a=(o+n)/f;a<0||a>=c.outWidth||Math.floor(a)!==a||(u+=F.get(e,r,i,a,t))}}}A.set(u*E,e,n,r,i,t)}return n.makeTensorInfo(A.shape,A.dtype,A.values)}},dc={kernelName:D.AvgPoolGrad,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a}=t,s=a;qu([i,a],"avgPoolGrad");const{filterSize:o,strides:u,pad:l}=r,c=D.backend_util.computePool2DInfo(s.shape,o,u,1,l),d=c.strideHeight,h=c.strideWidth,f=c.filterHeight,p=c.filterWidth,g=c.dilationHeight,m=c.dilationWidth,y=c.effectiveFilterHeight,v=c.effectiveFilterWidth,b=v-1-c.padInfo.left,x=y-1-c.padInfo.top,w=(0,D.buffer)(s.shape,"float32"),k=1/(f*p),_=n.data.get(i.dataId).values,S=(0,D.buffer)(i.shape,"float32",_);for(let e=0;e<c.batchSize;++e)for(let t=0;t<c.inChannels;++t)for(let n=0;n<c.inHeight;++n)for(let r=0;r<c.inWidth;++r){const i=n-x,a=r-b;let s=0;for(let n=0;n<y;n+=g){const r=(i+n)/d;if(!(r<0||r>=c.outHeight||Math.floor(r)!==r))for(let n=0;n<v;n+=m){const i=(a+n)/h;i<0||i>=c.outWidth||Math.floor(i)!==i||(s+=S.get(e,r,i,t))}}w.set(s*k,e,n,r,t)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}},hc={kernelName:D.FusedBatchNorm,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,scale:a,offset:s,mean:o,variance:u}=t;D.util.assert(o.shape.length===u.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),D.util.assert(null==s||o.shape.length===s.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),D.util.assert(null==a||o.shape.length===a.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks.")),qu([i,o,u,a,s],"batchNorm");let{varianceEpsilon:l}=r;null==l&&(l=.001);const c=n.data.get(i.dataId).values,d=n.data.get(o.dataId).values,h=n.data.get(u.dataId).values,f=a?n.data.get(a.dataId).values:new Float32Array([1]),p=s?n.data.get(s.dataId).values:new Float32Array([0]),g=new Float32Array(c.length),m=p.length,y=f.length,v=h.length,b=d.length;let x=0,w=0,k=0,_=0;for(let e=0;e<c.length;++e)g[e]=p[x++]+(c[e]-d[w++])*f[k++]/Math.sqrt(h[_++]+l),x>=m&&(x=0),w>=b&&(w=0),k>=y&&(k=0),_>=v&&(_=0);return n.makeTensorInfo(i.shape,i.dtype,g)}};function fc(e,t,n,r,i){const a=D.slice_util.isSliceContinous(r,t,n),s=D.util.sizeFromShape(n),o=D.util.computeStrides(r);if(a){const n=D.slice_util.computeFlatOffset(t,o);return"string"===i?e.slice(n,n+s):e.subarray(n,n+s)}const u="string"===i?D.backend_util.fromUint8ToStringArray(e):e,l=(0,D.buffer)(r,i,u),c=(0,D.buffer)(n,i);for(let e=0;e<c.size;++e){const n=c.indexToLoc(e),r=n.map(((e,n)=>e+t[n]));c.set(l.get(...r),...n)}return"string"===i?D.backend_util.fromStringArrayToUint8(c.values):c.values}function pc(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:a,size:s}=r;qu(i,"slice");const[o,u]=D.slice_util.parseSliceParams(i,a,s);D.slice_util.assertParamsValid(i,o,u);const l=fc(n.data.get(i.dataId).values,o,u,i.shape,i.dtype);return n.makeTensorInfo(u,i.dtype,l)}const gc={kernelName:D.Slice,backendName:"cpu",kernelFunc:pc},mc={kernelName:D.BatchToSpaceND,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:a,crops:s}=r;qu([i],"batchToSpaceND");const o=a.reduce(((e,t)=>e*t)),u=D.backend_util.getReshaped(i.shape,a,o),l=D.backend_util.getPermuted(u.length,a.length),c=D.backend_util.getReshapedPermuted(i.shape,a,o),d=D.backend_util.getSliceBeginCoords(s,a.length),h=D.backend_util.getSliceSize(c,s,a.length),f=Il({inputs:{x:i},backend:n,attrs:{shape:u}}),p=Ul({inputs:{x:f},backend:n,attrs:{perm:l}}),g=Il({inputs:{x:p},backend:n,attrs:{shape:c}}),m=pc({inputs:{x:g},backend:n,attrs:{begin:d,size:h}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),m}};function yc(e,t,n,r,i){const a=D.util.sizeFromShape(r),s=D.util.makeZerosTypedArray(i,n);for(let n=0;n<e.length;n++){const r=e[n];if(r<0)throw new Error("Input x must be non-negative!");r>=i||(s[r]+=a>0?t[n]:1)}return s}function vc(e,t,n,r=!1){const i=e.shape[0],a=e.shape[1],s=(0,D.buffer)([i,n],t.dtype);for(let o=0;o<i;o++)for(let i=0;i<a;i++){const a=e.get(o,i);if(a<0)throw new Error("Input x must be non-negative!");a>=n||(r?s.set(1,o,a):t.size>0?s.set(s.get(o,a)+t.get(o,i),o,a):s.set(s.get(o,a)+1,o,a))}return s}const bc={kernelName:D.Bincount,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:a}=t,{size:s}=r,o=yc(n.data.get(i.dataId).values,n.data.get(a.dataId).values,a.dtype,a.shape,s);return n.makeTensorInfo([s],a.dtype,o)}},xc={kernelName:D.BroadcastArgs,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{s0:r,s1:i}=t,a=n.data.get(r.dataId).values,s=n.data.get(i.dataId).values,o=D.backend_util.assertAndGetBroadcastShape(Array.from(a),Array.from(s));return n.makeTensorInfo([o.length],"int32",Int32Array.from(o))}},wc=dl((e=>Math.ceil(e))),kc=Yu(D.Ceil,wc),_c={kernelName:D.Ceil,backendName:"cpu",kernelFunc:kc},Sc=Ku(D.ClipByValue,((e,t)=>{const n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e})),Cc={kernelName:D.ClipByValue,backendName:"cpu",kernelFunc:Sc},Ac={kernelName:D.ComplexAbs,backendName:"cpu",kernelFunc:e=>{const{x:t}=e.inputs,n=e.backend,r=new Float32Array(D.util.sizeFromShape(t.shape)),i=n.data.get(t.dataId),a=i.complexTensorInfos.real,s=i.complexTensorInfos.imag,o=n.data.get(a.dataId).values,u=n.data.get(s.dataId).values;for(let e=0;e<o.length;e++){const t=o[e],n=u[e];r[e]=Math.hypot(t,n)}return n.makeOutput(r,t.shape,"float32")}};function Ec(e,t,n,r){const i=D.util.getArrayFromDType(n,D.util.sizeFromShape(t));if(r&&"string"!==n){let t=0;e.forEach((e=>{const n=D.util.sizeFromShape(e.shape);i.set(e.vals,t),t+=n}))}else{let r=0;e.forEach((e=>{const a="string"===n?D.backend_util.fromUint8ToStringArray(e.vals):e.vals;let s=0;for(let n=0;n<e.shape[0];++n){const o=n*t[1]+r;for(let t=0;t<e.shape[1];++t)i[o+t]=a[s++]}r+=e.shape[1]}))}return i}function Fc(e){const{inputs:t,backend:n}=e,{input:r}=t,i=n.data.get(r.dataId).complexTensorInfos.imag,a=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,a)}const Ic={kernelName:D.Imag,backendName:"cpu",kernelFunc:Fc};function Dc(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r,a=D.util.parseAxisParam(i,t[0].shape)[0];let s=D.backend_util.computeOutShape(t.map((e=>e.shape)),a);if(0===D.util.sizeFromShape(s))return n.makeTensorInfo(s,t[0].dtype,[]);const o=t.filter((e=>D.util.sizeFromShape(e.shape)>0));if(1===o.length)return Zu({inputs:{x:o[0]},backend:n});const u=o.map((e=>e.shape));if(D.backend_util.assertParamsConsistent(u,a),"complex64"===o[0].dtype){const e=o.map((e=>bl({inputs:{input:e},backend:n}))),t=o.map((e=>Fc({inputs:{input:e},backend:n}))),r=Dc({inputs:e,backend:n,attrs:{axis:a}}),i=Dc({inputs:t,backend:n,attrs:{axis:a}}),s=ml({inputs:{real:r,imag:i},backend:n});return e.forEach((e=>n.disposeIntermediateTensorInfo(e))),t.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),s}const l=o.map((e=>{const t=D.util.sizeFromShape(e.shape.slice(a));return Il({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})})),c=l.map((e=>({vals:n.data.get(e.dataId).values,shape:e.shape})));s=D.backend_util.computeOutShape(l.map((e=>e.shape)),1);const d=1===l[0].shape[0],h=Ec(c,s,t[0].dtype,d),f=D.backend_util.computeOutShape(o.map((e=>e.shape)),a),p=n.makeTensorInfo(f,t[0].dtype,h);return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),p}const Nc={kernelName:D.Concat,backendName:"cpu",kernelFunc:Dc};function $c(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a}=t,{strides:s,pad:o,dataFormat:u,dilations:l,dimRoundingMode:c}=r;qu([i,a],"conv2d");const d=D.backend_util.convertConv2DDataFormat(u),h=D.backend_util.computeConv2DInfo(i.shape,a.shape,s,l,o,c,!1,d),f=h.filterHeight,p=h.filterWidth,g=h.dilationHeight,m=h.dilationWidth,y=h.padInfo.left,v=h.padInfo.top,b="channelsLast"===h.dataFormat,x=new D.TensorBuffer(h.outShape,i.dtype),w=D.util.computeStrides(i.shape),k=D.util.computeStrides(a.shape),_=w[0],S=b?w[1]:w[2],C=b?w[2]:1,A=b?1:w[1],E=x.strides[0],F=b?x.strides[1]:x.strides[2],I=b?x.strides[2]:1,N=b?1:x.strides[1],$=n.data.get(i.dataId).values,T=n.data.get(a.dataId).values,O=x.values;for(let e=0;e<h.batchSize;++e){const t=e*_,n=e*E;for(let e=0;e<h.outHeight;++e){const r=n+e*F,i=e*h.strideHeight-v;for(let e=0;e<f;++e){const n=i+e*g;if(n<0||n>=h.inHeight)continue;const a=e*k[0],s=t+n*S;for(let e=0;e<h.outWidth;++e){const t=r+e*I,n=e*h.strideWidth-y;for(let e=0;e<p;++e){const r=n+e*m;if(r<0||r>=h.inWidth)continue;const i=s+r*C;let o=a+e*k[1];for(let e=0;e<h.inChannels;++e){const n=$[i+e*A];for(let e=0;e<h.outChannels;++e)O[t+e*N]+=n*T[o+e];o+=h.outChannels}}}}}}return n.makeTensorInfo(x.shape,x.dtype,O)}const Tc={kernelName:D.Conv2D,backendName:"cpu",kernelFunc:$c},Oc={kernelName:D.Conv2DBackpropFilter,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:a}=t,{strides:s,pad:o,dataFormat:u,dimRoundingMode:l,filterShape:c}=r;qu([i,a],"conv2dBackpropFilter");const d=D.backend_util.convertConv2DDataFormat(u),h=D.backend_util.computeConv2DInfo(i.shape,c,s,1,o,l,!1,d),{strideHeight:f,strideWidth:p,filterHeight:g,filterWidth:m}=h,y="channelsLast"===h.dataFormat,v=new D.TensorBuffer(h.filterShape,"float32"),b=h.padInfo.left,x=h.padInfo.top,w=n.data.get(i.dataId).values,k=n.data.get(a.dataId).values,_=new D.TensorBuffer(i.shape,i.dtype,w),S=new D.TensorBuffer(a.shape,a.dtype,k);for(let e=0;e<g;++e){const t=Math.max(0,Math.ceil((x-e)/f)),n=Math.min(h.outHeight,(h.inHeight+x-e)/f);for(let r=0;r<m;++r){const i=Math.max(0,Math.ceil((b-r)/p)),a=Math.min(h.outWidth,(h.inWidth+b-r)/p);for(let s=0;s<h.inChannels;++s)for(let o=0;o<h.outChannels;++o){let u=0;for(let l=0;l<h.batchSize;++l)for(let c=t;c<n;++c){const t=e+c*f-x;for(let e=i;e<a;++e){const n=r+e*p-b;u+=y?_.get(l,t,n,s)*S.get(l,c,e,o):_.get(l,s,t,n)*S.get(l,o,c,e)}}v.set(u,e,r,s,o)}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}},Mc={kernelName:D.Conv2DBackpropInput,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:a}=t,{inputShape:s,strides:o,pad:u,dataFormat:l,dimRoundingMode:c}=r;qu([i,a],"conv2dBackpropInput");const d=D.util.computeStrides(a.shape),h=D.util.computeStrides(i.shape);let f=D.backend_util.convertConv2DDataFormat(l);const p=D.backend_util.computeConv2DInfo(s,a.shape,o,1,u,c,!1,f),g=new D.TensorBuffer(p.inShape,"float32"),m=g.values,y=n.data.get(i.dataId).values,v=n.data.get(a.dataId).values,[b,x,w]=d,{batchSize:k,filterHeight:_,filterWidth:S,inChannels:C,inHeight:A,inWidth:E,outChannels:F,outHeight:I,outWidth:N,strideHeight:$,strideWidth:T}=p;f=p.dataFormat;const O=_-1-p.padInfo.top,M=S-1-p.padInfo.left,R="channelsLast"===f,B=g.strides[0],z=R?g.strides[1]:g.strides[2],L=R?g.strides[2]:1,P=R?1:g.strides[1],j=h[0],U=R?h[1]:h[2],W=R?h[2]:1,V=R?1:h[1];for(let e=0;e<k;++e)for(let t=0;t<C;++t)for(let n=0;n<A;++n){const r=n-O,i=Math.max(0,Math.ceil(r/$)),a=Math.min(I,(_+r)/$);for(let s=0;s<E;++s){const o=s-M,u=Math.max(0,Math.ceil(o/T)),l=Math.min(N,(S+o)/T);let c=0;for(let n=i;n<a;++n){const i=n*$-r;for(let r=u;r<l;++r){const a=j*e+U*n+W*r,s=b*(_-1-i)+x*(S-1-(r*T-o))+w*t;for(let e=0;e<F;++e)c+=y[a+V*e]*v[s+e]}}m[B*e+z*n+L*s+P*t]=c}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}},Rc={kernelName:D.Conv3D,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a}=t,{strides:s,pad:o,dilations:u}=r;qu([i,a],"conv3d");const l=D.backend_util.computeConv3DInfo(i.shape,a.shape,s,u,o),{filterDepth:c,filterHeight:d,filterWidth:h,dilationDepth:f,dilationHeight:p,dilationWidth:g,padInfo:m}=l,y=m.front,v=m.left,b=m.top,x=new D.TensorBuffer(l.outShape,i.dtype),w=n.data.get(i.dataId).values,k=n.data.get(a.dataId).values,_=x.values,S=D.util.computeStrides(i.shape),C=D.util.computeStrides(a.shape);for(let e=0;e<l.batchSize;++e){const t=e*S[0],n=e*x.strides[0];for(let e=0;e<l.outDepth;++e){const r=n+e*x.strides[1],i=e*l.strideDepth-y;for(let e=0;e<c;++e){const n=i+e*f;if(n<0||n>=l.inDepth)continue;const a=e*C[0],s=t+n*S[1];for(let e=0;e<l.outHeight;++e){const t=r+e*x.strides[2],n=e*l.strideHeight-b;for(let e=0;e<d;++e){const r=n+e*p;if(r<0||r>=l.inHeight)continue;const i=a+e*C[1],o=s+r*S[2];for(let e=0;e<l.outWidth;++e){const n=t+e*l.outChannels,r=e*l.strideWidth-v;for(let e=0;e<h;++e){const t=r+e*g;if(t<0||t>=l.inWidth)continue;const a=i+e*C[2],s=o+t*l.inChannels;let u=a;for(let e=0;e<l.inChannels;++e){const t=w[s+e];for(let e=0;e<l.outChannels;++e)_[n+e]+=t*k[u+e];u+=l.outChannels}}}}}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}},Bc={kernelName:D.Conv3DBackpropFilterV2,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:a}=t,{strides:s,pad:o,filterShape:u}=r;qu([i,a],"conv3dBackpropFilterV2");const l=D.util.computeStrides(i.shape),c=D.util.computeStrides(a.shape),d=D.backend_util.computeConv3DInfo(i.shape,u,s,1,o),h=d.strideDepth,f=d.strideHeight,p=d.strideWidth,g=d.filterDepth,m=d.filterHeight,y=d.filterWidth,v=new D.TensorBuffer(d.filterShape,"float32"),b=v.values,[x,w,k,_]=v.strides,S=n.data.get(a.dataId).values,[C,A,E,F]=c,I=n.data.get(i.dataId).values,[N,$,T,O]=l,M=d.padInfo.front,R=d.padInfo.left,B=d.padInfo.top;for(let e=0;e<g;++e){const t=Math.max(0,Math.ceil((M-e)/h)),n=Math.min(d.outDepth,(d.inDepth+M-e)/h),r=e*x;for(let i=0;i<m;++i){const a=Math.max(0,Math.ceil((B-i)/f)),s=Math.min(d.outHeight,(d.inHeight+B-i)/f),o=i*w+r;for(let r=0;r<y;++r){const u=Math.max(0,Math.ceil((R-r)/p)),l=Math.min(d.outWidth,(d.inWidth+R-r)/p),c=r*k+o;for(let o=0;o<d.inChannels;++o){const g=o*_+c;for(let c=0;c<d.outChannels;++c){let m=0;for(let g=0;g<d.batchSize;++g){const d=g*N,y=g*C;for(let g=t;g<n;++g){const t=(e+g*h-M)*$+d,n=g*A+y;for(let e=a;e<s;++e){const a=(i+e*f-B)*T+t,s=e*E+n;for(let e=u;e<l;++e){const t=e*F+s;m+=I[(r+e*p-R)*O+a+o]*S[t+c]}}}}b[g+c]=m}}}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}},zc={kernelName:D.Conv3DBackpropInputV2,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:a}=t,{pad:s,strides:o,inputShape:u}=r;qu([i],"conv3dBackpropInputV2");const l=D.util.computeStrides(i.shape),c=D.util.computeStrides(a.shape),d=D.backend_util.computeConv3DInfo(u,a.shape,o,1,s),h=new D.TensorBuffer(d.inShape,"float32"),f=h.values,[p,g,m,y]=h.strides,v=n.data.get(i.dataId).values,[b,x,w,k]=l,_=n.data.get(a.dataId).values,[S,C,A,E]=c,{batchSize:F,filterDepth:I,filterHeight:N,filterWidth:$,inChannels:T,inDepth:O,inHeight:M,inWidth:R,outChannels:B,outDepth:z,outHeight:L,outWidth:P,strideDepth:j,strideHeight:U,strideWidth:W}=d,V=I-1-d.padInfo.front,G=N-1-d.padInfo.top,q=$-1-d.padInfo.left;for(let e=0;e<F;++e)for(let t=0;t<T;++t)for(let n=0;n<O;++n){const r=n-V,i=Math.max(0,Math.ceil(r/j)),a=Math.min(z,(I+r)/j);for(let s=0;s<M;++s){const o=s-G,u=Math.max(0,Math.ceil(o/U)),l=Math.min(L,(N+o)/U);for(let c=0;c<R;++c){const d=c-q,h=Math.max(0,Math.ceil(d/W)),F=Math.min(P,($+d)/W);let D=0;for(let n=i;n<a;++n){const i=n*j-r;for(let r=u;r<l;++r){const a=r*U-o;for(let s=h;s<F;++s){const o=b*e+x*n+w*r+k*s,u=S*(I-1-i)+C*(N-1-a)+A*($-1-(s*W-d))+E*t;for(let e=0;e<B;++e)D+=v[o+e]*_[u+e]}}}f[p*e+g*n+m*s+y*c+t]=D}}}return n.makeTensorInfo(h.shape,h.dtype,h.values)}},Lc=Ku(D.Cos,(e=>Math.cos(e))),Pc={kernelName:D.Cos,backendName:"cpu",kernelFunc:Lc},jc=Ku(D.Cosh,(e=>Math.cosh(e))),Uc={kernelName:D.Cosh,backendName:"cpu",kernelFunc:jc},Wc={kernelName:D.CropAndResize,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{image:i,boxes:a,boxInd:s}=t,{cropSize:o,method:u,extrapolationValue:l}=r,[c,d,h,f]=i.shape,p=a.shape[0],[g,m]=o,y=(0,D.buffer)([p,g,m,f],"float32"),v=n.data.get(a.dataId).values,b=n.data.get(s.dataId).values,x=n.data.get(i.dataId).values,w=D.util.computeStrides(i.shape),k=D.util.computeStrides(y.shape);for(let e=0;e<p;e++){const t=4*e,n=v[t],r=v[t+1],i=v[t+2],a=v[t+3],s=b[e];if(s>=c)continue;const o=g>1?(i-n)*(d-1)/(g-1):0,p=m>1?(a-r)*(h-1)/(m-1):0;for(let t=0;t<g;t++){const c=g>1?n*(d-1)+t*o:.5*(n+i)*(d-1);if(c<0||c>d-1)for(let n=0;n<m;n++)for(let r=0;r<f;r++){const i=r+n*k[2]+t*k[1]+e*k[0];y.values[i]=l}else if("bilinear"===u){const n=Math.floor(c),i=Math.ceil(c),o=c-n;for(let u=0;u<m;u++){const c=m>1?r*(h-1)+u*p:.5*(r+a)*(h-1);if(c<0||c>h-1){for(let n=0;n<f;n++){const r=n+u*k[2]+t*k[1]+e*k[0];y.values[r]=l}continue}const d=Math.floor(c),g=Math.ceil(c),v=c-d;for(let r=0;r<f;r++){let a=r+d*w[2]+n*w[1]+s*w[0];const l=x[a];a=r+g*w[2]+n*w[1]+s*w[0];const c=x[a];a=r+d*w[2]+i*w[1]+s*w[0];const h=x[a];a=r+g*w[2]+i*w[1]+s*w[0];const f=l+(c-l)*v,p=h+(x[a]-h)*v;a=r+u*k[2]+t*k[1]+e*k[0],y.values[a]=f+(p-f)*o}}}else for(let n=0;n<m;++n){const i=m>1?r*(h-1)+n*p:.5*(r+a)*(h-1);if(i<0||i>h-1){for(let r=0;r<f;r++){const i=r+n*k[2]+t*k[1]+e*k[0];y.values[i]=l}continue}const o=Math.round(i),u=Math.round(c);for(let r=0;r<f;r++){const i=r+o*w[2]+u*w[1]+s*w[0],a=r+n*k[2]+t*k[1]+e*k[0];y.values[a]=x[i]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}},Vc={kernelName:D.Cumprod,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,exclusive:s,reverse:o}=r;qu(i,"cumprod");const u=D.backend_util.getAxesPermutation([a],i.shape.length);let l=i;null!=u&&(l=Ul({inputs:{x:i},backend:n,attrs:{perm:u}}));const c=D.backend_util.getInnerMostAxes(1,i.shape.length)[0];if(c!==l.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${c}`);const d=(0,D.upcastType)(l.dtype,"int32"),h=D.util.makeOnesTypedArray(D.util.sizeFromShape(l.shape),d),f=n.data.get(l.dataId).values,p=l.shape[l.shape.length-1],g=o?(e,t)=>e+p-t-1:(e,t)=>e+t;for(let e=0;e<f.length;e+=p)for(let t=0;t<p;t++){const n=g(e,t);if(0===t)h[n]=s?1:f[n];else{const r=g(e,t-1);h[n]=s?f[r]*h[r]:f[n]*h[r]}}const m=n.makeTensorInfo(l.shape,d,h);if(null!=u){const e=Ul({inputs:{x:m},backend:n,attrs:{perm:D.backend_util.getUndoAxesPermutation(u)}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(l),e}return m}},Gc={kernelName:D.Cumsum,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,exclusive:s,reverse:o}=r;qu(i,"cumsum");const u=D.backend_util.getAxesPermutation([a],i.shape.length);let l=i;null!=u&&(l=Ul({inputs:{x:i},backend:n,attrs:{perm:u}}));const c=D.backend_util.getInnerMostAxes(1,i.shape.length)[0];if(c!==l.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${c}`);const d=(0,D.upcastType)(l.dtype,"int32"),h=D.util.makeZerosTypedArray(D.util.sizeFromShape(l.shape),d),f=n.data.get(l.dataId).values,p=l.shape[l.shape.length-1],g=o?(e,t)=>e+p-t-1:(e,t)=>e+t;for(let e=0;e<f.length;e+=p)for(let t=0;t<p;t++){const n=g(e,t);if(0===t)h[n]=s?0:f[n];else{const r=g(e,t-1);h[n]=s?f[r]+h[r]:f[n]+h[r]}}const m=n.makeTensorInfo(l.shape,d,h);if(null!=u){const e=Ul({inputs:{x:m},backend:n,attrs:{perm:D.backend_util.getUndoAxesPermutation(u)}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(l),e}return m}},qc={kernelName:D.DenseBincount,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:a}=t,{size:s,binaryOutput:o}=r;if(1===i.shape.length){const e=yc(n.data.get(i.dataId).values,n.data.get(a.dataId).values,a.dtype,a.shape,s);return n.makeTensorInfo([s],a.dtype,e)}if(2===i.shape.length){const e=vc(n.bufferSync(i),n.bufferSync(a),s,o);return n.makeTensorInfo(e.shape,a.dtype,e.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}},Hc={kernelName:D.DepthToSpace,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockSize:a,dataFormat:s}=r;D.util.assert("NHWC"===s,(()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${s}`));const o=i.shape[0],u=i.shape[1],l=i.shape[2],c=i.shape[3],d=u*a,h=l*a,f=c/(a*a),p=n.data.get(i.dataId).values,g=new Float32Array(o*d*h*f);let m=0;for(let e=0;e<o;++e)for(let t=0;t<d;++t){const n=Math.floor(t/a),r=t%a;for(let t=0;t<h;++t){const i=Math.floor(t/a),s=(r*a+t%a)*f;for(let t=0;t<f;++t){const r=t+s+c*(i+l*(n+u*e));g[m++]=p[r]}}}return n.makeTensorInfo([o,d,h,f],i.dtype,g)}};function Xc(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a}=t,{strides:s,pad:o,dilations:u,dimRoundingMode:l}=r;qu([i,a],"depthwiseConv2DNative");const c=D.util.computeStrides(i.shape),d=D.util.computeStrides(a.shape);let h=u;null==h&&(h=[1,1]),D.util.assert(D.backend_util.eitherStridesOrDilationsAreOne(s,h),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${h}'`));const f=D.backend_util.computeConv2DInfo(i.shape,a.shape,s,h,o,l,!0),{filterHeight:p,filterWidth:g,dilationHeight:m,dilationWidth:y,padInfo:v}=f,b=v.left,x=v.top,w=f.outChannels/f.inChannels,k=new D.TensorBuffer(f.outShape,i.dtype),_=n.data.get(i.dataId).values,S=n.data.get(a.dataId).values,C=k.values;for(let e=0;e<f.batchSize;++e){const t=e*c[0],n=e*k.strides[0];for(let e=0;e<f.outHeight;++e){const r=n+e*k.strides[1],i=e*f.strideHeight-x;for(let e=0;e<p;++e){const n=i+e*m;if(n<0||n>=f.inHeight)continue;const a=e*d[0],s=t+n*c[1];for(let e=0;e<f.outWidth;++e){const t=r+e*k.strides[2],n=e*f.strideWidth-b;for(let e=0;e<g;++e){const r=n+e*y;if(r<0||r>=f.inWidth)continue;const i=a+e*d[1],o=s+r*f.inChannels;let u=t,l=i;for(let e=0;e<f.inChannels;++e){const t=_[o+e];for(let e=0;e<w;++e)C[u+e]+=t*S[l+e];u+=w,l+=w}}}}}}return n.makeTensorInfo(k.shape,k.dtype,k.values)}const Kc={kernelName:D.DepthwiseConv2dNative,backendName:"cpu",kernelFunc:Xc},Yc={kernelName:D.DepthwiseConv2dNativeBackpropFilter,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:a}=t,{strides:s,dilations:o,pad:u,dimRoundingMode:l,filterShape:c}=r;qu([i,a],"depthwiseConv2dNativeBackpropFilter");const d=D.backend_util.computeConv2DInfo(i.shape,c,s,o,u,l,!0),{strideHeight:h,strideWidth:f,filterHeight:p,filterWidth:g}=d,m=new D.TensorBuffer(d.filterShape,"float32"),y=d.padInfo.left,v=d.padInfo.top,b=d.outChannels/d.inChannels,x=n.data.get(i.dataId).values,w=new D.TensorBuffer(i.shape,i.dtype,x),k=n.data.get(a.dataId).values,_=new D.TensorBuffer(a.shape,a.dtype,k);for(let e=0;e<p;++e){const t=Math.max(0,Math.ceil((v-e)/h)),n=Math.min(d.outHeight,(d.inHeight+v-e)/h);for(let r=0;r<g;++r){const i=Math.max(0,Math.ceil((y-r)/f)),a=Math.min(d.outWidth,(d.inWidth+y-r)/f);for(let s=0;s<d.outChannels;++s){const o=Math.trunc(s/b),u=s%b;let l=0;for(let u=0;u<d.batchSize;++u)for(let c=t;c<n;++c){const t=e+c*h-v;for(let e=i;e<a;++e){const n=r+e*f-y;l+=w.get(u,t,n,o)*_.get(u,c,e,s)}}m.set(l,e,r,o,u)}}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}},Qc={kernelName:D.DepthwiseConv2dNativeBackpropInput,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:a}=t,{strides:s,dilations:o,pad:u,dimRoundingMode:l,inputShape:c}=r;qu([i,a],"depthwiseConv2DNativeBackpropInput");const d=D.util.computeStrides(i.shape),h=D.util.computeStrides(a.shape),f=D.backend_util.computeConv2DInfo(c,a.shape,s,o,u,l,!0),p=new D.TensorBuffer(f.inShape,"float32"),g=p.values,[m,y,v]=p.strides,b=n.data.get(i.dataId).values,[x,w,k]=d,_=n.data.get(a.dataId).values,[S,C,A]=h,{batchSize:E,filterHeight:F,filterWidth:I,inChannels:N,inHeight:$,inWidth:T,outChannels:O,outHeight:M,outWidth:R,strideHeight:B,strideWidth:z}=f,L=F-1-f.padInfo.top,P=I-1-f.padInfo.left,j=O/N;for(let e=0;e<E;++e)for(let t=0;t<N;++t)for(let n=0;n<$;++n){const r=n-L,i=Math.max(0,Math.ceil(r/B)),a=Math.min(M,(F+r)/B);for(let s=0;s<T;++s){const o=s-P,u=Math.max(0,Math.ceil(o/z)),l=Math.min(R,(I+o)/z);let c=0;for(let n=i;n<a;++n){const i=n*B-r;for(let r=u;r<l;++r){const a=x*e+w*n+k*r,s=S*(F-1-i)+C*(I-1-(r*z-o))+A*t;for(let e=0;e<j;++e)c+=b[a+(t*j+e)]*_[s+e]}}g[m*e+y*n+v*s+t]=c}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}},Jc={kernelName:D.Diag,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t,i=D.util.sizeFromShape(r.shape),a=n.data.get(r.dataId).values,s=(0,D.buffer)([i,i],r.dtype),o=s.values;for(let e=0;e<a.length;e++)o[e*i+e]=a[e];const u=[...r.shape,...r.shape];return n.makeTensorInfo(u,s.dtype,s.values)}},Zc={kernelName:D.Dilation2D,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r,filter:i}=e,{strides:a,pad:s,dilations:o}=n,u=t,l=u.data.get(r.dataId).values,c=r.shape.length,d=u.data.get(i.dataId).values,h=i.shape.length,{batchSize:f,inHeight:p,inWidth:g,inChannels:m,outHeight:y,outWidth:v,padInfo:b,strideHeight:x,strideWidth:w,filterHeight:k,filterWidth:_,dilationHeight:S,dilationWidth:C,outShape:A}=D.backend_util.computeDilation2DInfo(r.shape,i.shape,a,s,"NHWC",o),E=D.util.sizeFromShape(A),F=A.length,I=D.util.getArrayFromDType(r.dtype,E);for(let e=0;e<f;++e)for(let t=0;t<y;++t){const n=t*x-b.top;for(let a=0;a<v;++a){const s=a*w-b.left;for(let o=0;o<m;++o){let u=Number.MIN_SAFE_INTEGER;for(let t=0;t<k;++t){const a=n+t*S;if(a>=0&&a<p)for(let n=0;n<_;++n){const f=s+n*C;if(f>=0&&f<g){const s=D.util.locToIndex([e,a,f,o],c,D.util.computeStrides(r.shape)),p=D.util.locToIndex([t,n,o],h,D.util.computeStrides(i.shape)),g=l[s]+d[p];g>u&&(u=g)}}}I[D.util.locToIndex([e,t,a,o],F,D.util.computeStrides(A))]=u}}}return{dataId:u.write(D.util.toTypedArray(I,r.dtype),A,r.dtype),shape:A,dtype:r.dtype}}},ed={kernelName:D.Dilation2DBackpropFilter,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r,filter:i,dy:a}=e,{strides:s,pad:o,dilations:u}=n,l=t,c=D.util.toNestedArray(r.shape,l.data.get(r.dataId).values),d=D.util.toNestedArray(i.shape,l.data.get(i.dataId).values),{batchSize:h,inHeight:f,inWidth:p,inChannels:g,outHeight:m,outWidth:y,padInfo:v,strideHeight:b,strideWidth:x,filterHeight:w,filterWidth:k,dilationHeight:_,dilationWidth:S,outShape:C}=D.backend_util.computeDilation2DInfo(r.shape,i.shape,s,o,"NHWC",u);D.util.assert(a.rank===C.length,(()=>`Error in ${D.Dilation2DBackpropFilter}, dy must have the same rank as output ${C.length}, but got ${a.rank}`));const A=D.util.toNestedArray(C,l.data.get(a.dataId).values),E=D.util.makeZerosNestedTypedArray(i.shape,i.dtype);for(let e=0;e<h;++e)for(let t=0;t<m;++t){const n=t*b-v.top;for(let r=0;r<y;++r){const i=r*x-v.left;for(let a=0;a<g;++a){let s=Number.MIN_SAFE_INTEGER,o=0,u=0;for(let t=0;t<w;++t){const r=n+t*_;if(r>=0&&r<f)for(let n=0;n<k;++n){const l=i+n*S;if(l>=0&&l<p){const i=c[e][r][l][a]+d[t][n][a];i>s&&(s=i,o=t,u=n)}}}E[o][u][a]+=A[e][t][r][a]}}}return{dataId:l.write(D.util.toTypedArray(E,r.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},td={kernelName:D.Dilation2DBackpropInput,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r,filter:i,dy:a}=e,{strides:s,pad:o,dilations:u}=n,l=t,c=D.util.toNestedArray(r.shape,l.data.get(r.dataId).values),d=D.util.toNestedArray(i.shape,l.data.get(i.dataId).values),{batchSize:h,inHeight:f,inWidth:p,inChannels:g,outHeight:m,outWidth:y,padInfo:v,strideHeight:b,strideWidth:x,filterHeight:w,filterWidth:k,dilationHeight:_,dilationWidth:S,outShape:C}=D.backend_util.computeDilation2DInfo(r.shape,i.shape,s,o,"NHWC",u);D.util.assert(a.rank===C.length,(()=>`Error in ${D.Dilation2DBackpropInput}, dy must have the same rank as output ${C.length}, but got ${a.rank}`));const A=D.util.toNestedArray(C,l.data.get(a.dataId).values),E=D.util.makeZerosNestedTypedArray(r.shape,r.dtype);for(let e=0;e<h;++e)for(let t=0;t<m;++t){const n=t*b-v.top;for(let r=0;r<y;++r){const i=r*x-v.left;for(let a=0;a<g;++a){let s=Number.MIN_SAFE_INTEGER,o=n<0?0:n,u=i<0?0:i;for(let t=0;t<w;++t){const r=n+t*_;if(r>=0&&r<f)for(let n=0;n<k;++n){const l=i+n*S;if(l>=0&&l<p){const i=c[e][r][l][a]+d[t][n][a];i>s&&(s=i,o=r,u=l)}}}E[e][o][u][a]+=A[e][t][r][a]}}}return{dataId:l.write(D.util.toTypedArray(E,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},nd=rl(((e,t)=>e*t)),rd=Sl(((e,t,n,r)=>({real:e*n-t*r,imag:e*r+t*n}))),id=_l(D.Multiply,nd,rd),ad={kernelName:D.Multiply,backendName:"cpu",kernelFunc:id};function sd(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:s}=r;let o;qu(i,"sum"),o="bool"===i.dtype?wl({inputs:{x:i},backend:n,attrs:{dtype:"int32"}}):Zu({inputs:{x:i},backend:n});const u=o.shape.length,l=D.util.parseAxisParam(a,o.shape),c=D.backend_util.getAxesPermutation(l,u);let d=l,h=o;null!=c&&(h=Ul({inputs:{x:o},backend:n,attrs:{perm:c}}),d=D.backend_util.getInnerMostAxes(d.length,u)),D.backend_util.assertAxesAreInnerMostDims("sum",d,h.shape.length);const[f,p]=D.backend_util.computeOutAndReduceShapes(h.shape,d);let g=vl(n,f,D.backend_util.upcastType(h.dtype,"int32"));const m=D.util.sizeFromShape(p),y=n.data.get(g.dataId).values,v=n.data.get(h.dataId).values;for(let e=0;e<y.length;++e){const t=e*m;let n=0;for(let e=0;e<m;++e)n+=v[t+e];y[e]=n}if(s){const e=g;g=Il({inputs:{x:g},backend:n,attrs:{shape:D.backend_util.expandShapeToKeepDim(g.shape,l)}}),n.disposeIntermediateTensorInfo(e)}return n.disposeIntermediateTensorInfo(o),null!=c&&n.disposeIntermediateTensorInfo(h),g}const od={kernelName:D.Sum,backendName:"cpu",kernelFunc:sd},ud={kernelName:D.Einsum,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{equation:i}=r,a=t,{allDims:s,summedDims:o,idDims:u}=D.backend_util.decodeEinsumEquation(i,a.length);D.backend_util.checkEinsumDimSizes(s.length,u,a);const{path:l,steps:c}=D.backend_util.getEinsumComputePath(o,u),d=c.length;let h=null,f=s.length;const p=[];for(let e=0;e<d;++e){for(const t of c[e]){const{permutationIndices:e,expandDims:r}=D.backend_util.getEinsumPermutation(f,u[t]);let i;D.backend_util.isIdentityPermutation(e)?i=a[t]:(i=Ul({inputs:{x:a[t]},backend:n,attrs:{perm:e}}),p.push(i));const s=i.shape.slice();for(let e=0;e<r.length;++e)s.splice(r[e],0,1);D.util.arraysEqual(i.shape,s)||(i=Il({inputs:{x:i},backend:n,attrs:{shape:s}}),p.push(i)),null===h?h=i:(h=id({inputs:{a:i,b:h},backend:n}),p.push(h))}e<d-1&&(l[e]>=0&&(h=sd({inputs:{x:h},backend:n,attrs:{axis:l[e]-(s.length-f),keepDims:!1}}),p.push(h)),f--)}for(const e of p)e!==h&&n.disposeIntermediateTensorInfo(e);return h}},ld={kernelName:D.EluGrad,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{dy:r,y:i}=t;qu([r,i],"eluGrad");const a=new Float32Array(D.util.sizeFromShape(i.shape)),s=n.data.get(i.dataId).values,o=n.data.get(r.dataId).values;for(let e=0;e<s.length;++e){const t=s[e];a[e]=t>=1?o[e]:o[e]*(t+1)}return n.makeTensorInfo(i.shape,"float32",a)}},cd=rl(((e,t)=>e===t?1:0)),dd=_l(D.Equal,cd,null,"bool"),hd={kernelName:D.Equal,backendName:"cpu",kernelFunc:dd},fd=D.backend_util.ERF_P,pd=D.backend_util.ERF_A1,gd=D.backend_util.ERF_A2,md=D.backend_util.ERF_A3,yd=D.backend_util.ERF_A4,vd=D.backend_util.ERF_A5,bd=Ku(D.Erf,(e=>{const t=Math.sign(e),n=Math.abs(e),r=1/(1+fd*n);return t*(1-((((vd*r+yd)*r+md)*r+gd)*r+pd)*r*Math.exp(-n*n))})),xd={kernelName:D.Erf,backendName:"cpu",kernelFunc:bd},wd=dl((e=>Math.exp(e))),kd=Yu(D.Exp,wd,"float32"),_d={kernelName:D.Exp,backendName:"cpu",kernelFunc:kd};function Sd(e){const{inputs:t,backend:n,attrs:r}=e,{input:i}=t,{dim:a}=r,s=i.shape.length,o=i.shape.slice();let u=a;return a<0&&(D.util.assert(-(s+1)<=a,(()=>`Axis must be in the interval [${-(s+1)}, ${s}]`)),u=s+a+1),o.splice(u,0,1),Il({inputs:{x:i},backend:n,attrs:{shape:o}})}const Cd={kernelName:D.ExpandDims,backendName:"cpu",kernelFunc:Sd},Ad=dl((e=>Math.expm1(e))),Ed=Yu(D.Expm1,Ad),Fd={kernelName:D.Expm1,backendName:"cpu",kernelFunc:Ed},Id=rl(((e,t)=>e/t)),Dd=_l(D.RealDiv,Id),Nd={kernelName:D.RealDiv,backendName:"cpu",kernelFunc:Dd},$d=rl(((e,t)=>e-t)),Td=Sl(((e,t,n,r)=>({real:e-n,imag:t-r}))),Od=_l(D.Sub,$d,Td),Md={kernelName:D.Sub,backendName:"cpu",kernelFunc:Od};function Rd(e,t,n){const r=e.shape,i=r[0],a=r[1],s=n.data.get(e.dataId),o=s.complexTensorInfos.real,u=s.complexTensorInfos.imag,l=[i,a],c=D.util.sizeFromShape(l),d=D.util.getTypedArrayFromDType("float32",c),h=D.util.getTypedArrayFromDType("float32",c);for(let e=0;e<i;e++){const r=pc({inputs:{x:o},backend:n,attrs:{begin:[e,0],size:[1,a]}}),i=pc({inputs:{x:u},backend:n,attrs:{begin:[e,0],size:[1,a]}}),s=ml({inputs:{real:r,imag:i},backend:n}),{real:l,imag:c}=Bd(s,t,n),f=D.backend_util.mergeRealAndImagArrays(l,c);for(let t=0;t<a;t++){const n=D.backend_util.getComplexWithIndex(f,t);d[e*a+t]=n.real,h[e*a+t]=n.imag}n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s)}const f=n.makeTensorInfo(l,"float32",d),p=n.makeTensorInfo(l,"float32",h),g=ml({inputs:{real:f,imag:p},backend:n});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),g}function Bd(e,t,n){const r=D.util.sizeFromShape(e.shape),i=n.data.get(e.dataId),a=n.data.get(i.complexTensorInfos.real.dataId).values,s=n.data.get(i.complexTensorInfos.imag.dataId).values;if(0==((o=r)&o-1)){const i=zd(a,s,r,t,n),o=[e.shape[0],e.shape[1]];if(t){const e=n.makeTensorInfo(o,"float32",i.real),t=n.makeTensorInfo(o,"float32",i.imag),a=n.makeTensorInfo([],"float32",D.util.createScalarValue(r,"float32")),s=Zu({inputs:{x:a},backend:n}),u=Nd.kernelFunc({inputs:{a:e,b:a},backend:n}),l=Nd.kernelFunc({inputs:{a:t,b:s},backend:n}),c=n.data.get(u.dataId).values,d=n.data.get(l.dataId).values;return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(l),{real:c,imag:d}}return i}{const e=function(e,t,n){const r=new Float32Array(2*t);for(let i=0;i<t;i++){let a=0,s=0;for(let r=0;r<t;r++){const o=D.backend_util.exponent(i*r,t,n),u=D.backend_util.getComplexWithIndex(e,r);a+=u.real*o.real-u.imag*o.imag,s+=u.real*o.imag+u.imag*o.real}n&&(a/=t,s/=t),D.backend_util.assignToTypedArray(r,a,s,i)}return r}(D.backend_util.mergeRealAndImagArrays(a,s),r,t);return D.backend_util.splitRealAndImagArrays(e)}var o}function zd(e,t,n,r,i){if(1===n)return{real:e,imag:t};const a=D.backend_util.mergeRealAndImagArrays(e,t),s=n/2,o=D.backend_util.complexWithEvenIndex(a),u=o.real,l=o.imag,c=[u.length],d=i.makeTensorInfo(c,"float32",u),h=i.makeTensorInfo(c,"float32",l),f=ml({inputs:{real:d,imag:h},backend:i}),p=D.backend_util.complexWithOddIndex(a),g=p.real,m=p.imag,y=[g.length],v=i.makeTensorInfo(y,"float32",g),b=i.makeTensorInfo(y,"float32",m),x=ml({inputs:{real:v,imag:b},backend:i}),w=zd(u,l,s,r,i),k=w.real,_=w.imag,S=[k.length],C=i.makeTensorInfo(S,"float32",k),A=i.makeTensorInfo(S,"float32",_),E=ml({inputs:{real:C,imag:A},backend:i}),F=zd(g,m,s,r,i),I=F.real,N=F.imag,$=[I.length],T=i.makeTensorInfo($,"float32",I),O=i.makeTensorInfo($,"float32",N),M=ml({inputs:{real:T,imag:O},backend:i}),R=D.backend_util.exponents(n,r),B=[R.real.length],z=i.makeTensorInfo(B,"float32",R.real),L=i.makeTensorInfo(B,"float32",R.imag),P=ml({inputs:{real:z,imag:L},backend:i}),j=id({inputs:{a:P,b:M},backend:i}),U=El({inputs:{a:E,b:j},backend:i}),W=Od({inputs:{a:E,b:j},backend:i}),V=bl({inputs:{input:U},backend:i}),G=bl({inputs:{input:W},backend:i}),q=Fc({inputs:{input:U},backend:i}),H=Fc({inputs:{input:W},backend:i}),X=Dc({inputs:[V,G],backend:i,attrs:{axis:0}}),K=Dc({inputs:[q,H],backend:i,attrs:{axis:0}}),Y=i.data.get(X.dataId).values,Q=i.data.get(K.dataId).values;return i.disposeIntermediateTensorInfo(d),i.disposeIntermediateTensorInfo(h),i.disposeIntermediateTensorInfo(f),i.disposeIntermediateTensorInfo(v),i.disposeIntermediateTensorInfo(b),i.disposeIntermediateTensorInfo(x),i.disposeIntermediateTensorInfo(C),i.disposeIntermediateTensorInfo(A),i.disposeIntermediateTensorInfo(E),i.disposeIntermediateTensorInfo(T),i.disposeIntermediateTensorInfo(O),i.disposeIntermediateTensorInfo(M),i.disposeIntermediateTensorInfo(z),i.disposeIntermediateTensorInfo(L),i.disposeIntermediateTensorInfo(P),i.disposeIntermediateTensorInfo(j),i.disposeIntermediateTensorInfo(U),i.disposeIntermediateTensorInfo(W),i.disposeIntermediateTensorInfo(V),i.disposeIntermediateTensorInfo(q),i.disposeIntermediateTensorInfo(G),i.disposeIntermediateTensorInfo(H),i.disposeIntermediateTensorInfo(X),i.disposeIntermediateTensorInfo(K),{real:Y,imag:Q}}const Ld={kernelName:D.FFT,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t,i=D.util.sizeFromShape(r.shape),a=r.shape[r.shape.length-1],s=Il({inputs:{x:r},backend:n,attrs:{shape:[i/a,a]}}),o=Rd(s,!1,n),u=Il({inputs:{x:o},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),u}};function Pd(e){const{backend:t,attrs:n}=e,{shape:r,value:i,dtype:a}=n,s=a||D.util.inferDtype(i),o=D.util.getArrayFromDType(s,D.util.sizeFromShape(r));return function(e,t,n){e.fill(t)}(o,i),t.makeTensorInfo(r,s,o)}const jd={kernelName:D.Fill,backendName:"cpu",kernelFunc:Pd},Ud={kernelName:D.FlipLeftRight,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:r}=e,i=n,a=D.util.getTypedArrayFromDType(r.dtype,D.util.sizeFromShape(r.shape)),[s,o,u,l]=r.shape,c=i.data.get(r.dataId).values;for(let e=0;e<s;e++){const t=e*u*o*l;for(let e=0;e<o;e++){const n=e*(u*l);for(let e=0;e<u;e++){const r=e*l;for(let i=0;i<l;i++){const s=Math.round(u-e-1),o=t+n+r+i;let d=c[o];s>=0&&s<u&&(d=c[t+n+s*l+i]),a[o]=d}}}}return{dataId:i.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},Wd=dl((e=>Math.floor(e))),Vd=Yu(D.Floor,Wd),Gd={kernelName:D.Floor,backendName:"cpu",kernelFunc:Vd},qd=rl(((e,t)=>Math.floor(e/t))),Hd=_l(D.FloorDiv,qd,null,"int32"),Xd={kernelName:D.FloorDiv,backendName:"cpu",kernelFunc:Hd},Kd={kernelName:D.FusedConv2D,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a,bias:s,preluActivationWeights:o}=t,{strides:u,pad:l,dataFormat:c,dilations:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=r;let g=$c({inputs:{x:i,filter:a},backend:n,attrs:{strides:u,pad:l,dataFormat:c,dilations:d,dimRoundingMode:h}});if(s){const e=g;g=El({inputs:{a:g,b:s},backend:n}),n.disposeIntermediateTensorInfo(e)}if(f){const e=g;g=gl(n,g,f,o,p),n.disposeIntermediateTensorInfo(e)}return g}},Yd={kernelName:D.FusedDepthwiseConv2D,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a,bias:s,preluActivationWeights:o}=t,{strides:u,pad:l,dataFormat:c,dilations:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=r;let g=Xc({inputs:{x:i,filter:a},backend:n,attrs:{strides:u,pad:l,dataFormat:c,dilations:d,dimRoundingMode:h}});if(s){const e=g;g=El({inputs:{a:g,b:s},backend:n}),n.disposeIntermediateTensorInfo(e)}if(f){const e=g;g=gl(n,g,f,o,p),n.disposeIntermediateTensorInfo(e)}return g}};function Qd(e,t,n,r,i,a,s,o,u){const l=(0,D.buffer)([r,a],n);for(let n=0;n<r;n++){const r=[];let c=0;for(let t=0;t<i;t++){const a=e[n*i+t];c+=a*s[t],r.push(a)}if(c<0||c>=u/a)throw new Error(`Invalid indices: ${r} does not index into ${o}`);for(let e=0;e<a;e++)l.values[n*a+e]=t.get(...t.indexToLoc(c*a+e))}return l}const Jd={kernelName:D.GatherNd,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{params:r,indices:i}=t,a=D.util.sizeFromShape(r.shape),s=i.shape,o=s[s.length-1],[u,l,c,d]=D.backend_util.prepareAndValidate(r,i);if(0===l)return n.makeTensorInfo(u,r.dtype,[]);const h=Qd(n.data.get(i.dataId).values,n.bufferSync(r),r.dtype,l,o,c,d,r.shape,a);return n.makeTensorInfo(u,r.dtype,h.values)}};function Zd(e,t,n){const r=(0,D.buffer)(n,e.dtype);for(let n=0;n<r.size;++n){const i=r.indexToLoc(n).slice(),a=i[0],s=i[2],o=t.locToIndex([a,s]);i[2]=t.values[o];const u=e.locToIndex(i);0<=u&&u<e.values.length&&(r.values[n]=e.values[u])}return r}const eh={kernelName:D.GatherV2,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,indices:a}=t,{axis:s,batchDims:o}=r;qu([i,a],"gatherV2");const u=D.util.parseAxisParam(s,i.shape)[0],l=n.data.get(a.dataId).values,c=i.shape[u];for(let e=0;e<l.length;++e){const t=l[e];D.util.assert(t<=c-1&&t>=0,(()=>`GatherV2: the index value ${t} is not in [0, ${c-1}]`))}let d=o;null==o&&(d=0);const h=D.util.sizeFromShape(a.shape),f=D.backend_util.segment_util.collectGatherOpShapeInfo(i,a,u,d),p=Il({inputs:{x:i},backend:n,attrs:{shape:[f.batchSize,f.outerSize,f.dimSize,f.sliceSize]}}),g=Il({inputs:{x:a},backend:n,attrs:{shape:[f.batchSize,h/f.batchSize]}}),m=[f.batchSize,f.outerSize,h/f.batchSize,f.sliceSize],y=n.bufferSync(g),v=Zd(n.bufferSync(p),y,m);return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(f.outputShape,v.dtype,v.values)}},th=rl(((e,t)=>e>t?1:0)),nh=_l(D.Greater,th,null,"bool"),rh={kernelName:D.Greater,backendName:"cpu",kernelFunc:nh},ih=rl(((e,t)=>e>=t?1:0)),ah=_l(D.GreaterEqual,ih,null,"bool"),sh={kernelName:D.GreaterEqual,backendName:"cpu",kernelFunc:ah},oh={kernelName:D.IFFT,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t,i=D.util.sizeFromShape(r.shape),a=r.shape[r.shape.length-1],s=Il({inputs:{x:r},backend:n,attrs:{shape:[i/a,a]}}),o=Rd(s,!0,n),u=Il({inputs:{x:o},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),u}},uh=Ku(D.IsFinite,(e=>Number.isFinite(e)?1:0),"bool"),lh={kernelName:D.IsFinite,backendName:"cpu",kernelFunc:uh},ch=Ku(D.IsInf,(e=>Math.abs(e)===1/0?1:0),"bool"),dh={kernelName:D.IsInf,backendName:"cpu",kernelFunc:ch},hh=Ku(D.IsNan,(e=>Number.isNaN(e)?1:0),"bool"),fh={kernelName:D.IsNan,backendName:"cpu",kernelFunc:hh},ph=rl(((e,t)=>e<t?1:0)),gh=_l(D.Less,ph,null,"bool"),mh={kernelName:D.Less,backendName:"cpu",kernelFunc:gh},yh=rl(((e,t)=>e<=t?1:0)),vh=_l(D.LessEqual,yh,null,"bool"),bh={kernelName:D.LessEqual,backendName:"cpu",kernelFunc:vh};function xh(e,t,n){const r=(t-e)/(n-1),i=D.util.makeZerosTypedArray(n,"float32");i[0]=e;for(let e=1;e<i.length;e++)i[e]=i[e-1]+r;return i}const wh={kernelName:D.LinSpace,backendName:"cpu",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:r,stop:i,num:a}=n,s=xh(r,i,a);return t.makeTensorInfo([s.length],"float32",s)}},kh=dl((e=>Math.log(e))),_h=Yu(D.Log,kh),Sh={kernelName:D.Log,backendName:"cpu",kernelFunc:_h},Ch=Ku(D.Log1p,(e=>Math.log1p(e))),Ah={kernelName:D.Log1p,backendName:"cpu",kernelFunc:Ch},Eh=rl(((e,t)=>e&&t)),Fh=_l(D.LogicalAnd,Eh,null,"bool"),Ih={kernelName:D.LogicalAnd,backendName:"cpu",kernelFunc:Fh},Dh=Ku(D.LogicalNot,(e=>e?0:1),"bool"),Nh={kernelName:D.LogicalNot,backendName:"cpu",kernelFunc:Dh},$h=rl(((e,t)=>e||t)),Th=_l(D.LogicalOr,$h,null,"bool"),Oh={kernelName:D.LogicalOr,backendName:"cpu",kernelFunc:Th},Mh={kernelName:D.LRN,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{depthRadius:a,bias:s,alpha:o,beta:u}=r;qu(i,"LRN");const l=i.shape[3],c=l-1,d=n.data.get(i.dataId).values,h=D.util.sizeFromShape(i.shape),f=new Float32Array(h);function p(e){const t=e%l;let n=e-t+Math.max(0,t-a);const r=e-t+Math.min(t+a,c);let i=0;for(;n<=r;n++){const e=d[n];i+=e*e}return i}for(let e=0;e<h;e++){const t=p(e),n=d[e]*Math.pow(s+o*t,-u);f[e]=n}return n.makeTensorInfo(i.shape,i.dtype,f)}},Rh={kernelName:D.LRNGrad,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,y:a,dy:s}=t,{depthRadius:o,bias:u,alpha:l,beta:c}=r;qu(s,"LRNGrad");const d=D.util.sizeFromShape(s.shape),h=s.shape[3],f=n.data.get(s.dataId).values,p=n.data.get(i.dataId).values,g=n.data.get(a.dataId).values,m=new Float32Array(d),y=d;for(let e=0;e<y;e++){const t=e%h,n=e-t+Math.max(0,t-o),r=e-t+Math.min(h,t+o+1);let i=0;for(let e=n;e<r;e++)i+=Math.pow(p[e],2);i=l*i+u;for(let t=n;t<r;t++){let n=-2*l*c*p[t]*g[e]/i;e===t&&(n+=Math.pow(i,-c)),n*=f[e],m[t]+=n}}return n.makeTensorInfo(s.shape,i.dtype,m)}};function Bh(e,t,n,r){const i=D.util.getTypedArrayFromDType(r,D.util.sizeFromShape(n));for(let n=0;n<i.length;++n){const r=n*t;let a=e[r];for(let n=0;n<t;++n){const t=e[r+n];(Number.isNaN(t)||t>a)&&(a=t)}i[n]=a}return i}function zh(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reductionIndices:a,keepDims:s}=r,o=n;let u=i.shape;const l=u.length,c=D.util.parseAxisParam(a,u);let d=c;const h=D.backend_util.getAxesPermutation(d,l);let f=o.data.get(i.dataId).values;if(null!=h){const e=new Array(l);for(let t=0;t<e.length;t++)e[t]=u[h[t]];f=jl(f,u,i.dtype,h,e),d=D.backend_util.getInnerMostAxes(d.length,l),u=e}qu(i,"max"),D.backend_util.assertAxesAreInnerMostDims("max",d,l);const[p,g]=D.backend_util.computeOutAndReduceShapes(u,d),m=Bh(f,D.util.sizeFromShape(g),p,i.dtype),y=o.write(m,p,i.dtype);let v=p;return s&&(v=D.backend_util.expandShapeToKeepDim(p,c)),{dataId:y,shape:v,dtype:i.dtype}}const Lh={kernelName:D.Max,backendName:"cpu",kernelFunc:zh},Ph=rl(((e,t)=>Math.max(e,t))),jh=_l(D.Maximum,Ph),Uh={kernelName:D.Maximum,backendName:"cpu",kernelFunc:jh},Wh={kernelName:D.MaxPool,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;qu(i,"maxPool");const{filterSize:a,strides:s,pad:o,dimRoundingMode:u}=r;D.util.assert(D.backend_util.eitherStridesOrDilationsAreOne(s,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '1'`));const l=D.backend_util.computePool2DInfo(i.shape,a,s,1,o,u);let c;if(1===l.filterWidth&&1===l.filterHeight&&D.util.arraysEqual(l.inShape,l.outShape))c=Zu({inputs:{x:i},backend:n});else{const e=n.data.get(i.dataId).values,t=D.util.computeStrides(i.shape),r=ac(e,i.shape,i.dtype,t,l,"max");c=n.makeTensorInfo(l.outShape,i.dtype,r.values)}return c}},Vh={kernelName:D.MaxPool3D,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:a,strides:s,pad:o,dimRoundingMode:u,dataFormat:l}=r;qu(i,"maxPool3d");const c=D.backend_util.computePool3DInfo(i.shape,a,s,1,o,u,l),d=oc(n.data.get(i.dataId).values,i.shape,i.dtype,D.util.computeStrides(i.shape),c,"max");return n.makeTensorInfo(d.shape,"float32",d.values)}},Gh={kernelName:D.MaxPool3DGrad,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a}=t,{filterSize:s,strides:o,pad:u,dimRoundingMode:l}=r;qu([i,a],"maxPool3DGrad");const c=D.backend_util.computePool3DInfo(a.shape,s,o,1,u,l),d=function(e,t){const n=(0,D.buffer)(t.outShape,"int32"),r=t.strideDepth,i=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,o=t.dilationHeight,u=t.dilationWidth,l=t.effectiveFilterDepth,c=t.effectiveFilterHeight,d=t.effectiveFilterWidth,h=t.padInfo.front,f=t.padInfo.top,p=t.padInfo.left;for(let g=0;g<t.batchSize;++g)for(let m=0;m<t.inChannels;++m)for(let y=0;y<t.outDepth;++y){const v=y*r-h;let b=v;for(;b<0;)b+=s;const x=Math.min(t.inDepth,l+v);for(let r=0;r<t.outHeight;++r){const l=r*i-f;let h=l;for(;h<0;)h+=o;const w=Math.min(t.inHeight,c+l);for(let i=0;i<t.outWidth;++i){const f=i*a-p;let k=f;for(;k<0;)k+=u;const _=Math.min(t.inWidth,d+f);let S=Number.NEGATIVE_INFINITY,C=-1;for(let t=b;t<x;t+=s){const n=t-v;for(let r=h;r<w;r+=o){const i=r-l;for(let a=k;a<_;a+=u){const s=a-f,o=e.get(g,t,r,a,m);o>=S&&(S=o,C=n*c*d+i*c+s)}}}n.set(C,g,y,r,i,m)}}}return n}(n.bufferSync(a),c),h=c.strideDepth,f=c.strideHeight,p=c.strideWidth,g=c.dilationDepth,m=c.dilationHeight,y=c.dilationWidth,v=c.effectiveFilterDepth,b=c.effectiveFilterHeight,x=c.effectiveFilterWidth,w=v-1-c.padInfo.front,k=x-1-c.padInfo.left,_=b-1-c.padInfo.top,S=(0,D.buffer)(a.shape,"float32"),C=n.bufferSync(i);for(let e=0;e<c.batchSize;++e)for(let t=0;t<c.inChannels;++t)for(let n=0;n<c.inDepth;++n)for(let r=0;r<c.inHeight;++r)for(let i=0;i<c.inWidth;++i){const a=n-w,s=r-_,o=i-k;let u=0;for(let n=0;n<v;n+=g){const r=(a+n)/h;if(!(r<0||r>=c.outDepth||Math.floor(r)!==r))for(let i=0;i<b;i+=m){const a=(s+i)/f;if(!(a<0||a>=c.outHeight||Math.floor(a)!==a))for(let s=0;s<x;s+=y){const l=(o+s)/p;if(l<0||l>=c.outWidth||Math.floor(l)!==l)continue;const h=v*b*x-1-d.get(e,r,a,l,t)===n*b*x+i*x+s?1:0;0!==h&&(u+=C.get(e,r,a,l,t)*h)}}}S.set(u,e,n,r,i,t)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}},qh={kernelName:D.MaxPoolGrad,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a,output:s}=t,o=a;qu([a,s],"maxPoolGrad");const{filterSize:u,strides:l,pad:c,dimRoundingMode:d}=r,h=D.backend_util.computePool2DInfo(o.shape,u,l,1,c,d),f=n.data.get(o.dataId).values,p=(0,D.buffer)(h.outShape,o.dtype,sc(f,o.shape,o.dtype,h).values),g=h.strideHeight,m=h.strideWidth,y=h.dilationHeight,v=h.dilationWidth,b=h.effectiveFilterHeight,x=h.effectiveFilterWidth,w=x-1-h.padInfo.left,k=b-1-h.padInfo.top,_=(0,D.buffer)(o.shape,"float32"),S=n.data.get(i.dataId).values,C=(0,D.buffer)(i.shape,"float32",S);for(let e=0;e<h.batchSize;++e)for(let t=0;t<h.inChannels;++t)for(let n=0;n<h.inHeight;++n)for(let r=0;r<h.inWidth;++r){const i=n-k,a=r-w;let s=0;for(let n=0;n<b;n+=y){const r=(i+n)/g;if(!(r<0||r>=h.outHeight||Math.floor(r)!==r))for(let i=0;i<x;i+=v){const o=(a+i)/m;if(o<0||o>=h.outWidth||Math.floor(o)!==o)continue;const u=b*x-1-p.get(e,r,o,t)===n*x+i?1:0;0!==u&&(s+=C.get(e,r,o,t)*u)}}_.set(s,e,n,r,t)}return n.makeTensorInfo(_.shape,_.dtype,_.values)}},Hh={kernelName:D.MaxPoolWithArgmax,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:r}=e,{filterSize:i,strides:a,pad:s,includeBatchInIndex:o}=t,u=n;qu(r,"MaxPoolWithArgmax");const l=u.data.get(r.dataId).values,c=D.backend_util.computePool2DInfo(r.shape,i,a,[1,1],s),[d,h]=function(e,t,n,r,i){const a=ac(e,0,n,D.util.computeStrides(t),i,"max"),s=sc(e,t,n,i,!0,r);return[a.values,s.values]}(l,r.shape,r.dtype,o,c),f=u.write(d,c.outShape,r.dtype),p=u.write(h,c.outShape,r.dtype);return[{dataId:f,shape:c.outShape,dtype:r.dtype},{dataId:p,shape:c.outShape,dtype:"int32"}]}},Xh={kernelName:D.Mean,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:s}=r,o=D.util.parseAxisParam(a,i.shape),u=D.backend_util.computeOutAndReduceShapes(i.shape,o)[1],l=D.util.sizeFromShape(u),c=[],d=n.makeTensorInfo([],"float32",new Float32Array([l]));c.push(d);const h=wl({inputs:{x:i},backend:n,attrs:{dtype:"float32"}});c.push(h);const f=Dd({inputs:{a:h,b:d},backend:n});c.push(f);const p=sd({inputs:{x:f},backend:n,attrs:{axis:a,keepDims:s}});return c.forEach((e=>n.disposeIntermediateTensorInfo(e))),p}},Kh={kernelName:D.Min,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:s}=r;qu(i,"min");const o=D.util.parseAxisParam(a,i.shape);let u=o;const l=D.backend_util.getAxesPermutation(u,i.shape.length);let c=i;null!=l&&(c=Ul({inputs:{x:i},backend:n,attrs:{perm:l}}),u=D.backend_util.getInnerMostAxes(u.length,i.shape.length)),D.backend_util.assertAxesAreInnerMostDims("min",u,c.shape.length);const[d,h]=D.backend_util.computeOutAndReduceShapes(c.shape,u),f=D.util.sizeFromShape(h),p=D.util.makeZerosTypedArray(D.util.sizeFromShape(d),c.dtype),g=n.data.get(c.dataId).values;for(let e=0;e<p.length;++e){const t=e*f;let n=g[t];for(let e=0;e<f;++e){const r=g[t+e];(Number.isNaN(r)||r<n)&&(n=r)}p[e]=n}null!=l&&n.disposeIntermediateTensorInfo(c);const m=n.makeTensorInfo(d,c.dtype,p);if(s){const e=Il({inputs:{x:m},backend:n,attrs:{shape:D.backend_util.expandShapeToKeepDim(d,o)}});return n.disposeIntermediateTensorInfo(m),e}return m}},Yh=rl(((e,t)=>Math.min(e,t))),Qh=_l(D.Minimum,Yh),Jh={kernelName:D.Minimum,backendName:"cpu",kernelFunc:Qh},Zh={kernelName:D.MirrorPad,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{paddings:a,mode:s}=r;qu(i,"mirrorPad");const o=a.map(((e,t)=>e[0]+i.shape[t]+e[1])),u=a.map((e=>e[0])),l=a.map(((e,t)=>e[0]+i.shape[t])),c="reflect"===s?0:1,d=n.data.get(i.dataId).values,h=i.shape.length,f=D.util.computeStrides(i.shape),p=D.util.sizeFromShape(o),g=o.length,m=D.util.computeStrides(o),y=D.util.getTypedArrayFromDType(i.dtype,p);for(let e=0;e<p;e++){let t=D.util.indexToLoc(e,g,m);for(let e=0;e<g;e++)t[e]<u[e]?t[e]=2*u[e]-t[e]-c:t[e]>=l[e]&&(t[e]=2*(l[e]-1)-t[e]+c);t=t.map(((e,t)=>e-u[t]));const n=D.util.locToIndex(t,h,f);y[e]=d[n]}return{dataId:n.write(y,o,i.dtype),shape:o,dtype:i.dtype}}},ef=rl(((e,t)=>{const n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})),tf=_l(D.Mod,ef),nf={kernelName:D.Mod,backendName:"cpu",kernelFunc:tf};var rf=n(62948);function af(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{dim:a}=r,s=i.shape.length;let o=a;if(-1===o&&(o=s-1),o!==s-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${s} and dim was ${o}`);const u=D.util.parseAxisParam([o],i.shape),l=zh({inputs:{x:i},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),c=D.backend_util.expandShapeToKeepDim(l.shape,u),d=Il({inputs:{x:l},backend:n,attrs:{shape:c}}),h=Od({inputs:{a:i,b:d},backend:n}),f=kd({inputs:{x:h},backend:n}),p=sd({inputs:{x:f},backend:n,attrs:{axis:u,keepDims:!1}}),g=Il({inputs:{x:p},backend:n,attrs:{shape:c}}),m=Dd({inputs:{a:f,b:g},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),m}const sf={kernelName:D.Softmax,backendName:"cpu",kernelFunc:af},of={kernelName:D.Multinomial,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{numSamples:a,seed:s,normalized:o}=r;qu(i,"multinomial");const u=o?i:af({inputs:{logits:i},backend:n,attrs:{dim:-1}}),l=u.shape[0],c=u.shape[1],d=n.data.get(u.dataId).values,h=[l,a],f=D.util.makeZerosTypedArray(D.util.sizeFromShape(h),"int32");for(let e=0;e<l;++e){const t=e*c,n=new Float32Array(c-1);n[0]=d[t];for(let e=1;e<n.length;++e)n[e]=n[e-1]+d[t+e];const r=rf.alea(s.toString()),i=e*a;for(let e=0;e<a;++e){const t=r();f[i+e]=n.length;for(let r=0;r<n.length;r++)if(t<n[r]){f[i+e]=r;break}}}return o||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(h,"int32",f)}};function uf(e,t,n){const r=D.util.createScalarValue(-1,n);return nd([],t,r,e,n)}const lf={kernelName:D.Neg,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t;qu(r,"neg");const i=n.data.get(r.dataId).values,[a,s]=uf(i,r.shape,r.dtype);return n.makeTensorInfo(s,r.dtype,a)}},cf=D.kernel_impls.nonMaxSuppressionV3Impl,df={kernelName:D.NonMaxSuppressionV3,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:a}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:u}=r;qu(i,"NonMaxSuppression");const l=n.data.get(i.dataId).values,c=n.data.get(a.dataId).values,{selectedIndices:d}=cf(l,c,s,o,u);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}},hf=D.kernel_impls.nonMaxSuppressionV4Impl,ff={kernelName:D.NonMaxSuppressionV4,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:a}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:u,padToMaxOutputSize:l}=r;qu(i,"NonMaxSuppressionPadded");const c=n.data.get(i.dataId).values,d=n.data.get(a.dataId).values,{selectedIndices:h,validOutputs:f}=hf(c,d,s,o,u,l);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}},pf=D.kernel_impls.nonMaxSuppressionV5Impl,gf={kernelName:D.NonMaxSuppressionV5,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:a}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:u,softNmsSigma:l}=r;qu(i,"NonMaxSuppressionWithScore");const c=n.data.get(i.dataId).values,d=n.data.get(a.dataId).values,h=s,f=o,p=u,g=l,{selectedIndices:m,selectedScores:y}=pf(c,d,h,f,p,g);return[n.makeTensorInfo([m.length],"int32",new Int32Array(m)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}},mf=rl(((e,t)=>e!==t?1:0)),yf=_l(D.NotEqual,mf,null,"bool"),vf={kernelName:D.NotEqual,backendName:"cpu",kernelFunc:yf},bf={kernelName:D.OneHot,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{indices:i}=t,{depth:a,onValue:s,offValue:o}=r;qu(i,"oneHot");const u=D.util.sizeFromShape(i.shape),l=new Float32Array(u*a);l.fill(o);const c=n.data.get(i.dataId).values;for(let e=0;e<u;++e)c[e]>=0&&c[e]<a&&(l[e*a+c[e]]=s);return n.makeTensorInfo([...i.shape,a],"int32",l)}};function xf(e){const{inputs:t,backend:n}=e,{x:r}=t;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){const e=bl({inputs:{input:r},backend:n}),t=xf({inputs:{x:e},backend:n}),i=Fc({inputs:{input:r},backend:n}),a=xf({inputs:{x:i},backend:n}),s=ml({inputs:{real:t,imag:a},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),s}return Pd({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const wf={kernelName:D.ZerosLike,backendName:"cpu",kernelFunc:xf},kf={kernelName:D.OnesLike,backendName:"cpu",kernelFunc:function e(t){const{inputs:n,backend:r}=t,{x:i}=n;if("string"===i.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===i.dtype){const t=bl({inputs:{input:i},backend:r}),n=e({inputs:{x:t},backend:r}),a=Fc({inputs:{input:i},backend:r}),s=xf({inputs:{x:a},backend:r}),o=ml({inputs:{real:n,imag:s},backend:r});return r.disposeIntermediateTensorInfo(t),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(s),o}return Pd({backend:r,attrs:{shape:i.shape,value:1,dtype:i.dtype}})}};function _f(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r;if(1===t.length)return Sd({inputs:{input:t[0]},backend:n,attrs:{dim:i}});const a=t[0].shape,s=t[0].dtype;t.forEach((e=>{D.util.assertShapesMatch(a,e.shape,"All tensors passed to stack must have matching shapes"),D.util.assert(s===e.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const o=[],u=Dc({inputs:t.map((e=>{const t=Sd({inputs:{input:e},backend:n,attrs:{dim:i}});return o.push(t),t})),backend:n,attrs:{axis:i}});return o.forEach((e=>n.disposeIntermediateTensorInfo(e))),u}const Sf={kernelName:D.Pack,backendName:"cpu",kernelFunc:_f},Cf={kernelName:D.PadV2,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{paddings:a,constantValue:s}=r;qu(i,"pad");const o=a.map(((e,t)=>e[0]+i.shape[t]+e[1])),u=a.map((e=>e[0])),l=n.data.get(i.dataId).values,c=D.util.sizeFromShape(i.shape),d=i.shape.length,h=D.util.computeStrides(i.shape),f=D.util.sizeFromShape(o),p=o.length,g=D.util.computeStrides(o),m=D.util.getTypedArrayFromDType(i.dtype,f);0!==s&&m.fill(s);for(let e=0;e<c;e++){const t=D.util.indexToLoc(e,d,h).map(((e,t)=>e+u[t]));m[D.util.locToIndex(t,p,g)]=l[e]}return{dataId:n.write(m,o,i.dtype),shape:o,dtype:i.dtype}}},Af=rl(((e,t)=>Math.pow(e,t))),Ef=_l(D.Pow,Af),Ff={kernelName:D.Pow,backendName:"cpu",kernelFunc:Ef};function If(e,t,n,r){const[i,a]=D.backend_util.computeOutAndReduceShapes(e,r),s=(0,D.upcastType)(t,"int32"),o=D.util.makeZerosTypedArray(D.util.sizeFromShape(i),s),u=D.util.sizeFromShape(a);for(let e=0;e<o.length;++e){const t=e*u;let r=1;for(let e=0;e<u;++e)r*=n[t+e];o[e]=r}return{outVals:o,outShape:i,outDtype:s}}const Df={kernelName:D.Prod,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:s}=r;qu(i,"prod");const o=i.shape.length,u=D.util.parseAxisParam(a,i.shape),l=D.backend_util.getAxesPermutation(u,o);let c=u,d=i;const h=[];null!=l&&(d=Ul({inputs:{x:i},backend:n,attrs:{perm:l}}),h.push(d),c=D.backend_util.getInnerMostAxes(c.length,o));const f=n.data.get(d.dataId).values,{outVals:p,outShape:g,outDtype:m}=If(d.shape,d.dtype,f,c);let y=g;return s&&(y=D.backend_util.expandShapeToKeepDim(g,u)),h.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(y,m,p)}};function Nf(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return D.util.makeZerosTypedArray(0,r);const i=Math.abs(Math.ceil((t-e)/n)),a=D.util.makeZerosTypedArray(i,r);t<e&&1===n&&(n=-1),a[0]=e;for(let e=1;e<a.length;e++)a[e]=a[e-1]+n;return a}const $f={kernelName:D.Range,backendName:"cpu",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:r,stop:i,dtype:a,step:s}=n,o=Nf(r,i,s,a);return t.makeTensorInfo([o.length],a,o)}},Tf=Ku(D.Reciprocal,(e=>1/e)),Of={kernelName:D.Reciprocal,backendName:"cpu",kernelFunc:Tf},Mf={kernelName:D.ResizeBilinear,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:a,halfPixelCenters:s,size:o}=r;qu(i,"resizeBilinear");const u=D.util.computeStrides(i.shape),[l,c]=o,[d,h,f,p]=i.shape,g=n.data.get(i.dataId).values,m=new Float32Array(D.util.sizeFromShape([d,l,c,p])),y=[a&&l>1?h-1:h,a&&c>1?f-1:f],v=[a&&l>1?l-1:l,a&&c>1?c-1:c];let b=0;const x=y[0]/v[0],w=y[1]/v[1];for(let e=0;e<d;e++)for(let t=0;t<l;t++){let n;n=s?x*(t+.5)-.5:x*t;const r=Math.max(0,Math.floor(n)),i=n-r,a=Math.min(h-1,Math.ceil(n)),o=e*u[0]+r*u[1],l=e*u[0]+a*u[1];for(let e=0;e<c;e++){let t;t=s?w*(e+.5)-.5:w*e;const n=Math.max(0,Math.floor(t)),r=t-n,a=Math.min(f-1,Math.ceil(t)),c=o+n*u[2],d=l+n*u[2],h=o+a*u[2],y=l+a*u[2];for(let e=0;e<p;e++){const t=g[c+e],n=g[d+e],a=t+(g[h+e]-t)*r,s=a+(n+(g[y+e]-n)*r-a)*i;m[b++]=s}}}return n.makeTensorInfo([d,l,c,p],"float32",m)}},Rf={kernelName:D.ResizeBilinearGrad,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:a}=t,{alignCorners:s}=r;qu([a,i],"resizeBilinearGrad");const o=D.util.computeStrides(i.shape),[u,l,c,d]=i.shape,[,h,f]=a.shape,p=new Float32Array(u*l*c*d),g=[s&&h>1?l-1:l,s&&f>1?c-1:c],m=[s&&h>1?h-1:h,s&&f>1?f-1:f],y=g[0]/m[0],v=g[1]/m[1],b=n.data.get(a.dataId).values;let x=0;for(let e=0;e<u;e++){const t=e*o[0];for(let e=0;e<h;e++){const n=e*y,r=Math.floor(n),i=Math.min(Math.ceil(n),l-1),a=t+r*o[1],s=t+i*o[1],u=n-r,h=1-u;for(let e=0;e<f;e++){const t=e*v,n=Math.floor(t),r=Math.min(Math.ceil(t),c-1),i=t-n,l=1-i,f=a+n*o[2],g=a+r*o[2],m=s+n*o[2],y=s+r*o[2],w=h*l,k=h*i,_=u*l,S=u*i;for(let e=0;e<d;e++){const t=b[x++];p[f+e]+=t*w,p[g+e]+=t*k,p[m+e]+=t*_,p[y+e]+=t*S}}}}return n.makeTensorInfo([u,c,l,d],"float32",p)}},Bf={kernelName:D.ResizeNearestNeighbor,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:a,halfPixelCenters:s,size:o}=r;qu(i,"resizeNearestNeighbor");const u=D.util.computeStrides(i.shape),[l,c]=o,[d,h,f,p]=i.shape,g=n.data.get(i.dataId).values,m=new Float32Array(d*l*c*p),y=[a&&l>1?h-1:h,a&&c>1?f-1:f],v=[a&&l>1?l-1:l,a&&c>1?c-1:c],b=y[0]/v[0],x=y[1]/v[1];let w=0;for(let e=0;e<d;e++){const t=e*u[0];for(let e=0;e<l;e++){const n=s?b*(e+.5):b*e;let r=Math.min(h-1,a?Math.round(n):Math.floor(n));s&&(r=Math.max(0,r));const i=t+r*u[1];for(let e=0;e<c;e++){const t=s?x*(e+.5):x*e;let n=Math.min(f-1,a?Math.round(t):Math.floor(t));s&&(n=Math.max(0,n));const r=i+n*u[2];for(let e=0;e<p;e++){const t=g[r+e];m[w++]=t}}}}return n.makeTensorInfo([d,l,c,p],i.dtype,m)}},zf={kernelName:D.ResizeNearestNeighborGrad,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:a}=t,{alignCorners:s}=r;qu([a,i],"resizeNearestNeighborGrad");const o=D.util.computeStrides(i.shape),u=D.util.computeStrides(a.shape),[l,c,d,h]=i.shape,[,f,p]=a.shape,g=new Float32Array(l*c*d*h),m=n.data.get(a.dataId).values,y=[s&&f>1?c-1:c,s&&p>1?d-1:d],v=[s&&f>1?f-1:f,s&&p>1?p-1:p],b=y[0]/v[0],x=y[1]/v[1],w=1/b,k=1/x,_=2*Math.ceil(w)+2,S=2*Math.ceil(k)+2;for(let e=0;e<l;e++){const t=e*o[0];for(let e=0;e<c;e++){const n=t+e*o[1],r=Math.floor(e*w),i=Math.floor(r-_/2);for(let r=0;r<d;r++){const a=n+r*o[2],l=Math.floor(r*k),y=Math.floor(l-S/2);for(let n=0;n<h;n++){let o=0;for(let a=0;a<_;a++){const l=a+i;if(l<0||l>=f)continue;const h=t+l*u[1],g=l*b;if(e===Math.min(c-1,s?Math.round(g):Math.floor(g)))for(let e=0;e<S;e++){const t=e+y;if(t<0||t>=p)continue;const i=h+t*u[2],a=t*x;r===Math.min(d-1,s?Math.round(a):Math.floor(a))&&(o+=m[i+n])}}g[a+n]=o}}}}return n.makeTensorInfo(i.shape,i.dtype,g)}},Lf={kernelName:D.Reverse,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dims:a}=r;qu(i,"reverse");const s=i.shape.length,o=D.util.parseAxisParam(a,i.shape);if(0===s)return Zu({inputs:{x:i},backend:n});const u=new D.TensorBuffer(i.shape,i.dtype),l=n.bufferSync(i);for(let e=0;e<u.size;e++){const t=u.indexToLoc(e),n=t.slice();o.forEach((e=>n[e]=i.shape[e]-1-n[e])),u.set(l.get(...n),...t)}return n.makeTensorInfo(u.shape,u.dtype,u.values)}},Pf={kernelName:D.RotateWithOffset,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:r}=e,{radians:i,fillValue:a,center:s}=t,o=n,u=D.util.getTypedArrayFromDType(r.dtype,D.util.sizeFromShape(r.shape)),[l,c,d,h]=r.shape,[f,p]=D.backend_util.getImageCenter(s,c,d),g=Math.sin(i),m=Math.cos(i),y=o.data.get(r.dataId).values;for(let e=0;e<l;e++){const t=e*d*c*h;for(let e=0;e<c;e++){const n=e*(d*h);for(let r=0;r<d;r++){const i=r*h;for(let s=0;s<h;s++){const o=[l,e,r,s],v=o[2],b=o[1];let x=(v-f)*m-(b-p)*g,w=(v-f)*g+(b-p)*m;x=Math.round(x+f),w=Math.round(w+p);let k=a;"number"!=typeof a&&(k=3===s?255:a[s]),x>=0&&x<d&&w>=0&&w<c&&(k=y[t+w*(d*h)+x*h+s]),u[t+n+i+s]=k}}}}return{dataId:o.write(u,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},jf=Ku(D.Round,(e=>{const t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2==0?t:t+1})),Uf={kernelName:D.Round,backendName:"cpu",kernelFunc:jf},Wf=dl((e=>1/Math.sqrt(e))),Vf=Yu(D.Rsqrt,Wf),Gf={kernelName:D.Rsqrt,backendName:"cpu",kernelFunc:Vf};function qf(e,t,n,r,i,a,s,o,u,l){const c=[r/i,i],d=e.values,h=t.values;if(0===r)return(0,D.buffer)(n,t.dtype);const f=(0,D.buffer)(c,t.dtype);f.values.fill(u);for(let e=0;e<a;e++){const a=[];let u=0;for(let t=0;t<s;t++){const n=d[e*s+t];a.push(n),u+=n*o[t]}if(u<0||u>=r/i)throw new Error(`Invalid indices: ${a} does not index into ${n}`);for(let n=0;n<i;n++)l?f.values[u*i+n]+=h[e*i+n]:f.values[u*i+n]=0===t.rank?h[0]:h[e*i+n]}return f}const Hf={kernelName:D.ScatterNd,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{indices:i,updates:a}=t,{shape:s}=r,{sliceRank:o,numUpdates:u,sliceSize:l,strides:c,outputSize:d}=D.backend_util.calculateShapes(a,i,s),h=qf(n.bufferSync(i),n.bufferSync(a),s,d,l,u,o,c,0,!0);return n.makeTensorInfo(s,h.dtype,h.values)}},Xf={kernelName:D.Select,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{condition:r,t:i,e:a}=t;qu([r,i,a],"select");const s=r.shape.length,o=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,l=n.data.get(a.dataId).values,c=(0,D.upcastType)(i.dtype,a.dtype),d=D.util.makeZerosTypedArray(D.util.sizeFromShape(i.shape),c);let h=0;const f=0===s||s>1||1===i.shape.length?1:D.util.sizeFromShape(i.shape.slice(1));for(let e=0;e<o.length;e++)for(let t=0;t<f;t++)1===o[e]?d[h++]=u[e]:d[h++]=l[e];return n.makeTensorInfo(i.shape,c,d)}},Kf=D.backend_util.SELU_SCALEALPHA,Yf=D.backend_util.SELU_SCALE,Qf=Ku(D.Selu,(e=>e>=0?Yf*e:Kf*(Math.exp(e)-1))),Jf={kernelName:D.Selu,backendName:"cpu",kernelFunc:Qf},Zf=Ku(D.Sign,(e=>e<0?-1:e>0?1:0)),ep={kernelName:D.Sign,backendName:"cpu",kernelFunc:Zf},tp=Ku(D.Sin,(e=>Math.sin(e))),np={kernelName:D.Sin,backendName:"cpu",kernelFunc:tp},rp=Ku(D.Sinh,(e=>Math.sinh(e))),ip={kernelName:D.Sinh,backendName:"cpu",kernelFunc:rp},ap=Math.log(1.1920928955078125e-7)+2,sp=Ku(D.Softplus,(e=>{const t=e>-ap,n=e<ap,r=Math.exp(e);let i;return i=n?r:t?e:Math.log(1+r),i})),op={kernelName:D.Softplus,backendName:"cpu",kernelFunc:sp},up={kernelName:D.SpaceToBatchND,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:a,paddings:s}=r;qu([i],"spaceToBatchND");const o=D.util.sizeFromShape(a),u=[[0,0]];u.push(...s);for(let e=1+a.length;e<i.shape.length;++e)u.push([0,0]);const l=Cf.kernelFunc({inputs:{x:i},backend:n,attrs:{paddings:u,constantValue:0}}),c=D.backend_util.getReshaped(l.shape,a,o,!1),d=D.backend_util.getPermuted(c.length,a.length,!1),h=D.backend_util.getReshapedPermuted(l.shape,a,o,!1),f=Il({inputs:{x:l},backend:n,attrs:{shape:c}}),p=Ul({inputs:{x:f},backend:n,attrs:{perm:d}}),g=Il({inputs:{x:p},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),g}};function lp(e,t,n,r,i,a,s){const o=t[0],u=a[0],l=new Array(u),c=new Array(o),d=t[1];if(0===u){if(0!==o)throw new Error(D.backend_util.getSparseFillEmptyRowsIndicesDenseShapeMismatch(o));return[D.util.getArrayFromDType(n,0),[0,d],D.util.getArrayFromDType(i,0),l,c]}let h=!0,f=0;const p=new Array(u).fill(0);for(let t=0;t<o;++t){const n=e[t*d];if(n<0)throw new Error(D.backend_util.getSparseFillEmptyRowsNegativeIndexErrorMessage(t,n));if(n>=u)throw new Error(D.backend_util.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(t,n,u));++p[n],h=h&&n>=f,f=n}let g=!0;for(let e=0;e<u;++e){const t=0===p[e];l[e]=t,g=g&&!t,p[e]=Math.max(p[e],1),e>0&&(p[e]+=p[e-1])}if(g&&h){const t=e,n=r;for(let e=0;e<o;++e)c[e]=e;return[t,[o,d],n,l,c]}{const t=p[u-1],a=D.util.getArrayFromDType(n,t*d),h=D.util.getArrayFromDType(i,t),f=new Array(u).fill(0);for(let t=0;t<o;++t){const n=e[t*d],i=f[n],s=(0===n?0:p[n-1])+i;f[n]++;for(let n=0;n<d;++n)a[s*d+n]=e[t*d+n];h[s]=r[t],c[t]=s}for(let e=0;e<u;++e)if(0===f[e]){const t=0===e?0:p[e-1];a[t*d+0]=e;for(let e=1;e<d;++e)a[t*d+e]=0;h[t]=s}return[a,[t,d],h,l,c]}}const cp={kernelName:D.SparseFillEmptyRows,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{indices:r,values:i,denseShape:a,defaultValue:s}=t;if(1!==a.shape.length)throw new Error(`Dense shape must be a vector, saw:\n        ${a.shape}`);if(2!==r.shape.length)throw new Error(`Indices must be a matrix, saw:\n        ${r.shape}`);if(1!==i.shape.length)throw new Error(`Values must be a vector, saw:\n        ${i.shape}`);if(0!==s.shape.length)throw new Error(`Default value must be a scalar, saw:\n        ${s.shape}`);const o=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,l=n.data.get(a.dataId).values,c=n.data.get(s.dataId).values[0],[d,h,f,p,g]=lp(o,r.shape,r.dtype,u,i.dtype,l,c);return[n.makeTensorInfo(h,r.dtype,d),n.makeTensorInfo([h[0]],i.dtype,f),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map((e=>Number(e))))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}};function dp(e,t,n,r,i){const a=D.util.sizeFromShape(r),s=t[0],o=i.length,u=[];let l=1,c=-1;for(let e=0;e<o;++e){const t=i[e];if(-1===t){if(-1!==c)throw new Error(D.backend_util.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(c,e));c=e,u.push(1)}else{if(t<0)throw new Error(D.backend_util.getSparseReshapeNegativeOutputDimErrorMessage(e,t));l*=t,u.push(t)}}if(-1!==c){if(l<=0)throw new Error(D.backend_util.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());const e=Math.trunc(a/l);if(l*e!==a)throw new Error(D.backend_util.getSparseReshapeInputOutputMultipleErrorMessage(r,u));u[c]=e}if(D.util.sizeFromShape(u)!==a)throw new Error(D.backend_util.getSparseReshapeInputOutputMismatchErrorMessage(r,u));const d=r.length,h=[];if(d>0){h[d-1]=1;for(let e=d-2;e>=0;--e)h[e]=h[e+1]*r[e+1]}const f=[];if(o>0){f[o-1]=1;for(let e=o-2;e>=0;--e)f[e]=f[e+1]*u[e+1]}const p=D.util.getArrayFromDType(n,s*o);for(let t=0;t<s;++t){let n=0;for(let r=0;r<d;++r)n+=e[t*d+r]*h[r];for(let e=0;e<o;++e)p[t*o+e]=Math.trunc(n/f[e]),n%=f[e]}return[p,[s,o],u]}const hp={kernelName:D.SparseReshape,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{inputIndices:r,inputShape:i,newShape:a}=t;if(2!==r.shape.length)throw new Error(`Input indices should be a matrix but received shape\n        ${r.shape}`);if(1!==i.shape.length)throw new Error(`Input shape should be a vector but received shape\n        ${i.shape}`);if(1!==a.shape.length)throw new Error(`Target shape should be a vector but received shape ${a.shape}`);const s=Array.from(n.data.get(i.dataId).values),o=n.data.get(r.dataId).values,u=Array.from(n.data.get(a.dataId).values),[l,c,d]=dp(o,r.shape,r.dtype,s,u);return[n.makeTensorInfo(c,r.dtype,l),n.makeTensorInfo([d.length],a.dtype,new Int32Array(d))]}};function fp(e,t,n,r,i,a=!1,s=0){const o=r.length,u=[t[0],e.length/t[0]],l=u[1],c=o>0?i[o-1]+1:0;if(c<0)throw new Error(D.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());const d=t.slice();d[0]=c;const h=d.reduce(((e,t)=>e*t),1),f=D.util.getArrayFromDType(n,h);if(0===o)return c>0&&f.fill(s),[f,d];if(c<=0)throw new Error(D.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let p=0,g=1,m=0,y=i[p];for(;;){let t=0;if(g<o){if(t=i[g],y===t){++g;continue}if(y>=t)throw new Error(D.backend_util.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=c)throw new Error(D.backend_util.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,c));y>m&&f.fill(s,m*l,y*l);for(let t=p;t<g;++t){const n=r[t];if(n<0||n>=u[0])throw new Error(D.backend_util.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(t,r[t],u[0]));for(let t=0;t<l;t++)f[y*l+t]+=e[n*l+t]}if(a)for(let e=0;e<l;e++)f[y*l+e]/=g-p;if(p=g,++g,m=y+1,y=t,g>o)break}return m<c&&f.fill(s,m*l,c*l),[f,d]}const pp={kernelName:D.SparseSegmentMean,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:a}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error(`Indices should be a vector but received shape\n          ${i.shape}`);if(1!==a.shape.length)throw new Error(`Segment ids should be a vector but received shape\n          ${a.shape}`);if(i.shape[0]!==a.shape[0])throw new Error("segmentIds and indices should have same size.");const s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,u=n.data.get(a.dataId).values,[l,c]=fp(s,r.shape,r.dtype,o,u,!0);return n.makeTensorInfo(c,r.dtype,l)}},gp={kernelName:D.SparseSegmentSum,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:a}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error(`Indices should be a vector but received shape\n         ${i.shape}`);if(1!==a.shape.length)throw new Error(`Segment ids should be a vector but received shape\n         ${a.shape}`);if(i.shape[0]!==a.shape[0])throw new Error("segmentIds and indices should have same size.");const s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,u=n.data.get(a.dataId).values,[l,c]=fp(s,r.shape,r.dtype,o,u);return n.makeTensorInfo(c,r.dtype,l)}},mp={kernelName:D.SparseToDense,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{sparseIndices:i,sparseValues:a,defaultValue:s}=t,{outputShape:o}=r,{sliceRank:u,numUpdates:l,sliceSize:c,strides:d,outputSize:h}=D.backend_util.calculateShapes(a,i,o),f=qf(n.bufferSync(i),n.bufferSync(a),o,h,c,l,u,d,n.data.get(s.dataId).values[0],!1);return n.makeTensorInfo(o,f.dtype,f.values)}},yp={kernelName:D.SplitV,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{numOrSizeSplits:a,axis:s}=r,o=D.util.parseAxisParam(s,i.shape)[0],u=D.backend_util.prepareSplitSize(i,a,o),l=new Array(i.shape.length).fill(0),c=i.shape.slice();return u.map((e=>{const t=[...c];t[o]=e;const r=pc({inputs:{x:i},backend:n,attrs:{begin:l,size:t}});return l[o]+=e,r}))}},vp=dl((e=>Math.sqrt(e))),bp=Ku(D.Sqrt,(e=>Math.sqrt(e))),xp={kernelName:D.Sqrt,backendName:"cpu",kernelFunc:bp},wp={kernelName:D.Square,backendName:"cpu",kernelFunc:({inputs:e,backend:t})=>{const{x:n}=e,r=t;qu(n,"square");const i=r.data.get(n.dataId).values,a=new Float32Array(i.length);for(let e=0;e<i.length;++e){const t=i[e];a[e]=t*t}return{dataId:r.write(a,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},kp=rl(((e,t)=>{const n=e-t;return n*n})),_p=_l(D.SquaredDifference,kp),Sp={kernelName:D.SquaredDifference,backendName:"cpu",kernelFunc:_p},Cp=Ku(D.Step,((e,t)=>{const n=t;return isNaN(e)?NaN:e>0?1:n.alpha})),Ap={kernelName:D.Step,backendName:"cpu",kernelFunc:Cp};function Ep(e,t,n,r){const i=(0,D.buffer)(e,t.dtype);for(let e=0;e<i.size;e++){const a=i.indexToLoc(e),s=new Array(a.length);for(let e=0;e<s.length;e++)s[e]=a[e]*n[e]+r[e];i.set(t.get(...s),...a)}return i}const Fp={kernelName:D.StridedSlice,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:a,end:s,strides:o,beginMask:u,endMask:l,ellipsisMask:c,newAxisMask:d,shrinkAxisMask:h}=r;qu(i,"stridedSlice");const{finalShapeSparse:f,finalShape:p,isIdentity:g,sliceDim0:m,isSimpleSlice:y,begin:v,end:b,strides:x}=D.slice_util.sliceInfo(i.shape,a,s,o,u,l,c,d,h);let w;if(g)w=Il({inputs:{x:i},backend:n,attrs:{shape:p}});else if(m||y){D.util.assert(i.shape.length>=1,(()=>`Input must have rank at least 1, got: ${i.shape.length}`));const e=D.slice_util.computeOutShape(v,b,x),t=pc({inputs:{x:i},backend:n,attrs:{begin:v,size:e}});w=Il({inputs:{x:t},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(t)}else{const e=Ep(f,n.bufferSync(i),x,v);w=n.makeTensorInfo(p,e.dtype,e.values)}return w}};class Ip{constructor(e,t,n,r,i,a){this.separator=D.util.encodeString(e),this.nGramWidths=t,this.leftPad=D.util.encodeString(n),this.rightPad=D.util.encodeString(r),this.padWidth=i,this.preserveShort=a}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}createNGrams(e,t,n,r,i,a){for(let s=0;s<i;++s){const o=this.getPadWidth(a),u=Math.max(0,o-s),l=Math.max(0,o-(i-(s+1))),c=a-(u+l),d=t+(u>0?0:s-o);let h=0;h+=u*this.leftPad.length;for(let t=0;t<c;++t)h+=e[d+t].length;h+=l*this.rightPad.length,h+=(u+l+c-1)*this.separator.length,n[r+s]=new Uint8Array(h);const f=n[r+s];let p=0;const g=e=>e.forEach((e=>f[p++]=e));for(let e=0;e<u;++e)g(this.leftPad),g(this.separator);for(let t=0;t<c-1;++t)g(e[d+t]),g(this.separator);if(c>0){g(e[d+c-1]);for(let e=0;e<l;++e)g(this.separator),g(this.rightPad)}else{for(let e=0;e<l-1;++e)g(this.rightPad),g(this.separator);g(this.rightPad)}}}compute(e,t){const n=e.length,r=t.length;if(r>0){let e=t[0];if(0!==e)throw new Error(`First split value must be 0, got ${e}`);for(let i=1;i<r;++i){let r=t[i]>=e;if(r=r&&t[i]<=n,!r)throw new Error(`Invalid split value ${t[i]}, must be in [${e}, ${n}]`);e=t[i]}if(e!==n)throw new Error(`Last split value must be data size. Expected ${n}, got ${e}`)}const i=r-1,a=D.util.getArrayFromDType("int32",r);if(0===n||0===r){const e=new Array(n);for(let e=0;e<=i;++e)a[e]=0;return[e,a]}a[0]=0;for(let e=1;e<=i;++e){const n=t[e]-t[e-1];let r=0;this.nGramWidths.forEach((e=>{r+=this.getNumNGrams(n,e)})),this.preserveShort&&n>0&&0===r&&(r=1),a[e]=a[e-1]+r}const s=new Array(a[i]);for(let n=0;n<i;++n){const r=t[n];let i=a[n];if(this.nGramWidths.forEach((a=>{const o=t[n+1]-t[n],u=this.getNumNGrams(o,a);this.createNGrams(e,r,s,i,u,a),i+=u})),this.preserveShort&&i===a[n]){const a=t[n+1]-t[n];if(0===a)continue;const o=a+2*this.padWidth,u=1;this.createNGrams(e,r,s,i,u,o)}}return[s,a]}}function Dp(e,t,n,r,i,a,s,o){return new Ip(n,r,i,a,s,o).compute(e,t)}const Np={kernelName:D.StringNGrams,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{separator:i,nGramWidths:a,leftPad:s,rightPad:o,padWidth:u,preserveShortSequences:l}=r,{data:c,dataSplits:d}=t,h=n.data.get(c.dataId).values,f=n.data.get(d.dataId).values,[p,g]=Dp(h,f,i,a,s,o,u,l);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(d.shape,"int32",g)]}};function $p(e,t,n,r){if(!e.length)return;if(0===t.length){for(let t=0;t<e.length;++t)r.push(e.subarray(t,t+1));return}if(1===t.length){const i=t[0];let a=e.indexOf(i);for(;-1!==a;){const t=e.subarray(0,a);n&&0===t.length||r.push(t),a=(e=e.subarray(a+1)).indexOf(i)}return void(n&&0===e.length||r.push(e))}let i=0;for(let a=0;a<e.length+1;a++)if(a===e.length||-1!==t.indexOf(e[a])){const t=e.subarray(i,a);n&&0===t.length||r.push(t),i=a+1}}function Tp(e,t,n){const r=e.length,i=[];let a=0,s=0;const o=new Array(r);for(let u=0;u<r;++u){const r=i.length;$p(e[u],t,n,i);const l=i.length-r;o[u]=l,a+=l,s=Math.max(s,l)}const u=D.util.getArrayFromDType("int32",2*a),l=new Array(a),c=[r,s];let d=0;for(let e=0;e<r;++e)for(let t=0;t<o[e];++t)u[2*d]=e,u[2*d+1]=t,l[d]=i[d],++d;return[u,l,c]}const Op={kernelName:D.StringSplit,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{skipEmpty:i}=r,{input:a,delimiter:s}=t;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error(`Input must be a vector, got shape: ${a.shape}`);if(0!==s.shape.length)throw new Error(`Delimiter must be a scalar, got shape: ${s.shape}`);const o=n.data.get(a.dataId).values,u=n.data.get(s.dataId).values[0],[l,c,d]=Tp(o,u,i),h=c.length;return[n.makeTensorInfo([h,2],"int32",l),n.makeTensorInfo([h],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(d))]}};function Mp(e,t){const n=D.util.getArrayFromDType("int32",e.length);for(let r=0;r<e.length;++r)n[r]=D.util.fingerPrint64(e[r]).modulo(t).getLowBitsUnsigned();return n}const Rp={kernelName:D.StringToHashBucketFast,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{numBuckets:i}=r,{input:a}=t;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const s=Mp(n.data.get(a.dataId).values,i);return n.makeTensorInfo(a.shape,"int32",s)}},Bp=Ku(D.Tan,(e=>Math.tan(e))),zp={kernelName:D.Tan,backendName:"cpu",kernelFunc:Bp},Lp=Ku(D.Tanh,(e=>Math.tanh(e))),Pp={kernelName:D.Tanh,backendName:"cpu",kernelFunc:Lp};function jp(e,t){const n=new Array(e.rank);for(let r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];const r=(0,D.buffer)(n,e.dtype);for(let t=0;t<r.values.length;++t){const n=r.indexToLoc(t),i=new Array(e.rank);for(let t=0;t<i.length;t++)i[t]=n[t]%e.shape[t];const a=e.locToIndex(i);r.values[t]=e.values[a]}return r}const Up={kernelName:D.Tile,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reps:a}=r;qu(i,"tile");const s=jp(n.bufferSync(i),a);return n.makeTensorInfo(s.shape,s.dtype,s.values)}},Wp=(e,t)=>{const n=t.value-e.value;return 0===n?e.index-t.index:n};function Vp(e,t,n=0,r=e.length-1){for(;r>n;){if(r-n>600){const i=r-n+1,a=t-n+1,s=Math.log(i),o=.5*Math.exp(2*s/3),u=.5*Math.sqrt(s*o*(i-o)/i)*Math.sign(a-i/2);Vp(e,t,Math.max(n,Math.floor(t-a*o/i+u)),Math.min(r,Math.floor(t+(i-a)*o/i+u)))}const i=e[t];let a=n,s=r;for(D.util.swap(e,n,t),Wp(e[r],i)>0&&D.util.swap(e,n,r);a<s;){for(D.util.swap(e,a,s),a++,s--;Wp(e[a],i)<0;)a+=1;for(;Wp(e[s],i)>0;)s-=1}0===Wp(e[n],i)?D.util.swap(e,n,s):(s+=1,D.util.swap(e,s,r)),s<=t&&(n=s+1),t<=s&&(r=s-1)}}function Gp(e,t,n,r,i){const a=t[t.length-1],[s,o]=[e.length/a,a],u=D.util.getTypedArrayFromDType(n,s*r),l=D.util.getTypedArrayFromDType("int32",s*r);for(let t=0;t<s;t++){const n=t*o,a=e.subarray(n,n+o);let s=new Array(a.length);a.forEach(((e,t)=>s[t]={value:e,index:t})),r<s.length&&(Vp(s,r),s=s.slice(0,r)),i&&s.sort(Wp);const c=t*r,d=u.subarray(c,c+r),h=l.subarray(c,c+r);for(let e=0;e<r;e++)d[e]=s[e].value,h[e]=s[e].index}const c=t.slice();return c[c.length-1]=r,[(0,D.buffer)(c,n,u),(0,D.buffer)(c,"int32",l)]}const qp={kernelName:D.TopK,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{k:a,sorted:s}=r;qu(i,"topk");const o=n.data.get(i.dataId).values,[u,l]=Gp(o,i.shape,i.dtype,a,s);return[n.makeTensorInfo(u.shape,u.dtype,u.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}},Hp={kernelName:D.Transform,backendName:"cpu",kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{image:i,transforms:a}=t,{interpolation:s,fillMode:o,fillValue:u,outputShape:l}=n,[c,d,h,f]=i.shape,[p,g]=null!=l?l:[d,h],m=[c,p,g,f],y=D.util.computeStrides(i.shape),v=y[0],b=y[1],x=y[2],w=D.util.getTypedArrayFromDType(i.dtype,D.util.sizeFromShape(m));w.fill(u);const k=r.data.get(i.dataId).values,_=r.data.get(a.dataId).values;for(let e=0;e<c;++e){const t=1===a.shape[0]?_:_.subarray(8*e,8*e+8);for(let n=0;n<p;++n)for(let r=0;r<g;++r)for(let i=0;i<f;++i){let a;const l=t[6]*r+t[7]*n+1;if(0===l)continue;const c=(t[0]*r+t[1]*n+t[2])/l,f=(t[3]*r+t[4]*n+t[5])/l,p=Xp(c,h,o),g=Xp(f,d,o);switch(s){case"nearest":a=Yp(k,d,h,v,b,x,e,g,p,i,u);break;case"bilinear":a=Qp(k,d,h,v,b,x,e,g,p,i,u);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${s}`)}w[e*v+n*b+r*x+i]=a}return r.makeTensorInfo(m,i.dtype,w)}return{dataId:r.write(w,m,i.dtype),shape:i.shape,dtype:i.dtype}}};function Xp(e,t,n){switch(n){case"reflect":return function(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const e=2*t;n<e&&(n=e*Math.trunc(-n/e)+n),n=n<-t?n+e:-n-1}else if(n>t-1)if(t<=1)n=0;else{const e=2*t;n-=e*Math.trunc(n/e),n>=t&&(n=e-n-1)}return D.util.clamp(0,n,t-1)}(e,t);case"wrap":return function(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const e=t-1;n+=t*(Math.trunc(-n/e)+1)}else if(n>t-1)if(t<=1)n=0;else{const e=t-1;n-=t*Math.trunc(n/e)}return D.util.clamp(0,n,t-1)}(e,t);case"nearest":return function(e,t){return D.util.clamp(0,e,t-1)}(e,t);default:return function(e,t){return e}(e)}}function Kp(e,t,n,r,i,a,s,o,u,l,c){return 0<=o&&o<t&&0<=u&&u<n?e[s*r+o*i+u*a+l]:c}function Yp(e,t,n,r,i,a,s,o,u,l,c){return Kp(e,t,n,r,i,a,s,Math.round(o),Math.round(u),l,c)}function Qp(e,t,n,r,i,a,s,o,u,l,c){const d=Math.floor(o),h=Math.floor(u),f=d+1,p=h+1;return(f-o)*((p-u)*Kp(e,t,n,r,i,a,s,d,h,l,c)+(u-h)*Kp(e,t,n,r,i,a,s,d,p,l,c))+(o-d)*((p-u)*Kp(e,t,n,r,i,a,s,f,h,l,c)+(u-h)*Kp(e,t,n,r,i,a,s,f,p,l,c))}function Jp(e,t,n,r){const i=D.util.parseAxisParam(t,n)[0],a=[1,n[0],1];for(let e=0;e<i;e++)a[0]*=n[e];a[1]=n[i];for(let e=i+1;e<n.length;e++)a[2]*=n[e];const s={},o=new Int32Array(n[i]),u=new D.TensorBuffer(a,r,e),l=[],c=1===a[0]&&1===a[2];for(let t=0;t<n[i];t++){let n;if(c)n=e[t].toString();else{const e=[];for(let n=0;n<a[0];n++)for(let r=0;r<a[2];r++)e.push(u.get(n,t,r));n=e.join(",")}if(void 0!==s[n])o[t]=s[n];else{const e=Object.keys(s).length;s[n]=e,o[t]=e,l.push(t)}}const d=a.slice();d[1]=Object.keys(s).length;const h=new D.TensorBuffer(d,r);l.forEach(((e,t)=>{for(let n=0;n<a[0];n++)for(let r=0;r<a[2];r++)h.set(u.get(n,e,r),n,t,r)}));const f=n.slice();return f[i]=d[1],{outputValues:h.values,outputShape:f,indices:o}}const Zp={kernelName:D.Unique,backendName:"cpu",kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{axis:i}=n,{x:a}=t;qu(a,"unique");const s=r.data.get(a.dataId).values,{outputValues:o,outputShape:u,indices:l}=Jp(s,i,a.shape,a.dtype);return[r.makeTensorInfo(u,a.dtype,o),r.makeTensorInfo([l.length],"int32",l)]}},eg={kernelName:D.Unpack,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{value:i}=t;let{axis:a}=r;a<0&&(a+=i.shape.length);const s=i.shape.length,o=i.shape[a],u=new Array(s-1);let l=0;for(let e=0;e<s;e++)e!==a&&(u[l++]=i.shape[e]);const c=new Array(s).fill(0),d=i.shape.slice();d[a]=1;const h=new Array(o);for(let e=0;e<h.length;e++){c[a]=e;const t=pc({inputs:{x:i},backend:n,attrs:{begin:c,size:d}});h[e]=Il({inputs:{x:t},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(t)}return h}},tg={kernelName:D.UnsortedSegmentSum,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,segmentIds:a}=t,{numSegments:s}=r;qu(i,"unsortedSegmentSum");const o=[],u=[],l=i.shape.length-a.shape.length;let c=a;for(let e=0;e<l;++e){const t=Sd({inputs:{input:c},backend:n,attrs:{dim:e+1}});c=t,u.push(t)}for(let e=0;e<s;++e){const t=D.util.createScalarValue(e,"int32"),r=n.makeTensorInfo([],"int32",t),a=dd({inputs:{a:r,b:c},backend:n}),s=wl({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),l=id({inputs:{a:s,b:i},backend:n}),d=sd({inputs:{x:l},backend:n,attrs:{axis:0,keepDims:!1}});o.push(d),u.push(r),u.push(a),u.push(s),u.push(l),u.push(d)}const d=_f({inputs:o,backend:n,attrs:{axis:0}});return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),d}},ng=[Tl,Ml,Bl,Ll,Fl,Pl,Vl,Gl,ql,Hl,Kl,Ql,Zl,nc,ic,uc,lc,cc,dc,$l,hc,mc,bc,xc,kl,_c,Cc,yl,Ac,Nc,Tc,Oc,Mc,Rc,Bc,zc,Pc,Uc,Wc,Vc,Gc,qc,Hc,Kc,Yc,Qc,Jc,Zc,ed,td,ud,Ju,ld,hd,xd,_d,Cd,Fd,Ld,jd,Ud,Gd,Xd,Kd,Yd,Jd,eh,rh,sh,el,oh,Ic,lh,dh,fh,nl,mh,bh,wh,Sh,Ah,Ih,Nh,Oh,Mh,Rh,Lh,Uh,Wh,Vh,Gh,qh,Hh,Xh,Kh,Jh,Zh,nf,of,ad,lf,df,ff,gf,vf,bf,kf,Sf,Cf,Ff,sl,Df,$f,xl,Nd,Of,ul,cl,Dl,Mf,Rf,Bf,zf,Lf,Pf,Uf,Gf,Hf,Xf,Jf,pl,ep,np,ip,gc,sf,op,up,cp,hp,pp,gp,mp,yp,xp,wp,Sp,Ap,Fp,Np,Op,Rp,Md,od,zp,Pp,Up,qp,Hp,Wl,Zp,eg,tg,wf];for(const e of ng)(0,D.registerKernel)(e);const rg={},ig={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function ag(e,t){if(!(e in rg)||null!=t){const n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=null==t?function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e):t;return n.addEventListener("webglcontextlost",(t=>{t.preventDefault(),delete rg[e]}),!1),1===e?n.getContext("webgl",ig)||n.getContext("experimental-webgl",ig):n.getContext("webgl2",ig)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;rg[e]=n}const n=rg[e];return null==n||n.isContextLost()?(delete rg[e],ag(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),rg[e])}var sg,og,ug;function lg(e,t){return[t,e]}function cg(e){const t=D.util.sizeFromShape(e),n=Math.ceil(t/4);return D.util.sizeToSquarishShape(n)}function dg(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function hg(e,t){const n=e;let r,i,a,s,o,u,l,c,d,h;return 2===(0,D.env)().getNumber("WEBGL_VERSION")?(r=n.R32F,i=n.R16F,a=n.RGBA16F,s=n.RGBA32F,o=n.RED,l=4,c=1,d=n.HALF_FLOAT,h=n.FLOAT,u=n.RGBA8):(r=e.RGBA,i=e.RGBA,a=e.RGBA,s=n.RGBA,o=e.RGBA,l=4,c=4,d=null!=t?t.HALF_FLOAT_OES:null,h=e.FLOAT,u=e.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:i,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:s,textureFormatFloat:o,downloadTextureFormat:u,downloadUnpackNumChannels:l,defaultNumChannels:c,textureTypeHalfFloat:d,textureTypeFloat:h}}function fg(e,t){const n=t();return(0,D.env)().getBool("DEBUG")&&function(e){const t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}(e,t))}(e),n}function pg(e){return!!((0,D.env)().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function gg(e,t){return Sg(e,(()=>e.getExtension(t)),'Extension "'+t+'" not supported on this browser.')}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(sg||(sg={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(og||(og={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(ug||(ug={}));const mg=/ERROR: [0-9]+:([0-9]+):/g;function yg(e,t){const n=mg.exec(t);if(null==n)return console.log(`Couldn't parse line number in error: ${t}`),void console.log(e);const r=+n[1],i=e.split("\n"),a=i.length.toString().length+2,s=i.map(((e,t)=>D.util.rightPad((t+1).toString(),a)+e));let o=0;for(let e=0;e<s.length;e++)o=Math.max(s[e].length,o);const u=s.slice(0,r-1),l=s.slice(r-1,r),c=s.slice(r);console.log(u.join("\n")),console.log(t.split("\n")[0]),console.log(`%c ${D.util.rightPad(l[0],o)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join("\n"))}function vg(e,t){if(fg(e,(()=>e.validateProgram(t))),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function bg(e,t,n,r,i,a,s){const o=e.getAttribLocation(t,n);return-1!==o&&(fg(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,r))),fg(e,(()=>e.vertexAttribPointer(o,i,e.FLOAT,!1,a,s))),fg(e,(()=>e.enableVertexAttribArray(o))),!0)}function xg(e,t,n,r){fg(e,(()=>function(e,t,n){(function(e,t){const n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error(`textureUnit must be in [gl.TEXTURE0, gl.TEXTURE${n}].`)})(e,n),fg(e,(()=>e.activeTexture(e.TEXTURE0+n))),fg(e,(()=>e.bindTexture(e.TEXTURE_2D,t)))}(e,t,r))),fg(e,(()=>e.uniform1i(n,r)))}function wg(e,t,n){fg(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,n))),fg(e,(()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)))}function kg(e,t){fg(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,t))),fg(e,(()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)))}function _g(e){const t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}(e,t))}function Sg(e,t,n){const r=fg(e,(()=>t()));if(null==r)throw new Error(n);return r}function Cg(e,t=2){return D.util.sizeFromShape(e.slice(0,e.length-t))}function Ag(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function Eg(e){let t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[Cg(e),...Ag(e)]),t}function Fg(e){return e%2==0}function Ig(e,t){if(e=e.slice(-2),t=t.slice(-2),D.util.arraysEqual(e,t))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){const n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(Fg(n)&&Fg(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&Fg(e[0])&&Fg(t[0])}let Dg,Ng;function $g(e,t){return null!=e.getExtension(t)}function Tg(e){try{if(null!=ag(e))return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function Og(e){const t=hg(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);const r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);const i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),i}function Mg(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>{null!=e&&D.util.assert("complex64"!==e.dtype,(()=>`${t} does not support complex64 tensors in the WebGL backend.`))}))}const Rg=(0,D.env)();function Bg(){let e,t,n,r,i,a,s,o,u,l;return 2===(0,D.env)().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",i="texture",a="outputColor",s="out vec4 outputColor;",o="\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",i="texture2D",a="gl_FragColor",s="",o="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:i,output:a,defineOutput:s,defineSpecialNaN:o,defineSpecialInf:u,defineRound:l}}function zg(e,t,n="index"){const r=D.util.computeStrides(t);return r.map(((t,i)=>`int ${e[i]} = ${n} / ${t}; ${i===r.length-1?`int ${e[i+1]} = ${n} - ${e[i]} * ${t}`:`index -= ${e[i]} * ${t}`};`)).join("")}function Lg(e,t,n="index"){const r=D.util.computeStrides(t);return r.map(((t,i)=>`int ${e[i]} = ${n} / outShapeStrides[${i}]; ${i===r.length-1?`int ${e[i+1]} = ${n} - ${e[i]} * outShapeStrides[${i}]`:`index -= ${e[i]} * outShapeStrides[${i}]`};`)).join("")}function Pg(e){const t=D.util.computeStrides(e).map((e=>e.toString()));return`\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;\n  }\n`}Rg.registerFlag("HAS_WEBGL",(()=>Rg.getNumber("WEBGL_VERSION")>0)),Rg.registerFlag("WEBGL_VERSION",(()=>Tg(2)?2:Tg(1)?1:0)),Rg.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(()=>!1)),Rg.registerFlag("WEBGL_BUFFER_SUPPORTED",(()=>2===Rg.get("WEBGL_VERSION"))),Rg.registerFlag("WEBGL_CPU_FORWARD",(()=>!0)),Rg.registerFlag("WEBGL_FORCE_F16_TEXTURES",(()=>!1)),Rg.registerFlag("WEBGL_PACK",(()=>Rg.getBool("HAS_WEBGL"))),Rg.registerFlag("WEBGL_PACK_NORMALIZATION",(()=>Rg.getBool("WEBGL_PACK"))),Rg.registerFlag("WEBGL_PACK_CLIP",(()=>Rg.getBool("WEBGL_PACK"))),Rg.registerFlag("WEBGL_PACK_DEPTHWISECONV",(()=>Rg.getBool("WEBGL_PACK"))),Rg.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(()=>Rg.getBool("WEBGL_PACK"))),Rg.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(()=>Rg.getBool("WEBGL_PACK"))),Rg.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(()=>Rg.getBool("WEBGL_PACK"))),Rg.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(()=>Rg.getBool("WEBGL_PACK"))),Rg.registerFlag("WEBGL_PACK_REDUCE",(()=>Rg.getBool("WEBGL_PACK"))),Rg.registerFlag("WEBGL_LAZILY_UNPACK",(()=>Rg.getBool("WEBGL_PACK"))),Rg.registerFlag("WEBGL_CONV_IM2COL",(()=>Rg.getBool("WEBGL_PACK"))),Rg.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(()=>function(e){if(null==Dg){const t=ag(e);Dg=t.getParameter(t.MAX_TEXTURE_SIZE)}return Dg}(Rg.getNumber("WEBGL_VERSION")))),Rg.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(()=>function(e){if(null==Ng){const t=ag(e);Ng=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Ng)}(Rg.getNumber("WEBGL_VERSION")))),Rg.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(()=>{const e=Rg.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;let t;const n=ag(e);return t=$g(n,"EXT_disjoint_timer_query_webgl2")&&2===e?2:$g(n,"EXT_disjoint_timer_query")?1:0,t}(e)})),Rg.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(()=>Rg.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!D.device_util.isMobile())),Rg.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(()=>function(e){if(0===e)return!1;const t=ag(e);if(1===e){if(!$g(t,"OES_texture_float"))return!1}else if(!$g(t,"EXT_color_buffer_float"))return!1;return Og(t)}(Rg.getNumber("WEBGL_VERSION")))),Rg.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(()=>!Rg.getBool("WEBGL_FORCE_F16_TEXTURES")&&Rg.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))),Rg.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(()=>function(e){if(0===e)return!1;const t=ag(e);if(1!==e){if($g(t,"EXT_color_buffer_float"))return Og(t);const e="EXT_color_buffer_half_float";if($g(t,e)){const n=t.getExtension(e);return function(e,t){const n=hg(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);const a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(i),a}(t,n)}return!1}return!!$g(t,"OES_texture_float")&&!!$g(t,"WEBGL_color_buffer_float")&&Og(t)}(Rg.getNumber("WEBGL_VERSION")))),Rg.registerFlag("WEBGL_FENCE_API_ENABLED",(()=>{return 2===(e=Rg.getNumber("WEBGL_VERSION"))&&null!=ag(e).fenceSync;var e})),Rg.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(()=>Rg.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0)),Rg.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(()=>-1),(e=>{if(e<0&&-1!==e)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${e}.`)})),Rg.registerFlag("WEBGL_FLUSH_THRESHOLD",(()=>D.device_util.isMobile()?1:-1),(e=>{if(e<0&&-1!==e)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${e}.`)})),Rg.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(()=>128)),Rg.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(()=>!1)),Rg.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(()=>1e5)),Rg.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(()=>128));const jg="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",{getBroadcastDims:Ug}=D.backend_util;function Wg(e,t,n){const r=[];if(e.forEach((e=>{const t=D.util.sizeFromShape(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push(`uniform float ${e.name}${t>1?`[${t}]`:""};`):(r.push(`uniform sampler2D ${e.name};`),r.push(`uniform int offset${e.name};`)),n.enableShapeUniforms){const{uniformShape:t}=Zg(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape);switch(t.length){case 1:r.push(`uniform int ${e.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${e.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${e.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${e.name}Shape;`)}r.push(`uniform ivec2 ${e.name}TexShape;`)}})),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((e=>{r.push(`uniform ${e.type} ${e.name}${e.arrayIndex?`[${e.arrayIndex}]`:""};`)}));const i=r.join("\n"),a=e.map((e=>function(e,t,n=!1,r){let i="";i+=n?Gg(e,r):Vg(e,r);const a=e.shapeInfo.logicalShape,s=t.logicalShape;return a.length<=s.length&&(i+=n?function(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",a=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,o=Ug(e.shapeInfo.logicalShape,t.logicalShape),u=Jg(s),l=s-a;let c;const d=["x","y","z","w","u","v"];c=0===a?"":s<2&&o.length>=1?"coords = 0;":o.map((e=>`coords.${d[e+l]} = 0;`)).join("\n");let h="";h=s<2&&a>0?"coords":e.shapeInfo.logicalShape.map(((e,t)=>`coords.${d[t+l]}`)).join(", ");let f="return outputValue;";const p=1===D.util.sizeFromShape(e.shapeInfo.logicalShape),g=1===D.util.sizeFromShape(t.logicalShape);if(1!==a||p||g){if(p&&!g)f=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(o.length){const e=a-2,t=a-1;o.indexOf(e)>-1&&o.indexOf(t)>-1?f="return vec4(outputValue.x);":o.indexOf(e)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":o.indexOf(t)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return`\n    vec4 ${i}() {\n      ${u} coords = getOutputCoords();\n      ${c}\n      vec4 outputValue = get${r}(${h});\n      ${f}\n    }\n  `}(e,t):function(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",a=t.texShape,s=e.shapeInfo.texShape,o=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&o===u&&null==e.shapeInfo.flatOffset&&D.util.arraysEqual(s,a))return`\n      float ${i}() {\n        return sampleTexture(${n}, resultUV);\n      }\n    `;const l=Jg(u),c=Ug(e.shapeInfo.logicalShape,t.logicalShape),d=u-o;let h;const f=["x","y","z","w","u","v"];h=0===o?"":u<2&&c.length>=1?"coords = 0;":c.map((e=>`coords.${f[e+d]} = 0;`)).join("\n");let p="";return p=u<2&&o>0?"coords":e.shapeInfo.logicalShape.map(((e,t)=>`coords.${f[t+d]}`)).join(", "),`\n    float ${i}() {\n      ${l} coords = getOutputCoords();\n      ${h}\n      return get${r}(${p});\n    }\n  `}(e,t)),i}(e,t,n.packedInputs,n.enableShapeUniforms))).join("\n"),s=t.texShape,o=Bg(),u=function(e){return`\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ${e.texture2D}(textureSampler, uv).r;\n    }\n  `}(o);let l,c,d=function(e){return`${e.version}\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ${e.varyingFs} vec2 resultUV;\n    ${e.defineOutput}\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ${e.defineSpecialNaN}\n    ${e.defineSpecialInf}\n    ${e.defineRound}\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ${qg}\n    ${Hg}\n    ${Xg}\n  `}(o);return t.isPacked?(l=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===r[0]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ${r[1]}.0);\n      }\n    `:1===r[1]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":`\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ${r[0]}.0);\n      }\n    `:n?"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ":`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);\n    }\n  `}(0,t,n);case 2:return function(e,t,n){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(D.util.arraysEqual(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));\n      }\n    `;const i=Math.ceil(e[1]/2);return n?"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ":`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n      int r = 2 * (index / ${i});\n      int c = imod(index, ${i}) * 2;\n\n      return ivec2(r, c);\n    }\n  `}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],i=Math.ceil(e[2]/2),a=i*Math.ceil(e[1]/2);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n\n      int b = index / ${a};\n      index -= b * ${a};\n\n      int r = 2 * (index / ${i});\n      int c = imod(index, ${i}) * 2;\n\n      return ivec3(b, r, c);\n    }\n  `}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],i=Math.ceil(e[e.length-1]/2),a=i*Math.ceil(e[e.length-2]/2);let s=a,o="",u="b, r, c";for(let t=2;t<e.length-1;t++)s*=e[e.length-t-1],o=`\n      int b${t} = index / ${s};\n      index -= b${t} * ${s};\n    `+o,u=`b${t}, `+u;return`\n    ivec${e.length} getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${r[0]}, ${r[1]}));\n      int index = resTexRC.x * ${r[1]} + resTexRC.y;\n\n      ${o}\n\n      int b = index / ${a};\n      index -= b * ${a};\n\n      int r = 2 * (index / ${i});\n      int c = imod(index, ${i}) * 2;\n\n      return ivec${e.length}(${u});\n    }\n  `}(e,t,n)}}(t.logicalShape,s,n.enableShapeUniforms),c=function(e){return`\n    void setOutput(vec4 val) {\n      ${e.output} = val;\n    }\n  `}(o)):(l=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){return 1===t[0]?n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.x * ${t[1]}.0);\n      }\n    `:1===t[1]?n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":`\n      int getOutputCoords() {\n        return int(resultUV.y * ${t[0]}.0);\n      }\n    `:n?"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ":`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      return resTexRC.x * ${t[1]} + resTexRC.y;\n    }\n  `}(0,t,n);case 2:return function(e,t,n){return D.util.arraysEqual(e,t)?n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));\n      }\n    `:1===e[1]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${t[0]}, ${t[1]}));\n        int index = resTexRC.x * ${t[1]} + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    `:1===e[0]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${t[0]}, ${t[1]}));\n        int index = resTexRC.x * ${t[1]} + resTexRC.y;\n        return ivec2(0, index);\n      }\n    `:n?"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ":`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      int r = index / ${e[1]};\n      int c = index - r * ${e[1]};\n      return ivec2(r, c);\n    }\n  `}(e,t,n);case 3:return function(e,t,n){if(n)return`\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ${Lg(["r","c","d"],e)}\n    return ivec3(r, c, d);\n  }\n`;const r=zg(["r","c","d"],e);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      ${r}\n      return ivec3(r, c, d);\n    }\n  `}(e,t,n);case 4:return function(e,t,n){if(n)return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ${Lg(["r","c","d","d2"],e)}\n      return ivec4(r, c, d, d2);\n    }\n  `;const r=zg(["r","c","d","d2"],e);return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n      ${r}\n      return ivec4(r, c, d, d2);\n    }\n  `}(e,t,n);case 5:return function(e,t){const n=zg(["r","c","d","d2","d3"],e);return`\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},\n                             ${t[1]}));\n\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  `}(e,t);case 6:return function(e,t){const n=zg(["r","c","d","d2","d3","d4"],e);return`\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${t[0]}, ${t[1]}));\n      int index = resTexRC.x * ${t[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  `}(e,t);default:throw new Error(`${e.length}-D output sampling is not yet supported`)}}(t.logicalShape,s,n.enableShapeUniforms),c=function(e){return`\n    void setOutput(float val) {\n      ${e.output} = vec4(val, 0, 0, 0);\n    }\n  `}(o)),n.packedInputs&&(d+=Kg),[d,u,c,i,l,a,n.userCode].join("\n")}function Vg(e,t=!1){const n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`float ${r}() {return ${n};}`;const[i,a]=e.shapeInfo.texShape;if(1===i&&1===a)return`\n      float ${r}() {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const s=Yg(n);if(t)return`\n    float ${r}() {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${s});\n      return sampleTexture(${n}, uv);\n    }\n  `;const[o,u]=e.shapeInfo.texShape;return`\n    float ${r}() {\n      vec2 uv = uvFromFlat(${o}, ${u}, ${s});\n      return sampleTexture(${n}, uv);\n    }\n  `}(e,t);case 1:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`\n      float ${r}(int index) {\n        ${Qg(e)}\n      }\n    `;const i=e.shapeInfo.texShape,a=i[0],s=i[1];if(1===s&&1===a)return`\n      float ${r}(int index) {\n        return sampleTexture(${n}, halfCR);\n      }\n    `;const o=Yg(n);return 1===s?t?`\n      float ${r}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / float(${n}TexShape[0]));\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${r}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / ${a}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `:1===a?t?`\n      float ${r}(int index) {\n        vec2 uv = vec2((float(index + ${o}) + 0.5) / float(${n}TexShape[1]), 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `:`\n      float ${r}(int index) {\n        vec2 uv = vec2((float(index + ${o}) + 0.5) / ${s}.0, 0.5);\n        return sampleTexture(${n}, uv);\n      }\n    `:t?`\n    float ${r}(int index) {\n      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${o});\n      return sampleTexture(${n}, uv);\n    }\n  `:`\n    float ${r}(int index) {\n      vec2 uv = uvFromFlat(${a}, ${s}, index + ${o});\n      return sampleTexture(${n}, uv);\n    }\n  `}(e,t);case 2:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape;if(null!=a&&D.util.arraysEqual(n,a)){if(t)return`\n      float ${i}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `;const e=a[0];return`\n    float ${i}(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(${a[1]}.0, ${e}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `}const{newShape:s,keptDims:o}=D.util.squeezeShape(n),u=s;if(u.length<n.length){const n=["row","col"];return`\n      ${Vg(em(e,u),t)}\n      float ${i}(int row, int col) {\n        return ${i}(${tm(n,o)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${i}(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));\n        ${Qg(e)}\n      }\n    `;const l=a[0],c=a[1],d=Yg(r);return 1===c?t?`\n      float ${i}(int row, int col) {\n        float index = dot(vec3(row, col, ${d}), vec3(${r}Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${i}(int row, int col) {\n      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `:1===l?t?`\n      float ${i}(int row, int col) {\n        float index = dot(vec3(row, col, ${d}), vec3(${r}Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${i}(int row, int col) {\n      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);\n      return sampleTexture(${r}, uv);\n    }\n  `:t?`\n      float ${i}(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${r}Shape[1] + col + ${d};\n        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n  float ${i}(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ${n[1]} + col + ${d};\n    vec2 uv = uvFromFlat(${l}, ${c}, index);\n    return sampleTexture(${r}, uv);\n  }\n`}(e,t);case 3:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=n[1]*n[2],s=n[2],{newShape:o,keptDims:u}=D.util.squeezeShape(n),l=o;if(l.length<n.length){const n=["row","col","depth"];return`\n        ${Vg(em(e,l),t)}\n        float ${i}(int row, int col, int depth) {\n          return ${i}(${tm(n,u)});\n        }\n      `}if(e.shapeInfo.isUniform)return`\n      float ${i}(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(${a}, ${s}, 1)));\n        ${Qg(e)}\n      }\n    `;const c=e.shapeInfo.texShape,d=c[0],h=c[1],f=e.shapeInfo.flatOffset;if(h===a&&null==f)return t?`\n      float ${i}(int row, int col, int depth) {\n        int stride1 = ${r}Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n        float ${i}(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(${s}, 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(${h}.0, ${d}.0);\n          return sampleTexture(${r}, uv);\n        }\n      `;if(h===s&&null==f)return t?`\n      float ${i}(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n    float ${i}(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}.0, ${d}.0);\n      return sampleTexture(${r}, uv);\n    }\n  `;const p=Yg(r);return t?`\n    float ${i}(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ${r}Shape[1] * ${r}Shape[2];\n      int stride1 = ${r}Shape[2];\n      int index = row * ${a} + col * ${s} + depth + ${p};\n      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);\n      return sampleTexture(${r}, uv);\n    }\n    `:`\n      float ${i}(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${a} + col * ${s} + depth + ${p};\n        vec2 uv = uvFromFlat(${d}, ${h}, index);\n        return sampleTexture(${r}, uv);\n      }\n  `}(e,t);case 4:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=n[3],s=n[2]*a,o=n[1]*s,{newShape:u,keptDims:l}=D.util.squeezeShape(n);if(u.length<n.length){const n=["row","col","depth","depth2"];return`\n      ${Vg(em(e,u),t)}\n      float ${i}(int row, int col, int depth, int depth2) {\n        return ${i}(${tm(n,l)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${i}(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(${o}, ${s}, ${a}, 1)));\n        ${Qg(e)}\n      }\n    `;const c=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,h=d[0],f=d[1],p=`int stride2 = ${r}Shape[3];`,g=`int stride1 = ${r}Shape[2] * stride2;`,m=`int stride0 = ${r}Shape[1] * stride1;`;if(f===o&&null==c)return t?`\n      float ${i}(int row, int col, int depth, int depth2) {\n        ${p}\n        ${g}\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n      float ${i}(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(${s}, ${a}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${f}.0, ${h}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `;if(f===a&&null==c)return t?`\n      float ${i}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${r}TexShape[1], ${r}TexShape[0]);\n        return sampleTexture(${r}, uv);\n      }\n    `:`\n      float ${i}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${n[1]*n[2]}, ${n[2]}, 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${f}.0, ${h}.0);\n        return sampleTexture(${r}, uv);\n      }\n    `;const y=Yg(r);return t?`\n    float ${i}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ${p}\n      ${g}\n      ${m}\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${y});\n      return sampleTexture(${r}, uv);\n    }\n  `:`\n    float ${i}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${o} + col * ${s} +\n          depth * ${a} + depth2;\n      vec2 uv = uvFromFlat(${h}, ${f}, index + ${y});\n      return sampleTexture(${r}, uv);\n    }\n  `}(e,t);case 5:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[4],a=t[3]*i,s=t[2]*a,o=t[1]*s,{newShape:u,keptDims:l}=D.util.squeezeShape(t);if(u.length<t.length){const t=["row","col","depth","depth2","depth3"];return`\n      ${Vg(em(e,u))}\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        return ${r}(${tm(t,l)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${o}, ${s}, ${a}, ${i})) +\n          depth3;\n        ${Qg(e)}\n      }\n    `;const c=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,h=d[0],f=d[1];if(f===o&&null==c)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(${s}, ${a}, ${i}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${f}.0, ${h}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(f===i&&null==c)return`\n      float ${r}(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${t[1]*t[2]*t[3]},\n               ${t[2]*t[3]}, ${t[3]}, 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${f}.0, ${h}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;return`\n    float ${r}(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${o} + col * ${s} + depth * ${a} +\n          depth2 * ${i} + depth3 + ${Yg(n)};\n      vec2 uv = uvFromFlat(${h}, ${f}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(e);case 6:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:i,keptDims:a}=D.util.squeezeShape(t);if(i.length<t.length){const t=["row","col","depth","depth2","depth3","depth4"];return`\n      ${Vg(em(e,i))}\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ${r}(${tm(t,a)});\n      }\n    `}const s=t[5],o=t[4]*s,u=t[3]*o,l=t[2]*u,c=t[1]*l;if(e.shapeInfo.isUniform)return`\n      float ${r}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(${c}, ${l}, ${u}, ${o})) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(${s}, 1)));\n        ${Qg(e)}\n      }\n    `;const d=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,f=h[0],p=h[1];if(p===c&&null==d)return`\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(${l}, ${u}, ${o}, ${s})) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${f}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(p===s&&null==d)return`\n      float ${r}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(${t[1]*t[2]*t[3]*t[4]},\n               ${t[2]*t[3]*t[4]},\n               ${t[3]*t[4]},\n               ${t[4]})) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${f}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;return`\n    float ${r}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${c} + col * ${l} + depth * ${u} +\n          depth2 * ${o} + depth3 * ${s} + depth4 + ${Yg(n)};\n      vec2 uv = uvFromFlat(${f}, ${p}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}(e);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function Gg(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){const t=e.name;return`\n    vec4 ${"get"+t.charAt(0).toUpperCase()+t.slice(1)}() {\n      return ${Bg().texture2D}(${t}, halfCR);\n    }\n  `}(e);case 1:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape,a=Bg();if(t)return`\n    vec4 ${r}(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ${a.texture2D}(${n}, uv);\n    }\n  `;const s=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return`\n    vec4 ${r}(int index) {\n      vec2 uv = packedUVfrom1D(\n        ${s[0]}, ${s[1]}, index);\n      return ${a.texture2D}(${n}, uv);\n    }\n  `}(e,t);case 2:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape,s=a[0],o=a[1],u=Bg();if(null!=a&&D.util.arraysEqual(n,a))return t?`\n      vec4 ${i}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);\n\n        return ${u.texture2D}(${r}, uv);\n      }\n    `:`\n      vec4 ${i}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${o}.0, ${s}.0);\n\n        return ${u.texture2D}(${r}, uv);\n      }\n    `;if(t)return`\n    vec4 ${i}(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ${u.texture2D}(${r}, uv);\n    }\n  `;const l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return`\n    vec4 ${i}(int row, int col) {\n      vec2 uv = packedUVfrom2D(${Math.ceil(n[1]/2)}, ${l[0]}, ${l[1]}, row, col);\n      return ${u.texture2D}(${r}, uv);\n    }\n  `}(e,t);case 3:return function(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape,s=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(1===n[0]){const r=[1,2],a=["b","row","col"];return`\n        ${Gg(em(e,n.slice(1)),t)}\n        vec4 ${i}(int b, int row, int col) {\n          return ${i}(${tm(a,r)});\n        }\n      `}const o=Bg();if(t)return`\n    vec4 ${i}(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ${o.texture2D}(${r}, uv);\n    }\n  `;const u=s[0],l=s[1],c=Math.ceil(n[2]/2);return`\n    vec4 ${i}(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ${u}, ${l}, ${c*Math.ceil(n[1]/2)}, ${c}, b, row, col);\n      return ${o.texture2D}(${r}, uv);\n    }\n  `}(e,t);default:return function(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=Bg();if(t)return`\n    vec4 ${r}(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ${n}Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${i.texture2D}(${n}, uv);\n    }\n  `;const a=e.shapeInfo.logicalShape,s=a.length,o=e.shapeInfo.texShape,u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],l=u[0],c=u[1],d=Math.ceil(a[s-1]/2);let h=d*Math.ceil(a[s-2]/2),f="int b, int row, int col",p=`b * ${h} + (row / 2) * ${d} + (col / 2)`;for(let e=2;e<s-1;e++)f=`int b${e}, `+f,h*=a[s-e-1],p=`b${e} * ${h} + `+p;return`\n    vec4 ${r}(${f}) {\n      int index = ${p};\n      int texR = index / ${c};\n      int texC = index - texR * ${c};\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${l});\n      return ${i.texture2D}(${n}, uv);\n    }\n  `}(e,t)}}const qg="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Hg="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Xg="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Kg="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Yg(e){return`offset${e}`}function Qg(e){const t=e.name,n=D.util.sizeFromShape(e.shapeInfo.logicalShape);return n<2?`return ${t};`:`\n    for (int i = 0; i < ${n}; i++) {\n      if (i == index) {\n        return ${t}[i];\n      }\n    }\n  `}function Jg(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error(`GPU for rank ${e} is not yet supported`)}function Zg(e,t,n){const{newShape:r,keptDims:i}=D.util.squeezeShape(t),a=t.length,s=e&&3===a&&1===t[0],o=s?t.slice(1):r,u=!e&&a>1&&!D.util.arraysEqual(t,n)&&r.length<a||s;return{useSqueezeShape:u,uniformShape:u?o:t,keptDims:i}}function em(e,t){const n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function tm(e,t){return t.map((t=>e[t])).join(", ")}function nm(e,t,n){const r={},i={},a={},s=[];let o,u,l,c=null,d=null;d=e.getUniformLocation(n,"NAN",!1),1===(0,D.env)().getNumber("WEBGL_VERSION")&&(c=e.getUniformLocation(n,"INFINITY",!1));const h=!1;for(let s=0;s<t.variableNames.length;s++){const o=t.variableNames[s];r[o]=e.getUniformLocation(n,o,h),r[`offset${o}`]=e.getUniformLocation(n,`offset${o}`,h),t.enableShapeUniforms&&(i[`${o}Shape`]=e.getUniformLocation(n,`${o}Shape`,h),a[`${o}TexShape`]=e.getUniformLocation(n,`${o}TexShape`,h))}return t.enableShapeUniforms&&(o=e.getUniformLocation(n,"outShape",h),l=e.getUniformLocation(n,"outShapeStrides",h),u=e.getUniformLocation(n,"outTexShape",h)),t.customUniforms&&t.customUniforms.forEach(((t,r)=>{s[r]=e.getUniformLocation(n,t.name,h)})),{uniformLocations:r,customUniformLocations:s,infLoc:c,nanLoc:d,inShapesLocations:i,inTexShapesLocations:a,outShapeLocation:o,outShapeStridesLocation:l,outTexShapeLocation:u}}function rm(e,t){if(e.length!==t.length)throw Error(`Binary was compiled with ${e.length} inputs, but was executed with ${t.length} inputs`);e.forEach(((e,n)=>{const r=e.logicalShape,i=t[n],a=i.shape;if(!D.util.arraysEqual(r,a))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${a} must match`);if(e.isUniform&&i.isUniform)return;const s=e.texShape,o=i.isUniform?null:i.texData.texShape;if(!D.util.arraysEqual(s,o))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${s} and ${o} must match`)}))}function im(e){return(0,D.env)().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}class am{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=sg.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Bg();this.outputShape=e,this.enableShapeUniforms=im(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?Lg(["r","c","d"],e):zg(["r","c","d"],e)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ${t.output} = result;\n      }\n    `}}class sm{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=sg.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Bg();this.outputShape=e,this.enableShapeUniforms=im(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?Lg(["r","c","d"],e):zg(["r","c","d"],e)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ${t.output} = result;\n      }\n    `}}class om{constructor(e){this.variableNames=["A"],this.outTexUsage=og.DOWNLOAD;const t=Bg();this.outputShape=e,this.userCode=`\n      ${jg}\n\n      void main() {\n        float x = getAAtOutCoords();\n        ${t.output} = encode_float(x);\n      }\n    `}}class um{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=og.DOWNLOAD;const t=Bg();this.outputShape=e,this.userCode=`\n      ${jg}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ${t.output} = encode_float(x);\n      }\n    `}}class lm{constructor(e,t=!1){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Bg();this.outputShape=e,this.enableShapeUniforms=im(this.outputShape.length);let r="result";t&&(r="floor(result * 255. + 0.5)"),this.userCode=`\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Pg(e)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / texShape[1];\n        int c = imod(flatIndex, texShape[1]);\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n        vec4 values = ${n.texture2D}(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ${n.output} = vec4(${r}, 0., 0., 0.);\n      }\n    `}}class cm{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Bg();this.outputShape=e,this.enableShapeUniforms=im(this.outputShape.length);let r="",i="result";t&&(i="floor(result * 255. + 0.5)");for(let t=0;t<=1;t++)for(let i=0;i<=1;i++){const a=2*t+i;r+=`\n          localCoords = coords;\n          if(localCoords[2] + ${i} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {\n          localCoords[2] += ${i};\n          if (localCoords[1] + ${t} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {\n            localCoords[1] += ${t};\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ${n.texture2D}(A, uv);\n\n            if (offset == 0) {\n              result[${a}] = values[0];\n            } else if (offset == 1) {\n              result[${a}] = values[1];\n            } else if (offset == 2) {\n              result[${a}] = values[2];\n            } else {\n              result[${a}] = values[3];\n            }\n          }\n        }\n        `}this.userCode=`\n        ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Pg(e)}\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ${r}\n\n          ${n.output} = ${i};\n        }\n    `}}function dm(e,t,n,r,i,a){!function(e,t){const n=(0,D.env)().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0)throw new Error(`Requested texture size [${e}x${t}] is invalid.`);if(e>n||t>n)throw new Error(`Requested texture size [${e}x${t}] greater than WebGL maximum on this browser / GPU [${n}x${n}].`)}(t,n);const s=function(e){return Sg(e,(()=>e.createTexture()),"Unable to create WebGLTexture.")}(e),o=e.TEXTURE_2D;return fg(e,(()=>e.bindTexture(o,s))),fg(e,(()=>e.texParameteri(o,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE))),fg(e,(()=>e.texParameteri(o,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE))),fg(e,(()=>e.texParameteri(o,e.TEXTURE_MIN_FILTER,e.NEAREST))),fg(e,(()=>e.texParameteri(o,e.TEXTURE_MAG_FILTER,e.NEAREST))),1===(0,D.env)().getNumber("WEBGL_VERSION")?fg(e,(()=>e.texImage2D(o,0,r,t,n,0,i,a,null))):fg(e,(()=>e.texStorage2D(o,1,r,t,n))),fg(e,(()=>e.bindTexture(e.TEXTURE_2D,null))),{texture:s,texShape:[n,t]}}function hm(e){return e.internalFormatFloat}function fm(e){return e.internalFormatHalfFloat}function pm(e){return e.downloadTextureFormat}function gm(e){return e.internalFormatPackedFloat}function mm(e){return e.internalFormatPackedHalfFloat}class ym{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];const t=(0,D.env)().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,function(e,t){rg[e]=t}(t,e)):this.gl=ag(t);let n="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===(0,D.env)().getNumber("WEBGL_VERSION")){const e="OES_texture_float",t="OES_texture_half_float";if(this.textureFloatExtension=gg(this.gl,e),$g(this.gl,t))this.textureHalfFloatExtension=gg(this.gl,t);else if((0,D.env)().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),$g(this.gl,r))this.colorBufferHalfFloatExtension=gg(this.gl,r);else if((0,D.env)().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",$g(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!$g(this.gl,r))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(r)}this.vertexBuffer=function(e){return function(e,t){const n=Sg(e,(()=>e.createBuffer()),"Unable to create WebGLBuffer");return fg(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,n))),fg(e,(()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW))),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}(this.gl),this.indexBuffer=function(e){return function(e,t){const n=Sg(e,(()=>e.createBuffer()),"Unable to create WebGLBuffer");return fg(e,(()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n))),fg(e,(()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW))),n}(e,new Uint16Array([0,1,2,2,1,3]))}(this.gl),this.framebuffer=function(e){return Sg(e,(()=>e.createFramebuffer()),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=hg(this.gl,this.textureHalfFloatExtension)}get debug(){return(0,D.env)().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;fg(e,(()=>e.finish())),fg(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,null))),fg(e,(()=>e.deleteFramebuffer(this.framebuffer))),fg(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,null))),fg(e,(()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null))),fg(e,(()=>e.deleteBuffer(this.indexBuffer))),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[i,a]=lg(t,n);return dm(e,i,a,hm(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[i,a]=lg(t,n);return dm(e,i,a,fm(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[i,a]=lg(t,n);return dm(e,i,a,pm(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),function(e,t,n){fg(e,(()=>e.bindTexture(e.TEXTURE_2D,t))),n.data instanceof Uint8Array?2===(0,D.env)().getNumber("WEBGL_VERSION")?fg(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data))):fg(e,(()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data))):2===(0,D.env)().getNumber("WEBGL_VERSION")?fg(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n))):fg(e,(()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n))),fg(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))}(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,i,a){let s,o,u;fg(e,(()=>e.bindTexture(e.TEXTURE_2D,t))),i instanceof Uint8Array?(s=new Uint8Array(n*r*4),o=e.UNSIGNED_BYTE,u=e.RGBA):(s=new Float32Array(n*r*4),o=e.FLOAT,u=a.internalFormatPackedFloat),s.set(i),2===(0,D.env)().getNumber("WEBGL_VERSION")?fg(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,o,s))):fg(e,(()=>e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,o,s))),fg(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))}(this.gl,e,t,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[i,a]=dg(t,n);return dm(e,i,a,mm(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[i,a]=dg(t,n);return dm(e,i,a,gm(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(kg(this.gl,this.framebuffer),this.outputTexture=null),fg(this.gl,(()=>this.gl.deleteTexture(e)))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){return this.downloadMatrixDriver(e,(()=>function(e,t,n,r){const[i,a]=lg(t,n),s=new Uint8Array(t*n*4);return fg(e,(()=>e.readPixels(0,0,i,a,r.downloadTextureFormat,e.UNSIGNED_BYTE,s))),new Float32Array(s.buffer)}(this.gl,t,n,this.textureConfig)))}downloadPackedMatrixFromBuffer(e,t,n,r,i,a){return function(e,t,n,r,i,a,s,o){const u=e,l=new Float32Array(function(e,t){const[n,r]=dg(e,t);return n*r*4}(a,s));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}(this.gl,e,0,0,0,i,a,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return function(e,t,n){const r=e,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}(this.gl,e,t)}createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);const r=function(e,t,n,r){const i=e.createBuffer();fg(e,(()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,i)));const a=16*t*n;return fg(e,(()=>e.bufferData(e.PIXEL_PACK_BUFFER,a,e.STREAM_READ))),fg(e,(()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0))),fg(e,(()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null))),i}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,n;if((0,D.env)().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{const e=r.clientWaitSync(i,0,0);return e===r.ALREADY_SIGNALED||e===r.CONDITION_SATISFIED},t=i}else(0,D.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(t,(0,D.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:t,isFencePassed:n}}downloadMatrixFromPackedTexture(e,t,n){return this.downloadMatrixDriver(e,(()=>function(e,t,n){const r=new Float32Array(t*n*4);return fg(e,(()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r))),r}(this.gl,t,n)))}createProgram(e){this.throwIfDisposed();const t=this.gl;null==this.vertexShader&&(this.vertexShader=function(e){const t=Bg();return function(e,t){const n=Sg(e,(()=>e.createShader(e.VERTEX_SHADER)),"Unable to create vertex WebGLShader.");if(fg(e,(()=>e.shaderSource(n,t))),fg(e,(()=>e.compileShader(n))),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,`${t.version}\n    precision highp float;\n    ${t.attribute} vec3 clipSpacePos;\n    ${t.attribute} vec2 uv;\n    ${t.varyingVs} vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }`)}(t));const n=function(e){return Sg(e,(()=>e.createProgram()),"Unable to create WebGLProgram.")}(t);return fg(t,(()=>t.attachShader(n,this.vertexShader))),fg(t,(()=>t.attachShader(n,e))),function(e,t){if(fg(e,(()=>e.linkProgram(t))),!(0,D.env)().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(t,n),this.debug&&vg(t,n),this.vertexAttrsAreBound||(this.setProgram(n),this.vertexAttrsAreBound=function(e,t,n){return fg(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,n))),bg(e,t,"clipSpacePos",n,3,20,0)&&bg(e,t,"uv",n,2,20,12)}(t,this.program,this.vertexBuffer)),n}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&fg(this.gl,(()=>this.gl.deleteProgram(e)))}setProgram(e){this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&vg(this.gl,this.program),fg(this.gl,(()=>this.gl.useProgram(e)))}getUniformLocation(e,t,n=!0){return this.throwIfDisposed(),n?function(e,t,n){return Sg(e,(()=>e.getUniformLocation(t,n)),'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),fg(this.gl,(()=>this.gl.getAttribLocation(e,t)))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),xg(this.gl,e,t,n)}setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();const[r,i]=dg(t,n);this.setOutputMatrixTextureDriver(e,r,i)}setOutputMatrixWriteRegion(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&vg(this.gl,this.program),_g(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;this.debug&&this.debugValidate(),fg(e,(()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),fg(this.gl,(()=>this.gl.finish()))}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=gg(this.gl,2===(0,D.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===(0,D.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(2===(0,D.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2();return void e.endQuery(t.TIME_ELAPSED_EXT)}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await D.util.repeatedTry((()=>this.disposed||this.isQueryAvailable(e,(0,D.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")))),this.getQueryTime(e,(0,D.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(0===t)return null;if(2===t){const t=this.gl;return t.getQueryParameter(e,t.QUERY_RESULT)/1e6}{const t=this.getQueryTimerExtensionWebGL1();return t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(0===t)return!0;if(2===t){const t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.getQueryParameter(e,t.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}{const t=this.getQueryTimerExtensionWebGL1(),n=t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(t.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(e){return new Promise((t=>{this.addItemToPoll((()=>e.isFencePassed()),(()=>t()))}))}pollItems(){const e=function(e){let t=0;for(;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((e=>e.isDoneFn)));for(let t=0;t<=e;++t){const{resolveFn:e}=this.itemsToPoll[t];e()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||D.util.repeatedTry((()=>(this.pollItems(),0===this.itemsToPoll.length)))}bindTextureToFrameBuffer(e){this.throwIfDisposed(),wg(this.gl,e,this.framebuffer),this.debug&&_g(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(wg(this.gl,this.outputTexture,this.framebuffer),this.debug&&_g(this.gl)):kg(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const n=t();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();const r=this.gl;wg(r,e,this.framebuffer),this.debug&&_g(r),this.outputTexture=e,fg(r,(()=>r.viewport(0,0,t,n))),fg(r,(()=>r.scissor(0,0,t,n)))}setOutputMatrixWriteRegionDriver(e,t,n,r){this.throwIfDisposed(),fg(this.gl,(()=>this.gl.scissor(e,t,n,r)))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}const{addImpl:vm,bincountImpl:bm,bincountReduceImpl:xm,ceilImpl:wm,concatImpl:km,equalImpl:_m,expImpl:Sm,expm1Impl:Cm,floorImpl:Am,gatherNdImpl:Em,gatherV2Impl:Fm,greaterImpl:Im,greaterEqualImpl:Dm,lessImpl:Nm,lessEqualImpl:$m,linSpaceImpl:Tm,logImpl:Om,maxImpl:Mm,maximumImpl:Rm,minimumImpl:Bm,multiplyImpl:zm,negImpl:Lm,notEqualImpl:Pm,prodImpl:jm,rangeImpl:Um,rsqrtImpl:Wm,sigmoidImpl:Vm,simpleAbsImpl:Gm,sliceImpl:qm,sparseFillEmptyRowsImpl:Hm,sparseReshapeImpl:Xm,sparseSegmentReductionImpl:Km,sqrtImpl:Ym,stridedSliceImpl:Qm,stringNGramsImpl:Jm,stringSplitImpl:Zm,stringToHashBucketFastImpl:ey,subImpl:ty,tileImpl:ny,topKImpl:ry,transposeImpl:iy,uniqueImpl:ay}=e;function sy(e,t){return["x","y","z","w","u","v"].slice(0,t).map((t=>`${e}.${t}`))}function oy(e,t){return 1===t?[e]:sy(e,t)}class uy{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=im(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const e=oy("rc",this.rank),t=Jg(this.rank),n=this.getOutOfBoundsCondition(e),r=this.getSetup(e),i=this.getOutput(e);this.userCode=`\n        void main() {\n          ${t} rc = getOutputCoords();\n\n          if(${n}) {\n            setOutput(vec4(0));\n          } else {\n            ${r}\n\n            setOutput(vec4(${i}));\n          }\n        }\n      `}}getSourceCoordsArr(e){const t=[];for(let n=0;n<=1;n++)for(let r=0;r<=1;r++){let i=`${0===n?"r":"rp1"}, ${0===r?"c":"cp1"}`;for(let t=2;t<this.rank;t++)i=`${e[e.length-1-t]},`+i;t.push(i)}return t}getOutOfBoundsCondition(e){if(1===this.rank)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let n=this.rank-2;n<this.rank;n++)t+=`${e[n]} >= ${this.enableShapeUniforms?`outShape[${n}]`:this.outputShape[n]}`,n<this.rank-1&&(t+="||");return t}getSetup(e){if(1===this.rank)return"";const t=e.slice(-2),n=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`\n      int r = ${t[0]};\n      int c = ${t[1]};\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ${n};\n      bool rEdge = rp1 >= ${r};\n    `}getOutput(e){const t=this.getSourceCoordsArr(e);return 1===this.rank?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),\n            cEdge ? 0. : getA(${t[1]}),\n            rEdge ? 0. : getA(${t[2]}),\n            rEdge || cEdge ? 0. : getA(${t[3]})`}}class ly{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=im(this.outputShape.length);let n="";for(let e=0;e<4;e++){let t="thisRC = rc;";e%2==1&&(t+="thisRC.z += 1;"),e>1&&(t+="thisRC.y += 1;"),n+=`\n        ${t}\n        ${e>0?"if(thisRC.y < rows && thisRC.z < cols){":""}\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[${e}] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ${e>0?"}":""}\n      `}var r,i;this.userCode=`\n      ${r=t,i=this.enableShapeUniforms,`\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ${i?function(e,t,n="index"){const r=function(e,t){const n=e.length,r=e.map((e=>`${t}[${e}]`)),i=new Array(n-1);i[n-2]=r[n-1];for(let e=n-3;e>=0;--e)i[e]=`(${i[e+1]} * ${r[e+1]})`;return i}(e.map(((e,t)=>t)),t);return r.map(((t,i)=>`int ${e[i]} = ${n} / ${r[i]}; ${i===r.length-1?`int ${e[i+1]} = ${n} - ${e[i]} * ${r[i]}`:`index -= ${e[i]} * ${r[i]}`};`)).join("")}(["r","c","d"],"inputShape"):zg(["r","c","d"],r)}\n      return ivec3(r, c, d);\n    }\n  `}\n      ${this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Pg(e)}\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};\n        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};\n\n        ${n}\n\n        setOutput(result);\n      }\n    `}}class cy{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(e,t,n){const r=hy(t,n),i=fy(e,r,n);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const a=dy(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=a,this.log();const e=this.freeTextures[i].shift();return this.usedTextures[i].push(e),e}let s;return r===ug.PACKED_2X2_FLOAT32?s=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===ug.PACKED_2X2_FLOAT16?s=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===ug.UNPACKED_FLOAT32?s=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===ug.UNPACKED_FLOAT16?s=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===ug.PACKED_4X1_UNSIGNED_BYTE&&(s=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(s),this.numUsedTextures++,this._numBytesAllocated+=a,this.log(),s}releaseTexture(e,t,n,r){if(null==this.freeTextures)return;const i=hy(n,r),a=fy(t,i,r);a in this.freeTextures||(this.freeTextures[a]=[]);const s=dy(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),o=(0,D.env)().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==o&&this._numBytesAllocated>o?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=s):(this.freeTextures[a].push(e),this.numFreeTextures++,this._numBytesFree+=s),this.numUsedTextures--;const u=this.usedTextures[a],l=u.indexOf(e);if(l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(l,1),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const e in this.freeTextures)this.freeTextures[e].forEach((e=>{this.gpgpu.deleteMatrixTexture(e.texture)}));for(const e in this.usedTextures)this.usedTextures[e].forEach((e=>{this.gpgpu.deleteMatrixTexture(e.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function dy(e,t,n,r,i){const a=function(e,t){switch(e){case ug.PACKED_2X2_FLOAT32:return gm(t);case ug.PACKED_2X2_FLOAT16:return mm(t);case ug.UNPACKED_FLOAT32:return hm(t);case ug.UNPACKED_FLOAT16:return fm(t);case ug.PACKED_4X1_UNSIGNED_BYTE:return pm(t);default:throw new Error(`Unknown physical texture type ${e}`)}}(t,r);let s;if(i){const[t,n]=dg(e[0],e[1]);s=t*n}else{const[t,n]=lg(e[0],e[1]);s=t*n}const o=function(e,t){const n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error(`Unknown internal format ${t}`)}(n,a);return s*o}function hy(e,t){if(e===og.UPLOAD)return ug.PACKED_2X2_FLOAT32;if(e===og.RENDER||null==e)return function(e){return(0,D.env)().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?ug.PACKED_2X2_FLOAT32:ug.UNPACKED_FLOAT32:e?ug.PACKED_2X2_FLOAT16:ug.UNPACKED_FLOAT16}(t);if(e===og.DOWNLOAD||e===og.PIXELS)return ug.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${e}`)}function fy(e,t,n){return`${e[0]}_${e[1]}_${t}_${n}`}class py{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=im(this.outputShape.length),this.userCode=`\n      float unaryOperation(float x) {\n        ${t}\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}const gy="return abs(x);",my="return x;";class yy{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=im(this.outputShape.length),this.userCode=`\n      vec4 unaryOperation(vec4 x) {\n        ${t}\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}class vy{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=im(this.outputShape.length);const t=e.length,n=oy("rc",t),r=Jg(t),i=function(e,t){if(1===e)return"rc";let n="";for(let r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),a=n.slice(-2),s=t<=1?"rc":`vec2(${a.join(",")})`;this.userCode=`\n      void main() {\n        ${r} rc = getOutputCoords();\n        vec4 packedInput = getA(${i});\n\n        setOutput(getChannel(packedInput, ${s}));\n      }\n    `}}const by=D.kernel_impls.whereImpl,xy={},wy=(0,D.env)().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");class ky extends D.KernelBackend{constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!(0,D.env)().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(null!=e){if(e instanceof ym)t=e;else{const n=ag((0,D.env)().getNumber("WEBGL_VERSION"),e);t=new ym(n)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const e=ag((0,D.env)().getNumber("WEBGL_VERSION"));t=new ym(e),this.binaryCache=((n=(0,D.env)().getNumber("WEBGL_VERSION"))in xy||(xy[n]={}),xy[n]),this.gpgpuCreatedLocally=!0}var n;this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new cy(this.gpgpu),this.numMBBeforeWarning=null==(0,D.env)().global.screen?1024:(0,D.env)().global.screen.height*(0,D.env)().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new D.DataStorage(this,(0,D.engine)())}nextDataId(){return ky.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}write(e,t,n){if(((0,D.env)().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||(0,D.env)().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:og.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){this.texData.get(e).refCount++}decRef(e){this.texData.has(e)&&this.texData.get(e).refCount--}move(e,t,n,r,i){if((0,D.env)().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:og.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:n,dtype:r,complexTensorInfos:i,slice:a,shape:s,isPacked:o}=t;if(null!=a){let t;t=o?new yy(s,my):new py(s,my);const n=this.runWebGLProgram(t,[{dataId:e,shape:s,dtype:r}],r),i=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),i}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;const u=null!=this.activeTimers;let l,c;if(u&&(l=D.util.now()),"complex64"===r){const e=this.readSync(i.real.dataId),t=this.readSync(i.imag.dataId);c=D.backend_util.mergeRealAndImagArrays(e,t)}else c=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=D.util.now()-l),this.convertAndCacheOnCPU(e,c)}async read(e){if(this.pendingRead.has(e)){const t=this.pendingRead.get(e);return new Promise((e=>t.push(e)))}const t=this.texData.get(e),{values:n,shape:r,slice:i,dtype:a,complexTensorInfos:s,isPacked:o}=t;if(null!=i){let t;t=o?new yy(r,my):new py(r,my);const n=this.runWebGLProgram(t,[{dataId:e,shape:r,dtype:a}],a),i=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),i}if(null!=n)return this.convertAndCacheOnCPU(e);if((0,D.env)().getBool("DEBUG")&&!(0,D.env)().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===(0,D.env)().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u,l,c=null;if("complex64"!==a&&(0,D.env)().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(e);const t=this.texData.get(u.dataId);c=this.gpgpu.createBufferFromTexture(t.texture.texture,...cg(r))}if(this.pendingRead.set(e,[]),"complex64"!==a&&await this.gpgpu.createAndWaitForFence(),"complex64"===a){const e=await Promise.all([this.read(s.real.dataId),this.read(s.imag.dataId)]),t=e[0],n=e[1];l=D.backend_util.mergeRealAndImagArrays(t,n)}else if(null==c)l=this.getValuesFromTexture(e);else{const e=D.util.sizeFromShape(r);l=this.gpgpu.downloadFloat32MatrixFromBuffer(c,e)}if(null!=u&&this.disposeIntermediateTensorInfo(u),null!=c){const e=this.gpgpu.gl;fg(e,(()=>e.deleteBuffer(c)))}const d=this.convertAndCacheOnCPU(e,l),h=this.pendingRead.get(e);return this.pendingRead.delete(e),h.forEach((e=>e(d))),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&(0,D.engine)().removeDataId(e,this),this.pendingDeletes--),d}readToGPU(e,t={}){const n=this.texData.get(e),{values:r,shape:i,slice:a,dtype:s,isPacked:o,texture:u}=n;if("complex64"===s)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=a){let n;n=o?new yy(i,my):new py(i,my);const r=this.runWebGLProgram(n,[{dataId:e,shape:i,dtype:s}],s),a=this.readToGPU(r,t);return this.disposeIntermediateTensorInfo(r),a}if(null==u)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const l=this.decode(e,t.customTexShape),c=(0,D.engine)().makeTensorFromDataId(l.dataId,l.shape,l.dtype),d=this.texData.get(l.dataId);return Object.assign({tensorRef:c},d.texture)}bufferSync(e){const t=this.readSync(e.dataId);let n=t;if("string"===e.dtype)try{n=t.map((e=>D.util.decodeString(e)))}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return(0,D.buffer)(e.shape,e.dtype,n)}checkNumericalProblems(e){if(null!=e)for(let t=0;t<e.length;t++){const n=e[t];if(!pg(n)){if((0,D.env)().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`);throw Error(`The value ${n} cannot be represented on this device.`)}}}getValuesFromTexture(e){const{shape:t,dtype:n,isPacked:r}=this.texData.get(e),i=D.util.sizeFromShape(t);if((0,D.env)().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(e),r=this.texData.get(n.dataId),a=this.gpgpu.downloadMatrixFromPackedTexture(r.texture.texture,...cg(t)).subarray(0,i);return this.disposeIntermediateTensorInfo(n),a}const a=(0,D.env)().getBool("WEBGL_PACK")&&!0===r,s=a?Eg(t):t,o=a?new um(s):new om(s),u=this.runWebGLProgram(o,[{shape:s,dtype:n,dataId:e}],"float32"),l=this.texData.get(u.dataId),c=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(l.texture.texture,l.texShape[0],l.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(u),c}timerAvailable(){return(0,D.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,n=[];let r=!1;null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e();const i=D.util.flatten(this.activeTimers.map((e=>e.query))).filter((e=>null!=e)),a=D.util.flatten(this.activeTimers.map((e=>e.name))).filter((e=>null!=e));this.activeTimers=t,r&&(this.programTimersStack=null);const s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if((0,D.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const e=await Promise.all(i);s.kernelMs=D.util.sum(e),s.getExtraProfileInfo=()=>e.map(((e,t)=>({name:a[t],ms:e}))).map((e=>`${e.name}: ${e.ms}`)).join(", ")}else s.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,s})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return(0,D.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:D.util.now(),endMs:null}}endTimer(e){return(0,D.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=D.util.now(),e)}async getQueryTime(e){if((0,D.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:n}=this.texData.get(e);return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:n,texShape:r,usage:i,isPacked:a,slice:s}=this.texData.get(e),o=s&&s.origDataId||e,u=this.dataRefCount.get(o);u>1?this.dataRefCount.set(o,u-1):(this.dataRefCount.delete(o),null!=t&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(t,r,i,a)));const l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=wy){return(0,D.env)().getBool("WEBGL_CPU_FORWARD")&&e.every((e=>null==this.texData.get(e.dataId).texture&&D.util.sizeFromShape(e.shape)<t))}getGPGPUContext(){return this.gpgpu}where(e){D.backend_util.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return by(e.shape,t)}packedUnaryOp(e,t,n){const r=new yy(e.shape,t),i=this.compileAndRun(r,[e],n);return(0,D.engine)().makeTensorFromDataId(i.dataId,i.shape,i.dtype)}abs(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){const t=Gm(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if((0,D.env)().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,gy,e.dtype);const t=new py(e.shape,gy),n=this.compileAndRun(t,[e]);return(0,D.engine)().makeTensorFromDataId(n.dataId,n.shape,n.dtype)}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&D.util.isString(n[0])){const i=n.map((e=>D.util.encodeString(e)));r=this.write(i,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,n){const{dataId:r}=this.makeTensorInfo(e,t,n);return(0,D.engine)().makeTensorFromDataId(r,e,t,this)}unpackTensor(e){const t=new vy(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new uy(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const n=[Cg(e.shape),...Ag(e.shape)],r={dtype:e.dtype,shape:n,dataId:e.dataId},i=[Cg(t),...Ag(t)],a=new ly(i,n),s=[n],o=this.runWebGLProgram(a,[r],e.dtype,s,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}}decode(e,t){const n=this.texData.get(e),{isPacked:r,shape:i,dtype:a}=n;if(null!=t){const e=D.util.sizeFromShape(i),n=t[0]*t[1]*4;D.util.assert(e<=n,(()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."))}const s=Eg(i);let o;o=r?new sm(s):new am(s);const u=[null!=t?t:cg(s)];return{dtype:a,shape:i,dataId:this.runWebGLProgram(o,[{shape:s,dtype:a,dataId:e}],a,u,!0,t).dataId}}runWebGLProgram(e,t,n,r,i=!1,a){const s=this.makeTensorInfo(e.outputShape,n),o=this.texData.get(s.dataId);if(e.packedOutput&&(o.isPacked=!0),e.outPackingScheme===sg.DENSE){const t=null!=a?a:cg(e.outputShape);o.texShape=t.map((e=>2*e))}if(null!=e.outTexUsage&&(o.usage=e.outTexUsage),0===D.util.sizeFromShape(s.shape))return o.values=D.util.getTypedArrayFromDType(s.dtype,0),s;const u=[],l=t.map((t=>{if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&D.util.sizeFromShape(t.shape)<=(0,D.env)().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(this.uploadToGPU(t.dataId),!!n.isPacked!=!!e.packedInputs)t=n.isPacked?this.unpackTensor(t):this.packTensor(t),u.push(t),n=this.texData.get(t.dataId);else if(n.isPacked&&!Ig(n.shape,t.shape)){const e=t,r=t.shape;t.shape=n.shape,t=this.packedReshape(t,r),u.push(t),n=this.texData.get(t.dataId),e.shape=r}return{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(s.dataId);const c={shape:s.shape,texData:o,isUniform:!1},d=function(e,t,n){let r="";t.concat(n).forEach((t=>{const i=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){const a=t.texData.texShape,{useSqueezeShape:s,uniformShape:o,keptDims:u}=Zg(e.packedInputs,t.shape,a);let l="",c="",d="";if(1===o.length&&e.packedInputs){const e=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];l=`${e[0]>1}_${e[1]>1}`}else if(2!==o.length||e.packedInputs){if(o.length>2&&!e.packedInputs){const e=D.util.computeStrides(o);d=`${e[0]===a[1]}_${e[e.length-1]===a[1]}`}}else c=`${o[0]>1}_${o[1]>1}`;const h=t.shape.length,f=2===o.length&&D.util.arraysEqual(t.shape,a),p=1===D.util.sizeFromShape(t.shape),g=D.backend_util.getBroadcastDims(t.shape,n.shape),m=!e.packedInputs&&h===n.shape.length&&D.util.arraysEqual(a,n.texData.texShape),y=e.packedInputs||o.length>2?"":`${a[0]>1}_${a[1]>1}`;r+=`${h}_${m}_${s?u:""}_${o.length}_${p}_${g}_${f}_${l}_${c}_${d}_${y}_${i}`}else{const e=t.isUniform?"uniform":t.texData.texShape;r+=`${t.shape}_${e}_${i}`}}));const i=e.userCode;let a=e.constructor.name;return a+="_"+r+"_"+i+`${(0,D.env)().getNumber("WEBGL_VERSION")}`,a}(e,l,c),h=this.getAndSaveBinary(d,(()=>function(e,t,n,r){const i=n.map(((e,n)=>{const r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),a=i.map((e=>e.shapeInfo)),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},o=Wg(i,s,t),u=function(e,t){const n=Sg(e,(()=>e.createShader(e.FRAGMENT_SHADER)),"Unable to create fragment WebGLShader.");if(fg(e,(()=>e.shaderSource(n,t))),fg(e,(()=>e.compileShader(n))),(0,D.env)().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw yg(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(e.gl,o),l=e.createProgram(u);return(0,D.env)().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:o,webGLProgram:l,inShapeInfos:a,outShapeInfo:s,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:t,fragmentShader:u,source:o,webGLProgram:l,inShapeInfos:a,outShapeInfo:s},nm(e,t,l))}(this.gpgpu,e,l,c))),f=null!=this.activeTimers;let p;f&&(p=this.startTimer()),(0,D.env)().get("ENGINE_COMPILE_ONLY")||function(e,t,n,r,i){t.program.enableShapeUniforms||(rm(t.inShapeInfos,n),rm([t.outShapeInfo],[r]));const a=r.texData.texture,s=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(a.texture,s[0],s[1]):e.setOutputMatrixTexture(a.texture,s[0],s[1]),e.setProgram(t.webGLProgram),1===(0,D.env)().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach(((n,r)=>{const i=t.program.variableNames[r],a=t.uniformLocations[i],s=t.uniformLocations[`offset${i}`],o=t.inShapesLocations[`${i}Shape`],u=t.inTexShapesLocations[`${i}TexShape`];if(o){const{uniformShape:r}=Zg(t.program.packedInputs,n.shape,n.texData.texShape);switch(r.length){case 1:e.gl.uniform1iv(o,new Int32Array(r));break;case 2:e.gl.uniform2iv(o,new Int32Array(r));break;case 3:e.gl.uniform3iv(o,new Int32Array(r));break;case 4:e.gl.uniform4iv(o,new Int32Array(r))}}if(u&&e.gl.uniform2i(u,n.texData.texShape[0],n.texData.texShape[1]),null!=a)if(n.isUniform)if(D.util.sizeFromShape(n.shape)<2)e.gl.uniform1f(a,n.uniformValues[0]);else{let t=n.uniformValues;t instanceof Float32Array||(t=new Float32Array(t)),e.gl.uniform1fv(a,t)}else null!=n.texData.slice&&null!=s&&e.gl.uniform1i(s,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture.texture,a,r)}));const o=t.outShapeLocation;if(o)switch(r.shape.length){case 1:e.gl.uniform1iv(o,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(o,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(o,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(o,new Int32Array(r.shape))}if(t.outShapeStridesLocation){const n=D.util.computeStrides(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(n));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(n));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(n))}}t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&i&&t.program.customUniforms.forEach(((n,r)=>{const a=t.customUniformLocations[r],s=i[r];if("float"===n.type)e.gl.uniform1fv(a,s);else if("vec2"===n.type)e.gl.uniform2fv(a,s);else if("vec3"===n.type)e.gl.uniform3fv(a,s);else if("vec4"===n.type)e.gl.uniform4fv(a,s);else if("int"===n.type)e.gl.uniform1iv(a,s);else if("ivec2"===n.type)e.gl.uniform2iv(a,s);else if("ivec3"===n.type)e.gl.uniform3iv(a,s);else{if("ivec4"!==n.type)throw Error(`uniform type ${n.type} is not supported yet.`);e.gl.uniform4iv(a,s)}})),e.executeProgram()}(this.gpgpu,h,l,c,r),u.forEach((e=>this.disposeIntermediateTensorInfo(e))),f&&(p=this.endTimer(p),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(p)}));const g=(0,D.env)().get("WEBGL_FLUSH_THRESHOLD");if(g>0){const e=D.util.now();e-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=e)}if(!(0,D.env)().getBool("WEBGL_LAZILY_UNPACK")&&o.isPacked&&!1===i){const e=this.unpackTensor(s);return this.disposeIntermediateTensorInfo(s),e}return s}compileAndRun(e,t,n,r,i=!1){return n=n||t[0].dtype,this.runWebGLProgram(e,t,n,r,i)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||((0,D.env)().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=(0,D.tidy)((()=>{if(!(0,D.env)().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=(0,D.env)().getBool("DEBUG");(0,D.env)().set("DEBUG",!1);const t=this.abs((0,D.scalar)(1e-8)).dataSync()[0];if((0,D.env)().set("DEBUG",e),t>0)return 32}return 16}))),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(e){const t=this.texData.get(e),{shape:n,dtype:r,values:i,texture:a,usage:s,isPacked:o}=t;if(null!=a)return;const u=null!=this.activeTimers;let l;u&&(l=D.util.now());let c=t.texShape;if(null==c&&(c=function(e,t=!1){let n=(0,D.env)().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,1===(e=e.map(((t,n)=>n>=e.length-2?D.util.nearestLargerEven(e[n]):e[n]))).length&&(e=[2,e[0]])),2!==e.length){const t=D.util.squeezeShape(e);e=t.newShape}let r=D.util.sizeFromShape(e);if(e.length<=1&&r<=n)return[1,r];if(2===e.length&&e[0]<=n&&e[1]<=n)return e;if(3===e.length&&e[0]*e[1]<=n&&e[2]<=n)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=n&&e[1]*e[2]<=n)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n)return[e[0],e[1]*e[2]*e[3]];if(t){const t=Cg(e);let n=2,i=2;return e.length&&([n,i]=Ag(e)),r=t*(n/2)*(i/2),D.util.sizeToSquarishShape(r).map((e=>2*e))}return D.util.sizeToSquarishShape(r)}(n,o),t.texShape=c),null!=i){const e=Eg(n);let a,s=c[1],d=c[0];const h=i instanceof Uint8Array||i instanceof Uint8ClampedArray;!o&&h||([s,d]=dg(c[0],c[1])),a=o?new cm(e,h):new lm(e,h);const f=h?[d,s]:c,p=this.makeTensorInfo(f,r),g=this.texData.get(p.dataId);g.usage=h?og.PIXELS:og.UPLOAD,g.texShape=f,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(p.dataId),s,d,i);const m=[[d,s]],y=!0,v=this.runWebGLProgram(a,[p],r,m,y),b=this.texData.get(v.dataId);t.texShape=b.texShape,t.isPacked=b.isPacked,t.usage=b.usage,(0,D.env)().get("ENGINE_COMPILE_ONLY")?this.disposeData(v.dataId):(t.texture=b.texture,t.values=null,this.texData.delete(v.dataId)),this.disposeIntermediateTensorInfo(p),u&&(this.uploadWaitMs+=D.util.now()-l)}else{const e=this.acquireTexture(c,s,r,o);t.texture=e}}convertAndCacheOnCPU(e,t){const n=this.texData.get(e),{dtype:r}=n;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){const n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length);for(let t=0;t<n.length;++t)n[t]=Math.round(e[t]);return n}throw new Error(`Unknown dtype ${t}`)}(t,r)),n.values}acquireTexture(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const e=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${e} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*D.util.bytesPerElement(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}for(const[,t]of Object.entries(this.binaryCache)){const n=new Promise((e=>{try{this.checkCompletion_(t),e(!0)}catch(e){throw e}}));e.push(n)}return Promise.all(e)}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await(0,D.nextFrame)(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw yg(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}getUniformLocations(){for(const[,e]of Object.entries(this.binaryCache)){const{uniformLocations:t,customUniformLocations:n,infLoc:r,nanLoc:i,inShapesLocations:a,inTexShapesLocations:s,outShapeLocation:o,outShapeStridesLocation:u,outTexShapeLocation:l}=nm(this.gpgpu,e.program,e.webGLProgram);e.uniformLocations=t,e.customUniformLocations=n,e.infLoc=r,e.nanLoc=i,e.inShapesLocations=a,e.inTexShapesLocations=s,e.outShapeLocation=o,e.outShapeStridesLocation=u,e.outTexShapeLocation=l}}}ky.nextDataId=0,D.device_util.isBrowser()&&(0,D.registerBackend)("webgl",(()=>new ky),2);class _y{constructor(e,t,n){this.variableNames=["A","B"],this.outputShape=D.backend_util.assertAndGetBroadcastShape(t,n),this.enableShapeUniforms=im(this.outputShape.length),this.userCode=`\n      float binaryOperation(float a, float b) {\n        ${e}\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    `}}class Sy{constructor(e,t,n,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=D.backend_util.assertAndGetBroadcastShape(t,n);const i=this.outputShape.length;this.enableShapeUniforms=im(i);let a="";if(r)if(0===i||1===D.util.sizeFromShape(this.outputShape))a="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(a=`\n          ${Jg(i)} coords = getOutputCoords();\n        `,1===i)this.enableShapeUniforms?a+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":a+=`\n            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          `;else{const e=oy("coords",i);this.enableShapeUniforms?a+=`\n            bool nextRowOutOfBounds =\n              (${e[i-2]} + 1) >= outShape[${i} - 2];\n            bool nextColOutOfBounds =\n              (${e[i-1]} + 1) >= outShape[${i} - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `:a+=`\n            bool nextRowOutOfBounds =\n              (${e[i-2]} + 1) >= ${this.outputShape[i-2]};\n            bool nextColOutOfBounds =\n              (${e[i-1]} + 1) >= ${this.outputShape[i-1]};\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `}this.userCode=`\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ${e}\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ${a}\n\n        setOutput(result);\n      }\n    `}}function Cy(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const Ay={kernelName:D.Identity,backendName:"webgl",kernelFunc:Cy};function Ey(e){const{inputs:t,backend:n}=e,{real:r,imag:i}=t,a=n.makeTensorInfo(r.shape,"complex64"),s=n.texData.get(a.dataId),o=Cy({inputs:{x:r},backend:n}),u=Cy({inputs:{x:i},backend:n});return s.complexTensorInfos={real:o,imag:u},a}const Fy={kernelName:D.Complex,backendName:"webgl",kernelFunc:Ey},Iy="return (a < 0.) ? b * a : a;",Dy="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Ny={kernelName:D.LeakyRelu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{alpha:a}=r,s=n.makeTensorInfo([],"float32",D.util.createScalarValue(a,"float32")),o=(0,D.env)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Sy(Dy,i.shape,s.shape):new _y(Iy,i.shape,s.shape),u=n.runWebGLProgram(o,[i,s],"float32");return n.disposeIntermediateTensorInfo(s),u}},$y="return (a < 0.) ? b * a : a;",Ty="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Oy={kernelName:D.Prelu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r,alpha:i}=t,a=(0,D.env)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Sy(Ty,r.shape,i.shape):new _y($y,r.shape,i.shape);return n.runWebGLProgram(a,[r,i],"float32")}};function My({opSnippet:e,packedOpSnippet:t,cpuKernelImpl:n,dtype:r}){return({inputs:i,backend:a})=>{const{x:s}=i,o=a,u=r||s.dtype;if(o.shouldExecuteOnCPU([s])&&null!=n){const e=o.texData.get(s.dataId),t=n(e.values,u);return o.makeTensorInfo(s.shape,u,t)}let l;return l=(0,D.env)().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=t?new yy(s.shape,t):new py(s.shape,e),o.runWebGLProgram(l,[s],u)}}function Ry({opSnippet:e,packedOpSnippet:t,checkOutOfBounds:n=!1,supportsComplex:r=!1,cpuKernelImpl:i,dtype:a}){return({inputs:s,backend:o})=>{const{a:u,b:l}=s,c=o;if(r&&"complex64"===u.dtype){const t=c.texData.get(u.dataId),n=c.texData.get(l.dataId),[r,i]=[[t.complexTensorInfos.real,n.complexTensorInfos.real],[t.complexTensorInfos.imag,n.complexTensorInfos.imag]].map((t=>{const[n,r]=t,i={dataId:n.dataId,dtype:n.dtype,shape:u.shape},a={dataId:r.dataId,dtype:r.dtype,shape:l.shape},s=new _y(e,u.shape,l.shape);return c.runWebGLProgram(s,[i,a],(0,D.upcastType)(n.dtype,r.dtype))})),a=Ey({inputs:{real:r,imag:i},backend:c});return c.disposeIntermediateTensorInfo(r),c.disposeIntermediateTensorInfo(i),a}const d=a||(0,D.upcastType)(u.dtype,l.dtype);if(("string"===u.dtype||"string"===l.dtype||c.shouldExecuteOnCPU([u,l]))&&null!=i){const e=c.texData.get(u.dataId).values,t=c.texData.get(l.dataId).values,n="string"===u.dtype?D.backend_util.fromUint8ToStringArray(e):e,r="string"===u.dtype?D.backend_util.fromUint8ToStringArray(t):t,[a,s]=i(u.shape,l.shape,n,r,d),o=c.makeTensorInfo(s,d);return c.texData.get(o.dataId).values=a,o}let h;return h=(0,D.env)().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=t?new Sy(t,u.shape,l.shape,n):new _y(e,u.shape,l.shape),c.runWebGLProgram(h,[u,l],d)}}function By(e,t=!1){if("linear"===e)return"return x;";if("relu"===e)return t?"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n";if("elu"===e)return t?"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n":"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===e)return t?"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n";if("prelu"===e)return t?Ty:$y;if("leakyrelu"===e)return t?Dy:Iy;if("sigmoid"===e)return"return 1.0 / (1.0 + exp(-1.0 * x));";throw new Error(`Activation ${e} has not been implemented for the WebGL backend.`)}class zy{constructor(e,t,n,r=!1,i=!1,a=!1,s=null,o=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=im(this.outputShape.length);const l=r?e[1]:e[2],c=Math.ceil(l/2),d=r?"i * 2, rc.y":"rc.y, i * 2",h=i?"rc.z, i * 2":"i * 2, rc.z",f=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],p=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let g="",m="";s&&(g=o?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${s}\n        }`:u?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${s}\n        }`:`vec4 activation(vec4 x) {\n          ${s}\n        }`,m="result = activation(result);");const y=a?"result += getBiasAtOutCoords();":"";a&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let v="rc.x",b="rc.x";e[0]<t[0]?v=`int(min(float(rc.x), ${e[0]-1}.))`:t[0]<e[0]&&(b=`int(min(float(rc.x), ${t[0]-1}.))`),this.userCode=`\n      ${g}\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ${c}.0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ${c}; i++) {\n          int batchA = ${v};\n          int batchB = ${b};\n          vec4 a = getMatrixA(batchA, ${d});\n          vec4 b = getMatrixB(batchB, ${h});\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (${f[0]} * ${p[0]});\n          result += (${f[1]} * ${p[1]});\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ${y}\n\n        ${m}\n\n        setOutput(result);\n      }\n    `}}class Ly{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=D.backend_util.assertAndGetBroadcastShape(t,n),this.userCode=`\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ${e}\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    `}}const Py="return a * b;";function jy(e){const{inputs:t,backend:n}=e,{a:r,b:i}=t,a=D.backend_util.upcastType(r.dtype,i.dtype);if("complex64"===r.dtype){const e=n.texData.get(r.dataId),t=n.texData.get(i.dataId),a=new Ly("return areal * breal - aimag * bimag;",r.shape,i.shape),s=new Ly("return areal * bimag + aimag * breal;",r.shape,i.shape),o=[{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:r.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:i.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:i.shape}],u=n.runWebGLProgram(a,o,"float32"),l=n.runWebGLProgram(s,o,"float32"),c=Ey({inputs:{real:u,imag:l},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(l),c}if(n.shouldExecuteOnCPU([r,i])){const e=n.texData.get(r.dataId),t=n.texData.get(i.dataId),[s,o]=zm(r.shape,i.shape,e.values,t.values,a),u=n.makeTensorInfo(o,a);return n.texData.get(u.dataId).values=s,u}let s;return s=(0,D.env)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Sy(Py,r.shape,i.shape):new _y(Py,r.shape,i.shape),n.runWebGLProgram(s,[r,i],a)}const Uy={kernelName:D.Multiply,backendName:"webgl",kernelFunc:jy};function Wy(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{shape:a}=r,s=n,o=D.util.sizeFromShape(i.shape),u=D.util.inferFromImplicitShape(a,o),l=D.util.sizeFromShape(u);D.util.assert(o===l,(()=>`The new shape (${u}) has ${l} elements and the old shape (${i.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`));const c=s.texData.get(i.dataId);return!c.isPacked||Ig(i.shape,u)||null!==c.texture&&Ig(c.shape,u)?(s.incRef(i.dataId),{dataId:i.dataId,shape:u,dtype:i.dtype}):function(e,t,n){const r=[Cg(e.shape),...Ag(e.shape)],i={dtype:e.dtype,shape:r,dataId:e.dataId},a=[Cg(t),...Ag(t)],s=new ly(a,r),o=[r],u=n.runWebGLProgram(s,[i],e.dtype,o,!0);return{dataId:u.dataId,shape:t,dtype:u.dtype}}(i,u,s)}const Vy={kernelName:D.Reshape,backendName:"webgl",kernelFunc:Wy};class Gy{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:i,outSize:a}=e;this.outputShape=[r,a];const s=4*Math.floor(n/4),o=n%4;let u="sumValue += dot(values, ones);";if(null!=t){const e=1/t;u=`sumValue += dot(values * ${D.util.isInt(e)?e.toPrecision(2):e}, ones);`}let l="";i%n>0&&(l=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return 0.0;\n        }\n      `),this.userCode=`\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${l}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${s}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${u}\n        }\n\n        int inIdx = inOffset + ${s};\n        if (${1===o}) {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ${u}\n        } else if (${2===o}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ${u}\n        } else if (${3===o}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ${u}\n        }\n        setOutput(sumValue);\n      }\n    `}}class qy{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:i,outSize:a}=e;this.outputShape=[r,a];let s="0.0",o="";"prod"===t?s="1.0":"min"===t?(s="1.0 / 1e-20",o="min"):"max"===t&&(s="-1.0 / 1e-20",o="max");let u=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");const l=4*Math.floor(n/4),c=n%4;let d=`\n      if (${"sum"===t}) {\n        sumValue += dot(values, ones);\n      } else if (${"prod"===t}) {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ${o}(values, minMaxValue);\n        if (${"min"===t} || ${"max"===t}) {\n          minMaxValue = ${o}(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    `,h="vec4";"all"===t?(s="1.0",d="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",h="bvec4"):"any"===t&&(s="0.0",d="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",h="bvec4");let f="";i%n>0&&(f=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return initializationValue;\n        }\n      `),this.userCode=`\n      const float initializationValue = ${s};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${f}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        vec4 minMaxValue = vec4(${s});\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ${l}; i += 4) {\n          int inIdx = inOffset + i;\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${d}\n        }\n\n        int inIdx = inOffset + ${l};\n        if (${1===c}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ${d}\n        } else if (${2===c}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ${d}\n        } else if (${3===c}) {\n          ${h} values = ${h}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ${d}\n        }\n        setOutput(${u});\n      }\n    `}}function Hy(e,t,n,r){const i=function(e){const t=[];for(;0===t.length||1!==t[t.length-1].outSize;){const n=t.length?t[t.length-1].outSize:e[1],r=D.backend_util.computeOptimalWindowSize(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape);let a=e;for(let s=0;s<i.length;s++){const{inSize:o,windowSize:u,outSize:l}=i[s];let c,d;c="mean"===n?0===s?new Gy({windowSize:u,inSize:o,batchSize:e.shape[0],outSize:l},o):new Gy({windowSize:u,inSize:o,batchSize:e.shape[0],outSize:l}):new qy({windowSize:u,inSize:o,batchSize:e.shape[0],outSize:l},n),d=a,a=r.runWebGLProgram(c,[a],t),d.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(d)}return a}class Xy{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;const r=Jg(this.rank),i=function(e){const t=e.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t);for(let t=0;t<e.length;t++)r[e[t]]=n[t];return r.join()}(t);this.userCode=`\n    void main() {\n      ${r} resRC = getOutputCoords();\n      setOutput(getA(${i}));\n    }\n    `}}class Ky{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=Jg(this.rank),i=sy("rc",this.rank),a=new Array(this.rank);for(let e=0;e<t.length;e++)a[t[e]]=i[e];const s=`vec2(${a.slice(-2).join()})`,o=`++${i[this.rank-1]} < ${n[this.rank-1]}`,u=`getChannel(getA(${a.join()}), ${s})`;this.userCode=`\n    void main() {\n      ${r} rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ${u};\n      if(${o}) {\n        result[1] = ${u};\n      }\n      --${i[this.rank-1]};\n      if(++${i[this.rank-2]} < ${n[this.rank-2]}) {\n        result[2] = ${u};\n        if(${o}) {\n          result[3] = ${u};\n        }\n      }\n      setOutput(result);\n    }\n    `}}function Yy(e,t,n){const r=(0,D.env)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ky(e.shape,t):new Xy(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function Qy(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:s}=r;return function(e,t,n,r){const i=t,a=e.shape.length,s=D.util.parseAxisParam(i,e.shape);let o=s;const u=D.backend_util.getAxesPermutation(o,a),l=null!=u;let c=e;l&&(c=Yy(e,u,r),o=D.backend_util.getInnerMostAxes(o.length,a)),D.backend_util.assertAxesAreInnerMostDims("sum",o,a);const[d,h]=D.backend_util.computeOutAndReduceShapes(c.shape,o);let f=d;n&&(f=D.backend_util.expandShapeToKeepDim(d,s));const p=D.util.sizeFromShape(h),g=Wy({inputs:{x:c},attrs:{shape:[D.util.sizeFromShape(e.shape)/p,p]},backend:r}),m=Hy(g,(0,D.sumOutType)(e.dtype),"sum",r),y=Wy({inputs:{x:m},attrs:{shape:f},backend:r});return r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(m),l&&r.disposeIntermediateTensorInfo(c),y}(i,a,s,n)}const Jy={kernelName:D.Sum,backendName:"webgl",kernelFunc:Qy};function Zy(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{perm:a}=r,s=n,o=i.shape.length,u=new Array(o);for(let e=0;e<u.length;e++)u[e]=i.shape[a[e]];let l;if(s.shouldExecuteOnCPU([i])){const e=s.texData.get(i.dataId).values,t=iy(e,i.shape,i.dtype,a,u);l=s.makeTensorInfo(u,i.dtype),s.texData.get(l.dataId).values=t}else l=Yy(i,a,s);return l}const ev={kernelName:D.Transpose,backendName:"webgl",kernelFunc:Zy};function tv({a:e,b:t,transposeA:n,transposeB:r,backend:i,bias:a=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:u=null}){const l=e.shape.length,c=t.shape.length,d=n?e.shape[l-2]:e.shape[l-1],h=r?t.shape[c-1]:t.shape[c-2],f=n?e.shape[l-1]:e.shape[l-2],p=r?t.shape[c-2]:t.shape[c-1],g=e.shape.slice(0,-2),m=t.shape.slice(0,-2),y=D.util.sizeFromShape(g),v=D.util.sizeFromShape(m),b=D.broadcast_util.assertAndGetBroadcastShape(e.shape.slice(0,-2),t.shape.slice(0,-2)).concat([f,p]);D.util.assert(d===h,(()=>`Error in matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${e.shape} and ${t.shape} and transposeA=${n} and transposeB=${r} must match.`));const x=n?[y,d,f]:[y,f,d],w=r?[v,p,h]:[v,h,p],k=Wy({inputs:{x:e},backend:i,attrs:{shape:x}}),_=Wy({inputs:{x:t},backend:i,attrs:{shape:w}}),S=[k,_],C=Math.max(y,v),A=n?k.shape[1]:k.shape[2],E=null!=a,F=null!=s,I="leakyrelu"===u,N=null!=u?By(u,!0):null;let $;if((1===f||1===p)&&A>1e3&&!1===(E||F||I||null!=N)){let e=k,t=_;n&&(e=Zy({inputs:{x:k},backend:i,attrs:{perm:[0,2,1]}}),S.push(e)),r&&(t=Zy({inputs:{x:_},backend:i,attrs:{perm:[0,2,1]}}),S.push(t));const a=1===p;let s=e;1!==p&&(s=Wy({inputs:{x:e},backend:i,attrs:{shape:[C,A,1]}}),S.push(s));const o=1===p?2:1;let u=t;a&&(u=Wy({inputs:{x:t},backend:i,attrs:{shape:[C,1,A]}}),S.push(u));const l=jy({inputs:{a:s,b:u},backend:i});$=Qy({inputs:{x:l},backend:i,attrs:{axis:o,keepDims:!0}}),S.push(l)}else{const u=(0,D.upcastType)(e.dtype,t.dtype),l=new zy(x,w,[C,f,p],n,r,E,N,F,I),c=[k,_];if(null!=a&&c.push(a),F&&c.push(s),I){const e=i.makeTensorInfo([],"float32",D.util.createScalarValue(o,"float32"));c.push(e),S.push(e)}$=i.runWebGLProgram(l,c,u)}const T=Wy({inputs:{x:$},backend:i,attrs:{shape:b}});S.push($);for(const e of S)i.disposeIntermediateTensorInfo(e);return T}const nv={kernelName:D._FusedMatMul,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:a,bias:s,preluActivationWeights:o}=t,{transposeA:u,transposeB:l,activation:c,leakyreluAlpha:d}=r;return tv({a:i,b:a,transposeA:u,transposeB:l,backend:n,bias:s,preluActivationWeights:o,leakyreluAlpha:d,activation:c})}},rv="return abs(x);",iv={kernelName:D.Abs,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])&&"complex64"!==r.dtype){const e=n.texData.get(r.dataId),t=Gm(e.values);return n.makeTensorInfo(r.shape,r.dtype,t)}let i;return i=(0,D.env)().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new yy(r.shape,rv):new py(r.shape,rv),n.runWebGLProgram(i,[r],r.dtype)}},av=My({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),sv={kernelName:D.Acos,backendName:"webgl",kernelFunc:av},ov=My({opSnippet:"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),uv={kernelName:D.Acosh,backendName:"webgl",kernelFunc:ov},lv="return a + b;",cv=Ry({opSnippet:lv,packedOpSnippet:lv,supportsComplex:!0,cpuKernelImpl:vm}),dv={kernelName:D.Add,backendName:"webgl",kernelFunc:cv};class hv{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(((e,t)=>`T${t}`));const n=[];this.variableNames.forEach((e=>{n.push(`float v${e} = get${e}AtOutCoords();`)}));const r=this.variableNames.map((e=>`v${e}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        float result = ${r};\n        setOutput(result);\n      }\n    `}}class fv{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(((e,t)=>`T${t}`));const n=[];this.variableNames.forEach((e=>{n.push(`vec4 v${e} = get${e}AtOutCoords();`)}));const r=this.variableNames.map((e=>`v${e}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        vec4 result = ${r};\n        setOutput(result);\n      }\n    `}}const pv={kernelName:D.AddN,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:r}=t,i=n;if(1===i.length)return Cy({inputs:{x:i[0]},backend:r});if(i.length>(0,D.env)().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const t=Math.floor(i.length/2),n=e({inputs:i.slice(0,t),backend:r}),a=e({inputs:i.slice(t),backend:r});return e({inputs:[n,a],backend:r})}const a=i.map((e=>e.dtype)).reduce(((e,t)=>(0,D.upcastType)(e,t))),s=i.map((e=>e.shape)),o=(0,D.env)().getBool("WEBGL_PACK")?new fv(i[0].shape,s):new hv(i[0].shape,s);return r.runWebGLProgram(o,i,a)}},gv={kernelName:D.All,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:s}=r,o=i.shape.length,u=D.util.parseAxisParam(a,i.shape);let l=u;const c=D.backend_util.getAxesPermutation(l,o);let d=i;null!=c&&(d=Zy({inputs:{x:i},backend:n,attrs:{perm:c}}),l=D.backend_util.getInnerMostAxes(l.length,o)),D.backend_util.assertAxesAreInnerMostDims("all",l,o);const[h,f]=D.backend_util.computeOutAndReduceShapes(d.shape,l),p=Wy({inputs:{x:d},backend:n,attrs:{shape:[-1,D.util.sizeFromShape(f)]}}),g=Hy(p,p.dtype,"all",n);let m;return m=Wy(s?{inputs:{x:g},backend:n,attrs:{shape:D.backend_util.expandShapeToKeepDim(h,u)}}:{inputs:{x:g},backend:n,attrs:{shape:h}}),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),null!=c&&n.disposeIntermediateTensorInfo(d),m}},mv={kernelName:D.Any,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:s}=r,o=i.shape.length,u=D.util.parseAxisParam(a,i.shape);let l=u;const c=D.backend_util.getAxesPermutation(l,o);let d=i;null!=c&&(d=Zy({inputs:{x:i},backend:n,attrs:{perm:c}}),l=D.backend_util.getInnerMostAxes(l.length,o)),D.backend_util.assertAxesAreInnerMostDims("any",l,o);const[h,f]=D.backend_util.computeOutAndReduceShapes(d.shape,l),p=Wy({inputs:{x:d},backend:n,attrs:{shape:[-1,D.util.sizeFromShape(f)]}}),g=Hy(p,p.dtype,"any",n);let m;return m=Wy(s?{inputs:{x:g},backend:n,attrs:{shape:D.backend_util.expandShapeToKeepDim(h,u)}}:{inputs:{x:g},backend:n,attrs:{shape:h}}),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),null!=c&&n.disposeIntermediateTensorInfo(d),m}};class yv{constructor(e,t,n){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:a}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,a];const s="max"===t?">":"<",o=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${r};\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ${r}; i++) {\n          int inIdx = ${o};\n          float candidate = getA(batch, inIdx);\n          if (candidate ${s} bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    `}}class vv{constructor(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,D.util.assert(e.length>2,(()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`));const i=e[e.length-1],a=Math.ceil(i/t);this.outputShape=e.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");const s=this.outputShape,o=s.length,u=Jg(o),l=oy("coords",o);let c,d;if(1===a){d=o+1;const e=Jg(d);c=`\n        ${e} sourceLocR = ${e}(${l.join()}, 0);\n        ++${l[o-1]};\n        ${e} sourceLocG = ${e}(${l.join()}, 0);\n        ++${l[o-2]};\n        ${e} sourceLocA = ${e}(${l.join()}, 0);\n        --${l[o-1]};\n        ${e} sourceLocB = ${e}(${l.join()}, 0);\n        --${l[o-2]};`}else d=o,c=`\n        ${u} sourceLocR = coords;\n        ++${l[o-1]};\n        ${u} sourceLocG = coords;\n        ++${l[o-2]};\n        ${u} sourceLocA = coords;\n        --${l[o-1]};\n        ${u} sourceLocB = coords;\n        --${l[o-2]};`;const h=["x","y","z","w","u","v"].slice(0,d),f="."+h[d-1],p=h.map((e=>"int "+e)),g=oy("sourceLocR",d-1).concat("inIdx.r"),m=oy("sourceLocG",d-1).concat("inIdx.g"),y=oy("sourceLocB",d-1).concat("inIdx.b"),v=oy("sourceLocA",d-1).concat("inIdx.a"),b="max"===n?"greaterThan":"lessThan",x=r?"":`\n          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),\n                             getBestIndicesAChannel(${m.join()}),\n                             getBestIndicesAChannel(${y.join()}),\n                             getBestIndicesAChannel(${v.join()})));`,w=`vec4(\n            getAChannel(${g.join()}),\n            hasNextCol ? getAChannel(${m.join()}) : 0.,\n            hasNextRow ? getAChannel(${y.join()}) : 0.,\n            hasNextRow && hasNextCol ? getAChannel(${v.join()}) : 0.)`,k=r?"":`\n      float getBestIndicesAChannel(${p.join()}) {\n        return getChannel(getBestIndicesA(${h.join()}),\n                                          vec2(${h.slice(-2).join()}));\n      }`;this.userCode=`\n      float getAChannel(${p.join()}) {\n        return getChannel(getA(${h.join()}),\n                               vec2(${h.slice(-2).join()}));\n      }\n      ${k}\n      void main() {\n        ${u} coords = getOutputCoords();\n        bool hasNextCol = ${l[o-1]} < ${s[o-1]-1};\n        bool hasNextRow = ${l[o-2]} < ${s[o-2]-1};\n        ${c}\n        ivec4 srcIdx = ivec4(sourceLocR${f}, sourceLocG${f},\n          sourceLocB${f}, sourceLocA${f}) * ${t};\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ${w};\n\n        for (int i = 0; i < ${t}; i++) {\n          inIdx = srcIdx;\n          ${x}\n          vec4 candidate = ${w};\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(${b}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    `}}function bv(e,t,n,r=null){let i=t.shape[0],a=t.shape[1];null!=r&&(i=r.shape[0],a=r.shape[1]);const s=D.backend_util.computeOptimalWindowSize(a),o={windowSize:s,inSize:a,batchSize:i,outSize:Math.ceil(a/s)},u=new yv(o,n,null==r),l=[t];null!=r&&l.push(r);const c=e.runWebGLProgram(u,l,"int32");if(1===c.shape[1])return c;const d=bv(e,t,n,c);return e.disposeIntermediateTensorInfo(c),d}function xv(e,t,n,r=null){const i=null!=r?r.shape:t.shape,a=i[i.length-1],s=D.backend_util.computeOptimalWindowSize(a),o=new vv(i,s,n,null==r),u=null==r?[t]:[t,r],l=e.runWebGLProgram(o,u,"int32");if(l.shape.length===t.shape.length){const r=xv(e,t,n,l);return e.disposeIntermediateTensorInfo(l),r}return l}function wv(e,t,n,r){const i=[n];if(D.backend_util.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),i,t.shape.length),!(0,D.env)().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const n=[],a=e.texData.get(t.dataId);let s=t;null!==a&&a.isPacked&&(s=e.unpackTensor(t),n.push(s));const[o,u]=D.backend_util.computeOutAndReduceShapes(s.shape,i),l=D.util.sizeFromShape(u),c=Wy({inputs:{x:s},backend:e,attrs:{shape:[-1,l]}});n.push(c);const d=bv(e,c,r);n.push(d);const h=Wy({inputs:{x:d},backend:e,attrs:{shape:o}});return n.forEach((t=>e.disposeIntermediateTensorInfo(t))),h}return xv(e,t,r)}const kv={kernelName:D.ArgMax,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a}=r;let s=D.util.parseAxisParam(a,i.shape);const o=D.backend_util.getAxesPermutation(s,i.shape.length);let u=i;const l=[];null!=o&&(u=Zy({inputs:{x:i},backend:n,attrs:{perm:o}}),l.push(u),s=D.backend_util.getInnerMostAxes(s.length,u.shape.length)),D.backend_util.assertAxesAreInnerMostDims("argMax",[s[0]],u.shape.length);const c=wv(n,u,s[0],"max");return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),c}},_v={kernelName:D.ArgMin,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a}=r;let s=D.util.parseAxisParam(a,i.shape);const o=D.backend_util.getAxesPermutation(s,i.shape.length);let u=i;const l=[];null!=o&&(u=Zy({inputs:{x:i},backend:n,attrs:{perm:o}}),l.push(u),s=D.backend_util.getInnerMostAxes(s.length,u.shape.length)),D.backend_util.assertAxesAreInnerMostDims("argMin",[s[0]],u.shape.length);const c=wv(n,u,s[0],"min");return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),c}},Sv=My({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),Cv={kernelName:D.Asin,backendName:"webgl",kernelFunc:Sv},Av=My({opSnippet:"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));"}),Ev={kernelName:D.Asinh,backendName:"webgl",kernelFunc:Av},Fv=My({opSnippet:"if (isnan(x)) return x;\n  return atan(x);\n"}),Iv={kernelName:D.Atan,backendName:"webgl",kernelFunc:Fv},Dv=Ry({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),Nv={kernelName:D.Atan2,backendName:"webgl",kernelFunc:Dv},$v=My({opSnippet:"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),Tv={kernelName:D.Atanh,backendName:"webgl",kernelFunc:$v};class Ov{constructor(e,t,n,r=!1,i=!1){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const a=e.filterWidth,s=e.strideHeight,o=e.strideWidth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;const p="avg"===t,g=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,m=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let y="0.0";if(p||(y="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode=`\n        const ivec2 strides = ivec2(${s}, ${o});\n        const ivec2 pads = ivec2(${h}, ${f});\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ${c};\n              wR += ${u}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${d};\n                wC += ${l}) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ${t} currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ${r?i?g:m:`wR * ${d} + wC`};\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let v=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===t&&(v="avgValue / count");const b=4*Math.floor(a/4),x=a%4,w=`\n      if (${p}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec2 strides = ivec2(${s}, ${o});\n      const ivec2 pads = ivec2(${h}, ${f});\n      const float initializationValue = ${y};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ${e.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${y});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ${c};\n            wR += ${u}) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ${e.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${b}; wC += 4) {\n            int xC = xCCorner + wC * ${l};\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${l}, d),\n              getValue(batch, xR, xC + 2 * ${l}, d),\n              getValue(batch, xR, xC + 3 * ${l}, d)\n            );\n\n            ${w}\n          }\n\n          int xC = xCCorner + ${b};\n          if (${1===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ${w}\n          } else if (${2===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${l}, d),\n              initializationValue,\n              initializationValue\n            );\n\n            ${w}\n          } else if (${3===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${l}, d),\n              getValue(batch, xR, xC + 2 * ${l}, d),\n              initializationValue\n            );\n\n            ${w}\n          }\n        }\n        setOutput(${v});\n      }\n    `}}class Mv{constructor(e,t,n,r=!1,i=!1){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const a=e.filterWidth,s=e.strideDepth,o=e.strideHeight,u=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,d=e.dilationWidth,h=e.effectiveFilterDepth,f=e.effectiveFilterHeight,p=e.effectiveFilterWidth,g=e.padInfo.front,m=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;const v="avg"===t;let b="0.0";if(v||(b="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode=`\n        const ivec3 strides =\n            ivec3(${s}, ${o}, ${u});\n        const ivec3 pads = ivec3(${g}, ${m}, ${y});\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ${h};\n              wD += ${l}) {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ${e.inDepth}) {\n              continue;\n            }\n\n            for (int wR = 0; wR < ${f};\n                wR += ${c}) {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ${e.inHeight}) {\n                continue;\n              }\n\n              for (int wC = 0; wC < ${p};\n                  wC += ${d}) {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ${e.inWidth}) {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ${t} currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ${r?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${f} * ${p} +\n                      wR * ${p} + wC`};\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}let x=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===t&&(x="avgValue / count");const w=4*Math.floor(a/4),k=a%4,_=`\n      if (${v}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec3 strides =\n        ivec3(${s}, ${o}, ${u});\n      const ivec3 pads = ivec3(${g}, ${m}, ${y});\n      const float initializationValue = ${b};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ${e.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${b});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ${h};\n            wD += ${l}) {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ${e.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${f};\n            wR += ${c}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${w}; wC += 4) {\n              int xC = xCCorner + wC * ${d};\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${d}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${d}, ch),\n                getValue(batch, xD, xR, xC + 3 * ${d}, ch)\n              );\n\n              ${_}\n            }\n\n            int xC = xCCorner + ${w};\n            if (${1===k}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ${_}\n            } else if (${2===k}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${d}, ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ${_}\n            } else if (${3===k}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${d}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${d}, ch),\n                initializationValue\n              );\n\n              ${_}\n            }\n          }\n          setOutput(${x});\n        }\n      }\n    `}}const Rv={kernelName:D.AvgPool,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;Mg(i,"avgPool");const{filterSize:a,strides:s,pad:o,dimRoundingMode:u}=r;D.util.assert(D.backend_util.eitherStridesOrDilationsAreOne(s,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '1'`));const l=D.backend_util.computePool2DInfo(i.shape,a,s,1,o,u);if(1===l.filterWidth&&1===l.filterHeight&&D.util.arraysEqual(l.inShape,l.outShape))return Cy({inputs:{x:i},backend:n});const c=new Ov(l,"avg",!1);return n.runWebGLProgram(c,[i],"float32")}},Bv={kernelName:D.AvgPool3D,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:a,strides:s,pad:o,dimRoundingMode:u,dataFormat:l}=r,c=D.backend_util.computePool3DInfo(i.shape,a,s,[1,1,1],o,u,l),d=new Mv(c,"avg",!1);return n.runWebGLProgram(d,[i],"float32")}};class zv{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a=e.dilationHeight,s=e.dilationWidth,o=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=o-1-e.padInfo.top,c=u-1-e.padInfo.left,d=1/(t*n);this.userCode=`\n      const ivec2 pads = ivec2(${l}, ${c});\n      const float avgMultiplier = float(${d});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${o};\n            wR += ${a}) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${u};\n            wC+= ${s}) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Lv{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,i=e.strideDepth,a=e.strideHeight,s=e.strideWidth,o=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,d=e.effectiveFilterHeight,h=e.effectiveFilterWidth,f=c-1-e.padInfo.front,p=d-1-e.padInfo.top,g=h-1-e.padInfo.left,m=1/(t*n*r);this.userCode=`\n      const ivec3 pads = ivec3(${f}, ${p}, ${g});\n      const float avgMultiplier = float(${m});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${c};\n            wD += ${o}) {\n          float dyD = float(dyDCorner + wD) / ${i}.0;\n\n          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${d};\n              wR += ${u}) {\n            float dyR = float(dyRCorner + wR) / ${a}.0;\n\n            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${h};\n                wC += ${l}) {\n              float dyC = float(dyCCorner + wC) / ${s}.0;\n\n              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}const Pv={kernelName:D.AvgPool3DGrad,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a}=t,s=a,{filterSize:o,strides:u,pad:l,dimRoundingMode:c}=r,d=D.backend_util.computePool3DInfo(s.shape,o,u,[1,1,1],l,c),h=new Lv(d);return n.runWebGLProgram(h,[i],s.dtype)}},jv={kernelName:D.AvgPoolGrad,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a}=t,s=a;Mg([i,a],"avgPoolGrad");const{filterSize:o,strides:u,pad:l}=r,c=D.backend_util.computePool2DInfo(s.shape,o,u,1,l),d=new zv(c);return n.runWebGLProgram(d,[i],s.dtype)}},Uv={kernelName:D.BatchMatMul,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:a}=t,{transposeA:s,transposeB:o}=r;return tv({a:i,b:a,transposeA:s,transposeB:o,backend:n})}};class Wv{constructor(e,t,n,r,i,a){this.outputShape=[],this.variableNames=["x","mean","variance"],D.backend_util.assertAndGetBroadcastShape(e,t),D.backend_util.assertAndGetBroadcastShape(e,n);let s="0.0";null!=r&&(D.backend_util.assertAndGetBroadcastShape(e,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");let o="1.0";null!=i&&(D.backend_util.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),o="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ${s};\n        float scale = ${o};\n        float inv = scale * inversesqrt(variance + float(${a}));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    `}}class Vv{constructor(e,t,n,r,i,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],D.backend_util.assertAndGetBroadcastShape(e,t),D.backend_util.assertAndGetBroadcastShape(e,n);let s="vec4(0.0)";null!=r&&(D.backend_util.assertAndGetBroadcastShape(e,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");let o="vec4(1.0)";null!=i&&(D.backend_util.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),o="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`\n      void main() {\n        vec4 offset = ${s};\n        vec4 scale = ${o};\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(${a}));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    `}}const Gv={kernelName:D.FusedBatchNorm,backendName:"webgl",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r,mean:i,variance:a,offset:s,scale:o}=e;D.util.assert(i.shape.length===a.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),D.util.assert(null==s||i.shape.length===s.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),D.util.assert(null==o||i.shape.length===o.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));let{varianceEpsilon:u}=n;null==u&&(u=.001);const l=[r,i,a];let c=null;null!=s&&(c=s.shape,l.push(s));let d=null;null!=o&&(d=o.shape,l.push(o));const h=(0,D.env)().getBool("WEBGL_PACK_NORMALIZATION")?new Vv(r.shape,i.shape,a.shape,c,d,u):new Wv(r.shape,i.shape,a.shape,c,d,u);return t.runWebGLProgram(h,l,l[0].dtype)}};class qv{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=Jg(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=function(e){if(1===e)return"sourceLoc";if(e<=6)return Hv.slice(0,e).map((e=>"sourceLoc."+e)).join(",");throw Error(`Slicing for rank ${e} is not yet supported`)}(this.rank);let r;r=`\n        ${t} sourceLoc;\n        ${t} coords = getOutputCoords();\n        ${e.map(((e,t)=>`sourceLoc.${Hv[t]} = start[${t}] + coords.${Hv[t]};`)).join("\n")}\n      `,this.userCode=`\n      void main() {\n        ${r}\n        setOutput(getSource(${n}));\n      }\n    `}}const Hv=["x","y","z","w","u","v"];class Xv{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=Jg(this.rank),n=oy("coords",this.rank),r=oy("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":`vec2(${r.slice(-2).join()})`,a=`getChannel(getSource(${r.join()}), ${i})`,s=`\n      result.x = ${a};\n      if (++${n[this.rank-1]} < ${e[this.rank-1]}) {\n        ++${r[this.rank-1]};\n        result.y = ${a};\n        --${r[this.rank-1]};\n      }\n    `,o=1===this.rank?"":`\n      --${n[this.rank-1]};\n      if (++${n[this.rank-2]} < ${e[this.rank-2]}) {\n        ++${r[this.rank-2]};\n        result.z = ${a};\n        if (++${n[this.rank-1]} < ${e[this.rank-1]}) {\n          ++${r[this.rank-1]};\n          result.w = ${a};\n        }\n      }\n    `,u=this.rank<=4?`sourceLoc = coords +\n            ${t}(${e.map(((e,t)=>`start[${t}]`)).join()});`:e.map(((e,t)=>`${r[t]} = ${n[t]} + start[${t}];`)).join("\n");this.userCode=`\n      void main() {\n        ${t} coords = getOutputCoords();\n        ${t} sourceLoc;\n        ${u}\n        vec4 result = vec4(0.);\n        ${s}\n        ${o}\n        setOutput(result);\n      }\n    `}}function Kv(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:a,size:s}=r,[o,u]=D.slice_util.parseSliceParams(i,a,s);if(D.slice_util.assertParamsValid(i,o,u),0===D.util.sizeFromShape(u))return n.makeTensorInfo(u,i.dtype,[]);if(n.shouldExecuteOnCPU([i])||"string"===i.dtype){const e=n.texData.get(i.dataId),t=qm(e.values,o,u,i.shape,i.dtype);return n.makeTensorInfo(u,i.dtype,t)}const{isPacked:l}=n.texData.get(i.dataId),c=D.slice_util.isSliceContinous(i.shape,o,u);if(l||!c){const e=(0,D.env)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Xv(u):new qv(u),t=[o];return n.runWebGLProgram(e,[i],i.dtype,t)}return n.uploadToGPU(i.dataId),function(e,t,n,r){const i=r.texData.get(e.dataId),a=r.makeTensorInfo(n,e.dtype),s=r.texData.get(a.dataId);Object.assign(s,i),s.refCount=1,s.shape=n,s.dtype=e.dtype;let o=D.slice_util.computeFlatOffset(t,D.util.computeStrides(e.shape));i.slice&&(o+=i.slice.flatOffset),s.slice={flatOffset:o,origDataId:i.slice&&i.slice.origDataId||e.dataId};const u=r.dataRefCount.get(s.slice.origDataId)||1;return r.dataRefCount.set(s.slice.origDataId,u+1),a}(i,o,u,n)}const Yv={kernelName:D.Slice,backendName:"webgl",kernelFunc:Kv},Qv={kernelName:D.BatchToSpaceND,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:a,crops:s}=r;D.util.assert(i.shape.length<=4,(()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"));const o=a.reduce(((e,t)=>e*t)),u=D.backend_util.getReshaped(i.shape,a,o),l=D.backend_util.getPermuted(u.length,a.length),c=D.backend_util.getReshapedPermuted(i.shape,a,o),d=D.backend_util.getSliceBeginCoords(s,a.length),h=D.backend_util.getSliceSize(c,s,a.length),f=[],p=Wy({inputs:{x:i},backend:n,attrs:{shape:u}}),g=Zy({inputs:{x:p},backend:n,attrs:{perm:l}}),m=Wy({inputs:{x:g},backend:n,attrs:{shape:c}}),y=Kv({inputs:{x:m},backend:n,attrs:{begin:d,size:h}});return f.push(p),f.push(g),f.push(m),f.forEach((e=>n.disposeIntermediateTensorInfo(e))),y}},Jv={kernelName:D.Bincount,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:a}=t,{size:s}=r,o=n.readSync(i.dataId),u=n.readSync(a.dataId),l=bm(o,u,a.dtype,a.shape,s);return n.makeTensorInfo([s],a.dtype,l)}},Zv={kernelName:D.BroadcastArgs,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{s0:r,s1:i}=t,a=n.readSync(r.dataId),s=n.readSync(i.dataId),o=D.backend_util.assertAndGetBroadcastShape(Array.from(a),Array.from(s));return n.makeTensorInfo([o.length],"int32",Int32Array.from(o))}},eb=Ry({opSnippet:"return float(a != b);",cpuKernelImpl:Pm,dtype:"bool"}),tb={kernelName:D.NotEqual,backendName:"webgl",kernelFunc:eb};function nb(e){const{inputs:t,backend:n}=e,{input:r}=t;return Cy({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}const rb={kernelName:D.Real,backendName:"webgl",kernelFunc:nb},ib={kernelName:D.Cast,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:r,attrs:i}=t,{x:a}=n,{dtype:s}=i;if("complex64"===s){if("complex64"===a.dtype)return Cy({inputs:{x:a},backend:r});const t=D.zeros(a.shape),n=e({inputs:{x:a},backend:r,attrs:{dtype:"float32"}}),i=Ey({inputs:{real:n,imag:t},backend:r});return t.dispose(),r.disposeIntermediateTensorInfo(n),i}if("complex64"===a.dtype){const t=nb({inputs:{input:a},backend:r}),n=e({inputs:{x:t},backend:r,attrs:{dtype:s}});return r.disposeIntermediateTensorInfo(t),n}if(!D.util.hasEncodingLoss(a.dtype,s)){const e=Cy({inputs:{x:a},backend:r});return{dataId:e.dataId,shape:e.shape,dtype:s}}if("int32"===s)return function(e,t){const n=new py(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(a,r);if("bool"===s){const e=r.makeTensorInfo([],"bool",D.util.getTypedArrayFromDType("bool",1)),t=eb({inputs:{a,b:e},backend:r});return r.disposeIntermediateTensorInfo(e),t}throw new Error(`Error in Cast: failed to cast ${a.dtype} to ${s}`)}},ab="return ceil(x);",sb=My({opSnippet:ab,packedOpSnippet:ab,cpuKernelImpl:wm}),ob={kernelName:D.Ceil,backendName:"webgl",kernelFunc:sb};class ub{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}}class lb{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}}const cb={kernelName:D.ClipByValue,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{clipValueMin:a,clipValueMax:s}=r;let o;o=(0,D.env)().getBool("WEBGL_PACK_CLIP")?new lb(i.shape):new ub(i.shape);const u=[[a],[s]];return n.runWebGLProgram(o,[i],i.dtype,u)}};class db{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}function hb(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}const fb={kernelName:D.ComplexAbs,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t,i=n.texData.get(r.dataId),a=new db(r.shape),s=[hb(r,i.complexTensorInfos.real),hb(r,i.complexTensorInfos.imag)];return n.runWebGLProgram(a,s,s[0].dtype)}};class pb{constructor(e){this.outputShape=[],this.outputShape=D.backend_util.computeOutShape(e,1),this.variableNames=e.map(((e,t)=>`T${t}`));const t=new Array(e.length-1);t[0]=e[0][1];for(let n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];const n=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let e=1;e<t.length;e++){const r=t[e-1];n.push(`else if (yC < ${t[e]}) setOutput(getT${e}(yR, yC-${r}));`)}const r=t.length,i=t[t.length-1];n.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ${n.join("\n        ")}\n      }\n    `}}class gb{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=D.backend_util.computeOutShape(e,t);const n=this.outputShape,r=n.length,i=Jg(r),a=oy("coords",r),s=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(((e,t)=>`T${t}`));const o=new Array(e.length-1);o[0]=e[0][t];for(let n=1;n<o.length;n++)o[n]=o[n-1]+e[n][t];const u=s[t],l=s.slice(-2),c=s.join();let d=`if (${u} < ${o[0]}) {\n        return getChannel(\n            getT0(${c}), vec2(${l.join()}));\n        }`;for(let e=1;e<o.length;e++){const t=o[e-1];d+=`\n        if (${u} < ${o[e]}  && ${u} >= ${o[e-1]}) {\n          return getChannel(\n            getT${e}(${mb(s,u,t)}),\n            vec2(${mb(l,u,t)}));\n        }`}const h=o.length,f=o[o.length-1];d+=`\n        return getChannel(\n          getT${h}(${mb(s,u,f)}),\n          vec2(${mb(l,u,f)}));`,this.userCode=`\n      float getValue(${s.map((e=>"int "+e))}) {\n        ${d}\n      }\n\n      void main() {\n        ${i} coords = getOutputCoords();\n        vec4 result = vec4(getValue(${a}), 0., 0., 0.);\n\n        ${a[r-1]} = ${a[r-1]} + 1;\n        if (${a[r-1]} < ${n[r-1]}) {\n          result.g = getValue(${a});\n        }\n\n        ${a[r-2]} = ${a[r-2]} + 1;\n        if (${a[r-2]} < ${n[r-2]}) {\n          result.a = getValue(${a});\n        }\n\n        ${a[r-1]} = ${a[r-1]} - 1;\n        if (${a[r-2]} < ${n[r-2]} &&\n            ${a[r-1]} < ${n[r-1]}) {\n          result.b = getValue(${a});\n        }\n        setOutput(result);\n      }\n    `}}function mb(e,t,n){const r=e.indexOf(t);return e.map(((e,t)=>t===r?`${e} - ${n}`:e)).join()}function yb(e){const{inputs:t,backend:n}=e,{input:r}=t;return Cy({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}const vb={kernelName:D.Imag,backendName:"webgl",kernelFunc:yb};function bb(e,t,n){const r=e[0].dtype;if("complex64"===r){const r=e.map((e=>nb({inputs:{input:e},backend:n}))),i=e.map((e=>yb({inputs:{input:e},backend:n}))),a=bb(r,t,n),s=bb(i,t,n),o=Ey({inputs:{real:a,imag:s},backend:n});return r.forEach((e=>n.disposeIntermediateTensorInfo(e))),i.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(s),o}let i=n.shouldExecuteOnCPU(e);if("string"===r&&(i=!0),i){const i=e.map((e=>{const r=D.util.sizeFromShape(e.shape.slice(t));return Wy({inputs:{x:e},backend:n,attrs:{shape:[-1,r]}})})),a=i.map((e=>({vals:n.readSync(e.dataId),shape:e.shape}))),s=D.backend_util.computeOutShape(i.map((e=>e.shape)),1),o=1===i[0].shape[0],u=km(a,s,r,o),l=D.backend_util.computeOutShape(e.map((e=>e.shape)),t),c=n.makeTensorInfo(l,r,u);return i.forEach((e=>n.disposeIntermediateTensorInfo(e))),c}if(e.length>(0,D.env)().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const r=Math.floor(e.length/2),i=bb(e.slice(0,r),t,n),a=bb(e.slice(r),t,n),s=bb([i,a],t,n);return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),s}if((0,D.env)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].shape.length>1){const i=new gb(e.map((e=>e.shape)),t);return n.runWebGLProgram(i,e,r)}const{tensors2D:a,outShape:s}=function(e,t,n){const r=D.backend_util.computeOutShape(e.map((e=>e.shape)),t);return{tensors2D:e.map((e=>Wy({inputs:{x:e},attrs:{shape:[-1,D.util.sizeFromShape(e.shape.slice(t))]},backend:n}))),outShape:r}}(e,t,n),o=new pb(a.map((e=>e.shape))),u=n.runWebGLProgram(o,a,r);a.forEach((e=>n.disposeIntermediateTensorInfo(e)));const l=Wy({inputs:{x:u},attrs:{shape:s},backend:n});return n.disposeIntermediateTensorInfo(u),l}function xb(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r,a=D.util.parseAxisParam(i,t[0].shape)[0],s=D.backend_util.computeOutShape(t.map((e=>e.shape)),a);if(0===D.util.sizeFromShape(s))return n.makeTensorInfo(s,t[0].dtype,[]);const o=t.filter((e=>D.util.sizeFromShape(e.shape)>0));if(1===o.length)return Cy({inputs:{x:o[0]},backend:n});const u=o.map((e=>e.shape));return D.backend_util.assertParamsConsistent(u,a),bb(o,a,n)}const wb={kernelName:D.Concat,backendName:"webgl",kernelFunc:xb};class kb{constructor(e,t=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const a=e.padInfo.top,s=e.padInfo.left,o=e.strideHeight,u=e.strideWidth,l=e.dilationHeight,c=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,f=4*Math.floor(e.inChannels/4),p=e.inChannels%4,g="channelsLast"===e.dataFormat,m=g?1:2,y=g?2:3,v=g?3:1;let b="",x="";n&&(b=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:i?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,x="result = activation(result);");const w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${b}\n\n      const ivec2 strides = ivec2(${o}, ${u});\n      const ivec2 pads = ivec2(${a}, ${s});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[${v}];\n\n        ivec2 xRCCorner =\n            ivec2(coords[${m}], coords[${y}]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${d}; wR++) {\n          int xR = xRCorner + wR * ${l};\n\n          if (xR < 0 || xR >= ${e.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${h}; wC++) {\n            int xC = xCCorner + wC * ${c};\n\n            if (xC < 0 || xC >= ${e.inWidth}) {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ${f}; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (${g}) {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (${1===p}) {\n\n              if (${g}) {\n                dotProd +=\n                    getX(batch, xR, xC, ${f}) *\n                    getW(wR, wC, ${f}, d2);\n              } else {\n                dotProd +=\n                    getX(batch, ${f}, xR, xC) *\n                    getW(wR, wC, ${f}, d2);\n              }\n\n            } else if (${2===p}) {\n              vec2 wValues = vec2(\n                getW(wR, wC, ${f}, d2),\n                getW(wR, wC, ${f} + 1, d2)\n              );\n\n              if (${g}) {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ${f}),\n                  getX(batch, xR, xC, ${f} + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ${f}, xR, xC),\n                  getX(batch, ${f} + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (${3===p}) {\n              vec3 wValues = vec3(\n                getW(wR, wC, ${f}, d2),\n                getW(wR, wC, ${f} + 1, d2),\n                getW(wR, wC, ${f} + 2, d2)\n              );\n\n              if (${g}) {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ${f}),\n                  getX(batch, xR, xC, ${f} + 1),\n                  getX(batch, xR, xC, ${f} + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ${f}, xR, xC),\n                  getX(batch, ${f} + 1, xR, xC),\n                  getX(batch, ${f} + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ${w}\n        ${x}\n        setOutput(result);\n      }\n    `}}class _b{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,a=e.strideHeight,s=e.strideWidth,o=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterDepth,d=e.filterHeight,h=e.filterWidth,f=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode=`\n      const ivec3 strides = ivec3(${i}, ${a}, ${s});\n      const ivec3 pads = ivec3(${t}, ${n}, ${r});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${c}; wF++) {\n          int xF = xFCorner + wF * ${o};\n\n          if (xF < 0 || xF >= ${e.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${d}; wR++) {\n            int xR = xRCorner + wR * ${u};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${h}; wC++) {\n              int xC = xCCorner + wC * ${l};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ${f}; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (${1===p}) {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ${f}) *\n                  getW(wF, wR, wC, ${f}, d2);\n              } else if (${2===p}) {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ${f}),\n                  getX(batch, xF, xR, xC, ${f} + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ${f}, d2),\n                  getW(wF, wR, wC, ${f} + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (${3===p}) {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ${f}),\n                  getX(batch, xF, xR, xC, ${f} + 1),\n                  getX(batch, xF, xR, xC, ${f} + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ${f}, d2),\n                  getW(wF, wR, wC, ${f} + 1, d2),\n                  getW(wF, wR, wC, ${f} + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Sb{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=im(this.outputShape.length);const{dataFormat:n}=t,r=Bg(),i="channelsLast"===n,a=i?0:1,s=i?1:2,o=this.enableShapeUniforms?"if(blockIndex < outShape[1] && pos < outShape[0]) {":`if(blockIndex < ${e[1]} && pos < ${e[0]}) {`;let u="";for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)u+=`\n          blockIndex = rc.y + ${t};\n          pos = rc.x + ${e};\n\n          ${o}\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[${a}] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[${s}] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (${i}) {\n                  innerDims = vec2(d1, ch);\n                  result[${2*e+t}] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[${2*e+t}] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        `;this.userCode=`\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ${u}\n\n        ${r.output} = result;\n      }\n    `}}function Cb({x:e,filter:t,convInfo:n,backend:r,bias:i=null,preluActivationWeights:a=null,leakyreluAlpha:s=0,activation:o=null}){const u=e.shape,l=r.texData.get(e.dataId),c=n.inChannels,d=u[0]*u[1]*u[2],h=n.outChannels,f="channelsLast"===n.dataFormat;let p;const g=[];if((1!==d&&1!==h||!(c>1e3))&&l.isPacked&&f&&null!=l.texture&&u[2]%2!=0&&D.util.arraysEqual(l.shape.slice(-3),u.slice(-3))){const c=u[0]*u[1]*(u[2]+1),d={dataId:e.dataId,shape:[1,c,n.inChannels],dtype:e.dtype},h=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,D.util.assert(Ig(l.shape,d.shape),(()=>`packed reshape ${l.shape} to ${d.shape} isn't free`));const f=Wy({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});g.push(f);const m=tv({a:d,b:f,backend:r,transposeA:!1,transposeB:!1,bias:i,activation:o,preluActivationWeights:a,leakyreluAlpha:s}),y=r.texData.get(m.dataId);D.util.assert(y.isPacked,(()=>"batchMatMul result is expected to be packed")),l.shape=h,y.shape=n.outShape,p=Cy({inputs:{x:m},backend:r}),p.shape=n.outShape,g.push(m)}else{const l=Wy({inputs:{x:e},backend:r,attrs:{shape:[1,f?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],n.inChannels]}}),c=Wy({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),d=tv({a:l,b:c,transposeA:!1,transposeB:!1,backend:r,bias:i,activation:o,preluActivationWeights:a,leakyreluAlpha:s});p=Wy({inputs:{x:d},backend:r,attrs:{shape:n.outShape}}),g.push(l),g.push(c),g.push(d)}for(const e of g)r.disposeIntermediateTensorInfo(e);return p}function Ab({x:e,filter:t,convInfo:n,backend:r,bias:i=null,preluActivationWeights:a=null,leakyreluAlpha:s=0,activation:o=null}){const{filterWidth:u,filterHeight:l,inChannels:c,outWidth:d,outHeight:h,dataFormat:f}=n,p="channelsLast"===f,g=u*l*c,m=h*d,y=[g,m],v=[],b=Wy({inputs:{x:e},backend:r,attrs:{shape:e.shape.slice(1)}}),x=Wy({inputs:{x:t},backend:r,attrs:{shape:[1,g,D.util.sizeFromShape(t.shape)/g]}});v.push(b),v.push(x);const w=new Sb(y,n),k=[b.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],_=r.runWebGLProgram(w,[b],"float32",k),S=Wy({inputs:{x:_},backend:r,attrs:{shape:[1,y[0],y[1]]}});v.push(_),v.push(S);const C=null!=i,A=null!=a,E="leakyrelu"===o,F=o?By(o,!0):null,I=new zy(S.shape,x.shape,[1,m,n.outChannels],!0,!1,C,F,A,E),N=[S,x];if(i&&N.push(i),A&&N.push(a),E){const e=r.makeTensorInfo([],"float32",D.util.createScalarValue(s,"float32"));N.push(e),v.push(e)}const $=r.runWebGLProgram(I,N,"float32"),T=Wy({inputs:{x:$},backend:r,attrs:{shape:p?[1,h,d,n.outChannels]:[1,n.outChannels,h,d]}});v.push($);for(const e of v)r.disposeIntermediateTensorInfo(e);return T}const Eb={kernelName:D.Conv2D,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a}=t,{strides:s,pad:o,dataFormat:u,dilations:l,dimRoundingMode:c}=r,d=D.backend_util.convertConv2DDataFormat(u),h=D.backend_util.computeConv2DInfo(i.shape,a.shape,s,l,o,c,!1,d);let f;if(1!==h.filterHeight||1!==h.filterWidth||1!==h.dilationHeight||1!==h.dilationWidth||1!==h.strideHeight||1!==h.strideWidth||"SAME"!==h.padInfo.type&&"VALID"!==h.padInfo.type)if((0,D.env)().getBool("WEBGL_CONV_IM2COL")&&1===i.shape[0])f=Ab({x:i,filter:a,convInfo:h,backend:n});else{const e=new kb(h);f=n.runWebGLProgram(e,[i,a],"float32")}else f=Cb({x:i,filter:a,convInfo:h,backend:n});const p=Wy({inputs:{x:f},backend:n,attrs:{shape:h.outShape}});return n.disposeIntermediateTensorInfo(f),p}};class Fb{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,a="channelsLast"===e.dataFormat;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yR = 0; yR < ${e.outHeight}; yR++) {\n            int xR = wR + yR * ${t} - ${r};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${e.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${i};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              if (${a}) {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Ib{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a="channelsLast"===e.dataFormat,s=t-1-e.padInfo.top,o=n-1-e.padInfo.left,u=a?1:2,l=a?2:3,c=a?3:1;this.userCode=`\n      const ivec2 pads = ivec2(${s}, ${o});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[${c}];\n\n        ivec2 dyCorner = ivec2(coords[${u}], coords[${l}]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${t}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${t} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {\n\n              if (${a}) {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Db{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,a=e.padInfo.top,s=e.padInfo.left;this.userCode=`\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yF = 0; yF < ${e.outDepth}; yF++) {\n            int xF = wF + yF * ${t} - ${i};\n\n            if (xF < 0 || xF >= ${e.inDepth}) {\n              continue;\n            }\n\n            for (int yR = 0; yR < ${e.outHeight}; yR++) {\n              int xR = wR + yR * ${n} - ${a};\n\n              if (xR < 0 || xR >= ${e.inHeight}) {\n                continue;\n              }\n\n              for (int yC = 0; yC < ${e.outWidth}; yC++) {\n                int xC = wC + yC * ${r} - ${s};\n\n                if (xC < 0 || xC >= ${e.inWidth}) {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Nb{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,i=e.strideDepth,a=e.strideHeight,s=e.strideWidth,o=t-1-e.padInfo.front,u=n-1-e.padInfo.top,l=r-1-e.padInfo.left;this.userCode=`\n      const ivec3 pads = ivec3(${o}, ${u}, ${l});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${t}; wF++) {\n          float dyF = float(dyFCorner + wF) / ${i}.0;\n\n          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ${t} - 1 - wF;\n\n          for (int wR = 0; wR < ${n}; wR++) {\n            float dyR = float(dyRCorner + wR) / ${a}.0;\n\n            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ${n} - 1 - wR;\n\n            for (int wC = 0; wC < ${r}; wC++) {\n              float dyC = float(dyCCorner + wC) / ${s}.0;\n\n              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ${r} - 1 - wC;\n\n              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}const $b={kernelName:D.Conv2DBackpropFilter,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:a}=t,{strides:s,pad:o,dataFormat:u,dimRoundingMode:l,filterShape:c}=r,d=D.backend_util.convertConv2DDataFormat(u),h=D.backend_util.computeConv2DInfo(i.shape,c,s,1,o,l,!1,d),f=new Fb(h);return n.runWebGLProgram(f,[i,a],"float32")}},Tb={kernelName:D.Conv2DBackpropInput,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:a}=t,{inputShape:s,strides:o,pad:u,dataFormat:l,dimRoundingMode:c}=r,d=D.backend_util.convertConv2DDataFormat(l),h=D.backend_util.computeConv2DInfo(s,a.shape,o,1,u,c,!1,d),f=new Ib(h);return n.runWebGLProgram(f,[i,a],"float32")}},Ob={kernelName:D.Conv3D,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a}=t,{strides:s,pad:o,dilations:u}=r,l=D.backend_util.computeConv3DInfo(i.shape,a.shape,s,u,o),c=new _b(l);return n.runWebGLProgram(c,[i,a],"float32")}},Mb={kernelName:D.Conv3DBackpropFilterV2,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:a}=t,{strides:s,pad:o,filterShape:u}=r,l=D.backend_util.computeConv3DInfo(i.shape,u,s,1,o),c=new Db(l);return n.runWebGLProgram(c,[i,a],"float32")}},Rb={kernelName:D.Conv3DBackpropInputV2,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:a}=t,{pad:s,strides:o,inputShape:u}=r,l=D.backend_util.computeConv3DInfo(u,a.shape,o,1,s),c=new Nb(l);return n.runWebGLProgram(c,[i,a],"float32")}},Bb=My({opSnippet:"if (isnan(x)) return x;\n  return cos(x);\n"}),zb={kernelName:D.Cos,backendName:"webgl",kernelFunc:Bb},Lb=My({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),Pb={kernelName:D.Cosh,backendName:"webgl",kernelFunc:Lb};class jb{constructor(e,t,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[a,s,o,u]=e,[l]=t,[c,d]=n;this.outputShape=[l,c,d,u];const h="bilinear"===r?1:0,[f,p]=[s-1+".0",o-1+".0"],[g,m,y]=c>1?[""+(s-1)/(c-1),"(y2-y1) * height_ratio",`y1*${f} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${f}`],[v,b,x]=d>1?[""+(o-1)/(d-1),"(x2-x1) * width_ratio",`x1*${p} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${p}`];this.userCode=`\n      const float height_ratio = float(${g});\n      const float width_ratio = float(${v});\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ${a}) {\n          return;\n        }\n\n        float height_scale = ${m};\n        float width_scale = ${b};\n\n        float in_y = ${y};\n        if( in_y < 0.0 || in_y > ${f} ) {\n          setOutput(float(${i}));\n          return;\n        }\n        float in_x = ${x};\n        if( in_x < 0.0 || in_x > ${p} ) {\n          setOutput(float(${i}));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(${h} == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    `}}const Ub={kernelName:D.CropAndResize,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{image:i,boxes:a,boxInd:s}=t,{cropSize:o,method:u,extrapolationValue:l}=r,c=new jb(i.shape,a.shape,o,u,l);return n.runWebGLProgram(c,[i,a,s],"float32")}};class Wb{constructor(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}],this.outputShape=e;const r=e.length,i=t?"1.0":`getX(${Vb(r,"coords")})`,a=e[e.length-1];let s="",o="";t?(s=n?"end != "+(a-1):"end != 0",o=n?"end + 1":"end - 1"):(s=n?`end + pow2 < ${a}`:"end >= pow2",o=n?"end + pow2":"end - pow2"),this.userCode=`\n      void main() {\n        ${Jg(r)} coords = getOutputCoords();\n        int end = ${Gb(r,"coords")};\n        float val = ${i};\n        int pow2 = int(pow(2.0, index));\n        if (${s}) {\n          int idx = ${o};\n          ${Gb(r,"coords")} = idx;\n          val *= getX(${Vb(r,"coords")});\n        }\n        setOutput(val);\n      }\n    `}}function Vb(e,t){if(1===e)return`${t}`;if(2===e)return`${t}.x, ${t}.y`;if(3===e)return`${t}.x, ${t}.y, ${t}.z`;if(4===e)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw Error(`Cumulative product for rank ${e} is not yet supported`)}function Gb(e,t){if(1===e)return`${t}`;if(2===e)return`${t}.y`;if(3===e)return`${t}.z`;if(4===e)return`${t}.w`;throw Error(`Cumulative product for rank ${e} is not yet supported`)}const qb={kernelName:D.Cumprod,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,exclusive:s,reverse:o}=r,u=i.shape.length,l=D.backend_util.getAxesPermutation([a],u);let c=i;null!=l&&(c=Zy({inputs:{x:i},backend:n,attrs:{perm:l}}));const d=D.backend_util.getInnerMostAxes(1,u)[0];if(d!==u-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${i.shape.length-1} but got axis=${a}`);const h=c.shape[d];let f=Cy({inputs:{x:c},backend:n});for(let e=0;e<=Math.ceil(Math.log2(h))-1;e++){const t=new Wb(c.shape,!1,o),r=[[e]],i=f;f=n.runWebGLProgram(t,[f],f.dtype,r),n.disposeIntermediateTensorInfo(i)}if(s){const e=new Wb(c.shape,s,o),t=f;f=n.runWebGLProgram(e,[f],f.dtype),n.disposeIntermediateTensorInfo(t)}if(null!=l){const e=Zy({inputs:{x:f},backend:n,attrs:{perm:D.backend_util.getUndoAxesPermutation(l)}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(c),e}return f}};class Hb{constructor(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}],this.outputShape=e;const r=e.length,i=t?"0.0":`getX(${Xb(r,"coords")})`,a=e[e.length-1];let s="",o="";t?(s=n?"end != "+(a-1):"end != 0",o=n?"end + 1":"end - 1"):(s=n?`end + pow2 < ${a}`:"end >= pow2",o=n?"end + pow2":"end - pow2"),this.userCode=`\n      void main() {\n        ${Jg(r)} coords = getOutputCoords();\n        int end = ${Kb(r,"coords")};\n        float val = ${i};\n        int pow2 = int(pow(2.0, index));\n        if (${s}) {\n          int idx = ${o};\n          ${Kb(r,"coords")} = idx;\n          val += getX(${Xb(r,"coords")});\n        }\n        setOutput(val);\n      }\n    `}}function Xb(e,t){if(1===e)return`${t}`;if(2===e)return`${t}.x, ${t}.y`;if(3===e)return`${t}.x, ${t}.y, ${t}.z`;if(4===e)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw Error(`Cumulative sum for rank ${e} is not yet supported`)}function Kb(e,t){if(1===e)return`${t}`;if(2===e)return`${t}.y`;if(3===e)return`${t}.z`;if(4===e)return`${t}.w`;throw Error(`Cumulative sum for rank ${e} is not yet supported`)}const Yb={kernelName:D.Cumsum,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,exclusive:s,reverse:o}=r,u=i.shape.length,l=D.backend_util.getAxesPermutation([a],u);let c=i;null!=l&&(c=Zy({inputs:{x:i},backend:n,attrs:{perm:l}}));const d=D.backend_util.getInnerMostAxes(1,u)[0];if(d!==u-1)throw new Error(`WebGL cumsum shader expects an inner-most axis=${i.shape.length-1} but got axis=${a}`);const h=c.shape[d];let f=Cy({inputs:{x:c},backend:n});for(let e=0;e<=Math.ceil(Math.log2(h))-1;e++){const t=new Hb(c.shape,!1,o),r=[[e]],i=f;f=n.runWebGLProgram(t,[f],f.dtype,r),n.disposeIntermediateTensorInfo(i)}if(s){const e=new Hb(c.shape,s,o),t=f;f=n.runWebGLProgram(e,[f],f.dtype),n.disposeIntermediateTensorInfo(t)}if(null!=l){const e=Zy({inputs:{x:f},backend:n,attrs:{perm:D.backend_util.getUndoAxesPermutation(l)}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(c),e}return f}},Qb={kernelName:D.DenseBincount,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:a}=t,{size:s,binaryOutput:o}=r;if(1===i.shape.length){const e=n.readSync(i.dataId),t=n.readSync(a.dataId),r=bm(e,t,a.dtype,a.shape,s);return n.makeTensorInfo([s],a.dtype,r)}if(2===i.shape.length){const e=n.bufferSync(i),t=n.bufferSync(a),r=xm(e,t,s,o);return n.makeTensorInfo(r.shape,a.dtype,r.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}};class Jb{constructor(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ${this.getHeightCoordString()};\n      int w = ${this.getWidthCoordString()};\n      int d = ${this.getDepthCoordString()};\n\n      int in_h = h / ${t};\n      int offset_h = imod(h, ${t});\n      int in_w = w / ${t};\n      int offset_w = imod(w, ${t});\n      int offset_d = (offset_h * ${t} + offset_w) *\n        ${this.getOutputDepthSize()};\n      int in_d = d + offset_d;\n\n      float result = ${this.getInputSamplingString()};\n      setOutput(result);\n    }\n  `}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}const Zb={kernelName:D.DepthToSpace,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockSize:a,dataFormat:s}=r,o=i.shape[0],u=("NHWC"===s?i.shape[1]:i.shape[2])*a,l=("NHWC"===s?i.shape[2]:i.shape[3])*a,c=("NHWC"===s?i.shape[3]:i.shape[1])/(a*a),d=new Jb("NHWC"===s?[o,u,l,c]:[o,c,u,l],a,s);return n.runWebGLProgram(d,[i],i.dtype)}};class ex{constructor(e,t=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=im(this.outputShape.length);const a=e.filterHeight,s=e.filterWidth,o=e.outChannels/e.inChannels;let u="",l="";n&&(u=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:i?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,l="result = activation(result);");const c=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${u}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${o};\n        int q = d2 - d1 * ${o};\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ${a}; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${s}; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ${c}\n        ${l}\n        setOutput(result);\n      }\n    `}}class tx{constructor(e,t=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=im(this.outputShape.length);const a=e.outChannels/e.inChannels,s=e.padInfo.left,o=e.strideWidth,u=e.dilationWidth,l=e.filterHeight,c=e.filterWidth,d=c;let h="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;";for(let e=0;e<c;e++)h+=`\n          vec4 xTexelC${2*e};\n          int xTexelC${2*e}Ready;\n          vec4 xTexelC${2*e+1};\n          int xTexelC${2*e+1}Ready;\n          vec4 xC${e};`;h+=`\n    for (int r = 0; r < ${l}; r++) {\n      `;for(let e=0;e<c;e++)h+=`\n          xTexelC${2*e} = vec4(0.0);\n          xTexelC${2*e}Ready = 0;\n          xTexelC${2*e+1} = vec4(0.0);\n          xTexelC${2*e+1}Ready = 0;\n          xC${e} = vec4(0.0);`;h+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(let e=0;e<(d+1)/2;e++){const t=2*e;if(h+=`\n          xC = xCCorner + ${t*u};\n          `,1===o){if(t<c&&(s%2==1?(h+=`\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n              `,h+=1===u&&t>0?`\n                xC${t} = vec4(xTexelC${t-2}.zw, xTexelC${t}.xy);\n                `:`\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC${t} = vec4(previous.zw, xTexelC${t}.xy);\n                  } else {\n                    xC${t} = vec4(0.0, 0.0, xTexelC${t}.xy);\n                  }\n                  `):h+=`\n                if (xC >= 0 && xC < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n\n                xC${t} = xTexelC${t};\n                `,t+1<c)){const e=s%2==0?D.util.nearestLargerEven(u):u;u%2==0&&s%2==1||u%2!=0&&s%2!=1?(h+=`\n                  xCOffset = xC + imod(pads[1], 2) + ${e};\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                    xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC${t+1}.zw = vec2(0.0);\n                    }\n                    xTexelC${t+1}Ready = 1;\n                  }\n                  `,u>1&&(h+=`\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {\n                      xTexelC${t} = getX(batch, xR, xCOffset, d1);\n                      xTexelC${t}Ready = 1;\n                    }\n                    `),h+=`\n                  xC${t+1} = vec4(xTexelC${t}.zw, xTexelC${t+1}.xy);\n                  `):h+=1===e?`\n                    xC${t+1} = xTexelC${t};\n                    `:`\n                    xCOffset = xC + ${e};\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                      xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC${t+1}.zw = vec2(0.0);\n                      }\n                      xTexelC${t+1}Ready = 1;\n                    }\n\n                    xC${t+1} = xTexelC${t+1};\n                    `}}else t<c&&(s%2==1?(h+=`\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${t+1}Ready == 0) {\n                  xTexelC${t+1} = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC${t+1}.zw = vec2(0.0);\n                  }\n                  xTexelC${t+1}Ready = 1;\n                }\n\n                xC${t} = vec4(xTexelC${t}.zw, xTexelC${t+1}.zw);\n              `,t+1<c&&(h+=`\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC${t+1} = vec4(xTexelC${t+1}.xy, final.xy);\n                `)):(h+=`\n                if(xC >= 0 && xC < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                  xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${t+1}.zw = vec2(0.);\n                  }\n                  xTexelC${t+1}Ready = 1;\n                }\n\n                xC${t} = vec4(\n                  xTexelC${t}.xy, xTexelC${t+1}.xy);\n              `,t+1<c&&(h+=`\n                  xC${t+1} = vec4(xTexelC${t}.zw, xTexelC${t+1}.zw);\n                `)));t<c&&(h+=`\n            wTexel = getW(r, ${t}, d1, q);\n            dotProd += xC${t} * vec4(wTexel.xz, wTexel.xz);\n          `,t+1<c&&(h+=`\n              wTexel = getW(r, ${t+1}, d1, q);\n              dotProd += xC${t+1} * vec4(wTexel.xz, wTexel.xz);\n            `))}h+="\n    }\n  ",h+="\n      }\n    ";let f="",p="";n&&(f=r?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:i?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`vec4 activation(vec4 x) {\n          ${n}\n        }`,p="result = activation(result);");const g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${f}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${a};\n        int q = d2 - d1 * ${a};\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ${h}\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ${g}\n        ${p}\n        setOutput(result);\n      }\n    `}}const nx={kernelName:D.DepthwiseConv2dNative,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a}=t,{strides:s,pad:o,dilations:u,dimRoundingMode:l}=r;let c=u;null==c&&(c=[1,1]),D.util.assert(D.backend_util.eitherStridesOrDilationsAreOne(s,c),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`));const d=D.backend_util.computeConv2DInfo(i.shape,a.shape,s,c,o,l,!0);let h;h=(0,D.env)().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels==1?new tx(d):new ex(d);const f=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return n.runWebGLProgram(h,[i,a],"float32",f)}};class rx{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,a=e.outChannels/e.inChannels;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ${a} + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yR = 0; yR < ${e.outHeight}; yR++) {\n            int xR = wR + yR * ${t} - ${r};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${e.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${i};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class ix{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a=t-1-e.padInfo.top,s=n-1-e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`\n      const ivec2 pads = ivec2(${a}, ${s});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ${t}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${t} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ${o}; dm++) {\n              int d2 = d1 * ${o} + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}const ax={kernelName:D.DepthwiseConv2dNativeBackpropFilter,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:a}=t,{strides:s,dilations:o,pad:u,dimRoundingMode:l,filterShape:c}=r,d=D.backend_util.computeConv2DInfo(i.shape,c,s,o,u,l,!0),h=new rx(d);return n.runWebGLProgram(h,[i,a],"float32")}},sx={kernelName:D.DepthwiseConv2dNativeBackpropInput,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:a}=t,{strides:s,dilations:o,pad:u,dimRoundingMode:l,inputShape:c}=r,d=D.backend_util.computeConv2DInfo(c,a.shape,s,o,u,l,!0),h=new ix(d);return n.runWebGLProgram(h,[i,a],"float32")}};class ox{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}const ux={kernelName:D.Diag,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t,i=[...r.shape,...r.shape],a=D.util.sizeFromShape(r.shape),s=Wy({inputs:{x:r},backend:n,attrs:{shape:[a]}}),o=new ox(a),u=n.runWebGLProgram(o,[s],s.dtype),l=Wy({inputs:{x:u},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),l}};class lx{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:n,padInfo:r,strideHeight:i,strideWidth:a,filterHeight:s,filterWidth:o,dilationHeight:u,dilationWidth:l}=e,{top:c,left:d}=r;this.userCode=`\n      const ivec2 strides = ivec2(${i}, ${a});\n      const ivec2 pads = ivec2(${c}, ${d});\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ${s}; h++) {\n          int hIn = hBeg + h * ${u};\n\n          if (hIn >= 0 && hIn < ${t}) {\n            for (int w = 0; w < ${o}; w++) {\n              int wIn = wBeg + w * ${l};\n\n              if (wIn >= 0 && wIn < ${n}) {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    `}}const cx={kernelName:D.Dilation2D,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a}=t,{strides:s,pad:o,dilations:u}=r,l=D.backend_util.computeDilation2DInfo(i.shape,a.shape,s,o,"NHWC",u);let c;const d=new lx(l);c=n.runWebGLProgram(d,[i,a],"float32");const h=Wy({inputs:{x:c},backend:n,attrs:{shape:l.outShape}});return n.disposeIntermediateTensorInfo(c),h}},dx={kernelName:D.Einsum,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{equation:i}=r,a=t,{allDims:s,summedDims:o,idDims:u}=D.backend_util.decodeEinsumEquation(i,a.length);D.backend_util.checkEinsumDimSizes(s.length,u,a);const{path:l,steps:c}=D.backend_util.getEinsumComputePath(o,u),d=c.length;let h=null,f=s.length;const p=[];for(let e=0;e<d;++e){for(const t of c[e]){const{permutationIndices:e,expandDims:r}=D.backend_util.getEinsumPermutation(f,u[t]);let i;D.backend_util.isIdentityPermutation(e)?i=a[t]:(i=Zy({inputs:{x:a[t]},backend:n,attrs:{perm:e}}),p.push(i));const s=i.shape.slice();for(let e=0;e<r.length;++e)s.splice(r[e],0,1);D.util.arraysEqual(i.shape,s)||(i=Wy({inputs:{x:i},backend:n,attrs:{shape:s}}),p.push(i)),null===h?h=i:(h=jy({inputs:{a:i,b:h},backend:n}),p.push(h))}e<d-1&&(l[e]>=0&&(h=Qy({inputs:{x:h},backend:n,attrs:{axis:l[e]-(s.length-f),keepDims:!1}}),p.push(h)),f--)}for(const e of p)e!==h&&n.disposeIntermediateTensorInfo(e);return h}},hx=My({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),fx={kernelName:D.Elu,backendName:"webgl",kernelFunc:hx},px={kernelName:D.EluGrad,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n}=e,{dy:r,y:i}=t,a=(0,D.env)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Sy("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,i.shape):new _y("return (b >= 1.0) ? a : a * (b + 1.0);",r.shape,i.shape);return n.runWebGLProgram(a,[r,i],r.dtype)}},gx=Ry({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:_m}),mx={kernelName:D.Equal,backendName:"webgl",kernelFunc:gx},yx=My({opSnippet:`\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = ${D.backend_util.ERF_P};\n  float a1 = ${D.backend_util.ERF_A1};\n  float a2 = ${D.backend_util.ERF_A2};\n  float a3 = ${D.backend_util.ERF_A3};\n  float a4 = ${D.backend_util.ERF_A4};\n  float a5 = ${D.backend_util.ERF_A5};\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n`}),vx={kernelName:D.Erf,backendName:"webgl",kernelFunc:yx},bx=My({opSnippet:"if (isnan(x)) return x;\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:Sm,dtype:"float32"}),xx={kernelName:D.Exp,backendName:"webgl",kernelFunc:bx};function wx(e){const{inputs:t,attrs:n,backend:r}=e,{dim:i}=n,{input:a}=t,s=a.shape.length,o=a.shape.slice();let u=i;return i<0&&(D.util.assert(-(s+1)<=i,(()=>`Axis must be in the interval [${-(s+1)}, ${s}]`)),u=s+i+1),o.splice(u,0,1),Wy({inputs:{x:a},backend:r,attrs:{shape:o}})}const kx={kernelName:D.ExpandDims,backendName:"webgl",kernelFunc:wx},_x="return exp(x) - 1.0;",Sx=My({opSnippet:_x,packedOpSnippet:_x,cpuKernelImpl:Cm}),Cx={kernelName:D.Expm1,backendName:"webgl",kernelFunc:Sx};class Ax{constructor(e,t,n){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const i=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,a=n?`${r}.0`:"1.0";let s;if("real"===e)s="return real * expR - imag * expI;";else{if("imag"!==e)throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);s="return real * expI + imag * expR;"}this.userCode=`\n      const float exponentMultiplier = ${i};\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ${s}\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(${r});\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ${r}; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ${a};\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    `}}function Ex(e,t,n){const r=n.texData.get(e.dataId),i=D.util.sizeFromShape(e.shape),a=e.shape[e.shape.length-1],s=Wy({inputs:{x:e},backend:n,attrs:{shape:[i/a,a]}}),o=s.shape,u=new Ax("real",o,t),l=new Ax("imag",o,t),c=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:o},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:o}],d=n.runWebGLProgram(u,c,"float32"),h=n.runWebGLProgram(l,c,"float32"),f=Ey({inputs:{real:d,imag:h},backend:n});n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h);const p=Wy({inputs:{x:f},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(f),p}const Fx={kernelName:D.FFT,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t;return Ex(r,!1,n)}};class Ix{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}}function Dx(e){const{backend:t,attrs:n}=e,{shape:r,value:i}=n;let{dtype:a}=n;if(a=a||D.util.inferDtype(i),"string"===a){const e=D.util.getArrayFromDType(a,D.util.sizeFromShape(r));return e.fill(i),t.makeTensorInfo(r,a,e)}{const e=new Ix(r,i),n=[[i]];return t.runWebGLProgram(e,[],a,n)}}const Nx={kernelName:D.Fill,backendName:"webgl",kernelFunc:Dx};class $x{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ${t} - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ${t}) {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}const Tx={kernelName:D.FlipLeftRight,backendName:"webgl",kernelFunc:({inputs:e,backend:t})=>{const{image:n}=e,r=t,i=new $x(n.shape);return r.runWebGLProgram(i,[n],n.dtype)}},Ox="return floor(x);",Mx=My({opSnippet:Ox,packedOpSnippet:Ox,cpuKernelImpl:Am}),Rx={kernelName:D.Floor,backendName:"webgl",kernelFunc:Mx},Bx=Ry({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),zx={kernelName:D.FloorDiv,backendName:"webgl",kernelFunc:Bx};class Lx{constructor(e){this.variableNames=["A"];const t=Bg(),[n,r]=e;this.outputShape=e,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${n}.0);\n\n        vec4 values = ${t.texture2D}(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    `}}class Px{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=Bg(),[n,r]=e;this.outputShape=e,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(${r}.0, ${n}.0);\n            vec4 values = ${t.texture2D}(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ${t.output} = result;\n      }\n    `}}const jx={kernelName:D.FromPixels,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e;let{pixels:i}=t;const{numChannels:a}=r,s="undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement,o="undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement,[u,l]=s?[i.videoWidth,i.videoHeight]:[i.width,i.height],c=[l,u],d=[l,u,a];(o||s)&&(null==Ux&&(Ux=document.createElement("canvas").getContext("2d")),Ux.canvas.width=u,Ux.canvas.height=l,Ux.drawImage(i,0,0,u,l),i=Ux.canvas);const h=n.makeTensorInfo(c,"int32");n.texData.get(h.dataId).usage=og.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),i);const f=(0,D.env)().getBool("WEBGL_PACK")?new Px(d):new Lx(d),p=n.runWebGLProgram(f,[h],"int32");return n.disposeData(h.dataId),p}};let Ux;const Wx={kernelName:D.FusedConv2D,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a,bias:s,preluActivationWeights:o}=t,{strides:u,pad:l,dataFormat:c,dilations:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=r,g=D.backend_util.convertConv2DDataFormat(c),m=D.backend_util.computeConv2DInfo(i.shape,a.shape,u,d,l,h,!1,g);let y;const v=[];if(1!==m.filterHeight||1!==m.filterWidth||1!==m.dilationHeight||1!==m.dilationWidth||1!==m.strideHeight||1!==m.strideWidth||"SAME"!==m.padInfo.type&&"VALID"!==m.padInfo.type)if((0,D.env)().getBool("WEBGL_CONV_IM2COL")&&1===i.shape[0])y=Ab({x:i,filter:a,convInfo:m,backend:n,bias:s,activation:f,preluActivationWeights:o,leakyreluAlpha:p});else{const e=null!=s,t=null!=o,r="leakyrelu"===f,u=f?By(f,!1):null,l=new kb(m,e,u,t,r),c=[i,a];if(s&&c.push(s),o&&c.push(o),r){const e=n.makeTensorInfo([],"float32",D.util.createScalarValue(p,"float32"));c.push(e),v.push(e)}y=n.runWebGLProgram(l,c,"float32")}else y=Cb({x:i,filter:a,convInfo:m,backend:n,bias:s,activation:f,preluActivationWeights:o,leakyreluAlpha:p});const b=Wy({inputs:{x:y},backend:n,attrs:{shape:m.outShape}});return v.push(y),v.forEach((e=>n.disposeIntermediateTensorInfo(e))),b}},Vx={kernelName:D.FusedDepthwiseConv2D,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:a,bias:s,preluActivationWeights:o}=t,{strides:u,pad:l,dilations:c,dimRoundingMode:d,activation:h,leakyreluAlpha:f}=r,p=[];let g=c;null==g&&(g=[1,1]),D.util.assert(D.backend_util.eitherStridesOrDilationsAreOne(u,g),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${g}'`));const m=D.backend_util.computeConv2DInfo(i.shape,a.shape,u,g,l,d,!0),y=(0,D.env)().getBool("WEBGL_PACK_DEPTHWISECONV")&&m.strideWidth<=2&&m.outChannels/m.inChannels==1,v=h?By(h,y):null,b=[i,a],x=null!=s,w=null!=o,k="leakyrelu"===h;if(x&&b.push(s),w&&b.push(o),k){const e=n.makeTensorInfo([],"float32",D.util.createScalarValue(f,"float32"));b.push(e),p.push(e)}let _;_=y?new tx(m,x,v,w,k):new ex(m,x,v,w,k);const S=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],C=n.runWebGLProgram(_,b,"float32",S);return p.forEach((e=>n.disposeIntermediateTensorInfo(e))),C}};class Gx{constructor(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;const r=Jg(t.length),i=Jg(n.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode=`\n        ${r} strides = ${r}(${this.strides});\n         void main() {\n          ${i} coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < ${this.sliceDim}; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * ${a};\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      `}}const qx={kernelName:D.GatherNd,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{params:r,indices:i}=t,a=i.shape,s=a[a.length-1],o=D.util.sizeFromShape(r.shape),[u,l,c,d]=D.backend_util.prepareAndValidate(r,i),h=Wy({inputs:{x:i},backend:n,attrs:{shape:[l,s]}}),f=Wy({inputs:{x:r},backend:n,attrs:{shape:[D.util.sizeFromShape(r.shape)/c,c]}});if(n.shouldExecuteOnCPU([r,i])||"string"===r.dtype){const e=n.readSync(i.dataId),t=n.bufferSync(r),a=Em(e,t,r.dtype,l,s,c,d,r.shape,o);return n.makeTensorInfo(u,r.dtype,a.values)}const p=new Gx(s,d,[l,c]),g=n.runWebGLProgram(p,[f,h],f.dtype),m=Wy({inputs:{x:g},backend:n,attrs:{shape:u}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),m}};class Hx{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const n=Jg(this.rank),r=function(e,t){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let t=0;t<e.length;t++)2===t?r.push("index"):r.push(`${n[t]}`);return r.join()}(e);this.userCode=`\n      void main() {\n        ${n} resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;\n        setOutput(inBounds * getA(${r}));\n      }\n    `}}function Xx(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,indices:a}=t,{axis:s,batchDims:o}=r,u=D.util.parseAxisParam(s,i.shape)[0];if((0,D.env)().get("DEBUG")){const e=n.readSync(a.dataId),t=i.shape[u];for(let n=0;n<e.length;++n){const r=e[n];D.util.assert(r<=t-1&&r>=0,(()=>`GatherV2: the index value ${r} is not in [0, ${t-1}]`))}}const l=D.backend_util.segment_util.collectGatherOpShapeInfo(i,a,u,o),c=D.util.sizeFromShape(a.shape),d=[],h=Wy({inputs:{x:i},backend:n,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),f=Wy({inputs:{x:a},backend:n,attrs:{shape:[l.batchSize,c/l.batchSize]}});d.push(h),d.push(f);const p=[l.batchSize,l.outerSize,c/l.batchSize,l.sliceSize];if(n.shouldExecuteOnCPU([i,a])||"string"===i.dtype){const e=n.bufferSync(f),t=n.bufferSync(h),r=Fm(t,e,p);return d.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(l.outputShape,r.dtype,r.values)}const g=new Hx(h.shape,p),m=n.runWebGLProgram(g,[h,f],h.dtype);d.push(m);const y=Wy({inputs:{x:m},backend:n,attrs:{shape:l.outputShape}});return d.forEach((e=>n.disposeIntermediateTensorInfo(e))),y}const Kx={kernelName:D.GatherV2,backendName:"webgl",kernelFunc:Xx},Yx=Ry({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:Im,dtype:"bool"}),Qx={kernelName:D.Greater,backendName:"webgl",kernelFunc:Yx},Jx=Ry({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:Dm}),Zx={kernelName:D.GreaterEqual,backendName:"webgl",kernelFunc:Jx},ew={kernelName:D.IFFT,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t;return Ex(r,!0,n)}},tw=My({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),nw={kernelName:D.IsFinite,backendName:"webgl",kernelFunc:tw},rw=My({opSnippet:"return float(isinf(x));",dtype:"bool"}),iw={kernelName:D.IsInf,backendName:"webgl",kernelFunc:rw},aw=My({opSnippet:"return float(isnan(x));",dtype:"bool"}),sw={kernelName:D.IsNan,backendName:"webgl",kernelFunc:aw},ow=Ry({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:Nm,dtype:"bool"}),uw={kernelName:D.Less,backendName:"webgl",kernelFunc:ow},lw=Ry({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:$m,dtype:"bool"}),cw={kernelName:D.LessEqual,backendName:"webgl",kernelFunc:lw},dw={kernelName:D.LinSpace,backendName:"webgl",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:r,stop:i,num:a}=n,s=Tm(r,i,a);return t.makeTensorInfo([s.length],"float32",s)}},hw=My({opSnippet:"if (isnan(x)) return x;\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:Om}),fw={kernelName:D.Log,backendName:"webgl",kernelFunc:hw},pw=My({opSnippet:"if (isnan(x)) return x;\n  return log(1.0 + x);\n"}),gw={kernelName:D.Log1p,backendName:"webgl",kernelFunc:pw},mw=Ry({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),yw={kernelName:D.LogicalAnd,backendName:"webgl",kernelFunc:mw},vw=My({opSnippet:"return float(!(x >= 1.0));"}),bw={kernelName:D.LogicalNot,backendName:"webgl",kernelFunc:vw},xw=Ry({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),ww={kernelName:D.LogicalOr,backendName:"webgl",kernelFunc:xw};class kw{constructor(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[];const a=t,s=e[3]-1;let o;this.outputShape=e;const u=`float(${n}) + float(${r}) * sum`;o=.5===i?`inversesqrt(${u})`:1===i?`1.0/(${u})`:`exp(log(${u}) * float(-${i}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -${a}; j <= ${a}; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ${s}) {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ${o};\n        setOutput(val);\n      }\n    `}}class _w{constructor(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const a=t,s=e[3]-1;let o;this.outputShape=e;const u=`float(${n}) + float(${r}) * sum`;o=.5===i?`inversesqrt(${u})`:1===i?`1.0/(${u})`:`exp(log(${u}) * float(-${i}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ${this.outputShape[3]};\n        bool hasNextRow = c < ${this.outputShape[2]};\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ${a};\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ${a}; j <= ${a}; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${s}));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ${o};\n        setOutput(result);\n      }\n    `}}const Sw={kernelName:D.LRN,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{depthRadius:a,bias:s,alpha:o,beta:u}=r,l=(0,D.env)().getBool("WEBGL_PACK_NORMALIZATION")?new _w(i.shape,a,s,o,u):new kw(i.shape,a,s,o,u);return n.runWebGLProgram(l,[i],i.dtype)}};class Cw{constructor(e,t,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=i,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ${this.depth}; ++d) {\n          int depthBegin = int(max(0.0, float(d - ${t})));\n          int depthEnd = int(min(float(${this.depth}),\n              float(d + ${t} + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ${this.depth};\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(${r}) * norm + float(${n});\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(${r})\n                * float(${i})\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ${i});\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    `}}const Aw={kernelName:D.LRNGrad,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i,y:a,dy:s}=t,{depthRadius:o,bias:u,alpha:l,beta:c}=r,d=new Cw(i.shape,o,u,l,c);return n.runWebGLProgram(d,[i,a,s],i.dtype)}};function Ew(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reductionIndices:a,keepDims:s}=r,o=i.shape.length,u=D.util.parseAxisParam(a,i.shape);let l=u;const c=D.backend_util.getAxesPermutation(l,o),d=null!=c,h=n.shouldExecuteOnCPU([i]);let f=i;if(d){if(h){const e=n.texData.get(f.dataId).values,t=new Array(o);for(let e=0;e<t.length;e++)t[e]=i.shape[c[e]];const r=iy(e,i.shape,i.dtype,c,t);f=n.makeTensorInfo(t,i.dtype),n.texData.get(f.dataId).values=r}else f=Yy(i,c,n);l=D.backend_util.getInnerMostAxes(l.length,o)}D.backend_util.assertAxesAreInnerMostDims("max",l,o);const[p,g]=D.backend_util.computeOutAndReduceShapes(f.shape,l);let m,y=p;if(s&&(y=D.backend_util.expandShapeToKeepDim(p,u)),h){const e=n.texData.get(f.dataId).values,t=Mm(e,D.util.sizeFromShape(g),y,i.dtype);m=n.makeTensorInfo(y,i.dtype),n.texData.get(m.dataId).values=t}else m=function(e,t,n,r){const i=D.util.sizeFromShape(t),a=Wy({inputs:{x:e},attrs:{shape:[D.util.sizeFromShape(e.shape)/i,i]},backend:r}),s=Hy(a,e.dtype,"max",r),o=Wy({inputs:{x:s},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(s),o}(f,g,y,n);return d&&n.disposeIntermediateTensorInfo(f),m}const Fw={kernelName:D.Max,backendName:"webgl",kernelFunc:Ew},Iw=Ry({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:Rm}),Dw={kernelName:D.Maximum,backendName:"webgl",kernelFunc:Iw},Nw={kernelName:D.MaxPool,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;Mg(i,"maxPool");const{filterSize:a,strides:s,pad:o,dimRoundingMode:u}=r;D.util.assert(D.backend_util.eitherStridesOrDilationsAreOne(s,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '1'`));const l=D.backend_util.computePool2DInfo(i.shape,a,s,1,o,u);if(1===l.filterWidth&&1===l.filterHeight&&D.util.arraysEqual(l.inShape,l.outShape))return Cy({inputs:{x:i},backend:n});const c=new Ov(l,"max",!1);return n.runWebGLProgram(c,[i],i.dtype)}},$w={kernelName:D.MaxPool3D,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:a,strides:s,pad:o,dataFormat:u,dimRoundingMode:l}=r,c=D.backend_util.computePool3DInfo(i.shape,a,s,[1,1,1],o,l,u),d=new Mv(c,"max",!1);return n.runWebGLProgram(d,[i],i.dtype)}};class Tw{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,a=e.effectiveFilterWidth,s=i-1-e.padInfo.top,o=a-1-e.padInfo.left,u=i*a-1;this.userCode=`\n      const ivec2 pads = ivec2(${s}, ${o});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${i};\n          wR += ${r}) {\n          float dyR = float(dyRCorner + wR) / ${t}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${a}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${n}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ${a} + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Ow{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,s=e.dilationWidth,o=e.effectiveFilterDepth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=o-1-e.padInfo.front,d=u-1-e.padInfo.top,h=l-1-e.padInfo.left,f=o*u*l-1;this.userCode=`\n      const ivec3 pads = ivec3(${c}, ${d}, ${h});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${o};\n           wD += ${i}) {\n          float dyD = float(dyDCorner + wD) / ${t}.0;\n\n          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${u};\n              wR += ${a}) {\n            float dyR = float(dyRCorner + wR) / ${n}.0;\n\n            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${l};\n                wC += ${s}) {\n              float dyC = float(dyCCorner + wC) / ${r}.0;\n\n              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ${f} -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ${u} * ${l} +\n                  wR * ${l} + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}const Mw={kernelName:D.MaxPool3DGrad,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a}=t,s=a,{filterSize:o,strides:u,pad:l,dimRoundingMode:c}=r,d=D.backend_util.computePool3DInfo(s.shape,o,u,[1,1,1],l,c),h=new Mv(d,"max",!0),f=n.runWebGLProgram(h,[s],s.dtype),p=new Ow(d),g=n.runWebGLProgram(p,[i,f],s.dtype);return n.disposeIntermediateTensorInfo(f),g}},Rw={kernelName:D.MaxPoolGrad,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:a,output:s}=t,o=a;Mg([a,s],"maxPoolGrad");const{filterSize:u,strides:l,pad:c,dimRoundingMode:d}=r,h=D.backend_util.computePool2DInfo(o.shape,u,l,1,c,d),f=new Ov(h,"max",!0),p=n.runWebGLProgram(f,[o],o.dtype),g=new Tw(h),m=n.runWebGLProgram(g,[i,p],o.dtype);return n.disposeIntermediateTensorInfo(p),m}},Bw={kernelName:D.MaxPoolWithArgmax,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:r}=e,{filterSize:i,strides:a,pad:s,includeBatchInIndex:o}=t,u=n;D.util.assert(4===r.shape.length,(()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`));const l=[1,1];D.util.assert(D.backend_util.eitherStridesOrDilationsAreOne(a,l),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${a} and dilations '${l}'`));const c=D.backend_util.computePool2DInfo(r.shape,i,a,l,s),[d,h]=function(e,t,n,r){let i=new Ov(n,"max",!1);const a=r.runWebGLProgram(i,[e],"float32");return i=new Ov(n,"max",!0,!0,t),[a,r.runWebGLProgram(i,[e],"float32")]}(r,o,c,u);return[d,h]}},zw={kernelName:D.Mean,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:r}=e,{keepDims:i,axis:a}=t,s=n,o=r.shape.length,u=D.util.parseAxisParam(a,r.shape);let l=u;const c=D.backend_util.getAxesPermutation(l,o),d=null!=c,h=s.shouldExecuteOnCPU([r]),f=[];let p=r;if(d){if(h){const e=s.texData.get(p.dataId).values,t=new Array(o);for(let e=0;e<t.length;e++)t[e]=r.shape[c[e]];const n=iy(e,r.shape,r.dtype,c,t);p=s.makeTensorInfo(t,r.dtype),s.texData.get(p.dataId).values=n}else p=Yy(r,c,s);f.push(p),l=D.backend_util.getInnerMostAxes(l.length,o)}D.backend_util.assertAxesAreInnerMostDims("sum",l,o);const[g,m]=D.backend_util.computeOutAndReduceShapes(p.shape,l);let y=g;i&&(y=D.backend_util.expandShapeToKeepDim(g,u));const v=function(e,t,n,r){const i=D.util.sizeFromShape(t),a=Wy({inputs:{x:e},attrs:{shape:[D.util.sizeFromShape(e.shape)/i,i]},backend:r}),s=Hy(a,"float32","mean",r),o=Wy({inputs:{x:s},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(s),o}(p,m,y,s);for(const e of f)s.disposeIntermediateTensorInfo(e);return v}},Lw={kernelName:D.Min,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:s}=r,o=i.shape.length,u=D.util.parseAxisParam(a,i.shape);let l=u;const c=D.backend_util.getAxesPermutation(l,o);let d=i;null!=c&&(d=Zy({inputs:{x:i},backend:n,attrs:{perm:c}}),l=D.backend_util.getInnerMostAxes(l.length,i.shape.length)),D.backend_util.assertAxesAreInnerMostDims("min",l,o);const[h,f]=D.backend_util.computeOutAndReduceShapes(d.shape,l),p=Wy({inputs:{x:d},backend:n,attrs:{shape:[-1,D.util.sizeFromShape(f)]}}),g=Hy(p,p.dtype,"min",n);let m;return m=Wy(s?{inputs:{x:g},backend:n,attrs:{shape:D.backend_util.expandShapeToKeepDim(h,u)}}:{inputs:{x:g},backend:n,attrs:{shape:h}}),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),null!=c&&n.disposeIntermediateTensorInfo(d),m}},Pw=Ry({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:Bm}),jw={kernelName:D.Minimum,backendName:"webgl",kernelFunc:Pw};class Uw{constructor(e,t,n){this.variableNames=["x"],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const r=e.length,i=Jg(r),a=t.map((e=>e[0])).join(","),s=t.map(((t,n)=>t[0]+e[n])).join(","),o=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),u="reflect"===n?0:1;this.userCode=1!==r?`\n      ${i} start = ${i}(${a});\n      ${i} end = ${i}(${s});\n\n      void main() {\n        ${i} outC = getOutputCoords();\n        for (int i = 0; i < ${r}; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ${u};\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};\n          }\n        }\n        ${i} coords = outC - start;\n        setOutput(getX(${o}));\n      }\n    `:`\n        int start = ${a};\n        int end = ${s};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ${u};\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ${u};\n          }\n          setOutput(getX(outC - start));\n        }\n      `}}class Ww{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const r=e.length,i=Jg(r),a=t.map((e=>e[0])).join(","),s=t.map(((t,n)=>t[0]+e[n])).join(","),o=oy("rc",r),u=oy("source",r),l=`${o[r-1]} < ${this.outputShape[r-1]}`,c=1===r?"source":`vec2(${u.slice(-2).join()})`,d="reflect"===n?0:1;let h="";if(1===r){const e=`\n        ${i} source = rc;\n        if (source < start) {\n          source = start * 2 - source - ${d};\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ${d};\n        }\n        source -= start;\n      `;h=`\n        ${i} rc = outputLoc;\n        ${e}\n        result[0] = getChannel(getX(${u.join()}), ${c});\n        ${o[r-1]} += 1;\n        if(${l}) {\n          ${e}\n          result[1] = getChannel(getX(${u.join()}), ${c});\n        }\n      `}else{const e=`\n        ${i} source = rc;\n        ${i} lt = ${i}(lessThan(source, start));\n        ${i} gte = ${i}(greaterThanEqual(source, end));\n        ${i} orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ${d}) +\n                gte * ((end - 1) * 2 - source + ${d});\n        source -= start;\n      `;h=`\n        ${i} rc = outputLoc;\n        ${e}\n        result[0] = getChannel(getX(${u.join()}), ${c});\n        ${o[r-1]} += 1;\n        if(${l}) {\n          ${e}\n          result[1] = getChannel(getX(${u.join()}), ${c});\n        }\n        rc = outputLoc;\n        ${o[r-2]} += 1;\n        if(${o[r-2]} < ${this.outputShape[r-2]}) {\n          ${e}\n          result[2] = getChannel(getX(${u.join()}), ${c});\n          ${o[r-1]} += 1;\n          if(${l}) {\n            ${e}\n            result[3] = getChannel(getX(${u.join()}), ${c});\n          }\n        }\n      `}this.userCode=`\n      const ${i} start = ${i}(${a});\n      const ${i} end = ${i}(${s});\n\n      void main() {\n        ${i} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${h}\n        setOutput(result);\n      }\n    `}}const Vw={kernelName:D.MirrorPad,backendName:"webgl",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r}=e,{paddings:i,mode:a}=n,s=(0,D.env)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ww(r.shape,i,a):new Uw(r.shape,i,a);return t.runWebGLProgram(s,[r],r.dtype)}},Gw=Ry({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),qw={kernelName:D.Mod,backendName:"webgl",kernelFunc:Gw};class Hw{constructor(e,t,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ${t-1}; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(${t-1}));\n      }\n    `}}const Xw=Ry({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),Kw={kernelName:D.RealDiv,backendName:"webgl",kernelFunc:Xw},Yw="return a - b;",Qw=Ry({opSnippet:Yw,packedOpSnippet:Yw,supportsComplex:!0,cpuKernelImpl:ty}),Jw={kernelName:D.Sub,backendName:"webgl",kernelFunc:Qw};function Zw(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{dim:a}=r,s=D.util.parseAxisParam([a],i.shape),o=Ew({inputs:{x:i},backend:n,attrs:{reductionIndices:s,keepDims:!1}}),u=D.backend_util.expandShapeToKeepDim(o.shape,s),l=Wy({inputs:{x:o},backend:n,attrs:{shape:u}}),c=Qw({inputs:{a:i,b:l},backend:n}),d=bx({inputs:{x:c},backend:n}),h=Qy({inputs:{x:d},backend:n,attrs:{axis:s,keepDims:!1}}),f=Wy({inputs:{x:h},backend:n,attrs:{shape:u}}),p=Xw({inputs:{a:d,b:f},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),p}const ek={kernelName:D.Softmax,backendName:"webgl",kernelFunc:Zw},tk={kernelName:D.Multinomial,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{numSamples:a,seed:s,normalized:o}=r,u=o?i:Zw({inputs:{logits:i},backend:n,attrs:{dim:i.shape.length-1}}),l=u.shape[0],c=u.shape[1],d=new Hw(l,c,a),h=[[s]],f=n.runWebGLProgram(d,[u],"int32",h);return o||n.disposeIntermediateTensorInfo(u),f}},nk={kernelName:D.Neg,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])){const e=n.texData.get(r.dataId),[t,i]=Lm(e.values,r.shape,r.dtype);return n.makeTensorInfo(i,r.dtype,t)}let i;return i=(0,D.env)().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new yy(r.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new py(r.shape,"if (isnan(x)) return x;\n  return -x;\n"),n.runWebGLProgram(i,[r],r.dtype)}},rk=D.kernel_impls.nonMaxSuppressionV3Impl,ik={kernelName:D.NonMaxSuppressionV3,backendName:"webgl",kernelFunc:function(e){D.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:a}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:u}=r,l=n.readSync(i.dataId),c=n.readSync(a.dataId),{selectedIndices:d}=rk(l,c,s,o,u);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}},ak=D.kernel_impls.nonMaxSuppressionV4Impl,sk={kernelName:D.NonMaxSuppressionV4,backendName:"webgl",kernelFunc:function(e){D.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:a}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:u,padToMaxOutputSize:l}=r,c=n.readSync(i.dataId),d=n.readSync(a.dataId),{selectedIndices:h,validOutputs:f}=ak(c,d,s,o,u,l);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}},ok=D.kernel_impls.nonMaxSuppressionV5Impl,uk={kernelName:D.NonMaxSuppressionV5,backendName:"webgl",kernelFunc:function(e){D.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:a}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:u,softNmsSigma:l}=r,c=n.readSync(i.dataId),d=n.readSync(a.dataId),h=s,f=o,p=u,g=l,{selectedIndices:m,selectedScores:y}=ok(c,d,h,f,p,g);return[n.makeTensorInfo([m.length],"int32",new Int32Array(m)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}};class lk{constructor(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(${r}), float(${n}),\n                      float(index == coords.y)));\n      }\n    `}}const ck={kernelName:D.OneHot,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{indices:i}=t,{depth:a,onValue:s,offValue:o}=r,u=D.util.sizeFromShape(i.shape),l=new lk(u,a,s,o),c=Wy({inputs:{x:i},backend:n,attrs:{shape:[u]}}),d=n.runWebGLProgram(l,[c],i.dtype);n.disposeIntermediateTensorInfo(c);const h=Wy({inputs:{x:d},backend:n,attrs:{shape:[...i.shape,a]}});return n.disposeIntermediateTensorInfo(d),h}};function dk(e){const{inputs:t,backend:n}=e,{x:r}=t;if("complex64"===r.dtype){const e=nb({inputs:{input:r},backend:n}),t=dk({inputs:{x:e},backend:n}),i=yb({inputs:{input:r},backend:n}),a=dk({inputs:{x:i},backend:n}),s=Ey({inputs:{real:t,imag:a},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),s}return Dx({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}const hk={kernelName:D.ZerosLike,backendName:"webgl",kernelFunc:dk},fk={kernelName:D.OnesLike,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:r}=t,{x:i}=n;if("string"===i.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===i.dtype){const t=nb({inputs:{input:i},backend:r}),n=e({inputs:{x:t},backend:r}),a=yb({inputs:{input:i},backend:r}),s=dk({inputs:{x:a},backend:r}),o=Ey({inputs:{real:n,imag:s},backend:r});return r.disposeIntermediateTensorInfo(t),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(s),o}return Dx({attrs:{shape:i.shape,dtype:i.dtype,value:1},backend:r})}},pk={kernelName:D.Pack,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r;if(1===t.length)return wx({inputs:{input:t[0]},backend:n,attrs:{dim:i}});const a=t[0].shape,s=t[0].dtype;t.forEach((e=>{D.util.assertShapesMatch(a,e.shape,"All tensors passed to stack must have matching shapes"),D.util.assert(s===e.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const o=[],u=xb({inputs:t.map((e=>{const t=wx({inputs:{input:e},backend:n,attrs:{dim:i}});return o.push(t),t})),backend:n,attrs:{axis:i}});return o.forEach((e=>n.disposeIntermediateTensorInfo(e))),u}};class gk{constructor(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const r=e.length,i=Jg(r),a=t.map((e=>e[0])).join(","),s=t.map(((t,n)=>t[0]+e[n])).join(","),o=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?`\n      ${i} start = ${i}(${a});\n      ${i} end = ${i}(${s});\n\n      void main() {\n        ${i} outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ${i} coords = outC - start;\n          setOutput(getX(${o}));\n        }\n      }\n    `:`\n        int start = ${a};\n        int end = ${s};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      `}}class mk{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const r=e.length,i=Jg(r),a=t.map((e=>e[0])).join(","),s=t.map(((t,n)=>t[0]+e[n])).join(","),o=oy("rc",r),u=oy("source",r),l=`${o[r-1]} < ${this.outputShape[r-1]}`,c=1===r?"source":`vec2(${u.slice(-2).join()})`,d=[`${i} rc = outputLoc;`,`${o[r-1]} += 1;\n       if(${l}) {\n      `,1===r?"":`}\n       rc = outputLoc;\n       ${o[r-2]} += 1;\n       if(${o[r-2]} < ${this.outputShape[r-2]}) {`,1===r?"":`  ${o[r-1]} += 1;\n         if(${l}) {`],h=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let f="";for(let e=0,t=1===r?2:4;e<t;e++)f+=`\n        ${d[e]}\n        if (${h}) {\n          result[${e}] = float(value);\n        } else {\n          ${i} source = rc - start;\n          result[${e}] = getChannel(getX(${u.join()}), ${c});\n        }\n      `;f+=1===r?"} ":"}}",this.userCode=`\n      const ${i} start = ${i}(${a});\n      const ${i} end = ${i}(${s});\n\n      void main() {\n        ${i} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${f}\n        setOutput(result);\n      }\n    `}}const yk=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{paddings:a,constantValue:s}=r;if(0===D.util.sizeFromShape(i.shape)){const e=a.map(((e,t)=>e[0]+i.shape[t]+e[1]));return Dx({backend:n,attrs:{shape:e,value:s,dtype:i.dtype}})}const o=(0,D.env)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new mk(i.shape,a,s):new gk(i.shape,a,s),u=[[s]];return n.runWebGLProgram(o,[i],i.dtype,u)},vk={kernelName:D.PadV2,backendName:"webgl",kernelFunc:yk},bk=Ry({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),xk={kernelName:D.Pow,backendName:"webgl",kernelFunc:bk},wk={kernelName:D.Prod,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:a,keepDims:s}=r,o=i.shape.length,u=[],l=D.util.parseAxisParam(a,i.shape);let c=l;const d=D.backend_util.getAxesPermutation(c,o);let h,f=i;if(null!=d&&(f=Zy({inputs:{x:i},backend:n,attrs:{perm:d}}),c=D.backend_util.getInnerMostAxes(c.length,o),u.push(f)),D.backend_util.assertAxesAreInnerMostDims("prod",c,o),n.shouldExecuteOnCPU([f])){const e=n.texData.get(f.dataId).values,{outVals:t,outShape:r,outDtype:i}=jm(f.shape,f.dtype,e,c);h=n.makeTensorInfo(r,i,t)}else{const[e,t]=D.backend_util.computeOutAndReduceShapes(f.shape,c),r=D.util.sizeFromShape(t),a=Wy({inputs:{x:f},backend:n,attrs:{shape:[-1,r]}}),s=Hy(a,(0,D.sumOutType)(i.dtype),"prod",n);h=Wy({inputs:{x:s},backend:n,attrs:{shape:e}}),u.push(a),u.push(s)}if(s){u.push(h);const e=D.backend_util.expandShapeToKeepDim(h.shape,l);h=Wy({inputs:{x:h},backend:n,attrs:{shape:e}})}return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),h}},kk=e=>{const{backend:t,attrs:n}=e,{start:r,stop:i,step:a,dtype:s}=n,o=Um(r,i,a,s);return t.makeTensorInfo([o.length],s,o)},_k={kernelName:D.Range,backendName:"webgl",kernelFunc:kk},Sk=My({opSnippet:"return 1.0 / x;"}),Ck={kernelName:D.Reciprocal,backendName:"webgl",kernelFunc:Sk},Ak=My({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),Ek={kernelName:D.Relu,backendName:"webgl",kernelFunc:Ak},Fk=My({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),Ik={kernelName:D.Relu6,backendName:"webgl",kernelFunc:Fk};class Dk{constructor(e,t,n,r,i){this.variableNames=["A"],this.outputShape=[];const[a,s,o,u]=e;this.outputShape=[a,t,n,u];const l=[r&&t>1?s-1:s,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];let d;d=i?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${l[0]/c[0]},\n          ${l[1]/c[1]});\n      const vec2 inputShapeRC = vec2(${s}.0, ${o}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${d};\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    `}}class Nk{constructor(e,t,n,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[a,s,o,u]=e;this.outputShape=[a,t,n,u];const l=[r&&t>1?s-1:s,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];let d;d=i?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${l[0]/c[0]},\n          ${l[1]/c[1]},\n          ${l[1]/c[1]});\n      const vec3 inputShapeRC = vec3(${s}.0, ${o}.0,\n                                     ${o}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${d};\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${u-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    `}}const $k={kernelName:D.ResizeBilinear,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:a,halfPixelCenters:s,size:o}=r,[u,l]=o,c=(0,D.env)().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Nk(i.shape,u,l,a,s):new Dk(i.shape,u,l,a,s);return n.runWebGLProgram(c,[i],"float32")}};class Tk{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,a,s]=e,o=[n&&a>1?r-1:r,n&&s>1?i-1:i],u=[n&&a>1?a-1:a,n&&s>1?s-1:s],l=o[0]/u[0],c=o[1]/u[1],d=1/l,h=1/c,f=2*Math.ceil(d)+2,p=2*Math.ceil(h)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${l});\n        const float widthScale = float(${c});\n\n        const float invHeightScale = float(${d});\n        const float invWidthScale = float(${h});\n\n        const int winHeight = int(${f});\n        const int winWidth = int(${p});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${a}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${s}) {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}const Ok={kernelName:D.ResizeBilinearGrad,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:a}=t,{alignCorners:s}=r,o=new Tk(a.shape,i.shape,s);return n.runWebGLProgram(o,[a],a.dtype)}};class Mk{constructor(e,t,n,r,i){this.variableNames=["A"],this.outputShape=[];const[a,s,o,u]=e;this.outputShape=[a,t,n,u];const l=[r&&t>1?s-1:s,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n],d=r?"0.5":"0.0";let h;h=i?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${l[0]/c[0]},\n          ${l[1]/c[1]});\n      const vec2 inputShapeRC = vec2(${s}.0, ${o}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${h};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    `}}class Rk{constructor(e,t,n,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[a,s,o,u]=e;this.outputShape=[a,t,n,u];const l=[r&&t>1?s-1:s,r&&n>1?o-1:o],c=[r&&t>1?t-1:t,r&&n>1?n-1:n],d=r?"0.5":"0.0";let h;h=i?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${l[0]/c[0]},\n          ${l[1]/c[1]},\n          ${l[1]/c[1]});\n      const vec3 inputShapeRC = vec3(${s}.0, ${o}.0,\n                                     ${o}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${h};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${u-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    `}}const Bk={kernelName:D.ResizeNearestNeighbor,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:a,halfPixelCenters:s,size:o}=r,[u,l]=o,c=(0,D.env)().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Rk(i.shape,u,l,a,s):new Mk(i.shape,u,l,a,s);return n.runWebGLProgram(c,[i],i.dtype)}};class zk{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,a,s]=e,o=[n&&a>1?r-1:r,n&&s>1?i-1:i],u=[n&&a>1?a-1:a,n&&s>1?s-1:s],l=o[0]/u[0],c=o[1]/u[1],d=1/l,h=1/c,f=2*Math.ceil(d)+2,p=2*Math.ceil(h)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${l});\n        const float widthScale = float(${c});\n\n        const float invHeightScale = float(${d});\n        const float invWidthScale = float(${h});\n\n        const int winHeight = int(${f});\n        const int winWidth = int(${p});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${a}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${s}) {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(${o[0]}) *\n                (float(dyR) / float(${u[0]}));\n\n            float sourceFracCol =\n                float(${o[1]}) *\n                  (float(dyC) / float(${u[1]}));\n\n            int sourceNearestRow = int(min(\n                float(int(${r}) - 1),\n                ${n} ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(${i}) - 1),\n                ${n} ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}const Lk={kernelName:D.ResizeNearestNeighborGrad,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:a}=t,{alignCorners:s}=r,o=new zk(a.shape,i.shape,s);return n.runWebGLProgram(o,[a],a.dtype)}};class Pk{constructor(e,t){this.variableNames=["x"];const n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=e,1===n)return void(this.userCode=`\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(${e[0]} - coord - 1));\n        }\n      `);const r=e.map(((n,r)=>(n=>-1!==t.indexOf(n)&&1!==e[n]?`${e[n]} - coords[${n}] - 1`:`coords[${n}]`)(r))).join(","),i=Jg(n);this.userCode=`\n      void main() {\n        ${i} coords = getOutputCoords();\n        setOutput(getX(${r}));\n      }\n    `}}class jk{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=e;const r=oy("rc",n),i=`${r[n-1]} + 1 < ${this.outputShape[n-1]}`,a=`${r[n-2]} + 1 < ${this.outputShape[n-2]}`,s=Jg(n);function o(n){const r=e.map(((r,i)=>function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?`${e[n]} - ${r[n]} - 1`:`${r[n]}`}(i,n)));return`getChannel(getX(${r.join(",")}), vec2(${r.slice(-2).join(",")}))`}this.userCode=1===n?`\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(${e[0]} - rc - 1),\n            ${e[0]} - rc - 1);\n          if(${i}){\n              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),\n                ${e[0]} - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      `:`\n        void main() {\n          ${s} rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ${function(e){return o(e)}(r.slice())};\n          if(${i}){\n            result.g = ${function(e){return e[n-1]="("+e[n-1]+" + 1)",o(e)}(r.slice())};\n          }\n          if(${a}) {\n            result.b = ${function(e){return e[n-2]="("+e[n-2]+" + 1)",o(e)}(r.slice())};\n            if(${i}) {\n              result.a = ${function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",o(e)}(r.slice())};\n            }\n          }\n          setOutput(result);\n        }\n    `}}const Uk={kernelName:D.Reverse,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dims:a}=r,s=i.shape.length,o=D.util.parseAxisParam(a,i.shape);if(0===s)return Cy({inputs:{x:i},backend:n});const u=(0,D.env)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new jk(i.shape,o):new Pk(i.shape,o);return n.runWebGLProgram(u,[i],i.dtype)}};class Wk{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const n=e[1],r=e[2];this.outputShape=e;let i="";i="number"==typeof t?`float outputValue = ${t.toFixed(2)};`:`\n        vec3 fill = vec3(${t.join(",")});\n        float outputValue = fill[coords[3]];`,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ${i}\n          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${n}) {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}const Vk={kernelName:D.RotateWithOffset,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:r}=e,{radians:i,fillValue:a,center:s}=t,o=n,u=new Wk(r.shape,a),[l,c]=D.backend_util.getImageCenter(s,r.shape[1],r.shape[2]),d=[[l,c,Math.sin(i),Math.cos(i)]];return o.runWebGLProgram(u,[r],r.dtype,d)}},Gk=My({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),qk={kernelName:D.Round,backendName:"webgl",kernelFunc:Gk},Hk=My({opSnippet:"return inversesqrt(x);",cpuKernelImpl:Wm}),Xk={kernelName:D.Rsqrt,backendName:"webgl",kernelFunc:Hk};class Kk{constructor(e,t,n,r,i,a,s=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;const o=Jg(i.length),u=Jg(a.length);let l="";1===n?l="i":2===n&&(l="i, j");const c=`getIndices(${l})`;let d="";1===r?d="i":2===r&&(d="i, coords[1]");const h=`getUpdates(${d})`,f=t>1?"strides[j]":"strides";this.userCode=`\n        ${o} strides = ${o}(${i});\n\n        void main() {\n          ${u} coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ${e}; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ${t}; j++) {\n              int index = round(${c});\n              flattenedIndex += index * ${f};\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ${h};\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      `}}const Yk={kernelName:D.ScatterNd,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{indices:i,updates:a}=t,{shape:s}=r,{sliceRank:o,numUpdates:u,sliceSize:l,strides:c,outputSize:d}=D.backend_util.calculateShapes(a,i,s),h=[d/l,l];if(0===d)return n.makeTensorInfo(s,i.dtype);const f=Wy({inputs:{x:i},backend:n,attrs:{shape:[u,o]}}),p=Wy({inputs:{x:a},backend:n,attrs:{shape:[u,l]}}),g=n.makeTensorInfo([],"float32",new Float32Array([0])),m=new Kk(u,o,f.shape.length,p.shape.length,c,h),y=n.runWebGLProgram(m,[p,f,g],p.dtype),v=Wy({inputs:{x:y},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(g),v}};class Qk{constructor(e,t,n){let r,i;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error(`Where for rank ${n} is not yet supported`);if(1===n)i="resRC",r="resRC";else{const n=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[];for(let r=0;r<t.length;r++)s.push(`${n[r]}`),r<e&&a.push(`${n[r]}`);r=a.join(),i=s.join()}const a=Jg(n);this.userCode=`\n      void main() {\n        ${a} resRC = getOutputCoords();\n        float cVal = getC(${r});\n        if (cVal >= 1.0) {\n          setOutput(getA(${i}));\n        } else {\n          setOutput(getB(${i}));\n        }\n      }\n    `}}const Jk={kernelName:D.Select,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{condition:r,t:i,e:a}=t,s=new Qk(r.shape.length,i.shape,i.shape.length);return n.runWebGLProgram(s,[r,i,a],(0,D.upcastType)(i.dtype,a.dtype))}},Zk=My({opSnippet:`\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ${D.backend_util.SELU_SCALEALPHA};\n  float scale = ${D.backend_util.SELU_SCALE};\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n`}),e_={kernelName:D.Selu,backendName:"webgl",kernelFunc:Zk},t_=My({opSnippet:"if (isnan(x)) return x;\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:Vm}),n_={kernelName:D.Sigmoid,backendName:"webgl",kernelFunc:t_},r_=My({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),i_={kernelName:D.Sign,backendName:"webgl",kernelFunc:r_},a_=My({opSnippet:"if (isnan(x)) return x;\n  return sin(x);\n"}),s_={kernelName:D.Sin,backendName:"webgl",kernelFunc:a_},o_=My({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),u_={kernelName:D.Sinh,backendName:"webgl",kernelFunc:o_},l_=My({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),c_={kernelName:D.Softplus,backendName:"webgl",kernelFunc:l_},d_={kernelName:D.SpaceToBatchND,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:a,paddings:s}=r;D.util.assert(i.shape.length<=4,(()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"));const o=a.reduce(((e,t)=>e*t)),u=[[0,0]];u.push(...s);for(let e=1+a.length;e<i.shape.length;++e)u.push([0,0]);const l=[],c=yk({inputs:{x:i},backend:n,attrs:{paddings:u,constantValue:0}}),d=D.backend_util.getReshaped(c.shape,a,o,!1),h=D.backend_util.getPermuted(d.length,a.length,!1),f=D.backend_util.getReshapedPermuted(c.shape,a,o,!1),p=Wy({inputs:{x:c},backend:n,attrs:{shape:d}}),g=Zy({inputs:{x:p},backend:n,attrs:{perm:h}}),m=Wy({inputs:{x:g},backend:n,attrs:{shape:f}});return l.push(c),l.push(p),l.push(g),l.forEach((e=>n.disposeIntermediateTensorInfo(e))),m}},h_={kernelName:D.SparseFillEmptyRows,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{indices:r,values:i,denseShape:a,defaultValue:s}=t;if(1!==a.shape.length)throw new Error(`Dense shape must be a vector, saw:\n         ${a.shape}`);if(2!==r.shape.length)throw new Error(`Indices must be a matrix, saw:\n         ${r.shape}`);if(1!==i.shape.length)throw new Error(`Values must be a vector, saw:\n         ${i.shape}`);if(0!==s.shape.length)throw new Error(`Default value must be a scalar, saw:\n        ${s.shape}`);const o=n.readSync(r.dataId),u=n.readSync(i.dataId),l=n.readSync(a.dataId),c=n.readSync(s.dataId)[0],[d,h,f,p,g]=Hm(o,r.shape,r.dtype,u,i.dtype,l,c);return[n.makeTensorInfo(h,r.dtype,d),n.makeTensorInfo([h[0]],i.dtype,f),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map((e=>Number(e))))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}},f_={kernelName:D.SparseReshape,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{inputIndices:r,inputShape:i,newShape:a}=t;if(2!==r.shape.length)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(1!==i.shape.length)throw new Error(`Input shape should be a vector but received shape ${i.shape}`);if(1!==a.shape.length)throw new Error(`Target shape should be a vector but received shape ${a.shape}`);const s=Array.from(n.readSync(i.dataId)),o=n.readSync(r.dataId),u=Array.from(n.readSync(a.dataId)),[l,c,d]=Xm(o,r.shape,r.dtype,s,u);return[n.makeTensorInfo(c,r.dtype,l),n.makeTensorInfo([d.length],a.dtype,new Int32Array(d))]}},p_={kernelName:D.SparseSegmentMean,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:a}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error(`Indices should be a vector but received shape\n              ${i.shape}`);if(1!==a.shape.length)throw new Error(`Segment ids should be a vector but received shape\n              ${a.shape}`);const s=n.readSync(r.dataId),o=n.readSync(i.dataId),u=n.readSync(a.dataId),[l,c]=Km(s,r.shape,r.dtype,o,u,!0);return n.makeTensorInfo(c,r.dtype,l)}},g_={kernelName:D.SparseSegmentSum,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:a}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==i.shape.length)throw new Error(`Indices should be a vector but received shape\n             ${i.shape}`);if(1!==a.shape.length)throw new Error(`Segment ids should be a vector but received shape\n             ${a.shape}`);const s=n.readSync(r.dataId),o=n.readSync(i.dataId),u=n.readSync(a.dataId),[l,c]=Km(s,r.shape,r.dtype,o,u);return n.makeTensorInfo(c,r.dtype,l)}},m_={kernelName:D.SparseToDense,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{sparseIndices:i,sparseValues:a,defaultValue:s}=t,{outputShape:o}=r,{sliceRank:u,numUpdates:l,strides:c,outputSize:d}=D.backend_util.calculateShapes(a,i,o),h=new Kk(l,u,i.shape.length,a.shape.length,c,[d,1],!1),f=n.runWebGLProgram(h,[a,i,s],a.dtype),p=Wy({inputs:{x:f},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(f),p}},y_={kernelName:D.SplitV,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{numOrSizeSplits:a,axis:s}=r,o=D.util.parseAxisParam(s,i.shape)[0],u=D.backend_util.prepareSplitSize(i,a,o),l=i.shape.length,c=new Array(l).fill(0),d=i.shape.slice();return u.map((e=>{const t=[...d];t[o]=e;const r=Kv({inputs:{x:i},backend:n,attrs:{begin:c,size:t}});return c[o]+=e,r}))}},v_="return sqrt(x);",b_=My({opSnippet:v_,packedOpSnippet:v_,cpuKernelImpl:Ym}),x_={kernelName:D.Sqrt,backendName:"webgl",kernelFunc:b_},w_=My({opSnippet:"return x * x;"}),k_={kernelName:D.Square,backendName:"webgl",kernelFunc:w_},__="return (a - b) * (a - b);",S_=Ry({opSnippet:__,packedOpSnippet:__}),C_={kernelName:D.SquaredDifference,backendName:"webgl",kernelFunc:S_},A_={kernelName:D.Step,backendName:"webgl",kernelFunc:function({inputs:e,attrs:t,backend:n}){const{x:r}=e,i=`if (isnan(x)) return x;\n    return x > 0.0 ? 1.0 : float(${t.alpha});\n  `,a=new py(r.shape,i);return n.runWebGLProgram(a,[r],r.dtype)}};class E_{constructor(e,t,n){this.variableNames=["x"],this.outputShape=n;const r=n.length,i=Jg(n.length),a=Jg(n.length);let s="";if(1===r)s="coords * strides + begin";else{let e=0;s=n.map(((t,r)=>(e++,1===n.length?`coords * strides[${r}] + begin[${r}]`:`coords[${e-1}] * strides[${r}] + begin[${r}]`))).join(",")}this.userCode=`\n      ${i} begin = ${i}(${e});\n      ${i} strides = ${i}(${t});\n\n      void main() {\n        ${a} coords = getOutputCoords();\n        setOutput(getX(${s}));\n      }\n    `}}const F_={kernelName:D.StridedSlice,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:a,end:s,strides:o,beginMask:u,endMask:l,ellipsisMask:c,newAxisMask:d,shrinkAxisMask:h}=r,{finalShapeSparse:f,finalShape:p,isIdentity:g,sliceDim0:m,isSimpleSlice:y,begin:v,end:b,strides:x}=D.slice_util.sliceInfo(i.shape,a,s,o,u,l,c,d,h);let w;if(g)w=Wy({inputs:{x:i},backend:n,attrs:{shape:p}});else if(m||y){D.util.assert(i.shape.length>=1,(()=>`Input must have rank at least 1, got: ${i.shape.length}`));const e=D.slice_util.computeOutShape(v,b,x),t=Kv({inputs:{x:i},backend:n,attrs:{begin:v,size:e}});w=Wy({inputs:{x:t},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(t)}else if(n.shouldExecuteOnCPU([i])){const e=n.readSync(i.dataId),t=(0,D.buffer)(i.shape,i.dtype,e),r=Qm(f,t,x,v);w=n.makeTensorInfo(p,i.dtype,r.values)}else{const e=new E_(v,x,f);w=n.runWebGLProgram(e,[i],i.dtype)}const k=Wy({inputs:{x:w},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(w),k}},I_={kernelName:D.StringNGrams,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{separator:i,nGramWidths:a,leftPad:s,rightPad:o,padWidth:u,preserveShortSequences:l}=r,{data:c,dataSplits:d}=t,h=n.readSync(c.dataId),f=n.readSync(d.dataId),[p,g]=Jm(h,f,i,a,s,o,u,l);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(d.shape,"int32",g)]}},D_={kernelName:D.StringSplit,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{skipEmpty:i}=r,{input:a,delimiter:s}=t;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error(`Input must be a vector, got shape: ${a.shape}`);if(0!==s.shape.length)throw new Error(`Delimiter must be a scalar, got shape: ${s.shape}`);const o=n.readSync(a.dataId),u=n.readSync(s.dataId)[0],[l,c,d]=Zm(o,u,i),h=c.length;return[n.makeTensorInfo([h,2],"int32",l),n.makeTensorInfo([h],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(d))]}},N_={kernelName:D.StringToHashBucketFast,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{numBuckets:i}=r,{input:a}=t;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const s=n.readSync(a.dataId),o=ey(s,i);return n.makeTensorInfo(a.shape,"int32",o)}},$_=My({opSnippet:"return tan(x);"}),T_={kernelName:D.Tan,backendName:"webgl",kernelFunc:$_},O_=My({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),M_={kernelName:D.Tanh,backendName:"webgl",kernelFunc:O_};class R_{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;const r=Jg(this.rank),i=function(e){const t=e.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(1===t)return`imod(resRC, ${e[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let t=0;t<e.length;t++)r.push(`imod(${n[t]}, ${e[t]})`);return r.join()}(e);this.userCode=`\n      void main() {\n        ${r} resRC = getOutputCoords();\n        setOutput(getA(${i}));\n      }\n    `}}function B_(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reps:a}=r;if("string"===i.dtype||i.shape.length>5){const e=n.readSync(i.dataId),t="string"===i.dtype?e.map((e=>D.util.decodeString(e))):e,r=(0,D.buffer)(i.shape,i.dtype,t),s=ny(r,a);return n.makeTensorInfo(s.shape,s.dtype,s.values)}const s=new R_(i.shape,a);return n.runWebGLProgram(s,[i],i.dtype)}const z_={kernelName:D.Tile,backendName:"webgl",kernelFunc:B_};class L_{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "}}class P_{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}}function j_(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function U_(e){let t=1;for(;t<e;)t*=2;return t}const W_={kernelName:D.TopK,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{k:a,sorted:s}=r,o=(0,D.env)().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=(0,D.env)().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=i.shape,c=l[l.length-1];if(n.shouldExecuteOnCPU([i])||c<o||a>u){const e=n.readSync(i.dataId),[t,r]=ry(e,l,i.dtype,a,s);return[n.makeTensorInfo(t.shape,t.dtype,t.values),n.makeTensorInfo(r.shape,r.dtype,r.values)]}if(0===a)return l[l.length-1]=0,[n.makeTensorInfo(l,i.dtype,[]),n.makeTensorInfo(l,"int32",[])];if(1===c)return[i,Dx({attrs:{shape:l,dtype:"int32",value:0},backend:n})];const d=n.texData.get(i.dataId),h=null!==d&&d.isPacked,f=h?n.unpackTensor(i):i,p=D.util.sizeFromShape(l)/c,g=Wy({inputs:{x:f},attrs:{shape:[p,c]},backend:n});h&&j_(n,f);const m=U_(a),y=U_(c);let v=null;const b=()=>null===v?[g,g]:[g,v],x=(e,t,r)=>{const i=b(),a=new L_(r),s=[[c],[null===v?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],o=v;v=n.runWebGLProgram(a,i,"int32",s),j_(n,o)};for(let e=1;e<m;e*=2){const t=2*e;for(let n=e;n>=1;n/=2)x(t,n,[p,y])}for(let e=y;e>m;e/=2){const t=b(),r=new P_([p,e/2]),i=[[c],[null===v?1:0],[m]],a=v;v=n.runWebGLProgram(r,t,"int32",i),j_(n,a);const s=m/2,o=2*s;for(let e=s;e>=1;e/=2)x(o,e,v.shape)}let w=v;v=Kv({inputs:{x:v},backend:n,attrs:{begin:0,size:[p,a]}}),j_(n,w);let k=Xx({inputs:{x:g,indices:v},backend:n,attrs:{axis:1,batchDims:1}});j_(n,g);const _=l.slice(0,-1);_.push(a),w=v,v=Wy({inputs:{x:v},attrs:{shape:_},backend:n}),j_(n,w);const S=k;return k=Wy({inputs:{x:k},attrs:{shape:_},backend:n}),j_(n,S),[k,v]}};class V_{constructor(e,t,n,r,i,a){this.variableNames=["Image","Transforms"],this.outputShape=a;const s="nearest"===n?1:2;let o;switch(r){case"constant":default:o=1;break;case"reflect":o=2;break;case"wrap":o=3;break;case"nearest":o=4}this.userCode=`\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(${o} == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${o} == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (${o} == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(${i});\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(${i});\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(${t}));\n                float mapY = mapCoord(inY, float(${e}));\n\n                if (${s} == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        `}}const G_={kernelName:D.Transform,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{image:i,transforms:a}=t,{interpolation:s,fillMode:o,fillValue:u,outputShape:l}=r,[c,d,h,f]=i.shape,[p,g]=null!=l?l:[d,h],m=new V_(d,h,s,o,u,[c,p,g,f]);return n.runWebGLProgram(m,[i,a],"float32")}},q_={kernelName:D.Unique,backendName:"webgl",kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{axis:i}=n,{x:a}=t;Mg(a,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const s=r.readSync(a.dataId),{outputValues:o,outputShape:u,indices:l}=ay(s,i,a.shape,a.dtype);return[r.makeTensorInfo(u,a.dtype,o),r.makeTensorInfo([l.length],"int32",l)]}},H_={kernelName:D.Unpack,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{value:i}=t;let{axis:a}=r;a<0&&(a+=i.shape.length);const s=i,o=s.shape.length,u=i.shape[a],l=new Array(o-1);let c=0;for(let e=0;e<o;e++)e!==a&&(l[c++]=s.shape[e]);const d=[],h=new Array(o).fill(0),f=s.shape.slice();f[a]=1;const p=new Array(u);for(let e=0;e<p.length;e++){h[a]=e;const t=Kv({inputs:{x:s},backend:n,attrs:{begin:h,size:f}}),r=Wy({inputs:{x:t},backend:n,attrs:{shape:l}});p[e]=r,d.push(t)}return d.forEach((e=>n.disposeIntermediateTensorInfo(e))),p}};class X_{constructor(e,t){this.variableNames=["x","segmentIds"];const n=e.windowSize,r=e.batchSize,i=e.inSize,a=e.numSegments,s=a*Math.ceil(i/n);this.outputShape=[r,s];const o=4*Math.floor(n/4),u=n%4,l="\n        sumValue += dot(values, segFilter);\n    ";let c="";i%n>0&&(c=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return initializationValue;\n        }\n      `);let d="";i%n>0&&(d=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return -1.0;\n        }\n      `),this.userCode=`\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        ${c}\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ${d}\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ${a})) * float(${n}));\n        int currentSeg = int(mod(float(outIdx), float(${a})));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${o}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ${l}\n        }\n\n        int inIdx = inOffset + ${o};\n        if (${1===u}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ${l}\n        } else if (${2===u}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ${l}\n        } else if (${3===u}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ${l}\n        }\n        setOutput(sumValue);\n      }\n    `}}const K_=[nv,iv,sv,uv,dv,pv,gv,mv,kv,_v,Cv,Ev,Iv,Nv,Tv,Rv,Bv,Pv,jv,Uv,Gv,Qv,Jv,Zv,ib,ob,cb,Fy,fb,wb,Eb,$b,Tb,Ob,Mb,Rb,zb,Pb,Ub,qb,Yb,Qb,Zb,nx,ax,sx,ux,cx,dx,fx,px,mx,vx,xx,kx,Cx,Fx,Nx,Tx,Rx,zx,jx,Wx,Vx,qx,Kx,Qx,Zx,Ay,ew,vb,nw,iw,sw,Ny,uw,cw,dw,fw,gw,yw,bw,ww,Sw,Aw,Fw,Dw,Nw,$w,Mw,Rw,Bw,zw,Lw,jw,Vw,qw,tk,Uy,nk,ik,sk,uk,tb,ck,fk,pk,vk,xk,Oy,wk,_k,rb,Kw,Ck,Ek,Ik,Vy,$k,Ok,Bk,Lk,Uk,Vk,qk,Xk,Yk,Jk,e_,n_,i_,s_,u_,Yv,ek,c_,d_,h_,f_,p_,g_,m_,y_,x_,k_,C_,A_,F_,I_,D_,N_,Jw,Jy,T_,M_,z_,W_,G_,ev,q_,H_,{kernelName:D.UnsortedSegmentSum,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,segmentIds:a}=t,{numSegments:s}=r,o=i.shape.length,u=[];let l=0;const c=D.backend_util.getAxesPermutation([l],o);let d=i;null!=c&&(d=Zy({inputs:{x:i},backend:n,attrs:{perm:c}}),u.push(d),l=D.backend_util.getInnerMostAxes(1,o)[0]);const h=D.backend_util.segment_util.computeOutShape(d.shape,l,s),f=D.util.sizeFromShape([d.shape[l]]),p=Wy({inputs:{x:d},backend:n,attrs:{shape:[-1,f]}});u.push(p);const g=(0,D.sumOutType)(i.dtype),m=(e,t,r,i,a)=>{const s=e.shape[0],o=e.shape[1],l=D.backend_util.segment_util.segOpComputeOptimalWindowSize(o,a),c=new X_({windowSize:l,inSize:o,batchSize:s,numSegments:a},t),d=n.compileAndRun(c,[e,r],i);if(u.push(d),d.shape[1]===a)return d;const h=kk({backend:n,attrs:{start:0,stop:a,step:1,dtype:"float32"}}),f=B_({inputs:{x:h},backend:n,attrs:{reps:[o/l]}});return u.push(h),u.push(f),m(d,t,f,i,a)},y=Wy({inputs:{x:m(p,"unsortedSegmentSum",a,g,s)},backend:n,attrs:{shape:h}});let v=y;if(null!=c){u.push(y);const e=D.backend_util.getUndoAxesPermutation(c);v=Zy({inputs:{x:v},backend:n,attrs:{perm:e}})}return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),v}},hk];for(const e of K_)(0,D.registerKernel)(e);D.version_core;var Y_=n(78810);function Q_(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function J_(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function Z_(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function s(e){J_(a,r,i,s,o,"next",e)}function o(e){J_(a,r,i,s,o,"throw",e)}s(void 0)}))}}function eS(){return tS.apply(this,arguments)}function tS(){return(tS=Z_(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://storage.googleapis.com/tfjs-tutorials/carsData.json");case 2:return t=e.sent,e.next=5,t.json();case 5:return n=e.sent,r=n.map((function(e){return{mpg:e.Miles_per_Gallon,horsepower:e.Horsepower}})).filter((function(e){return null!=e.mpg&&null!=e.horsepower})),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nS(){return(nS=Z_(regeneratorRuntime.mark((function e(){var t,n,r,i,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,eS();case 2:return t=e.sent,n=t.map((function(e){return{x:e.horsepower,y:e.mpg}})),Y_.render.scatterplot({name:"Horsepower v MPG"},{values:n},{xLabel:"Horsepower",yLabel:"MPG",height:300}),r=rS(),Y_.show.modelSummary({name:"Model Summary"},r),i=iS(t),a=i.inputs,s=i.labels,e.next=11,aS(r,a,s);case 11:console.log("Done Training"),oS(r,t,i);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rS(){var e=new ls(undefined);return e.add(pu({inputShape:[1],units:1,useBias:!0})),e.add(pu({units:1,useBias:!0})),e}function iS(e){return D.tidy((function(){D.util.shuffle(e);var t=e.map((function(e){return e.horsepower})),n=e.map((function(e){return e.mpg})),r=D.tensor2d(t,[t.length,1]),i=D.tensor2d(n,[n.length,1]),a=r.max(),s=r.min(),o=i.max(),u=i.min();return{inputs:r.sub(s).div(a.sub(s)),labels:i.sub(u).div(o.sub(u)),inputMax:a,inputMin:s,labelMax:o,labelMin:u}}))}function aS(e,t,n){return sS.apply(this,arguments)}function sS(){return(sS=Z_(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.compile({optimizer:D.train.adam(),loss:D.losses.meanSquaredError,metrics:["mse"]}),e.next=5,t.fit(n,r,{batchSize:32,epochs:50,shuffle:!0,callbacks:Y_.show.fitCallbacks({name:"Training Performance"},["loss","mse"],{height:200,callbacks:["onEpochEnd"]})});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oS(e,t,n){var r,i,a=n.inputMax,s=n.inputMin,o=n.labelMin,u=n.labelMax,l=D.tidy((function(){var t=D.linspace(0,1,100),n=e.predict(t.reshape([100,1])),r=t.mul(a.sub(s)).add(s),i=n.mul(u.sub(o)).add(o);return[r.dataSync(),i.dataSync()]})),c=(i=2,function(e){if(Array.isArray(e))return e}(r=l)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a=[],s=!0,o=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(o)throw i}}return a}}(r,i)||function(e,t){if(e){if("string"==typeof e)return Q_(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Q_(e,t):void 0}}(r,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),d=c[0],h=c[1],f=Array.from(d).map((function(e,t){return{x:e,y:h[t]}})),p=t.map((function(e){return{x:e.horsepower,y:e.mpg}}));Y_.render.scatterplot({name:"Model Predictions vs Original Data"},{values:[p,f],series:["original","predicted"]},{xLabel:"Horsepower",yLabel:"MPG",height:300})}const uS=function(){return function(){nS.apply(this,arguments)}(),r.createElement("div",null,"Fuel Efficiency Prediction Model")},lS=n.p+"/client/img/hotdog.png",cS=function(){return r.createElement(r.Fragment,null,r.createElement("div",null,"Hotdog or Not Hotdog?"),r.createElement("img",{id:"img",src:lS}))},dS=function(){return r.createElement(I,null,r.createElement("div",{className:"container"},r.createElement("h1",null,"Welcome to TensorFlow"),r.createElement(E,null,r.createElement(C,{exact:!0,path:"/fuel_efficiency",element:r.createElement(uS,null)}),r.createElement(C,{exact:!0,path:"/hotdog",element:r.createElement(cS,null)}))))};(0,i.render)(r.createElement(dS,null),document.getElementById("root"))})()})();